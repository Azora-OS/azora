apiVersion: linkerd.io/v1alpha2
kind: ServiceProfile
metadata:
  name: azora-api-gateway.azora.svc.cluster.local
  namespace: azora
spec:
  routes:
    - name: GET /api/health
      condition:
        method: GET
        pathRegex: /api/health
      responseClasses:
        - condition:
            status:
              min: 500
          isFailure: true
    - name: POST /api/auth/login
      condition:
        method: POST
        pathRegex: /api/auth/login
      responseClasses:
        - condition:
            status:
              min: 500
          isFailure: true
  retryBudget:
    retryRatio: 0.2
    minRetriesPerSecond: 10
    ttl: 10s
---
apiVersion: linkerd.io/v1alpha1
kind: Server
metadata:
  name: azora-api-gateway
  namespace: azora
spec:
  podSelector:
    matchLabels:
      app: azora-api-gateway
  port: 3000
  proxyProtocol: HTTP/1
