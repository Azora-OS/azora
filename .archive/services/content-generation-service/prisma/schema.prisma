// Prisma schema for Content Generation Service
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model GeneratedContent {
  id           String   @id @default(cuid())
  type         String   // lesson, quiz, learning_path, personalized_content
  topic        String
  content      Json     // Generated content structure
  userId       String?
  generatedAt  DateTime @default(now())
  status       String   @default("completed") // completed, failed, processing
  version      String   @default("1.0")
  metadata     Json?    // Additional metadata

  @@map("generated_content")
}

model LearningPath {
  id              String   @id @default(cuid())
  topic           String
  learnerId       String
  currentLevel    String
  goals           String[] // Array of learning goals
  timeCommitment  String
  preferences     Json?    // Learner preferences
  assessment      Json?    // Knowledge assessment results
  modules         Json     // Array of learning modules
  totalDuration   Int      // Total estimated duration in weeks
  createdAt       DateTime @default(now())
  completedAt     DateTime?
  progress        Float    @default(0) // 0-100 percentage

  @@map("learning_paths")
}

model ContentGenerationMetric {
  id            String   @id @default(cuid())
  contentType   String
  topic         String
  section       String?  // Section of content generated
  modelId       String
  tokensUsed    Int
  responseTime  Float    // Response time in seconds
  success       Boolean  @default(true)
  generatedAt   DateTime @default(now())
  errorMessage  String?

  @@map("content_generation_metrics")
}

model LearnerProfile {
  id                String   @id @default(cuid())
  learnerId         String   @unique
  learningStyle     String?  // visual, auditory, kinesthetic, reading
  currentLevel      String   @default("beginner")
  interests         String[] // Array of interest areas
  completedTopics   String[] // Array of completed topics
  preferredPace     String   @default("moderate") // slow, moderate, fast
  accessibility     Json?    // Accessibility preferences
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("learner_profiles")
}

model ContentTemplate {
  id              String   @id @default(cuid())
  name            String   @unique
  type            String   // lesson, quiz, exercise, etc.
  structure       Json     // Template structure definition
  prompts         Json     // Prompt templates
  isActive        Boolean  @default(true)
  version         String   @default("1.0")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("content_templates")
}

model ContentFeedback {
  id              String   @id @default(cuid())
  contentId       String
  userId          String
  rating          Int      // 1-5 rating
  feedback        String?
  helpfulAspects  String[] // What was helpful
  improvementAreas String[] // What could be improved
  submittedAt     DateTime @default(now())

  @@map("content_feedback")
}

model LearningProgress {
  id              String   @id @default(cuid())
  learnerId       String
  learningPathId  String
  moduleId        String
  completed       Boolean  @default(false)
  score           Float?   // Assessment score if applicable
  timeSpent       Int      // Time spent in minutes
  completedAt     DateTime?
  notes           String?

  @@unique([learnerId, learningPathId, moduleId])
  @@map("learning_progress")
}

model ContentAnalytics {
  id              String   @id @default(cuid())
  contentId       String
  views           Int      @default(0)
  completions     Int      @default(0)
  averageRating   Float?
  totalTimeSpent  Int      @default(0) // Total time spent by all users
  lastAccessed    DateTime?
  engagementRate  Float?   // Percentage of content consumed

  @@unique([contentId])
  @@map("content_analytics")
}