version: '3.8'

services:
  event-bus:
    build:
      context: .
      dockerfile: core/organs/event-bus/Dockerfile
    container_name: azora-event-bus
    ports:
      - "3005:3005"
    environment:
      - NODE_ENV=production
      - PORT=3005
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - azora-network

  chronicle:
    build:
      context: .
      dockerfile: services/chronicle-protocol/Dockerfile
    container_name: azora-chronicle
    ports:
      - "4400:4400"
    environment:
      - NODE_ENV=production
      - PORT=4400
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4400/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - azora-network

  api-gateway:
    build:
      context: .
      dockerfile: services/api-gateway/Dockerfile
    container_name: azora-api-gateway
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - EVENT_BUS_URL=http://event-bus:3005
      - CHRONICLE_URL=http://chronicle:4400
    depends_on:
      - event-bus
      - chronicle
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - azora-network

networks:
  azora-network:
    driver: bridge
