{"version":3,"names":["_CodeInstrumentation","require","describe","defaultConfig","logging","enabled","level","provider","metrics","customMetrics","tracing","sampleRate","events","customEvents","it","instrumentation","CodeInstrumentation","code","result","instrumentService","expect","instrumentedCode","toContain","addedImports","metricsEndpoint","toBe","minimalConfig","toHaveLength","addedMiddleware","toBeUndefined","utils","generateMonitoringUtils","toBeDefined"],"sources":["CodeInstrumentation.test.ts"],"sourcesContent":["import { CodeInstrumentation, InstrumentationConfig } from '../CodeInstrumentation';\n\ndescribe('CodeInstrumentation', () => {\n  const defaultConfig: InstrumentationConfig = {\n    logging: {\n      enabled: true,\n      level: 'info',\n      provider: 'winston',\n    },\n    metrics: {\n      enabled: true,\n      provider: 'prometheus',\n      customMetrics: [],\n    },\n    tracing: {\n      enabled: true,\n      provider: 'opentelemetry',\n      sampleRate: 1.0,\n    },\n    events: {\n      enabled: true,\n      customEvents: ['userSignup', 'paymentProcessed'],\n    },\n  };\n\n  describe('instrumentService', () => {\n    it('should add logging to service functions', async () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const code = `\n        export function processPayment(amount: number) {\n          return { success: true, amount };\n        }\n      `;\n\n      const result = await instrumentation.instrumentService(code, 'PaymentService');\n\n      expect(result.instrumentedCode).toContain('logger.info');\n      expect(result.addedImports).toContain(\"import { logger } from './utils/logger';\");\n    });\n\n    it('should add metrics to Express routes', async () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const code = `\n        app.get('/api/users', async (req, res) => {\n          const users = await getUsers();\n          res.json(users);\n        });\n      `;\n\n      const result = await instrumentation.instrumentService(code, 'UserService');\n\n      expect(result.instrumentedCode).toContain('metrics.increment');\n      expect(result.instrumentedCode).toContain('http_requests_total');\n      expect(result.metricsEndpoint).toBe('/metrics');\n    });\n\n    it('should add distributed tracing spans', async () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const code = `\n        export async function fetchUserData(userId: string) {\n          const user = await db.user.findUnique({ where: { id: userId } });\n          return user;\n        }\n      `;\n\n      const result = await instrumentation.instrumentService(code, 'UserService');\n\n      expect(result.instrumentedCode).toContain('tracer.startSpan');\n      expect(result.instrumentedCode).toContain('span.end()');\n    });\n\n    it('should add custom event tracking', async () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const code = `\n        export function userSignup(email: string) {\n          createUser(email);\n          return { success: true };\n        }\n      `;\n\n      const result = await instrumentation.instrumentService(code, 'AuthService');\n\n      expect(result.instrumentedCode).toContain('analytics.track');\n    });\n\n    it('should handle disabled instrumentation', async () => {\n      const minimalConfig: InstrumentationConfig = {\n        logging: { enabled: false, level: 'info', provider: 'console' },\n        metrics: { enabled: false, provider: 'prometheus', customMetrics: [] },\n        tracing: { enabled: false, provider: 'opentelemetry', sampleRate: 0 },\n        events: { enabled: false, customEvents: [] },\n      };\n\n      const instrumentation = new CodeInstrumentation(minimalConfig);\n      const code = `export function test() { return true; }`;\n\n      const result = await instrumentation.instrumentService(code, 'TestService');\n\n      expect(result.addedImports).toHaveLength(0);\n      expect(result.addedMiddleware).toHaveLength(0);\n      expect(result.metricsEndpoint).toBeUndefined();\n    });\n  });\n\n  describe('generateMonitoringUtils', () => {\n    it('should generate logger utility', () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const utils = instrumentation.generateMonitoringUtils();\n\n      expect(utils['utils/logger.ts']).toBeDefined();\n      expect(utils['utils/logger.ts']).toContain('winston');\n    });\n\n    it('should generate metrics utility', () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const utils = instrumentation.generateMonitoringUtils();\n\n      expect(utils['utils/metrics.ts']).toBeDefined();\n      expect(utils['utils/metrics.ts']).toContain('prom-client');\n    });\n\n    it('should generate tracing utility', () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const utils = instrumentation.generateMonitoringUtils();\n\n      expect(utils['utils/tracing.ts']).toBeDefined();\n      expect(utils['utils/tracing.ts']).toContain('@opentelemetry');\n    });\n\n    it('should generate analytics utility', () => {\n      const instrumentation = new CodeInstrumentation(defaultConfig);\n      const utils = instrumentation.generateMonitoringUtils();\n\n      expect(utils['utils/analytics.ts']).toBeDefined();\n      expect(utils['utils/analytics.ts']).toContain('analytics');\n    });\n  });\n});\n"],"mappings":";;AAAA,IAAAA,oBAAA,GAAAC,OAAA;AAEAC,QAAQ,CAAC,qBAAqB,EAAE,MAAM;EACpC,MAAMC,aAAoC,GAAG;IAC3CC,OAAO,EAAE;MACPC,OAAO,EAAE,IAAI;MACbC,KAAK,EAAE,MAAM;MACbC,QAAQ,EAAE;IACZ,CAAC;IACDC,OAAO,EAAE;MACPH,OAAO,EAAE,IAAI;MACbE,QAAQ,EAAE,YAAY;MACtBE,aAAa,EAAE;IACjB,CAAC;IACDC,OAAO,EAAE;MACPL,OAAO,EAAE,IAAI;MACbE,QAAQ,EAAE,eAAe;MACzBI,UAAU,EAAE;IACd,CAAC;IACDC,MAAM,EAAE;MACNP,OAAO,EAAE,IAAI;MACbQ,YAAY,EAAE,CAAC,YAAY,EAAE,kBAAkB;IACjD;EACF,CAAC;EAEDX,QAAQ,CAAC,mBAAmB,EAAE,MAAM;IAClCY,EAAE,CAAC,yCAAyC,EAAE,YAAY;MACxD,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAMc,IAAI,GAAG;AACnB;AACA;AACA;AACA,OAAO;MAED,MAAMC,MAAM,GAAG,MAAMH,eAAe,CAACI,iBAAiB,CAACF,IAAI,EAAE,gBAAgB,CAAC;MAE9EG,MAAM,CAACF,MAAM,CAACG,gBAAgB,CAAC,CAACC,SAAS,CAAC,aAAa,CAAC;MACxDF,MAAM,CAACF,MAAM,CAACK,YAAY,CAAC,CAACD,SAAS,CAAC,0CAA0C,CAAC;IACnF,CAAC,CAAC;IAEFR,EAAE,CAAC,sCAAsC,EAAE,YAAY;MACrD,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAMc,IAAI,GAAG;AACnB;AACA;AACA;AACA;AACA,OAAO;MAED,MAAMC,MAAM,GAAG,MAAMH,eAAe,CAACI,iBAAiB,CAACF,IAAI,EAAE,aAAa,CAAC;MAE3EG,MAAM,CAACF,MAAM,CAACG,gBAAgB,CAAC,CAACC,SAAS,CAAC,mBAAmB,CAAC;MAC9DF,MAAM,CAACF,MAAM,CAACG,gBAAgB,CAAC,CAACC,SAAS,CAAC,qBAAqB,CAAC;MAChEF,MAAM,CAACF,MAAM,CAACM,eAAe,CAAC,CAACC,IAAI,CAAC,UAAU,CAAC;IACjD,CAAC,CAAC;IAEFX,EAAE,CAAC,sCAAsC,EAAE,YAAY;MACrD,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAMc,IAAI,GAAG;AACnB;AACA;AACA;AACA;AACA,OAAO;MAED,MAAMC,MAAM,GAAG,MAAMH,eAAe,CAACI,iBAAiB,CAACF,IAAI,EAAE,aAAa,CAAC;MAE3EG,MAAM,CAACF,MAAM,CAACG,gBAAgB,CAAC,CAACC,SAAS,CAAC,kBAAkB,CAAC;MAC7DF,MAAM,CAACF,MAAM,CAACG,gBAAgB,CAAC,CAACC,SAAS,CAAC,YAAY,CAAC;IACzD,CAAC,CAAC;IAEFR,EAAE,CAAC,kCAAkC,EAAE,YAAY;MACjD,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAMc,IAAI,GAAG;AACnB;AACA;AACA;AACA;AACA,OAAO;MAED,MAAMC,MAAM,GAAG,MAAMH,eAAe,CAACI,iBAAiB,CAACF,IAAI,EAAE,aAAa,CAAC;MAE3EG,MAAM,CAACF,MAAM,CAACG,gBAAgB,CAAC,CAACC,SAAS,CAAC,iBAAiB,CAAC;IAC9D,CAAC,CAAC;IAEFR,EAAE,CAAC,wCAAwC,EAAE,YAAY;MACvD,MAAMY,aAAoC,GAAG;QAC3CtB,OAAO,EAAE;UAAEC,OAAO,EAAE,KAAK;UAAEC,KAAK,EAAE,MAAM;UAAEC,QAAQ,EAAE;QAAU,CAAC;QAC/DC,OAAO,EAAE;UAAEH,OAAO,EAAE,KAAK;UAAEE,QAAQ,EAAE,YAAY;UAAEE,aAAa,EAAE;QAAG,CAAC;QACtEC,OAAO,EAAE;UAAEL,OAAO,EAAE,KAAK;UAAEE,QAAQ,EAAE,eAAe;UAAEI,UAAU,EAAE;QAAE,CAAC;QACrEC,MAAM,EAAE;UAAEP,OAAO,EAAE,KAAK;UAAEQ,YAAY,EAAE;QAAG;MAC7C,CAAC;MAED,MAAME,eAAe,GAAG,IAAIC,wCAAmB,CAACU,aAAa,CAAC;MAC9D,MAAMT,IAAI,GAAG,yCAAyC;MAEtD,MAAMC,MAAM,GAAG,MAAMH,eAAe,CAACI,iBAAiB,CAACF,IAAI,EAAE,aAAa,CAAC;MAE3EG,MAAM,CAACF,MAAM,CAACK,YAAY,CAAC,CAACI,YAAY,CAAC,CAAC,CAAC;MAC3CP,MAAM,CAACF,MAAM,CAACU,eAAe,CAAC,CAACD,YAAY,CAAC,CAAC,CAAC;MAC9CP,MAAM,CAACF,MAAM,CAACM,eAAe,CAAC,CAACK,aAAa,CAAC,CAAC;IAChD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF3B,QAAQ,CAAC,yBAAyB,EAAE,MAAM;IACxCY,EAAE,CAAC,gCAAgC,EAAE,MAAM;MACzC,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAM2B,KAAK,GAAGf,eAAe,CAACgB,uBAAuB,CAAC,CAAC;MAEvDX,MAAM,CAACU,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAACE,WAAW,CAAC,CAAC;MAC9CZ,MAAM,CAACU,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAACR,SAAS,CAAC,SAAS,CAAC;IACvD,CAAC,CAAC;IAEFR,EAAE,CAAC,iCAAiC,EAAE,MAAM;MAC1C,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAM2B,KAAK,GAAGf,eAAe,CAACgB,uBAAuB,CAAC,CAAC;MAEvDX,MAAM,CAACU,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAACE,WAAW,CAAC,CAAC;MAC/CZ,MAAM,CAACU,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAACR,SAAS,CAAC,aAAa,CAAC;IAC5D,CAAC,CAAC;IAEFR,EAAE,CAAC,iCAAiC,EAAE,MAAM;MAC1C,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAM2B,KAAK,GAAGf,eAAe,CAACgB,uBAAuB,CAAC,CAAC;MAEvDX,MAAM,CAACU,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAACE,WAAW,CAAC,CAAC;MAC/CZ,MAAM,CAACU,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAACR,SAAS,CAAC,gBAAgB,CAAC;IAC/D,CAAC,CAAC;IAEFR,EAAE,CAAC,mCAAmC,EAAE,MAAM;MAC5C,MAAMC,eAAe,GAAG,IAAIC,wCAAmB,CAACb,aAAa,CAAC;MAC9D,MAAM2B,KAAK,GAAGf,eAAe,CAACgB,uBAAuB,CAAC,CAAC;MAEvDX,MAAM,CAACU,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAACE,WAAW,CAAC,CAAC;MACjDZ,MAAM,CAACU,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAACR,SAAS,CAAC,WAAW,CAAC;IAC5D,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}