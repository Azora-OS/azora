8e537f15c1db211bcfb994d62dacc12c
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PaymentServiceComponent = void 0;
var path = _interopRequireWildcard(require("path"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
class PaymentServiceComponent {
  /**
   * Generate complete Stripe payment integration
   */
  generatePaymentService(config, outputDir) {
    const changes = [];
    const serviceName = 'payment-service';
    const serviceDir = path.join(outputDir, 'services', serviceName);

    // Main service file
    changes.push({
      path: path.join(serviceDir, 'src', 'index.ts'),
      type: 'create',
      content: this.generateIndexFile(config)
    });

    // Controllers
    changes.push({
      path: path.join(serviceDir, 'src', 'controllers', 'payment.controller.ts'),
      type: 'create',
      content: this.generatePaymentController(config)
    });
    changes.push({
      path: path.join(serviceDir, 'src', 'controllers', 'webhook.controller.ts'),
      type: 'create',
      content: this.generateWebhookController(config)
    });

    // Services
    changes.push({
      path: path.join(serviceDir, 'src', 'services', 'stripe.service.ts'),
      type: 'create',
      content: this.generateStripeService(config)
    });
    changes.push({
      path: path.join(serviceDir, 'src', 'services', 'payment.service.ts'),
      type: 'create',
      content: this.generatePaymentServiceFile(config)
    });
    if (config.enableSubscriptions) {
      changes.push({
        path: path.join(serviceDir, 'src', 'services', 'subscription.service.ts'),
        type: 'create',
        content: this.generateSubscriptionService()
      });
    }

    // Repository
    changes.push({
      path: path.join(serviceDir, 'src', 'repositories', 'payment.repository.ts'),
      type: 'create',
      content: this.generatePaymentRepository()
    });

    // Types
    changes.push({
      path: path.join(serviceDir, 'src', 'types', 'index.ts'),
      type: 'create',
      content: this.generateTypes(config)
    });

    // Validation schemas
    changes.push({
      path: path.join(serviceDir, 'src', 'validation', 'payment.schemas.ts'),
      type: 'create',
      content: this.generateValidationSchemas(config)
    });

    // Prisma schema
    changes.push({
      path: path.join(serviceDir, 'prisma', 'schema.prisma'),
      type: 'create',
      content: this.generatePrismaSchema(config)
    });

    // Configuration files
    changes.push({
      path: path.join(serviceDir, 'package.json'),
      type: 'create',
      content: this.generatePackageJson(config)
    });
    changes.push({
      path: path.join(serviceDir, '.env.example'),
      type: 'create',
      content: this.generateEnvExample(config)
    });
    changes.push({
      path: path.join(serviceDir, 'README.md'),
      type: 'create',
      content: this.generateReadme(config)
    });
    return changes;
  }
  generateIndexFile(config) {
    const port = config.port || 3002;
    return `import express, { Application } from 'express';
import cors from 'cors';
import helmet from 'helmet';
import { PaymentController } from './controllers/payment.controller';
import { WebhookController } from './controllers/webhook.controller';
import { errorHandler } from './middleware/error-handler';

const app: Application = express();
const PORT = process.env.PORT || ${port};

// Middleware
app.use(helmet());
app.use(cors());

// Webhook endpoint needs raw body
app.use('/api/webhooks', express.raw({ type: 'application/json' }));

// JSON parsing for other routes
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'healthy', service: 'payment-service' });
});

// Routes
const paymentController = new PaymentController();
const webhookController = new WebhookController();

app.use('/api/payments', paymentController.router);
app.use('/api/webhooks', webhookController.router);

// Error handling
app.use(errorHandler);

// Start server
app.listen(PORT, () => {
  console.log(\`Payment service running on port \${PORT}\`);
});

export default app;
`;
  }
  generatePaymentController(config) {
    return `import { Router, Request, Response, NextFunction } from 'express';
import { PaymentService } from '../services/payment.service';
${config.enableSubscriptions ? "import { SubscriptionService } from '../services/subscription.service';" : ''}
import { validate } from '../middleware/validation';
import { PaymentSchemas } from '../validation/payment.schemas';
import { authMiddleware } from '../middleware/auth.middleware';

export class PaymentController {
  public router: Router;
  private paymentService: PaymentService;
${config.enableSubscriptions ? '  private subscriptionService: SubscriptionService;' : ''}

  constructor() {
    this.router = Router();
    this.paymentService = new PaymentService();
${config.enableSubscriptions ? '    this.subscriptionService = new SubscriptionService();' : ''}
    this.initializeRoutes();
  }

  private initializeRoutes(): void {
    // Create payment intent
    this.router.post(
      '/intent',
      authMiddleware,
      validate(PaymentSchemas.createIntent),
      this.createPaymentIntent.bind(this)
    );
    
    // Confirm payment
    this.router.post(
      '/confirm',
      authMiddleware,
      validate(PaymentSchemas.confirmPayment),
      this.confirmPayment.bind(this)
    );
    
    // Get payment by ID
    this.router.get('/:id', authMiddleware, this.getPayment.bind(this));
    
    // List user payments
    this.router.get('/', authMiddleware, this.listPayments.bind(this));
${config.enableRefunds ? `
    // Refund payment
    this.router.post(
      '/:id/refund',
      authMiddleware,
      validate(PaymentSchemas.refund),
      this.refundPayment.bind(this)
    );
` : ''}${config.enableSubscriptions ? `
    // Subscription endpoints
    this.router.post(
      '/subscriptions',
      authMiddleware,
      validate(PaymentSchemas.createSubscription),
      this.createSubscription.bind(this)
    );
    
    this.router.get('/subscriptions', authMiddleware, this.listSubscriptions.bind(this));
    
    this.router.post(
      '/subscriptions/:id/cancel',
      authMiddleware,
      this.cancelSubscription.bind(this)
    );
` : ''}
  }

  private async createPaymentIntent(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.paymentService.createPaymentIntent({
        ...req.body,
        userId: req.user!.userId,
      });
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async confirmPayment(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.paymentService.confirmPayment(req.body.paymentIntentId);
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async getPayment(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const payment = await this.paymentService.getPayment(req.params.id, req.user!.userId);
      res.json({ success: true, data: payment });
    } catch (error) {
      next(error);
    }
  }

  private async listPayments(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const payments = await this.paymentService.listUserPayments(req.user!.userId);
      res.json({ success: true, data: payments });
    } catch (error) {
      next(error);
    }
  }
${config.enableRefunds ? `
  private async refundPayment(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.paymentService.refundPayment(
        req.params.id,
        req.user!.userId,
        req.body.amount,
        req.body.reason
      );
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }
` : ''}${config.enableSubscriptions ? `
  private async createSubscription(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.subscriptionService.createSubscription({
        ...req.body,
        userId: req.user!.userId,
      });
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async listSubscriptions(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const subscriptions = await this.subscriptionService.listUserSubscriptions(req.user!.userId);
      res.json({ success: true, data: subscriptions });
    } catch (error) {
      next(error);
    }
  }

  private async cancelSubscription(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      await this.subscriptionService.cancelSubscription(req.params.id, req.user!.userId);
      res.json({ success: true, message: 'Subscription cancelled' });
    } catch (error) {
      next(error);
    }
  }
` : ''}
}
`;
  }
  generateWebhookController(config) {
    return `import { Router, Request, Response, NextFunction } from 'express';
import { StripeService } from '../services/stripe.service';
import { PaymentService } from '../services/payment.service';

export class WebhookController {
  public router: Router;
  private stripeService: StripeService;
  private paymentService: PaymentService;

  constructor() {
    this.router = Router();
    this.stripeService = new StripeService();
    this.paymentService = new PaymentService();
    this.initializeRoutes();
  }

  private initializeRoutes(): void {
    this.router.post('/stripe', this.handleStripeWebhook.bind(this));
  }

  private async handleStripeWebhook(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const signature = req.headers['stripe-signature'] as string;
      const event = this.stripeService.constructWebhookEvent(req.body, signature);

      // Handle different event types
      switch (event.type) {
        case 'payment_intent.succeeded':
          await this.paymentService.handlePaymentSuccess(event.data.object);
          break;
        
        case 'payment_intent.payment_failed':
          await this.paymentService.handlePaymentFailure(event.data.object);
          break;
${config.enableSubscriptions ? `
        case 'customer.subscription.created':
          await this.paymentService.handleSubscriptionCreated(event.data.object);
          break;
        
        case 'customer.subscription.updated':
          await this.paymentService.handleSubscriptionUpdated(event.data.object);
          break;
        
        case 'customer.subscription.deleted':
          await this.paymentService.handleSubscriptionCancelled(event.data.object);
          break;
        
        case 'invoice.payment_succeeded':
          await this.paymentService.handleInvoicePaymentSucceeded(event.data.object);
          break;
        
        case 'invoice.payment_failed':
          await this.paymentService.handleInvoicePaymentFailed(event.data.object);
          break;
` : ''}${config.enableRefunds ? `
        case 'charge.refunded':
          await this.paymentService.handleRefund(event.data.object);
          break;
` : ''}
        default:
          console.log(\`Unhandled event type: \${event.type}\`);
      }

      res.json({ received: true });
    } catch (error) {
      next(error);
    }
  }
}
`;
  }
  generateStripeService(config) {
    return `import Stripe from 'stripe';
import { AppError } from '../middleware/error-handler';

export class StripeService {
  private stripe: Stripe;
  private webhookSecret: string;

  constructor() {
    const apiKey = process.env.STRIPE_SECRET_KEY;
    if (!apiKey) {
      throw new Error('STRIPE_SECRET_KEY is required');
    }

    this.stripe = new Stripe(apiKey, {
      apiVersion: '${config.stripeApiVersion || '2023-10-16'}',
    });

    this.webhookSecret = process.env.STRIPE_WEBHOOK_SECRET || '';
  }

  async createPaymentIntent(amount: number, currency: string, metadata?: Record<string, string>): Promise<Stripe.PaymentIntent> {
    return this.stripe.paymentIntents.create({
      amount,
      currency,
      metadata,
    });
  }

  async confirmPaymentIntent(paymentIntentId: string): Promise<Stripe.PaymentIntent> {
    return this.stripe.paymentIntents.confirm(paymentIntentId);
  }

  async retrievePaymentIntent(paymentIntentId: string): Promise<Stripe.PaymentIntent> {
    return this.stripe.paymentIntents.retrieve(paymentIntentId);
  }
${config.enableRefunds ? `
  async createRefund(paymentIntentId: string, amount?: number, reason?: string): Promise<Stripe.Refund> {
    return this.stripe.refunds.create({
      payment_intent: paymentIntentId,
      amount,
      reason: reason as Stripe.RefundCreateParams.Reason,
    });
  }
` : ''}${config.enableSubscriptions ? `
  async createCustomer(email: string, name?: string, metadata?: Record<string, string>): Promise<Stripe.Customer> {
    return this.stripe.customers.create({
      email,
      name,
      metadata,
    });
  }

  async createSubscription(customerId: string, priceId: string, metadata?: Record<string, string>): Promise<Stripe.Subscription> {
    return this.stripe.subscriptions.create({
      customer: customerId,
      items: [{ price: priceId }],
      metadata,
    });
  }

  async cancelSubscription(subscriptionId: string): Promise<Stripe.Subscription> {
    return this.stripe.subscriptions.cancel(subscriptionId);
  }

  async retrieveSubscription(subscriptionId: string): Promise<Stripe.Subscription> {
    return this.stripe.subscriptions.retrieve(subscriptionId);
  }
` : ''}
  constructWebhookEvent(payload: Buffer, signature: string): Stripe.Event {
    try {
      return this.stripe.webhooks.constructEvent(payload, signature, this.webhookSecret);
    } catch (error) {
      throw new AppError(400, 'Invalid webhook signature');
    }
  }
}
`;
  }
  generatePaymentServiceFile(config) {
    return `import { StripeService } from './stripe.service';
import { PaymentRepository } from '../repositories/payment.repository';
import { AppError } from '../middleware/error-handler';
import { Payment, PaymentStatus, CreatePaymentIntentInput } from '../types';

export class PaymentService {
  private stripeService: StripeService;
  private paymentRepository: PaymentRepository;

  constructor() {
    this.stripeService = new StripeService();
    this.paymentRepository = new PaymentRepository();
  }

  async createPaymentIntent(input: CreatePaymentIntentInput): Promise<Payment> {
    const paymentIntent = await this.stripeService.createPaymentIntent(
      input.amount,
      input.currency || 'usd',
      {
        userId: input.userId,
        ...input.metadata,
      }
    );

    const payment = await this.paymentRepository.create({
      userId: input.userId,
      stripePaymentIntentId: paymentIntent.id,
      amount: input.amount,
      currency: input.currency || 'usd',
      status: 'pending',
      metadata: input.metadata,
    });

    return payment;
  }

  async confirmPayment(paymentIntentId: string): Promise<Payment> {
    const paymentIntent = await this.stripeService.confirmPaymentIntent(paymentIntentId);
    
    const payment = await this.paymentRepository.findByStripePaymentIntentId(paymentIntentId);
    if (!payment) {
      throw new AppError(404, 'Payment not found');
    }

    return this.paymentRepository.update(payment.id, {
      status: paymentIntent.status as PaymentStatus,
    });
  }

  async getPayment(paymentId: string, userId: string): Promise<Payment> {
    const payment = await this.paymentRepository.findById(paymentId);
    
    if (!payment) {
      throw new AppError(404, 'Payment not found');
    }

    if (payment.userId !== userId) {
      throw new AppError(403, 'Access denied');
    }

    return payment;
  }

  async listUserPayments(userId: string): Promise<Payment[]> {
    return this.paymentRepository.findByUserId(userId);
  }
${config.enableRefunds ? `
  async refundPayment(paymentId: string, userId: string, amount?: number, reason?: string): Promise<Payment> {
    const payment = await this.getPayment(paymentId, userId);

    if (payment.status !== 'succeeded') {
      throw new AppError(400, 'Can only refund successful payments');
    }

    await this.stripeService.createRefund(payment.stripePaymentIntentId, amount, reason);

    return this.paymentRepository.update(payment.id, {
      status: 'refunded',
    });
  }
` : ''}
  async handlePaymentSuccess(paymentIntent: any): Promise<void> {
    const payment = await this.paymentRepository.findByStripePaymentIntentId(paymentIntent.id);
    if (payment) {
      await this.paymentRepository.update(payment.id, {
        status: 'succeeded',
      });
    }
  }

  async handlePaymentFailure(paymentIntent: any): Promise<void> {
    const payment = await this.paymentRepository.findByStripePaymentIntentId(paymentIntent.id);
    if (payment) {
      await this.paymentRepository.update(payment.id, {
        status: 'failed',
      });
    }
  }
${config.enableSubscriptions ? `
  async handleSubscriptionCreated(subscription: any): Promise<void> {
    // Handle subscription creation
    console.log('Subscription created:', subscription.id);
  }

  async handleSubscriptionUpdated(subscription: any): Promise<void> {
    // Handle subscription update
    console.log('Subscription updated:', subscription.id);
  }

  async handleSubscriptionCancelled(subscription: any): Promise<void> {
    // Handle subscription cancellation
    console.log('Subscription cancelled:', subscription.id);
  }

  async handleInvoicePaymentSucceeded(invoice: any): Promise<void> {
    // Handle successful invoice payment
    console.log('Invoice payment succeeded:', invoice.id);
  }

  async handleInvoicePaymentFailed(invoice: any): Promise<void> {
    // Handle failed invoice payment
    console.log('Invoice payment failed:', invoice.id);
  }
` : ''}${config.enableRefunds ? `
  async handleRefund(charge: any): Promise<void> {
    // Handle refund
    console.log('Refund processed:', charge.id);
  }
` : ''}
}
`;
  }
  generateSubscriptionService() {
    return `import { StripeService } from './stripe.service';
import { PaymentRepository } from '../repositories/payment.repository';
import { AppError } from '../middleware/error-handler';
import { Subscription, CreateSubscriptionInput } from '../types';

export class SubscriptionService {
  private stripeService: StripeService;
  private paymentRepository: PaymentRepository;

  constructor() {
    this.stripeService = new StripeService();
    this.paymentRepository = new PaymentRepository();
  }

  async createSubscription(input: CreateSubscriptionInput): Promise<Subscription> {
    // Create or get Stripe customer
    let customer = await this.paymentRepository.findCustomerByUserId(input.userId);
    
    if (!customer) {
      const stripeCustomer = await this.stripeService.createCustomer(
        input.email,
        input.name,
        { userId: input.userId }
      );
      customer = await this.paymentRepository.createCustomer({
        userId: input.userId,
        stripeCustomerId: stripeCustomer.id,
        email: input.email,
      });
    }

    // Create subscription
    const stripeSubscription = await this.stripeService.createSubscription(
      customer.stripeCustomerId,
      input.priceId,
      input.metadata
    );

    const subscription = await this.paymentRepository.createSubscription({
      userId: input.userId,
      stripeSubscriptionId: stripeSubscription.id,
      priceId: input.priceId,
      status: stripeSubscription.status,
      currentPeriodStart: new Date(stripeSubscription.current_period_start * 1000),
      currentPeriodEnd: new Date(stripeSubscription.current_period_end * 1000),
    });

    return subscription;
  }

  async listUserSubscriptions(userId: string): Promise<Subscription[]> {
    return this.paymentRepository.findSubscriptionsByUserId(userId);
  }

  async cancelSubscription(subscriptionId: string, userId: string): Promise<void> {
    const subscription = await this.paymentRepository.findSubscriptionById(subscriptionId);
    
    if (!subscription) {
      throw new AppError(404, 'Subscription not found');
    }

    if (subscription.userId !== userId) {
      throw new AppError(403, 'Access denied');
    }

    await this.stripeService.cancelSubscription(subscription.stripeSubscriptionId);

    await this.paymentRepository.updateSubscription(subscriptionId, {
      status: 'canceled',
    });
  }
}
`;
  }
  generatePaymentRepository() {
    return `import { PrismaClient } from '@prisma/client';
import { Payment, CreatePaymentInput, UpdatePaymentInput, Customer, Subscription } from '../types';

const prisma = new PrismaClient();

export class PaymentRepository {
  async create(data: CreatePaymentInput): Promise<Payment> {
    return prisma.payment.create({ data });
  }

  async findById(id: string): Promise<Payment | null> {
    return prisma.payment.findUnique({ where: { id } });
  }

  async findByStripePaymentIntentId(stripePaymentIntentId: string): Promise<Payment | null> {
    return prisma.payment.findUnique({ where: { stripePaymentIntentId } });
  }

  async findByUserId(userId: string): Promise<Payment[]> {
    return prisma.payment.findMany({
      where: { userId },
      orderBy: { createdAt: 'desc' },
    });
  }

  async update(id: string, data: UpdatePaymentInput): Promise<Payment> {
    return prisma.payment.update({
      where: { id },
      data,
    });
  }

  async findCustomerByUserId(userId: string): Promise<Customer | null> {
    return prisma.customer.findUnique({ where: { userId } });
  }

  async createCustomer(data: { userId: string; stripeCustomerId: string; email: string }): Promise<Customer> {
    return prisma.customer.create({ data });
  }

  async createSubscription(data: any): Promise<Subscription> {
    return prisma.subscription.create({ data });
  }

  async findSubscriptionById(id: string): Promise<Subscription | null> {
    return prisma.subscription.findUnique({ where: { id } });
  }

  async findSubscriptionsByUserId(userId: string): Promise<Subscription[]> {
    return prisma.subscription.findMany({
      where: { userId },
      orderBy: { createdAt: 'desc' },
    });
  }

  async updateSubscription(id: string, data: any): Promise<Subscription> {
    return prisma.subscription.update({
      where: { id },
      data,
    });
  }
}
`;
  }
  generateTypes(config) {
    return `export type PaymentStatus = 'pending' | 'succeeded' | 'failed' | 'refunded' | 'canceled';

export interface Payment {
  id: string;
  userId: string;
  stripePaymentIntentId: string;
  amount: number;
  currency: string;
  status: PaymentStatus;
  metadata?: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
}

export interface CreatePaymentInput {
  userId: string;
  stripePaymentIntentId: string;
  amount: number;
  currency: string;
  status: PaymentStatus;
  metadata?: Record<string, any>;
}

export interface UpdatePaymentInput {
  status?: PaymentStatus;
  metadata?: Record<string, any>;
}

export interface CreatePaymentIntentInput {
  userId: string;
  amount: number;
  currency?: string;
  metadata?: Record<string, any>;
}
${config.enableSubscriptions ? `
export interface Customer {
  id: string;
  userId: string;
  stripeCustomerId: string;
  email: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface Subscription {
  id: string;
  userId: string;
  stripeSubscriptionId: string;
  priceId: string;
  status: string;
  currentPeriodStart: Date;
  currentPeriodEnd: Date;
  createdAt: Date;
  updatedAt: Date;
}

export interface CreateSubscriptionInput {
  userId: string;
  email: string;
  name?: string;
  priceId: string;
  metadata?: Record<string, any>;
}
` : ''}
`;
  }
  generateValidationSchemas(config) {
    return `import { z } from 'zod';

export const PaymentSchemas = {
  createIntent: z.object({
    body: z.object({
      amount: z.number().positive('Amount must be positive'),
      currency: z.string().length(3).optional(),
      metadata: z.record(z.string()).optional(),
    }),
  }),

  confirmPayment: z.object({
    body: z.object({
      paymentIntentId: z.string().min(1, 'Payment intent ID is required'),
    }),
  }),
${config.enableRefunds ? `
  refund: z.object({
    body: z.object({
      amount: z.number().positive().optional(),
      reason: z.enum(['duplicate', 'fraudulent', 'requested_by_customer']).optional(),
    }),
  }),
` : ''}${config.enableSubscriptions ? `
  createSubscription: z.object({
    body: z.object({
      email: z.string().email('Invalid email address'),
      name: z.string().optional(),
      priceId: z.string().min(1, 'Price ID is required'),
      metadata: z.record(z.string()).optional(),
    }),
  }),
` : ''}
};
`;
  }
  generatePrismaSchema(config) {
    return `generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Payment {
  id                    String   @id @default(cuid())
  userId                String
  stripePaymentIntentId String   @unique
  amount                Int
  currency              String
  status                String
  metadata              Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
  @@map("payments")
}
${config.enableSubscriptions ? `
model Customer {
  id               String   @id @default(cuid())
  userId           String   @unique
  stripeCustomerId String   @unique
  email            String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@map("customers")
}

model Subscription {
  id                   String   @id @default(cuid())
  userId               String
  stripeSubscriptionId String   @unique
  priceId              String
  status               String
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
  @@map("subscriptions")
}
` : ''}
`;
  }
  generatePackageJson(config) {
    return JSON.stringify({
      name: 'payment-service',
      version: '1.0.0',
      description: 'Stripe Payment Integration Service',
      main: 'dist/index.js',
      scripts: {
        dev: 'ts-node-dev --respawn --transpile-only src/index.ts',
        build: 'tsc',
        start: 'node dist/index.js',
        test: 'jest',
        'test:watch': 'jest --watch',
        'prisma:generate': 'prisma generate',
        'prisma:migrate': 'prisma migrate dev'
      },
      dependencies: {
        express: '^4.18.2',
        cors: '^2.8.5',
        helmet: '^7.1.0',
        zod: '^3.22.4',
        '@prisma/client': '^5.7.1',
        stripe: '^14.10.0'
      },
      devDependencies: {
        '@types/express': '^4.17.21',
        '@types/cors': '^2.8.17',
        '@types/node': '^20.10.5',
        typescript: '^5.3.3',
        'ts-node-dev': '^2.0.0',
        jest: '^29.7.0',
        '@types/jest': '^29.5.11',
        'ts-jest': '^29.1.1',
        prisma: '^5.7.1'
      }
    }, null, 2);
  }
  generateEnvExample(config) {
    return `PORT=${config.port || 3002}
NODE_ENV=development

DATABASE_URL=postgresql://user:password@localhost:5432/payment_db

STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=${config.webhookSecret || 'whsec_your_webhook_secret'}
`;
  }
  generateReadme(config) {
    return `# Payment Service

Stripe payment integration service with payment processing${config.enableSubscriptions ? ', subscription billing' : ''}${config.enableRefunds ? ', and refund functionality' : ''}.

## Features

- Payment intent creation and confirmation
- Webhook handling for payment events
${config.enableSubscriptions ? '- Subscription management\n' : ''}${config.enableRefunds ? '- Refund processing\n' : ''}- Secure payment tracking

## Installation

\`\`\`bash
npm install
\`\`\`

## Database Setup

\`\`\`bash
npx prisma migrate dev
npx prisma generate
\`\`\`

## Configuration

Copy \`.env.example\` to \`.env\` and configure:

- \`STRIPE_SECRET_KEY\`: Your Stripe secret key
- \`STRIPE_WEBHOOK_SECRET\`: Your Stripe webhook secret
- \`DATABASE_URL\`: PostgreSQL connection string

## Development

\`\`\`bash
npm run dev
\`\`\`

## Production

\`\`\`bash
npm run build
npm start
\`\`\`

## API Endpoints

### Payments
- \`POST /api/payments/intent\` - Create payment intent
- \`POST /api/payments/confirm\` - Confirm payment
- \`GET /api/payments/:id\` - Get payment by ID
- \`GET /api/payments\` - List user payments
${config.enableRefunds ? '- `POST /api/payments/:id/refund` - Refund payment\n' : ''}
${config.enableSubscriptions ? `### Subscriptions
- \`POST /api/payments/subscriptions\` - Create subscription
- \`GET /api/payments/subscriptions\` - List user subscriptions
- \`POST /api/payments/subscriptions/:id/cancel\` - Cancel subscription

` : ''}### Webhooks
- \`POST /api/webhooks/stripe\` - Stripe webhook endpoint

## Testing

\`\`\`bash
npm test
\`\`\`

## Stripe Webhook Setup

1. Install Stripe CLI: https://stripe.com/docs/stripe-cli
2. Forward webhooks to local server:
   \`\`\`bash
   stripe listen --forward-to localhost:${config.port || 3002}/api/webhooks/stripe
   \`\`\`
3. Copy the webhook signing secret to your \`.env\` file
`;
  }
}
exports.PaymentServiceComponent = PaymentServiceComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiUGF5bWVudFNlcnZpY2VDb21wb25lbnQiLCJnZW5lcmF0ZVBheW1lbnRTZXJ2aWNlIiwiY29uZmlnIiwib3V0cHV0RGlyIiwiY2hhbmdlcyIsInNlcnZpY2VOYW1lIiwic2VydmljZURpciIsImpvaW4iLCJwdXNoIiwidHlwZSIsImNvbnRlbnQiLCJnZW5lcmF0ZUluZGV4RmlsZSIsImdlbmVyYXRlUGF5bWVudENvbnRyb2xsZXIiLCJnZW5lcmF0ZVdlYmhvb2tDb250cm9sbGVyIiwiZ2VuZXJhdGVTdHJpcGVTZXJ2aWNlIiwiZ2VuZXJhdGVQYXltZW50U2VydmljZUZpbGUiLCJlbmFibGVTdWJzY3JpcHRpb25zIiwiZ2VuZXJhdGVTdWJzY3JpcHRpb25TZXJ2aWNlIiwiZ2VuZXJhdGVQYXltZW50UmVwb3NpdG9yeSIsImdlbmVyYXRlVHlwZXMiLCJnZW5lcmF0ZVZhbGlkYXRpb25TY2hlbWFzIiwiZ2VuZXJhdGVQcmlzbWFTY2hlbWEiLCJnZW5lcmF0ZVBhY2thZ2VKc29uIiwiZ2VuZXJhdGVFbnZFeGFtcGxlIiwiZ2VuZXJhdGVSZWFkbWUiLCJwb3J0IiwiZW5hYmxlUmVmdW5kcyIsInN0cmlwZUFwaVZlcnNpb24iLCJKU09OIiwic3RyaW5naWZ5IiwibmFtZSIsInZlcnNpb24iLCJkZXNjcmlwdGlvbiIsIm1haW4iLCJzY3JpcHRzIiwiZGV2IiwiYnVpbGQiLCJzdGFydCIsInRlc3QiLCJkZXBlbmRlbmNpZXMiLCJleHByZXNzIiwiY29ycyIsImhlbG1ldCIsInpvZCIsInN0cmlwZSIsImRldkRlcGVuZGVuY2llcyIsInR5cGVzY3JpcHQiLCJqZXN0IiwicHJpc21hIiwid2ViaG9va1NlY3JldCIsImV4cG9ydHMiXSwic291cmNlcyI6WyJQYXltZW50U2VydmljZUNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRmlsZUNoYW5nZSB9IGZyb20gJy4uL0NoYW5nZXNldE1hbmFnZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBheW1lbnRTZXJ2aWNlQ29uZmlnIHtcbiAgbmFtZTogc3RyaW5nO1xuICBwb3J0PzogbnVtYmVyO1xuICBzdHJpcGVBcGlWZXJzaW9uPzogc3RyaW5nO1xuICBlbmFibGVTdWJzY3JpcHRpb25zPzogYm9vbGVhbjtcbiAgZW5hYmxlUmVmdW5kcz86IGJvb2xlYW47XG4gIHdlYmhvb2tTZWNyZXQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBQYXltZW50U2VydmljZUNvbXBvbmVudCB7XG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb21wbGV0ZSBTdHJpcGUgcGF5bWVudCBpbnRlZ3JhdGlvblxuICAgKi9cbiAgZ2VuZXJhdGVQYXltZW50U2VydmljZShjb25maWc6IFBheW1lbnRTZXJ2aWNlQ29uZmlnLCBvdXRwdXREaXI6IHN0cmluZyk6IEZpbGVDaGFuZ2VbXSB7XG4gICAgY29uc3QgY2hhbmdlczogRmlsZUNoYW5nZVtdID0gW107XG4gICAgY29uc3Qgc2VydmljZU5hbWUgPSAncGF5bWVudC1zZXJ2aWNlJztcbiAgICBjb25zdCBzZXJ2aWNlRGlyID0gcGF0aC5qb2luKG91dHB1dERpciwgJ3NlcnZpY2VzJywgc2VydmljZU5hbWUpO1xuXG4gICAgLy8gTWFpbiBzZXJ2aWNlIGZpbGVcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAnaW5kZXgudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZUluZGV4RmlsZShjb25maWcpLFxuICAgIH0pO1xuXG4gICAgLy8gQ29udHJvbGxlcnNcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAnY29udHJvbGxlcnMnLCAncGF5bWVudC5jb250cm9sbGVyLnRzJyksXG4gICAgICB0eXBlOiAnY3JlYXRlJyxcbiAgICAgIGNvbnRlbnQ6IHRoaXMuZ2VuZXJhdGVQYXltZW50Q29udHJvbGxlcihjb25maWcpLFxuICAgIH0pO1xuXG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAnc3JjJywgJ2NvbnRyb2xsZXJzJywgJ3dlYmhvb2suY29udHJvbGxlci50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlV2ViaG9va0NvbnRyb2xsZXIoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIC8vIFNlcnZpY2VzXG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAnc3JjJywgJ3NlcnZpY2VzJywgJ3N0cmlwZS5zZXJ2aWNlLnRzJyksXG4gICAgICB0eXBlOiAnY3JlYXRlJyxcbiAgICAgIGNvbnRlbnQ6IHRoaXMuZ2VuZXJhdGVTdHJpcGVTZXJ2aWNlKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAnc2VydmljZXMnLCAncGF5bWVudC5zZXJ2aWNlLnRzJyksXG4gICAgICB0eXBlOiAnY3JlYXRlJyxcbiAgICAgIGNvbnRlbnQ6IHRoaXMuZ2VuZXJhdGVQYXltZW50U2VydmljZUZpbGUoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIGlmIChjb25maWcuZW5hYmxlU3Vic2NyaXB0aW9ucykge1xuICAgICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAnc2VydmljZXMnLCAnc3Vic2NyaXB0aW9uLnNlcnZpY2UudHMnKSxcbiAgICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICAgIGNvbnRlbnQ6IHRoaXMuZ2VuZXJhdGVTdWJzY3JpcHRpb25TZXJ2aWNlKCksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZXBvc2l0b3J5XG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAnc3JjJywgJ3JlcG9zaXRvcmllcycsICdwYXltZW50LnJlcG9zaXRvcnkudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZVBheW1lbnRSZXBvc2l0b3J5KCksXG4gICAgfSk7XG5cbiAgICAvLyBUeXBlc1xuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICd0eXBlcycsICdpbmRleC50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlVHlwZXMoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIC8vIFZhbGlkYXRpb24gc2NoZW1hc1xuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICd2YWxpZGF0aW9uJywgJ3BheW1lbnQuc2NoZW1hcy50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlVmFsaWRhdGlvblNjaGVtYXMoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIC8vIFByaXNtYSBzY2hlbWFcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdwcmlzbWEnLCAnc2NoZW1hLnByaXNtYScpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlUHJpc21hU2NoZW1hKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICAvLyBDb25maWd1cmF0aW9uIGZpbGVzXG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAncGFja2FnZS5qc29uJyksXG4gICAgICB0eXBlOiAnY3JlYXRlJyxcbiAgICAgIGNvbnRlbnQ6IHRoaXMuZ2VuZXJhdGVQYWNrYWdlSnNvbihjb25maWcpLFxuICAgIH0pO1xuXG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAnLmVudi5leGFtcGxlJyksXG4gICAgICB0eXBlOiAnY3JlYXRlJyxcbiAgICAgIGNvbnRlbnQ6IHRoaXMuZ2VuZXJhdGVFbnZFeGFtcGxlKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdSRUFETUUubWQnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZVJlYWRtZShjb25maWcpLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNoYW5nZXM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlSW5kZXhGaWxlKGNvbmZpZzogUGF5bWVudFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHBvcnQgPSBjb25maWcucG9ydCB8fCAzMDAyO1xuICAgIHJldHVybiBgaW1wb3J0IGV4cHJlc3MsIHsgQXBwbGljYXRpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBjb3JzIGZyb20gJ2NvcnMnO1xuaW1wb3J0IGhlbG1ldCBmcm9tICdoZWxtZXQnO1xuaW1wb3J0IHsgUGF5bWVudENvbnRyb2xsZXIgfSBmcm9tICcuL2NvbnRyb2xsZXJzL3BheW1lbnQuY29udHJvbGxlcic7XG5pbXBvcnQgeyBXZWJob29rQ29udHJvbGxlciB9IGZyb20gJy4vY29udHJvbGxlcnMvd2ViaG9vay5jb250cm9sbGVyJztcbmltcG9ydCB7IGVycm9ySGFuZGxlciB9IGZyb20gJy4vbWlkZGxld2FyZS9lcnJvci1oYW5kbGVyJztcblxuY29uc3QgYXBwOiBBcHBsaWNhdGlvbiA9IGV4cHJlc3MoKTtcbmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8ICR7cG9ydH07XG5cbi8vIE1pZGRsZXdhcmVcbmFwcC51c2UoaGVsbWV0KCkpO1xuYXBwLnVzZShjb3JzKCkpO1xuXG4vLyBXZWJob29rIGVuZHBvaW50IG5lZWRzIHJhdyBib2R5XG5hcHAudXNlKCcvYXBpL3dlYmhvb2tzJywgZXhwcmVzcy5yYXcoeyB0eXBlOiAnYXBwbGljYXRpb24vanNvbicgfSkpO1xuXG4vLyBKU09OIHBhcnNpbmcgZm9yIG90aGVyIHJvdXRlc1xuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5hcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcblxuLy8gSGVhbHRoIGNoZWNrXG5hcHAuZ2V0KCcvaGVhbHRoJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5qc29uKHsgc3RhdHVzOiAnaGVhbHRoeScsIHNlcnZpY2U6ICdwYXltZW50LXNlcnZpY2UnIH0pO1xufSk7XG5cbi8vIFJvdXRlc1xuY29uc3QgcGF5bWVudENvbnRyb2xsZXIgPSBuZXcgUGF5bWVudENvbnRyb2xsZXIoKTtcbmNvbnN0IHdlYmhvb2tDb250cm9sbGVyID0gbmV3IFdlYmhvb2tDb250cm9sbGVyKCk7XG5cbmFwcC51c2UoJy9hcGkvcGF5bWVudHMnLCBwYXltZW50Q29udHJvbGxlci5yb3V0ZXIpO1xuYXBwLnVzZSgnL2FwaS93ZWJob29rcycsIHdlYmhvb2tDb250cm9sbGVyLnJvdXRlcik7XG5cbi8vIEVycm9yIGhhbmRsaW5nXG5hcHAudXNlKGVycm9ySGFuZGxlcik7XG5cbi8vIFN0YXJ0IHNlcnZlclxuYXBwLmxpc3RlbihQT1JULCAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKFxcYFBheW1lbnQgc2VydmljZSBydW5uaW5nIG9uIHBvcnQgXFwke1BPUlR9XFxgKTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBhcHA7XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVBheW1lbnRDb250cm9sbGVyKGNvbmZpZzogUGF5bWVudFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaW1wb3J0IHsgUm91dGVyLCBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBQYXltZW50U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BheW1lbnQuc2VydmljZSc7XG4ke2NvbmZpZy5lbmFibGVTdWJzY3JpcHRpb25zID8gXCJpbXBvcnQgeyBTdWJzY3JpcHRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvc3Vic2NyaXB0aW9uLnNlcnZpY2UnO1wiIDogJyd9XG5pbXBvcnQgeyB2YWxpZGF0ZSB9IGZyb20gJy4uL21pZGRsZXdhcmUvdmFsaWRhdGlvbic7XG5pbXBvcnQgeyBQYXltZW50U2NoZW1hcyB9IGZyb20gJy4uL3ZhbGlkYXRpb24vcGF5bWVudC5zY2hlbWFzJztcbmltcG9ydCB7IGF1dGhNaWRkbGV3YXJlIH0gZnJvbSAnLi4vbWlkZGxld2FyZS9hdXRoLm1pZGRsZXdhcmUnO1xuXG5leHBvcnQgY2xhc3MgUGF5bWVudENvbnRyb2xsZXIge1xuICBwdWJsaWMgcm91dGVyOiBSb3V0ZXI7XG4gIHByaXZhdGUgcGF5bWVudFNlcnZpY2U6IFBheW1lbnRTZXJ2aWNlO1xuJHtjb25maWcuZW5hYmxlU3Vic2NyaXB0aW9ucyA/ICcgIHByaXZhdGUgc3Vic2NyaXB0aW9uU2VydmljZTogU3Vic2NyaXB0aW9uU2VydmljZTsnIDogJyd9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5yb3V0ZXIgPSBSb3V0ZXIoKTtcbiAgICB0aGlzLnBheW1lbnRTZXJ2aWNlID0gbmV3IFBheW1lbnRTZXJ2aWNlKCk7XG4ke2NvbmZpZy5lbmFibGVTdWJzY3JpcHRpb25zID8gJyAgICB0aGlzLnN1YnNjcmlwdGlvblNlcnZpY2UgPSBuZXcgU3Vic2NyaXB0aW9uU2VydmljZSgpOycgOiAnJ31cbiAgICB0aGlzLmluaXRpYWxpemVSb3V0ZXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVJvdXRlcygpOiB2b2lkIHtcbiAgICAvLyBDcmVhdGUgcGF5bWVudCBpbnRlbnRcbiAgICB0aGlzLnJvdXRlci5wb3N0KFxuICAgICAgJy9pbnRlbnQnLFxuICAgICAgYXV0aE1pZGRsZXdhcmUsXG4gICAgICB2YWxpZGF0ZShQYXltZW50U2NoZW1hcy5jcmVhdGVJbnRlbnQpLFxuICAgICAgdGhpcy5jcmVhdGVQYXltZW50SW50ZW50LmJpbmQodGhpcylcbiAgICApO1xuICAgIFxuICAgIC8vIENvbmZpcm0gcGF5bWVudFxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICAnL2NvbmZpcm0nLFxuICAgICAgYXV0aE1pZGRsZXdhcmUsXG4gICAgICB2YWxpZGF0ZShQYXltZW50U2NoZW1hcy5jb25maXJtUGF5bWVudCksXG4gICAgICB0aGlzLmNvbmZpcm1QYXltZW50LmJpbmQodGhpcylcbiAgICApO1xuICAgIFxuICAgIC8vIEdldCBwYXltZW50IGJ5IElEXG4gICAgdGhpcy5yb3V0ZXIuZ2V0KCcvOmlkJywgYXV0aE1pZGRsZXdhcmUsIHRoaXMuZ2V0UGF5bWVudC5iaW5kKHRoaXMpKTtcbiAgICBcbiAgICAvLyBMaXN0IHVzZXIgcGF5bWVudHNcbiAgICB0aGlzLnJvdXRlci5nZXQoJy8nLCBhdXRoTWlkZGxld2FyZSwgdGhpcy5saXN0UGF5bWVudHMuYmluZCh0aGlzKSk7XG4ke2NvbmZpZy5lbmFibGVSZWZ1bmRzID8gYFxuICAgIC8vIFJlZnVuZCBwYXltZW50XG4gICAgdGhpcy5yb3V0ZXIucG9zdChcbiAgICAgICcvOmlkL3JlZnVuZCcsXG4gICAgICBhdXRoTWlkZGxld2FyZSxcbiAgICAgIHZhbGlkYXRlKFBheW1lbnRTY2hlbWFzLnJlZnVuZCksXG4gICAgICB0aGlzLnJlZnVuZFBheW1lbnQuYmluZCh0aGlzKVxuICAgICk7XG5gIDogJyd9JHtjb25maWcuZW5hYmxlU3Vic2NyaXB0aW9ucyA/IGBcbiAgICAvLyBTdWJzY3JpcHRpb24gZW5kcG9pbnRzXG4gICAgdGhpcy5yb3V0ZXIucG9zdChcbiAgICAgICcvc3Vic2NyaXB0aW9ucycsXG4gICAgICBhdXRoTWlkZGxld2FyZSxcbiAgICAgIHZhbGlkYXRlKFBheW1lbnRTY2hlbWFzLmNyZWF0ZVN1YnNjcmlwdGlvbiksXG4gICAgICB0aGlzLmNyZWF0ZVN1YnNjcmlwdGlvbi5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICBcbiAgICB0aGlzLnJvdXRlci5nZXQoJy9zdWJzY3JpcHRpb25zJywgYXV0aE1pZGRsZXdhcmUsIHRoaXMubGlzdFN1YnNjcmlwdGlvbnMuYmluZCh0aGlzKSk7XG4gICAgXG4gICAgdGhpcy5yb3V0ZXIucG9zdChcbiAgICAgICcvc3Vic2NyaXB0aW9ucy86aWQvY2FuY2VsJyxcbiAgICAgIGF1dGhNaWRkbGV3YXJlLFxuICAgICAgdGhpcy5jYW5jZWxTdWJzY3JpcHRpb24uYmluZCh0aGlzKVxuICAgICk7XG5gIDogJyd9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZVBheW1lbnRJbnRlbnQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5jcmVhdGVQYXltZW50SW50ZW50KHtcbiAgICAgICAgLi4ucmVxLmJvZHksXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXIhLnVzZXJJZCxcbiAgICAgIH0pO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY29uZmlybVBheW1lbnQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5jb25maXJtUGF5bWVudChyZXEuYm9keS5wYXltZW50SW50ZW50SWQpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0UGF5bWVudChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXltZW50ID0gYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5nZXRQYXltZW50KHJlcS5wYXJhbXMuaWQsIHJlcS51c2VyIS51c2VySWQpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBwYXltZW50IH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxpc3RQYXltZW50cyhyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXltZW50cyA9IGF3YWl0IHRoaXMucGF5bWVudFNlcnZpY2UubGlzdFVzZXJQYXltZW50cyhyZXEudXNlciEudXNlcklkKTtcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogcGF5bWVudHMgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuJHtjb25maWcuZW5hYmxlUmVmdW5kcyA/IGBcbiAgcHJpdmF0ZSBhc3luYyByZWZ1bmRQYXltZW50KHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGF5bWVudFNlcnZpY2UucmVmdW5kUGF5bWVudChcbiAgICAgICAgcmVxLnBhcmFtcy5pZCxcbiAgICAgICAgcmVxLnVzZXIhLnVzZXJJZCxcbiAgICAgICAgcmVxLmJvZHkuYW1vdW50LFxuICAgICAgICByZXEuYm9keS5yZWFzb25cbiAgICAgICk7XG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHJlc3VsdCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5gIDogJyd9JHtjb25maWcuZW5hYmxlU3Vic2NyaXB0aW9ucyA/IGBcbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVTdWJzY3JpcHRpb24ocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdWJzY3JpcHRpb25TZXJ2aWNlLmNyZWF0ZVN1YnNjcmlwdGlvbih7XG4gICAgICAgIC4uLnJlcS5ib2R5LFxuICAgICAgICB1c2VySWQ6IHJlcS51c2VyIS51c2VySWQsXG4gICAgICB9KTtcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogcmVzdWx0IH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxpc3RTdWJzY3JpcHRpb25zKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBhd2FpdCB0aGlzLnN1YnNjcmlwdGlvblNlcnZpY2UubGlzdFVzZXJTdWJzY3JpcHRpb25zKHJlcS51c2VyIS51c2VySWQpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBzdWJzY3JpcHRpb25zIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbmNlbFN1YnNjcmlwdGlvbihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnN1YnNjcmlwdGlvblNlcnZpY2UuY2FuY2VsU3Vic2NyaXB0aW9uKHJlcS5wYXJhbXMuaWQsIHJlcS51c2VyIS51c2VySWQpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnU3Vic2NyaXB0aW9uIGNhbmNlbGxlZCcgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuYCA6ICcnfVxufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVXZWJob29rQ29udHJvbGxlcihjb25maWc6IFBheW1lbnRTZXJ2aWNlQ29uZmlnKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgU3RyaXBlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3N0cmlwZS5zZXJ2aWNlJztcbmltcG9ydCB7IFBheW1lbnRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcGF5bWVudC5zZXJ2aWNlJztcblxuZXhwb3J0IGNsYXNzIFdlYmhvb2tDb250cm9sbGVyIHtcbiAgcHVibGljIHJvdXRlcjogUm91dGVyO1xuICBwcml2YXRlIHN0cmlwZVNlcnZpY2U6IFN0cmlwZVNlcnZpY2U7XG4gIHByaXZhdGUgcGF5bWVudFNlcnZpY2U6IFBheW1lbnRTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMucm91dGVyID0gUm91dGVyKCk7XG4gICAgdGhpcy5zdHJpcGVTZXJ2aWNlID0gbmV3IFN0cmlwZVNlcnZpY2UoKTtcbiAgICB0aGlzLnBheW1lbnRTZXJ2aWNlID0gbmV3IFBheW1lbnRTZXJ2aWNlKCk7XG4gICAgdGhpcy5pbml0aWFsaXplUm91dGVzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVSb3V0ZXMoKTogdm9pZCB7XG4gICAgdGhpcy5yb3V0ZXIucG9zdCgnL3N0cmlwZScsIHRoaXMuaGFuZGxlU3RyaXBlV2ViaG9vay5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlU3RyaXBlV2ViaG9vayhyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzaWduYXR1cmUgPSByZXEuaGVhZGVyc1snc3RyaXBlLXNpZ25hdHVyZSddIGFzIHN0cmluZztcbiAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5zdHJpcGVTZXJ2aWNlLmNvbnN0cnVjdFdlYmhvb2tFdmVudChyZXEuYm9keSwgc2lnbmF0dXJlKTtcblxuICAgICAgLy8gSGFuZGxlIGRpZmZlcmVudCBldmVudCB0eXBlc1xuICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICAgIGNhc2UgJ3BheW1lbnRfaW50ZW50LnN1Y2NlZWRlZCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5oYW5kbGVQYXltZW50U3VjY2VzcyhldmVudC5kYXRhLm9iamVjdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBjYXNlICdwYXltZW50X2ludGVudC5wYXltZW50X2ZhaWxlZCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5oYW5kbGVQYXltZW50RmFpbHVyZShldmVudC5kYXRhLm9iamVjdCk7XG4gICAgICAgICAgYnJlYWs7XG4ke2NvbmZpZy5lbmFibGVTdWJzY3JpcHRpb25zID8gYFxuICAgICAgICBjYXNlICdjdXN0b21lci5zdWJzY3JpcHRpb24uY3JlYXRlZCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5oYW5kbGVTdWJzY3JpcHRpb25DcmVhdGVkKGV2ZW50LmRhdGEub2JqZWN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ2N1c3RvbWVyLnN1YnNjcmlwdGlvbi51cGRhdGVkJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnBheW1lbnRTZXJ2aWNlLmhhbmRsZVN1YnNjcmlwdGlvblVwZGF0ZWQoZXZlbnQuZGF0YS5vYmplY3QpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAnY3VzdG9tZXIuc3Vic2NyaXB0aW9uLmRlbGV0ZWQnOlxuICAgICAgICAgIGF3YWl0IHRoaXMucGF5bWVudFNlcnZpY2UuaGFuZGxlU3Vic2NyaXB0aW9uQ2FuY2VsbGVkKGV2ZW50LmRhdGEub2JqZWN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ2ludm9pY2UucGF5bWVudF9zdWNjZWVkZWQnOlxuICAgICAgICAgIGF3YWl0IHRoaXMucGF5bWVudFNlcnZpY2UuaGFuZGxlSW52b2ljZVBheW1lbnRTdWNjZWVkZWQoZXZlbnQuZGF0YS5vYmplY3QpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAnaW52b2ljZS5wYXltZW50X2ZhaWxlZCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5wYXltZW50U2VydmljZS5oYW5kbGVJbnZvaWNlUGF5bWVudEZhaWxlZChldmVudC5kYXRhLm9iamVjdCk7XG4gICAgICAgICAgYnJlYWs7XG5gIDogJyd9JHtjb25maWcuZW5hYmxlUmVmdW5kcyA/IGBcbiAgICAgICAgY2FzZSAnY2hhcmdlLnJlZnVuZGVkJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnBheW1lbnRTZXJ2aWNlLmhhbmRsZVJlZnVuZChldmVudC5kYXRhLm9iamVjdCk7XG4gICAgICAgICAgYnJlYWs7XG5gIDogJyd9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgY29uc29sZS5sb2coXFxgVW5oYW5kbGVkIGV2ZW50IHR5cGU6IFxcJHtldmVudC50eXBlfVxcYCk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHsgcmVjZWl2ZWQ6IHRydWUgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVTdHJpcGVTZXJ2aWNlKGNvbmZpZzogUGF5bWVudFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaW1wb3J0IFN0cmlwZSBmcm9tICdzdHJpcGUnO1xuaW1wb3J0IHsgQXBwRXJyb3IgfSBmcm9tICcuLi9taWRkbGV3YXJlL2Vycm9yLWhhbmRsZXInO1xuXG5leHBvcnQgY2xhc3MgU3RyaXBlU2VydmljZSB7XG4gIHByaXZhdGUgc3RyaXBlOiBTdHJpcGU7XG4gIHByaXZhdGUgd2ViaG9va1NlY3JldDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZO1xuICAgIGlmICghYXBpS2V5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NUUklQRV9TRUNSRVRfS0VZIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy5zdHJpcGUgPSBuZXcgU3RyaXBlKGFwaUtleSwge1xuICAgICAgYXBpVmVyc2lvbjogJyR7Y29uZmlnLnN0cmlwZUFwaVZlcnNpb24gfHwgJzIwMjMtMTAtMTYnfScsXG4gICAgfSk7XG5cbiAgICB0aGlzLndlYmhvb2tTZWNyZXQgPSBwcm9jZXNzLmVudi5TVFJJUEVfV0VCSE9PS19TRUNSRVQgfHwgJyc7XG4gIH1cblxuICBhc3luYyBjcmVhdGVQYXltZW50SW50ZW50KGFtb3VudDogbnVtYmVyLCBjdXJyZW5jeTogc3RyaW5nLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBQcm9taXNlPFN0cmlwZS5QYXltZW50SW50ZW50PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBheW1lbnRJbnRlbnRzLmNyZWF0ZSh7XG4gICAgICBhbW91bnQsXG4gICAgICBjdXJyZW5jeSxcbiAgICAgIG1ldGFkYXRhLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY29uZmlybVBheW1lbnRJbnRlbnQocGF5bWVudEludGVudElkOiBzdHJpbmcpOiBQcm9taXNlPFN0cmlwZS5QYXltZW50SW50ZW50PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBheW1lbnRJbnRlbnRzLmNvbmZpcm0ocGF5bWVudEludGVudElkKTtcbiAgfVxuXG4gIGFzeW5jIHJldHJpZXZlUGF5bWVudEludGVudChwYXltZW50SW50ZW50SWQ6IHN0cmluZyk6IFByb21pc2U8U3RyaXBlLlBheW1lbnRJbnRlbnQ+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGF5bWVudEludGVudHMucmV0cmlldmUocGF5bWVudEludGVudElkKTtcbiAgfVxuJHtjb25maWcuZW5hYmxlUmVmdW5kcyA/IGBcbiAgYXN5bmMgY3JlYXRlUmVmdW5kKHBheW1lbnRJbnRlbnRJZDogc3RyaW5nLCBhbW91bnQ/OiBudW1iZXIsIHJlYXNvbj86IHN0cmluZyk6IFByb21pc2U8U3RyaXBlLlJlZnVuZD4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5yZWZ1bmRzLmNyZWF0ZSh7XG4gICAgICBwYXltZW50X2ludGVudDogcGF5bWVudEludGVudElkLFxuICAgICAgYW1vdW50LFxuICAgICAgcmVhc29uOiByZWFzb24gYXMgU3RyaXBlLlJlZnVuZENyZWF0ZVBhcmFtcy5SZWFzb24sXG4gICAgfSk7XG4gIH1cbmAgOiAnJ30ke2NvbmZpZy5lbmFibGVTdWJzY3JpcHRpb25zID8gYFxuICBhc3luYyBjcmVhdGVDdXN0b21lcihlbWFpbDogc3RyaW5nLCBuYW1lPzogc3RyaW5nLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBQcm9taXNlPFN0cmlwZS5DdXN0b21lcj4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5jdXN0b21lcnMuY3JlYXRlKHtcbiAgICAgIGVtYWlsLFxuICAgICAgbmFtZSxcbiAgICAgIG1ldGFkYXRhLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlU3Vic2NyaXB0aW9uKGN1c3RvbWVySWQ6IHN0cmluZywgcHJpY2VJZDogc3RyaW5nLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBQcm9taXNlPFN0cmlwZS5TdWJzY3JpcHRpb24+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUuc3Vic2NyaXB0aW9ucy5jcmVhdGUoe1xuICAgICAgY3VzdG9tZXI6IGN1c3RvbWVySWQsXG4gICAgICBpdGVtczogW3sgcHJpY2U6IHByaWNlSWQgfV0sXG4gICAgICBtZXRhZGF0YSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNhbmNlbFN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxTdHJpcGUuU3Vic2NyaXB0aW9uPiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnN1YnNjcmlwdGlvbnMuY2FuY2VsKHN1YnNjcmlwdGlvbklkKTtcbiAgfVxuXG4gIGFzeW5jIHJldHJpZXZlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPFN0cmlwZS5TdWJzY3JpcHRpb24+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUuc3Vic2NyaXB0aW9ucy5yZXRyaWV2ZShzdWJzY3JpcHRpb25JZCk7XG4gIH1cbmAgOiAnJ31cbiAgY29uc3RydWN0V2ViaG9va0V2ZW50KHBheWxvYWQ6IEJ1ZmZlciwgc2lnbmF0dXJlOiBzdHJpbmcpOiBTdHJpcGUuRXZlbnQge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gdGhpcy5zdHJpcGUud2ViaG9va3MuY29uc3RydWN0RXZlbnQocGF5bG9hZCwgc2lnbmF0dXJlLCB0aGlzLndlYmhvb2tTZWNyZXQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAwLCAnSW52YWxpZCB3ZWJob29rIHNpZ25hdHVyZScpO1xuICAgIH1cbiAgfVxufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVQYXltZW50U2VydmljZUZpbGUoY29uZmlnOiBQYXltZW50U2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBpbXBvcnQgeyBTdHJpcGVTZXJ2aWNlIH0gZnJvbSAnLi9zdHJpcGUuc2VydmljZSc7XG5pbXBvcnQgeyBQYXltZW50UmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcmllcy9wYXltZW50LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgQXBwRXJyb3IgfSBmcm9tICcuLi9taWRkbGV3YXJlL2Vycm9yLWhhbmRsZXInO1xuaW1wb3J0IHsgUGF5bWVudCwgUGF5bWVudFN0YXR1cywgQ3JlYXRlUGF5bWVudEludGVudElucHV0IH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgUGF5bWVudFNlcnZpY2Uge1xuICBwcml2YXRlIHN0cmlwZVNlcnZpY2U6IFN0cmlwZVNlcnZpY2U7XG4gIHByaXZhdGUgcGF5bWVudFJlcG9zaXRvcnk6IFBheW1lbnRSZXBvc2l0b3J5O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RyaXBlU2VydmljZSA9IG5ldyBTdHJpcGVTZXJ2aWNlKCk7XG4gICAgdGhpcy5wYXltZW50UmVwb3NpdG9yeSA9IG5ldyBQYXltZW50UmVwb3NpdG9yeSgpO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlUGF5bWVudEludGVudChpbnB1dDogQ3JlYXRlUGF5bWVudEludGVudElucHV0KTogUHJvbWlzZTxQYXltZW50PiB7XG4gICAgY29uc3QgcGF5bWVudEludGVudCA9IGF3YWl0IHRoaXMuc3RyaXBlU2VydmljZS5jcmVhdGVQYXltZW50SW50ZW50KFxuICAgICAgaW5wdXQuYW1vdW50LFxuICAgICAgaW5wdXQuY3VycmVuY3kgfHwgJ3VzZCcsXG4gICAgICB7XG4gICAgICAgIHVzZXJJZDogaW5wdXQudXNlcklkLFxuICAgICAgICAuLi5pbnB1dC5tZXRhZGF0YSxcbiAgICAgIH1cbiAgICApO1xuXG4gICAgY29uc3QgcGF5bWVudCA9IGF3YWl0IHRoaXMucGF5bWVudFJlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgIHVzZXJJZDogaW5wdXQudXNlcklkLFxuICAgICAgc3RyaXBlUGF5bWVudEludGVudElkOiBwYXltZW50SW50ZW50LmlkLFxuICAgICAgYW1vdW50OiBpbnB1dC5hbW91bnQsXG4gICAgICBjdXJyZW5jeTogaW5wdXQuY3VycmVuY3kgfHwgJ3VzZCcsXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIG1ldGFkYXRhOiBpbnB1dC5tZXRhZGF0YSxcbiAgICB9KTtcblxuICAgIHJldHVybiBwYXltZW50O1xuICB9XG5cbiAgYXN5bmMgY29uZmlybVBheW1lbnQocGF5bWVudEludGVudElkOiBzdHJpbmcpOiBQcm9taXNlPFBheW1lbnQ+IHtcbiAgICBjb25zdCBwYXltZW50SW50ZW50ID0gYXdhaXQgdGhpcy5zdHJpcGVTZXJ2aWNlLmNvbmZpcm1QYXltZW50SW50ZW50KHBheW1lbnRJbnRlbnRJZCk7XG4gICAgXG4gICAgY29uc3QgcGF5bWVudCA9IGF3YWl0IHRoaXMucGF5bWVudFJlcG9zaXRvcnkuZmluZEJ5U3RyaXBlUGF5bWVudEludGVudElkKHBheW1lbnRJbnRlbnRJZCk7XG4gICAgaWYgKCFwYXltZW50KSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDA0LCAnUGF5bWVudCBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYXltZW50UmVwb3NpdG9yeS51cGRhdGUocGF5bWVudC5pZCwge1xuICAgICAgc3RhdHVzOiBwYXltZW50SW50ZW50LnN0YXR1cyBhcyBQYXltZW50U3RhdHVzLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0UGF5bWVudChwYXltZW50SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFBheW1lbnQ+IHtcbiAgICBjb25zdCBwYXltZW50ID0gYXdhaXQgdGhpcy5wYXltZW50UmVwb3NpdG9yeS5maW5kQnlJZChwYXltZW50SWQpO1xuICAgIFxuICAgIGlmICghcGF5bWVudCkge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKDQwNCwgJ1BheW1lbnQgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgaWYgKHBheW1lbnQudXNlcklkICE9PSB1c2VySWQpIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDMsICdBY2Nlc3MgZGVuaWVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBheW1lbnQ7XG4gIH1cblxuICBhc3luYyBsaXN0VXNlclBheW1lbnRzKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxQYXltZW50W10+IHtcbiAgICByZXR1cm4gdGhpcy5wYXltZW50UmVwb3NpdG9yeS5maW5kQnlVc2VySWQodXNlcklkKTtcbiAgfVxuJHtjb25maWcuZW5hYmxlUmVmdW5kcyA/IGBcbiAgYXN5bmMgcmVmdW5kUGF5bWVudChwYXltZW50SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIGFtb3VudD86IG51bWJlciwgcmVhc29uPzogc3RyaW5nKTogUHJvbWlzZTxQYXltZW50PiB7XG4gICAgY29uc3QgcGF5bWVudCA9IGF3YWl0IHRoaXMuZ2V0UGF5bWVudChwYXltZW50SWQsIHVzZXJJZCk7XG5cbiAgICBpZiAocGF5bWVudC5zdGF0dXMgIT09ICdzdWNjZWVkZWQnKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAwLCAnQ2FuIG9ubHkgcmVmdW5kIHN1Y2Nlc3NmdWwgcGF5bWVudHMnKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnN0cmlwZVNlcnZpY2UuY3JlYXRlUmVmdW5kKHBheW1lbnQuc3RyaXBlUGF5bWVudEludGVudElkLCBhbW91bnQsIHJlYXNvbik7XG5cbiAgICByZXR1cm4gdGhpcy5wYXltZW50UmVwb3NpdG9yeS51cGRhdGUocGF5bWVudC5pZCwge1xuICAgICAgc3RhdHVzOiAncmVmdW5kZWQnLFxuICAgIH0pO1xuICB9XG5gIDogJyd9XG4gIGFzeW5jIGhhbmRsZVBheW1lbnRTdWNjZXNzKHBheW1lbnRJbnRlbnQ6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHBheW1lbnQgPSBhd2FpdCB0aGlzLnBheW1lbnRSZXBvc2l0b3J5LmZpbmRCeVN0cmlwZVBheW1lbnRJbnRlbnRJZChwYXltZW50SW50ZW50LmlkKTtcbiAgICBpZiAocGF5bWVudCkge1xuICAgICAgYXdhaXQgdGhpcy5wYXltZW50UmVwb3NpdG9yeS51cGRhdGUocGF5bWVudC5pZCwge1xuICAgICAgICBzdGF0dXM6ICdzdWNjZWVkZWQnLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlUGF5bWVudEZhaWx1cmUocGF5bWVudEludGVudDogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcGF5bWVudCA9IGF3YWl0IHRoaXMucGF5bWVudFJlcG9zaXRvcnkuZmluZEJ5U3RyaXBlUGF5bWVudEludGVudElkKHBheW1lbnRJbnRlbnQuaWQpO1xuICAgIGlmIChwYXltZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnBheW1lbnRSZXBvc2l0b3J5LnVwZGF0ZShwYXltZW50LmlkLCB7XG4gICAgICAgIHN0YXR1czogJ2ZhaWxlZCcsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiR7Y29uZmlnLmVuYWJsZVN1YnNjcmlwdGlvbnMgPyBgXG4gIGFzeW5jIGhhbmRsZVN1YnNjcmlwdGlvbkNyZWF0ZWQoc3Vic2NyaXB0aW9uOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBIYW5kbGUgc3Vic2NyaXB0aW9uIGNyZWF0aW9uXG4gICAgY29uc29sZS5sb2coJ1N1YnNjcmlwdGlvbiBjcmVhdGVkOicsIHN1YnNjcmlwdGlvbi5pZCk7XG4gIH1cblxuICBhc3luYyBoYW5kbGVTdWJzY3JpcHRpb25VcGRhdGVkKHN1YnNjcmlwdGlvbjogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gSGFuZGxlIHN1YnNjcmlwdGlvbiB1cGRhdGVcbiAgICBjb25zb2xlLmxvZygnU3Vic2NyaXB0aW9uIHVwZGF0ZWQ6Jywgc3Vic2NyaXB0aW9uLmlkKTtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZVN1YnNjcmlwdGlvbkNhbmNlbGxlZChzdWJzY3JpcHRpb246IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEhhbmRsZSBzdWJzY3JpcHRpb24gY2FuY2VsbGF0aW9uXG4gICAgY29uc29sZS5sb2coJ1N1YnNjcmlwdGlvbiBjYW5jZWxsZWQ6Jywgc3Vic2NyaXB0aW9uLmlkKTtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZUludm9pY2VQYXltZW50U3VjY2VlZGVkKGludm9pY2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEhhbmRsZSBzdWNjZXNzZnVsIGludm9pY2UgcGF5bWVudFxuICAgIGNvbnNvbGUubG9nKCdJbnZvaWNlIHBheW1lbnQgc3VjY2VlZGVkOicsIGludm9pY2UuaWQpO1xuICB9XG5cbiAgYXN5bmMgaGFuZGxlSW52b2ljZVBheW1lbnRGYWlsZWQoaW52b2ljZTogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gSGFuZGxlIGZhaWxlZCBpbnZvaWNlIHBheW1lbnRcbiAgICBjb25zb2xlLmxvZygnSW52b2ljZSBwYXltZW50IGZhaWxlZDonLCBpbnZvaWNlLmlkKTtcbiAgfVxuYCA6ICcnfSR7Y29uZmlnLmVuYWJsZVJlZnVuZHMgPyBgXG4gIGFzeW5jIGhhbmRsZVJlZnVuZChjaGFyZ2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEhhbmRsZSByZWZ1bmRcbiAgICBjb25zb2xlLmxvZygnUmVmdW5kIHByb2Nlc3NlZDonLCBjaGFyZ2UuaWQpO1xuICB9XG5gIDogJyd9XG59XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVN1YnNjcmlwdGlvblNlcnZpY2UoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGltcG9ydCB7IFN0cmlwZVNlcnZpY2UgfSBmcm9tICcuL3N0cmlwZS5zZXJ2aWNlJztcbmltcG9ydCB7IFBheW1lbnRSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3BheW1lbnQucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBBcHBFcnJvciB9IGZyb20gJy4uL21pZGRsZXdhcmUvZXJyb3ItaGFuZGxlcic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIENyZWF0ZVN1YnNjcmlwdGlvbklucHV0IH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgU3Vic2NyaXB0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgc3RyaXBlU2VydmljZTogU3RyaXBlU2VydmljZTtcbiAgcHJpdmF0ZSBwYXltZW50UmVwb3NpdG9yeTogUGF5bWVudFJlcG9zaXRvcnk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zdHJpcGVTZXJ2aWNlID0gbmV3IFN0cmlwZVNlcnZpY2UoKTtcbiAgICB0aGlzLnBheW1lbnRSZXBvc2l0b3J5ID0gbmV3IFBheW1lbnRSZXBvc2l0b3J5KCk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTdWJzY3JpcHRpb24oaW5wdXQ6IENyZWF0ZVN1YnNjcmlwdGlvbklucHV0KTogUHJvbWlzZTxTdWJzY3JpcHRpb24+IHtcbiAgICAvLyBDcmVhdGUgb3IgZ2V0IFN0cmlwZSBjdXN0b21lclxuICAgIGxldCBjdXN0b21lciA9IGF3YWl0IHRoaXMucGF5bWVudFJlcG9zaXRvcnkuZmluZEN1c3RvbWVyQnlVc2VySWQoaW5wdXQudXNlcklkKTtcbiAgICBcbiAgICBpZiAoIWN1c3RvbWVyKSB7XG4gICAgICBjb25zdCBzdHJpcGVDdXN0b21lciA9IGF3YWl0IHRoaXMuc3RyaXBlU2VydmljZS5jcmVhdGVDdXN0b21lcihcbiAgICAgICAgaW5wdXQuZW1haWwsXG4gICAgICAgIGlucHV0Lm5hbWUsXG4gICAgICAgIHsgdXNlcklkOiBpbnB1dC51c2VySWQgfVxuICAgICAgKTtcbiAgICAgIGN1c3RvbWVyID0gYXdhaXQgdGhpcy5wYXltZW50UmVwb3NpdG9yeS5jcmVhdGVDdXN0b21lcih7XG4gICAgICAgIHVzZXJJZDogaW5wdXQudXNlcklkLFxuICAgICAgICBzdHJpcGVDdXN0b21lcklkOiBzdHJpcGVDdXN0b21lci5pZCxcbiAgICAgICAgZW1haWw6IGlucHV0LmVtYWlsLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHN1YnNjcmlwdGlvblxuICAgIGNvbnN0IHN0cmlwZVN1YnNjcmlwdGlvbiA9IGF3YWl0IHRoaXMuc3RyaXBlU2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24oXG4gICAgICBjdXN0b21lci5zdHJpcGVDdXN0b21lcklkLFxuICAgICAgaW5wdXQucHJpY2VJZCxcbiAgICAgIGlucHV0Lm1ldGFkYXRhXG4gICAgKTtcblxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHRoaXMucGF5bWVudFJlcG9zaXRvcnkuY3JlYXRlU3Vic2NyaXB0aW9uKHtcbiAgICAgIHVzZXJJZDogaW5wdXQudXNlcklkLFxuICAgICAgc3RyaXBlU3Vic2NyaXB0aW9uSWQ6IHN0cmlwZVN1YnNjcmlwdGlvbi5pZCxcbiAgICAgIHByaWNlSWQ6IGlucHV0LnByaWNlSWQsXG4gICAgICBzdGF0dXM6IHN0cmlwZVN1YnNjcmlwdGlvbi5zdGF0dXMsXG4gICAgICBjdXJyZW50UGVyaW9kU3RhcnQ6IG5ldyBEYXRlKHN0cmlwZVN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9zdGFydCAqIDEwMDApLFxuICAgICAgY3VycmVudFBlcmlvZEVuZDogbmV3IERhdGUoc3RyaXBlU3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDApLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcbiAgfVxuXG4gIGFzeW5jIGxpc3RVc2VyU3Vic2NyaXB0aW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U3Vic2NyaXB0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy5wYXltZW50UmVwb3NpdG9yeS5maW5kU3Vic2NyaXB0aW9uc0J5VXNlcklkKHVzZXJJZCk7XG4gIH1cblxuICBhc3luYyBjYW5jZWxTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uSWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBhd2FpdCB0aGlzLnBheW1lbnRSZXBvc2l0b3J5LmZpbmRTdWJzY3JpcHRpb25CeUlkKHN1YnNjcmlwdGlvbklkKTtcbiAgICBcbiAgICBpZiAoIXN1YnNjcmlwdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKDQwNCwgJ1N1YnNjcmlwdGlvbiBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICBpZiAoc3Vic2NyaXB0aW9uLnVzZXJJZCAhPT0gdXNlcklkKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAzLCAnQWNjZXNzIGRlbmllZCcpO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuc3RyaXBlU2VydmljZS5jYW5jZWxTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uLnN0cmlwZVN1YnNjcmlwdGlvbklkKTtcblxuICAgIGF3YWl0IHRoaXMucGF5bWVudFJlcG9zaXRvcnkudXBkYXRlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbklkLCB7XG4gICAgICBzdGF0dXM6ICdjYW5jZWxlZCcsXG4gICAgfSk7XG4gIH1cbn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUGF5bWVudFJlcG9zaXRvcnkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCB7IFBheW1lbnQsIENyZWF0ZVBheW1lbnRJbnB1dCwgVXBkYXRlUGF5bWVudElucHV0LCBDdXN0b21lciwgU3Vic2NyaXB0aW9uIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmV4cG9ydCBjbGFzcyBQYXltZW50UmVwb3NpdG9yeSB7XG4gIGFzeW5jIGNyZWF0ZShkYXRhOiBDcmVhdGVQYXltZW50SW5wdXQpOiBQcm9taXNlPFBheW1lbnQ+IHtcbiAgICByZXR1cm4gcHJpc21hLnBheW1lbnQuY3JlYXRlKHsgZGF0YSB9KTtcbiAgfVxuXG4gIGFzeW5jIGZpbmRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFBheW1lbnQgfCBudWxsPiB7XG4gICAgcmV0dXJuIHByaXNtYS5wYXltZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZCB9IH0pO1xuICB9XG5cbiAgYXN5bmMgZmluZEJ5U3RyaXBlUGF5bWVudEludGVudElkKHN0cmlwZVBheW1lbnRJbnRlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxQYXltZW50IHwgbnVsbD4ge1xuICAgIHJldHVybiBwcmlzbWEucGF5bWVudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgc3RyaXBlUGF5bWVudEludGVudElkIH0gfSk7XG4gIH1cblxuICBhc3luYyBmaW5kQnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFBheW1lbnRbXT4ge1xuICAgIHJldHVybiBwcmlzbWEucGF5bWVudC5maW5kTWFueSh7XG4gICAgICB3aGVyZTogeyB1c2VySWQgfSxcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBkYXRhOiBVcGRhdGVQYXltZW50SW5wdXQpOiBQcm9taXNlPFBheW1lbnQ+IHtcbiAgICByZXR1cm4gcHJpc21hLnBheW1lbnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICBkYXRhLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZmluZEN1c3RvbWVyQnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEN1c3RvbWVyIHwgbnVsbD4ge1xuICAgIHJldHVybiBwcmlzbWEuY3VzdG9tZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IHVzZXJJZCB9IH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlQ3VzdG9tZXIoZGF0YTogeyB1c2VySWQ6IHN0cmluZzsgc3RyaXBlQ3VzdG9tZXJJZDogc3RyaW5nOyBlbWFpbDogc3RyaW5nIH0pOiBQcm9taXNlPEN1c3RvbWVyPiB7XG4gICAgcmV0dXJuIHByaXNtYS5jdXN0b21lci5jcmVhdGUoeyBkYXRhIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlU3Vic2NyaXB0aW9uKGRhdGE6IGFueSk6IFByb21pc2U8U3Vic2NyaXB0aW9uPiB7XG4gICAgcmV0dXJuIHByaXNtYS5zdWJzY3JpcHRpb24uY3JlYXRlKHsgZGF0YSB9KTtcbiAgfVxuXG4gIGFzeW5jIGZpbmRTdWJzY3JpcHRpb25CeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFN1YnNjcmlwdGlvbiB8IG51bGw+IHtcbiAgICByZXR1cm4gcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQgfSB9KTtcbiAgfVxuXG4gIGFzeW5jIGZpbmRTdWJzY3JpcHRpb25zQnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFN1YnNjcmlwdGlvbltdPiB7XG4gICAgcmV0dXJuIHByaXNtYS5zdWJzY3JpcHRpb24uZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTdWJzY3JpcHRpb24oaWQ6IHN0cmluZywgZGF0YTogYW55KTogUHJvbWlzZTxTdWJzY3JpcHRpb24+IHtcbiAgICByZXR1cm4gcHJpc21hLnN1YnNjcmlwdGlvbi51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgIGRhdGEsXG4gICAgfSk7XG4gIH1cbn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlVHlwZXMoY29uZmlnOiBQYXltZW50U2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBleHBvcnQgdHlwZSBQYXltZW50U3RhdHVzID0gJ3BlbmRpbmcnIHwgJ3N1Y2NlZWRlZCcgfCAnZmFpbGVkJyB8ICdyZWZ1bmRlZCcgfCAnY2FuY2VsZWQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBheW1lbnQge1xuICBpZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgc3RyaXBlUGF5bWVudEludGVudElkOiBzdHJpbmc7XG4gIGFtb3VudDogbnVtYmVyO1xuICBjdXJyZW5jeTogc3RyaW5nO1xuICBzdGF0dXM6IFBheW1lbnRTdGF0dXM7XG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlUGF5bWVudElucHV0IHtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHN0cmlwZVBheW1lbnRJbnRlbnRJZDogc3RyaW5nO1xuICBhbW91bnQ6IG51bWJlcjtcbiAgY3VycmVuY3k6IHN0cmluZztcbiAgc3RhdHVzOiBQYXltZW50U3RhdHVzO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlUGF5bWVudElucHV0IHtcbiAgc3RhdHVzPzogUGF5bWVudFN0YXR1cztcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVBheW1lbnRJbnRlbnRJbnB1dCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBhbW91bnQ6IG51bWJlcjtcbiAgY3VycmVuY3k/OiBzdHJpbmc7XG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cbiR7Y29uZmlnLmVuYWJsZVN1YnNjcmlwdGlvbnMgPyBgXG5leHBvcnQgaW50ZXJmYWNlIEN1c3RvbWVyIHtcbiAgaWQ6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHN0cmlwZUN1c3RvbWVySWQ6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3Vic2NyaXB0aW9uIHtcbiAgaWQ6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHN0cmlwZVN1YnNjcmlwdGlvbklkOiBzdHJpbmc7XG4gIHByaWNlSWQ6IHN0cmluZztcbiAgc3RhdHVzOiBzdHJpbmc7XG4gIGN1cnJlbnRQZXJpb2RTdGFydDogRGF0ZTtcbiAgY3VycmVudFBlcmlvZEVuZDogRGF0ZTtcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlU3Vic2NyaXB0aW9uSW5wdXQge1xuICB1c2VySWQ6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgbmFtZT86IHN0cmluZztcbiAgcHJpY2VJZDogc3RyaW5nO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5gIDogJyd9XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVZhbGlkYXRpb25TY2hlbWFzKGNvbmZpZzogUGF5bWVudFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbmV4cG9ydCBjb25zdCBQYXltZW50U2NoZW1hcyA9IHtcbiAgY3JlYXRlSW50ZW50OiB6Lm9iamVjdCh7XG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgYW1vdW50OiB6Lm51bWJlcigpLnBvc2l0aXZlKCdBbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpLFxuICAgICAgY3VycmVuY3k6IHouc3RyaW5nKCkubGVuZ3RoKDMpLm9wdGlvbmFsKCksXG4gICAgICBtZXRhZGF0YTogei5yZWNvcmQoei5zdHJpbmcoKSkub3B0aW9uYWwoKSxcbiAgICB9KSxcbiAgfSksXG5cbiAgY29uZmlybVBheW1lbnQ6IHoub2JqZWN0KHtcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBwYXltZW50SW50ZW50SWQ6IHouc3RyaW5nKCkubWluKDEsICdQYXltZW50IGludGVudCBJRCBpcyByZXF1aXJlZCcpLFxuICAgIH0pLFxuICB9KSxcbiR7Y29uZmlnLmVuYWJsZVJlZnVuZHMgPyBgXG4gIHJlZnVuZDogei5vYmplY3Qoe1xuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIGFtb3VudDogei5udW1iZXIoKS5wb3NpdGl2ZSgpLm9wdGlvbmFsKCksXG4gICAgICByZWFzb246IHouZW51bShbJ2R1cGxpY2F0ZScsICdmcmF1ZHVsZW50JywgJ3JlcXVlc3RlZF9ieV9jdXN0b21lciddKS5vcHRpb25hbCgpLFxuICAgIH0pLFxuICB9KSxcbmAgOiAnJ30ke2NvbmZpZy5lbmFibGVTdWJzY3JpcHRpb25zID8gYFxuICBjcmVhdGVTdWJzY3JpcHRpb246IHoub2JqZWN0KHtcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgnSW52YWxpZCBlbWFpbCBhZGRyZXNzJyksXG4gICAgICBuYW1lOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICBwcmljZUlkOiB6LnN0cmluZygpLm1pbigxLCAnUHJpY2UgSUQgaXMgcmVxdWlyZWQnKSxcbiAgICAgIG1ldGFkYXRhOiB6LnJlY29yZCh6LnN0cmluZygpKS5vcHRpb25hbCgpLFxuICAgIH0pLFxuICB9KSxcbmAgOiAnJ31cbn07XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVByaXNtYVNjaGVtYShjb25maWc6IFBheW1lbnRTZXJ2aWNlQ29uZmlnKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGdlbmVyYXRvciBjbGllbnQge1xuICBwcm92aWRlciA9IFwicHJpc21hLWNsaWVudC1qc1wiXG59XG5cbmRhdGFzb3VyY2UgZGIge1xuICBwcm92aWRlciA9IFwicG9zdGdyZXNxbFwiXG4gIHVybCAgICAgID0gZW52KFwiREFUQUJBU0VfVVJMXCIpXG59XG5cbm1vZGVsIFBheW1lbnQge1xuICBpZCAgICAgICAgICAgICAgICAgICAgU3RyaW5nICAgQGlkIEBkZWZhdWx0KGN1aWQoKSlcbiAgdXNlcklkICAgICAgICAgICAgICAgIFN0cmluZ1xuICBzdHJpcGVQYXltZW50SW50ZW50SWQgU3RyaW5nICAgQHVuaXF1ZVxuICBhbW91bnQgICAgICAgICAgICAgICAgSW50XG4gIGN1cnJlbmN5ICAgICAgICAgICAgICBTdHJpbmdcbiAgc3RhdHVzICAgICAgICAgICAgICAgIFN0cmluZ1xuICBtZXRhZGF0YSAgICAgICAgICAgICAgSnNvbj9cbiAgY3JlYXRlZEF0ICAgICAgICAgICAgIERhdGVUaW1lIEBkZWZhdWx0KG5vdygpKVxuICB1cGRhdGVkQXQgICAgICAgICAgICAgRGF0ZVRpbWUgQHVwZGF0ZWRBdFxuICBcbiAgQEBpbmRleChbdXNlcklkXSlcbiAgQEBpbmRleChbc3RhdHVzXSlcbiAgQEBtYXAoXCJwYXltZW50c1wiKVxufVxuJHtjb25maWcuZW5hYmxlU3Vic2NyaXB0aW9ucyA/IGBcbm1vZGVsIEN1c3RvbWVyIHtcbiAgaWQgICAgICAgICAgICAgICBTdHJpbmcgICBAaWQgQGRlZmF1bHQoY3VpZCgpKVxuICB1c2VySWQgICAgICAgICAgIFN0cmluZyAgIEB1bmlxdWVcbiAgc3RyaXBlQ3VzdG9tZXJJZCBTdHJpbmcgICBAdW5pcXVlXG4gIGVtYWlsICAgICAgICAgICAgU3RyaW5nXG4gIGNyZWF0ZWRBdCAgICAgICAgRGF0ZVRpbWUgQGRlZmF1bHQobm93KCkpXG4gIHVwZGF0ZWRBdCAgICAgICAgRGF0ZVRpbWUgQHVwZGF0ZWRBdFxuICBcbiAgQEBtYXAoXCJjdXN0b21lcnNcIilcbn1cblxubW9kZWwgU3Vic2NyaXB0aW9uIHtcbiAgaWQgICAgICAgICAgICAgICAgICAgU3RyaW5nICAgQGlkIEBkZWZhdWx0KGN1aWQoKSlcbiAgdXNlcklkICAgICAgICAgICAgICAgU3RyaW5nXG4gIHN0cmlwZVN1YnNjcmlwdGlvbklkIFN0cmluZyAgIEB1bmlxdWVcbiAgcHJpY2VJZCAgICAgICAgICAgICAgU3RyaW5nXG4gIHN0YXR1cyAgICAgICAgICAgICAgIFN0cmluZ1xuICBjdXJyZW50UGVyaW9kU3RhcnQgICBEYXRlVGltZVxuICBjdXJyZW50UGVyaW9kRW5kICAgICBEYXRlVGltZVxuICBjcmVhdGVkQXQgICAgICAgICAgICBEYXRlVGltZSBAZGVmYXVsdChub3coKSlcbiAgdXBkYXRlZEF0ICAgICAgICAgICAgRGF0ZVRpbWUgQHVwZGF0ZWRBdFxuICBcbiAgQEBpbmRleChbdXNlcklkXSlcbiAgQEBpbmRleChbc3RhdHVzXSlcbiAgQEBtYXAoXCJzdWJzY3JpcHRpb25zXCIpXG59XG5gIDogJyd9XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVBhY2thZ2VKc29uKGNvbmZpZzogUGF5bWVudFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBuYW1lOiAncGF5bWVudC1zZXJ2aWNlJyxcbiAgICAgIHZlcnNpb246ICcxLjAuMCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ1N0cmlwZSBQYXltZW50IEludGVncmF0aW9uIFNlcnZpY2UnLFxuICAgICAgbWFpbjogJ2Rpc3QvaW5kZXguanMnLFxuICAgICAgc2NyaXB0czoge1xuICAgICAgICBkZXY6ICd0cy1ub2RlLWRldiAtLXJlc3Bhd24gLS10cmFuc3BpbGUtb25seSBzcmMvaW5kZXgudHMnLFxuICAgICAgICBidWlsZDogJ3RzYycsXG4gICAgICAgIHN0YXJ0OiAnbm9kZSBkaXN0L2luZGV4LmpzJyxcbiAgICAgICAgdGVzdDogJ2plc3QnLFxuICAgICAgICAndGVzdDp3YXRjaCc6ICdqZXN0IC0td2F0Y2gnLFxuICAgICAgICAncHJpc21hOmdlbmVyYXRlJzogJ3ByaXNtYSBnZW5lcmF0ZScsXG4gICAgICAgICdwcmlzbWE6bWlncmF0ZSc6ICdwcmlzbWEgbWlncmF0ZSBkZXYnLFxuICAgICAgfSxcbiAgICAgIGRlcGVuZGVuY2llczoge1xuICAgICAgICBleHByZXNzOiAnXjQuMTguMicsXG4gICAgICAgIGNvcnM6ICdeMi44LjUnLFxuICAgICAgICBoZWxtZXQ6ICdeNy4xLjAnLFxuICAgICAgICB6b2Q6ICdeMy4yMi40JyxcbiAgICAgICAgJ0BwcmlzbWEvY2xpZW50JzogJ141LjcuMScsXG4gICAgICAgIHN0cmlwZTogJ14xNC4xMC4wJyxcbiAgICAgIH0sXG4gICAgICBkZXZEZXBlbmRlbmNpZXM6IHtcbiAgICAgICAgJ0B0eXBlcy9leHByZXNzJzogJ140LjE3LjIxJyxcbiAgICAgICAgJ0B0eXBlcy9jb3JzJzogJ14yLjguMTcnLFxuICAgICAgICAnQHR5cGVzL25vZGUnOiAnXjIwLjEwLjUnLFxuICAgICAgICB0eXBlc2NyaXB0OiAnXjUuMy4zJyxcbiAgICAgICAgJ3RzLW5vZGUtZGV2JzogJ14yLjAuMCcsXG4gICAgICAgIGplc3Q6ICdeMjkuNy4wJyxcbiAgICAgICAgJ0B0eXBlcy9qZXN0JzogJ14yOS41LjExJyxcbiAgICAgICAgJ3RzLWplc3QnOiAnXjI5LjEuMScsXG4gICAgICAgIHByaXNtYTogJ141LjcuMScsXG4gICAgICB9LFxuICAgIH0sIG51bGwsIDIpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUVudkV4YW1wbGUoY29uZmlnOiBQYXltZW50U2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBQT1JUPSR7Y29uZmlnLnBvcnQgfHwgMzAwMn1cbk5PREVfRU5WPWRldmVsb3BtZW50XG5cbkRBVEFCQVNFX1VSTD1wb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBsb2NhbGhvc3Q6NTQzMi9wYXltZW50X2RiXG5cblNUUklQRV9TRUNSRVRfS0VZPXNrX3Rlc3RfeW91cl9zdHJpcGVfc2VjcmV0X2tleVxuU1RSSVBFX1dFQkhPT0tfU0VDUkVUPSR7Y29uZmlnLndlYmhvb2tTZWNyZXQgfHwgJ3doc2VjX3lvdXJfd2ViaG9va19zZWNyZXQnfVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWFkbWUoY29uZmlnOiBQYXltZW50U2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAjIFBheW1lbnQgU2VydmljZVxuXG5TdHJpcGUgcGF5bWVudCBpbnRlZ3JhdGlvbiBzZXJ2aWNlIHdpdGggcGF5bWVudCBwcm9jZXNzaW5nJHtjb25maWcuZW5hYmxlU3Vic2NyaXB0aW9ucyA/ICcsIHN1YnNjcmlwdGlvbiBiaWxsaW5nJyA6ICcnfSR7Y29uZmlnLmVuYWJsZVJlZnVuZHMgPyAnLCBhbmQgcmVmdW5kIGZ1bmN0aW9uYWxpdHknIDogJyd9LlxuXG4jIyBGZWF0dXJlc1xuXG4tIFBheW1lbnQgaW50ZW50IGNyZWF0aW9uIGFuZCBjb25maXJtYXRpb25cbi0gV2ViaG9vayBoYW5kbGluZyBmb3IgcGF5bWVudCBldmVudHNcbiR7Y29uZmlnLmVuYWJsZVN1YnNjcmlwdGlvbnMgPyAnLSBTdWJzY3JpcHRpb24gbWFuYWdlbWVudFxcbicgOiAnJ30ke2NvbmZpZy5lbmFibGVSZWZ1bmRzID8gJy0gUmVmdW5kIHByb2Nlc3NpbmdcXG4nIDogJyd9LSBTZWN1cmUgcGF5bWVudCB0cmFja2luZ1xuXG4jIyBJbnN0YWxsYXRpb25cblxuXFxgXFxgXFxgYmFzaFxubnBtIGluc3RhbGxcblxcYFxcYFxcYFxuXG4jIyBEYXRhYmFzZSBTZXR1cFxuXG5cXGBcXGBcXGBiYXNoXG5ucHggcHJpc21hIG1pZ3JhdGUgZGV2XG5ucHggcHJpc21hIGdlbmVyYXRlXG5cXGBcXGBcXGBcblxuIyMgQ29uZmlndXJhdGlvblxuXG5Db3B5IFxcYC5lbnYuZXhhbXBsZVxcYCB0byBcXGAuZW52XFxgIGFuZCBjb25maWd1cmU6XG5cbi0gXFxgU1RSSVBFX1NFQ1JFVF9LRVlcXGA6IFlvdXIgU3RyaXBlIHNlY3JldCBrZXlcbi0gXFxgU1RSSVBFX1dFQkhPT0tfU0VDUkVUXFxgOiBZb3VyIFN0cmlwZSB3ZWJob29rIHNlY3JldFxuLSBcXGBEQVRBQkFTRV9VUkxcXGA6IFBvc3RncmVTUUwgY29ubmVjdGlvbiBzdHJpbmdcblxuIyMgRGV2ZWxvcG1lbnRcblxuXFxgXFxgXFxgYmFzaFxubnBtIHJ1biBkZXZcblxcYFxcYFxcYFxuXG4jIyBQcm9kdWN0aW9uXG5cblxcYFxcYFxcYGJhc2hcbm5wbSBydW4gYnVpbGRcbm5wbSBzdGFydFxuXFxgXFxgXFxgXG5cbiMjIEFQSSBFbmRwb2ludHNcblxuIyMjIFBheW1lbnRzXG4tIFxcYFBPU1QgL2FwaS9wYXltZW50cy9pbnRlbnRcXGAgLSBDcmVhdGUgcGF5bWVudCBpbnRlbnRcbi0gXFxgUE9TVCAvYXBpL3BheW1lbnRzL2NvbmZpcm1cXGAgLSBDb25maXJtIHBheW1lbnRcbi0gXFxgR0VUIC9hcGkvcGF5bWVudHMvOmlkXFxgIC0gR2V0IHBheW1lbnQgYnkgSURcbi0gXFxgR0VUIC9hcGkvcGF5bWVudHNcXGAgLSBMaXN0IHVzZXIgcGF5bWVudHNcbiR7Y29uZmlnLmVuYWJsZVJlZnVuZHMgPyAnLSBgUE9TVCAvYXBpL3BheW1lbnRzLzppZC9yZWZ1bmRgIC0gUmVmdW5kIHBheW1lbnRcXG4nIDogJyd9XG4ke2NvbmZpZy5lbmFibGVTdWJzY3JpcHRpb25zID8gYCMjIyBTdWJzY3JpcHRpb25zXG4tIFxcYFBPU1QgL2FwaS9wYXltZW50cy9zdWJzY3JpcHRpb25zXFxgIC0gQ3JlYXRlIHN1YnNjcmlwdGlvblxuLSBcXGBHRVQgL2FwaS9wYXltZW50cy9zdWJzY3JpcHRpb25zXFxgIC0gTGlzdCB1c2VyIHN1YnNjcmlwdGlvbnNcbi0gXFxgUE9TVCAvYXBpL3BheW1lbnRzL3N1YnNjcmlwdGlvbnMvOmlkL2NhbmNlbFxcYCAtIENhbmNlbCBzdWJzY3JpcHRpb25cblxuYCA6ICcnfSMjIyBXZWJob29rc1xuLSBcXGBQT1NUIC9hcGkvd2ViaG9va3Mvc3RyaXBlXFxgIC0gU3RyaXBlIHdlYmhvb2sgZW5kcG9pbnRcblxuIyMgVGVzdGluZ1xuXG5cXGBcXGBcXGBiYXNoXG5ucG0gdGVzdFxuXFxgXFxgXFxgXG5cbiMjIFN0cmlwZSBXZWJob29rIFNldHVwXG5cbjEuIEluc3RhbGwgU3RyaXBlIENMSTogaHR0cHM6Ly9zdHJpcGUuY29tL2RvY3Mvc3RyaXBlLWNsaVxuMi4gRm9yd2FyZCB3ZWJob29rcyB0byBsb2NhbCBzZXJ2ZXI6XG4gICBcXGBcXGBcXGBiYXNoXG4gICBzdHJpcGUgbGlzdGVuIC0tZm9yd2FyZC10byBsb2NhbGhvc3Q6JHtjb25maWcucG9ydCB8fCAzMDAyfS9hcGkvd2ViaG9va3Mvc3RyaXBlXG4gICBcXGBcXGBcXGBcbjMuIENvcHkgdGhlIHdlYmhvb2sgc2lnbmluZyBzZWNyZXQgdG8geW91ciBcXGAuZW52XFxgIGZpbGVcbmA7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsSUFBQSxHQUFBQyx1QkFBQSxDQUFBQyxPQUFBO0FBQTZCLFNBQUFELHdCQUFBRSxDQUFBLEVBQUFDLENBQUEsNkJBQUFDLE9BQUEsTUFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFBSix1QkFBQSxZQUFBQSxDQUFBRSxDQUFBLEVBQUFDLENBQUEsU0FBQUEsQ0FBQSxJQUFB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