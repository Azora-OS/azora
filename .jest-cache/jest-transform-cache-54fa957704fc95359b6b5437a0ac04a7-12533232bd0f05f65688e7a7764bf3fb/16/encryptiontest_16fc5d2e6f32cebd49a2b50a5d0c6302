2d5d3694f5559b1415e89dfe7bbd60fd
"use strict";

const {
  encrypt,
  decrypt,
  hashPassword
} = require('../src/middleware/encryption');
describe('Encryption', () => {
  beforeAll(() => {
    process.env.ENCRYPTION_KEY = Buffer.from('a'.repeat(64), 'utf8').toString('hex').slice(0, 64);
  });
  test('should encrypt and decrypt text', () => {
    const text = 'sensitive data';
    const {
      encrypted,
      iv,
      authTag
    } = encrypt(text);
    const decrypted = decrypt(encrypted, iv, authTag);
    expect(decrypted).toBe(text);
  });
  test('should produce different ciphertext for same input', () => {
    const text = 'test';
    const result1 = encrypt(text);
    const result2 = encrypt(text);
    expect(result1.encrypted).not.toBe(result2.encrypted);
  });
  test('should hash passwords consistently', () => {
    const password = 'password123';
    const hash1 = hashPassword(password);
    const hash2 = hashPassword(password);
    expect(hash1).toBe(hash2);
    expect(hash1).not.toBe(password);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbmNyeXB0IiwiZGVjcnlwdCIsImhhc2hQYXNzd29yZCIsInJlcXVpcmUiLCJkZXNjcmliZSIsImJlZm9yZUFsbCIsInByb2Nlc3MiLCJlbnYiLCJFTkNSWVBUSU9OX0tFWSIsIkJ1ZmZlciIsImZyb20iLCJyZXBlYXQiLCJ0b1N0cmluZyIsInNsaWNlIiwidGVzdCIsInRleHQiLCJlbmNyeXB0ZWQiLCJpdiIsImF1dGhUYWciLCJkZWNyeXB0ZWQiLCJleHBlY3QiLCJ0b0JlIiwicmVzdWx0MSIsInJlc3VsdDIiLCJub3QiLCJwYXNzd29yZCIsImhhc2gxIiwiaGFzaDIiXSwic291cmNlcyI6WyJlbmNyeXB0aW9uLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBlbmNyeXB0LCBkZWNyeXB0LCBoYXNoUGFzc3dvcmQgfSA9IHJlcXVpcmUoJy4uL3NyYy9taWRkbGV3YXJlL2VuY3J5cHRpb24nKTtcblxuZGVzY3JpYmUoJ0VuY3J5cHRpb24nLCAoKSA9PiB7XG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgcHJvY2Vzcy5lbnYuRU5DUllQVElPTl9LRVkgPSBCdWZmZXIuZnJvbSgnYScucmVwZWF0KDY0KSwgJ3V0ZjgnKS50b1N0cmluZygnaGV4Jykuc2xpY2UoMCwgNjQpO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgZW5jcnlwdCBhbmQgZGVjcnlwdCB0ZXh0JywgKCkgPT4ge1xuICAgIGNvbnN0IHRleHQgPSAnc2Vuc2l0aXZlIGRhdGEnO1xuICAgIGNvbnN0IHsgZW5jcnlwdGVkLCBpdiwgYXV0aFRhZyB9ID0gZW5jcnlwdCh0ZXh0KTtcbiAgICBjb25zdCBkZWNyeXB0ZWQgPSBkZWNyeXB0KGVuY3J5cHRlZCwgaXYsIGF1dGhUYWcpO1xuICAgIFxuICAgIGV4cGVjdChkZWNyeXB0ZWQpLnRvQmUodGV4dCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBwcm9kdWNlIGRpZmZlcmVudCBjaXBoZXJ0ZXh0IGZvciBzYW1lIGlucHV0JywgKCkgPT4ge1xuICAgIGNvbnN0IHRleHQgPSAndGVzdCc7XG4gICAgY29uc3QgcmVzdWx0MSA9IGVuY3J5cHQodGV4dCk7XG4gICAgY29uc3QgcmVzdWx0MiA9IGVuY3J5cHQodGV4dCk7XG4gICAgXG4gICAgZXhwZWN0KHJlc3VsdDEuZW5jcnlwdGVkKS5ub3QudG9CZShyZXN1bHQyLmVuY3J5cHRlZCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBoYXNoIHBhc3N3b3JkcyBjb25zaXN0ZW50bHknLCAoKSA9PiB7XG4gICAgY29uc3QgcGFzc3dvcmQgPSAncGFzc3dvcmQxMjMnO1xuICAgIGNvbnN0IGhhc2gxID0gaGFzaFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICBjb25zdCBoYXNoMiA9IGhhc2hQYXNzd29yZChwYXNzd29yZCk7XG4gICAgXG4gICAgZXhwZWN0KGhhc2gxKS50b0JlKGhhc2gyKTtcbiAgICBleHBlY3QoaGFzaDEpLm5vdC50b0JlKHBhc3N3b3JkKTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNO0VBQUVBLE9BQU87RUFBRUMsT0FBTztFQUFFQztBQUFhLENBQUMsR0FBR0MsT0FBTyxDQUFDLDhCQUE4QixDQUFDO0FBRWxGQyxRQUFRLENBQUMsWUFBWSxFQUFFLE1BQU07RUFDM0JDLFNBQVMsQ0FBQyxNQUFNO0lBQ2RDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxjQUFjLEdBQUdDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQ0MsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUNDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO0VBQy9GLENBQUMsQ0FBQztFQUVGQyxJQUFJLENBQUMsaUNBQWlDLEVBQUUsTUFBTTtJQUM1QyxNQUFNQyxJQUFJLEdBQUcsZ0JBQWdCO0lBQzdCLE1BQU07TUFBRUMsU0FBUztNQUFFQyxFQUFFO01BQUVDO0lBQVEsQ0FBQyxHQUFHbEIsT0FBTyxDQUFDZSxJQUFJLENBQUM7SUFDaEQsTUFBTUksU0FBUyxHQUFHbEIsT0FBTyxDQUFDZSxTQUFTLEVBQUVDLEVBQUUsRUFBRUMsT0FBTyxDQUFDO0lBRWpERSxNQUFNLENBQUNELFNBQVMsQ0FBQyxDQUFDRSxJQUFJLENBQUNOLElBQUksQ0FBQztFQUM5QixDQUFDLENBQUM7RUFFRkQsSUFBSSxDQUFDLG9EQUFvRCxFQUFFLE1BQU07SUFDL0QsTUFBTUMsSUFBSSxHQUFHLE1BQU07SUFDbkIsTUFBTU8sT0FBTyxHQUFHdEIsT0FBTyxDQUFDZSxJQUFJLENBQUM7SUFDN0IsTUFBTVEsT0FBTyxHQUFHdkIsT0FBTyxDQUFDZSxJQUFJLENBQUM7SUFFN0JLLE1BQU0sQ0FBQ0UsT0FBTyxDQUFDTixTQUFTLENBQUMsQ0FBQ1EsR0FBRyxDQUFDSCxJQUFJLENBQUNFLE9BQU8sQ0FBQ1AsU0FBUyxDQUFDO0VBQ3ZELENBQUMsQ0FBQztFQUVGRixJQUFJLENBQUMsb0NBQW9DLEVBQUUsTUFBTTtJQUMvQyxNQUFNVyxRQUFRLEdBQUcsYUFBYTtJQUM5QixNQUFNQyxLQUFLLEdBQUd4QixZQUFZLENBQUN1QixRQUFRLENBQUM7SUFDcEMsTUFBTUUsS0FBSyxHQUFHekIsWUFBWSxDQUFDdUIsUUFBUSxDQUFDO0lBRXBDTCxNQUFNLENBQUNNLEtBQUssQ0FBQyxDQUFDTCxJQUFJLENBQUNNLEtBQUssQ0FBQztJQUN6QlAsTUFBTSxDQUFDTSxLQUFLLENBQUMsQ0FBQ0YsR0FBRyxDQUFDSCxJQUFJLENBQUNJLFFBQVEsQ0FBQztFQUNsQyxDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=