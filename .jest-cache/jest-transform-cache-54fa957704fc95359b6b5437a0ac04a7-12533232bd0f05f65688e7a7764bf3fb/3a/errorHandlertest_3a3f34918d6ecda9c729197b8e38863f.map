{"version":3,"names":["_errorHandler","require","describe","req","res","next","beforeEach","status","jest","fn","mockReturnThis","json","it","error","AppError","expect","statusCode","toBe","message","isOperational","toBeInstanceOf","Error","Object","getPrototypeOf","prototype","errorHandler","toHaveBeenCalledWith","originalEnv","process","env","NODE_ENV","consoleSpy","spyOn","console","mockImplementation","mockRestore","objectContaining"],"sources":["errorHandler.test.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { AppError, errorHandler } from '../errorHandler';\r\n\r\ndescribe('Error Handler Middleware', () => {\r\n  let req: Partial<Request>;\r\n  let res: Partial<Response>;\r\n  let next: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    req = {};\r\n    res = {\r\n      status: jest.fn().mockReturnThis(),\r\n      json: jest.fn().mockReturnThis()\r\n    };\r\n    next = jest.fn();\r\n  });\r\n\r\n  describe('AppError', () => {\r\n    it('should create error with status code and message', () => {\r\n      const error = new AppError(400, 'Bad request');\r\n      \r\n      expect(error.statusCode).toBe(400);\r\n      expect(error.message).toBe('Bad request');\r\n      expect(error.isOperational).toBe(true);\r\n    });\r\n\r\n    it('should be instance of Error', () => {\r\n      const error = new AppError(500, 'Server error');\r\n      \r\n      expect(error).toBeInstanceOf(Error);\r\n      expect(error).toBeInstanceOf(AppError);\r\n    });\r\n\r\n    it('should have correct prototype', () => {\r\n      const error = new AppError(401, 'Unauthorized');\r\n      \r\n      expect(Object.getPrototypeOf(error)).toBe(AppError.prototype);\r\n    });\r\n\r\n    it('should allow custom isOperational flag', () => {\r\n      const error = new AppError(500, 'Error', false);\r\n      \r\n      expect(error.isOperational).toBe(false);\r\n    });\r\n\r\n    it('should handle 401 status code', () => {\r\n      const error = new AppError(401, 'Unauthorized');\r\n      \r\n      expect(error.statusCode).toBe(401);\r\n    });\r\n\r\n    it('should handle 403 status code', () => {\r\n      const error = new AppError(403, 'Forbidden');\r\n      \r\n      expect(error.statusCode).toBe(403);\r\n    });\r\n\r\n    it('should handle 404 status code', () => {\r\n      const error = new AppError(404, 'Not found');\r\n      \r\n      expect(error.statusCode).toBe(404);\r\n    });\r\n\r\n    it('should handle 500 status code', () => {\r\n      const error = new AppError(500, 'Internal server error');\r\n      \r\n      expect(error.statusCode).toBe(500);\r\n    });\r\n  });\r\n\r\n  describe('errorHandler', () => {\r\n    it('should handle AppError correctly', () => {\r\n      const error = new AppError(400, 'Bad request');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.status).toHaveBeenCalledWith(400);\r\n      expect(res.json).toHaveBeenCalledWith({\r\n        status: 'error',\r\n        message: 'Bad request'\r\n      });\r\n    });\r\n\r\n    it('should return 401 for unauthorized error', () => {\r\n      const error = new AppError(401, 'Unauthorized');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.status).toHaveBeenCalledWith(401);\r\n    });\r\n\r\n    it('should return 403 for forbidden error', () => {\r\n      const error = new AppError(403, 'Forbidden');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.status).toHaveBeenCalledWith(403);\r\n    });\r\n\r\n    it('should return 404 for not found error', () => {\r\n      const error = new AppError(404, 'Not found');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.status).toHaveBeenCalledWith(404);\r\n    });\r\n\r\n    it('should return 500 for unexpected error', () => {\r\n      const error = new Error('Unexpected error');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.status).toHaveBeenCalledWith(500);\r\n    });\r\n\r\n    it('should hide error message in production', () => {\r\n      const originalEnv = process.env.NODE_ENV;\r\n      process.env.NODE_ENV = 'production';\r\n      \r\n      const error = new Error('Sensitive error details');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.json).toHaveBeenCalledWith({\r\n        status: 'error',\r\n        message: 'Internal server error'\r\n      });\r\n      \r\n      process.env.NODE_ENV = originalEnv;\r\n    });\r\n\r\n    it('should show error message in development', () => {\r\n      const originalEnv = process.env.NODE_ENV;\r\n      process.env.NODE_ENV = 'development';\r\n      \r\n      const error = new Error('Development error');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.json).toHaveBeenCalledWith({\r\n        status: 'error',\r\n        message: 'Development error'\r\n      });\r\n      \r\n      process.env.NODE_ENV = originalEnv;\r\n    });\r\n\r\n    it('should log unexpected errors', () => {\r\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\r\n      const error = new Error('Unexpected error');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(consoleSpy).toHaveBeenCalledWith('Unexpected error:', error);\r\n      \r\n      consoleSpy.mockRestore();\r\n    });\r\n\r\n    it('should return error status in response', () => {\r\n      const error = new AppError(422, 'Validation error');\r\n      \r\n      errorHandler(error, req as Request, res as Response, next);\r\n      \r\n      expect(res.json).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          status: 'error'\r\n        })\r\n      );\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}