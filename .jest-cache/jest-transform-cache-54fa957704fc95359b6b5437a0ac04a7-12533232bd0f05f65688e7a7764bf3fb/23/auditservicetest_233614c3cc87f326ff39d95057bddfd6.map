{"version":3,"names":["auditService","require","describe","beforeEach","auditLogs","test","userId","action","resource","details","ipAddress","auditEntry","logSecurityEvent","expect","toBeDefined","type","toBe","toEqual","severity","enrollmentId","logUserAction","service","version","logSystemEvent","fields","logDataAccess","userActionLogs","getAuditLogs","logs","length","every","log","user1Logs","stats","getSecurityStats","totalEvents","highSeverity","mediumSeverity","lowSeverity","oldLog","timestamp","Date","now","removedCount","clearOldLogs"],"sources":["audit-service.test.js"],"sourcesContent":["const auditService = require('../index');\n\ndescribe('Audit Logging Service', () => {\n  beforeEach(() => {\n    // Clear audit logs before each test\n    auditService.auditLogs = [];\n  });\n\n  test('should log security events', () => {\n    const userId = 'user123';\n    const action = 'login_success';\n    const resource = 'auth_service';\n    const details = { ipAddress: '192.168.1.1' };\n\n    const auditEntry = auditService.logSecurityEvent(userId, action, resource, details);\n\n    expect(auditEntry).toBeDefined();\n    expect(auditEntry.type).toBe('security');\n    expect(auditEntry.userId).toBe(userId);\n    expect(auditEntry.action).toBe(action);\n    expect(auditEntry.resource).toBe(resource);\n    expect(auditEntry.details).toEqual(details);\n    expect(auditEntry.severity).toBe('medium');\n  });\n\n  test('should log user actions', () => {\n    const userId = 'user123';\n    const action = 'course_enrollment';\n    const resource = 'course_algebra_101';\n    const details = { enrollmentId: 'enroll789' };\n\n    const auditEntry = auditService.logUserAction(userId, action, resource, details);\n\n    expect(auditEntry).toBeDefined();\n    expect(auditEntry.type).toBe('user_action');\n    expect(auditEntry.userId).toBe(userId);\n    expect(auditEntry.action).toBe(action);\n    expect(auditEntry.resource).toBe(resource);\n    expect(auditEntry.details).toEqual(details);\n  });\n\n  test('should log system events', () => {\n    const service = 'payment_service';\n    const action = 'startup';\n    const details = { version: '1.2.3' };\n\n    const auditEntry = auditService.logSystemEvent(service, action, details);\n\n    expect(auditEntry).toBeDefined();\n    expect(auditEntry.type).toBe('system');\n    expect(auditEntry.service).toBe(service);\n    expect(auditEntry.action).toBe(action);\n    expect(auditEntry.details).toEqual(details);\n  });\n\n  test('should log data access events', () => {\n    const userId = 'user123';\n    const action = 'read';\n    const resource = 'user_profile_456';\n    const details = { fields: ['name', 'email'] };\n\n    const auditEntry = auditService.logDataAccess(userId, action, resource, details);\n\n    expect(auditEntry).toBeDefined();\n    expect(auditEntry.type).toBe('data_access');\n    expect(auditEntry.userId).toBe(userId);\n    expect(auditEntry.action).toBe(action);\n    expect(auditEntry.resource).toBe(resource);\n    expect(auditEntry.details).toEqual(details);\n  });\n\n  test('should filter audit logs', () => {\n    // Add some test logs\n    auditService.logSecurityEvent('user1', 'login_success', 'auth_service');\n    auditService.logUserAction('user1', 'course_enrollment', 'course_123');\n    auditService.logUserAction('user2', 'profile_update', 'user_profile');\n\n    // Filter by type\n    const userActionLogs = auditService.getAuditLogs({ type: 'user_action' });\n    expect(userActionLogs.logs.length).toBe(2);\n    expect(userActionLogs.logs.every(log => log.type === 'user_action')).toBe(true);\n\n    // Filter by user ID\n    const user1Logs = auditService.getAuditLogs({ userId: 'user1' });\n    expect(user1Logs.logs.length).toBe(2);\n    expect(user1Logs.logs.every(log => log.userId === 'user1')).toBe(true);\n  });\n\n  test('should calculate security statistics', () => {\n    // Add some security events\n    auditService.logSecurityEvent('user1', 'login_success', 'auth_service');\n    auditService.logSecurityEvent('user2', 'login_failed', 'auth_service');\n    auditService.logSecurityEvent('user3', 'unauthorized_access', 'api_gateway');\n\n    const stats = auditService.getSecurityStats();\n\n    expect(stats.totalEvents).toBe(3);\n    expect(stats.highSeverity).toBe(1);\n    expect(stats.mediumSeverity).toBe(1);\n    expect(stats.lowSeverity).toBe(1);\n  });\n\n  test('should clear old logs', () => {\n    // Add some old logs\n    const oldLog = auditService.logSecurityEvent('user1', 'login_success', 'auth_service');\n    oldLog.timestamp = new Date(Date.now() - 100 * 24 * 60 * 60 * 1000); // 100 days old\n\n    // Add a recent log\n    auditService.logUserAction('user2', 'profile_update', 'user_profile');\n\n    expect(auditService.auditLogs.length).toBe(2);\n\n    // Clear logs older than 90 days\n    const removedCount = auditService.clearOldLogs(90);\n\n    expect(removedCount).toBe(1);\n    expect(auditService.auditLogs.length).toBe(1);\n    expect(auditService.auditLogs[0].action).toBe('profile_update');\n  });\n});\n"],"mappings":"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","ignoreList":[]}