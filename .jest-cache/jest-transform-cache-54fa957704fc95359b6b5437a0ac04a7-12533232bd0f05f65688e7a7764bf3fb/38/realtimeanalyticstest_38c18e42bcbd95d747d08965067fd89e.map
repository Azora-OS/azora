{"version":3,"names":["request","require","express","createTestApp","app","use","json","post","req","res","event","properties","body","status","error","tracking","trackingId","Date","now","timestamp","toISOString","processed","get","activeUsers","Math","floor","random","eventsPerSecond","streamId","events","describe","beforeEach","it","response","send","page","userId","expect","toBe","toHaveProperty","toEqual"],"sources":["realtime-analytics.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst express = require('express');\r\n\r\nfunction createTestApp() {\r\n  const app = express();\r\n  app.use(express.json());\r\n\r\n  app.post('/api/analytics/realtime/track', (req, res) => {\r\n    const { event, properties } = req.body;\r\n\r\n    if (!event) {\r\n      return res.status(400).json({ error: 'Event name is required' });\r\n    }\r\n\r\n    const tracking = {\r\n      trackingId: `track_${Date.now()}`,\r\n      event,\r\n      properties: properties || {},\r\n      timestamp: new Date().toISOString(),\r\n      processed: true\r\n    };\r\n\r\n    res.json(tracking);\r\n  });\r\n\r\n  app.get('/api/analytics/realtime/metrics', (req, res) => {\r\n    res.json({\r\n      activeUsers: Math.floor(Math.random() * 1000),\r\n      eventsPerSecond: Math.floor(Math.random() * 100),\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  });\r\n\r\n  app.get('/api/analytics/realtime/stream', (req, res) => {\r\n    res.json({\r\n      streamId: `stream_${Date.now()}`,\r\n      status: 'active',\r\n      events: []\r\n    });\r\n  });\r\n\r\n  return app;\r\n}\r\n\r\ndescribe('Azora Analytics - Real-time Analytics Tests', () => {\r\n  let app;\r\n\r\n  beforeEach(() => {\r\n    app = createTestApp();\r\n  });\r\n\r\n  describe('POST /api/analytics/realtime/track', () => {\r\n    it('should track real-time event', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/realtime/track')\r\n        .send({\r\n          event: 'page_view',\r\n          properties: {\r\n            page: '/dashboard',\r\n            userId: 'user123'\r\n          }\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('trackingId');\r\n      expect(response.body.event).toBe('page_view');\r\n      expect(response.body.processed).toBe(true);\r\n    });\r\n\r\n    it('should return error when event name is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/realtime/track')\r\n        .send({ properties: { page: '/home' } });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Event name is required');\r\n    });\r\n\r\n    it('should handle events without properties', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/realtime/track')\r\n        .send({ event: 'button_click' });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.properties).toEqual({});\r\n    });\r\n\r\n    it('should include timestamp in tracking response', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/realtime/track')\r\n        .send({ event: 'user_login' });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('timestamp');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/analytics/realtime/metrics', () => {\r\n    it('should return current real-time metrics', async () => {\r\n      const response = await request(app)\r\n        .get('/api/analytics/realtime/metrics');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('activeUsers');\r\n      expect(response.body).toHaveProperty('eventsPerSecond');\r\n      expect(response.body).toHaveProperty('timestamp');\r\n    });\r\n\r\n    it('should return numeric values for metrics', async () => {\r\n      const response = await request(app)\r\n        .get('/api/analytics/realtime/metrics');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(typeof response.body.activeUsers).toBe('number');\r\n      expect(typeof response.body.eventsPerSecond).toBe('number');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/analytics/realtime/stream', () => {\r\n    it('should provide real-time event stream', async () => {\r\n      const response = await request(app)\r\n        .get('/api/analytics/realtime/stream');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('streamId');\r\n      expect(response.body).toHaveProperty('status');\r\n      expect(response.body).toHaveProperty('events');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}