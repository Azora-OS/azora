{"version":3,"names":["ROLES","PERMISSIONS","hasPermission","requireRole","requirePermission","require","describe","test","expect","ADMIN","toBe","INSTRUCTOR","STUDENT","GUEST","req","user","role","res","next","jest","fn","middleware","toHaveBeenCalled","status","mockReturnThis","json","toHaveBeenCalledWith","not"],"sources":["rbac.test.js"],"sourcesContent":["const { ROLES, PERMISSIONS, hasPermission, requireRole, requirePermission } = require('../src/middleware/rbac');\n\ndescribe('RBAC Implementation', () => {\n  describe('Roles', () => {\n    test('should define all required roles', () => {\n      expect(ROLES.ADMIN).toBe('admin');\n      expect(ROLES.INSTRUCTOR).toBe('instructor');\n      expect(ROLES.STUDENT).toBe('student');\n      expect(ROLES.GUEST).toBe('guest');\n    });\n  });\n\n  describe('Permissions', () => {\n    test('admin should have all permissions', () => {\n      expect(hasPermission(ROLES.ADMIN, 'users:write')).toBe(true);\n      expect(hasPermission(ROLES.ADMIN, 'courses:delete')).toBe(true);\n      expect(hasPermission(ROLES.ADMIN, 'system:configure')).toBe(true);\n    });\n\n    test('instructor should have course permissions', () => {\n      expect(hasPermission(ROLES.INSTRUCTOR, 'courses:read')).toBe(true);\n      expect(hasPermission(ROLES.INSTRUCTOR, 'courses:write')).toBe(true);\n      expect(hasPermission(ROLES.INSTRUCTOR, 'courses:delete')).toBe(false);\n    });\n\n    test('student should have limited permissions', () => {\n      expect(hasPermission(ROLES.STUDENT, 'courses:read')).toBe(true);\n      expect(hasPermission(ROLES.STUDENT, 'courses:write')).toBe(false);\n      expect(hasPermission(ROLES.STUDENT, 'payments:read')).toBe(true);\n    });\n\n    test('guest should have no permissions', () => {\n      expect(hasPermission(ROLES.GUEST, 'courses:read')).toBe(false);\n      expect(hasPermission(ROLES.GUEST, 'users:read')).toBe(false);\n    });\n  });\n\n  describe('Middleware', () => {\n    test('requireRole should allow authorized role', () => {\n      const req = { user: { role: ROLES.ADMIN } };\n      const res = {};\n      const next = jest.fn();\n      \n      const middleware = requireRole(ROLES.ADMIN);\n      middleware(req, res, next);\n      \n      expect(next).toHaveBeenCalled();\n    });\n\n    test('requireRole should block unauthorized role', () => {\n      const req = { user: { role: ROLES.STUDENT } };\n      const res = { status: jest.fn().mockReturnThis(), json: jest.fn() };\n      const next = jest.fn();\n      \n      const middleware = requireRole(ROLES.ADMIN);\n      middleware(req, res, next);\n      \n      expect(res.status).toHaveBeenCalledWith(403);\n      expect(next).not.toHaveBeenCalled();\n    });\n\n    test('requirePermission should allow authorized permission', () => {\n      const req = { user: { role: ROLES.INSTRUCTOR } };\n      const res = {};\n      const next = jest.fn();\n      \n      const middleware = requirePermission('courses:write');\n      middleware(req, res, next);\n      \n      expect(next).toHaveBeenCalled();\n    });\n\n    test('requirePermission should block unauthorized permission', () => {\n      const req = { user: { role: ROLES.STUDENT } };\n      const res = { status: jest.fn().mockReturnThis(), json: jest.fn() };\n      const next = jest.fn();\n      \n      const middleware = requirePermission('courses:write');\n      middleware(req, res, next);\n      \n      expect(res.status).toHaveBeenCalledWith(403);\n      expect(next).not.toHaveBeenCalled();\n    });\n  });\n});\n"],"mappings":"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","ignoreList":[]}