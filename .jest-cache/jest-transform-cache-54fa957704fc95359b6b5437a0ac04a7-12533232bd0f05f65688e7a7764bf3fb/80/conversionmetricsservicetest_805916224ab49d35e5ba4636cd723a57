e8e5bb27869de801bd1816971306ae37
"use strict";

// Mock Prisma
_getJestObj().mock('@prisma/client', () => ({
  PrismaClient: jest.fn(() => ({
    user: {
      groupBy: jest.fn(),
      count: jest.fn()
    },
    payment: {
      aggregate: jest.fn()
    }
  }))
}));
var _conversionMetrics = require("../conversion-metrics.service");
var _client = require("@prisma/client");
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
describe('ConversionMetricsService', () => {
  let mockPrisma;
  beforeEach(() => {
    jest.clearAllMocks();
    mockPrisma = new _client.PrismaClient();
  });
  describe('getConversionMetrics', () => {
    it('should calculate conversion metrics for a given period', async () => {
      // Mock user counts by tier
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 100
        }
      }, {
        tier: 'premium',
        _count: {
          id: 30
        }
      }, {
        tier: 'pro',
        _count: {
          id: 5
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(135);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 50
        },
        _sum: {
          amount: 6750
        },
        _count: {
          id: 135
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024-01');
      expect(metrics).toHaveProperty('period', '2024-01');
      expect(metrics).toHaveProperty('freeUsers', 100);
      expect(metrics).toHaveProperty('premiumUsers', 30);
      expect(metrics).toHaveProperty('proUsers', 5);
      expect(metrics).toHaveProperty('conversionRate');
      expect(metrics).toHaveProperty('churnRate');
      expect(metrics).toHaveProperty('lifetimeValue');
      expect(metrics).toHaveProperty('customerAcquisitionCost');
      expect(metrics).toHaveProperty('paybackPeriod');
    });
    it('should handle quarter format period', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 100
        }
      }, {
        tier: 'premium',
        _count: {
          id: 30
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(130);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 50
        },
        _sum: {
          amount: 6500
        },
        _count: {
          id: 130
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024-Q1');
      expect(metrics.period).toBe('2024-Q1');
    });
    it('should handle year format period', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 1000
        }
      }, {
        tier: 'premium',
        _count: {
          id: 300
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(1300);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 50
        },
        _sum: {
          amount: 65000
        },
        _count: {
          id: 1300
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024');
      expect(metrics.period).toBe('2024');
    });
    it('should calculate conversion rate correctly', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 70
        }
      }, {
        tier: 'premium',
        _count: {
          id: 30
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(100);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 50
        },
        _sum: {
          amount: 5000
        },
        _count: {
          id: 100
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024-01');

      // Conversion rate should be 30 / (70 + 30) * 100 = 30%
      expect(metrics.conversionRate).toBeCloseTo(30, 1);
    });
    it('should return 0 for conversion rate when no users', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([]);
      mockPrisma.user.count.mockResolvedValue(0);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 0
        },
        _sum: {
          amount: 0
        },
        _count: {
          id: 0
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024-01');
      expect(metrics.conversionRate).toBe(0);
      expect(metrics.lifetimeValue).toBe(0);
    });
  });
  describe('Period parsing', () => {
    it('should parse month format correctly', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 100
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(100);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 0
        },
        _sum: {
          amount: 0
        },
        _count: {
          id: 0
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024-01');
      expect(metrics.period).toBe('2024-01');
    });
    it('should parse quarter format correctly', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 100
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(100);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 0
        },
        _sum: {
          amount: 0
        },
        _count: {
          id: 0
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024-Q2');
      expect(metrics.period).toBe('2024-Q2');
    });
    it('should parse year format correctly', async () => {
      mockPrisma.user.groupBy.mockResolvedValue([{
        tier: 'free',
        _count: {
          id: 100
        }
      }]);
      mockPrisma.user.count.mockResolvedValue(100);
      mockPrisma.payment.aggregate.mockResolvedValue({
        _avg: {
          amount: 0
        },
        _sum: {
          amount: 0
        },
        _count: {
          id: 0
        }
      });
      const metrics = await _conversionMetrics.conversionMetricsService.getConversionMetrics('2024');
      expect(metrics.period).toBe('2024');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJQcmlzbWFDbGllbnQiLCJqZXN0IiwiZm4iLCJ1c2VyIiwiZ3JvdXBCeSIsImNvdW50IiwicGF5bWVudCIsImFnZ3JlZ2F0ZSIsIl9jb252ZXJzaW9uTWV0cmljcyIsInJlcXVpcmUiLCJfY2xpZW50IiwiZGVzY3JpYmUiLCJtb2NrUHJpc21hIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJpdCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwidGllciIsIl9jb3VudCIsImlkIiwiX2F2ZyIsImFtb3VudCIsIl9zdW0iLCJtZXRyaWNzIiwiY29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlIiwiZ2V0Q29udmVyc2lvbk1ldHJpY3MiLCJleHBlY3QiLCJ0b0hhdmVQcm9wZXJ0eSIsInBlcmlvZCIsInRvQmUiLCJjb252ZXJzaW9uUmF0ZSIsInRvQmVDbG9zZVRvIiwibGlmZXRpbWVWYWx1ZSJdLCJzb3VyY2VzIjpbImNvbnZlcnNpb24tbWV0cmljcy5zZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlIH0gZnJvbSAnLi4vY29udmVyc2lvbi1tZXRyaWNzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XHJcblxyXG4vLyBNb2NrIFByaXNtYVxyXG5qZXN0Lm1vY2soJ0BwcmlzbWEvY2xpZW50JywgKCkgPT4gKHtcclxuICBQcmlzbWFDbGllbnQ6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgIHVzZXI6IHtcclxuICAgICAgZ3JvdXBCeTogamVzdC5mbigpLFxyXG4gICAgICBjb3VudDogamVzdC5mbigpLFxyXG4gICAgfSxcclxuICAgIHBheW1lbnQ6IHtcclxuICAgICAgYWdncmVnYXRlOiBqZXN0LmZuKCksXHJcbiAgICB9LFxyXG4gIH0pKSxcclxufSkpO1xyXG5cclxuZGVzY3JpYmUoJ0NvbnZlcnNpb25NZXRyaWNzU2VydmljZScsICgpID0+IHtcclxuICBsZXQgbW9ja1ByaXNtYTogYW55O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgbW9ja1ByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldENvbnZlcnNpb25NZXRyaWNzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29udmVyc2lvbiBtZXRyaWNzIGZvciBhIGdpdmVuIHBlcmlvZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gTW9jayB1c2VyIGNvdW50cyBieSB0aWVyXHJcbiAgICAgIG1vY2tQcmlzbWEudXNlci5ncm91cEJ5Lm1vY2tSZXNvbHZlZFZhbHVlKFtcclxuICAgICAgICB7IHRpZXI6ICdmcmVlJywgX2NvdW50OiB7IGlkOiAxMDAgfSB9LFxyXG4gICAgICAgIHsgdGllcjogJ3ByZW1pdW0nLCBfY291bnQ6IHsgaWQ6IDMwIH0gfSxcclxuICAgICAgICB7IHRpZXI6ICdwcm8nLCBfY291bnQ6IHsgaWQ6IDUgfSB9LFxyXG4gICAgICBdKTtcclxuXHJcbiAgICAgIG1vY2tQcmlzbWEudXNlci5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgxMzUpO1xyXG4gICAgICBtb2NrUHJpc21hLnBheW1lbnQuYWdncmVnYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBfYXZnOiB7IGFtb3VudDogNTAgfSxcclxuICAgICAgICBfc3VtOiB7IGFtb3VudDogNjc1MCB9LFxyXG4gICAgICAgIF9jb3VudDogeyBpZDogMTM1IH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IGNvbnZlcnNpb25NZXRyaWNzU2VydmljZS5nZXRDb252ZXJzaW9uTWV0cmljcygnMjAyNC0wMScpO1xyXG5cclxuICAgICAgZXhwZWN0KG1ldHJpY3MpLnRvSGF2ZVByb3BlcnR5KCdwZXJpb2QnLCAnMjAyNC0wMScpO1xyXG4gICAgICBleHBlY3QobWV0cmljcykudG9IYXZlUHJvcGVydHkoJ2ZyZWVVc2VycycsIDEwMCk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzKS50b0hhdmVQcm9wZXJ0eSgncHJlbWl1bVVzZXJzJywgMzApO1xyXG4gICAgICBleHBlY3QobWV0cmljcykudG9IYXZlUHJvcGVydHkoJ3Byb1VzZXJzJywgNSk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzKS50b0hhdmVQcm9wZXJ0eSgnY29udmVyc2lvblJhdGUnKTtcclxuICAgICAgZXhwZWN0KG1ldHJpY3MpLnRvSGF2ZVByb3BlcnR5KCdjaHVyblJhdGUnKTtcclxuICAgICAgZXhwZWN0KG1ldHJpY3MpLnRvSGF2ZVByb3BlcnR5KCdsaWZldGltZVZhbHVlJyk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzKS50b0hhdmVQcm9wZXJ0eSgnY3VzdG9tZXJBY3F1aXNpdGlvbkNvc3QnKTtcclxuICAgICAgZXhwZWN0KG1ldHJpY3MpLnRvSGF2ZVByb3BlcnR5KCdwYXliYWNrUGVyaW9kJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBxdWFydGVyIGZvcm1hdCBwZXJpb2QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tQcmlzbWEudXNlci5ncm91cEJ5Lm1vY2tSZXNvbHZlZFZhbHVlKFtcclxuICAgICAgICB7IHRpZXI6ICdmcmVlJywgX2NvdW50OiB7IGlkOiAxMDAgfSB9LFxyXG4gICAgICAgIHsgdGllcjogJ3ByZW1pdW0nLCBfY291bnQ6IHsgaWQ6IDMwIH0gfSxcclxuICAgICAgXSk7XHJcblxyXG4gICAgICBtb2NrUHJpc21hLnVzZXIuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMTMwKTtcclxuICAgICAgbW9ja1ByaXNtYS5wYXltZW50LmFnZ3JlZ2F0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgX2F2ZzogeyBhbW91bnQ6IDUwIH0sXHJcbiAgICAgICAgX3N1bTogeyBhbW91bnQ6IDY1MDAgfSxcclxuICAgICAgICBfY291bnQ6IHsgaWQ6IDEzMCB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBjb252ZXJzaW9uTWV0cmljc1NlcnZpY2UuZ2V0Q29udmVyc2lvbk1ldHJpY3MoJzIwMjQtUTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLnBlcmlvZCkudG9CZSgnMjAyNC1RMScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgeWVhciBmb3JtYXQgcGVyaW9kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrUHJpc21hLnVzZXIuZ3JvdXBCeS5tb2NrUmVzb2x2ZWRWYWx1ZShbXHJcbiAgICAgICAgeyB0aWVyOiAnZnJlZScsIF9jb3VudDogeyBpZDogMTAwMCB9IH0sXHJcbiAgICAgICAgeyB0aWVyOiAncHJlbWl1bScsIF9jb3VudDogeyBpZDogMzAwIH0gfSxcclxuICAgICAgXSk7XHJcblxyXG4gICAgICBtb2NrUHJpc21hLnVzZXIuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMTMwMCk7XHJcbiAgICAgIG1vY2tQcmlzbWEucGF5bWVudC5hZ2dyZWdhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIF9hdmc6IHsgYW1vdW50OiA1MCB9LFxyXG4gICAgICAgIF9zdW06IHsgYW1vdW50OiA2NTAwMCB9LFxyXG4gICAgICAgIF9jb3VudDogeyBpZDogMTMwMCB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBjb252ZXJzaW9uTWV0cmljc1NlcnZpY2UuZ2V0Q29udmVyc2lvbk1ldHJpY3MoJzIwMjQnKTtcclxuXHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLnBlcmlvZCkudG9CZSgnMjAyNCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29udmVyc2lvbiByYXRlIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja1ByaXNtYS51c2VyLmdyb3VwQnkubW9ja1Jlc29sdmVkVmFsdWUoW1xyXG4gICAgICAgIHsgdGllcjogJ2ZyZWUnLCBfY291bnQ6IHsgaWQ6IDcwIH0gfSxcclxuICAgICAgICB7IHRpZXI6ICdwcmVtaXVtJywgX2NvdW50OiB7IGlkOiAzMCB9IH0sXHJcbiAgICAgIF0pO1xyXG5cclxuICAgICAgbW9ja1ByaXNtYS51c2VyLmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDEwMCk7XHJcbiAgICAgIG1vY2tQcmlzbWEucGF5bWVudC5hZ2dyZWdhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIF9hdmc6IHsgYW1vdW50OiA1MCB9LFxyXG4gICAgICAgIF9zdW06IHsgYW1vdW50OiA1MDAwIH0sXHJcbiAgICAgICAgX2NvdW50OiB7IGlkOiAxMDAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgY29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlLmdldENvbnZlcnNpb25NZXRyaWNzKCcyMDI0LTAxJyk7XHJcblxyXG4gICAgICAvLyBDb252ZXJzaW9uIHJhdGUgc2hvdWxkIGJlIDMwIC8gKDcwICsgMzApICogMTAwID0gMzAlXHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLmNvbnZlcnNpb25SYXRlKS50b0JlQ2xvc2VUbygzMCwgMSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiAwIGZvciBjb252ZXJzaW9uIHJhdGUgd2hlbiBubyB1c2VycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja1ByaXNtYS51c2VyLmdyb3VwQnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xyXG4gICAgICBtb2NrUHJpc21hLnVzZXIuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMCk7XHJcbiAgICAgIG1vY2tQcmlzbWEucGF5bWVudC5hZ2dyZWdhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIF9hdmc6IHsgYW1vdW50OiAwIH0sXHJcbiAgICAgICAgX3N1bTogeyBhbW91bnQ6IDAgfSxcclxuICAgICAgICBfY291bnQ6IHsgaWQ6IDAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgY29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlLmdldENvbnZlcnNpb25NZXRyaWNzKCcyMDI0LTAxJyk7XHJcblxyXG4gICAgICBleHBlY3QobWV0cmljcy5jb252ZXJzaW9uUmF0ZSkudG9CZSgwKTtcclxuICAgICAgZXhwZWN0KG1ldHJpY3MubGlmZXRpbWVWYWx1ZSkudG9CZSgwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUGVyaW9kIHBhcnNpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHBhcnNlIG1vbnRoIGZvcm1hdCBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tQcmlzbWEudXNlci5ncm91cEJ5Lm1vY2tSZXNvbHZlZFZhbHVlKFtcclxuICAgICAgICB7IHRpZXI6ICdmcmVlJywgX2NvdW50OiB7IGlkOiAxMDAgfSB9LFxyXG4gICAgICBdKTtcclxuXHJcbiAgICAgIG1vY2tQcmlzbWEudXNlci5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgxMDApO1xyXG4gICAgICBtb2NrUHJpc21hLnBheW1lbnQuYWdncmVnYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBfYXZnOiB7IGFtb3VudDogMCB9LFxyXG4gICAgICAgIF9zdW06IHsgYW1vdW50OiAwIH0sXHJcbiAgICAgICAgX2NvdW50OiB7IGlkOiAwIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IGNvbnZlcnNpb25NZXRyaWNzU2VydmljZS5nZXRDb252ZXJzaW9uTWV0cmljcygnMjAyNC0wMScpO1xyXG4gICAgICBleHBlY3QobWV0cmljcy5wZXJpb2QpLnRvQmUoJzIwMjQtMDEnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcGFyc2UgcXVhcnRlciBmb3JtYXQgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrUHJpc21hLnVzZXIuZ3JvdXBCeS5tb2NrUmVzb2x2ZWRWYWx1ZShbXHJcbiAgICAgICAgeyB0aWVyOiAnZnJlZScsIF9jb3VudDogeyBpZDogMTAwIH0gfSxcclxuICAgICAgXSk7XHJcblxyXG4gICAgICBtb2NrUHJpc21hLnVzZXIuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMTAwKTtcclxuICAgICAgbW9ja1ByaXNtYS5wYXltZW50LmFnZ3JlZ2F0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgX2F2ZzogeyBhbW91bnQ6IDAgfSxcclxuICAgICAgICBfc3VtOiB7IGFtb3VudDogMCB9LFxyXG4gICAgICAgIF9jb3VudDogeyBpZDogMCB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBjb252ZXJzaW9uTWV0cmljc1NlcnZpY2UuZ2V0Q29udmVyc2lvbk1ldHJpY3MoJzIwMjQtUTInKTtcclxuICAgICAgZXhwZWN0KG1ldHJpY3MucGVyaW9kKS50b0JlKCcyMDI0LVEyJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHBhcnNlIHllYXIgZm9ybWF0IGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja1ByaXNtYS51c2VyLmdyb3VwQnkubW9ja1Jlc29sdmVkVmFsdWUoW1xyXG4gICAgICAgIHsgdGllcjogJ2ZyZWUnLCBfY291bnQ6IHsgaWQ6IDEwMCB9IH0sXHJcbiAgICAgIF0pO1xyXG5cclxuICAgICAgbW9ja1ByaXNtYS51c2VyLmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDEwMCk7XHJcbiAgICAgIG1vY2tQcmlzbWEucGF5bWVudC5hZ2dyZWdhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIF9hdmc6IHsgYW1vdW50OiAwIH0sXHJcbiAgICAgICAgX3N1bTogeyBhbW91bnQ6IDAgfSxcclxuICAgICAgICBfY291bnQ6IHsgaWQ6IDAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgY29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlLmdldENvbnZlcnNpb25NZXRyaWNzKCcyMDI0Jyk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLnBlcmlvZCkudG9CZSgnMjAyNCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBR0E7QUFDQUEsV0FBQSxHQUFLQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsT0FBTztFQUNqQ0MsWUFBWSxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQyxPQUFPO0lBQzNCQyxJQUFJLEVBQUU7TUFDSkMsT0FBTyxFQUFFSCxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO01BQ2xCRyxLQUFLLEVBQUVKLElBQUksQ0FBQ0MsRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFDREksT0FBTyxFQUFFO01BQ1BDLFNBQVMsRUFBRU4sSUFBSSxDQUFDQyxFQUFFLENBQUM7SUFDckI7RUFDRixDQUFDLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQztBQWRILElBQUFNLGtCQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFBOEMsU0FBQVgsWUFBQTtFQUFBO0lBQUFHO0VBQUEsSUFBQVEsT0FBQTtFQUFBWCxXQUFBLEdBQUFBLENBQUEsS0FBQUcsSUFBQTtFQUFBLE9BQUFBLElBQUE7QUFBQTtBQWU5Q1UsUUFBUSxDQUFDLDBCQUEwQixFQUFFLE1BQU07RUFDekMsSUFBSUMsVUFBZTtFQUVuQkMsVUFBVSxDQUFDLE1BQU07SUFDZlosSUFBSSxDQUFDYSxhQUFhLENBQUMsQ0FBQztJQUNwQkYsVUFBVSxHQUFHLElBQUlaLG9CQUFZLENBQUMsQ0FBQztFQUNqQyxDQUFDLENBQUM7RUFFRlcsUUFBUSxDQUFDLHNCQUFzQixFQUFFLE1BQU07SUFDckNJLEVBQUUsQ0FBQyx3REFBd0QsRUFBRSxZQUFZO01BQ3ZFO01BQ0FILFVBQVUsQ0FBQ1QsSUFBSSxDQUFDQyxPQUFPLENBQUNZLGlCQUFpQixDQUFDLENBQ3hDO1FBQUVDLElBQUksRUFBRSxNQUFNO1FBQUVDLE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBSTtNQUFFLENBQUMsRUFDckM7UUFBRUYsSUFBSSxFQUFFLFNBQVM7UUFBRUMsTUFBTSxFQUFFO1VBQUVDLEVBQUUsRUFBRTtRQUFHO01BQUUsQ0FBQyxFQUN2QztRQUFFRixJQUFJLEVBQUUsS0FBSztRQUFFQyxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUU7TUFBRSxDQUFDLENBQ25DLENBQUM7TUFFRlAsVUFBVSxDQUFDVCxJQUFJLENBQUNFLEtBQUssQ0FBQ1csaUJBQWlCLENBQUMsR0FBRyxDQUFDO01BQzVDSixVQUFVLENBQUNOLE9BQU8sQ0FBQ0MsU0FBUyxDQUFDUyxpQkFBaUIsQ0FBQztRQUM3Q0ksSUFBSSxFQUFFO1VBQUVDLE1BQU0sRUFBRTtRQUFHLENBQUM7UUFDcEJDLElBQUksRUFBRTtVQUFFRCxNQUFNLEVBQUU7UUFBSyxDQUFDO1FBQ3RCSCxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUk7TUFDcEIsQ0FBQyxDQUFDO01BRUYsTUFBTUksT0FBTyxHQUFHLE1BQU1DLDJDQUF3QixDQUFDQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUM7TUFFOUVDLE1BQU0sQ0FBQ0gsT0FBTyxDQUFDLENBQUNJLGNBQWMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDO01BQ25ERCxNQUFNLENBQUNILE9BQU8sQ0FBQyxDQUFDSSxjQUFjLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQztNQUNoREQsTUFBTSxDQUFDSCxPQUFPLENBQUMsQ0FBQ0ksY0FBYyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUM7TUFDbERELE1BQU0sQ0FBQ0gsT0FBTyxDQUFDLENBQUNJLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO01BQzdDRCxNQUFNLENBQUNILE9BQU8sQ0FBQyxDQUFDSSxjQUFjLENBQUMsZ0JBQWdCLENBQUM7TUFDaERELE1BQU0sQ0FBQ0gsT0FBTyxDQUFDLENBQUNJLGNBQWMsQ0FBQyxXQUFXLENBQUM7TUFDM0NELE1BQU0sQ0FBQ0gsT0FBTyxDQUFDLENBQUNJLGNBQWMsQ0FBQyxlQUFlLENBQUM7TUFDL0NELE1BQU0sQ0FBQ0gsT0FBTyxDQUFDLENBQUNJLGNBQWMsQ0FBQyx5QkFBeUIsQ0FBQztNQUN6REQsTUFBTSxDQUFDSCxPQUFPLENBQUMsQ0FBQ0ksY0FBYyxDQUFDLGVBQWUsQ0FBQztJQUNqRCxDQUFDLENBQUM7SUFFRlosRUFBRSxDQUFDLHFDQUFxQyxFQUFFLFlBQVk7TUFDcERILFVBQVUsQ0FBQ1QsSUFBSSxDQUFDQyxPQUFPLENBQUNZLGlCQUFpQixDQUFDLENBQ3hDO1FBQUVDLElBQUksRUFBRSxNQUFNO1FBQUVDLE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBSTtNQUFFLENBQUMsRUFDckM7UUFBRUYsSUFBSSxFQUFFLFNBQVM7UUFBRUMsTUFBTSxFQUFFO1VBQUVDLEVBQUUsRUFBRTtRQUFHO01BQUUsQ0FBQyxDQUN4QyxDQUFDO01BRUZQLFVBQVUsQ0FBQ1QsSUFBSSxDQUFDRSxLQUFLLENBQUNXLGlCQUFpQixDQUFDLEdBQUcsQ0FBQztNQUM1Q0osVUFBVSxDQUFDTixPQUFPLENBQUNDLFNBQVMsQ0FBQ1MsaUJBQWlCLENBQUM7UUFDN0NJLElBQUksRUFBRTtVQUFFQyxNQUFNLEVBQUU7UUFBRyxDQUFDO1FBQ3BCQyxJQUFJLEVBQUU7VUFBRUQsTUFBTSxFQUFFO1FBQUssQ0FBQztRQUN0QkgsTUFBTSxFQUFFO1VBQUVDLEVBQUUsRUFBRTtRQUFJO01BQ3BCLENBQUMsQ0FBQztNQUVGLE1BQU1JLE9BQU8sR0FBRyxNQUFNQywyQ0FBd0IsQ0FBQ0Msb0JBQW9CLENBQUMsU0FBUyxDQUFDO01BRTlFQyxNQUFNLENBQUNILE9BQU8sQ0FBQ0ssTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEMsQ0FBQyxDQUFDO0lBRUZkLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxZQUFZO01BQ2pESCxVQUFVLENBQUNULElBQUksQ0FBQ0MsT0FBTyxDQUFDWSxpQkFBaUIsQ0FBQyxDQUN4QztRQUFFQyxJQUFJLEVBQUUsTUFBTTtRQUFFQyxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUs7TUFBRSxDQUFDLEVBQ3RDO1FBQUVGLElBQUksRUFBRSxTQUFTO1FBQUVDLE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBSTtNQUFFLENBQUMsQ0FDekMsQ0FBQztNQUVGUCxVQUFVLENBQUNULElBQUksQ0FBQ0UsS0FBSyxDQUFDVyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7TUFDN0NKLFVBQVUsQ0FBQ04sT0FBTyxDQUFDQyxTQUFTLENBQUNTLGlCQUFpQixDQUFDO1FBQzdDSSxJQUFJLEVBQUU7VUFBRUMsTUFBTSxFQUFFO1FBQUcsQ0FBQztRQUNwQkMsSUFBSSxFQUFFO1VBQUVELE1BQU0sRUFBRTtRQUFNLENBQUM7UUFDdkJILE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBSztNQUNyQixDQUFDLENBQUM7TUFFRixNQUFNSSxPQUFPLEdBQUcsTUFBTUMsMkNBQXdCLENBQUNDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQztNQUUzRUMsTUFBTSxDQUFDSCxPQUFPLENBQUNLLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JDLENBQUMsQ0FBQztJQUVGZCxFQUFFLENBQUMsNENBQTRDLEVBQUUsWUFBWTtNQUMzREgsVUFBVSxDQUFDVCxJQUFJLENBQUNDLE9BQU8sQ0FBQ1ksaUJBQWlCLENBQUMsQ0FDeEM7UUFBRUMsSUFBSSxFQUFFLE1BQU07UUFBRUMsTUFBTSxFQUFFO1VBQUVDLEVBQUUsRUFBRTtRQUFHO01BQUUsQ0FBQyxFQUNwQztRQUFFRixJQUFJLEVBQUUsU0FBUztRQUFFQyxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUc7TUFBRSxDQUFDLENBQ3hDLENBQUM7TUFFRlAsVUFBVSxDQUFDVCxJQUFJLENBQUNFLEtBQUssQ0FBQ1csaUJBQWlCLENBQUMsR0FBRyxDQUFDO01BQzVDSixVQUFVLENBQUNOLE9BQU8sQ0FBQ0MsU0FBUyxDQUFDUyxpQkFBaUIsQ0FBQztRQUM3Q0ksSUFBSSxFQUFFO1VBQUVDLE1BQU0sRUFBRTtRQUFHLENBQUM7UUFDcEJDLElBQUksRUFBRTtVQUFFRCxNQUFNLEVBQUU7UUFBSyxDQUFDO1FBQ3RCSCxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUk7TUFDcEIsQ0FBQyxDQUFDO01BRUYsTUFBTUksT0FBTyxHQUFHLE1BQU1DLDJDQUF3QixDQUFDQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUM7O01BRTlFO01BQ0FDLE1BQU0sQ0FBQ0gsT0FBTyxDQUFDTyxjQUFjLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDO0lBRUZoQixFQUFFLENBQUMsbURBQW1ELEVBQUUsWUFBWTtNQUNsRUgsVUFBVSxDQUFDVCxJQUFJLENBQUNDLE9BQU8sQ0FBQ1ksaUJBQWlCLENBQUMsRUFBRSxDQUFDO01BQzdDSixVQUFVLENBQUNULElBQUksQ0FBQ0UsS0FBSyxDQUFDVyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7TUFDMUNKLFVBQVUsQ0FBQ04sT0FBTyxDQUFDQyxTQUFTLENBQUNTLGlCQUFpQixDQUFDO1FBQzdDSSxJQUFJLEVBQUU7VUFBRUMsTUFBTSxFQUFFO1FBQUUsQ0FBQztRQUNuQkMsSUFBSSxFQUFFO1VBQUVELE1BQU0sRUFBRTtRQUFFLENBQUM7UUFDbkJILE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBRTtNQUNsQixDQUFDLENBQUM7TUFFRixNQUFNSSxPQUFPLEdBQUcsTUFBTUMsMkNBQXdCLENBQUNDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQztNQUU5RUMsTUFBTSxDQUFDSCxPQUFPLENBQUNPLGNBQWMsQ0FBQyxDQUFDRCxJQUFJLENBQUMsQ0FBQyxDQUFDO01BQ3RDSCxNQUFNLENBQUNILE9BQU8sQ0FBQ1MsYUFBYSxDQUFDLENBQUNILElBQUksQ0FBQyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUZsQixRQUFRLENBQUMsZ0JBQWdCLEVBQUUsTUFBTTtJQUMvQkksRUFBRSxDQUFDLHFDQUFxQyxFQUFFLFlBQVk7TUFDcERILFVBQVUsQ0FBQ1QsSUFBSSxDQUFDQyxPQUFPLENBQUNZLGlCQUFpQixDQUFDLENBQ3hDO1FBQUVDLElBQUksRUFBRSxNQUFNO1FBQUVDLE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBSTtNQUFFLENBQUMsQ0FDdEMsQ0FBQztNQUVGUCxVQUFVLENBQUNULElBQUksQ0FBQ0UsS0FBSyxDQUFDVyxpQkFBaUIsQ0FBQyxHQUFHLENBQUM7TUFDNUNKLFVBQVUsQ0FBQ04sT0FBTyxDQUFDQyxTQUFTLENBQUNTLGlCQUFpQixDQUFDO1FBQzdDSSxJQUFJLEVBQUU7VUFBRUMsTUFBTSxFQUFFO1FBQUUsQ0FBQztRQUNuQkMsSUFBSSxFQUFFO1VBQUVELE1BQU0sRUFBRTtRQUFFLENBQUM7UUFDbkJILE1BQU0sRUFBRTtVQUFFQyxFQUFFLEVBQUU7UUFBRTtNQUNsQixDQUFDLENBQUM7TUFFRixNQUFNSSxPQUFPLEdBQUcsTUFBTUMsMkNBQXdCLENBQUNDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQztNQUM5RUMsTUFBTSxDQUFDSCxPQUFPLENBQUNLLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hDLENBQUMsQ0FBQztJQUVGZCxFQUFFLENBQUMsdUNBQXVDLEVBQUUsWUFBWTtNQUN0REgsVUFBVSxDQUFDVCxJQUFJLENBQUNDLE9BQU8sQ0FBQ1ksaUJBQWlCLENBQUMsQ0FDeEM7UUFBRUMsSUFBSSxFQUFFLE1BQU07UUFBRUMsTUFBTSxFQUFFO1VBQUVDLEVBQUUsRUFBRTtRQUFJO01BQUUsQ0FBQyxDQUN0QyxDQUFDO01BRUZQLFVBQVUsQ0FBQ1QsSUFBSSxDQUFDRSxLQUFLLENBQUNXLGlCQUFpQixDQUFDLEdBQUcsQ0FBQztNQUM1Q0osVUFBVSxDQUFDTixPQUFPLENBQUNDLFNBQVMsQ0FBQ1MsaUJBQWlCLENBQUM7UUFDN0NJLElBQUksRUFBRTtVQUFFQyxNQUFNLEVBQUU7UUFBRSxDQUFDO1FBQ25CQyxJQUFJLEVBQUU7VUFBRUQsTUFBTSxFQUFFO1FBQUUsQ0FBQztRQUNuQkgsTUFBTSxFQUFFO1VBQUVDLEVBQUUsRUFBRTtRQUFFO01BQ2xCLENBQUMsQ0FBQztNQUVGLE1BQU1JLE9BQU8sR0FBRyxNQUFNQywyQ0FBd0IsQ0FBQ0Msb0JBQW9CLENBQUMsU0FBUyxDQUFDO01BQzlFQyxNQUFNLENBQUNILE9BQU8sQ0FBQ0ssTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEMsQ0FBQyxDQUFDO0lBRUZkLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxZQUFZO01BQ25ESCxVQUFVLENBQUNULElBQUksQ0FBQ0MsT0FBTyxDQUFDWSxpQkFBaUIsQ0FBQyxDQUN4QztRQUFFQyxJQUFJLEVBQUUsTUFBTTtRQUFFQyxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUk7TUFBRSxDQUFDLENBQ3RDLENBQUM7TUFFRlAsVUFBVSxDQUFDVCxJQUFJLENBQUNFLEtBQUssQ0FBQ1csaUJBQWlCLENBQUMsR0FBRyxDQUFDO01BQzVDSixVQUFVLENBQUNOLE9BQU8sQ0FBQ0MsU0FBUyxDQUFDUyxpQkFBaUIsQ0FBQztRQUM3Q0ksSUFBSSxFQUFFO1VBQUVDLE1BQU0sRUFBRTtRQUFFLENBQUM7UUFDbkJDLElBQUksRUFBRTtVQUFFRCxNQUFNLEVBQUU7UUFBRSxDQUFDO1FBQ25CSCxNQUFNLEVBQUU7VUFBRUMsRUFBRSxFQUFFO1FBQUU7TUFDbEIsQ0FBQyxDQUFDO01BRUYsTUFBTUksT0FBTyxHQUFHLE1BQU1DLDJDQUF3QixDQUFDQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUM7TUFDM0VDLE1BQU0sQ0FBQ0gsT0FBTyxDQUFDSyxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=