{"version":3,"names":["_globals","require","_supertest","_interopRequireDefault","_database","e","__esModule","default","API_URL","process","env","LEDGER_SERVICE_URL","describe","beforeEach","setupTestDatabase","afterEach","cleanupTestDatabase","it","accountId","request","post","send","amount","currency","type","res","expectedBalance","expect","status","toBe","body","reconciled","actualBalance","discrepancy","get","report","toBeDefined","sourceTransactionId","targetTransactionId","matched","Array","isArray","unmatchedTransactions","query","transactionId","suggestions","startDate","endDate","accountIds","summary","results","frequency","time","scheduleId"],"sources":["reconciliation.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\r\nimport request from 'supertest';\r\nimport { setupTestDatabase, cleanupTestDatabase } from '../../../tests/utils/database';\r\n\r\nconst API_URL = process.env.LEDGER_SERVICE_URL || 'http://localhost:3012';\r\n\r\ndescribe('Azora Ledger - Reconciliation', () => {\r\n  beforeEach(async () => {\r\n    await setupTestDatabase();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    await cleanupTestDatabase();\r\n  });\r\n\r\n  describe('Account Reconciliation', () => {\r\n    it('should reconcile account transactions', async () => {\r\n      const accountId = 'account-reconcile';\r\n\r\n      await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          accountId,\r\n          type: 'credit',\r\n        });\r\n\r\n      await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 30,\r\n          currency: 'USD',\r\n          accountId,\r\n          type: 'debit',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .post('/api/reconciliation/accounts')\r\n        .send({\r\n          accountId,\r\n          expectedBalance: 70,\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.reconciled).toBe(true);\r\n      expect(res.body.actualBalance).toBe(70);\r\n    });\r\n\r\n    it('should detect reconciliation discrepancies', async () => {\r\n      const accountId = 'account-discrepancy';\r\n\r\n      await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          accountId,\r\n          type: 'credit',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .post('/api/reconciliation/accounts')\r\n        .send({\r\n          accountId,\r\n          expectedBalance: 150,\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.reconciled).toBe(false);\r\n      expect(res.body.discrepancy).toBe(50);\r\n    });\r\n\r\n    it('should generate reconciliation report', async () => {\r\n      const accountId = 'account-report';\r\n\r\n      const res = await request(API_URL)\r\n        .get(`/api/reconciliation/accounts/${accountId}/report`);\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.report).toBeDefined();\r\n      expect(res.body.report.accountId).toBe(accountId);\r\n    });\r\n  });\r\n\r\n  describe('Transaction Matching', () => {\r\n    it('should match transactions', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/reconciliation/match')\r\n        .send({\r\n          sourceTransactionId: 'txn-123',\r\n          targetTransactionId: 'txn-456',\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.matched).toBe(true);\r\n    });\r\n\r\n    it('should identify unmatched transactions', async () => {\r\n      const accountId = 'account-unmatched';\r\n\r\n      const res = await request(API_URL)\r\n        .get(`/api/reconciliation/accounts/${accountId}/unmatched`);\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(Array.isArray(res.body.unmatchedTransactions)).toBe(true);\r\n    });\r\n\r\n    it('should suggest transaction matches', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/reconciliation/suggestions')\r\n        .query({\r\n          transactionId: 'txn-123',\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(Array.isArray(res.body.suggestions)).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Period Reconciliation', () => {\r\n    it('should reconcile period', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/reconciliation/period')\r\n        .send({\r\n          startDate: '2024-01-01',\r\n          endDate: '2024-01-31',\r\n          accountIds: ['account-123', 'account-456'],\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.reconciled).toBeDefined();\r\n      expect(res.body.summary).toBeDefined();\r\n    });\r\n\r\n    it('should generate period reconciliation report', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/reconciliation/period/report')\r\n        .query({\r\n          startDate: '2024-01-01',\r\n          endDate: '2024-01-31',\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.report).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('Automated Reconciliation', () => {\r\n    it('should run automated reconciliation', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/reconciliation/automated')\r\n        .send({\r\n          accountIds: ['account-123', 'account-456'],\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.results).toBeDefined();\r\n      expect(Array.isArray(res.body.results)).toBe(true);\r\n    });\r\n\r\n    it('should schedule reconciliation', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/reconciliation/schedule')\r\n        .send({\r\n          frequency: 'daily',\r\n          time: '00:00',\r\n          accountIds: ['account-123'],\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.scheduleId).toBeDefined();\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}