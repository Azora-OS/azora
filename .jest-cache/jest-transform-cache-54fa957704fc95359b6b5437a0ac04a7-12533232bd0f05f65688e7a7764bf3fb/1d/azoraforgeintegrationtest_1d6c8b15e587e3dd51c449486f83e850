ff36e18d5660e2b52217e1b37aadb7a7
"use strict";

const request = require('supertest');
const app = require('../server');
describe('azora-forge Integration Tests', () => {
  beforeAll(async () => {
    // Setup test database
  });
  afterAll(async () => {
    // Cleanup test database
  });
  describe('API Integration', () => {
    it('should handle concurrent requests', async () => {
      const promises = Array(10).fill().map(() => request(app).get('/health'));
      const responses = await Promise.all(promises);
      responses.forEach(res => {
        expect(res.status).toBe(200);
      });
    });
    it('should handle malformed requests gracefully', async () => {
      const res = await request(app).post('/api/test').send('invalid json').expect(400);
    });
    it('should enforce rate limiting', async () => {
      const promises = Array(200).fill().map(() => request(app).get('/health'));
      const responses = await Promise.all(promises);
      const rateLimited = responses.some(r => r.status === 429);
      expect(rateLimited).toBe(true);
    });
  });
  describe('Security Tests', () => {
    it('should have security headers', async () => {
      const res = await request(app).get('/health');
      expect(res.headers['x-content-type-options']).toBe('nosniff');
      expect(res.headers['x-frame-options']).toBe('DENY');
    });
    it('should sanitize XSS attempts', async () => {
      const malicious = '<script>alert("xss")</script>';
      const res = await request(app).post('/api/test').send({
        data: malicious
      });
      expect(JSON.stringify(res.body)).not.toContain('<script>');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiYmVmb3JlQWxsIiwiYWZ0ZXJBbGwiLCJpdCIsInByb21pc2VzIiwiQXJyYXkiLCJmaWxsIiwibWFwIiwiZ2V0IiwicmVzcG9uc2VzIiwiUHJvbWlzZSIsImFsbCIsImZvckVhY2giLCJyZXMiLCJleHBlY3QiLCJzdGF0dXMiLCJ0b0JlIiwicG9zdCIsInNlbmQiLCJyYXRlTGltaXRlZCIsInNvbWUiLCJyIiwiaGVhZGVycyIsIm1hbGljaW91cyIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwiYm9keSIsIm5vdCIsInRvQ29udGFpbiJdLCJzb3VyY2VzIjpbImF6b3JhLWZvcmdlLmludGVncmF0aW9uLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xuY29uc3QgYXBwID0gcmVxdWlyZSgnLi4vc2VydmVyJyk7XG5cbmRlc2NyaWJlKCdhem9yYS1mb3JnZSBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXR1cCB0ZXN0IGRhdGFiYXNlXG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbnVwIHRlc3QgZGF0YWJhc2VcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FQSSBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheSgxMCkuZmlsbCgpLm1hcCgoKSA9PiBcbiAgICAgICAgcmVxdWVzdChhcHApLmdldCgnL2hlYWx0aCcpXG4gICAgICApO1xuICAgICAgY29uc3QgcmVzcG9uc2VzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgcmVzcG9uc2VzLmZvckVhY2gocmVzID0+IHtcbiAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIHJlcXVlc3RzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvdGVzdCcpXG4gICAgICAgIC5zZW5kKCdpbnZhbGlkIGpzb24nKVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgcmF0ZSBsaW1pdGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkoMjAwKS5maWxsKCkubWFwKCgpID0+IFxuICAgICAgICByZXF1ZXN0KGFwcCkuZ2V0KCcvaGVhbHRoJylcbiAgICAgICk7XG4gICAgICBjb25zdCByZXNwb25zZXMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBjb25zdCByYXRlTGltaXRlZCA9IHJlc3BvbnNlcy5zb21lKHIgPT4gci5zdGF0dXMgPT09IDQyOSk7XG4gICAgICBleHBlY3QocmF0ZUxpbWl0ZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhdmUgc2VjdXJpdHkgaGVhZGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9oZWFsdGgnKTtcbiAgICAgIGV4cGVjdChyZXMuaGVhZGVyc1sneC1jb250ZW50LXR5cGUtb3B0aW9ucyddKS50b0JlKCdub3NuaWZmJyk7XG4gICAgICBleHBlY3QocmVzLmhlYWRlcnNbJ3gtZnJhbWUtb3B0aW9ucyddKS50b0JlKCdERU5ZJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIFhTUyBhdHRlbXB0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1hbGljaW91cyA9ICc8c2NyaXB0PmFsZXJ0KFwieHNzXCIpPC9zY3JpcHQ+JztcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS90ZXN0JylcbiAgICAgICAgLnNlbmQoeyBkYXRhOiBtYWxpY2lvdXMgfSk7XG4gICAgICBleHBlY3QoSlNPTi5zdHJpbmdpZnkocmVzLmJvZHkpKS5ub3QudG9Db250YWluKCc8c2NyaXB0PicpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDcEMsTUFBTUMsR0FBRyxHQUFHRCxPQUFPLENBQUMsV0FBVyxDQUFDO0FBRWhDRSxRQUFRLENBQUMsK0JBQStCLEVBQUUsTUFBTTtFQUM5Q0MsU0FBUyxDQUFDLFlBQVk7SUFDcEI7RUFBQSxDQUNELENBQUM7RUFFRkMsUUFBUSxDQUFDLFlBQVk7SUFDbkI7RUFBQSxDQUNELENBQUM7RUFFRkYsUUFBUSxDQUFDLGlCQUFpQixFQUFFLE1BQU07SUFDaENHLEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxZQUFZO01BQ2xELE1BQU1DLFFBQVEsR0FBR0MsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxHQUFHLENBQUMsTUFDcENWLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQUNTLEdBQUcsQ0FBQyxTQUFTLENBQzVCLENBQUM7TUFDRCxNQUFNQyxTQUFTLEdBQUcsTUFBTUMsT0FBTyxDQUFDQyxHQUFHLENBQUNQLFFBQVEsQ0FBQztNQUM3Q0ssU0FBUyxDQUFDRyxPQUFPLENBQUNDLEdBQUcsSUFBSTtRQUN2QkMsTUFBTSxDQUFDRCxHQUFHLENBQUNFLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO01BQzlCLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQztJQUVGYixFQUFFLENBQUMsNkNBQTZDLEVBQUUsWUFBWTtNQUM1RCxNQUFNVSxHQUFHLEdBQUcsTUFBTWhCLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQzNCa0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUNqQkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUNwQkosTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUNoQixDQUFDLENBQUM7SUFFRlgsRUFBRSxDQUFDLDhCQUE4QixFQUFFLFlBQVk7TUFDN0MsTUFBTUMsUUFBUSxHQUFHQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUNDLEdBQUcsQ0FBQyxNQUNyQ1YsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FBQ1MsR0FBRyxDQUFDLFNBQVMsQ0FDNUIsQ0FBQztNQUNELE1BQU1DLFNBQVMsR0FBRyxNQUFNQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ1AsUUFBUSxDQUFDO01BQzdDLE1BQU1lLFdBQVcsR0FBR1YsU0FBUyxDQUFDVyxJQUFJLENBQUNDLENBQUMsSUFBSUEsQ0FBQyxDQUFDTixNQUFNLEtBQUssR0FBRyxDQUFDO01BQ3pERCxNQUFNLENBQUNLLFdBQVcsQ0FBQyxDQUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ2hDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztFQUVGaEIsUUFBUSxDQUFDLGdCQUFnQixFQUFFLE1BQU07SUFDL0JHLEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxZQUFZO01BQzdDLE1BQU1VLEdBQUcsR0FBRyxNQUFNaEIsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FBQ1MsR0FBRyxDQUFDLFNBQVMsQ0FBQztNQUM3Q00sTUFBTSxDQUFDRCxHQUFHLENBQUNTLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUNOLElBQUksQ0FBQyxTQUFTLENBQUM7TUFDN0RGLE1BQU0sQ0FBQ0QsR0FBRyxDQUFDUyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDTixJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JELENBQUMsQ0FBQztJQUVGYixFQUFFLENBQUMsOEJBQThCLEVBQUUsWUFBWTtNQUM3QyxNQUFNb0IsU0FBUyxHQUFHLCtCQUErQjtNQUNqRCxNQUFNVixHQUFHLEdBQUcsTUFBTWhCLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQzNCa0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUNqQkMsSUFBSSxDQUFDO1FBQUVNLElBQUksRUFBRUQ7TUFBVSxDQUFDLENBQUM7TUFDNUJULE1BQU0sQ0FBQ1csSUFBSSxDQUFDQyxTQUFTLENBQUNiLEdBQUcsQ0FBQ2MsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsR0FBRyxDQUFDQyxTQUFTLENBQUMsVUFBVSxDQUFDO0lBQzVELENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==