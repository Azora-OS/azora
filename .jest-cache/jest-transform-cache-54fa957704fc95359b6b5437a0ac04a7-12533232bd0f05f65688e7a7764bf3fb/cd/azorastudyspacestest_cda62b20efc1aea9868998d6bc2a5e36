23c8b7aa64437d4db26fa7dd7532a6c8
"use strict";

const request = require('supertest');
const app = require('../server');
describe('azora-studyspaces Service', () => {
  describe('Health Check', () => {
    it('should return healthy status', async () => {
      const response = await request(app).get('/api/health').expect(200);
      expect(response.body.status).toBe('healthy');
      expect(response.body.service).toBeDefined();
      expect(response.body.timestamp).toBeDefined();
    });
  });
  describe('API Endpoints', () => {
    it('should handle 404 for non-existent endpoints', async () => {
      const response = await request(app).get('/api/non-existent').expect(404);
      expect(response.body.success).toBe(false);
      expect(response.body.error).toBe('Endpoint not found');
    });
    it('should handle invalid JSON', async () => {
      const response = await request(app).post('/api/test').send('invalid json').expect(400);
    });
  });
  describe('Security', () => {
    it('should have security headers', async () => {
      const response = await request(app).get('/api/health');
      expect(response.headers['x-content-type-options']).toBeDefined();
      expect(response.headers['x-frame-options']).toBeDefined();
    });
    it('should handle rate limiting', async () => {
      // Make multiple requests to test rate limiting
      const promises = Array(10).fill().map(() => request(app).get('/api/health'));
      const responses = await Promise.all(promises);
      expect(responses.every(r => r.status === 200 || r.status === 429)).toBe(true);
    });
  });
  describe('Error Handling', () => {
    it('should handle server errors gracefully', async () => {
      // Test error middleware
      const response = await request(app).get('/api/health');
      expect(response.status).toBeLessThan(500);
    });
  });
  describe('Input Validation', () => {
    it('should sanitize XSS attempts', async () => {
      const maliciousInput = '<script>alert("xss")</script>';
      const response = await request(app).post('/api/test').send({
        data: maliciousInput
      });

      // Should not contain script tags in response
      expect(JSON.stringify(response.body)).not.toContain('<script>');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsImJvZHkiLCJzdGF0dXMiLCJ0b0JlIiwic2VydmljZSIsInRvQmVEZWZpbmVkIiwidGltZXN0YW1wIiwic3VjY2VzcyIsImVycm9yIiwicG9zdCIsInNlbmQiLCJoZWFkZXJzIiwicHJvbWlzZXMiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJyZXNwb25zZXMiLCJQcm9taXNlIiwiYWxsIiwiZXZlcnkiLCJyIiwidG9CZUxlc3NUaGFuIiwibWFsaWNpb3VzSW5wdXQiLCJkYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5vdCIsInRvQ29udGFpbiJdLCJzb3VyY2VzIjpbImF6b3JhLXN0dWR5c3BhY2VzLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xuY29uc3QgYXBwID0gcmVxdWlyZSgnLi4vc2VydmVyJyk7XG5cbmRlc2NyaWJlKCdhem9yYS1zdHVkeXNwYWNlcyBTZXJ2aWNlJywgKCkgPT4ge1xuICBkZXNjcmliZSgnSGVhbHRoIENoZWNrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGhlYWx0aHkgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9oZWFsdGgnKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN0YXR1cykudG9CZSgnaGVhbHRoeScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnRpbWVzdGFtcCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FQSSBFbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgNDA0IGZvciBub24tZXhpc3RlbnQgZW5kcG9pbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9ub24tZXhpc3RlbnQnKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvQmUoJ0VuZHBvaW50IG5vdCBmb3VuZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBKU09OJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvdGVzdCcpXG4gICAgICAgIC5zZW5kKCdpbnZhbGlkIGpzb24nKVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhdmUgc2VjdXJpdHkgaGVhZGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvaGVhbHRoJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzWyd4LWNvbnRlbnQtdHlwZS1vcHRpb25zJ10pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVyc1sneC1mcmFtZS1vcHRpb25zJ10pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByYXRlIGxpbWl0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTWFrZSBtdWx0aXBsZSByZXF1ZXN0cyB0byB0ZXN0IHJhdGUgbGltaXRpbmdcbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkoMTApLmZpbGwoKS5tYXAoKCkgPT4gXG4gICAgICAgIHJlcXVlc3QoYXBwKS5nZXQoJy9hcGkvaGVhbHRoJylcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlcyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZXMuZXZlcnkociA9PiByLnN0YXR1cyA9PT0gMjAwIHx8IHIuc3RhdHVzID09PSA0MjkpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmVyIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCBlcnJvciBtaWRkbGV3YXJlXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2hlYWx0aCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlTGVzc1RoYW4oNTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0lucHV0IFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzYW5pdGl6ZSBYU1MgYXR0ZW1wdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWxpY2lvdXNJbnB1dCA9ICc8c2NyaXB0PmFsZXJ0KFwieHNzXCIpPC9zY3JpcHQ+JztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvdGVzdCcpXG4gICAgICAgIC5zZW5kKHsgZGF0YTogbWFsaWNpb3VzSW5wdXQgfSk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgY29udGFpbiBzY3JpcHQgdGFncyBpbiByZXNwb25zZVxuICAgICAgZXhwZWN0KEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmJvZHkpKS5ub3QudG9Db250YWluKCc8c2NyaXB0PicpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDcEMsTUFBTUMsR0FBRyxHQUFHRCxPQUFPLENBQUMsV0FBVyxDQUFDO0FBRWhDRSxRQUFRLENBQUMsMkJBQTJCLEVBQUUsTUFBTTtFQUMxQ0EsUUFBUSxDQUFDLGNBQWMsRUFBRSxNQUFNO0lBQzdCQyxFQUFFLENBQUMsOEJBQThCLEVBQUUsWUFBWTtNQUM3QyxNQUFNQyxRQUFRLEdBQUcsTUFBTUwsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDaENJLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FDbEJDLE1BQU0sQ0FBQyxHQUFHLENBQUM7TUFFZEEsTUFBTSxDQUFDRixRQUFRLENBQUNHLElBQUksQ0FBQ0MsTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxTQUFTLENBQUM7TUFDNUNILE1BQU0sQ0FBQ0YsUUFBUSxDQUFDRyxJQUFJLENBQUNHLE9BQU8sQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUMzQ0wsTUFBTSxDQUFDRixRQUFRLENBQUNHLElBQUksQ0FBQ0ssU0FBUyxDQUFDLENBQUNELFdBQVcsQ0FBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztFQUVGVCxRQUFRLENBQUMsZUFBZSxFQUFFLE1BQU07SUFDOUJDLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxZQUFZO01BQzdELE1BQU1DLFFBQVEsR0FBRyxNQUFNTCxPQUFPLENBQUNFLEdBQUcsQ0FBQyxDQUNoQ0ksR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQ3hCQyxNQUFNLENBQUMsR0FBRyxDQUFDO01BRWRBLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDRyxJQUFJLENBQUNNLE9B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