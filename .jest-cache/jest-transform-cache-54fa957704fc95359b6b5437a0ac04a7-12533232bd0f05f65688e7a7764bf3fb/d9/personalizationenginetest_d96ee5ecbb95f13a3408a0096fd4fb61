dde6a740183f60349ad1be13e12de87f
"use strict";

const request = require('supertest');
const app = require('../server.js');
describe('Personalization Engine Service', () => {
  describe('GET /health', () => {
    it('should return health status', async () => {
      const response = await request(app).get('/health');
      expect(response.status).toBe(200);
      expect(response.body.status).toBe('OK');
      expect(response.body.service).toBe('personalization-engine');
    });
  });
  describe('GET /api/recommendations/:userId', () => {
    it('should return personalized recommendations for a user', async () => {
      const userId = 'user_123';
      const response = await request(app).get(`/api/recommendations/${userId}`).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.userId).toBe(userId);
      expect(response.body.recommendations).toBeDefined();
    });
  });
  describe('POST /api/preferences/:userId', () => {
    it('should update user preferences', async () => {
      const userId = 'user_123';
      const preferences = {
        interests: ['technology', 'science'],
        preferredContentTypes: ['video', 'article']
      };
      const response = await request(app).post(`/api/preferences/${userId}`).send(preferences).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.userId).toBe(userId);
      expect(response.body.message).toBe('Preferences updated successfully');
    });
  });
  describe('GET /api/preferences/:userId', () => {
    it('should return user preferences', async () => {
      const userId = 'user_123';
      const response = await request(app).get(`/api/preferences/${userId}`).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.userId).toBe(userId);
      expect(response.body.preferences).toBeDefined();
    });
  });
  describe('404 handling', () => {
    it('should return 404 for unknown routes', async () => {
      const response = await request(app).get('/non-existent-route');
      expect(response.status).toBe(404);
      expect(response.body.error).toBe('Route not found');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5Iiwic2VydmljZSIsInVzZXJJZCIsInNldCIsInN1Y2Nlc3MiLCJyZWNvbW1lbmRhdGlvbnMiLCJ0b0JlRGVmaW5lZCIsInByZWZlcmVuY2VzIiwiaW50ZXJlc3RzIiwicHJlZmVycmVkQ29udGVudFR5cGVzIiwicG9zdCIsInNlbmQiLCJtZXNzYWdlIiwiZXJyb3IiXSwic291cmNlcyI6WyJwZXJzb25hbGl6YXRpb24tZW5naW5lLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xyXG5jb25zdCBhcHAgPSByZXF1aXJlKCcuLi9zZXJ2ZXIuanMnKTtcclxuXHJcbmRlc2NyaWJlKCdQZXJzb25hbGl6YXRpb24gRW5naW5lIFNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgZGVzY3JpYmUoJ0dFVCAvaGVhbHRoJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gaGVhbHRoIHN0YXR1cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcCkuZ2V0KCcvaGVhbHRoJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3RhdHVzKS50b0JlKCdPSycpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zZXJ2aWNlKS50b0JlKCdwZXJzb25hbGl6YXRpb24tZW5naW5lJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0dFVCAvYXBpL3JlY29tbWVuZGF0aW9ucy86dXNlcklkJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9ucyBmb3IgYSB1c2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcl8xMjMnO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAuZ2V0KGAvYXBpL3JlY29tbWVuZGF0aW9ucy8ke3VzZXJJZH1gKVxyXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnVzZXJJZCkudG9CZSh1c2VySWQpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5yZWNvbW1lbmRhdGlvbnMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1BPU1QgL2FwaS9wcmVmZXJlbmNlcy86dXNlcklkJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgdXNlciBwcmVmZXJlbmNlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXJfMTIzJztcclxuICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSB7XHJcbiAgICAgICAgaW50ZXJlc3RzOiBbJ3RlY2hub2xvZ3knLCAnc2NpZW5jZSddLFxyXG4gICAgICAgIHByZWZlcnJlZENvbnRlbnRUeXBlczogWyd2aWRlbycsICdhcnRpY2xlJ11cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLnBvc3QoYC9hcGkvcHJlZmVyZW5jZXMvJHt1c2VySWR9YClcclxuICAgICAgICAuc2VuZChwcmVmZXJlbmNlcylcclxuICAgICAgICAuc2V0KCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS51c2VySWQpLnRvQmUodXNlcklkKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnUHJlZmVyZW5jZXMgdXBkYXRlZCBzdWNjZXNzZnVsbHknKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnR0VUIC9hcGkvcHJlZmVyZW5jZXMvOnVzZXJJZCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVzZXIgcHJlZmVyZW5jZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyXzEyMyc7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5nZXQoYC9hcGkvcHJlZmVyZW5jZXMvJHt1c2VySWR9YClcclxuICAgICAgICAuc2V0KCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS51c2VySWQpLnRvQmUodXNlcklkKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkucHJlZmVyZW5jZXMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJzQwNCBoYW5kbGluZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwNCBmb3IgdW5rbm93biByb3V0ZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmdldCgnL25vbi1leGlzdGVudC1yb3V0ZScpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwNCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlKCdSb3V0ZSBub3QgZm91bmQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ3BDLE1BQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUVuQ0UsUUFBUSxDQUFDLGdDQUFnQyxFQUFFLE1BQU07RUFDL0NBLFFBQVEsQ0FBQyxhQUFhLEVBQUUsTUFBTTtJQUM1QkMsRUFBRSxDQUFDLDZCQUE2QixFQUFFLFlBQVk7TUFDNUMsTUFBTUMsUUFBUSxHQUFHLE1BQU1MLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQUNJLEdBQUcsQ0FBQyxTQUFTLENBQUM7TUFDbERDLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDRyxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQztNQUNqQ0YsTUFBTSxDQUFDRixRQUFRLENBQUNLLElBQUksQ0FBQ0YsTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxJQUFJLENBQUM7TUFDdkNGLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNDLE9BQU8sQ0FBQyxDQUFDRixJQUFJLENBQUMsd0JBQXdCLENBQUM7SUFDOUQsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUZOLFFBQVEsQ0FBQyxrQ0FBa0MsRUFBRSxNQUFNO0lBQ2pEQyxFQUFFLENBQUMsdURBQXVELEVBQUUsWUFBWTtNQUN0RSxNQUFNUSxNQUFNLEdBQUcsVUFBVTtNQUV6QixNQUFNUCxRQUFRLEdBQUcsTUFBTUwsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDaENJLEdBQUcsQ0FBQyx3QkFBd0JNLE1BQU0sRUFBRSxDQUFDLENBQ3JDQyxHQUFHLENBQUMsUUFBUSxFQUFFLGtCQUFrQixDQUFDO01BRXBDTixNQUFNLENBQUNGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDakNGLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNJLE9BQU8sQ0FBQyxDQUFDTCxJQUFJLENBQUMsSUFBSSxDQUFDO01BQ3hDRixNQUFNLENBQUNGLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDRSxNQUFNLENBQUMsQ0FBQ0gsSUFBSSxDQUFDRyxNQUFNLENBQUM7TUFDekNMLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNLLGVBQWUsQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztJQUNyRCxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRmIsUUFBUSxDQUFDLCtCQUErQixFQUFFLE1BQU07SUFDOUNDLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxZQUFZO01BQy9DLE1BQU1RLE1BQU0sR0FBRyxVQUFVO01BQ3pCLE1BQU1LLFdBQVcsR0FBRztRQUNsQkMsU0FBUyxFQUFFLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQztRQUNwQ0MscUJBQXFCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsU0FBUztNQUM1QyxDQUFDO01BRUQsTUFBTWQsUUFBUSxHQUFHLE1BQU1MLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQ2hDa0IsSUFBSSxDQUFDLG9CQUFvQlIsTUFBTSxFQUFFLENBQUMsQ0FDbENTLElBQUksQ0FBQ0osV0FBVyxDQUFDLENBQ2pCSixHQUFHLENBQUMsUUFBUSxFQUFFLGtCQUFrQixDQUFDO01BRXBDTixNQUFNLENBQUNGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDakNGLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNJLE9BQU8sQ0FBQyxDQUFDTCxJQUFJLENBQUMsSUFBSSxDQUFDO01BQ3hDRixNQUFNLENBQUNGLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDRSxNQUFNLENBQUMsQ0FBQ0gsSUFBSSxDQUFDRyxNQUFNLENBQUM7TUFDekNMLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNZLE9BQU8sQ0FBQyxDQUFDYixJQUFJLENBQUMsa0NBQWtDLENBQUM7SUFDeEUsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUZOLFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxNQUFNO0lBQzdDQyxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsWUFBWTtNQUMvQyxNQUFNUSxNQUFNLEdBQUcsVUFBVTtNQUV6QixNQUFNUCxRQUFRLEdBQUcsTUFBTUwsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDaENJLEdBQUcsQ0FBQyxvQkFBb0JNLE1BQU0sRUFBRSxDQUFDLENBQ2pDQyxHQUFHLENBQUMsUUFBUSxFQUFFLGtCQUFrQixDQUFDO01BRXBDTixNQUFNLENBQUNGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDakNGLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNJLE9BQU8sQ0FBQyxDQUFDTCxJQUFJLENBQUMsSUFBSSxDQUFDO01BQ3hDRixNQUFNLENBQUNGLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDRSxNQUFNLENBQUMsQ0FBQ0gsSUFBSSxDQUFDRyxNQUFNLENBQUM7TUFDekNMLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNPLFdBQVcsQ0FBQyxDQUFDRCxXQUFXLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRmIsUUFBUSxDQUFDLGNBQWMsRUFBRSxNQUFNO0lBQzdCQyxFQUFFLENBQUMsc0NBQXNDLEVBQUUsWUFBWTtNQUNyRCxNQUFNQyxRQUFRLEdBQUcsTUFBTUwsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FBQ0ksR0FBRyxDQUFDLHFCQUFxQixDQUFDO01BQzlEQyxNQUFNLENBQUNGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDakNGLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDSyxJQUFJLENBQUNhLEtBQUssQ0FBQyxDQUFDZCxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDckQsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119