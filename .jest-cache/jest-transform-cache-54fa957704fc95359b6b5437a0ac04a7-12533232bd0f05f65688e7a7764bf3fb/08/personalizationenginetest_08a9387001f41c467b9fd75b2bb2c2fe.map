{"version":3,"names":["request","require","app","describe","it","response","get","expect","body","status","toBe","service","toBeDefined","timestamp","success","error","post","send","headers","promises","Array","fill","map","responses","Promise","all","every","r","toBeLessThan","maliciousInput","data","JSON","stringify","not","toContain"],"sources":["personalization-engine.test.js"],"sourcesContent":["const request = require('supertest');\nconst app = require('../server');\n\ndescribe('personalization-engine Service', () => {\n  describe('Health Check', () => {\n    it('should return healthy status', async () => {\n      const response = await request(app)\n        .get('/api/health')\n        .expect(200);\n      \n      expect(response.body.status).toBe('healthy');\n      expect(response.body.service).toBeDefined();\n      expect(response.body.timestamp).toBeDefined();\n    });\n  });\n\n  describe('API Endpoints', () => {\n    it('should handle 404 for non-existent endpoints', async () => {\n      const response = await request(app)\n        .get('/api/non-existent')\n        .expect(404);\n      \n      expect(response.body.success).toBe(false);\n      expect(response.body.error).toBe('Endpoint not found');\n    });\n\n    it('should handle invalid JSON', async () => {\n      const response = await request(app)\n        .post('/api/test')\n        .send('invalid json')\n        .expect(400);\n    });\n  });\n\n  describe('Security', () => {\n    it('should have security headers', async () => {\n      const response = await request(app)\n        .get('/api/health');\n      \n      expect(response.headers['x-content-type-options']).toBeDefined();\n      expect(response.headers['x-frame-options']).toBeDefined();\n    });\n\n    it('should handle rate limiting', async () => {\n      // Make multiple requests to test rate limiting\n      const promises = Array(10).fill().map(() => \n        request(app).get('/api/health')\n      );\n      \n      const responses = await Promise.all(promises);\n      expect(responses.every(r => r.status === 200 || r.status === 429)).toBe(true);\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle server errors gracefully', async () => {\n      // Test error middleware\n      const response = await request(app)\n        .get('/api/health');\n      \n      expect(response.status).toBeLessThan(500);\n    });\n  });\n\n  describe('Input Validation', () => {\n    it('should sanitize XSS attempts', async () => {\n      const maliciousInput = '<script>alert(\"xss\")</script>';\n      \n      const response = await request(app)\n        .post('/api/test')\n        .send({ data: maliciousInput });\n      \n      // Should not contain script tags in response\n      expect(JSON.stringify(response.body)).not.toContain('<script>');\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}