{"version":3,"names":["_chaosScheduler","require","describe","scheduler","mockConfig","beforeEach","enabled","intensity","targetServices","excludeServices","schedule","frequency","duration","requireApproval","ChaosScheduler","afterEach","stop","it","expect","toBeDefined","consoleSpy","jest","spyOn","console","start","toHaveBeenCalledWith","stringContaining","mockRestore","disabledConfig","disabledScheduler","history","getHistory","Array","isArray","toBe","activeEvents","getActiveEvents","done","engine","on","result","eventId","injectChaos","highConfig","highScheduler","toContain"],"sources":["chaos-scheduler.test.ts"],"sourcesContent":["import { ChaosScheduler } from '../src/chaos-scheduler';\r\nimport { ChaosConfig } from '../src/failure-types';\r\n\r\ndescribe('ChaosScheduler', () => {\r\n  let scheduler: ChaosScheduler;\r\n  let mockConfig: ChaosConfig;\r\n\r\n  beforeEach(() => {\r\n    mockConfig = {\r\n      enabled: true,\r\n      intensity: 'low',\r\n      targetServices: ['test-service-1', 'test-service-2'],\r\n      excludeServices: ['azora-auth', 'azora-pay'],\r\n      schedule: {\r\n        frequency: '*/5 * * * *', // Every 5 minutes for testing\r\n        duration: 1 // 1 minute\r\n      },\r\n      requireApproval: false\r\n    };\r\n\r\n    scheduler = new ChaosScheduler(mockConfig);\r\n  });\r\n\r\n  afterEach(() => {\r\n    scheduler.stop();\r\n  });\r\n\r\n  describe('Scheduler Initialization', () => {\r\n    it('should initialize with config', () => {\r\n      expect(scheduler).toBeDefined();\r\n    });\r\n\r\n    it('should start scheduler when enabled', () => {\r\n      const consoleSpy = jest.spyOn(console, 'log');\r\n      scheduler.start();\r\n\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('ChaosMonkey started')\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n\r\n    it('should not start when disabled', () => {\r\n      const disabledConfig = { ...mockConfig, enabled: false };\r\n      const disabledScheduler = new ChaosScheduler(disabledConfig);\r\n      \r\n      const consoleSpy = jest.spyOn(console, 'log');\r\n      disabledScheduler.start();\r\n\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('ChaosMonkey is disabled')\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n\r\n    it('should stop scheduler', () => {\r\n      scheduler.start();\r\n      const consoleSpy = jest.spyOn(console, 'log');\r\n      \r\n      scheduler.stop();\r\n\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('ChaosMonkey stopped')\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n  });\r\n\r\n  describe('Chaos History', () => {\r\n    it('should retrieve chaos history', () => {\r\n      const history = scheduler.getHistory();\r\n\r\n      expect(Array.isArray(history)).toBe(true);\r\n    });\r\n\r\n    it('should retrieve active events', () => {\r\n      const activeEvents = scheduler.getActiveEvents();\r\n\r\n      expect(Array.isArray(activeEvents)).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Event Handling', () => {\r\n    it('should listen to chaos-injected events', (done) => {\r\n      scheduler.start();\r\n\r\n      // Listen for the event\r\n      const engine = (scheduler as any).engine;\r\n      engine.on('chaos-injected', (result: any) => {\r\n        expect(result).toBeDefined();\r\n        expect(result.eventId).toBeDefined();\r\n        done();\r\n      });\r\n\r\n      // Manually trigger chaos for testing\r\n      engine.injectChaos();\r\n    });\r\n  });\r\n\r\n  describe('Configuration', () => {\r\n    it('should respect intensity setting', () => {\r\n      const highConfig = { ...mockConfig, intensity: 'high' as const };\r\n      const highScheduler = new ChaosScheduler(highConfig);\r\n\r\n      expect(highScheduler).toBeDefined();\r\n    });\r\n\r\n    it('should respect target services', () => {\r\n      expect(mockConfig.targetServices).toContain('test-service-1');\r\n      expect(mockConfig.targetServices).toContain('test-service-2');\r\n    });\r\n\r\n    it('should respect excluded services', () => {\r\n      expect(mockConfig.excludeServices).toContain('azora-auth');\r\n      expect(mockConfig.excludeServices).toContain('azora-pay');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}