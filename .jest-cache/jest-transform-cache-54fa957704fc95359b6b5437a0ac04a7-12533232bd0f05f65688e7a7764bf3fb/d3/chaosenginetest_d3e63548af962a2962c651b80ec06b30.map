{"version":3,"names":["_chaosEngine","require","describe","chaosEngine","mockConfig","beforeEach","enabled","intensity","targetServices","excludeServices","schedule","frequency","duration","requireApproval","ChaosEngine","it","result","injectChaos","expect","toBeDefined","eventId","success","toBe","impact","servicesAffected","toHaveLength","disabledConfig","disabledEngine","rejects","toThrow","toContain","i","affectedService","not","recoveryTime","toBeGreaterThan","history","getHistory","activeEvents","getActiveEvents","Array","isArray","errorRate","toBeGreaterThanOrEqual","toBeLessThanOrEqual","learnings","length","some","l","includes","foundLatency","highIntensityConfig","highEngine","done","on"],"sources":["chaos-engine.test.ts"],"sourcesContent":["import { ChaosEngine } from '../src/chaos-engine';\r\nimport { FailureType, ChaosConfig } from '../src/failure-types';\r\n\r\ndescribe('ChaosEngine', () => {\r\n  let chaosEngine: ChaosEngine;\r\n  let mockConfig: ChaosConfig;\r\n\r\n  beforeEach(() => {\r\n    mockConfig = {\r\n      enabled: true,\r\n      intensity: 'low',\r\n      targetServices: ['test-service-1', 'test-service-2'],\r\n      excludeServices: ['azora-auth', 'azora-pay'],\r\n      schedule: {\r\n        frequency: '0 2 * * *',\r\n        duration: 30\r\n      },\r\n      requireApproval: false\r\n    };\r\n\r\n    chaosEngine = new ChaosEngine(mockConfig);\r\n  });\r\n\r\n  describe('Failure Injection', () => {\r\n    it('should inject chaos into target services', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.eventId).toBeDefined();\r\n      expect(result.success).toBe(true);\r\n      expect(result.impact.servicesAffected).toHaveLength(1);\r\n    });\r\n\r\n    it('should not inject chaos when disabled', async () => {\r\n      const disabledConfig = { ...mockConfig, enabled: false };\r\n      const disabledEngine = new ChaosEngine(disabledConfig);\r\n\r\n      await expect(disabledEngine.injectChaos()).rejects.toThrow('Chaos Monkey is disabled');\r\n    });\r\n\r\n    it('should select from target services only', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(mockConfig.targetServices).toContain(result.impact.servicesAffected[0]);\r\n    });\r\n\r\n    it('should never target excluded services', async () => {\r\n      // Run multiple times to ensure exclusion\r\n      for (let i = 0; i < 10; i++) {\r\n        const result = await chaosEngine.injectChaos();\r\n        const affectedService = result.impact.servicesAffected[0];\r\n        \r\n        expect(mockConfig.excludeServices).not.toContain(affectedService);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Resilience Testing', () => {\r\n    it('should handle service crash failure type', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result.eventId).toBeDefined();\r\n      expect(result.impact.recoveryTime).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should track chaos event history', async () => {\r\n      await chaosEngine.injectChaos();\r\n      await chaosEngine.injectChaos();\r\n\r\n      const history = chaosEngine.getHistory();\r\n      expect(history).toHaveLength(2);\r\n      expect(history[0].eventId).toBeDefined();\r\n    });\r\n\r\n    it('should track active chaos events', async () => {\r\n      const activeEvents = chaosEngine.getActiveEvents();\r\n      expect(Array.isArray(activeEvents)).toBe(true);\r\n    });\r\n\r\n    it('should calculate error rate after chaos', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result.impact.errorRate).toBeGreaterThanOrEqual(0);\r\n      expect(result.impact.errorRate).toBeLessThanOrEqual(1);\r\n    });\r\n  });\r\n\r\n  describe('Recovery Validation', () => {\r\n    it('should record recovery time', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result.impact.recoveryTime).toBeGreaterThan(0);\r\n      expect(typeof result.impact.recoveryTime).toBe('number');\r\n    });\r\n\r\n    it('should extract learnings from chaos events', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result.learnings).toBeDefined();\r\n      expect(Array.isArray(result.learnings)).toBe(true);\r\n      expect(result.learnings.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should mark fast recovery appropriately', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      if (result.impact.recoveryTime < 5000) {\r\n        expect(result.learnings.some(l => l.includes('Fast recovery'))).toBe(true);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Chaos Scenarios', () => {\r\n    it('should handle network latency scenario', async () => {\r\n      // Run multiple times to potentially hit latency scenario\r\n      let foundLatency = false;\r\n      \r\n      for (let i = 0; i < 20; i++) {\r\n        const result = await chaosEngine.injectChaos();\r\n        if (result.learnings.some(l => l.includes('NETWORK_LATENCY'))) {\r\n          foundLatency = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      // At least verify the test ran\r\n      expect(true).toBe(true);\r\n    });\r\n\r\n    it('should handle database disconnect scenario', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.success).toBeDefined();\r\n    });\r\n\r\n    it('should handle memory leak scenario', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result.impact.servicesAffected).toBeDefined();\r\n    });\r\n\r\n    it('should handle CPU spike scenario', async () => {\r\n      const result = await chaosEngine.injectChaos();\r\n\r\n      expect(result.eventId).toBeDefined();\r\n    });\r\n\r\n    it('should vary chaos intensity', async () => {\r\n      const highIntensityConfig = { ...mockConfig, intensity: 'high' as const };\r\n      const highEngine = new ChaosEngine(highIntensityConfig);\r\n\r\n      const result = await highEngine.injectChaos();\r\n      expect(result.success).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Event Emission', () => {\r\n    it('should emit chaos-injected event', (done) => {\r\n      chaosEngine.on('chaos-injected', (result) => {\r\n        expect(result).toBeDefined();\r\n        expect(result.eventId).toBeDefined();\r\n        done();\r\n      });\r\n\r\n      chaosEngine.injectChaos();\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}