04dba5aef5223d96d0be08d7828296f6
"use strict";

const request = require('supertest');
const app = require('../server.js');
describe('KYC/AML Service', () => {
  describe('GET /health', () => {
    it('should return health status', async () => {
      const response = await request(app).get('/health');
      expect(response.status).toBe(200);
      expect(response.body.status).toBe('OK');
      expect(response.body.service).toBe('kyc-aml-service');
    });
  });
  describe('POST /api/kyc/verify', () => {
    it('should verify user identity', async () => {
      const userData = {
        userId: 'user_123',
        documentType: 'passport',
        documentNumber: 'P12345678'
      };
      const response = await request(app).post('/api/kyc/verify').send(userData).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.verificationId).toBeDefined();
      expect(response.body.status).toBe('verified');
    });
    it('should return error when required fields are missing', async () => {
      const userData = {
        userId: 'user_123'
      };
      const response = await request(app).post('/api/kyc/verify').send(userData).set('Accept', 'application/json');
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Document type and number are required');
    });
  });
  describe('GET /api/aml/check/:userId', () => {
    it('should check user against watchlists', async () => {
      const userId = 'user_123';
      const response = await request(app).get(`/api/aml/check/${userId}`).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.userId).toBe(userId);
      expect(response.body.isSanctioned).toBeDefined();
    });
  });
  describe('404 handling', () => {
    it('should return 404 for unknown routes', async () => {
      const response = await request(app).get('/non-existent-route');
      expect(response.status).toBe(404);
      expect(response.body.error).toBe('Route not found');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5Iiwic2VydmljZSIsInVzZXJEYXRhIiwidXNlcklkIiwiZG9jdW1lbnRUeXBlIiwiZG9jdW1lbnROdW1iZXIiLCJwb3N0Iiwic2VuZCIsInNldCIsInN1Y2Nlc3MiLCJ2ZXJpZmljYXRpb25JZCIsInRvQmVEZWZpbmVkIiwiZXJyb3IiLCJpc1NhbmN0aW9uZWQiXSwic291cmNlcyI6WyJreWMtYW1sLXNlcnZpY2UudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XHJcbmNvbnN0IGFwcCA9IHJlcXVpcmUoJy4uL3NlcnZlci5qcycpO1xyXG5cclxuZGVzY3JpYmUoJ0tZQy9BTUwgU2VydmljZScsICgpID0+IHtcclxuICBkZXNjcmliZSgnR0VUIC9oZWFsdGgnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBoZWFsdGggc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9oZWFsdGgnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoJ09LJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnNlcnZpY2UpLnRvQmUoJ2t5Yy1hbWwtc2VydmljZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQT1NUIC9hcGkva3ljL3ZlcmlmeScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdmVyaWZ5IHVzZXIgaWRlbnRpdHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xyXG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcclxuICAgICAgICBkb2N1bWVudFR5cGU6ICdwYXNzcG9ydCcsXHJcbiAgICAgICAgZG9jdW1lbnROdW1iZXI6ICdQMTIzNDU2NzgnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL2t5Yy92ZXJpZnknKVxyXG4gICAgICAgIC5zZW5kKHVzZXJEYXRhKVxyXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnZlcmlmaWNhdGlvbklkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoJ3ZlcmlmaWVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBlcnJvciB3aGVuIHJlcXVpcmVkIGZpZWxkcyBhcmUgbWlzc2luZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XHJcbiAgICAgICAgdXNlcklkOiAndXNlcl8xMjMnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL2t5Yy92ZXJpZnknKVxyXG4gICAgICAgIC5zZW5kKHVzZXJEYXRhKVxyXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlKCdEb2N1bWVudCB0eXBlIGFuZCBudW1iZXIgYXJlIHJlcXVpcmVkJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0dFVCAvYXBpL2FtbC9jaGVjay86dXNlcklkJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjaGVjayB1c2VyIGFnYWluc3Qgd2F0Y2hsaXN0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXJfMTIzJztcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLmdldChgL2FwaS9hbWwvY2hlY2svJHt1c2VySWR9YClcclxuICAgICAgICAuc2V0KCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS51c2VySWQpLnRvQmUodXNlcklkKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuaXNTYW5jdGlvbmVkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCc0MDQgaGFuZGxpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDQgZm9yIHVua25vd24gcm91dGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9ub24tZXhpc3RlbnQtcm91dGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDQpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG9CZSgnUm91dGUgbm90IGZvdW5kJyk7XHJcbiAgICB9KTtcclxuICB9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