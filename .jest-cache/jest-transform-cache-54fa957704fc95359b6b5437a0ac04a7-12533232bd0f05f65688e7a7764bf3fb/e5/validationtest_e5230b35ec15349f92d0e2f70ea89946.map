{"version":3,"names":["_zod","require","_validation","describe","req","res","next","beforeEach","body","query","params","status","jest","fn","mockReturnThis","json","it","schema","z","object","email","string","middleware","validate","expect","toHaveBeenCalledWith","toHaveBeenCalled","response","mock","calls","error","toBe","details","toBeDefined","Array","isArray","name","min","age","number","page","transform","Number","pipe","id","uuid","password","user","profile","firstName","lastName","tags","array","ids"],"sources":["validation.test.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { z } from 'zod';\r\nimport { validate } from '../validation';\r\n\r\ndescribe('Validation Middleware', () => {\r\n  let req: Partial<Request>;\r\n  let res: Partial<Response>;\r\n  let next: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    req = {\r\n      body: {},\r\n      query: {},\r\n      params: {}\r\n    };\r\n    res = {\r\n      status: jest.fn().mockReturnThis(),\r\n      json: jest.fn().mockReturnThis()\r\n    };\r\n    next = jest.fn();\r\n  });\r\n\r\n  describe('validate', () => {\r\n    it('should call next when validation passes', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          email: z.string().email()\r\n        })\r\n      });\r\n\r\n      req.body = { email: 'test@azora.world' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should return 400 when validation fails', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          email: z.string().email()\r\n        })\r\n      });\r\n\r\n      req.body = { email: 'invalid-email' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(res.status).toHaveBeenCalledWith(400);\r\n      expect(res.json).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should return validation error details', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          email: z.string().email()\r\n        })\r\n      });\r\n\r\n      req.body = { email: 'invalid' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      const response = (res.json as jest.Mock).mock.calls[0][0];\r\n      expect(response.error).toBe('Validation failed');\r\n      expect(response.details).toBeDefined();\r\n      expect(Array.isArray(response.details)).toBe(true);\r\n    });\r\n\r\n    it('should validate body fields', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          name: z.string().min(1),\r\n          age: z.number().min(0)\r\n        })\r\n      });\r\n\r\n      req.body = { name: 'John', age: 25 };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should validate query parameters', async () => {\r\n      const schema = z.object({\r\n        query: z.object({\r\n          page: z.string().transform(Number).pipe(z.number().min(1))\r\n        })\r\n      });\r\n\r\n      req.query = { page: '1' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should validate path parameters', async () => {\r\n      const schema = z.object({\r\n        params: z.object({\r\n          id: z.string().uuid()\r\n        })\r\n      });\r\n\r\n      req.params = { id: '550e8400-e29b-41d4-a716-446655440000' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should reject invalid UUID', async () => {\r\n      const schema = z.object({\r\n        params: z.object({\r\n          id: z.string().uuid()\r\n        })\r\n      });\r\n\r\n      req.params = { id: 'not-a-uuid' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(res.status).toHaveBeenCalledWith(400);\r\n    });\r\n\r\n    it('should validate multiple fields', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          email: z.string().email(),\r\n          password: z.string().min(8),\r\n          name: z.string().min(1)\r\n        })\r\n      });\r\n\r\n      req.body = {\r\n        email: 'test@azora.world',\r\n        password: 'SecurePass123',\r\n        name: 'Test User'\r\n      };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should reject when required field is missing', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          email: z.string().email(),\r\n          password: z.string().min(8)\r\n        })\r\n      });\r\n\r\n      req.body = { email: 'test@azora.world' };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(res.status).toHaveBeenCalledWith(400);\r\n    });\r\n\r\n    it('should handle complex nested validation', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          user: z.object({\r\n            email: z.string().email(),\r\n            profile: z.object({\r\n              firstName: z.string(),\r\n              lastName: z.string()\r\n            })\r\n          })\r\n        })\r\n      });\r\n\r\n      req.body = {\r\n        user: {\r\n          email: 'test@azora.world',\r\n          profile: {\r\n            firstName: 'John',\r\n            lastName: 'Doe'\r\n          }\r\n        }\r\n      };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should validate arrays', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          tags: z.array(z.string())\r\n        })\r\n      });\r\n\r\n      req.body = { tags: ['education', 'technology'] };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(next).toHaveBeenCalledWith();\r\n    });\r\n\r\n    it('should reject invalid array items', async () => {\r\n      const schema = z.object({\r\n        body: z.object({\r\n          ids: z.array(z.number())\r\n        })\r\n      });\r\n\r\n      req.body = { ids: [1, 'invalid', 3] };\r\n\r\n      const middleware = validate(schema);\r\n      await middleware(req as Request, res as Response, next);\r\n\r\n      expect(res.status).toHaveBeenCalledWith(400);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}