791303f2c734b41e317df77d3c33bbb0
"use strict";

const request = require('supertest');
const app = require('../server.js');
describe('Azora Pay Service', () => {
  describe('GET /health', () => {
    it('should return health status', async () => {
      const response = await request(app).get('/health');
      expect(response.status).toBe(200);
      expect(response.body.status).toBe('OK');
      expect(response.body.service).toBe('azora-pay');
    });
  });
  describe('POST /api/payments', () => {
    it('should process a payment successfully', async () => {
      const paymentData = {
        amount: 100,
        currency: 'USD',
        description: 'Test payment'
      };
      const response = await request(app).post('/api/payments').send(paymentData).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.amount).toBe(paymentData.amount);
      expect(response.body.currency).toBe(paymentData.currency);
      expect(response.body.description).toBe(paymentData.description);
      expect(response.body.paymentId).toBeDefined();
      expect(response.body.status).toBe('processed');
    });
    it('should return error when amount is missing', async () => {
      const paymentData = {
        currency: 'USD'
      };
      const response = await request(app).post('/api/payments').send(paymentData).set('Accept', 'application/json');
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Amount and currency are required');
    });
    it('should return error when currency is missing', async () => {
      const paymentData = {
        amount: 100
      };
      const response = await request(app).post('/api/payments').send(paymentData).set('Accept', 'application/json');
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Amount and currency are required');
    });
  });
  describe('GET /api/payments/:paymentId', () => {
    it('should return payment status', async () => {
      const paymentId = 'pay_12345';
      const response = await request(app).get(`/api/payments/${paymentId}`).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.paymentId).toBe(paymentId);
      expect(response.body.status).toBe('processed');
    });
  });
  describe('404 handling', () => {
    it('should return 404 for unknown routes', async () => {
      const response = await request(app).get('/non-existent-route');
      expect(response.status).toBe(404);
      expect(response.body.error).toBe('Route not found');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5Iiwic2VydmljZSIsInBheW1lbnREYXRhIiwiYW1vdW50IiwiY3VycmVuY3kiLCJkZXNjcmlwdGlvbiIsInBvc3QiLCJzZW5kIiwic2V0Iiwic3VjY2VzcyIsInBheW1lbnRJZCIsInRvQmVEZWZpbmVkIiwiZXJyb3IiXSwic291cmNlcyI6WyJhem9yYS1wYXkudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XHJcbmNvbnN0IGFwcCA9IHJlcXVpcmUoJy4uL3NlcnZlci5qcycpO1xyXG5cclxuZGVzY3JpYmUoJ0F6b3JhIFBheSBTZXJ2aWNlJywgKCkgPT4ge1xyXG4gIGRlc2NyaWJlKCdHRVQgL2hlYWx0aCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGhlYWx0aCBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmdldCgnL2hlYWx0aCcpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN0YXR1cykudG9CZSgnT0snKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc2VydmljZSkudG9CZSgnYXpvcmEtcGF5Jyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1BPU1QgL2FwaS9wYXltZW50cycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcHJvY2VzcyBhIHBheW1lbnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXltZW50RGF0YSA9IHtcclxuICAgICAgICBhbW91bnQ6IDEwMCxcclxuICAgICAgICBjdXJyZW5jeTogJ1VTRCcsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IHBheW1lbnQnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL3BheW1lbnRzJylcclxuICAgICAgICAuc2VuZChwYXltZW50RGF0YSlcclxuICAgICAgICAuc2V0KCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5hbW91bnQpLnRvQmUocGF5bWVudERhdGEuYW1vdW50KTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuY3VycmVuY3kpLnRvQmUocGF5bWVudERhdGEuY3VycmVuY3kpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kZXNjcmlwdGlvbikudG9CZShwYXltZW50RGF0YS5kZXNjcmlwdGlvbik7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnBheW1lbnRJZCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3RhdHVzKS50b0JlKCdwcm9jZXNzZWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHdoZW4gYW1vdW50IGlzIG1pc3NpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBheW1lbnREYXRhID0ge1xyXG4gICAgICAgIGN1cnJlbmN5OiAnVVNEJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cycpXHJcbiAgICAgICAgLnNlbmQocGF5bWVudERhdGEpXHJcbiAgICAgICAgLnNldCgnQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvQmUoJ0Ftb3VudCBhbmQgY3VycmVuY3kgYXJlIHJlcXVpcmVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBlcnJvciB3aGVuIGN1cnJlbmN5IGlzIG1pc3NpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBheW1lbnREYXRhID0ge1xyXG4gICAgICAgIGFtb3VudDogMTAwXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL3BheW1lbnRzJylcclxuICAgICAgICAuc2VuZChwYXltZW50RGF0YSlcclxuICAgICAgICAuc2V0KCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG9CZSgnQW1vdW50IGFuZCBjdXJyZW5jeSBhcmUgcmVxdWlyZWQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnR0VUIC9hcGkvcGF5bWVudHMvOnBheW1lbnRJZCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHBheW1lbnQgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXltZW50SWQgPSAncGF5XzEyMzQ1JztcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLmdldChgL2FwaS9wYXltZW50cy8ke3BheW1lbnRJZH1gKVxyXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnBheW1lbnRJZCkudG9CZShwYXltZW50SWQpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoJ3Byb2Nlc3NlZCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCc0MDQgaGFuZGxpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDQgZm9yIHVua25vd24gcm91dGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9ub24tZXhpc3RlbnQtcm91dGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDQpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG9CZSgnUm91dGUgbm90IGZvdW5kJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNwQyxNQUFNQyxHQUFHLEdBQUdELE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFFbkNFLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxNQUFNO0VBQ2xDQSxRQUFRLENBQUMsYUFBYSxFQUFFLE1BQU07SUFDNUJDLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxZQUFZO01BQzVDLE1BQU1DLFFBQVEsR0FBRyxNQUFNTCxPQUFPLENBQUNFLEdBQUcsQ0FBQyxDQUFDSSxHQUFHLENBQUMsU0FBUyxDQUFDO01BQ2xEQyxNQUFNLENBQUNGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDakNG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