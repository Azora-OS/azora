{"version":3,"names":["express","require","path","fs","cors","crypto","app","PORT","process","env","RELEASE_DIR","join","__dirname","CONFIG_DIR","ANALYTICS_DIR","forEach","dir","existsSync","mkdirSync","recursive","use","json","static","analytics","updateChecks","Map","downloads","installations","rollbacks","loadRolloutConfig","channel","configPath","JSON","parse","readFileSync","error","console","version","percentage","startDate","Date","toISOString","endDate","saveRolloutConfig","config","writeFileSync","stringify","shouldReceiveUpdate","clientId","hash","createHash","update","digest","hashValue","parseInt","substring","trackEvent","category","action","label","value","key","map","set","get","Math","random","saveAnalytics","timestamp","split","analyticsPath","data","date","Object","fromEntries","req","res","status","channels","query","ip","currentVersion","manifestPath","send","manifest","type","fromVersion","toVersion","params","deltaPath","fallback","download","versionPath","files","readdirSync","releaseNotesPath","releaseNotes","hasDelta","some","f","startsWith","channelPath","versions","filter","file","filePath","statSync","isDirectory","sort","a","b","localeCompare","post","previousVersion","body","success","reason","rollbackLog","logPath","appendFileSync","includes","days","analyticsFiles","i","setDate","getDate","dateStr","push","period","sourceManifest","targetManifest","copyFileSync","message","details","on","log","exit","setInterval","listen","module","exports"],"sources":["update-server.js"],"sourcesContent":["/**\n * Enhanced Update Server for AzStudio\n * \n * Features:\n * - Staged rollout support (alpha/beta/stable channels)\n * - Delta updates for efficient downloads\n * - Rollback capability\n * - Analytics and monitoring\n * - Rate limiting and security\n */\n\nconst express = require('express');\nconst path = require('path');\nconst fs = require('fs');\nconst cors = require('cors');\nconst crypto = require('crypto');\n\nconst app = express();\nconst PORT = process.env.PORT || 3001;\nconst RELEASE_DIR = path.join(__dirname, '..', 'release');\nconst CONFIG_DIR = path.join(__dirname, '..', 'release', 'config');\nconst ANALYTICS_DIR = path.join(__dirname, '..', 'release', 'analytics');\n\n// Ensure directories exist\n[CONFIG_DIR, ANALYTICS_DIR].forEach(dir => {\n  if (!fs.existsSync(dir)) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n});\n\n// Enable CORS for update checks\napp.use(cors());\napp.use(express.json());\n\n// Serve static files from release directory\napp.use(express.static(RELEASE_DIR));\n\n// Analytics tracking\nconst analytics = {\n  updateChecks: new Map(),\n  downloads: new Map(),\n  installations: new Map(),\n  rollbacks: new Map()\n};\n\n// Load rollout configuration\nfunction loadRolloutConfig(channel) {\n  const configPath = path.join(CONFIG_DIR, `${channel}-rollout.json`);\n  if (fs.existsSync(configPath)) {\n    try {\n      return JSON.parse(fs.readFileSync(configPath, 'utf-8'));\n    } catch (error) {\n      console.error(`Failed to load rollout config for ${channel}:`, error);\n    }\n  }\n  \n  // Default: 100% rollout\n  return {\n    version: null,\n    percentage: 100,\n    startDate: new Date().toISOString(),\n    endDate: null\n  };\n}\n\n// Save rollout configuration\nfunction saveRolloutConfig(channel, config) {\n  const configPath = path.join(CONFIG_DIR, `${channel}-rollout.json`);\n  try {\n    fs.writeFileSync(configPath, JSON.stringify(config, null, 2));\n    return true;\n  } catch (error) {\n    console.error(`Failed to save rollout config for ${channel}:`, error);\n    return false;\n  }\n}\n\n// Check if client should receive update based on staged rollout\nfunction shouldReceiveUpdate(channel, clientId) {\n  const config = loadRolloutConfig(channel);\n  \n  if (config.percentage >= 100) {\n    return true;\n  }\n  \n  // Use consistent hashing to determine if client is in rollout group\n  const hash = crypto.createHash('sha256')\n    .update(clientId + config.version)\n    .digest('hex');\n  const hashValue = parseInt(hash.substring(0, 8), 16);\n  const percentage = (hashValue % 100) + 1;\n  \n  return percentage <= config.percentage;\n}\n\n// Track analytics event\nfunction trackEvent(category, action, label, value = 1) {\n  const key = `${category}:${action}:${label}`;\n  const map = analytics[category] || new Map();\n  map.set(key, (map.get(key) || 0) + value);\n  analytics[category] = map;\n  \n  // Persist analytics periodically\n  if (Math.random() < 0.1) { // 10% chance to save\n    saveAnalytics();\n  }\n}\n\n// Save analytics to disk\nfunction saveAnalytics() {\n  const timestamp = new Date().toISOString().split('T')[0];\n  const analyticsPath = path.join(ANALYTICS_DIR, `analytics-${timestamp}.json`);\n  \n  const data = {\n    date: timestamp,\n    updateChecks: Object.fromEntries(analytics.updateChecks),\n    downloads: Object.fromEntries(analytics.downloads),\n    installations: Object.fromEntries(analytics.installations),\n    rollbacks: Object.fromEntries(analytics.rollbacks)\n  };\n  \n  try {\n    fs.writeFileSync(analyticsPath, JSON.stringify(data, null, 2));\n  } catch (error) {\n    console.error('Failed to save analytics:', error);\n  }\n}\n\n// Health check endpoint\napp.get('/health', (req, res) => {\n  res.json({ \n    status: 'ok', \n    timestamp: new Date().toISOString(),\n    channels: ['alpha', 'beta', 'stable']\n  });\n});\n\n// Get latest version info with staged rollout support\napp.get('/latest', (req, res) => {\n  const channel = req.query.channel || 'stable';\n  const clientId = req.query.clientId || req.ip;\n  const currentVersion = req.query.currentVersion;\n  \n  trackEvent('updateChecks', channel, currentVersion || 'unknown');\n  \n  const manifestPath = path.join(RELEASE_DIR, channel, 'latest.yml');\n  \n  if (!fs.existsSync(manifestPath)) {\n    return res.status(404).json({ error: 'No updates available' });\n  }\n  \n  // Check staged rollout\n  if (!shouldReceiveUpdate(channel, clientId)) {\n    return res.status(204).send(); // No update for this client yet\n  }\n  \n  try {\n    const manifest = fs.readFileSync(manifestPath, 'utf-8');\n    res.type('text/yaml').send(manifest);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to read manifest' });\n  }\n});\n\n// Get delta update if available\napp.get('/delta/:channel/:fromVersion/:toVersion', (req, res) => {\n  const { channel, fromVersion, toVersion } = req.params;\n  const deltaPath = path.join(RELEASE_DIR, channel, toVersion, `delta-${fromVersion}-${toVersion}.nupkg`);\n  \n  if (!fs.existsSync(deltaPath)) {\n    return res.status(404).json({ \n      error: 'Delta update not available',\n      fallback: `/download/${channel}/${toVersion}/full`\n    });\n  }\n  \n  trackEvent('downloads', 'delta', `${channel}:${fromVersion}-${toVersion}`);\n  res.download(deltaPath);\n});\n\n// Get specific version info\napp.get('/version/:version', (req, res) => {\n  const { version } = req.params;\n  const channel = req.query.channel || 'stable';\n  const versionPath = path.join(RELEASE_DIR, channel, version);\n  \n  if (!fs.existsSync(versionPath)) {\n    return res.status(404).json({ error: 'Version not found' });\n  }\n  \n  const files = fs.readdirSync(versionPath);\n  const releaseNotesPath = path.join(versionPath, 'RELEASE_NOTES.md');\n  const releaseNotes = fs.existsSync(releaseNotesPath) \n    ? fs.readFileSync(releaseNotesPath, 'utf-8')\n    : null;\n  \n  res.json({ \n    version, \n    channel,\n    files,\n    releaseNotes,\n    hasDelta: files.some(f => f.startsWith('delta-'))\n  });\n});\n\n// List all available versions\napp.get('/versions', (req, res) => {\n  const channel = req.query.channel || 'stable';\n  const channelPath = path.join(RELEASE_DIR, channel);\n  \n  if (!fs.existsSync(channelPath)) {\n    return res.json({ versions: [] });\n  }\n  \n  try {\n    const versions = fs.readdirSync(channelPath)\n      .filter(file => {\n        const filePath = path.join(channelPath, file);\n        return fs.statSync(filePath).isDirectory();\n      })\n      .sort((a, b) => b.localeCompare(a)); // Sort descending\n    \n    res.json({ channel, versions });\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to list versions' });\n  }\n});\n\n// Download installer\napp.get('/download/:channel/:version/:file', (req, res) => {\n  const { channel, version, file } = req.params;\n  const filePath = path.join(RELEASE_DIR, channel, version, file);\n  \n  if (!fs.existsSync(filePath)) {\n    return res.status(404).json({ error: 'File not found' });\n  }\n  \n  trackEvent('downloads', 'full', `${channel}:${version}:${file}`);\n  res.download(filePath);\n});\n\n// Report successful installation\napp.post('/report/install', (req, res) => {\n  const { channel, version, previousVersion, clientId } = req.body;\n  \n  if (!channel || !version) {\n    return res.status(400).json({ error: 'Missing required fields' });\n  }\n  \n  trackEvent('installations', channel, `${previousVersion || 'new'}->${version}`);\n  res.json({ success: true });\n});\n\n// Report rollback\napp.post('/report/rollback', (req, res) => {\n  const { channel, fromVersion, toVersion, reason, clientId } = req.body;\n  \n  if (!channel || !fromVersion || !toVersion) {\n    return res.status(400).json({ error: 'Missing required fields' });\n  }\n  \n  trackEvent('rollbacks', channel, `${fromVersion}->${toVersion}`);\n  \n  // Log rollback for investigation\n  const rollbackLog = {\n    timestamp: new Date().toISOString(),\n    channel,\n    fromVersion,\n    toVersion,\n    reason,\n    clientId: clientId || 'unknown'\n  };\n  \n  const logPath = path.join(ANALYTICS_DIR, 'rollbacks.log');\n  fs.appendFileSync(logPath, JSON.stringify(rollbackLog) + '\\n');\n  \n  res.json({ success: true });\n});\n\n// Admin: Configure staged rollout\napp.post('/admin/rollout/:channel', (req, res) => {\n  const { channel } = req.params;\n  const { version, percentage, startDate, endDate } = req.body;\n  \n  if (!['alpha', 'beta', 'stable'].includes(channel)) {\n    return res.status(400).json({ error: 'Invalid channel' });\n  }\n  \n  if (percentage < 0 || percentage > 100) {\n    return res.status(400).json({ error: 'Percentage must be between 0 and 100' });\n  }\n  \n  const config = {\n    version,\n    percentage,\n    startDate: startDate || new Date().toISOString(),\n    endDate: endDate || null\n  };\n  \n  if (saveRolloutConfig(channel, config)) {\n    res.json({ success: true, config });\n  } else {\n    res.status(500).json({ error: 'Failed to save configuration' });\n  }\n});\n\n// Admin: Get rollout configuration\napp.get('/admin/rollout/:channel', (req, res) => {\n  const { channel } = req.params;\n  \n  if (!['alpha', 'beta', 'stable'].includes(channel)) {\n    return res.status(400).json({ error: 'Invalid channel' });\n  }\n  \n  const config = loadRolloutConfig(channel);\n  res.json(config);\n});\n\n// Admin: Get analytics\napp.get('/admin/analytics', (req, res) => {\n  const days = parseInt(req.query.days) || 7;\n  const analyticsFiles = [];\n  \n  for (let i = 0; i < days; i++) {\n    const date = new Date();\n    date.setDate(date.getDate() - i);\n    const dateStr = date.toISOString().split('T')[0];\n    const filePath = path.join(ANALYTICS_DIR, `analytics-${dateStr}.json`);\n    \n    if (fs.existsSync(filePath)) {\n      try {\n        const data = JSON.parse(fs.readFileSync(filePath, 'utf-8'));\n        analyticsFiles.push(data);\n      } catch (error) {\n        console.error(`Failed to read analytics for ${dateStr}:`, error);\n      }\n    }\n  }\n  \n  res.json({\n    period: `${days} days`,\n    data: analyticsFiles\n  });\n});\n\n// Admin: Trigger rollback for a channel\napp.post('/admin/rollback/:channel', (req, res) => {\n  const { channel } = req.params;\n  const { toVersion } = req.body;\n  \n  if (!['alpha', 'beta', 'stable'].includes(channel)) {\n    return res.status(400).json({ error: 'Invalid channel' });\n  }\n  \n  const versionPath = path.join(RELEASE_DIR, channel, toVersion);\n  if (!fs.existsSync(versionPath)) {\n    return res.status(404).json({ error: 'Target version not found' });\n  }\n  \n  // Copy the target version's manifest to latest.yml\n  const sourceManifest = path.join(versionPath, 'latest.yml');\n  const targetManifest = path.join(RELEASE_DIR, channel, 'latest.yml');\n  \n  if (!fs.existsSync(sourceManifest)) {\n    return res.status(404).json({ error: 'Version manifest not found' });\n  }\n  \n  try {\n    fs.copyFileSync(sourceManifest, targetManifest);\n    \n    // Reset rollout to 100%\n    saveRolloutConfig(channel, {\n      version: toVersion,\n      percentage: 100,\n      startDate: new Date().toISOString(),\n      endDate: null\n    });\n    \n    res.json({ \n      success: true, \n      message: `Rolled back ${channel} to version ${toVersion}` \n    });\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to rollback', details: error.message });\n  }\n});\n\n// Graceful shutdown\nprocess.on('SIGTERM', () => {\n  console.log('Saving analytics before shutdown...');\n  saveAnalytics();\n  process.exit(0);\n});\n\n// Save analytics periodically\nsetInterval(saveAnalytics, 5 * 60 * 1000); // Every 5 minutes\n\n// Start server\napp.listen(PORT, () => {\n  console.log(`üöÄ AzStudio Update Server running on port ${PORT}`);\n  console.log(`üìÅ Serving files from: ${RELEASE_DIR}`);\n  console.log(`\\nEndpoints:`);\n  console.log(`  GET  /health - Health check`);\n  console.log(`  GET  /latest?channel=stable&clientId=xxx - Get latest version manifest`);\n  console.log(`  GET  /delta/:channel/:fromVersion/:toVersion - Get delta update`);\n  console.log(`  GET  /versions?channel=stable - List all versions`);\n  console.log(`  GET  /version/:version?channel=stable - Get version info`);\n  console.log(`  GET  /download/:channel/:version/:file - Download file`);\n  console.log(`  POST /report/install - Report successful installation`);\n  console.log(`  POST /report/rollback - Report rollback`);\n  console.log(`\\nAdmin Endpoints:`);\n  console.log(`  POST /admin/rollout/:channel - Configure staged rollout`);\n  console.log(`  GET  /admin/rollout/:channel - Get rollout configuration`);\n  console.log(`  GET  /admin/analytics?days=7 - Get analytics data`);\n  console.log(`  POST /admin/rollback/:channel - Trigger rollback`);\n  console.log(`\\nChannels: alpha, beta, stable`);\n});\n\nmodule.exports = app;\n"],"mappings":"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","ignoreList":[]}