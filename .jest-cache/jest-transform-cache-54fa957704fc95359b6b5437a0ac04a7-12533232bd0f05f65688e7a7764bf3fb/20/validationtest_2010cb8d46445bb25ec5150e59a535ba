30874afbf1c82ac04795f439107efb40
"use strict";

var _zod = require("zod");
var _validation = require("../validation");
describe('Validation Middleware', () => {
  let req;
  let res;
  let next;
  beforeEach(() => {
    req = {
      body: {},
      query: {},
      params: {}
    };
    res = {
      status: jest.fn().mockReturnThis(),
      json: jest.fn().mockReturnThis()
    };
    next = jest.fn();
  });
  describe('validate', () => {
    it('should call next when validation passes', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          email: _zod.z.string().email()
        })
      });
      req.body = {
        email: 'test@azora.world'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should return 400 when validation fails', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          email: _zod.z.string().email()
        })
      });
      req.body = {
        email: 'invalid-email'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(res.status).toHaveBeenCalledWith(400);
      expect(res.json).toHaveBeenCalled();
    });
    it('should return validation error details', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          email: _zod.z.string().email()
        })
      });
      req.body = {
        email: 'invalid'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      const response = res.json.mock.calls[0][0];
      expect(response.error).toBe('Validation failed');
      expect(response.details).toBeDefined();
      expect(Array.isArray(response.details)).toBe(true);
    });
    it('should validate body fields', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          name: _zod.z.string().min(1),
          age: _zod.z.number().min(0)
        })
      });
      req.body = {
        name: 'John',
        age: 25
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should validate query parameters', async () => {
      const schema = _zod.z.object({
        query: _zod.z.object({
          page: _zod.z.string().transform(Number).pipe(_zod.z.number().min(1))
        })
      });
      req.query = {
        page: '1'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should validate path parameters', async () => {
      const schema = _zod.z.object({
        params: _zod.z.object({
          id: _zod.z.string().uuid()
        })
      });
      req.params = {
        id: '550e8400-e29b-41d4-a716-446655440000'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should reject invalid UUID', async () => {
      const schema = _zod.z.object({
        params: _zod.z.object({
          id: _zod.z.string().uuid()
        })
      });
      req.params = {
        id: 'not-a-uuid'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(res.status).toHaveBeenCalledWith(400);
    });
    it('should validate multiple fields', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          email: _zod.z.string().email(),
          password: _zod.z.string().min(8),
          name: _zod.z.string().min(1)
        })
      });
      req.body = {
        email: 'test@azora.world',
        password: 'SecurePass123',
        name: 'Test User'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should reject when required field is missing', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          email: _zod.z.string().email(),
          password: _zod.z.string().min(8)
        })
      });
      req.body = {
        email: 'test@azora.world'
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(res.status).toHaveBeenCalledWith(400);
    });
    it('should handle complex nested validation', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          user: _zod.z.object({
            email: _zod.z.string().email(),
            profile: _zod.z.object({
              firstName: _zod.z.string(),
              lastName: _zod.z.string()
            })
          })
        })
      });
      req.body = {
        user: {
          email: 'test@azora.world',
          profile: {
            firstName: 'John',
            lastName: 'Doe'
          }
        }
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should validate arrays', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          tags: _zod.z.array(_zod.z.string())
        })
      });
      req.body = {
        tags: ['education', 'technology']
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(next).toHaveBeenCalledWith();
    });
    it('should reject invalid array items', async () => {
      const schema = _zod.z.object({
        body: _zod.z.object({
          ids: _zod.z.array(_zod.z.number())
        })
      });
      req.body = {
        ids: [1, 'invalid', 3]
      };
      const middleware = (0, _validation.validate)(schema);
      await middleware(req, res, next);
      expect(res.status).toHaveBeenCalledWith(400);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfem9kIiwicmVxdWlyZSIsIl92YWxpZGF0aW9uIiwiZGVzY3JpYmUiLCJyZXEiLCJyZXMiLCJuZXh0IiwiYmVmb3JlRWFjaCIsImJvZHkiLCJxdWVyeSIsInBhcmFtcyIsInN0YXR1cyIsImplc3QiLCJmbiIsIm1vY2tSZXR1cm5UaGlzIiwianNvbiIsIml0Iiwic2NoZW1hIiwieiIsIm9iamVjdCIsImVtYWlsIiwic3RyaW5nIiwibWlkZGxld2FyZSIsInZhbGlkYXRlIiwiZXhwZWN0IiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwicmVzcG9uc2UiLCJtb2NrIiwiY2FsbHMiLCJlcnJvciIsInRvQmUiLCJkZXRhaWxzIiwidG9CZURlZmluZWQiLCJBcnJheSIsImlzQXJyYXkiLCJuYW1lIiwibWluIiwiYWdlIiwibnVtYmVyIiwicGFnZSIsInRyYW5zZm9ybSIsIk51bWJlciIsInBpcGUiLCJpZCIsInV1aWQiLCJwYXNzd29yZCIsInVzZXIiLCJwcm9maWxlIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJ0YWdzIiwiYXJyYXkiLCJpZHMiXSwic291cmNlcyI6WyJ2YWxpZGF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0IHsgdmFsaWRhdGUgfSBmcm9tICcuLi92YWxpZGF0aW9uJztcclxuXHJcbmRlc2NyaWJlKCdWYWxpZGF0aW9uIE1pZGRsZXdhcmUnLCAoKSA9PiB7XHJcbiAgbGV0IHJlcTogUGFydGlhbDxSZXF1ZXN0PjtcclxuICBsZXQgcmVzOiBQYXJ0aWFsPFJlc3BvbnNlPjtcclxuICBsZXQgbmV4dDogamVzdC5Nb2NrO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIHJlcSA9IHtcclxuICAgICAgYm9keToge30sXHJcbiAgICAgIHF1ZXJ5OiB7fSxcclxuICAgICAgcGFyYW1zOiB7fVxyXG4gICAgfTtcclxuICAgIHJlcyA9IHtcclxuICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAganNvbjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKClcclxuICAgIH07XHJcbiAgICBuZXh0ID0gamVzdC5mbigpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndmFsaWRhdGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNhbGwgbmV4dCB3aGVuIHZhbGlkYXRpb24gcGFzc2VzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgICAgICAgYm9keTogei5vYmplY3Qoe1xyXG4gICAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxLmJvZHkgPSB7IGVtYWlsOiAndGVzdEBhem9yYS53b3JsZCcgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgd2hlbiB2YWxpZGF0aW9uIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgICAgICAgYm9keTogei5vYmplY3Qoe1xyXG4gICAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxLmJvZHkgPSB7IGVtYWlsOiAnaW52YWxpZC1lbWFpbCcgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgIGV4cGVjdChyZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdmFsaWRhdGlvbiBlcnJvciBkZXRhaWxzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgICAgICAgYm9keTogei5vYmplY3Qoe1xyXG4gICAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxLmJvZHkgPSB7IGVtYWlsOiAnaW52YWxpZCcgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSAocmVzLmpzb24gYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IpLnRvQmUoJ1ZhbGlkYXRpb24gZmFpbGVkJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5kZXRhaWxzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXNwb25zZS5kZXRhaWxzKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYm9keSBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAgICAgICBib2R5OiB6Lm9iamVjdCh7XHJcbiAgICAgICAgICBuYW1lOiB6LnN0cmluZygpLm1pbigxKSxcclxuICAgICAgICAgIGFnZTogei5udW1iZXIoKS5taW4oMClcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlcS5ib2R5ID0geyBuYW1lOiAnSm9obicsIGFnZTogMjUgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHF1ZXJ5IHBhcmFtZXRlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAgICAgICBxdWVyeTogei5vYmplY3Qoe1xyXG4gICAgICAgICAgcGFnZTogei5zdHJpbmcoKS50cmFuc2Zvcm0oTnVtYmVyKS5waXBlKHoubnVtYmVyKCkubWluKDEpKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxLnF1ZXJ5ID0geyBwYWdlOiAnMScgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHBhdGggcGFyYW1ldGVycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2NoZW1hID0gei5vYmplY3Qoe1xyXG4gICAgICAgIHBhcmFtczogei5vYmplY3Qoe1xyXG4gICAgICAgICAgaWQ6IHouc3RyaW5nKCkudXVpZCgpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXEucGFyYW1zID0geyBpZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIFVVSUQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAgICAgICBwYXJhbXM6IHoub2JqZWN0KHtcclxuICAgICAgICAgIGlkOiB6LnN0cmluZygpLnV1aWQoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxLnBhcmFtcyA9IHsgaWQ6ICdub3QtYS11dWlkJyB9O1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHNjaGVtYSk7XHJcbiAgICAgIGF3YWl0IG1pZGRsZXdhcmUocmVxIGFzIFJlcXVlc3QsIHJlcyBhcyBSZXNwb25zZSwgbmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgbXVsdGlwbGUgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgICAgICAgYm9keTogei5vYmplY3Qoe1xyXG4gICAgICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcclxuICAgICAgICAgIHBhc3N3b3JkOiB6LnN0cmluZygpLm1pbig4KSxcclxuICAgICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXEuYm9keSA9IHtcclxuICAgICAgICBlbWFpbDogJ3Rlc3RAYXpvcmEud29ybGQnLFxyXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMycsXHJcbiAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcidcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZShzY2hlbWEpO1xyXG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSBhcyBSZXF1ZXN0LCByZXMgYXMgUmVzcG9uc2UsIG5leHQpO1xyXG5cclxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlamVjdCB3aGVuIHJlcXVpcmVkIGZpZWxkIGlzIG1pc3NpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAgICAgICBib2R5OiB6Lm9iamVjdCh7XHJcbiAgICAgICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxyXG4gICAgICAgICAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDgpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXEuYm9keSA9IHsgZW1haWw6ICd0ZXN0QGF6b3JhLndvcmxkJyB9O1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHNjaGVtYSk7XHJcbiAgICAgIGF3YWl0IG1pZGRsZXdhcmUocmVxIGFzIFJlcXVlc3QsIHJlcyBhcyBSZXNwb25zZSwgbmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXggbmVzdGVkIHZhbGlkYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAgICAgICBib2R5OiB6Lm9iamVjdCh7XHJcbiAgICAgICAgICB1c2VyOiB6Lm9iamVjdCh7XHJcbiAgICAgICAgICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCksXHJcbiAgICAgICAgICAgIHByb2ZpbGU6IHoub2JqZWN0KHtcclxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHouc3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHouc3RyaW5nKClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXEuYm9keSA9IHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAYXpvcmEud29ybGQnLFxyXG4gICAgICAgICAgcHJvZmlsZToge1xyXG4gICAgICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcclxuICAgICAgICAgICAgbGFzdE5hbWU6ICdEb2UnXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHNjaGVtYSk7XHJcbiAgICAgIGF3YWl0IG1pZGRsZXdhcmUocmVxIGFzIFJlcXVlc3QsIHJlcyBhcyBSZXNwb25zZSwgbmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYXJyYXlzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgICAgICAgYm9keTogei5vYmplY3Qoe1xyXG4gICAgICAgICAgdGFnczogei5hcnJheSh6LnN0cmluZygpKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxLmJvZHkgPSB7IHRhZ3M6IFsnZWR1Y2F0aW9uJywgJ3RlY2hub2xvZ3knXSB9O1xyXG5cclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHNjaGVtYSk7XHJcbiAgICAgIGF3YWl0IG1pZGRsZXdhcmUocmVxIGFzIFJlcXVlc3QsIHJlcyBhcyBSZXNwb25zZSwgbmV4dCk7XHJcblxyXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgYXJyYXkgaXRlbXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAgICAgICBib2R5OiB6Lm9iamVjdCh7XHJcbiAgICAgICAgICBpZHM6IHouYXJyYXkoei5udW1iZXIoKSlcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlcS5ib2R5ID0geyBpZHM6IFsxLCAnaW52YWxpZCcsIDNdIH07XHJcblxyXG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUoc2NoZW1hKTtcclxuICAgICAgYXdhaXQgbWlkZGxld2FyZShyZXEgYXMgUmVxdWVzdCwgcmVzIGFzIFJlc3BvbnNlLCBuZXh0KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBQ0EsSUFBQUEsSUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBRCxPQUFBO0FBRUFFLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxNQUFNO0VBQ3RDLElBQUlDLEdBQXFCO0VBQ3pCLElBQUlDLEdBQXNCO0VBQzFCLElBQUlDLElBQWU7RUFFbkJDLFVBQVUsQ0FBQyxNQUFNO0lBQ2ZILEdBQUcsR0FBRztNQUNKSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO01BQ1JDLEtBQUssRUFBRSxDQUFDLENBQUM7TUFDVEMsTUFBTSxFQUFFLENBQUM7SUFDWCxDQUFDO0lBQ0RMLEdBQUcsR0FBRztNQUNKTSxNQUFNLEVBQUVDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLENBQUM7TUFDbENDLElBQUksRUFBRUgsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQyxDQUFDQyxjQUFjLENBQUM7SUFDakMsQ0FBQztJQUNEUixJQUFJLEdBQUdNLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7RUFDbEIsQ0FBQyxDQUFDO0VBRUZWLFFBQVEsQ0FBQyxVQUFVLEVBQUUsTUFBTTtJQUN6QmEsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLFlBQVk7TUFDeEQsTUFBTUMsTUFBTSxHQUFHQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUN0QlgsSUFBSSxFQUFFVSxNQUFDLENBQUNDLE1BQU0sQ0FBQztVQUNiQyxLQUFLLEVBQUVGLE1BQUMsQ0FBQ0csTUFBTSxDQUFDLENBQUMsQ0FBQ0QsS0FBSyxDQUFDO1FBQzFCLENBQUM7TUFDSCxDQUFDLENBQUM7TUFFRmhCLEdBQUcsQ0FBQ0ksSUFBSSxHQUFHO1FBQUVZLEtBQUssRUFBRTtNQUFtQixDQUFDO01BRXhDLE1BQU1FLFVBQVUsR0FBRyxJQUFBQyxvQkFBUSxFQUFDTixNQUFNLENBQUM7TUFDbkMsTUFBTUssVUFBVSxDQUFDbEIsR0FBRyxFQUFhQyxHQUFHLEVBQWNDLElBQUksQ0FBQztNQUV2RGtCLE1BQU0sQ0FBQ2xCLElBQUksQ0FBQyxDQUFDbUIsb0JBQW9CLENBQUMsQ0FBQztJQUNyQyxDQUFDLENBQUM7SUFFRlQsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLFlBQVk7TUFDeEQsTUFBTUMsTUFBTSxHQUFHQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUN0QlgsSUFBSSxFQUFFVSxNQUFDLENBQUNDLE1BQU0sQ0FBQztVQUNiQyxLQUFLLEVBQUVGLE1BQUMsQ0FBQ0csTUFBTSxDQUFDLENBQUMsQ0FBQ0QsS0FBSyxDQUFDO1FBQzFCLENBQUM7TUFDSCxDQUFDLENBQUM7TUFFRmhCLEdBQUcsQ0FBQ0ksSUFBSSxHQUFHO1FBQUVZLEtBQUssRUFBRTtNQUFnQixDQUFDO01BRXJDLE1BQU1FLFVBQVUsR0FBRyxJQUFBQyxvQkFBUSxFQUFDTixNQUFNLENBQUM7TUFDbkMsTUFBTUssVUFBVSxDQUFDbEIsR0FBRyxFQUFhQyxHQUFHLEVBQWNDLElBQUksQ0FBQztNQUV2RGtCLE1BQU0sQ0FBQ25CLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLENBQUNjLG9CQUFvQixDQUFDLEdBQUcsQ0FBQztNQUM1Q0QsTUFBTSxDQUFDbkIsR0FBRyxDQUFDVSxJQUFJLENBQUMsQ0FBQ1csZ0JBQWdCLENBQUMsQ0FBQztJQUNyQyxDQUFDLENBQUM7SUFFRlYsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLFlBQVk7TUFDdkQsTUFBTUMsTUFBTSxHQUFHQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUN0QlgsSUFBSSxFQUFFVSxNQUFDLENBQUNDLE1BQU0sQ0FBQztVQUNiQyxLQUFLLEVBQUVGLE1BQUMsQ0FBQ0csTUFBTSxDQUFDLENBQUMsQ0FBQ0QsS0FBSyxDQUFDO1FBQzFCLENBQUM7TUFDSCxDQUFDLENBQUM7TUFFRmhCLEdBQUcsQ0FBQ0ksSUFBSSxHQUFHO1FBQUVZLEtBQUssRUFBRTtNQUFVLENBQUM7TUFFL0IsTUFBTUUsVUFBVSxHQUFHLElBQUFDLG9CQUFRLEVBQUNOLE1BQU0sQ0FBQztNQUNuQyxNQUFNSyxVQUFVLENBQUNsQixHQUFHLEVBQWFDLEdBQUcsRUFBY0MsSUFBSSxDQUFDO01BRXZELE1BQU1xQixRQUFRLEdBQUl0QixHQUFHLENBQUNVLElBQUksQ0FBZWEsSUFBSSxDQUFDQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO01BQ3pETCxNQUFNLENBQUNHLFFBQVEsQ0FBQ0csS0FBSyxDQUFDLENBQUNDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztNQUNoRFAsTUFBTSxDQUFDRyxRQUFRLENBQUNLLE9BQU8sQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUN0Q1QsTUFBTSxDQUFDVSxLQUFLLENBQUNDLE9BQU8sQ0FBQ1IsUUFBUSxDQUFDSyxPQUFPLENBQUMsQ0FBQyxDQUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ3BELENBQUMsQ0FBQztJQUVGZixFQUFFLENBQUMsNkJBQTZCLEVBQUUsWUFBWTtNQUM1QyxNQUFNQyxNQUFNLEdBQUdDLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1FBQ3RCWCxJQUFJLEVBQUVVLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1VBQ2JpQixJQUFJLEVBQUVsQixNQUFDLENBQUNHLE1BQU0sQ0FBQyxDQUFDLENBQUNnQixHQUFHLENBQUMsQ0FBQyxDQUFDO1VBQ3ZCQyxHQUFHLEVBQUVwQixNQUFDLENBQUNxQixNQUFNLENBQUMsQ0FBQyxDQUFDRixHQUFHLENBQUMsQ0FBQztRQUN2QixDQUFDO01BQ0gsQ0FBQyxDQUFDO01BRUZqQyxHQUFHLENBQUNJLElBQUksR0FBRztRQUFFNEIsSUFBSSxFQUFFLE1BQU07UUFBRUUsR0FBRyxFQUFFO01BQUcsQ0FBQztNQUVwQyxNQUFNaEIsVUFBVSxHQUFHLElBQUFDLG9CQUFRLEVBQUNOLE1BQU0sQ0FBQztNQUNuQyxNQUFNSyxVQUFVLENBQUNsQixHQUFHLEVBQWFDLEdBQUcsRUFBY0MsSUFBSSxDQUFDO01BRXZEa0IsTUFBTSxDQUFDbEIsSUFBSSxDQUFDLENBQUNtQixvQkFBb0IsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztJQUVGVCxFQUFFLENBQUMsa0NBQWtDLEVBQUUsWUFBWTtNQUNqRCxNQUFNQyxNQUFNLEdBQUdDLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1FBQ3RCVixLQUFLLEVBQUVTLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1VBQ2RxQixJQUFJLEVBQUV0QixNQUFDLENBQUNHLE1BQU0sQ0FBQyxDQUFDLENBQUNvQixTQUFTLENBQUNDLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUN6QixNQUFDLENBQUNxQixNQUFNLENBQUMsQ0FBQyxDQUFDRixHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzNELENBQUM7TUFDSCxDQUFDLENBQUM7TUFFRmpDLEdBQUcsQ0FBQ0ssS0FBSyxHQUFHO1FBQUUrQixJQUFJLEVBQUU7TUFBSSxDQUFDO01BRXpCLE1BQU1sQixVQUFVLEdBQUcsSUFBQUMsb0JBQVEsRUFBQ04sTUFBTSxDQUFDO01BQ25DLE1BQU1LLFVBQVUsQ0FBQ2xCLEdBQUcsRUFBYUMsR0FBRyxFQUFjQyxJQUFJLENBQUM7TUFFdkRrQixNQUFNLENBQUNsQixJQUFJLENBQUMsQ0FBQ21CLG9CQUFvQixDQUFDLENBQUM7SUFDckMsQ0FBQyxDQUFDO0lBRUZULEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxZQUFZO01BQ2hELE1BQU1DLE1BQU0sR0FBR0MsTUFBQyxDQUFDQyxNQUFNLENBQUM7UUFDdEJULE1BQU0sRUFBRVEsTUFBQyxDQUFDQyxNQUFNLENBQUM7VUFDZnlCLEVBQUUsRUFBRTFCLE1BQUMsQ0FBQ0csTUFBTSxDQUFDLENBQUMsQ0FBQ3dCLElBQUksQ0FBQztRQUN0QixDQUFDO01BQ0gsQ0FBQyxDQUFDO01BRUZ6QyxHQUFHLENBQUNNLE1BQU0sR0FBRztRQUFFa0MsRUFBRSxFQUFFO01BQXVDLENBQUM7TUFFM0QsTUFBTXRCLFVBQVUsR0FBRyxJQUFBQyxvQkFBUSxFQUFDTixNQUFNLENBQUM7TUFDbkMsTUFBTUssVUFBVSxDQUFDbEIsR0FBRyxFQUFhQyxHQUFHLEVBQWNDLElBQUksQ0FBQztNQUV2RGtCLE1BQU0sQ0FBQ2xCLElBQUksQ0FBQyxDQUFDbUIsb0JBQW9CLENBQUMsQ0FBQztJQUNyQyxDQUFDLENBQUM7SUFFRlQsRUFBRSxDQUFDLDRCQUE0QixFQUFFLFlBQVk7TUFDM0MsTUFBTUMsTUFBTSxHQUFHQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUN0QlQsTUFBTSxFQUFFUSxNQUFDLENBQUNDLE1BQU0sQ0FBQztVQUNmeUIsRUFBRSxFQUFFMUIsTUFBQyxDQUFDRyxNQUFNLENBQUMsQ0FBQyxDQUFDd0IsSUFBSSxDQUFDO1FBQ3RCLENBQUM7TUFDSCxDQUFDLENBQUM7TUFFRnpDLEdBQUcsQ0FBQ00sTUFBTSxHQUFHO1FBQUVrQyxFQUFFLEVBQUU7TUFBYSxDQUFDO01BRWpDLE1BQU10QixVQUFVLEdBQUcsSUFBQUMsb0JBQVEsRUFBQ04sTUFBTSxDQUFDO01BQ25DLE1BQU1LLFVBQVUsQ0FBQ2xCLEdBQUcsRUFBYUMsR0FBRyxFQUFjQyxJQUFJLENBQUM7TUFFdkRrQixNQUFNLENBQUNuQixHQUFHLENBQUNNLE1BQU0sQ0FBQyxDQUFDYyxvQkFBb0IsQ0FBQyxHQUFHLENBQUM7SUFDOUMsQ0FBQyxDQUFDO0lBRUZULEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxZQUFZO01BQ2hELE1BQU1DLE1BQU0sR0FBR0MsTUFBQyxDQUFDQyxNQUFNLENBQUM7UUFDdEJYLElBQUksRUFBRVUsTUFBQyxDQUFDQyxNQUFNLENBQUM7VUFDYkMsS0FBSyxFQUFFRixNQUFDLENBQUNHLE1BQU0sQ0FBQyxDQUFDLENBQUNELEtBQUssQ0FBQyxDQUFDO1VBQ3pCMEIsUUFBUSxFQUFFNUIsTUFBQyxDQUFDRyxNQUFNLENBQUMsQ0FBQyxDQUFDZ0IsR0FBRyxDQUFDLENBQUMsQ0FBQztVQUMzQkQsSUFBSSxFQUFFbEIsTUFBQyxDQUFDRyxNQUFNLENBQUMsQ0FBQyxDQUFDZ0IsR0FBRyxDQUFDLENBQUM7UUFDeEIsQ0FBQztNQUNILENBQUMsQ0FBQztNQUVGakMsR0FBRyxDQUFDSSxJQUFJLEdBQUc7UUFDVFksS0FBSyxFQUFFLGtCQUFrQjtRQUN6QjBCLFFBQVEsRUFBRSxlQUFlO1FBQ3pCVixJQUFJLEVBQUU7TUFDUixDQUFDO01BRUQsTUFBTWQsVUFBVSxHQUFHLElBQUFDLG9CQUFRLEVBQUNOLE1BQU0sQ0FBQztNQUNuQyxNQUFNSyxVQUFVLENBQUNsQixHQUFHLEVBQWFDLEdBQUcsRUFBY0MsSUFBSSxDQUFDO01BRXZEa0IsTUFBTSxDQUFDbEIsSUFBSSxDQUFDLENBQUNtQixvQkFBb0IsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztJQUVGVCxFQUFFLENBQUMsOENBQThDLEVBQUUsWUFBWTtNQUM3RCxNQUFNQyxNQUFNLEdBQUdDLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1FBQ3RCWCxJQUFJLEVBQUVVLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1VBQ2JDLEtBQUssRUFBRUYsTUFBQyxDQUFDRyxNQUFNLENBQUMsQ0FBQyxDQUFDRCxLQUFLLENBQUMsQ0FBQztVQUN6QjBCLFFBQVEsRUFBRTVCLE1BQUMsQ0FBQ0csTUFBTSxDQUFDLENBQUMsQ0FBQ2dCLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLENBQUM7TUFDSCxDQUFDLENBQUM7TUFFRmpDLEdBQUcsQ0FBQ0ksSUFBSSxHQUFHO1FBQUVZLEtBQUssRUFBRTtNQUFtQixDQUFDO01BRXhDLE1BQU1FLFVBQVUsR0FBRyxJQUFBQyxvQkFBUSxFQUFDTixNQUFNLENBQUM7TUFDbkMsTUFBTUssVUFBVSxDQUFDbEIsR0FBRyxFQUFhQyxHQUFHLEVBQWNDLElBQUksQ0FBQztNQUV2RGtCLE1BQU0sQ0FBQ25CLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLENBQUNjLG9CQUFvQixDQUFDLEdBQUcsQ0FBQztJQUM5QyxDQUFDLENBQUM7SUFFRlQsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLFlBQVk7TUFDeEQsTUFBTUMsTUFBTSxHQUFHQyxNQUFDLENBQUNDLE1BQU0sQ0FBQztRQUN0QlgsSUFBSSxFQUFFVSxNQUFDLENBQUNDLE1BQU0sQ0FBQztVQUNiNEIsSUFBSSxFQUFFN0IsTUFBQyxDQUFDQyxNQUFNLENBQUM7WUFDYkMsS0FBSyxFQUFFRixNQUFDLENBQUNHLE1BQU0sQ0FBQyxDQUFDLENBQUNELEtBQUssQ0FBQyxDQUFDO1lBQ3pCNEIsT0FBTyxFQUFFOUIsTUFBQyxDQUFDQyxNQUFNLENBQUM7Y0FDaEI4QixTQUFTLEVBQUUvQixNQUFDLENBQUNHLE1BQU0sQ0FBQyxDQUFDO2NBQ3JCNkIsUUFBUSxFQUFFaEMsTUFBQyxDQUFDRyxNQUFNLENBQUM7WUFDckIsQ0FBQztVQUNILENBQUM7UUFDSCxDQUFDO01BQ0gsQ0FBQyxDQUFDO01BRUZqQixHQUFHLENBQUNJLElBQUksR0FBRztRQUNUdUMsSUFBSSxFQUFFO1VBQ0ozQixLQUFLLEVBQUUsa0JBQWtCO1VBQ3pCNEIsT0FBTyxFQUFFO1lBQ1BDLFNBQVMsRUFBRSxNQUFNO1lBQ2pCQyxRQUFRLEVBQUU7VUFDWjtRQUNGO01BQ0YsQ0FBQztNQUVELE1BQU01QixVQUFVLEdBQUcsSUFBQUMsb0JBQVEsRUFBQ04sTUFBTSxDQUFDO01BQ25DLE1BQU1LLFVBQVUsQ0FBQ2xCLEdBQUcsRUFBYUMsR0FBRyxFQUFjQyxJQUFJLENBQUM7TUFFdkRrQixNQUFNLENBQUNsQixJQUFJLENBQUMsQ0FBQ21CLG9CQUFvQixDQUFDLENBQUM7SUFDckMsQ0FBQyxDQUFDO0lBRUZULEVBQUUsQ0FBQyx3QkFBd0IsRUFBRSxZQUFZO01BQ3ZDLE1BQU1DLE1BQU0sR0FBR0MsTUFBQyxDQUFDQyxNQUFNLENBQUM7UUFDdEJYLElBQUksRUFBRVUsTUFBQyxDQUFDQyxNQUFNLENBQUM7VUFDYmdDLElBQUksRUFBRWpDLE1BQUMsQ0FBQ2tDLEtBQUssQ0FBQ2xDLE1BQUMsQ0FBQ0csTUFBTSxDQUFDLENBQUM7UUFDMUIsQ0FBQztNQUNILENBQUMsQ0FBQztNQUVGakIsR0FBRyxDQUFDSSxJQUFJLEdBQUc7UUFBRTJDLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxZQUFZO01BQUUsQ0FBQztNQUVoRCxNQUFNN0IsVUFBVSxHQUFHLElBQUFDLG9CQUFRLEVBQUNOLE1BQU0sQ0FBQztNQUNuQyxNQUFNSyxVQUFVLENBQUNsQixHQUFHLEVBQWFDLEdBQUcsRUFBY0MsSUFBSSxDQUFDO01BRXZEa0IsTUFBTSxDQUFDbEIsSUFBSSxDQUFDLENBQUNtQixvQkFBb0IsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztJQUVGVCxFQUFFLENBQUMsbUNBQW1DLEVBQUUsWUFBWTtNQUNsRCxNQUFNQyxNQUFNLEdBQUdDLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1FBQ3RCWCxJQUFJLEVBQUVVLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1VBQ2JrQyxHQUFHLEVBQUVuQyxNQUFDLENBQUNrQyxLQUFLLENBQUNsQyxNQUFDLENBQUNxQixNQUFNLENBQUMsQ0FBQztRQUN6QixDQUFDO01BQ0gsQ0FBQyxDQUFDO01BRUZuQyxHQUFHLENBQUNJLElBQUksR0FBRztRQUFFNkMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDO01BQUUsQ0FBQztNQUVyQyxNQUFNL0IsVUFBVSxHQUFHLElBQUFDLG9CQUFRLEVBQUNOLE1BQU0sQ0FBQztNQUNuQyxNQUFNSyxVQUFVLENBQUNsQixHQUFHLEVBQWFDLEdBQUcsRUFBY0MsSUFBSSxDQUFDO01BRXZEa0IsTUFBTSxDQUFDbkIsR0FBRyxDQUFDTSxNQUFNLENBQUMsQ0FBQ2Msb0JBQW9CLENBQUMsR0FBRyxDQUFDO0lBQzlDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==