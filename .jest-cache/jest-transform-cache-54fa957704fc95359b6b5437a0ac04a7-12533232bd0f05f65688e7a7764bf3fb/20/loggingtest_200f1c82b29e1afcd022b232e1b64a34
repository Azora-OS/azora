c64e5facb01367dc4c8c22447f9cdb9a
"use strict";

var _logging = require("../logging");
describe('Shared Utilities - Logging', () => {
  let logger;
  beforeEach(() => {
    logger = (0, _logging.createLogger)('test-service');
  });
  afterEach(() => {
    logger.close();
  });
  describe('createLogger', () => {
    it('should create logger with service name', () => {
      const testLogger = (0, _logging.createLogger)('test-service');
      expect(testLogger).toBeDefined();
      expect(testLogger.defaultMeta).toEqual({
        service: 'test-service'
      });
    });
    it('should have console transport', () => {
      const testLogger = (0, _logging.createLogger)('test-service');
      const transports = testLogger.transports;
      expect(transports.length).toBeGreaterThan(0);
    });
  });
  describe('logInfo', () => {
    it('should log info message', () => {
      const spy = jest.spyOn(logger, 'info');
      (0, _logging.logInfo)(logger, 'Test message');
      expect(spy).toHaveBeenCalledWith('Test message', undefined);
    });
    it('should log info message with metadata', () => {
      const spy = jest.spyOn(logger, 'info');
      const meta = {
        userId: '123',
        action: 'test'
      };
      (0, _logging.logInfo)(logger, 'Test message', meta);
      expect(spy).toHaveBeenCalledWith('Test message', meta);
    });
  });
  describe('logWarn', () => {
    it('should log warning message', () => {
      const spy = jest.spyOn(logger, 'warn');
      (0, _logging.logWarn)(logger, 'Warning message');
      expect(spy).toHaveBeenCalledWith('Warning message', undefined);
    });
  });
  describe('logError', () => {
    it('should log error message', () => {
      const spy = jest.spyOn(logger, 'error');
      const error = new Error('Test error');
      (0, _logging.logError)(logger, 'Error occurred', error);
      expect(spy).toHaveBeenCalled();
    });
    it('should include error stack', () => {
      const spy = jest.spyOn(logger, 'error');
      const error = new Error('Test error');
      (0, _logging.logError)(logger, 'Error occurred', error);
      const callArgs = spy.mock.calls[0];
      expect(callArgs[1]).toHaveProperty('stack');
    });
  });
  describe('logDebug', () => {
    it('should log debug message', () => {
      const spy = jest.spyOn(logger, 'debug');
      (0, _logging.logDebug)(logger, 'Debug message');
      expect(spy).toHaveBeenCalledWith('Debug message', undefined);
    });
  });
  describe('logDatabaseOperation', () => {
    it('should log successful database operation', () => {
      const spy = jest.spyOn(logger, 'log');
      (0, _logging.logDatabaseOperation)(logger, 'SELECT', 'users', 50, true);
      expect(spy).toHaveBeenCalledWith('info', 'Database SELECT on users', expect.any(Object));
    });
    it('should log failed database operation', () => {
      const spy = jest.spyOn(logger, 'log');
      const error = new Error('Connection failed');
      (0, _logging.logDatabaseOperation)(logger, 'INSERT', 'users', 100, false, error);
      expect(spy).toHaveBeenCalledWith('error', 'Database INSERT on users', expect.any(Object));
    });
  });
  describe('logAuthEvent', () => {
    it('should log login event', () => {
      const spy = jest.spyOn(logger, 'info');
      (0, _logging.logAuthEvent)(logger, 'login', 'user123');
      expect(spy).toHaveBeenCalledWith('Auth: login', expect.objectContaining({
        event: 'login',
        userId: 'user123'
      }));
    });
    it('should log failed login event', () => {
      const spy = jest.spyOn(logger, 'info');
      (0, _logging.logAuthEvent)(logger, 'failed_login', undefined, {
        ip: '192.168.1.1'
      });
      expect(spy).toHaveBeenCalledWith('Auth: failed_login', expect.objectContaining({
        event: 'failed_login',
        ip: '192.168.1.1'
      }));
    });
  });
  describe('logBusinessEvent', () => {
    it('should log business event', () => {
      const spy = jest.spyOn(logger, 'info');
      (0, _logging.logBusinessEvent)(logger, 'course_enrolled', 'user123', {
        courseId: 'course456'
      });
      expect(spy).toHaveBeenCalledWith('Business: course_enrolled', expect.objectContaining({
        event: 'course_enrolled',
        userId: 'user123',
        courseId: 'course456'
      }));
    });
  });
  describe('logPaymentEvent', () => {
    it('should log payment event', () => {
      const spy = jest.spyOn(logger, 'info');
      (0, _logging.logPaymentEvent)(logger, 'payment_completed', 'txn123', 99.99, 'USD');
      expect(spy).toHaveBeenCalledWith('Payment: payment_completed', expect.objectContaining({
        event: 'payment_completed',
        transactionId: 'txn123',
        amount: 99.99,
        currency: 'USD'
      }));
    });
  });
  describe('logErrorWithContext', () => {
    it('should log error with context', () => {
      const spy = jest.spyOn(logger, 'error');
      const error = new Error('Test error');
      (0, _logging.logErrorWithContext)(logger, error, 'payment processing', {
        orderId: '123'
      });
      expect(spy).toHaveBeenCalledWith('Error in payment processing', expect.objectContaining({
        error: 'Test error',
        context: 'payment processing',
        orderId: '123'
      }));
    });
  });
  describe('requestLoggingMiddleware', () => {
    it('should create middleware function', () => {
      const middleware = (0, _logging.requestLoggingMiddleware)(logger);
      expect(typeof middleware).toBe('function');
    });
    it('should log HTTP requests', () => {
      const spy = jest.spyOn(logger, 'info');
      const middleware = (0, _logging.requestLoggingMiddleware)(logger);
      const req = {
        method: 'GET',
        path: '/api/test',
        ip: '127.0.0.1',
        get: jest.fn().mockReturnValue('test-agent')
      };
      const res = {
        statusCode: 200,
        send: jest.fn().mockImplementation(function (data) {
          return data;
        })
      };
      const next = jest.fn();
      middleware(req, res, next);
      expect(next).toHaveBeenCalled();
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9nZ2luZyIsInJlcXVpcmUiLCJkZXNjcmliZSIsImxvZ2dlciIsImJlZm9yZUVhY2giLCJjcmVhdGVMb2dnZXIiLCJhZnRlckVhY2giLCJjbG9zZSIsIml0IiwidGVzdExvZ2dlciIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwiZGVmYXVsdE1ldGEiLCJ0b0VxdWFsIiwic2VydmljZSIsInRyYW5zcG9ydHMiLCJsZW5ndGgiLCJ0b0JlR3JlYXRlclRoYW4iLCJzcHkiLCJqZXN0Iiwic3B5T24iLCJsb2dJbmZvIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJ1bmRlZmluZWQiLCJtZXRhIiwidXNlcklkIiwiYWN0aW9uIiwibG9nV2FybiIsImVycm9yIiwiRXJyb3IiLCJsb2dFcnJvciIsInRvSGF2ZUJlZW5DYWxsZWQiLCJjYWxsQXJncyIsIm1vY2siLCJjYWxscyIsInRvSGF2ZVByb3BlcnR5IiwibG9nRGVidWciLCJsb2dEYXRhYmFzZU9wZXJhdGlvbiIsImFueSIsIk9iamVjdCIsImxvZ0F1dGhFdmVudCIsIm9iamVjdENvbnRhaW5pbmciLCJldmVudCIsImlwIiwibG9nQnVzaW5lc3NFdmVudCIsImNvdXJzZUlkIiwibG9nUGF5bWVudEV2ZW50IiwidHJhbnNhY3Rpb25JZCIsImFtb3VudCIsImN1cnJlbmN5IiwibG9nRXJyb3JXaXRoQ29udGV4dCIsIm9yZGVySWQiLCJjb250ZXh0IiwibWlkZGxld2FyZSIsInJlcXVlc3RMb2dnaW5nTWlkZGxld2FyZSIsInRvQmUiLCJyZXEiLCJtZXRob2QiLCJwYXRoIiwiZ2V0IiwiZm4iLCJtb2NrUmV0dXJuVmFsdWUiLCJyZXMiLCJzdGF0dXNDb2RlIiwic2VuZCIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsImRhdGEiLCJuZXh0Il0sInNvdXJjZXMiOlsibG9nZ2luZy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB3aW5zdG9uIGZyb20gJ3dpbnN0b24nO1xyXG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7XHJcbiAgY3JlYXRlTG9nZ2VyLFxyXG4gIHJlcXVlc3RMb2dnaW5nTWlkZGxld2FyZSxcclxuICBsb2dJbmZvLFxyXG4gIGxvZ1dhcm4sXHJcbiAgbG9nRXJyb3IsXHJcbiAgbG9nRGVidWcsXHJcbiAgbG9nRGF0YWJhc2VPcGVyYXRpb24sXHJcbiAgbG9nQXV0aEV2ZW50LFxyXG4gIGxvZ0J1c2luZXNzRXZlbnQsXHJcbiAgbG9nUGF5bWVudEV2ZW50LFxyXG4gIGxvZ0Vycm9yV2l0aENvbnRleHRcclxufSBmcm9tICcuLi9sb2dnaW5nJztcclxuXHJcbmRlc2NyaWJlKCdTaGFyZWQgVXRpbGl0aWVzIC0gTG9nZ2luZycsICgpID0+IHtcclxuICBsZXQgbG9nZ2VyOiB3aW5zdG9uLkxvZ2dlcjtcclxuICBcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcigndGVzdC1zZXJ2aWNlJyk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIGxvZ2dlci5jbG9zZSgpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdjcmVhdGVMb2dnZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBsb2dnZXIgd2l0aCBzZXJ2aWNlIG5hbWUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRlc3RMb2dnZXIgPSBjcmVhdGVMb2dnZXIoJ3Rlc3Qtc2VydmljZScpO1xyXG4gICAgICBleHBlY3QodGVzdExvZ2dlcikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHRlc3RMb2dnZXIuZGVmYXVsdE1ldGEpLnRvRXF1YWwoeyBzZXJ2aWNlOiAndGVzdC1zZXJ2aWNlJyB9KTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGhhdmUgY29uc29sZSB0cmFuc3BvcnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRlc3RMb2dnZXIgPSBjcmVhdGVMb2dnZXIoJ3Rlc3Qtc2VydmljZScpO1xyXG4gICAgICBjb25zdCB0cmFuc3BvcnRzID0gdGVzdExvZ2dlci50cmFuc3BvcnRzO1xyXG4gICAgICBleHBlY3QodHJhbnNwb3J0cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdsb2dJbmZvJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBsb2cgaW5mbyBtZXNzYWdlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKGxvZ2dlciwgJ2luZm8nKTtcclxuICAgICAgbG9nSW5mbyhsb2dnZXIsICdUZXN0IG1lc3NhZ2UnKTtcclxuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1Rlc3QgbWVzc2FnZScsIHVuZGVmaW5lZCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaXQoJ3Nob3VsZCBsb2cgaW5mbyBtZXNzYWdlIHdpdGggbWV0YWRhdGEnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24obG9nZ2VyLCAnaW5mbycpO1xyXG4gICAgICBjb25zdCBtZXRhID0geyB1c2VySWQ6ICcxMjMnLCBhY3Rpb246ICd0ZXN0JyB9O1xyXG4gICAgICBsb2dJbmZvKGxvZ2dlciwgJ1Rlc3QgbWVzc2FnZScsIG1ldGEpO1xyXG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVGVzdCBtZXNzYWdlJywgbWV0YSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBkZXNjcmliZSgnbG9nV2FybicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbG9nIHdhcm5pbmcgbWVzc2FnZScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihsb2dnZXIsICd3YXJuJyk7XHJcbiAgICAgIGxvZ1dhcm4obG9nZ2VyLCAnV2FybmluZyBtZXNzYWdlJyk7XHJcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdXYXJuaW5nIG1lc3NhZ2UnLCB1bmRlZmluZWQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ2xvZ0Vycm9yJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBsb2cgZXJyb3IgbWVzc2FnZScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihsb2dnZXIsICdlcnJvcicpO1xyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG4gICAgICBsb2dFcnJvcihsb2dnZXIsICdFcnJvciBvY2N1cnJlZCcsIGVycm9yKTtcclxuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBlcnJvciBzdGFjaycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihsb2dnZXIsICdlcnJvcicpO1xyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG4gICAgICBsb2dFcnJvcihsb2dnZXIsICdFcnJvciBvY2N1cnJlZCcsIGVycm9yKTtcclxuICAgICAgY29uc3QgY2FsbEFyZ3MgPSBzcHkubW9jay5jYWxsc1swXTtcclxuICAgICAgZXhwZWN0KGNhbGxBcmdzWzFdKS50b0hhdmVQcm9wZXJ0eSgnc3RhY2snKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdsb2dEZWJ1ZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbG9nIGRlYnVnIG1lc3NhZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24obG9nZ2VyLCAnZGVidWcnKTtcclxuICAgICAgbG9nRGVidWcobG9nZ2VyLCAnRGVidWcgbWVzc2FnZScpO1xyXG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnRGVidWcgbWVzc2FnZScsIHVuZGVmaW5lZCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBkZXNjcmliZSgnbG9nRGF0YWJhc2VPcGVyYXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGxvZyBzdWNjZXNzZnVsIGRhdGFiYXNlIG9wZXJhdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihsb2dnZXIsICdsb2cnKTtcclxuICAgICAgbG9nRGF0YWJhc2VPcGVyYXRpb24obG9nZ2VyLCAnU0VMRUNUJywgJ3VzZXJzJywgNTAsIHRydWUpO1xyXG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaW5mbycsICdEYXRhYmFzZSBTRUxFQ1Qgb24gdXNlcnMnLCBleHBlY3QuYW55KE9iamVjdCkpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgbG9nIGZhaWxlZCBkYXRhYmFzZSBvcGVyYXRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24obG9nZ2VyLCAnbG9nJyk7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDb25uZWN0aW9uIGZhaWxlZCcpO1xyXG4gICAgICBsb2dEYXRhYmFzZU9wZXJhdGlvbihsb2dnZXIsICdJTlNFUlQnLCAndXNlcnMnLCAxMDAsIGZhbHNlLCBlcnJvcik7XHJcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdlcnJvcicsICdEYXRhYmFzZSBJTlNFUlQgb24gdXNlcnMnLCBleHBlY3QuYW55KE9iamVjdCkpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ2xvZ0F1dGhFdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbG9nIGxvZ2luIGV2ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKGxvZ2dlciwgJ2luZm8nKTtcclxuICAgICAgbG9nQXV0aEV2ZW50KGxvZ2dlciwgJ2xvZ2luJywgJ3VzZXIxMjMnKTtcclxuICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0F1dGg6IGxvZ2luJywgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIGV2ZW50OiAnbG9naW4nLFxyXG4gICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnXHJcbiAgICAgIH0pKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGxvZyBmYWlsZWQgbG9naW4gZXZlbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24obG9nZ2VyLCAnaW5mbycpO1xyXG4gICAgICBsb2dBdXRoRXZlbnQobG9nZ2VyLCAnZmFpbGVkX2xvZ2luJywgdW5kZWZpbmVkLCB7IGlwOiAnMTkyLjE2OC4xLjEnIH0pO1xyXG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQXV0aDogZmFpbGVkX2xvZ2luJywgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIGV2ZW50OiAnZmFpbGVkX2xvZ2luJyxcclxuICAgICAgICBpcDogJzE5Mi4xNjguMS4xJ1xyXG4gICAgICB9KSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBkZXNjcmliZSgnbG9nQnVzaW5lc3NFdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbG9nIGJ1c2luZXNzIGV2ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKGxvZ2dlciwgJ2luZm8nKTtcclxuICAgICAgbG9nQnVzaW5lc3NFdmVudChsb2dnZXIsICdjb3Vyc2VfZW5yb2xsZWQnLCAndXNlcjEyMycsIHsgY291cnNlSWQ6ICdjb3Vyc2U0NTYnIH0pO1xyXG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQnVzaW5lc3M6IGNvdXJzZV9lbnJvbGxlZCcsIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICBldmVudDogJ2NvdXJzZV9lbnJvbGxlZCcsXHJcbiAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXHJcbiAgICAgICAgY291cnNlSWQ6ICdjb3Vyc2U0NTYnXHJcbiAgICAgIH0pKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdsb2dQYXltZW50RXZlbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGxvZyBwYXltZW50IGV2ZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKGxvZ2dlciwgJ2luZm8nKTtcclxuICAgICAgbG9nUGF5bWVudEV2ZW50KGxvZ2dlciwgJ3BheW1lbnRfY29tcGxldGVkJywgJ3R4bjEyMycsIDk5Ljk5LCAnVVNEJyk7XHJcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdQYXltZW50OiBwYXltZW50X2NvbXBsZXRlZCcsIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICBldmVudDogJ3BheW1lbnRfY29tcGxldGVkJyxcclxuICAgICAgICB0cmFuc2FjdGlvbklkOiAndHhuMTIzJyxcclxuICAgICAgICBhbW91bnQ6IDk5Ljk5LFxyXG4gICAgICAgIGN1cnJlbmN5OiAnVVNEJ1xyXG4gICAgICB9KSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBkZXNjcmliZSgnbG9nRXJyb3JXaXRoQ29udGV4dCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbG9nIGVycm9yIHdpdGggY29udGV4dCcsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihsb2dnZXIsICdlcnJvcicpO1xyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG4gICAgICBsb2dFcnJvcldpdGhDb250ZXh0KGxvZ2dlciwgZXJyb3IsICdwYXltZW50IHByb2Nlc3NpbmcnLCB7IG9yZGVySWQ6ICcxMjMnIH0pO1xyXG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnRXJyb3IgaW4gcGF5bWVudCBwcm9jZXNzaW5nJywgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIGVycm9yOiAnVGVzdCBlcnJvcicsXHJcbiAgICAgICAgY29udGV4dDogJ3BheW1lbnQgcHJvY2Vzc2luZycsXHJcbiAgICAgICAgb3JkZXJJZDogJzEyMydcclxuICAgICAgfSkpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ3JlcXVlc3RMb2dnaW5nTWlkZGxld2FyZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG1pZGRsZXdhcmUgZnVuY3Rpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSByZXF1ZXN0TG9nZ2luZ01pZGRsZXdhcmUobG9nZ2VyKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBtaWRkbGV3YXJlKS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgbG9nIEhUVFAgcmVxdWVzdHMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24obG9nZ2VyLCAnaW5mbycpO1xyXG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gcmVxdWVzdExvZ2dpbmdNaWRkbGV3YXJlKGxvZ2dlcik7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXEgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICBwYXRoOiAnL2FwaS90ZXN0JyxcclxuICAgICAgICBpcDogJzEyNy4wLjAuMScsXHJcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCd0ZXN0LWFnZW50JylcclxuICAgICAgfSBhcyB1bmtub3duIGFzIFJlcXVlc3Q7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXMgPSB7XHJcbiAgICAgICAgc3RhdHVzQ29kZTogMjAwLFxyXG4gICAgICAgIHNlbmQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oZnVuY3Rpb24oZGF0YTogYW55KSB7XHJcbiAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9KVxyXG4gICAgICB9IGFzIHVua25vd24gYXMgUmVzcG9uc2U7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpIGFzIE5leHRGdW5jdGlvbjtcclxuICAgICAgXHJcbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xyXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBRUEsSUFBQUEsUUFBQSxHQUFBQyxPQUFBO0FBY0FDLFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxNQUFNO0VBQzNDLElBQUlDLE1BQXNCO0VBRTFCQyxVQUFVLENBQUMsTUFBTTtJQUNmRCxNQUFNLEdBQUcsSUFBQUUscUJBQVksRUFBQyxjQUFjLENBQUM7RUFDdkMsQ0FBQyxDQUFDO0VBRUZDLFNBQVMsQ0FBQyxNQUFNO0lBQ2RILE1BQU0sQ0FBQ0ksS0FBSyxDQUFDLENBQUM7RUFDaEIsQ0FBQyxDQUFDO0VBRUZMLFFBQVEsQ0FBQyxjQUFjLEVBQUUsTUFBTTtJQUM3Qk0sRUFBRSxDQUFDLHdDQUF3QyxFQUFFLE1BQU07TUFDakQsTUFBTUMsVUFBVSxHQUFHLElBQUFKLHFCQUFZLEVBQUMsY0FBYyxDQUFDO01BQy9DSyxNQUFNLENBQUNELFVBQVUsQ0FBQyxDQUFDRSxXQUFXLENBQUMsQ0FBQztNQUNoQ0QsTUFBTSxDQUFDRCxVQUFVLENBQUNHLFdBQVcsQ0FBQyxDQUFDQyxPQUFPLENBQUM7UUFBRUMsT0FBTyxFQUFFO01BQWUsQ0FBQyxDQUFDO0lBQ3JFLENBQUMsQ0FBQztJQUVGTixF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