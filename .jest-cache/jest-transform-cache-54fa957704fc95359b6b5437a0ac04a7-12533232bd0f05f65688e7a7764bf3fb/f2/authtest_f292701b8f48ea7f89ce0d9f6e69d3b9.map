{"version":3,"names":["request","require","jwt","express","createTestApp","app","use","json","authRoutes","describe","beforeEach","it","res","post","send","email","password","expect","body","success","toBe","token","toBeDefined","user","error","sign","userId","process","env","JWT_SECRET","expiresIn","get","set","payload","decoded","verify","exp","toBeGreaterThan","Date","now","validatePassword","length","profileRes"],"sources":["auth.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst jwt = require('jsonwebtoken');\r\nconst express = require('express');\r\n\r\n// Create test app\r\nconst createTestApp = () => {\r\n  const app = express();\r\n  app.use(express.json());\r\n  \r\n  // Import auth routes\r\n  const authRoutes = require('../src/routes/auth');\r\n  app.use('/api', authRoutes);\r\n  \r\n  return app;\r\n};\r\n\r\ndescribe('Auth Service - Authentication Endpoints', () => {\r\n  let app;\r\n  \r\n  beforeEach(() => {\r\n    app = createTestApp();\r\n  });\r\n  \r\n  describe('POST /api/login', () => {\r\n    it('should authenticate user with valid credentials', async () => {\r\n      const res = await request(app)\r\n        .post('/api/login')\r\n        .send({\r\n          email: 'test@azora.world',\r\n          password: 'password123'\r\n        })\r\n        .expect(200);\r\n      \r\n      expect(res.body.success).toBe(true);\r\n      expect(res.body.token).toBeDefined();\r\n      expect(res.body.user).toBeDefined();\r\n      expect(res.body.user.email).toBe('test@azora.world');\r\n    });\r\n    \r\n    it('should reject login without email', async () => {\r\n      const res = await request(app)\r\n        .post('/api/login')\r\n        .send({\r\n          password: 'password123'\r\n        })\r\n        .expect(401);\r\n      \r\n      expect(res.body.error).toBeDefined();\r\n    });\r\n    \r\n    it('should reject login without password', async () => {\r\n      const res = await request(app)\r\n        .post('/api/login')\r\n        .send({\r\n          email: 'test@azora.world'\r\n        })\r\n        .expect(401);\r\n      \r\n      expect(res.body.error).toBeDefined();\r\n    });\r\n  });\r\n  \r\n  describe('GET /api/profile', () => {\r\n    it('should return user profile with valid token', async () => {\r\n      const token = jwt.sign(\r\n        { userId: 1, email: 'test@azora.world' },\r\n        process.env.JWT_SECRET || 'ubuntu-secret',\r\n        { expiresIn: '24h' }\r\n      );\r\n      \r\n      const res = await request(app)\r\n        .get('/api/profile')\r\n        .set('Authorization', `Bearer ${token}`)\r\n        .expect(200);\r\n      \r\n      expect(res.body.user).toBeDefined();\r\n    });\r\n    \r\n    it('should reject request without token', async () => {\r\n      const res = await request(app)\r\n        .get('/api/profile')\r\n        .expect(401);\r\n      \r\n      expect(res.body.error).toBeDefined();\r\n    });\r\n    \r\n    it('should reject request with invalid token', async () => {\r\n      const res = await request(app)\r\n        .get('/api/profile')\r\n        .set('Authorization', 'Bearer invalid-token')\r\n        .expect(403);\r\n      \r\n      expect(res.body.error).toBeDefined();\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('Auth Service - JWT Token Generation', () => {\r\n  it('should generate valid JWT token', () => {\r\n    const payload = { userId: 1, email: 'test@azora.world' };\r\n    const token = jwt.sign(\r\n      payload,\r\n      process.env.JWT_SECRET || 'ubuntu-secret',\r\n      { expiresIn: '24h' }\r\n    );\r\n    \r\n    expect(token).toBeDefined();\r\n    expect(typeof token).toBe('string');\r\n    \r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET || 'ubuntu-secret');\r\n    expect(decoded.userId).toBe(payload.userId);\r\n    expect(decoded.email).toBe(payload.email);\r\n  });\r\n  \r\n  it('should include expiration in token', () => {\r\n    const token = jwt.sign(\r\n      { userId: 1 },\r\n      process.env.JWT_SECRET || 'ubuntu-secret',\r\n      { expiresIn: '1h' }\r\n    );\r\n    \r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET || 'ubuntu-secret');\r\n    expect(decoded.exp).toBeDefined();\r\n    expect(decoded.exp).toBeGreaterThan(Date.now() / 1000);\r\n  });\r\n});\r\n\r\ndescribe('Auth Service - Password Validation', () => {\r\n  it('should validate password requirements', () => {\r\n    const validatePassword = (password) => {\r\n      return password && password.length >= 8;\r\n    };\r\n    \r\n    expect(validatePassword('short')).toBe(false);\r\n    expect(validatePassword('validpassword123')).toBe(true);\r\n    expect(validatePassword('')).toBe(false);\r\n    expect(validatePassword(null)).toBe(false);\r\n  });\r\n});\r\n\r\ndescribe('Auth Service - Session Management', () => {\r\n  it('should create session on successful login', async () => {\r\n    const app = createTestApp();\r\n    \r\n    const res = await request(app)\r\n      .post('/api/login')\r\n      .send({\r\n        email: 'test@azora.world',\r\n        password: 'password123'\r\n      })\r\n      .expect(200);\r\n    \r\n    expect(res.body.token).toBeDefined();\r\n    \r\n    // Verify token can be used for authenticated requests\r\n    const profileRes = await request(app)\r\n      .get('/api/profile')\r\n      .set('Authorization', `Bearer ${res.body.token}`)\r\n      .expect(200);\r\n    \r\n    expect(profileRes.body.user).toBeDefined();\r\n  });\r\n});\r\n"],"mappings":";;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,WAAW,CAAC;AACpC,MAAMC,GAAG,GAAGD,OAAO,CAAC,cAAc,CAAC;AACnC,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAS,CAAC;;AAElC;AACA,MAAMG,aAAa,GAAGA,CAAA,KAAM;EAC1B,MAAMC,GAAG,GAAGF,OAAO,CAAC,CAAC;EACrBE,GAAG,CAACC,GAAG,CAACH,OAAO,CAACI,IAAI,CAAC,CAAC,CAAC;;EAEvB;EACA,MAAMC,UAAU,GAAGP,OAAO,CAAC,oBAAoB,CAAC;EAChDI,GAAG,CAACC,GAAG,CAAC,MAAM,EAAEE,UAAU,CAAC;EAE3B,OAAOH,GAAG;AACZ,CAAC;AAEDI,QAAQ,CAAC,yCAAyC,EAAE,MAAM;EACxD,IAAIJ,GAAG;EAEPK,UAAU,CAAC,MAAM;IACfL,GAAG,GAAGD,aAAa,CAAC,CAAC;EACvB,CAAC,CAAC;EAEFK,QAAQ,CAAC,iBAAiB,EAAE,MAAM;IAChCE,EAAE,CAAC,iDAAiD,EAAE,YAAY;MAChE,MAAMC,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3BQ,IAAI,CAAC,YAAY,CAAC,CAClBC,IAAI,CAAC;QACJC,KAAK,EAAE,kBAAkB;QACzBC,QAAQ,EAAE;MACZ,CAAC,CAAC,CACDC,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACC,OAAO,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;MACnCH,MAAM,CAACL,GAAG,CAACM,IAAI,CAACG,KAAK,CAAC,CAACC,WAAW,CAAC,CAAC;MACpCL,MAAM,CAACL,GAAG,CAACM,IAAI,CAACK,IAAI,CAAC,CAACD,WAAW,CAAC,CAAC;MACnCL,MAAM,CAACL,GAAG,CAACM,IAAI,CAACK,IAAI,CAACR,KAAK,CAAC,CAACK,IAAI,CAAC,kBAAkB,CAAC;IACtD,CAAC,CAAC;IAEFT,EAAE,CAAC,mCAAmC,EAAE,YAAY;MAClD,MAAMC,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3BQ,IAAI,CAAC,YAAY,CAAC,CAClBC,IAAI,CAAC;QACJE,QAAQ,EAAE;MACZ,CAAC,CAAC,CACDC,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACM,KAAK,CAAC,CAACF,WAAW,CAAC,CAAC;IACtC,CAAC,CAAC;IAEFX,EAAE,CAAC,sCAAsC,EAAE,YAAY;MACrD,MAAMC,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3BQ,IAAI,CAAC,YAAY,CAAC,CAClBC,IAAI,CAAC;QACJC,KAAK,EAAE;MACT,CAAC,CAAC,CACDE,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACM,KAAK,CAAC,CAACF,WAAW,CAAC,CAAC;IACtC,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFb,QAAQ,CAAC,kBAAkB,EAAE,MAAM;IACjCE,EAAE,CAAC,6CAA6C,EAAE,YAAY;MAC5D,MAAMU,KAAK,GAAGnB,GAAG,CAACuB,IAAI,CACpB;QAAEC,MAAM,EAAE,CAAC;QAAEX,KAAK,EAAE;MAAmB,CAAC,EACxCY,OAAO,CAACC,GAAG,CAACC,UAAU,IAAI,eAAe,EACzC;QAAEC,SAAS,EAAE;MAAM,CACrB,CAAC;MAED,MAAMlB,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3B0B,GAAG,CAAC,cAAc,CAAC,CACnBC,GAAG,CAAC,eAAe,EAAE,UAAUX,KAAK,EAAE,CAAC,CACvCJ,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACK,IAAI,CAAC,CAACD,WAAW,CAAC,CAAC;IACrC,CAAC,CAAC;IAEFX,EAAE,CAAC,qCAAqC,EAAE,YAAY;MACpD,MAAMC,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3B0B,GAAG,CAAC,cAAc,CAAC,CACnBd,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACM,KAAK,CAAC,CAACF,WAAW,CAAC,CAAC;IACtC,CAAC,CAAC;IAEFX,EAAE,CAAC,0CAA0C,EAAE,YAAY;MACzD,MAAMC,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3B0B,GAAG,CAAC,cAAc,CAAC,CACnBC,GAAG,CAAC,eAAe,EAAE,sBAAsB,CAAC,CAC5Cf,MAAM,CAAC,GAAG,CAAC;MAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACM,KAAK,CAAC,CAACF,WAAW,CAAC,CAAC;IACtC,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFb,QAAQ,CAAC,qCAAqC,EAAE,MAAM;EACpDE,EAAE,CAAC,iCAAiC,EAAE,MAAM;IAC1C,MAAMsB,OAAO,GAAG;MAAEP,MAAM,EAAE,CAAC;MAAEX,KAAK,EAAE;IAAmB,CAAC;IACxD,MAAMM,KAAK,GAAGnB,GAAG,CAACuB,IAAI,CACpBQ,OAAO,EACPN,OAAO,CAACC,GAAG,CAACC,UAAU,IAAI,eAAe,EACzC;MAAEC,SAAS,EAAE;IAAM,CACrB,CAAC;IAEDb,MAAM,CAACI,KAAK,CAAC,CAACC,WAAW,CAAC,CAAC;IAC3BL,MAAM,CAAC,OAAOI,KAAK,CAAC,CAACD,IAAI,CAAC,QAAQ,CAAC;IAEnC,MAAMc,OAAO,GAAGhC,GAAG,CAACiC,MAAM,CAACd,KAAK,EAAEM,OAAO,CAACC,GAAG,CAACC,UAAU,IAAI,eAAe,CAAC;IAC5EZ,MAAM,CAACiB,OAAO,CAACR,MAAM,CAAC,CAACN,IAAI,CAACa,OAAO,CAACP,MAAM,CAAC;IAC3CT,MAAM,CAACiB,OAAO,CAACnB,KAAK,CAAC,CAACK,IAAI,CAACa,OAAO,CAAClB,KAAK,CAAC;EAC3C,CAAC,CAAC;EAEFJ,EAAE,CAAC,oCAAoC,EAAE,MAAM;IAC7C,MAAMU,KAAK,GAAGnB,GAAG,CAACuB,IAAI,CACpB;MAAEC,MAAM,EAAE;IAAE,CAAC,EACbC,OAAO,CAACC,GAAG,CAACC,UAAU,IAAI,eAAe,EACzC;MAAEC,SAAS,EAAE;IAAK,CACpB,CAAC;IAED,MAAMI,OAAO,GAAGhC,GAAG,CAACiC,MAAM,CAACd,KAAK,EAAEM,OAAO,CAACC,GAAG,CAACC,UAAU,IAAI,eAAe,CAAC;IAC5EZ,MAAM,CAACiB,OAAO,CAACE,GAAG,CAAC,CAACd,WAAW,CAAC,CAAC;IACjCL,MAAM,CAACiB,OAAO,CAACE,GAAG,CAAC,CAACC,eAAe,CAACC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;EACxD,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF9B,QAAQ,CAAC,oCAAoC,EAAE,MAAM;EACnDE,EAAE,CAAC,uCAAuC,EAAE,MAAM;IAChD,MAAM6B,gBAAgB,GAAIxB,QAAQ,IAAK;MACrC,OAAOA,QAAQ,IAAIA,QAAQ,CAACyB,MAAM,IAAI,CAAC;IACzC,CAAC;IAEDxB,MAAM,CAACuB,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAACpB,IAAI,CAAC,KAAK,CAAC;IAC7CH,MAAM,CAACuB,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CAACpB,IAAI,CAAC,IAAI,CAAC;IACvDH,MAAM,CAACuB,gBAAgB,CAAC,EAAE,CAAC,CAAC,CAACpB,IAAI,CAAC,KAAK,CAAC;IACxCH,MAAM,CAACuB,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAACpB,IAAI,CAAC,KAAK,CAAC;EAC5C,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFX,QAAQ,CAAC,mCAAmC,EAAE,MAAM;EAClDE,EAAE,CAAC,2CAA2C,EAAE,YAAY;IAC1D,MAAMN,GAAG,GAAGD,aAAa,CAAC,CAAC;IAE3B,MAAMQ,GAAG,GAAG,MAAMZ,OAAO,CAACK,GAAG,CAAC,CAC3BQ,IAAI,CAAC,YAAY,CAAC,CAClBC,IAAI,CAAC;MACJC,KAAK,EAAE,kBAAkB;MACzBC,QAAQ,EAAE;IACZ,CAAC,CAAC,CACDC,MAAM,CAAC,GAAG,CAAC;IAEdA,MAAM,CAACL,GAAG,CAACM,IAAI,CAACG,KAAK,CAAC,CAACC,WAAW,CAAC,CAAC;;IAEpC;IACA,MAAMoB,UAAU,GAAG,MAAM1C,OAAO,CAACK,GAAG,CAAC,CAClC0B,GAAG,CAAC,cAAc,CAAC,CACnBC,GAAG,CAAC,eAAe,EAAE,UAAUpB,GAAG,CAACM,IAAI,CAACG,KAAK,EAAE,CAAC,CAChDJ,MAAM,CAAC,GAAG,CAAC;IAEdA,MAAM,CAACyB,UAAU,CAACxB,IAAI,CAACK,IAAI,CAAC,CAACD,WAAW,CAAC,CAAC;EAC5C,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}