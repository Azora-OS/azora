{"version":3,"names":["_security","require","describe","it","expect","corsConfig","toBeDefined","origin","credentials","toBe","methods","toContain","allowedHeaders","limiter","createRateLimiter","options","max","windowMs","message","rateLimiters","general","financial","auth","public","Object","keys","helmetConfig","contentSecurityPolicy","directives","defaultSrc","styleSrc","scriptSrc","imgSrc","hsts","maxAge","includeSubDomains","preload"],"sources":["security.test.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { corsConfig, createRateLimiter, rateLimiters, helmetConfig } from '../security';\r\n\r\ndescribe('Security Middleware', () => {\r\n  describe('corsConfig', () => {\r\n    it('should have correct CORS configuration', () => {\r\n      expect(corsConfig).toBeDefined();\r\n      expect(corsConfig.origin).toBeDefined();\r\n      expect(corsConfig.credentials).toBe(true);\r\n      expect(corsConfig.methods).toContain('GET');\r\n      expect(corsConfig.methods).toContain('POST');\r\n      expect(corsConfig.methods).toContain('PUT');\r\n      expect(corsConfig.methods).toContain('DELETE');\r\n      expect(corsConfig.methods).toContain('PATCH');\r\n    });\r\n\r\n    it('should include Authorization in allowed headers', () => {\r\n      expect(corsConfig.allowedHeaders).toContain('Authorization');\r\n      expect(corsConfig.allowedHeaders).toContain('Content-Type');\r\n    });\r\n  });\r\n\r\n  describe('createRateLimiter', () => {\r\n    it('should create rate limiter with default max', () => {\r\n      const limiter = createRateLimiter();\r\n      expect(limiter).toBeDefined();\r\n      expect(limiter.options).toBeDefined();\r\n      expect(limiter.options.max).toBe(100);\r\n    });\r\n\r\n    it('should create rate limiter with custom max', () => {\r\n      const limiter = createRateLimiter(50);\r\n      expect(limiter.options.max).toBe(50);\r\n    });\r\n\r\n    it('should have 15 minute window', () => {\r\n      const limiter = createRateLimiter();\r\n      expect(limiter.options.windowMs).toBe(15 * 60 * 1000);\r\n    });\r\n\r\n    it('should have error message', () => {\r\n      const limiter = createRateLimiter();\r\n      expect(limiter.options.message).toBe('Too many requests from this IP');\r\n    });\r\n  });\r\n\r\n  describe('rateLimiters', () => {\r\n    it('should have general limiter with 100 max', () => {\r\n      expect(rateLimiters.general).toBeDefined();\r\n      expect(rateLimiters.general.options.max).toBe(100);\r\n    });\r\n\r\n    it('should have financial limiter with 50 max', () => {\r\n      expect(rateLimiters.financial).toBeDefined();\r\n      expect(rateLimiters.financial.options.max).toBe(50);\r\n    });\r\n\r\n    it('should have auth limiter with 30 max', () => {\r\n      expect(rateLimiters.auth).toBeDefined();\r\n      expect(rateLimiters.auth.options.max).toBe(30);\r\n    });\r\n\r\n    it('should have public limiter with 200 max', () => {\r\n      expect(rateLimiters.public).toBeDefined();\r\n      expect(rateLimiters.public.options.max).toBe(200);\r\n    });\r\n\r\n    it('should have all required limiters', () => {\r\n      expect(Object.keys(rateLimiters)).toContain('general');\r\n      expect(Object.keys(rateLimiters)).toContain('financial');\r\n      expect(Object.keys(rateLimiters)).toContain('auth');\r\n      expect(Object.keys(rateLimiters)).toContain('public');\r\n    });\r\n  });\r\n\r\n  describe('helmetConfig', () => {\r\n    it('should have helmet configuration', () => {\r\n      expect(helmetConfig).toBeDefined();\r\n    });\r\n\r\n    it('should have content security policy', () => {\r\n      expect(helmetConfig.contentSecurityPolicy).toBeDefined();\r\n      expect(helmetConfig.contentSecurityPolicy.directives).toBeDefined();\r\n    });\r\n\r\n    it('should restrict default source to self', () => {\r\n      const directives = helmetConfig.contentSecurityPolicy.directives;\r\n      expect(directives.defaultSrc).toContain(\"'self'\");\r\n    });\r\n\r\n    it('should allow unsafe inline styles', () => {\r\n      const directives = helmetConfig.contentSecurityPolicy.directives;\r\n      expect(directives.styleSrc).toContain(\"'unsafe-inline'\");\r\n    });\r\n\r\n    it('should restrict scripts to self', () => {\r\n      const directives = helmetConfig.contentSecurityPolicy.directives;\r\n      expect(directives.scriptSrc).toContain(\"'self'\");\r\n    });\r\n\r\n    it('should allow images from self and https', () => {\r\n      const directives = helmetConfig.contentSecurityPolicy.directives;\r\n      expect(directives.imgSrc).toContain(\"'self'\");\r\n      expect(directives.imgSrc).toContain('data:');\r\n      expect(directives.imgSrc).toContain('https:');\r\n    });\r\n\r\n    it('should have HSTS enabled', () => {\r\n      expect(helmetConfig.hsts).toBeDefined();\r\n      expect(helmetConfig.hsts.maxAge).toBe(31536000);\r\n      expect(helmetConfig.hsts.includeSubDomains).toBe(true);\r\n      expect(helmetConfig.hsts.preload).toBe(true);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}