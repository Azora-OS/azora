{"version":3,"names":["fs","_interopRequireWildcard","require","path","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","CodeGeneratorAgent","constructor","aiOrchestrator","generateCode","task","context","console","log","description","files","targetFile","targetFiles","fileExists","generatedContent","generateFileContent","push","content","type","success","error","message","filePath","prompt","buildGenerationPrompt","existingContent","promises","readFile","response","extractCode","fileName","basename","fileExt","extname","aiResponse","codeBlockMatch","match","trim","generateService","serviceName","serviceType","parseMultiFileResponse","generateComponent","componentName","componentType","baseName","codeBlocks","matchAll","index","length","access","exports"],"sources":["CodeGeneratorAgent.ts"],"sourcesContent":["import { AIOrchestrator, AIContext } from './AIOrchestrator';\nimport { Task } from './PlannerAgent';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nexport interface GeneratedFile {\n  path: string;\n  content: string;\n  type: 'create' | 'modify';\n}\n\nexport interface GenerationResult {\n  files: GeneratedFile[];\n  success: boolean;\n  error?: string;\n}\n\nexport class CodeGeneratorAgent {\n  private aiOrchestrator: AIOrchestrator;\n\n  constructor(aiOrchestrator: AIOrchestrator) {\n    this.aiOrchestrator = aiOrchestrator;\n  }\n\n  async generateCode(task: Task, context: AIContext): Promise<GenerationResult> {\n    console.log(`Generating code for task: ${task.description}`);\n\n    try {\n      const files: GeneratedFile[] = [];\n\n      for (const targetFile of task.targetFiles) {\n        const fileExists = await this.fileExists(targetFile);\n        const generatedContent = await this.generateFileContent(\n          task,\n          targetFile,\n          fileExists,\n          context\n        );\n\n        files.push({\n          path: targetFile,\n          content: generatedContent,\n          type: fileExists ? 'modify' : 'create',\n        });\n      }\n\n      return {\n        files,\n        success: true,\n      };\n    } catch (error) {\n      return {\n        files: [],\n        success: false,\n        error: (error as Error).message,\n      };\n    }\n  }\n\n  private async generateFileContent(\n    task: Task,\n    filePath: string,\n    fileExists: boolean,\n    context: AIContext\n  ): Promise<string> {\n    const prompt = this.buildGenerationPrompt(task, filePath, fileExists);\n    \n    // Add existing file content to context if modifying\n    if (fileExists) {\n      try {\n        const existingContent = await fs.promises.readFile(filePath, 'utf-8');\n        context.files.push({\n          path: filePath,\n          content: existingContent,\n        });\n      } catch (error) {\n        console.error(`Failed to read existing file ${filePath}:`, error);\n      }\n    }\n\n    const response = await this.aiOrchestrator.generateCode(prompt, context);\n    \n    // Extract code from response (remove markdown code blocks if present)\n    return this.extractCode(response.content);\n  }\n\n  private buildGenerationPrompt(task: Task, filePath: string, fileExists: boolean): string {\n    const fileName = path.basename(filePath);\n    const fileExt = path.extname(filePath);\n\n    let prompt = `# Task\\n${task.description}\\n\\n`;\n    \n    if (fileExists) {\n      prompt += `# Operation\\nModify the existing file: ${fileName}\\n\\n`;\n      prompt += `The current file content is provided in the context.\\n\\n`;\n    } else {\n      prompt += `# Operation\\nCreate a new file: ${fileName}\\n\\n`;\n    }\n\n    prompt += `# Requirements\\n`;\n    prompt += `- Write clean, production-ready code\\n`;\n    prompt += `- Follow TypeScript best practices\\n`;\n    prompt += `- Include proper error handling\\n`;\n    prompt += `- Add JSDoc comments for public APIs\\n`;\n    prompt += `- Use modern ES6+ syntax\\n`;\n    prompt += `- Follow the project's existing patterns\\n\\n`;\n\n    // Add language-specific instructions\n    if (fileExt === '.ts' || fileExt === '.tsx') {\n      prompt += `# TypeScript Guidelines\\n`;\n      prompt += `- Use explicit types (avoid 'any')\\n`;\n      prompt += `- Define interfaces for complex objects\\n`;\n      prompt += `- Use type guards where appropriate\\n`;\n      prompt += `- Export types that might be reused\\n\\n`;\n    }\n\n    if (fileExt === '.tsx') {\n      prompt += `# React Guidelines\\n`;\n      prompt += `- Use functional components with hooks\\n`;\n      prompt += `- Properly type props and state\\n`;\n      prompt += `- Use React.FC or explicit return types\\n`;\n      prompt += `- Follow React best practices\\n\\n`;\n    }\n\n    prompt += `# Output\\n`;\n    prompt += `Provide ONLY the complete file content. Do not include explanations or markdown formatting.\\n`;\n\n    return prompt;\n  }\n\n  private extractCode(aiResponse: string): string {\n    // Remove markdown code blocks if present\n    const codeBlockMatch = aiResponse.match(/```(?:\\w+)?\\n([\\s\\S]*?)```/);\n    if (codeBlockMatch) {\n      return codeBlockMatch[1].trim();\n    }\n\n    // If no code block, return the response as-is (might already be clean code)\n    return aiResponse.trim();\n  }\n\n  async generateService(serviceName: string, serviceType: string, context: AIContext): Promise<GenerationResult> {\n    const prompt = `\nCreate a complete ${serviceType} service named ${serviceName} with the following structure:\n\n1. Service class with core business logic\n2. Controller for handling HTTP requests\n3. Repository for data access\n4. TypeScript interfaces and types\n5. Error handling middleware\n6. Input validation using Zod\n\nFollow these patterns:\n- Use dependency injection\n- Implement proper error handling\n- Add logging for important operations\n- Include JSDoc comments\n- Follow SOLID principles\n\nGenerate the complete service implementation.\n`;\n\n    const response = await this.aiOrchestrator.generateCode(prompt, context);\n    \n    // Parse the response to extract multiple files\n    const files = this.parseMultiFileResponse(response.content, serviceName);\n\n    return {\n      files,\n      success: true,\n    };\n  }\n\n  async generateComponent(componentName: string, componentType: string, context: AIContext): Promise<GenerationResult> {\n    const prompt = `\nCreate a React component named ${componentName} of type ${componentType}.\n\nRequirements:\n- Use TypeScript with proper typing\n- Use functional component with hooks\n- Include proper prop types\n- Add CSS module or styled-components\n- Follow React best practices\n- Make it accessible (ARIA attributes)\n- Add loading and error states if applicable\n\nGenerate the complete component implementation.\n`;\n\n    const response = await this.aiOrchestrator.generateCode(prompt, context);\n    \n    const files = this.parseMultiFileResponse(response.content, componentName);\n\n    return {\n      files,\n      success: true,\n    };\n  }\n\n  private parseMultiFileResponse(response: string, baseName: string): GeneratedFile[] {\n    const files: GeneratedFile[] = [];\n    \n    // Try to extract multiple code blocks\n    const codeBlocks = response.matchAll(/```(?:\\w+)?\\s*(?:\\/\\/\\s*(.+?))?\\n([\\s\\S]*?)```/g);\n    \n    let index = 0;\n    for (const match of codeBlocks) {\n      const fileName = match[1] || `${baseName}-${index}.ts`;\n      const content = match[2].trim();\n      \n      files.push({\n        path: fileName,\n        content,\n        type: 'create',\n      });\n      \n      index++;\n    }\n\n    // If no code blocks found, treat entire response as single file\n    if (files.length === 0) {\n      files.push({\n        path: `${baseName}.ts`,\n        content: this.extractCode(response),\n        type: 'create',\n      });\n    }\n\n    return files;\n  }\n\n  private async fileExists(filePath: string): Promise<boolean> {\n    try {\n      await fs.promises.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}