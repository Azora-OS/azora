{"version":3,"names":["fs","_interopRequireWildcard","require","path","_electron","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","AuditLogger","MAX_LOG_SIZE","MAX_LOG_FILES","FLUSH_INTERVAL","events","flushTimer","eventCounter","constructor","projectPath","logPath","join","app","getPath","currentLogFile","Date","now","initialize","mkdir","recursive","startPeriodicFlush","rotateLogs","log","type","action","resource","options","event","id","generateEventId","timestamp","severity","actor","details","metadata","push","length","flush","logAIRequest","model","prompt","promptLength","tokens","cost","logAIResponse","success","duration","errorMessage","logFileOperation","operation","filePath","typeMap","read","write","delete","create","fileSize","logNetworkRequest","url","method","statusCode","logPermission","permissionType","granted","reason","logSecretAccess","key","scope","logGitOperation","repository","commit","pull","branch","logCodeExecution","description","filesAffected","query","allEvents","loadAllEvents","filtered","startDate","filter","endDate","types","includes","severities","offset","limit","slice","getStatistics","eventsByType","eventsBySeverity","resourceCounts","recentErrors","topResources","entries","sort","a","b","map","count","totalEvents","export","outputPath","json","JSON","stringify","writeFile","clearOldLogs","daysToKeep","files","readdir","cutoffDate","deletedCount","file","startsWith","endsWith","stats","stat","mtime","unlink","eventsToWrite","lines","appendFile","error","unshift","shutdown","clearInterval","setInterval","catch","console","size","cleanupOldLogs","logFiles","name","filesWithStats","Promise","all","getTime","toDelete","content","readFile","trim","split","line","parse","exports"],"sources":["AuditLogger.ts"],"sourcesContent":["import * as fs from 'fs/promises';\nimport * as path from 'path';\nimport { app } from 'electron';\n\n/**\n * Audit event types\n */\nexport type AuditEventType =\n  | 'ai:request'\n  | 'ai:response'\n  | 'file:read'\n  | 'file:write'\n  | 'file:delete'\n  | 'file:create'\n  | 'network:request'\n  | 'network:response'\n  | 'permission:grant'\n  | 'permission:deny'\n  | 'secret:read'\n  | 'secret:write'\n  | 'secret:delete'\n  | 'git:commit'\n  | 'git:push'\n  | 'git:pull'\n  | 'project:open'\n  | 'project:close'\n  | 'code:execute'\n  | 'code:generate';\n\n/**\n * Audit event severity levels\n */\nexport type AuditSeverity = 'info' | 'warning' | 'error' | 'critical';\n\n/**\n * Audit event entry\n */\nexport interface AuditEvent {\n  id: string;\n  timestamp: Date;\n  type: AuditEventType;\n  severity: AuditSeverity;\n  actor: string; // User or system component\n  resource: string;\n  action: string;\n  details?: Record<string, any>;\n  metadata?: {\n    projectPath?: string;\n    fileSize?: number;\n    duration?: number;\n    success?: boolean;\n    errorMessage?: string;\n  };\n}\n\n/**\n * Audit log query options\n */\nexport interface AuditQueryOptions {\n  startDate?: Date;\n  endDate?: Date;\n  types?: AuditEventType[];\n  severities?: AuditSeverity[];\n  actor?: string;\n  resource?: string;\n  limit?: number;\n  offset?: number;\n}\n\n/**\n * Audit log statistics\n */\nexport interface AuditStatistics {\n  totalEvents: number;\n  eventsByType: Record<AuditEventType, number>;\n  eventsBySeverity: Record<AuditSeverity, number>;\n  recentErrors: AuditEvent[];\n  topResources: Array<{ resource: string; count: number }>;\n}\n\n/**\n * AuditLogger provides comprehensive audit logging for all sensitive operations\n * in AzStudio including AI actions, file modifications, network requests, and\n * permission grants.\n * \n * Features:\n * - Structured event logging with metadata\n * - Queryable audit trail\n * - Automatic log rotation\n * - Export capabilities\n * - Real-time statistics\n */\nexport class AuditLogger {\n  private static readonly MAX_LOG_SIZE = 10 * 1024 * 1024; // 10MB\n  private static readonly MAX_LOG_FILES = 5;\n  private static readonly FLUSH_INTERVAL = 5000; // 5 seconds\n\n  private logPath: string;\n  private currentLogFile: string;\n  private events: AuditEvent[] = [];\n  private flushTimer: NodeJS.Timeout | null = null;\n  private eventCounter = 0;\n\n  constructor(projectPath?: string) {\n    if (projectPath) {\n      this.logPath = path.join(projectPath, '.azstudio', 'audit-logs');\n    } else {\n      this.logPath = path.join(app.getPath('userData'), 'audit-logs');\n    }\n    \n    this.currentLogFile = path.join(this.logPath, `audit-${Date.now()}.jsonl`);\n  }\n\n  /**\n   * Initialize the audit logger\n   */\n  async initialize(): Promise<void> {\n    // Ensure log directory exists\n    await fs.mkdir(this.logPath, { recursive: true });\n\n    // Start periodic flush\n    this.startPeriodicFlush();\n\n    // Rotate logs if needed\n    await this.rotateLogs();\n  }\n\n  /**\n   * Log an audit event\n   */\n  async log(\n    type: AuditEventType,\n    action: string,\n    resource: string,\n    options?: {\n      severity?: AuditSeverity;\n      actor?: string;\n      details?: Record<string, any>;\n      metadata?: AuditEvent['metadata'];\n    }\n  ): Promise<void> {\n    const event: AuditEvent = {\n      id: this.generateEventId(),\n      timestamp: new Date(),\n      type,\n      severity: options?.severity || 'info',\n      actor: options?.actor || 'system',\n      resource,\n      action,\n      details: options?.details,\n      metadata: options?.metadata,\n    };\n\n    this.events.push(event);\n\n    // Flush if buffer is large\n    if (this.events.length >= 100) {\n      await this.flush();\n    }\n  }\n\n  /**\n   * Log AI request\n   */\n  async logAIRequest(\n    model: string,\n    prompt: string,\n    options?: {\n      tokens?: number;\n      cost?: number;\n      projectPath?: string;\n    }\n  ): Promise<void> {\n    await this.log('ai:request', 'AI request sent', model, {\n      severity: 'info',\n      details: {\n        promptLength: prompt.length,\n        tokens: options?.tokens,\n        cost: options?.cost,\n      },\n      metadata: {\n        projectPath: options?.projectPath,\n      },\n    });\n  }\n\n  /**\n   * Log AI response\n   */\n  async logAIResponse(\n    model: string,\n    success: boolean,\n    options?: {\n      tokens?: number;\n      duration?: number;\n      errorMessage?: string;\n    }\n  ): Promise<void> {\n    await this.log('ai:response', 'AI response received', model, {\n      severity: success ? 'info' : 'error',\n      details: {\n        tokens: options?.tokens,\n      },\n      metadata: {\n        success,\n        duration: options?.duration,\n        errorMessage: options?.errorMessage,\n      },\n    });\n  }\n\n  /**\n   * Log file operation\n   */\n  async logFileOperation(\n    operation: 'read' | 'write' | 'delete' | 'create',\n    filePath: string,\n    options?: {\n      fileSize?: number;\n      success?: boolean;\n      errorMessage?: string;\n    }\n  ): Promise<void> {\n    const typeMap = {\n      read: 'file:read' as AuditEventType,\n      write: 'file:write' as AuditEventType,\n      delete: 'file:delete' as AuditEventType,\n      create: 'file:create' as AuditEventType,\n    };\n\n    await this.log(typeMap[operation], `File ${operation}`, filePath, {\n      severity: options?.success === false ? 'error' : 'info',\n      metadata: {\n        fileSize: options?.fileSize,\n        success: options?.success,\n        errorMessage: options?.errorMessage,\n      },\n    });\n  }\n\n  /**\n   * Log network request\n   */\n  async logNetworkRequest(\n    url: string,\n    method: string,\n    options?: {\n      duration?: number;\n      statusCode?: number;\n      success?: boolean;\n      errorMessage?: string;\n    }\n  ): Promise<void> {\n    await this.log('network:request', `${method} request`, url, {\n      severity: options?.success === false ? 'warning' : 'info',\n      details: {\n        method,\n        statusCode: options?.statusCode,\n      },\n      metadata: {\n        duration: options?.duration,\n        success: options?.success,\n        errorMessage: options?.errorMessage,\n      },\n    });\n  }\n\n  /**\n   * Log permission grant/deny\n   */\n  async logPermission(\n    permissionType: string,\n    resource: string,\n    granted: boolean,\n    reason?: string\n  ): Promise<void> {\n    await this.log(\n      granted ? 'permission:grant' : 'permission:deny',\n      granted ? 'Permission granted' : 'Permission denied',\n      resource,\n      {\n        severity: granted ? 'info' : 'warning',\n        details: {\n          permissionType,\n          reason,\n        },\n        metadata: {\n          success: granted,\n        },\n      }\n    );\n  }\n\n  /**\n   * Log secret access\n   */\n  async logSecretAccess(\n    operation: 'read' | 'write' | 'delete',\n    key: string,\n    scope: string\n  ): Promise<void> {\n    const typeMap = {\n      read: 'secret:read' as AuditEventType,\n      write: 'secret:write' as AuditEventType,\n      delete: 'secret:delete' as AuditEventType,\n    };\n\n    await this.log(typeMap[operation], `Secret ${operation}`, key, {\n      severity: 'info',\n      details: {\n        scope,\n      },\n    });\n  }\n\n  /**\n   * Log Git operation\n   */\n  async logGitOperation(\n    operation: 'commit' | 'push' | 'pull',\n    repository: string,\n    options?: {\n      branch?: string;\n      success?: boolean;\n      errorMessage?: string;\n    }\n  ): Promise<void> {\n    const typeMap = {\n      commit: 'git:commit' as AuditEventType,\n      push: 'git:push' as AuditEventType,\n      pull: 'git:pull' as AuditEventType,\n    };\n\n    await this.log(typeMap[operation], `Git ${operation}`, repository, {\n      severity: options?.success === false ? 'error' : 'info',\n      details: {\n        branch: options?.branch,\n      },\n      metadata: {\n        success: options?.success,\n        errorMessage: options?.errorMessage,\n      },\n    });\n  }\n\n  /**\n   * Log code execution\n   */\n  async logCodeExecution(\n    action: 'execute' | 'generate',\n    description: string,\n    options?: {\n      projectPath?: string;\n      filesAffected?: number;\n      success?: boolean;\n      errorMessage?: string;\n    }\n  ): Promise<void> {\n    const type = action === 'execute' ? 'code:execute' : 'code:generate';\n\n    await this.log(type, description, options?.projectPath || 'unknown', {\n      severity: options?.success === false ? 'error' : 'info',\n      details: {\n        filesAffected: options?.filesAffected,\n      },\n      metadata: {\n        projectPath: options?.projectPath,\n        success: options?.success,\n        errorMessage: options?.errorMessage,\n      },\n    });\n  }\n\n  /**\n   * Query audit events\n   */\n  async query(options: AuditQueryOptions = {}): Promise<AuditEvent[]> {\n    const allEvents = await this.loadAllEvents();\n    \n    let filtered = allEvents;\n\n    // Filter by date range\n    if (options.startDate) {\n      filtered = filtered.filter(e => e.timestamp >= options.startDate!);\n    }\n    if (options.endDate) {\n      filtered = filtered.filter(e => e.timestamp <= options.endDate!);\n    }\n\n    // Filter by type\n    if (options.types && options.types.length > 0) {\n      filtered = filtered.filter(e => options.types!.includes(e.type));\n    }\n\n    // Filter by severity\n    if (options.severities && options.severities.length > 0) {\n      filtered = filtered.filter(e => options.severities!.includes(e.severity));\n    }\n\n    // Filter by actor\n    if (options.actor) {\n      filtered = filtered.filter(e => e.actor === options.actor);\n    }\n\n    // Filter by resource\n    if (options.resource) {\n      filtered = filtered.filter(e => e.resource.includes(options.resource!));\n    }\n\n    // Apply pagination\n    const offset = options.offset || 0;\n    const limit = options.limit || filtered.length;\n    \n    return filtered.slice(offset, offset + limit);\n  }\n\n  /**\n   * Get audit statistics\n   */\n  async getStatistics(): Promise<AuditStatistics> {\n    const allEvents = await this.loadAllEvents();\n\n    const eventsByType: Record<string, number> = {};\n    const eventsBySeverity: Record<string, number> = {};\n    const resourceCounts: Record<string, number> = {};\n\n    for (const event of allEvents) {\n      // Count by type\n      eventsByType[event.type] = (eventsByType[event.type] || 0) + 1;\n\n      // Count by severity\n      eventsBySeverity[event.severity] = (eventsBySeverity[event.severity] || 0) + 1;\n\n      // Count by resource\n      resourceCounts[event.resource] = (resourceCounts[event.resource] || 0) + 1;\n    }\n\n    // Get recent errors\n    const recentErrors = allEvents\n      .filter(e => e.severity === 'error' || e.severity === 'critical')\n      .slice(-10);\n\n    // Get top resources\n    const topResources = Object.entries(resourceCounts)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([resource, count]) => ({ resource, count }));\n\n    return {\n      totalEvents: allEvents.length,\n      eventsByType: eventsByType as Record<AuditEventType, number>,\n      eventsBySeverity: eventsBySeverity as Record<AuditSeverity, number>,\n      recentErrors,\n      topResources,\n    };\n  }\n\n  /**\n   * Export audit log to file\n   */\n  async export(outputPath: string, options: AuditQueryOptions = {}): Promise<void> {\n    const events = await this.query(options);\n    const json = JSON.stringify(events, null, 2);\n    await fs.writeFile(outputPath, json, 'utf-8');\n  }\n\n  /**\n   * Clear old audit logs\n   */\n  async clearOldLogs(daysToKeep: number = 30): Promise<number> {\n    const files = await fs.readdir(this.logPath);\n    const cutoffDate = new Date(Date.now() - daysToKeep * 24 * 60 * 60 * 1000);\n    \n    let deletedCount = 0;\n\n    for (const file of files) {\n      if (!file.startsWith('audit-') || !file.endsWith('.jsonl')) {\n        continue;\n      }\n\n      const filePath = path.join(this.logPath, file);\n      const stats = await fs.stat(filePath);\n      \n      if (stats.mtime < cutoffDate) {\n        await fs.unlink(filePath);\n        deletedCount++;\n      }\n    }\n\n    return deletedCount;\n  }\n\n  /**\n   * Flush buffered events to disk\n   */\n  async flush(): Promise<void> {\n    if (this.events.length === 0) {\n      return;\n    }\n\n    const eventsToWrite = [...this.events];\n    this.events = [];\n\n    // Write events as JSONL (one JSON object per line)\n    const lines = eventsToWrite.map(e => JSON.stringify(e)).join('\\n') + '\\n';\n    \n    try {\n      await fs.appendFile(this.currentLogFile, lines, 'utf-8');\n    } catch (error) {\n      // If write fails, put events back in buffer\n      this.events.unshift(...eventsToWrite);\n      throw error;\n    }\n\n    // Check if log rotation is needed\n    await this.rotateLogs();\n  }\n\n  /**\n   * Shutdown the audit logger\n   */\n  async shutdown(): Promise<void> {\n    if (this.flushTimer) {\n      clearInterval(this.flushTimer);\n      this.flushTimer = null;\n    }\n\n    await this.flush();\n  }\n\n  /**\n   * Generate unique event ID\n   */\n  private generateEventId(): string {\n    return `${Date.now()}-${this.eventCounter++}`;\n  }\n\n  /**\n   * Start periodic flush timer\n   */\n  private startPeriodicFlush(): void {\n    this.flushTimer = setInterval(() => {\n      this.flush().catch(console.error);\n    }, AuditLogger.FLUSH_INTERVAL);\n  }\n\n  /**\n   * Rotate logs if current file is too large\n   */\n  private async rotateLogs(): Promise<void> {\n    try {\n      const stats = await fs.stat(this.currentLogFile);\n      \n      if (stats.size >= AuditLogger.MAX_LOG_SIZE) {\n        // Create new log file\n        this.currentLogFile = path.join(this.logPath, `audit-${Date.now()}.jsonl`);\n\n        // Delete old log files if we have too many\n        await this.cleanupOldLogs();\n      }\n    } catch (error) {\n      // File doesn't exist yet, that's fine\n    }\n  }\n\n  /**\n   * Clean up old log files\n   */\n  private async cleanupOldLogs(): Promise<void> {\n    const files = await fs.readdir(this.logPath);\n    const logFiles = files\n      .filter(f => f.startsWith('audit-') && f.endsWith('.jsonl'))\n      .map(f => ({\n        name: f,\n        path: path.join(this.logPath, f),\n      }));\n\n    if (logFiles.length <= AuditLogger.MAX_LOG_FILES) {\n      return;\n    }\n\n    // Sort by modification time\n    const filesWithStats = await Promise.all(\n      logFiles.map(async f => ({\n        ...f,\n        stats: await fs.stat(f.path),\n      }))\n    );\n\n    filesWithStats.sort((a, b) => a.stats.mtime.getTime() - b.stats.mtime.getTime());\n\n    // Delete oldest files\n    const toDelete = filesWithStats.slice(0, filesWithStats.length - AuditLogger.MAX_LOG_FILES);\n    await Promise.all(toDelete.map(f => fs.unlink(f.path)));\n  }\n\n  /**\n   * Load all events from log files\n   */\n  private async loadAllEvents(): Promise<AuditEvent[]> {\n    const files = await fs.readdir(this.logPath);\n    const logFiles = files\n      .filter(f => f.startsWith('audit-') && f.endsWith('.jsonl'))\n      .map(f => path.join(this.logPath, f));\n\n    const allEvents: AuditEvent[] = [];\n\n    for (const file of logFiles) {\n      try {\n        const content = await fs.readFile(file, 'utf-8');\n        const lines = content.trim().split('\\n');\n        \n        for (const line of lines) {\n          if (line.trim()) {\n            const event = JSON.parse(line);\n            event.timestamp = new Date(event.timestamp);\n            allEvents.push(event);\n          }\n        }\n      } catch (error) {\n        console.error(`Error reading log file ${file}:`, error);\n      }\n    }\n\n    // Sort by timestamp\n    allEvents.sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n\n    return allEvents;\n  }\n}\n"],"mappings":"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","ignoreList":[]}