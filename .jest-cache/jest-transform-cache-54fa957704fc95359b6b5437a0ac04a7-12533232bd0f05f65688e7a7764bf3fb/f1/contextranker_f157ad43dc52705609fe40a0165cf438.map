{"version":3,"names":["cov_hurphovm9","actualCoverage","ContextRanker","constructor","options","b","f","s","relevanceWeight","diversityWeight","recencyWeight","categoryDiversity","deduplicateThreshold","rank","documents","length","totalScore","averageRankScore","deduplicatedCount","deduplicatedDocs","deduplicateSimilar","rankedDocs","map","doc","index","relevanceScore","calculateRelevanceScore","diversityScore","calculateDiversityScore","recencyScore","calculateRecencyScore","rankScore","sort","a","reduce","sum","score","Math","min","max","allDocs","sameCategory","slice","filter","d","metadata","category","prevDoc","source","now","Date","docTime","timestamp","getTime","ageMs","ageDays","exp","deduplicated","seen","Set","i","has","push","add","j","otherDoc","similarity","calculateContentSimilarity","doc1","doc2","embedding","cosineSimilarity","textSimilarity","content","vec1","vec2","dotProduct","norm1","norm2","denominator","sqrt","text1","text2","words1","toLowerCase","split","words2","intersection","w","union","size","rerank","previousWeights","undefined","result","getStatistics","averageRelevance","averageDiversity","averageRecency","topScore","bottomScore","exports"],"sources":["context-ranker.ts"],"sourcesContent":["/**\r\n * Context Ranker\r\n * Implements ranking algorithm with diversity scoring and deduplication\r\n */\r\n\r\nimport { Document } from './types';\r\n\r\nexport interface RankingOptions {\r\n  relevanceWeight?: number;\r\n  diversityWeight?: number;\r\n  recencyWeight?: number;\r\n  categoryDiversity?: boolean;\r\n  deduplicateThreshold?: number;\r\n}\r\n\r\nexport interface RankedDocument extends Document {\r\n  rankScore: number;\r\n  relevanceScore: number;\r\n  diversityScore: number;\r\n  recencyScore: number;\r\n}\r\n\r\nexport interface RankingResult {\r\n  documents: RankedDocument[];\r\n  totalScore: number;\r\n  averageRankScore: number;\r\n  deduplicatedCount: number;\r\n}\r\n\r\n/**\r\n * Context Ranker\r\n * Ranks documents by relevance, diversity, and recency\r\n */\r\nexport class ContextRanker {\r\n  private relevanceWeight: number;\r\n  private diversityWeight: number;\r\n  private recencyWeight: number;\r\n  private categoryDiversity: boolean;\r\n  private deduplicateThreshold: number;\r\n\r\n  constructor(options: RankingOptions = {}) {\r\n    this.relevanceWeight = options.relevanceWeight || 0.6;\r\n    this.diversityWeight = options.diversityWeight || 0.2;\r\n    this.recencyWeight = options.recencyWeight || 0.2;\r\n    this.categoryDiversity = options.categoryDiversity !== false;\r\n    this.deduplicateThreshold = options.deduplicateThreshold || 0.95;\r\n  }\r\n\r\n  /**\r\n   * Rank documents by multiple criteria\r\n   */\r\n  public rank(documents: Document[]): RankingResult {\r\n    if (documents.length === 0) {\r\n      return {\r\n        documents: [],\r\n        totalScore: 0,\r\n        averageRankScore: 0,\r\n        deduplicatedCount: 0\r\n      };\r\n    }\r\n\r\n    // Deduplicate similar documents\r\n    const deduplicatedDocs = this.deduplicateSimilar(documents);\r\n    const deduplicatedCount = documents.length - deduplicatedDocs.length;\r\n\r\n    // Calculate individual scores\r\n    const rankedDocs = deduplicatedDocs.map((doc, index) => {\r\n      const relevanceScore = this.calculateRelevanceScore(doc);\r\n      const diversityScore = this.calculateDiversityScore(doc, deduplicatedDocs, index);\r\n      const recencyScore = this.calculateRecencyScore(doc);\r\n\r\n      const rankScore =\r\n        relevanceScore * this.relevanceWeight +\r\n        diversityScore * this.diversityWeight +\r\n        recencyScore * this.recencyWeight;\r\n\r\n      return {\r\n        ...doc,\r\n        rankScore,\r\n        relevanceScore,\r\n        diversityScore,\r\n        recencyScore\r\n      };\r\n    });\r\n\r\n    // Sort by rank score descending\r\n    rankedDocs.sort((a, b) => b.rankScore - a.rankScore);\r\n\r\n    const totalScore = rankedDocs.reduce((sum, doc) => sum + doc.rankScore, 0);\r\n    const averageRankScore = totalScore / rankedDocs.length;\r\n\r\n    return {\r\n      documents: rankedDocs,\r\n      totalScore,\r\n      averageRankScore,\r\n      deduplicatedCount\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate relevance score based on vector similarity\r\n   */\r\n  private calculateRelevanceScore(doc: Document): number {\r\n    // Normalize score from 0-1 range\r\n    const score = doc.score || 0;\r\n    return Math.min(Math.max(score, 0), 1);\r\n  }\r\n\r\n  /**\r\n   * Calculate diversity score to promote varied results\r\n   */\r\n  private calculateDiversityScore(\r\n    doc: Document,\r\n    allDocs: Document[],\r\n    index: number\r\n  ): number {\r\n    let diversityScore = 1.0;\r\n\r\n    // Penalize documents with same category\r\n    if (this.categoryDiversity) {\r\n      const sameCategory = allDocs\r\n        .slice(0, index)\r\n        .filter(d => d.metadata.category === doc.metadata.category).length;\r\n\r\n      if (sameCategory > 0) {\r\n        diversityScore = Math.max(0.3, 1.0 - sameCategory * 0.15);\r\n      }\r\n    }\r\n\r\n    // Penalize documents with same source appearing consecutively\r\n    if (index > 0) {\r\n      const prevDoc = allDocs[index - 1];\r\n      if (prevDoc && prevDoc.metadata.source === doc.metadata.source) {\r\n        diversityScore *= 0.85;\r\n      }\r\n    }\r\n\r\n    return diversityScore;\r\n  }\r\n\r\n  /**\r\n   * Calculate recency score based on document timestamp\r\n   */\r\n  private calculateRecencyScore(doc: Document): number {\r\n    const now = Date.now();\r\n    const docTime = doc.metadata.timestamp.getTime();\r\n    const ageMs = now - docTime;\r\n\r\n    // Convert to days\r\n    const ageDays = ageMs / (1000 * 60 * 60 * 24);\r\n\r\n    // Exponential decay: newer documents score higher\r\n    // After 30 days, score is ~0.37\r\n    // After 90 days, score is ~0.05\r\n    const recencyScore = Math.exp(-ageDays / 30);\r\n\r\n    return Math.max(0, Math.min(recencyScore, 1));\r\n  }\r\n\r\n  /**\r\n   * Deduplicate similar documents based on content similarity\r\n   */\r\n  private deduplicateSimilar(documents: Document[]): Document[] {\r\n    const deduplicated: Document[] = [];\r\n    const seen = new Set<number>();\r\n\r\n    for (let i = 0; i < documents.length; i++) {\r\n      if (seen.has(i)) {continue;}\r\n\r\n      const doc = documents[i];\r\n      if (!doc) {continue;}\r\n\r\n      deduplicated.push(doc);\r\n      seen.add(i);\r\n\r\n      // Mark similar documents as seen\r\n      for (let j = i + 1; j < documents.length; j++) {\r\n        if (seen.has(j)) {continue;}\r\n\r\n        const otherDoc = documents[j];\r\n        if (!otherDoc) {continue;}\r\n\r\n        const similarity = this.calculateContentSimilarity(doc, otherDoc);\r\n        if (similarity >= this.deduplicateThreshold) {\r\n          seen.add(j);\r\n        }\r\n      }\r\n    }\r\n\r\n    return deduplicated;\r\n  }\r\n\r\n  /**\r\n   * Calculate content similarity between two documents\r\n   */\r\n  private calculateContentSimilarity(doc1: Document, doc2: Document): number {\r\n    // If both have embeddings, use cosine similarity\r\n    if (doc1.embedding && doc2.embedding) {\r\n      return this.cosineSimilarity(doc1.embedding, doc2.embedding);\r\n    }\r\n\r\n    // Fallback to text-based similarity\r\n    return this.textSimilarity(doc1.content, doc2.content);\r\n  }\r\n\r\n  /**\r\n   * Calculate cosine similarity between two vectors\r\n   */\r\n  private cosineSimilarity(vec1: number[], vec2: number[]): number {\r\n    if (vec1.length !== vec2.length) {\r\n      return 0;\r\n    }\r\n\r\n    let dotProduct = 0;\r\n    let norm1 = 0;\r\n    let norm2 = 0;\r\n\r\n    for (let i = 0; i < vec1.length; i++) {\r\n      dotProduct += vec1[i] * vec2[i];\r\n      norm1 += vec1[i] * vec1[i];\r\n      norm2 += vec2[i] * vec2[i];\r\n    }\r\n\r\n    const denominator = Math.sqrt(norm1) * Math.sqrt(norm2);\r\n    if (denominator === 0) {\r\n      return 0;\r\n    }\r\n\r\n    return dotProduct / denominator;\r\n  }\r\n\r\n  /**\r\n   * Calculate text similarity using Jaccard index\r\n   */\r\n  private textSimilarity(text1: string, text2: string): number {\r\n    const words1 = new Set(text1.toLowerCase().split(/\\s+/));\r\n    const words2 = new Set(text2.toLowerCase().split(/\\s+/));\r\n\r\n    const intersection = new Set([...words1].filter(w => words2.has(w)));\r\n    const union = new Set([...words1, ...words2]);\r\n\r\n    if (union.size === 0) {\r\n      return 0;\r\n    }\r\n\r\n    return intersection.size / union.size;\r\n  }\r\n\r\n  /**\r\n   * Rerank documents with custom weights\r\n   */\r\n  public rerank(\r\n    documents: Document[],\r\n    options: RankingOptions\r\n  ): RankingResult {\r\n    const previousWeights = {\r\n      relevanceWeight: this.relevanceWeight,\r\n      diversityWeight: this.diversityWeight,\r\n      recencyWeight: this.recencyWeight\r\n    };\r\n\r\n    // Apply new weights\r\n    if (options.relevanceWeight !== undefined) {\r\n      this.relevanceWeight = options.relevanceWeight;\r\n    }\r\n    if (options.diversityWeight !== undefined) {\r\n      this.diversityWeight = options.diversityWeight;\r\n    }\r\n    if (options.recencyWeight !== undefined) {\r\n      this.recencyWeight = options.recencyWeight;\r\n    }\r\n\r\n    const result = this.rank(documents);\r\n\r\n    // Restore previous weights\r\n    this.relevanceWeight = previousWeights.relevanceWeight;\r\n    this.diversityWeight = previousWeights.diversityWeight;\r\n    this.recencyWeight = previousWeights.recencyWeight;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get ranking statistics\r\n   */\r\n  public getStatistics(rankedDocs: RankedDocument[]): {\r\n    averageRelevance: number;\r\n    averageDiversity: number;\r\n    averageRecency: number;\r\n    topScore: number;\r\n    bottomScore: number;\r\n  } {\r\n    if (rankedDocs.length === 0) {\r\n      return {\r\n        averageRelevance: 0,\r\n        averageDiversity: 0,\r\n        averageRecency: 0,\r\n        topScore: 0,\r\n        bottomScore: 0\r\n      };\r\n    }\r\n\r\n    const averageRelevance =\r\n      rankedDocs.reduce((sum, doc) => sum + doc.relevanceScore, 0) / rankedDocs.length;\r\n    const averageDiversity =\r\n      rankedDocs.reduce((sum, doc) => sum + doc.diversityScore, 0) / rankedDocs.length;\r\n    const averageRecency =\r\n      rankedDocs.reduce((sum, doc) => sum + doc.recencyScore, 0) / rankedDocs.length;\r\n\r\n    return {\r\n      averageRelevance,\r\n      averageDiversity,\r\n      averageRecency,\r\n      topScore: rankedDocs[0]?.rankScore || 0,\r\n      bottomScore: rankedDocs[rankedDocs.length - 1]?.rankScore || 0\r\n    };\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}