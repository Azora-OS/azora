{"version":3,"names":["_DatabaseDesigner","require","describe","designer","beforeEach","DatabaseDesigner","it","schema","models","id","name","fields","type","required","isPrimaryKey","unique","relations","result","generateSchema","expect","toHaveLength","path","toContain","content","sourceModel","targetModel","sourceField","targetField","onDelete","default","generateMigration","preview","previewMigration"],"sources":["DatabaseDesigner.test.ts"],"sourcesContent":["import { DatabaseDesigner, DatabaseSchema } from '../DatabaseDesigner';\n\ndescribe('DatabaseDesigner', () => {\n  let designer: DatabaseDesigner;\n\n  beforeEach(() => {\n    designer = new DatabaseDesigner();\n  });\n\n  describe('generateSchema', () => {\n    it('should generate basic Prisma schema with models', () => {\n      const schema: DatabaseSchema = {\n        models: [\n          {\n            id: 'model1',\n            name: 'User',\n            fields: [\n              { id: 'f1', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n              { id: 'f2', name: 'email', type: 'String', required: true, unique: true },\n              { id: 'f3', name: 'name', type: 'String', required: false },\n            ],\n          },\n        ],\n        relations: [],\n      };\n\n      const result = designer.generateSchema(schema, '/test');\n\n      expect(result).toHaveLength(1);\n      expect(result[0].path).toContain('schema.prisma');\n      expect(result[0].content).toContain('model User');\n      expect(result[0].content).toContain('id           String @id');\n      expect(result[0].content).toContain('email        String @unique');\n      expect(result[0].content).toContain('name         String?');\n    });\n\n    it('should generate schema with 1:N relationships', () => {\n      const schema: DatabaseSchema = {\n        models: [\n          {\n            id: 'model1',\n            name: 'User',\n            fields: [\n              { id: 'f1', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n              { id: 'f2', name: 'email', type: 'String', required: true },\n            ],\n          },\n          {\n            id: 'model2',\n            name: 'Post',\n            fields: [\n              { id: 'f3', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n              { id: 'f4', name: 'title', type: 'String', required: true },\n            ],\n          },\n        ],\n        relations: [\n          {\n            id: 'rel1',\n            sourceModel: 'User',\n            targetModel: 'Post',\n            type: '1:N',\n            sourceField: 'posts',\n            targetField: 'author',\n          },\n        ],\n      };\n\n      const result = designer.generateSchema(schema, '/test');\n\n      expect(result[0].content).toContain('posts        Post[]');\n      expect(result[0].content).toContain('author       User?');\n      expect(result[0].content).toContain('authorId     String?');\n    });\n\n    it('should generate schema with cascade delete', () => {\n      const schema: DatabaseSchema = {\n        models: [\n          {\n            id: 'model1',\n            name: 'User',\n            fields: [\n              { id: 'f1', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n            ],\n          },\n          {\n            id: 'model2',\n            name: 'Post',\n            fields: [\n              { id: 'f2', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n            ],\n          },\n        ],\n        relations: [\n          {\n            id: 'rel1',\n            sourceModel: 'User',\n            targetModel: 'Post',\n            type: '1:N',\n            onDelete: 'Cascade',\n          },\n        ],\n      };\n\n      const result = designer.generateSchema(schema, '/test');\n\n      expect(result[0].content).toContain('onDelete: Cascade');\n    });\n  });\n\n  describe('generateMigration', () => {\n    it('should generate SQL migration file', () => {\n      const schema: DatabaseSchema = {\n        models: [\n          {\n            id: 'model1',\n            name: 'User',\n            fields: [\n              { id: 'f1', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n              { id: 'f2', name: 'email', type: 'String', required: true, unique: true },\n              { id: 'f3', name: 'createdAt', type: 'DateTime', required: true, default: 'now()' },\n            ],\n          },\n        ],\n        relations: [],\n      };\n\n      const result = designer.generateMigration(schema, 'init', '/test');\n\n      expect(result).toHaveLength(1);\n      expect(result[0].path).toContain('migration.sql');\n      expect(result[0].content).toContain('CREATE TABLE \"User\"');\n      expect(result[0].content).toContain('\"id\" TEXT NOT NULL PRIMARY KEY');\n      expect(result[0].content).toContain('\"email\" TEXT NOT NULL UNIQUE');\n      expect(result[0].content).toContain('\"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT NOW()');\n    });\n\n    it('should generate foreign key constraints', () => {\n      const schema: DatabaseSchema = {\n        models: [\n          {\n            id: 'model1',\n            name: 'User',\n            fields: [\n              { id: 'f1', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n            ],\n          },\n          {\n            id: 'model2',\n            name: 'Post',\n            fields: [\n              { id: 'f2', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n            ],\n          },\n        ],\n        relations: [\n          {\n            id: 'rel1',\n            sourceModel: 'Post',\n            targetModel: 'User',\n            type: '1:N',\n            sourceField: 'author',\n            onDelete: 'Cascade',\n          },\n        ],\n      };\n\n      const result = designer.generateMigration(schema, 'add_posts', '/test');\n\n      expect(result[0].content).toContain('AddForeignKey');\n      expect(result[0].content).toContain('FOREIGN KEY');\n      expect(result[0].content).toContain('ON DELETE CASCADE');\n    });\n  });\n\n  describe('previewMigration', () => {\n    it('should preview migration SQL', () => {\n      const schema: DatabaseSchema = {\n        models: [\n          {\n            id: 'model1',\n            name: 'Product',\n            fields: [\n              { id: 'f1', name: 'id', type: 'String', required: true, isPrimaryKey: true },\n              { id: 'f2', name: 'name', type: 'String', required: true },\n              { id: 'f3', name: 'price', type: 'Float', required: true },\n              { id: 'f4', name: 'inStock', type: 'Boolean', required: true },\n            ],\n          },\n        ],\n        relations: [],\n      };\n\n      const preview = designer.previewMigration(schema);\n\n      expect(preview).toContain('CREATE TABLE \"Product\"');\n      expect(preview).toContain('\"name\" TEXT NOT NULL');\n      expect(preview).toContain('\"price\" DOUBLE PRECISION NOT NULL');\n      expect(preview).toContain('\"inStock\" BOOLEAN NOT NULL');\n    });\n  });\n});\n"],"mappings":"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","ignoreList":[]}