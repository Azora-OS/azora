{"version":3,"names":["_base","require","MockStripeService","BaseMock","paymentIntents","Map","customers","webhookEvents","createPaymentIntent","params","trackCall","paymentIntent","id","generateId","amount","currency","status","client_secret","customer","metadata","set","confirmPaymentIntent","paymentIntentId","get","Error","cancelPaymentIntent","createCustomer","email","name","getCustomer","customerId","createRefund","payment_intent","simulateWebhook","type","data","event","object","push","verifyWebhookSignature","payload","signature","secret","getWebhookEvents","getPaymentIntent","reset","clear","Math","random","toString","substring","exports","mockStripe"],"sources":["stripe.mock.ts"],"sourcesContent":["import { BaseMock } from './base.mock';\r\n\r\nexport interface MockPaymentIntent {\r\n  id: string;\r\n  amount: number;\r\n  currency: string;\r\n  status: 'requires_payment_method' | 'requires_confirmation' | 'requires_action' | 'processing' | 'succeeded' | 'canceled';\r\n  client_secret: string;\r\n  customer?: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface MockCustomer {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface MockWebhookEvent {\r\n  id: string;\r\n  type: string;\r\n  data: {\r\n    object: any;\r\n  };\r\n}\r\n\r\n/**\r\n * Mock Stripe service for testing\r\n */\r\nexport class MockStripeService extends BaseMock {\r\n  private paymentIntents: Map<string, MockPaymentIntent> = new Map();\r\n  private customers: Map<string, MockCustomer> = new Map();\r\n  private webhookEvents: MockWebhookEvent[] = [];\r\n\r\n  /**\r\n   * Create a payment intent\r\n   */\r\n  async createPaymentIntent(params: {\r\n    amount: number;\r\n    currency: string;\r\n    customer?: string;\r\n    metadata?: Record<string, any>;\r\n  }): Promise<MockPaymentIntent> {\r\n    this.trackCall('createPaymentIntent', [params]);\r\n\r\n    const paymentIntent: MockPaymentIntent = {\r\n      id: `pi_test_${this.generateId()}`,\r\n      amount: params.amount,\r\n      currency: params.currency,\r\n      status: 'requires_payment_method',\r\n      client_secret: `pi_test_${this.generateId()}_secret_${this.generateId()}`,\r\n      customer: params.customer,\r\n      metadata: params.metadata,\r\n    };\r\n\r\n    this.paymentIntents.set(paymentIntent.id, paymentIntent);\r\n    return paymentIntent;\r\n  }\r\n\r\n  /**\r\n   * Confirm a payment intent\r\n   */\r\n  async confirmPaymentIntent(paymentIntentId: string): Promise<MockPaymentIntent> {\r\n    this.trackCall('confirmPaymentIntent', [paymentIntentId]);\r\n\r\n    const paymentIntent = this.paymentIntents.get(paymentIntentId);\r\n    if (!paymentIntent) {\r\n      throw new Error(`Payment intent ${paymentIntentId} not found`);\r\n    }\r\n\r\n    paymentIntent.status = 'succeeded';\r\n    return paymentIntent;\r\n  }\r\n\r\n  /**\r\n   * Cancel a payment intent\r\n   */\r\n  async cancelPaymentIntent(paymentIntentId: string): Promise<MockPaymentIntent> {\r\n    this.trackCall('cancelPaymentIntent', [paymentIntentId]);\r\n\r\n    const paymentIntent = this.paymentIntents.get(paymentIntentId);\r\n    if (!paymentIntent) {\r\n      throw new Error(`Payment intent ${paymentIntentId} not found`);\r\n    }\r\n\r\n    paymentIntent.status = 'canceled';\r\n    return paymentIntent;\r\n  }\r\n\r\n  /**\r\n   * Create a customer\r\n   */\r\n  async createCustomer(params: {\r\n    email: string;\r\n    name?: string;\r\n    metadata?: Record<string, any>;\r\n  }): Promise<MockCustomer> {\r\n    this.trackCall('createCustomer', [params]);\r\n\r\n    const customer: MockCustomer = {\r\n      id: `cus_test_${this.generateId()}`,\r\n      email: params.email,\r\n      name: params.name,\r\n      metadata: params.metadata,\r\n    };\r\n\r\n    this.customers.set(customer.id, customer);\r\n    return customer;\r\n  }\r\n\r\n  /**\r\n   * Get a customer\r\n   */\r\n  async getCustomer(customerId: string): Promise<MockCustomer> {\r\n    this.trackCall('getCustomer', [customerId]);\r\n\r\n    const customer = this.customers.get(customerId);\r\n    if (!customer) {\r\n      throw new Error(`Customer ${customerId} not found`);\r\n    }\r\n\r\n    return customer;\r\n  }\r\n\r\n  /**\r\n   * Create a refund\r\n   */\r\n  async createRefund(params: {\r\n    paymentIntent: string;\r\n    amount?: number;\r\n  }): Promise<any> {\r\n    this.trackCall('createRefund', [params]);\r\n\r\n    const paymentIntent = this.paymentIntents.get(params.paymentIntent);\r\n    if (!paymentIntent) {\r\n      throw new Error(`Payment intent ${params.paymentIntent} not found`);\r\n    }\r\n\r\n    return {\r\n      id: `re_test_${this.generateId()}`,\r\n      amount: params.amount || paymentIntent.amount,\r\n      currency: paymentIntent.currency,\r\n      payment_intent: params.paymentIntent,\r\n      status: 'succeeded',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Simulate a webhook event\r\n   */\r\n  simulateWebhook(type: string, data: any): MockWebhookEvent {\r\n    this.trackCall('simulateWebhook', [type, data]);\r\n\r\n    const event: MockWebhookEvent = {\r\n      id: `evt_test_${this.generateId()}`,\r\n      type,\r\n      data: {\r\n        object: data,\r\n      },\r\n    };\r\n\r\n    this.webhookEvents.push(event);\r\n    return event;\r\n  }\r\n\r\n  /**\r\n   * Verify webhook signature (always returns true in tests)\r\n   */\r\n  verifyWebhookSignature(payload: string, signature: string, secret: string): boolean {\r\n    this.trackCall('verifyWebhookSignature', [payload, signature, secret]);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get all webhook events\r\n   */\r\n  getWebhookEvents(): MockWebhookEvent[] {\r\n    return this.webhookEvents;\r\n  }\r\n\r\n  /**\r\n   * Get payment intent by ID\r\n   */\r\n  getPaymentIntent(id: string): MockPaymentIntent | undefined {\r\n    return this.paymentIntents.get(id);\r\n  }\r\n\r\n  /**\r\n   * Reset mock state\r\n   */\r\n  reset(): void {\r\n    super.reset();\r\n    this.paymentIntents.clear();\r\n    this.customers.clear();\r\n    this.webhookEvents = [];\r\n  }\r\n\r\n  /**\r\n   * Generate a random ID\r\n   */\r\n  private generateId(): string {\r\n    return Math.random().toString(36).substring(2, 15);\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const mockStripe = new MockStripeService();\r\n"],"mappings":"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","ignoreList":[]}