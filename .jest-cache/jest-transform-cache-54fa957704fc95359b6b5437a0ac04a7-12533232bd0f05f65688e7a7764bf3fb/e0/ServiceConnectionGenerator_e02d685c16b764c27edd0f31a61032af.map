{"version":3,"names":["path","_interopRequireWildcard","require","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ServiceConnectionGenerator","generateServiceConnection","connection","outputDir","changes","push","generateAPIRoutes","generateServiceClient","authentication","generateAuthMiddleware","generateValidation","targetDir","join","targetService","routeName","toKebabCase","sourceService","type","content","generateRouteController","generateRouteService","serviceName","toPascalCase","toCamelCase","endpoints","map","endpoint","methodName","getMethodName","hasBody","includes","method","description","toLowerCase","requestSchema","getMethodParams","params","getServiceMethodParams","sourceDir","clientName","generateClientClass","generateClientTypes","responseSchema","filter","Boolean","toConstantCase","getClientMethodParams","returnType","types","Set","forEach","add","size","Array","from","generateAuthMiddlewareContent","schemaName","generateValidationSchemas","pathParts","split","p","startsWith","action","pathParams","match","slice","str","replace","_","c","toUpperCase","camel","charAt","exports"],"sources":["ServiceConnectionGenerator.ts"],"sourcesContent":["import * as path from 'path';\nimport { FileChange } from '../ChangesetManager';\n\nexport interface ServiceConnection {\n  sourceService: string;\n  targetService: string;\n  endpoints: ConnectionEndpoint[];\n  authentication?: boolean;\n}\n\nexport interface ConnectionEndpoint {\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  path: string;\n  description: string;\n  requestSchema?: string;\n  responseSchema?: string;\n}\n\nexport class ServiceConnectionGenerator {\n  /**\n   * Generate API routes and client code for service-to-service communication\n   */\n  generateServiceConnection(connection: ServiceConnection, outputDir: string): FileChange[] {\n    const changes: FileChange[] = [];\n\n    // Generate API routes in target service\n    changes.push(...this.generateAPIRoutes(connection, outputDir));\n\n    // Generate service client in source service\n    changes.push(...this.generateServiceClient(connection, outputDir));\n\n    // Generate authentication middleware if needed\n    if (connection.authentication) {\n      changes.push(...this.generateAuthMiddleware(connection, outputDir));\n    }\n\n    // Generate request validation\n    changes.push(...this.generateValidation(connection, outputDir));\n\n    return changes;\n  }\n\n  private generateAPIRoutes(connection: ServiceConnection, outputDir: string): FileChange[] {\n    const changes: FileChange[] = [];\n    const targetDir = path.join(outputDir, 'services', connection.targetService);\n    const routeName = this.toKebabCase(connection.sourceService);\n\n    // Generate route controller\n    changes.push({\n      path: path.join(targetDir, 'src', 'controllers', `${routeName}.controller.ts`),\n      type: 'create',\n      content: this.generateRouteController(connection),\n    });\n\n    // Generate route service\n    changes.push({\n      path: path.join(targetDir, 'src', 'services', `${routeName}.service.ts`),\n      type: 'create',\n      content: this.generateRouteService(connection),\n    });\n\n    return changes;\n  }\n\n  private generateRouteController(connection: ServiceConnection): string {\n    const serviceName = this.toPascalCase(connection.sourceService);\n    \n    return `import { Router, Request, Response, NextFunction } from 'express';\nimport { ${serviceName}Service } from '../services/${this.toKebabCase(connection.sourceService)}.service';\nimport { validate } from '../middleware/validation';\nimport { ${serviceName}Schemas } from '../validation/${this.toKebabCase(connection.sourceService)}.schemas';\n${connection.authentication ? \"import { authMiddleware } from '../middleware/auth.middleware';\" : ''}\n\nexport class ${serviceName}Controller {\n  public router: Router;\n  private ${this.toCamelCase(connection.sourceService)}Service: ${serviceName}Service;\n\n  constructor() {\n    this.router = Router();\n    this.${this.toCamelCase(connection.sourceService)}Service = new ${serviceName}Service();\n    this.initializeRoutes();\n  }\n\n  private initializeRoutes(): void {\n${connection.endpoints.map(endpoint => {\n  const methodName = this.getMethodName(endpoint);\n  const hasBody = ['POST', 'PUT', 'PATCH'].includes(endpoint.method);\n  \n  return `    // ${endpoint.description}\n    this.router.${endpoint.method.toLowerCase()}(\n      '${endpoint.path}',\n      ${connection.authentication ? 'authMiddleware, ' : ''}${hasBody && endpoint.requestSchema ? `validate(${serviceName}Schemas.${methodName}), ` : ''}this.${methodName}.bind(this)\n    );\n`;\n}).join('\\n')}\n  }\n${connection.endpoints.map(endpoint => {\n  const methodName = this.getMethodName(endpoint);\n  \n  return `\n  private async ${methodName}(req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const result = await this.${this.toCamelCase(connection.sourceService)}Service.${methodName}(${this.getMethodParams(endpoint)});\n      res.json({ success: true, data: result });\n    } catch (error) {\n      next(error);\n    }\n  }`;\n}).join('\\n')}\n}\n`;\n  }\n\n  private generateRouteService(connection: ServiceConnection): string {\n    const serviceName = this.toPascalCase(connection.sourceService);\n    \n    return `export class ${serviceName}Service {\n${connection.endpoints.map(endpoint => {\n  const methodName = this.getMethodName(endpoint);\n  const params = this.getServiceMethodParams(endpoint);\n  \n  return `\n  async ${methodName}(${params}): Promise<any> {\n    // TODO: Implement ${endpoint.description}\n    throw new Error('Not implemented');\n  }`;\n}).join('\\n')}\n}\n`;\n  }\n\n  private generateServiceClient(connection: ServiceConnection, outputDir: string): FileChange[] {\n    const changes: FileChange[] = [];\n    const sourceDir = path.join(outputDir, 'services', connection.sourceService);\n    const clientName = this.toKebabCase(connection.targetService);\n\n    // Generate client class\n    changes.push({\n      path: path.join(sourceDir, 'src', 'clients', `${clientName}.client.ts`),\n      type: 'create',\n      content: this.generateClientClass(connection),\n    });\n\n    // Generate client types\n    changes.push({\n      path: path.join(sourceDir, 'src', 'clients', `${clientName}.types.ts`),\n      type: 'create',\n      content: this.generateClientTypes(connection),\n    });\n\n    return changes;\n  }\n\n  private generateClientClass(connection: ServiceConnection): string {\n    const clientName = this.toPascalCase(connection.targetService);\n    \n    return `import axios, { AxiosInstance } from 'axios';\n${connection.endpoints.map(endpoint => {\n  if (endpoint.requestSchema || endpoint.responseSchema) {\n    return `import { ${endpoint.requestSchema || ''}, ${endpoint.responseSchema || ''} } from './${this.toKebabCase(connection.targetService)}.types';`;\n  }\n  return '';\n}).filter(Boolean).join('\\n')}\n\nexport class ${clientName}Client {\n  private client: AxiosInstance;\n  private baseURL: string;\n${connection.authentication ? '  private authToken?: string;' : ''}\n\n  constructor(baseURL?: string${connection.authentication ? ', authToken?: string' : ''}) {\n    this.baseURL = baseURL || process.env.${this.toConstantCase(connection.targetService)}_URL || 'http://localhost:3000';\n${connection.authentication ? '    this.authToken = authToken;' : ''}\n    \n    this.client = axios.create({\n      baseURL: this.baseURL,\n      timeout: 10000,\n      headers: {\n        'Content-Type': 'application/json',\n${connection.authentication ? \"        ...(this.authToken && { Authorization: \\`Bearer \\${this.authToken}\\` }),\" : ''}\n      },\n    });\n  }\n${connection.authentication ? `\n  setAuthToken(token: string): void {\n    this.authToken = token;\n    this.client.defaults.headers.common['Authorization'] = \\`Bearer \\${token}\\`;\n  }\n` : ''}\n${connection.endpoints.map(endpoint => {\n  const methodName = this.getMethodName(endpoint);\n  const hasBody = ['POST', 'PUT', 'PATCH'].includes(endpoint.method);\n  const params = this.getClientMethodParams(endpoint);\n  const returnType = endpoint.responseSchema || 'any';\n  \n  return `\n  async ${methodName}(${params}): Promise<${returnType}> {\n    const response = await this.client.${endpoint.method.toLowerCase()}${hasBody ? `(\n      '${endpoint.path}',\n      ${endpoint.requestSchema ? 'data' : '{}'}\n    )` : `('${endpoint.path}')`};\n    return response.data.data;\n  }`;\n}).join('\\n')}\n}\n`;\n  }\n\n  private generateClientTypes(connection: ServiceConnection): string {\n    const types = new Set<string>();\n    \n    connection.endpoints.forEach(endpoint => {\n      if (endpoint.requestSchema) types.add(endpoint.requestSchema);\n      if (endpoint.responseSchema) types.add(endpoint.responseSchema);\n    });\n\n    if (types.size === 0) {\n      return '// No types defined for this client\\n';\n    }\n\n    return Array.from(types).map(type => {\n      return `export interface ${type} {\n  // TODO: Define ${type} properties\n  [key: string]: any;\n}\n`;\n    }).join('\\n');\n  }\n\n  private generateAuthMiddleware(connection: ServiceConnection, outputDir: string): FileChange[] {\n    const changes: FileChange[] = [];\n    const targetDir = path.join(outputDir, 'services', connection.targetService);\n\n    changes.push({\n      path: path.join(targetDir, 'src', 'middleware', 'auth.middleware.ts'),\n      type: 'create',\n      content: this.generateAuthMiddlewareContent(),\n    });\n\n    return changes;\n  }\n\n  private generateAuthMiddlewareContent(): string {\n    return `import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { AppError } from './error-handler';\n\ninterface JWTPayload {\n  userId: string;\n  email: string;\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: JWTPayload;\n    }\n  }\n}\n\nexport const authMiddleware = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void => {\n  try {\n    const token = req.headers.authorization?.replace('Bearer ', '');\n\n    if (!token) {\n      throw new AppError(401, 'Authentication required');\n    }\n\n    const secret = process.env.JWT_SECRET || 'your-secret-key';\n    const decoded = jwt.verify(token, secret) as JWTPayload;\n\n    req.user = decoded;\n    next();\n  } catch (error) {\n    next(new AppError(401, 'Invalid or expired token'));\n  }\n};\n\nexport const serviceAuthMiddleware = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void => {\n  try {\n    const apiKey = req.headers['x-api-key'];\n\n    if (!apiKey) {\n      throw new AppError(401, 'API key required');\n    }\n\n    const validApiKey = process.env.SERVICE_API_KEY;\n    if (apiKey !== validApiKey) {\n      throw new AppError(401, 'Invalid API key');\n    }\n\n    next();\n  } catch (error) {\n    next(error);\n  }\n};\n`;\n  }\n\n  private generateValidation(connection: ServiceConnection, outputDir: string): FileChange[] {\n    const changes: FileChange[] = [];\n    const targetDir = path.join(outputDir, 'services', connection.targetService);\n    const schemaName = this.toKebabCase(connection.sourceService);\n\n    changes.push({\n      path: path.join(targetDir, 'src', 'validation', `${schemaName}.schemas.ts`),\n      type: 'create',\n      content: this.generateValidationSchemas(connection),\n    });\n\n    return changes;\n  }\n\n  private generateValidationSchemas(connection: ServiceConnection): string {\n    const serviceName = this.toPascalCase(connection.sourceService);\n    \n    return `import { z } from 'zod';\n\nexport const ${serviceName}Schemas = {\n${connection.endpoints.filter(e => e.requestSchema).map(endpoint => {\n  const methodName = this.getMethodName(endpoint);\n  \n  return `  ${methodName}: z.object({\n    body: z.object({\n      // TODO: Define validation schema for ${endpoint.description}\n    }),\n  }),\n`;\n}).join('\\n')}\n};\n`;\n  }\n\n  // Helper methods\n  private getMethodName(endpoint: ConnectionEndpoint): string {\n    const pathParts = endpoint.path.split('/').filter(p => p && !p.startsWith(':'));\n    const action = endpoint.method.toLowerCase();\n    return `${action}${pathParts.map(p => this.toPascalCase(p)).join('')}`;\n  }\n\n  private getMethodParams(endpoint: ConnectionEndpoint): string {\n    const params: string[] = [];\n    \n    // Extract path parameters\n    const pathParams = endpoint.path.match(/:(\\w+)/g);\n    if (pathParams) {\n      params.push(...pathParams.map(p => `req.params.${p.slice(1)}`));\n    }\n\n    // Add body for POST/PUT/PATCH\n    if (['POST', 'PUT', 'PATCH'].includes(endpoint.method)) {\n      params.push('req.body');\n    }\n\n    // Add query params\n    if (endpoint.method === 'GET') {\n      params.push('req.query');\n    }\n\n    return params.join(', ');\n  }\n\n  private getServiceMethodParams(endpoint: ConnectionEndpoint): string {\n    const params: string[] = [];\n    \n    // Extract path parameters\n    const pathParams = endpoint.path.match(/:(\\w+)/g);\n    if (pathParams) {\n      params.push(...pathParams.map(p => `${p.slice(1)}: string`));\n    }\n\n    // Add body for POST/PUT/PATCH\n    if (['POST', 'PUT', 'PATCH'].includes(endpoint.method)) {\n      params.push('data: any');\n    }\n\n    // Add query params\n    if (endpoint.method === 'GET') {\n      params.push('query?: any');\n    }\n\n    return params.join(', ');\n  }\n\n  private getClientMethodParams(endpoint: ConnectionEndpoint): string {\n    const params: string[] = [];\n    \n    // Extract path parameters\n    const pathParams = endpoint.path.match(/:(\\w+)/g);\n    if (pathParams) {\n      params.push(...pathParams.map(p => `${p.slice(1)}: string`));\n    }\n\n    // Add body for POST/PUT/PATCH\n    if (['POST', 'PUT', 'PATCH'].includes(endpoint.method) && endpoint.requestSchema) {\n      params.push(`data: ${endpoint.requestSchema}`);\n    }\n\n    return params.join(', ');\n  }\n\n  private toKebabCase(str: string): string {\n    return str\n      .replace(/([a-z])([A-Z])/g, '$1-$2')\n      .replace(/[\\s_]+/g, '-')\n      .toLowerCase();\n  }\n\n  private toCamelCase(str: string): string {\n    return str\n      .replace(/[-_\\s]+(.)?/g, (_, c) => (c ? c.toUpperCase() : ''))\n      .replace(/^[A-Z]/, c => c.toLowerCase());\n  }\n\n  private toPascalCase(str: string): string {\n    const camel = this.toCamelCase(str);\n    return camel.charAt(0).toUpperCase() + camel.slice(1);\n  }\n\n  private toConstantCase(str: string): string {\n    return str\n      .replace(/([a-z])([A-Z])/g, '$1_$2')\n      .replace(/[\\s-]+/g, '_')\n      .toUpperCase();\n  }\n}\n"],"mappings":"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","ignoreList":[]}