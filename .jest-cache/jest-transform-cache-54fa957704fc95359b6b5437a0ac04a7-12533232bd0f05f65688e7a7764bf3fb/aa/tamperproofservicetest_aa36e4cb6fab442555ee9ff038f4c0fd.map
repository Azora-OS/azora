{"version":3,"names":["tamperProofService","require","describe","userId","dataType","testData","name","age","email","beforeEach","dataStore","clear","auditTrail","test","result","storeData","expect","toBeDefined","id","dataHash","signature","createdAt","storedEntry","get","toBe","data","toEqual","storeResult","retrievedData","retrieveData","isValid","updatedData","updateResult","updateData","has","deleteResult","deleteData","success","verifyDataIntegrity","userEntries","listUserData","length","every","entry","startsWith","results","verifyAllUserData","getAuditTrail","action"],"sources":["tamper-proof-service.test.js"],"sourcesContent":["const tamperProofService = require('../index');\n\ndescribe('Tamper-Proof Data Service', () => {\n  const userId = 'test-user-123';\n  const dataType = 'test_data';\n  const testData = { name: 'John Doe', age: 30, email: 'john@example.com' };\n\n  beforeEach(() => {\n    // Clear data store and audit trail before each test\n    tamperProofService.dataStore.clear();\n    tamperProofService.auditTrail = [];\n  });\n\n  test('should store data with hash and signature', () => {\n    const result = tamperProofService.storeData(userId, dataType, testData);\n\n    expect(result).toBeDefined();\n    expect(result.id).toBeDefined();\n    expect(result.dataHash).toBeDefined();\n    expect(result.signature).toBeDefined();\n    expect(result.createdAt).toBeDefined();\n\n    // Verify data was stored\n    const storedEntry = tamperProofService.dataStore.get(result.id);\n    expect(storedEntry).toBeDefined();\n    expect(storedEntry.userId).toBe(userId);\n    expect(storedEntry.dataType).toBe(dataType);\n    expect(storedEntry.data).toEqual(testData);\n  });\n\n  test('should retrieve data and verify integrity', () => {\n    // Store data first\n    const storeResult = tamperProofService.storeData(userId, dataType, testData);\n\n    // Retrieve data\n    const retrievedData = tamperProofService.retrieveData(storeResult.id, userId);\n\n    expect(retrievedData).toBeDefined();\n    expect(retrievedData.id).toBe(storeResult.id);\n    expect(retrievedData.data).toEqual(testData);\n    expect(retrievedData.dataType).toBe(dataType);\n    expect(retrievedData.isValid).toBe(true);\n  });\n\n  test('should update data with new signature', () => {\n    // Store data first\n    const storeResult = tamperProofService.storeData(userId, dataType, testData);\n\n    // Update data\n    const updatedData = { ...testData, age: 31 };\n    const updateResult = tamperProofService.updateData(storeResult.id, userId, updatedData);\n\n    expect(updateResult).toBeDefined();\n    expect(updateResult.id).toBe(storeResult.id);\n    expect(updateResult.dataHash).toBeDefined();\n    expect(updateResult.signature).toBeDefined();\n\n    // Verify updated data\n    const retrievedData = tamperProofService.retrieveData(storeResult.id, userId);\n    expect(retrievedData.data).toEqual(updatedData);\n    expect(retrievedData.isValid).toBe(true);\n  });\n\n  test('should delete data', () => {\n    // Store data first\n    const storeResult = tamperProofService.storeData(userId, dataType, testData);\n\n    // Verify data exists\n    expect(tamperProofService.dataStore.has(storeResult.id)).toBe(true);\n\n    // Delete data\n    const deleteResult = tamperProofService.deleteData(storeResult.id, userId);\n\n    expect(deleteResult.success).toBe(true);\n\n    // Verify data was deleted\n    expect(tamperProofService.dataStore.has(storeResult.id)).toBe(false);\n  });\n\n  test('should verify data integrity', () => {\n    // Store data\n    const storeResult = tamperProofService.storeData(userId, dataType, testData);\n    const storedEntry = tamperProofService.dataStore.get(storeResult.id);\n\n    // Verify integrity\n    const isValid = tamperProofService.verifyDataIntegrity(storedEntry);\n\n    expect(isValid).toBe(true);\n  });\n\n  test('should detect tampered data', () => {\n    // Store data\n    const storeResult = tamperProofService.storeData(userId, dataType, testData);\n    const storedEntry = tamperProofService.dataStore.get(storeResult.id);\n\n    // Tamper with data\n    storedEntry.data.name = 'Evil Hacker';\n\n    // Verify integrity fails\n    const isValid = tamperProofService.verifyDataIntegrity(storedEntry);\n\n    expect(isValid).toBe(false);\n  });\n\n  test('should list user data', () => {\n    // Store multiple data entries\n    tamperProofService.storeData(userId, 'type1', { data: 'test1' });\n    tamperProofService.storeData(userId, 'type2', { data: 'test2' });\n    tamperProofService.storeData('other-user', 'type3', { data: 'test3' });\n\n    // List user data\n    const userEntries = tamperProofService.listUserData(userId);\n\n    expect(userEntries.length).toBe(2);\n    expect(userEntries.every(entry => entry.dataType.startsWith('type'))).toBe(true);\n  });\n\n  test('should verify all user data', () => {\n    // Store multiple data entries\n    tamperProofService.storeData(userId, 'type1', { data: 'test1' });\n    tamperProofService.storeData(userId, 'type2', { data: 'test2' });\n\n    // Verify all user data\n    const results = tamperProofService.verifyAllUserData(userId);\n\n    expect(results.length).toBe(2);\n    expect(results.every(result => result.isValid)).toBe(true);\n  });\n\n  test('should maintain audit trail', () => {\n    // Store data\n    const storeResult = tamperProofService.storeData(userId, dataType, testData);\n\n    // Update data\n    tamperProofService.updateData(storeResult.id, userId, { ...testData, age: 31 });\n\n    // Get audit trail\n    const auditTrail = tamperProofService.getAuditTrail(storeResult.id);\n\n    expect(auditTrail.length).toBe(2);\n    expect(auditTrail[0].action).toBe('CREATE');\n    expect(auditTrail[1].action).toBe('UPDATE');\n  });\n});\n"],"mappings":"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","ignoreList":[]}