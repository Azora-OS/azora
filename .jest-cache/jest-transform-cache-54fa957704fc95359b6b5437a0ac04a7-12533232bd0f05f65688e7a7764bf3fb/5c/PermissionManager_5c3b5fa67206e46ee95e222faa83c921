08be15150b5fb39e80b8872e11e74ab8
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PermissionManager = void 0;
var fs = _interopRequireWildcard(require("fs/promises"));
var path = _interopRequireWildcard(require("path"));
var _electron = require("electron");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
/**
 * Permission types that can be requested
 */

/**
 * Permission grant entry
 */

/**
 * Permission request options
 */

/**
 * Network allowlist entry
 */

/**
 * Permission configuration
 */

/**
 * PermissionManager handles all permission requests and grants for AzStudio.
 * It provides a security layer for file system access, network requests,
 * and other sensitive operations.
 * 
 * Features:
 * - Permission prompts with clear explanations
 * - Network request allowlisting
 * - Temporary and permanent grants
 * - Auto-grant patterns for trusted paths
 * - Audit logging of all permission grants
 */
class PermissionManager {
  static CONFIG_VERSION = '1.0.0';
  static DEFAULT_TEMP_DURATION = 3600000; // 1 hour

  mainWindow = null;
  auditLog = [];
  constructor() {
    this.configPath = path.join(_electron.app.getPath('userData'), 'permissions.json');
    this.config = {
      version: PermissionManager.CONFIG_VERSION,
      grants: [],
      networkAllowlist: [],
      autoGrantPatterns: [
      // Auto-grant for user's home directory and common dev paths
      path.join(_electron.app.getPath('home'), '**'), path.join(_electron.app.getPath('documents'), '**'), path.join(_electron.app.getPath('desktop'), '**')]
    };
  }

  /**
   * Initialize the permission manager
   */
  async initialize(mainWindow) {
    this.mainWindow = mainWindow;
    await this.loadConfig();

    // Add default network allowlist entries
    await this.addDefaultAllowlistEntries();
  }

  /**
   * Request permission for an operation
   */
  async requestPermission(options) {
    const {
      type,
      resource,
      reason,
      temporary = false,
      duration
    } = options;

    // Check if permission already granted
    const existingGrant = this.findGrant(type, resource);
    if (existingGrant) {
      // Check if expired
      if (existingGrant.expiresAt && existingGrant.expiresAt < new Date()) {
        // Remove expired grant
        await this.revokePermission(type, resource);
      } else {
        this.logPermission(type, resource, true, 'Already granted');
        return existingGrant.granted;
      }
    }

    // Check auto-grant patterns
    if (this.shouldAutoGrant(type, resource)) {
      await this.grantPermission(type, resource, true, duration);
      this.logPermission(type, resource, true, 'Auto-granted');
      return true;
    }

    // Show permission prompt
    const granted = await this.showPermissionPrompt(type, resource, reason);

    // Store the grant
    if (granted) {
      await this.grantPermission(type, resource, !temporary, duration);
    }
    this.logPermission(type, resource, granted, reason);
    return granted;
  }

  /**
   * Grant permission for a resource
   */
  async grantPermission(type, resource, permanent = false, duration) {
    const grant = {
      type,
      resource,
      granted: true,
      timestamp: new Date(),
      permanent
    };
    if (!permanent) {
      const expirationDuration = duration || PermissionManager.DEFAULT_TEMP_DURATION;
      grant.expiresAt = new Date(Date.now() + expirationDuration);
    }

    // Remove existing grant if any
    this.config.grants = this.config.grants.filter(g => !(g.type === type && g.resource === resource));
    this.config.grants.push(grant);
    await this.saveConfig();
  }

  /**
   * Revoke permission for a resource
   */
  async revokePermission(type, resource) {
    const initialLength = this.config.grants.length;
    this.config.grants = this.config.grants.filter(g => !(g.type === type && g.resource === resource));
    if (this.config.grants.length < initialLength) {
      await this.saveConfig();
      return true;
    }
    return false;
  }

  /**
   * Check if a domain is allowed for network requests
   */
  async isNetworkAllowed(domain) {
    // Check allowlist
    const entry = this.config.networkAllowlist.find(e => e.domain === domain);
    if (entry) {
      return entry.allowed;
    }

    // Check if it's a known safe domain
    if (this.isKnownSafeDomain(domain)) {
      await this.addToNetworkAllowlist(domain, true, 'Known safe domain');
      return true;
    }

    // Request permission
    const granted = await this.requestPermission({
      type: 'network:request',
      resource: domain,
      reason: `Allow network requests to ${domain}?`
    });
    if (granted) {
      await this.addToNetworkAllowlist(domain, true, 'User granted');
    }
    return granted;
  }

  /**
   * Add domain to network allowlist
   */
  async addToNetworkAllowlist(domain, allowed, reason) {
    // Remove existing entry
    this.config.networkAllowlist = this.config.networkAllowlist.filter(e => e.domain !== domain);
    this.config.networkAllowlist.push({
      domain,
      allowed,
      addedAt: new Date(),
      reason
    });
    await this.saveConfig();
  }

  /**
   * Remove domain from network allowlist
   */
  async removeFromNetworkAllowlist(domain) {
    const initialLength = this.config.networkAllowlist.length;
    this.config.networkAllowlist = this.config.networkAllowlist.filter(e => e.domain !== domain);
    if (this.config.networkAllowlist.length < initialLength) {
      await this.saveConfig();
      return true;
    }
    return false;
  }

  /**
   * Get all permission grants
   */
  getGrants() {
    // Filter out expired grants
    const now = new Date();
    return this.config.grants.filter(g => !g.expiresAt || g.expiresAt > now);
  }

  /**
   * Get network allowlist
   */
  getNetworkAllowlist() {
    return [...this.config.networkAllowlist];
  }

  /**
   * Get audit log
   */
  getAuditLog() {
    return [...this.auditLog];
  }

  /**
   * Clear audit log
   */
  clearAuditLog() {
    this.auditLog = [];
  }

  /**
   * Add auto-grant pattern
   */
  async addAutoGrantPattern(pattern) {
    if (!this.config.autoGrantPatterns.includes(pattern)) {
      this.config.autoGrantPatterns.push(pattern);
      await this.saveConfig();
    }
  }

  /**
   * Remove auto-grant pattern
   */
  async removeAutoGrantPattern(pattern) {
    const initialLength = this.config.autoGrantPatterns.length;
    this.config.autoGrantPatterns = this.config.autoGrantPatterns.filter(p => p !== pattern);
    if (this.config.autoGrantPatterns.length < initialLength) {
      await this.saveConfig();
      return true;
    }
    return false;
  }

  /**
   * Get auto-grant patterns
   */
  getAutoGrantPatterns() {
    return [...this.config.autoGrantPatterns];
  }

  /**
   * Find existing grant
   */
  findGrant(type, resource) {
    return this.config.grants.find(g => g.type === type && g.resource === resource);
  }

  /**
   * Check if permission should be auto-granted
   */
  shouldAutoGrant(type, resource) {
    // Only auto-grant filesystem operations
    if (!type.startsWith('filesystem:')) {
      return false;
    }

    // Normalize paths for comparison (handle both forward and back slashes)
    const normalizedResource = resource.replace(/\\/g, '/');

    // Check against patterns
    return this.config.autoGrantPatterns.some(pattern => {
      // Normalize pattern path
      const normalizedPattern = pattern.replace(/\\/g, '/');

      // Escape special regex characters except * and **
      const escapedPattern = normalizedPattern.replace(/[.+?^${}()|[\]]/g, '\\$&').replace(/\*\*/g, '___DOUBLESTAR___').replace(/\*/g, '[^/]*').replace(/___DOUBLESTAR___/g, '.*');
      const regex = new RegExp(`^${escapedPattern}$`);
      return regex.test(normalizedResource);
    });
  }

  /**
   * Check if domain is known to be safe
   */
  isKnownSafeDomain(domain) {
    const safeDomains = ['api.openai.com', 'api.anthropic.com', 'api.elevenlabs.io', 'api.heygen.com', 'github.com', 'api.github.com', 'gitlab.com', 'vercel.com', 'railway.app', 'render.com'];
    return safeDomains.some(safe => domain === safe || domain.endsWith(`.${safe}`));
  }

  /**
   * Show permission prompt dialog
   */
  async showPermissionPrompt(type, resource, reason) {
    if (!this.mainWindow) {
      return false;
    }
    const message = this.formatPermissionMessage(type, resource, reason);
    const result = await _electron.dialog.showMessageBox(this.mainWindow, {
      type: 'question',
      buttons: ['Allow', 'Deny', 'Allow Always'],
      defaultId: 0,
      cancelId: 1,
      title: 'Permission Request',
      message: 'AzStudio Permission Request',
      detail: message
    });

    // If "Allow Always" was clicked
    if (result.response === 2) {
      await this.grantPermission(type, resource, true);
      return true;
    }
    return result.response === 0;
  }

  /**
   * Format permission message for display
   */
  formatPermissionMessage(type, resource, reason) {
    let message = '';
    switch (type) {
      case 'filesystem:read':
        message = `Read files from:\n${resource}`;
        break;
      case 'filesystem:write':
        message = `Write files to:\n${resource}`;
        break;
      case 'filesystem:delete':
        message = `Delete files from:\n${resource}`;
        break;
      case 'network:request':
        message = `Make network requests to:\n${resource}`;
        break;
      case 'network:external-api':
        message = `Access external API:\n${resource}`;
        break;
      case 'process:execute':
        message = `Execute process:\n${resource}`;
        break;
      case 'git:operation':
        message = `Perform Git operation:\n${resource}`;
        break;
    }
    if (reason) {
      message += `\n\nReason: ${reason}`;
    }
    return message;
  }

  /**
   * Log permission grant/denial
   */
  logPermission(type, resource, granted, reason) {
    this.auditLog.push({
      timestamp: new Date(),
      type,
      resource,
      granted,
      reason
    });
  }

  /**
   * Add default network allowlist entries
   */
  async addDefaultAllowlistEntries() {
    const defaults = [{
      domain: 'api.openai.com',
      reason: 'OpenAI API for AI features'
    }, {
      domain: 'api.anthropic.com',
      reason: 'Anthropic API for AI features'
    }, {
      domain: 'api.elevenlabs.io',
      reason: 'ElevenLabs API for text-to-speech'
    }, {
      domain: 'api.heygen.com',
      reason: 'HeyGen API for video generation'
    }, {
      domain: 'github.com',
      reason: 'GitHub for Git operations'
    }, {
      domain: 'api.github.com',
      reason: 'GitHub API for repository operations'
    }];
    for (const {
      domain,
      reason
    } of defaults) {
      const exists = this.config.networkAllowlist.some(e => e.domain === domain);
      if (!exists) {
        this.config.networkAllowlist.push({
          domain,
          allowed: true,
          addedAt: new Date(),
          reason
        });
      }
    }
    await this.saveConfig();
  }

  /**
   * Load configuration from file
   */
  async loadConfig() {
    try {
      const data = await fs.readFile(this.configPath, 'utf-8');
      const loaded = JSON.parse(data);

      // Merge with defaults
      this.config = {
        ...this.config,
        ...loaded,
        grants: loaded.grants.map(g => ({
          ...g,
          timestamp: new Date(g.timestamp),
          expiresAt: g.expiresAt ? new Date(g.expiresAt) : undefined
        })),
        networkAllowlist: loaded.networkAllowlist.map(e => ({
          ...e,
          addedAt: new Date(e.addedAt)
        }))
      };
    } catch (error) {
      // Config doesn't exist yet, use defaults
      await this.saveConfig();
    }
  }

  /**
   * Save configuration to file
   */
  async saveConfig() {
    await fs.writeFile(this.configPath, JSON.stringify(this.config, null, 2), {
      mode: 0o600
    });
  }
}
exports.PermissionManager = PermissionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsInBhdGgiLCJfZWxlY3Ryb24iLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJQZXJtaXNzaW9uTWFuYWdlciIsIkNPTkZJR19WRVJTSU9OIiwiREVGQVVMVF9URU1QX0RVUkFUSU9OIiwibWFpbldpbmRvdyIsImF1ZGl0TG9nIiwiY29uc3RydWN0b3IiLCJjb25maWdQYXRoIiwiam9pbiIsImFwcCIsImdldFBhdGgiLCJjb25maWciLCJ2ZXJzaW9uIiwiZ3JhbnRzIiwibmV0d29ya0FsbG93bGlzdCIsImF1dG9HcmFudFBhdHRlcm5zIiwiaW5pdGlhbGl6ZSIsImxvYWRDb25maWciLCJhZGREZWZhdWx0QWxsb3dsaXN0RW50cmllcyIsInJlcXVlc3RQZXJtaXNzaW9uIiwib3B0aW9ucyIsInR5cGUiLCJyZXNvdXJjZSIsInJlYXNvbiIsInRlbXBvcmFyeSIsImR1cmF0aW9uIiwiZXhpc3RpbmdHcmFudCIsImZpbmRHcmFudCIsImV4cGlyZXNBdCIsIkRhdGUiLCJyZXZva2VQZXJtaXNzaW9uIiwibG9nUGVybWlzc2lvbiIsImdyYW50ZWQiLCJzaG91bGRBdXRvR3JhbnQiLCJncmFudFBlcm1pc3Npb24iLCJzaG93UGVybWlzc2lvblByb21wdCIsInBlcm1hbmVudCIsImdyYW50IiwidGltZXN0YW1wIiwiZXhwaXJhdGlvbkR1cmF0aW9uIiwibm93IiwiZmlsdGVyIiwiZyIsInB1c2giLCJzYXZlQ29uZmlnIiwiaW5pdGlhbExlbmd0aCIsImxlbmd0aCIsImlzTmV0d29ya0FsbG93ZWQiLCJkb21haW4iLCJlbnRyeSIsImZpbmQiLCJhbGxvd2VkIiwiaXNLbm93blNhZmVEb21haW4iLCJhZGRUb05ldHdvcmtBbGxvd2xpc3QiLCJhZGRlZEF0IiwicmVtb3ZlRnJvbU5ldHdvcmtBbGxvd2xpc3QiLCJnZXRHcmFudHMiLCJnZXROZXR3b3JrQWxsb3dsaXN0IiwiZ2V0QXVkaXRMb2ciLCJjbGVhckF1ZGl0TG9nIiwiYWRkQXV0b0dyYW50UGF0dGVybiIsInBhdHRlcm4iLCJpbmNsdWRlcyIsInJlbW92ZUF1dG9HcmFudFBhdHRlcm4iLCJwIiwiZ2V0QXV0b0dyYW50UGF0dGVybnMiLCJzdGFydHNXaXRoIiwibm9ybWFsaXplZFJlc291cmNlIiwicmVwbGFjZSIsInNvbWUiLCJub3JtYWxpemVkUGF0dGVybiIsImVzY2FwZWRQYXR0ZXJuIiwicmVnZXgiLCJSZWdFeHAiLCJ0ZXN0Iiwic2FmZURvbWFpbnMiLCJzYWZlIiwiZW5kc1dpdGgiLCJtZXNzYWdlIiwiZm9ybWF0UGVybWlzc2lvbk1lc3NhZ2UiLCJyZXN1bHQiLCJkaWFsb2ciLCJzaG93TWVzc2FnZUJveCIsImJ1dHRvbnMiLCJkZWZhdWx0SWQiLCJjYW5jZWxJZCIsInRpdGxlIiwiZGV0YWlsIiwicmVzcG9uc2UiLCJkZWZhdWx0cyIsImV4aXN0cyIsImRhdGEiLCJyZWFkRmlsZSIsImxvYWRlZCIsIkpTT04iLCJwYXJzZSIsIm1hcCIsInVuZGVmaW5lZCIsImVycm9yIiwid3JpdGVGaWxlIiwic3RyaW5naWZ5IiwibW9kZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJQZXJtaXNzaW9uTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgYXBwLCBkaWFsb2csIEJyb3dzZXJXaW5kb3cgfSBmcm9tICdlbGVjdHJvbic7XG5cbi8qKlxuICogUGVybWlzc2lvbiB0eXBlcyB0aGF0IGNhbiBiZSByZXF1ZXN0ZWRcbiAqL1xuZXhwb3J0IHR5cGUgUGVybWlzc2lvblR5cGUgPSBcbiAgfCAnZmlsZXN5c3RlbTpyZWFkJ1xuICB8ICdmaWxlc3lzdGVtOndyaXRlJ1xuICB8ICdmaWxlc3lzdGVtOmRlbGV0ZSdcbiAgfCAnbmV0d29yazpyZXF1ZXN0J1xuICB8ICduZXR3b3JrOmV4dGVybmFsLWFwaSdcbiAgfCAncHJvY2VzczpleGVjdXRlJ1xuICB8ICdnaXQ6b3BlcmF0aW9uJztcblxuLyoqXG4gKiBQZXJtaXNzaW9uIGdyYW50IGVudHJ5XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGVybWlzc2lvbkdyYW50IHtcbiAgdHlwZTogUGVybWlzc2lvblR5cGU7XG4gIHJlc291cmNlOiBzdHJpbmc7XG4gIGdyYW50ZWQ6IGJvb2xlYW47XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgZXhwaXJlc0F0PzogRGF0ZTtcbiAgcGVybWFuZW50OiBib29sZWFuO1xufVxuXG4vKipcbiAqIFBlcm1pc3Npb24gcmVxdWVzdCBvcHRpb25zXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGVybWlzc2lvblJlcXVlc3RPcHRpb25zIHtcbiAgdHlwZTogUGVybWlzc2lvblR5cGU7XG4gIHJlc291cmNlOiBzdHJpbmc7XG4gIHJlYXNvbj86IHN0cmluZztcbiAgdGVtcG9yYXJ5PzogYm9vbGVhbjtcbiAgZHVyYXRpb24/OiBudW1iZXI7IC8vIER1cmF0aW9uIGluIG1pbGxpc2Vjb25kcyBmb3IgdGVtcG9yYXJ5IHBlcm1pc3Npb25zXG59XG5cbi8qKlxuICogTmV0d29yayBhbGxvd2xpc3QgZW50cnlcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBbGxvd2xpc3RFbnRyeSB7XG4gIGRvbWFpbjogc3RyaW5nO1xuICBhbGxvd2VkOiBib29sZWFuO1xuICBhZGRlZEF0OiBEYXRlO1xuICByZWFzb24/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUGVybWlzc2lvbiBjb25maWd1cmF0aW9uXG4gKi9cbmludGVyZmFjZSBQZXJtaXNzaW9uQ29uZmlnIHtcbiAgdmVyc2lvbjogc3RyaW5nO1xuICBncmFudHM6IFBlcm1pc3Npb25HcmFudFtdO1xuICBuZXR3b3JrQWxsb3dsaXN0OiBBbGxvd2xpc3RFbnRyeVtdO1xuICBhdXRvR3JhbnRQYXR0ZXJuczogc3RyaW5nW107XG59XG5cbi8qKlxuICogUGVybWlzc2lvbk1hbmFnZXIgaGFuZGxlcyBhbGwgcGVybWlzc2lvbiByZXF1ZXN0cyBhbmQgZ3JhbnRzIGZvciBBelN0dWRpby5cbiAqIEl0IHByb3ZpZGVzIGEgc2VjdXJpdHkgbGF5ZXIgZm9yIGZpbGUgc3lzdGVtIGFjY2VzcywgbmV0d29yayByZXF1ZXN0cyxcbiAqIGFuZCBvdGhlciBzZW5zaXRpdmUgb3BlcmF0aW9ucy5cbiAqIFxuICogRmVhdHVyZXM6XG4gKiAtIFBlcm1pc3Npb24gcHJvbXB0cyB3aXRoIGNsZWFyIGV4cGxhbmF0aW9uc1xuICogLSBOZXR3b3JrIHJlcXVlc3QgYWxsb3dsaXN0aW5nXG4gKiAtIFRlbXBvcmFyeSBhbmQgcGVybWFuZW50IGdyYW50c1xuICogLSBBdXRvLWdyYW50IHBhdHRlcm5zIGZvciB0cnVzdGVkIHBhdGhzXG4gKiAtIEF1ZGl0IGxvZ2dpbmcgb2YgYWxsIHBlcm1pc3Npb24gZ3JhbnRzXG4gKi9cbmV4cG9ydCBjbGFzcyBQZXJtaXNzaW9uTWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTkZJR19WRVJTSU9OID0gJzEuMC4wJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9URU1QX0RVUkFUSU9OID0gMzYwMDAwMDsgLy8gMSBob3VyXG5cbiAgcHJpdmF0ZSBjb25maWdQYXRoOiBzdHJpbmc7XG4gIHByaXZhdGUgY29uZmlnOiBQZXJtaXNzaW9uQ29uZmlnO1xuICBwcml2YXRlIG1haW5XaW5kb3c6IEJyb3dzZXJXaW5kb3cgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhdWRpdExvZzogQXJyYXk8eyB0aW1lc3RhbXA6IERhdGU7IHR5cGU6IHN0cmluZzsgcmVzb3VyY2U6IHN0cmluZzsgZ3JhbnRlZDogYm9vbGVhbjsgcmVhc29uPzogc3RyaW5nIH0+ID0gW107XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb25maWdQYXRoID0gcGF0aC5qb2luKGFwcC5nZXRQYXRoKCd1c2VyRGF0YScpLCAncGVybWlzc2lvbnMuanNvbicpO1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgdmVyc2lvbjogUGVybWlzc2lvbk1hbmFnZXIuQ09ORklHX1ZFUlNJT04sXG4gICAgICBncmFudHM6IFtdLFxuICAgICAgbmV0d29ya0FsbG93bGlzdDogW10sXG4gICAgICBhdXRvR3JhbnRQYXR0ZXJuczogW1xuICAgICAgICAvLyBBdXRvLWdyYW50IGZvciB1c2VyJ3MgaG9tZSBkaXJlY3RvcnkgYW5kIGNvbW1vbiBkZXYgcGF0aHNcbiAgICAgICAgcGF0aC5qb2luKGFwcC5nZXRQYXRoKCdob21lJyksICcqKicpLFxuICAgICAgICBwYXRoLmpvaW4oYXBwLmdldFBhdGgoJ2RvY3VtZW50cycpLCAnKionKSxcbiAgICAgICAgcGF0aC5qb2luKGFwcC5nZXRQYXRoKCdkZXNrdG9wJyksICcqKicpLFxuICAgICAgXSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHBlcm1pc3Npb24gbWFuYWdlclxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZShtYWluV2luZG93OiBCcm93c2VyV2luZG93KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5tYWluV2luZG93ID0gbWFpbldpbmRvdztcbiAgICBhd2FpdCB0aGlzLmxvYWRDb25maWcoKTtcbiAgICBcbiAgICAvLyBBZGQgZGVmYXVsdCBuZXR3b3JrIGFsbG93bGlzdCBlbnRyaWVzXG4gICAgYXdhaXQgdGhpcy5hZGREZWZhdWx0QWxsb3dsaXN0RW50cmllcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcXVlc3QgcGVybWlzc2lvbiBmb3IgYW4gb3BlcmF0aW9uXG4gICAqL1xuICBhc3luYyByZXF1ZXN0UGVybWlzc2lvbihvcHRpb25zOiBQZXJtaXNzaW9uUmVxdWVzdE9wdGlvbnMpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB7IHR5cGUsIHJlc291cmNlLCByZWFzb24sIHRlbXBvcmFyeSA9IGZhbHNlLCBkdXJhdGlvbiB9ID0gb3B0aW9ucztcblxuICAgIC8vIENoZWNrIGlmIHBlcm1pc3Npb24gYWxyZWFkeSBncmFudGVkXG4gICAgY29uc3QgZXhpc3RpbmdHcmFudCA9IHRoaXMuZmluZEdyYW50KHR5cGUsIHJlc291cmNlKTtcbiAgICBpZiAoZXhpc3RpbmdHcmFudCkge1xuICAgICAgLy8gQ2hlY2sgaWYgZXhwaXJlZFxuICAgICAgaWYgKGV4aXN0aW5nR3JhbnQuZXhwaXJlc0F0ICYmIGV4aXN0aW5nR3JhbnQuZXhwaXJlc0F0IDwgbmV3IERhdGUoKSkge1xuICAgICAgICAvLyBSZW1vdmUgZXhwaXJlZCBncmFudFxuICAgICAgICBhd2FpdCB0aGlzLnJldm9rZVBlcm1pc3Npb24odHlwZSwgcmVzb3VyY2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2dQZXJtaXNzaW9uKHR5cGUsIHJlc291cmNlLCB0cnVlLCAnQWxyZWFkeSBncmFudGVkJyk7XG4gICAgICAgIHJldHVybiBleGlzdGluZ0dyYW50LmdyYW50ZWQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgYXV0by1ncmFudCBwYXR0ZXJuc1xuICAgIGlmICh0aGlzLnNob3VsZEF1dG9HcmFudCh0eXBlLCByZXNvdXJjZSkpIHtcbiAgICAgIGF3YWl0IHRoaXMuZ3JhbnRQZXJtaXNzaW9uKHR5cGUsIHJlc291cmNlLCB0cnVlLCBkdXJhdGlvbik7XG4gICAgICB0aGlzLmxvZ1Blcm1pc3Npb24odHlwZSwgcmVzb3VyY2UsIHRydWUsICdBdXRvLWdyYW50ZWQnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIFNob3cgcGVybWlzc2lvbiBwcm9tcHRcbiAgICBjb25zdCBncmFudGVkID0gYXdhaXQgdGhpcy5zaG93UGVybWlzc2lvblByb21wdCh0eXBlLCByZXNvdXJjZSwgcmVhc29uKTtcbiAgICBcbiAgICAvLyBTdG9yZSB0aGUgZ3JhbnRcbiAgICBpZiAoZ3JhbnRlZCkge1xuICAgICAgYXdhaXQgdGhpcy5ncmFudFBlcm1pc3Npb24odHlwZSwgcmVzb3VyY2UsICF0ZW1wb3JhcnksIGR1cmF0aW9uKTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5sb2dQZXJtaXNzaW9uKHR5cGUsIHJlc291cmNlLCBncmFudGVkLCByZWFzb24pO1xuICAgIFxuICAgIHJldHVybiBncmFudGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEdyYW50IHBlcm1pc3Npb24gZm9yIGEgcmVzb3VyY2VcbiAgICovXG4gIGFzeW5jIGdyYW50UGVybWlzc2lvbihcbiAgICB0eXBlOiBQZXJtaXNzaW9uVHlwZSxcbiAgICByZXNvdXJjZTogc3RyaW5nLFxuICAgIHBlcm1hbmVudDogYm9vbGVhbiA9IGZhbHNlLFxuICAgIGR1cmF0aW9uPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGdyYW50OiBQZXJtaXNzaW9uR3JhbnQgPSB7XG4gICAgICB0eXBlLFxuICAgICAgcmVzb3VyY2UsXG4gICAgICBncmFudGVkOiB0cnVlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgcGVybWFuZW50LFxuICAgIH07XG5cbiAgICBpZiAoIXBlcm1hbmVudCkge1xuICAgICAgY29uc3QgZXhwaXJhdGlvbkR1cmF0aW9uID0gZHVyYXRpb24gfHwgUGVybWlzc2lvbk1hbmFnZXIuREVGQVVMVF9URU1QX0RVUkFUSU9OO1xuICAgICAgZ3JhbnQuZXhwaXJlc0F0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIGV4cGlyYXRpb25EdXJhdGlvbik7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGV4aXN0aW5nIGdyYW50IGlmIGFueVxuICAgIHRoaXMuY29uZmlnLmdyYW50cyA9IHRoaXMuY29uZmlnLmdyYW50cy5maWx0ZXIoXG4gICAgICBnID0+ICEoZy50eXBlID09PSB0eXBlICYmIGcucmVzb3VyY2UgPT09IHJlc291cmNlKVxuICAgICk7XG5cbiAgICB0aGlzLmNvbmZpZy5ncmFudHMucHVzaChncmFudCk7XG4gICAgYXdhaXQgdGhpcy5zYXZlQ29uZmlnKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV2b2tlIHBlcm1pc3Npb24gZm9yIGEgcmVzb3VyY2VcbiAgICovXG4gIGFzeW5jIHJldm9rZVBlcm1pc3Npb24odHlwZTogUGVybWlzc2lvblR5cGUsIHJlc291cmNlOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBpbml0aWFsTGVuZ3RoID0gdGhpcy5jb25maWcuZ3JhbnRzLmxlbmd0aDtcbiAgICB0aGlzLmNvbmZpZy5ncmFudHMgPSB0aGlzLmNvbmZpZy5ncmFudHMuZmlsdGVyKFxuICAgICAgZyA9PiAhKGcudHlwZSA9PT0gdHlwZSAmJiBnLnJlc291cmNlID09PSByZXNvdXJjZSlcbiAgICApO1xuICAgIFxuICAgIGlmICh0aGlzLmNvbmZpZy5ncmFudHMubGVuZ3RoIDwgaW5pdGlhbExlbmd0aCkge1xuICAgICAgYXdhaXQgdGhpcy5zYXZlQ29uZmlnKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGEgZG9tYWluIGlzIGFsbG93ZWQgZm9yIG5ldHdvcmsgcmVxdWVzdHNcbiAgICovXG4gIGFzeW5jIGlzTmV0d29ya0FsbG93ZWQoZG9tYWluOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBDaGVjayBhbGxvd2xpc3RcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuY29uZmlnLm5ldHdvcmtBbGxvd2xpc3QuZmluZChlID0+IGUuZG9tYWluID09PSBkb21haW4pO1xuICAgIGlmIChlbnRyeSkge1xuICAgICAgcmV0dXJuIGVudHJ5LmFsbG93ZWQ7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhIGtub3duIHNhZmUgZG9tYWluXG4gICAgaWYgKHRoaXMuaXNLbm93blNhZmVEb21haW4oZG9tYWluKSkge1xuICAgICAgYXdhaXQgdGhpcy5hZGRUb05ldHdvcmtBbGxvd2xpc3QoZG9tYWluLCB0cnVlLCAnS25vd24gc2FmZSBkb21haW4nKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIFJlcXVlc3QgcGVybWlzc2lvblxuICAgIGNvbnN0IGdyYW50ZWQgPSBhd2FpdCB0aGlzLnJlcXVlc3RQZXJtaXNzaW9uKHtcbiAgICAgIHR5cGU6ICduZXR3b3JrOnJlcXVlc3QnLFxuICAgICAgcmVzb3VyY2U6IGRvbWFpbixcbiAgICAgIHJlYXNvbjogYEFsbG93IG5ldHdvcmsgcmVxdWVzdHMgdG8gJHtkb21haW59P2AsXG4gICAgfSk7XG5cbiAgICBpZiAoZ3JhbnRlZCkge1xuICAgICAgYXdhaXQgdGhpcy5hZGRUb05ldHdvcmtBbGxvd2xpc3QoZG9tYWluLCB0cnVlLCAnVXNlciBncmFudGVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdyYW50ZWQ7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGRvbWFpbiB0byBuZXR3b3JrIGFsbG93bGlzdFxuICAgKi9cbiAgYXN5bmMgYWRkVG9OZXR3b3JrQWxsb3dsaXN0KGRvbWFpbjogc3RyaW5nLCBhbGxvd2VkOiBib29sZWFuLCByZWFzb24/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBSZW1vdmUgZXhpc3RpbmcgZW50cnlcbiAgICB0aGlzLmNvbmZpZy5uZXR3b3JrQWxsb3dsaXN0ID0gdGhpcy5jb25maWcubmV0d29ya0FsbG93bGlzdC5maWx0ZXIoZSA9PiBlLmRvbWFpbiAhPT0gZG9tYWluKTtcblxuICAgIHRoaXMuY29uZmlnLm5ldHdvcmtBbGxvd2xpc3QucHVzaCh7XG4gICAgICBkb21haW4sXG4gICAgICBhbGxvd2VkLFxuICAgICAgYWRkZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHJlYXNvbixcbiAgICB9KTtcblxuICAgIGF3YWl0IHRoaXMuc2F2ZUNvbmZpZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBkb21haW4gZnJvbSBuZXR3b3JrIGFsbG93bGlzdFxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlRnJvbU5ldHdvcmtBbGxvd2xpc3QoZG9tYWluOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBpbml0aWFsTGVuZ3RoID0gdGhpcy5jb25maWcubmV0d29ya0FsbG93bGlzdC5sZW5ndGg7XG4gICAgdGhpcy5jb25maWcubmV0d29ya0FsbG93bGlzdCA9IHRoaXMuY29uZmlnLm5ldHdvcmtBbGxvd2xpc3QuZmlsdGVyKGUgPT4gZS5kb21haW4gIT09IGRvbWFpbik7XG4gICAgXG4gICAgaWYgKHRoaXMuY29uZmlnLm5ldHdvcmtBbGxvd2xpc3QubGVuZ3RoIDwgaW5pdGlhbExlbmd0aCkge1xuICAgICAgYXdhaXQgdGhpcy5zYXZlQ29uZmlnKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgcGVybWlzc2lvbiBncmFudHNcbiAgICovXG4gIGdldEdyYW50cygpOiBQZXJtaXNzaW9uR3JhbnRbXSB7XG4gICAgLy8gRmlsdGVyIG91dCBleHBpcmVkIGdyYW50c1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmdyYW50cy5maWx0ZXIoZyA9PiAhZy5leHBpcmVzQXQgfHwgZy5leHBpcmVzQXQgPiBub3cpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBuZXR3b3JrIGFsbG93bGlzdFxuICAgKi9cbiAgZ2V0TmV0d29ya0FsbG93bGlzdCgpOiBBbGxvd2xpc3RFbnRyeVtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuY29uZmlnLm5ldHdvcmtBbGxvd2xpc3RdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhdWRpdCBsb2dcbiAgICovXG4gIGdldEF1ZGl0TG9nKCk6IEFycmF5PHsgdGltZXN0YW1wOiBEYXRlOyB0eXBlOiBzdHJpbmc7IHJlc291cmNlOiBzdHJpbmc7IGdyYW50ZWQ6IGJvb2xlYW47IHJlYXNvbj86IHN0cmluZyB9PiB7XG4gICAgcmV0dXJuIFsuLi50aGlzLmF1ZGl0TG9nXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhdWRpdCBsb2dcbiAgICovXG4gIGNsZWFyQXVkaXRMb2coKTogdm9pZCB7XG4gICAgdGhpcy5hdWRpdExvZyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhdXRvLWdyYW50IHBhdHRlcm5cbiAgICovXG4gIGFzeW5jIGFkZEF1dG9HcmFudFBhdHRlcm4ocGF0dGVybjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hdXRvR3JhbnRQYXR0ZXJucy5pbmNsdWRlcyhwYXR0ZXJuKSkge1xuICAgICAgdGhpcy5jb25maWcuYXV0b0dyYW50UGF0dGVybnMucHVzaChwYXR0ZXJuKTtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUNvbmZpZygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYXV0by1ncmFudCBwYXR0ZXJuXG4gICAqL1xuICBhc3luYyByZW1vdmVBdXRvR3JhbnRQYXR0ZXJuKHBhdHRlcm46IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGluaXRpYWxMZW5ndGggPSB0aGlzLmNvbmZpZy5hdXRvR3JhbnRQYXR0ZXJucy5sZW5ndGg7XG4gICAgdGhpcy5jb25maWcuYXV0b0dyYW50UGF0dGVybnMgPSB0aGlzLmNvbmZpZy5hdXRvR3JhbnRQYXR0ZXJucy5maWx0ZXIocCA9PiBwICE9PSBwYXR0ZXJuKTtcbiAgICBcbiAgICBpZiAodGhpcy5jb25maWcuYXV0b0dyYW50UGF0dGVybnMubGVuZ3RoIDwgaW5pdGlhbExlbmd0aCkge1xuICAgICAgYXdhaXQgdGhpcy5zYXZlQ29uZmlnKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhdXRvLWdyYW50IHBhdHRlcm5zXG4gICAqL1xuICBnZXRBdXRvR3JhbnRQYXR0ZXJucygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLmNvbmZpZy5hdXRvR3JhbnRQYXR0ZXJuc107XG4gIH1cblxuICAvKipcbiAgICogRmluZCBleGlzdGluZyBncmFudFxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kR3JhbnQodHlwZTogUGVybWlzc2lvblR5cGUsIHJlc291cmNlOiBzdHJpbmcpOiBQZXJtaXNzaW9uR3JhbnQgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5ncmFudHMuZmluZChnID0+IGcudHlwZSA9PT0gdHlwZSAmJiBnLnJlc291cmNlID09PSByZXNvdXJjZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcGVybWlzc2lvbiBzaG91bGQgYmUgYXV0by1ncmFudGVkXG4gICAqL1xuICBwcml2YXRlIHNob3VsZEF1dG9HcmFudCh0eXBlOiBQZXJtaXNzaW9uVHlwZSwgcmVzb3VyY2U6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIC8vIE9ubHkgYXV0by1ncmFudCBmaWxlc3lzdGVtIG9wZXJhdGlvbnNcbiAgICBpZiAoIXR5cGUuc3RhcnRzV2l0aCgnZmlsZXN5c3RlbTonKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6ZSBwYXRocyBmb3IgY29tcGFyaXNvbiAoaGFuZGxlIGJvdGggZm9yd2FyZCBhbmQgYmFjayBzbGFzaGVzKVxuICAgIGNvbnN0IG5vcm1hbGl6ZWRSZXNvdXJjZSA9IHJlc291cmNlLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcblxuICAgIC8vIENoZWNrIGFnYWluc3QgcGF0dGVybnNcbiAgICByZXR1cm4gdGhpcy5jb25maWcuYXV0b0dyYW50UGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHtcbiAgICAgIC8vIE5vcm1hbGl6ZSBwYXR0ZXJuIHBhdGhcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG4gICAgICBcbiAgICAgIC8vIEVzY2FwZSBzcGVjaWFsIHJlZ2V4IGNoYXJhY3RlcnMgZXhjZXB0ICogYW5kICoqXG4gICAgICBjb25zdCBlc2NhcGVkUGF0dGVybiA9IG5vcm1hbGl6ZWRQYXR0ZXJuXG4gICAgICAgIC5yZXBsYWNlKC9bLis/XiR7fSgpfFtcXF1dL2csICdcXFxcJCYnKVxuICAgICAgICAucmVwbGFjZSgvXFwqXFwqL2csICdfX19ET1VCTEVTVEFSX19fJylcbiAgICAgICAgLnJlcGxhY2UoL1xcKi9nLCAnW14vXSonKVxuICAgICAgICAucmVwbGFjZSgvX19fRE9VQkxFU1RBUl9fXy9nLCAnLionKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBeJHtlc2NhcGVkUGF0dGVybn0kYCk7XG4gICAgICByZXR1cm4gcmVnZXgudGVzdChub3JtYWxpemVkUmVzb3VyY2UpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGRvbWFpbiBpcyBrbm93biB0byBiZSBzYWZlXG4gICAqL1xuICBwcml2YXRlIGlzS25vd25TYWZlRG9tYWluKGRvbWFpbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgc2FmZURvbWFpbnMgPSBbXG4gICAgICAnYXBpLm9wZW5haS5jb20nLFxuICAgICAgJ2FwaS5hbnRocm9waWMuY29tJyxcbiAgICAgICdhcGkuZWxldmVubGFicy5pbycsXG4gICAgICAnYXBpLmhleWdlbi5jb20nLFxuICAgICAgJ2dpdGh1Yi5jb20nLFxuICAgICAgJ2FwaS5naXRodWIuY29tJyxcbiAgICAgICdnaXRsYWIuY29tJyxcbiAgICAgICd2ZXJjZWwuY29tJyxcbiAgICAgICdyYWlsd2F5LmFwcCcsXG4gICAgICAncmVuZGVyLmNvbScsXG4gICAgXTtcblxuICAgIHJldHVybiBzYWZlRG9tYWlucy5zb21lKHNhZmUgPT4gZG9tYWluID09PSBzYWZlIHx8IGRvbWFpbi5lbmRzV2l0aChgLiR7c2FmZX1gKSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyBwZXJtaXNzaW9uIHByb21wdCBkaWFsb2dcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2hvd1Blcm1pc3Npb25Qcm9tcHQoXG4gICAgdHlwZTogUGVybWlzc2lvblR5cGUsXG4gICAgcmVzb3VyY2U6IHN0cmluZyxcbiAgICByZWFzb24/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLm1haW5XaW5kb3cpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5mb3JtYXRQZXJtaXNzaW9uTWVzc2FnZSh0eXBlLCByZXNvdXJjZSwgcmVhc29uKTtcbiAgICBcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkaWFsb2cuc2hvd01lc3NhZ2VCb3godGhpcy5tYWluV2luZG93LCB7XG4gICAgICB0eXBlOiAncXVlc3Rpb24nLFxuICAgICAgYnV0dG9uczogWydBbGxvdycsICdEZW55JywgJ0FsbG93IEFsd2F5cyddLFxuICAgICAgZGVmYXVsdElkOiAwLFxuICAgICAgY2FuY2VsSWQ6IDEsXG4gICAgICB0aXRsZTogJ1Blcm1pc3Npb24gUmVxdWVzdCcsXG4gICAgICBtZXNzYWdlOiAnQXpTdHVkaW8gUGVybWlzc2lvbiBSZXF1ZXN0JyxcbiAgICAgIGRldGFpbDogbWVzc2FnZSxcbiAgICB9KTtcblxuICAgIC8vIElmIFwiQWxsb3cgQWx3YXlzXCIgd2FzIGNsaWNrZWRcbiAgICBpZiAocmVzdWx0LnJlc3BvbnNlID09PSAyKSB7XG4gICAgICBhd2FpdCB0aGlzLmdyYW50UGVybWlzc2lvbih0eXBlLCByZXNvdXJjZSwgdHJ1ZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0LnJlc3BvbnNlID09PSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBwZXJtaXNzaW9uIG1lc3NhZ2UgZm9yIGRpc3BsYXlcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0UGVybWlzc2lvbk1lc3NhZ2UodHlwZTogUGVybWlzc2lvblR5cGUsIHJlc291cmNlOiBzdHJpbmcsIHJlYXNvbj86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgbGV0IG1lc3NhZ2UgPSAnJztcblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnZmlsZXN5c3RlbTpyZWFkJzpcbiAgICAgICAgbWVzc2FnZSA9IGBSZWFkIGZpbGVzIGZyb206XFxuJHtyZXNvdXJjZX1gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2ZpbGVzeXN0ZW06d3JpdGUnOlxuICAgICAgICBtZXNzYWdlID0gYFdyaXRlIGZpbGVzIHRvOlxcbiR7cmVzb3VyY2V9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdmaWxlc3lzdGVtOmRlbGV0ZSc6XG4gICAgICAgIG1lc3NhZ2UgPSBgRGVsZXRlIGZpbGVzIGZyb206XFxuJHtyZXNvdXJjZX1gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ25ldHdvcms6cmVxdWVzdCc6XG4gICAgICAgIG1lc3NhZ2UgPSBgTWFrZSBuZXR3b3JrIHJlcXVlc3RzIHRvOlxcbiR7cmVzb3VyY2V9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICduZXR3b3JrOmV4dGVybmFsLWFwaSc6XG4gICAgICAgIG1lc3NhZ2UgPSBgQWNjZXNzIGV4dGVybmFsIEFQSTpcXG4ke3Jlc291cmNlfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncHJvY2VzczpleGVjdXRlJzpcbiAgICAgICAgbWVzc2FnZSA9IGBFeGVjdXRlIHByb2Nlc3M6XFxuJHtyZXNvdXJjZX1gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2dpdDpvcGVyYXRpb24nOlxuICAgICAgICBtZXNzYWdlID0gYFBlcmZvcm0gR2l0IG9wZXJhdGlvbjpcXG4ke3Jlc291cmNlfWA7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChyZWFzb24pIHtcbiAgICAgIG1lc3NhZ2UgKz0gYFxcblxcblJlYXNvbjogJHtyZWFzb259YDtcbiAgICB9XG5cbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgcGVybWlzc2lvbiBncmFudC9kZW5pYWxcbiAgICovXG4gIHByaXZhdGUgbG9nUGVybWlzc2lvbih0eXBlOiBzdHJpbmcsIHJlc291cmNlOiBzdHJpbmcsIGdyYW50ZWQ6IGJvb2xlYW4sIHJlYXNvbj86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuYXVkaXRMb2cucHVzaCh7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB0eXBlLFxuICAgICAgcmVzb3VyY2UsXG4gICAgICBncmFudGVkLFxuICAgICAgcmVhc29uLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBkZWZhdWx0IG5ldHdvcmsgYWxsb3dsaXN0IGVudHJpZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgYWRkRGVmYXVsdEFsbG93bGlzdEVudHJpZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGVmYXVsdHMgPSBbXG4gICAgICB7IGRvbWFpbjogJ2FwaS5vcGVuYWkuY29tJywgcmVhc29uOiAnT3BlbkFJIEFQSSBmb3IgQUkgZmVhdHVyZXMnIH0sXG4gICAgICB7IGRvbWFpbjogJ2FwaS5hbnRocm9waWMuY29tJywgcmVhc29uOiAnQW50aHJvcGljIEFQSSBmb3IgQUkgZmVhdHVyZXMnIH0sXG4gICAgICB7IGRvbWFpbjogJ2FwaS5lbGV2ZW5sYWJzLmlvJywgcmVhc29uOiAnRWxldmVuTGFicyBBUEkgZm9yIHRleHQtdG8tc3BlZWNoJyB9LFxuICAgICAgeyBkb21haW46ICdhcGkuaGV5Z2VuLmNvbScsIHJlYXNvbjogJ0hleUdlbiBBUEkgZm9yIHZpZGVvIGdlbmVyYXRpb24nIH0sXG4gICAgICB7IGRvbWFpbjogJ2dpdGh1Yi5jb20nLCByZWFzb246ICdHaXRIdWIgZm9yIEdpdCBvcGVyYXRpb25zJyB9LFxuICAgICAgeyBkb21haW46ICdhcGkuZ2l0aHViLmNvbScsIHJlYXNvbjogJ0dpdEh1YiBBUEkgZm9yIHJlcG9zaXRvcnkgb3BlcmF0aW9ucycgfSxcbiAgICBdO1xuXG4gICAgZm9yIChjb25zdCB7IGRvbWFpbiwgcmVhc29uIH0gb2YgZGVmYXVsdHMpIHtcbiAgICAgIGNvbnN0IGV4aXN0cyA9IHRoaXMuY29uZmlnLm5ldHdvcmtBbGxvd2xpc3Quc29tZShlID0+IGUuZG9tYWluID09PSBkb21haW4pO1xuICAgICAgaWYgKCFleGlzdHMpIHtcbiAgICAgICAgdGhpcy5jb25maWcubmV0d29ya0FsbG93bGlzdC5wdXNoKHtcbiAgICAgICAgICBkb21haW4sXG4gICAgICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgICAgICBhZGRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zYXZlQ29uZmlnKCk7XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBjb25maWd1cmF0aW9uIGZyb20gZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBsb2FkQ29uZmlnKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUodGhpcy5jb25maWdQYXRoLCAndXRmLTgnKTtcbiAgICAgIGNvbnN0IGxvYWRlZCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICBcbiAgICAgIC8vIE1lcmdlIHdpdGggZGVmYXVsdHNcbiAgICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgICAuLi50aGlzLmNvbmZpZyxcbiAgICAgICAgLi4ubG9hZGVkLFxuICAgICAgICBncmFudHM6IGxvYWRlZC5ncmFudHMubWFwKChnOiBhbnkpID0+ICh7XG4gICAgICAgICAgLi4uZyxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKGcudGltZXN0YW1wKSxcbiAgICAgICAgICBleHBpcmVzQXQ6IGcuZXhwaXJlc0F0ID8gbmV3IERhdGUoZy5leHBpcmVzQXQpIDogdW5kZWZpbmVkLFxuICAgICAgICB9KSksXG4gICAgICAgIG5ldHdvcmtBbGxvd2xpc3Q6IGxvYWRlZC5uZXR3b3JrQWxsb3dsaXN0Lm1hcCgoZTogYW55KSA9PiAoe1xuICAgICAgICAgIC4uLmUsXG4gICAgICAgICAgYWRkZWRBdDogbmV3IERhdGUoZS5hZGRlZEF0KSxcbiAgICAgICAgfSkpLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gQ29uZmlnIGRvZXNuJ3QgZXhpc3QgeWV0LCB1c2UgZGVmYXVsdHNcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUNvbmZpZygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlIGNvbmZpZ3VyYXRpb24gdG8gZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzYXZlQ29uZmlnKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZSh0aGlzLmNvbmZpZ1BhdGgsIEpTT04uc3RyaW5naWZ5KHRoaXMuY29uZmlnLCBudWxsLCAyKSwgeyBtb2RlOiAwbzYwMCB9KTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxFQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxJQUFBLEdBQUFGLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxTQUFBLEdBQUFGLE9BQUE7QUFBc0QsU0FBQUQsd0JBQUFJLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFOLHVCQUFBLFlBQUFBLENB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LENBQUM7TUFDSjtJQUNGO0lBRUEsTUFBTSxJQUFJLENBQUNxQixVQUFVLENBQUMsQ0FBQztFQUN6Qjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFjM0IsVUFBVUEsQ0FBQSxFQUFrQjtJQUN4QyxJQUFJO01BQ0YsTUFBTTBFLElBQUksR0FBRyxNQUFNbEgsRUFBRSxDQUFDbUgsUUFBUSxDQUFDLElBQUksQ0FBQ3JGLFVBQVUsRUFBRSxPQUFPLENBQUM7TUFDeEQsTUFBTXNGLE1BQU0sR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQUNKLElBQUksQ0FBQzs7TUFFL0I7TUFDQSxJQUFJLENBQUNoRixNQUFNLEdBQUc7UUFDWixHQUFHLElBQUksQ0FBQ0EsTUFBTTtRQUNkLEdBQUdrRixNQUFNO1FBQ1RoRixNQUFNLEVBQUVnRixNQUFNLENBQUNoRixNQUFNLENBQUNtRixHQUFHLENBQUV0RCxDQUFNLEtBQU07VUFDckMsR0FBR0EsQ0FBQztVQUNKSixTQUFTLEVBQUUsSUFBSVQsSUFBSSxDQUFDYSxDQUFDLENBQUNKLFNBQVMsQ0FBQztVQUNoQ1YsU0FBUyxFQUFFYyxDQUFDLENBQUNkLFNBQVMsR0FBRyxJQUFJQyxJQUFJLENBQUNhLENBQUMsQ0FBQ2QsU0FBUyxDQUFDLEdBQUdxRTtRQUNuRCxDQUFDLENBQUMsQ0FBQztRQUNIbkYsZ0JBQWdCLEVBQUUrRSxNQUFNLENBQUMvRSxnQkFBZ0IsQ0FBQ2tGLEdBQUcsQ0FBRWxILENBQU0sS0FBTTtVQUN6RCxHQUFHQSxDQUFDO1VBQ0p3RSxPQUFPLEVBQUUsSUFBSXpCLElBQUksQ0FBQy9DLENBQUMsQ0FBQ3dFLE9BQU87UUFDN0IsQ0FBQyxDQUFDO01BQ0osQ0FBQztJQUNILENBQUMsQ0FBQyxPQUFPNEMsS0FBSyxFQUFFO01BQ2Q7TUFDQSxNQUFNLElBQUksQ0FBQ3RELFVBQVUsQ0FBQyxDQUFDO0lBQ3pCO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsTUFBY0EsVUFBVUEsQ0FBQSxFQUFrQjtJQUN4QyxNQUFNbkUsRUFBRSxDQUFDMEgsU0FBUyxDQUFDLElBQUksQ0FBQzVGLFVBQVUsRUFBRXVGLElBQUksQ0FBQ00sU0FBUyxDQUFDLElBQUksQ0FBQ3pGLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUU7TUFBRTBGLElBQUksRUFBRTtJQUFNLENBQUMsQ0FBQztFQUM1RjtBQUNGO0FBQUNDLE9BQUEsQ0FBQXJHLGlCQUFBLEdBQUFBLGlCQUFBIiwiaWdub3JlTGlzdCI6W119