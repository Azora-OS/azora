{"version":3,"names":["_queryClassifier","require","describe","classifier","beforeEach","QueryClassifier","it","query","result","classify","expect","toBeDefined","classifiedAs","confidence","toBeGreaterThan","routedTo","toContain","reasoning","toBe","longQuery","repeat","toBeGreaterThanOrEqual","toBeLessThanOrEqual","simpleQuery","complexQuery","simpleResult","complexResult","result1","result2","queries","stats","getClassificationMetrics","Array","from","length","_","i","results","Promise","all","map","q","forEach","urgentQuery","priority","normalQuery","urgentResult","normalResult","userId","context","userLevel"],"sources":["routing.test.ts"],"sourcesContent":["import { QueryClassifier } from '../query-classifier';\r\n\r\ndescribe('AI Routing Service - Query Routing', () => {\r\n  let classifier: QueryClassifier;\r\n\r\n  beforeEach(() => {\r\n    classifier = new QueryClassifier();\r\n  });\r\n\r\n  describe('Query Classification', () => {\r\n    it('should classify simple queries correctly', async () => {\r\n      const query = { query: 'What is 2+2?' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.classifiedAs).toBeDefined();\r\n      expect(result.confidence).toBeGreaterThan(0);\r\n      expect(result.routedTo).toBeDefined();\r\n    });\r\n\r\n    it('should classify moderate complexity queries', async () => {\r\n      const query = { query: 'Explain the benefits of renewable energy and compare it with fossil fuels' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.classifiedAs).toBeDefined();\r\n      expect(result.confidence).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should classify complex queries', async () => {\r\n      const query = {\r\n        query: 'Develop a comprehensive strategic plan for global expansion including market analysis, risk assessment, financial projections, and implementation timeline'\r\n      };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.classifiedAs).toBeDefined();\r\n      expect(result.confidence).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should provide routing tier recommendation', async () => {\r\n      const query = { query: 'What is AI?' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result.routedTo).toBeDefined();\r\n      expect(['LOCAL_LLM', 'RAP_SYSTEM', 'EXTERNAL_LLM']).toContain(result.routedTo);\r\n    });\r\n\r\n    it('should include reasoning for classification', async () => {\r\n      const query = { query: 'Test query' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result.reasoning).toBeDefined();\r\n      expect(typeof result.reasoning).toBe('string');\r\n    });\r\n\r\n    it('should handle empty queries', async () => {\r\n      const query = { query: '' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.classifiedAs).toBeDefined();\r\n    });\r\n\r\n    it('should handle very long queries', async () => {\r\n      const longQuery = 'word '.repeat(500);\r\n      const query = { query: longQuery };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.classifiedAs).toBeDefined();\r\n    });\r\n\r\n    it('should calculate confidence score', async () => {\r\n      const query = { query: 'What is machine learning?' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result.confidence).toBeGreaterThanOrEqual(0);\r\n      expect(result.confidence).toBeLessThanOrEqual(1);\r\n    });\r\n  });\r\n\r\n  describe('Provider Routing', () => {\r\n    it('should route to local LLM for simple queries', async () => {\r\n      const query = { query: 'Hello' };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(['LOCAL_LLM', 'RAP_SYSTEM', 'EXTERNAL_LLM']).toContain(result.routedTo);\r\n    });\r\n\r\n    it('should consider query complexity in routing', async () => {\r\n      const simpleQuery = { query: 'Hi' };\r\n      const complexQuery = { query: 'Analyze the geopolitical implications of climate change on global trade patterns' };\r\n\r\n      const simpleResult = await classifier.classify(simpleQuery);\r\n      const complexResult = await classifier.classify(complexQuery);\r\n\r\n      expect(simpleResult.routedTo).toBeDefined();\r\n      expect(complexResult.routedTo).toBeDefined();\r\n    });\r\n\r\n    it('should provide consistent routing for same query', async () => {\r\n      const query = { query: 'What is Python?' };\r\n\r\n      const result1 = await classifier.classify(query);\r\n      const result2 = await classifier.classify(query);\r\n\r\n      expect(result1.classifiedAs).toBe(result2.classifiedAs);\r\n      expect(result1.routedTo).toBe(result2.routedTo);\r\n    });\r\n  });\r\n\r\n  describe('Load Balancing', () => {\r\n    it('should track classification statistics', async () => {\r\n      const queries = [\r\n        { query: 'Simple query 1' },\r\n        { query: 'Simple query 2' },\r\n        { query: 'More complex analytical query about economics' },\r\n      ];\r\n\r\n      for (const query of queries) {\r\n        await classifier.classify(query);\r\n      }\r\n\r\n      const stats = classifier.getClassificationMetrics();\r\n      expect(stats).toBeDefined();\r\n    });\r\n\r\n    it('should handle concurrent classifications', async () => {\r\n      const queries = Array.from({ length: 10 }, (_, i) => ({\r\n        query: `Test query ${i}`\r\n      }));\r\n\r\n      const results = await Promise.all(\r\n        queries.map(q => classifier.classify(q))\r\n      );\r\n\r\n      expect(results.length).toBe(10);\r\n      results.forEach(result => {\r\n        expect(result).toBeDefined();\r\n        expect(result.classifiedAs).toBeDefined();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Routing Priority', () => {\r\n    it('should prioritize based on query characteristics', async () => {\r\n      const urgentQuery = { query: 'Emergency: System down', priority: 'high' };\r\n      const normalQuery = { query: 'What is AI?' };\r\n\r\n      const urgentResult = await classifier.classify(urgentQuery);\r\n      const normalResult = await classifier.classify(normalQuery);\r\n\r\n      expect(urgentResult).toBeDefined();\r\n      expect(normalResult).toBeDefined();\r\n    });\r\n\r\n    it('should consider user context in routing', async () => {\r\n      const query = {\r\n        query: 'Explain quantum computing',\r\n        userId: 'user-123',\r\n        context: { userLevel: 'beginner' }\r\n      };\r\n\r\n      const result = await classifier.classify(query);\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.classifiedAs).toBeDefined();\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}