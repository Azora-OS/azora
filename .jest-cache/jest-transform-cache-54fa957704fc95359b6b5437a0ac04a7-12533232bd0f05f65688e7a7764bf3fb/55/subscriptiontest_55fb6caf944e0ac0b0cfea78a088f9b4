99ae80aebd373732c483bd0deba80c45
"use strict";

const request = require('supertest');
const app = require('../server');
describe('subscription Service', () => {
  describe('Health Check', () => {
    it('should return healthy status', async () => {
      const response = await request(app).get('/api/health').expect(200);
      expect(response.body.status).toBe('healthy');
      expect(response.body.service).toBeDefined();
      expect(response.body.timestamp).toBeDefined();
    });
  });
  describe('API Endpoints', () => {
    it('should handle 404 for non-existent endpoints', async () => {
      const response = await request(app).get('/api/non-existent').expect(404);
      expect(response.body.success).toBe(false);
      expect(response.body.error).toBe('Endpoint not found');
    });
    it('should handle invalid JSON', async () => {
      const response = await request(app).post('/api/test').send('invalid json').expect(400);
    });
  });
  describe('Security', () => {
    it('should have security headers', async () => {
      const response = await request(app).get('/api/health');
      expect(response.headers['x-content-type-options']).toBeDefined();
      expect(response.headers['x-frame-options']).toBeDefined();
    });
    it('should handle rate limiting', async () => {
      // Make multiple requests to test rate limiting
      const promises = Array(10).fill().map(() => request(app).get('/api/health'));
      const responses = await Promise.all(promises);
      expect(responses.every(r => r.status === 200 || r.status === 429)).toBe(true);
    });
  });
  describe('Error Handling', () => {
    it('should handle server errors gracefully', async () => {
      // Test error middleware
      const response = await request(app).get('/api/health');
      expect(response.status).toBeLessThan(500);
    });
  });
  describe('Input Validation', () => {
    it('should sanitize XSS attempts', async () => {
      const maliciousInput = '<script>alert("xss")</script>';
      const response = await request(app).post('/api/test').send({
        data: maliciousInput
      });

      // Should not contain script tags in response
      expect(JSON.stringify(response.body)).not.toContain('<script>');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsImJvZHkiLCJzdGF0dXMiLCJ0b0JlIiwic2VydmljZSIsInRvQmVEZWZpbmVkIiwidGltZXN0YW1wIiwic3VjY2VzcyIsImVycm9yIiwicG9zdCIsInNlbmQiLCJoZWFkZXJzIiwicHJvbWlzZXMiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJyZXNwb25zZXMiLCJQcm9taXNlIiwiYWxsIiwiZXZlcnkiLCJyIiwidG9CZUxlc3NUaGFuIiwibWFsaWNpb3VzSW5wdXQiLCJkYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5vdCIsInRvQ29udGFpbiJdLCJzb3VyY2VzIjpbInN1YnNjcmlwdGlvbi50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcbmNvbnN0IGFwcCA9IHJlcXVpcmUoJy4uL3NlcnZlcicpO1xuXG5kZXNjcmliZSgnc3Vic2NyaXB0aW9uIFNlcnZpY2UnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdIZWFsdGggQ2hlY2snLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gaGVhbHRoeSBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2hlYWx0aCcpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3RhdHVzKS50b0JlKCdoZWFsdGh5Jyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudGltZXN0YW1wKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQVBJIEVuZHBvaW50cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSA0MDQgZm9yIG5vbi1leGlzdGVudCBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL25vbi1leGlzdGVudCcpXG4gICAgICAgIC5leHBlY3QoNDA0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG9CZSgnRW5kcG9pbnQgbm90IGZvdW5kJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIEpTT04nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS90ZXN0JylcbiAgICAgICAgLnNlbmQoJ2ludmFsaWQganNvbicpXG4gICAgICAgIC5leHBlY3QoNDAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlY3VyaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGF2ZSBzZWN1cml0eSBoZWFkZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9oZWFsdGgnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnNbJ3gtY29udGVudC10eXBlLW9wdGlvbnMnXSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzWyd4LWZyYW1lLW9wdGlvbnMnXSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHJhdGUgbGltaXRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNYWtlIG11bHRpcGxlIHJlcXVlc3RzIHRvIHRlc3QgcmF0ZSBsaW1pdGluZ1xuICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheSgxMCkuZmlsbCgpLm1hcCgoKSA9PiBcbiAgICAgICAgcmVxdWVzdChhcHApLmdldCgnL2FwaS9oZWFsdGgnKVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2VzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlcy5ldmVyeShyID0+IHIuc3RhdHVzID09PSAyMDAgfHwgci5zdGF0dXMgPT09IDQyOSkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2ZXIgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGVycm9yIG1pZGRsZXdhcmVcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvaGVhbHRoJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmVMZXNzVGhhbig1MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW5wdXQgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIFhTUyBhdHRlbXB0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1hbGljaW91c0lucHV0ID0gJzxzY3JpcHQ+YWxlcnQoXCJ4c3NcIik8L3NjcmlwdD4nO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS90ZXN0JylcbiAgICAgICAgLnNlbmQoeyBkYXRhOiBtYWxpY2lvdXNJbnB1dCB9KTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIG5vdCBjb250YWluIHNjcmlwdCB0YWdzIGluIHJlc3BvbnNlXG4gICAgICBleHBlY3QoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuYm9keSkpLm5vdC50b0NvbnRhaW4oJzxzY3JpcHQ+Jyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNwQyxNQUFNQyxHQUFHLEdBQUdELE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFFaENFLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxNQUFNO0VBQ3JDQSxRQUFRLENBQUMsY0FBYyxFQUFFLE1BQU07SUFDN0JDLEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxZQUFZO01BQzdDLE1BQU1DLFFBQVEsR0FBRyxNQUFNTCxPQUFPLENBQUNFLEdBQUcsQ0FBQyxDQUNoQ0ksR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUNsQkMsTUFBTSxDQUFDLEdBQUcsQ0FBQztNQUVkQSxNQUFNLENBQUNGLFFBQVEsQ0FBQ0csSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLFNBQVMsQ0FBQztNQUM1Q0gsTUFBTSxDQUFDRixRQUFRLENBQUNHLElBQUksQ0FBQ0csT0FBTyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxDQUFDO01BQzNDTCxNQUFNLENBQUNGLFFBQVEsQ0FBQ0csSUFBSSxDQUFDSyxTQUFTLENBQUMsQ0FBQ0QsV0FBVyxDQUFDLENBQUM7SUFDL0MsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUZULFFBQVEsQ0FBQyxlQUFlLEVBQUUsTUFBTTtJQUM5QkMsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLFlBQVk7TUFDN0QsTUFBTUMsUUFBUSxHQUFHLE1BQU1MLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQ2hDSSxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FDeEJDLE1BQU0sQ0FBQyxHQUFHLENBQUM7TUFFZEEsTUFBTSxDQUFDRixRQUFRLENBQUNHLElBQUksQ0FBQ00sT0FBTyxDQUFDLENB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