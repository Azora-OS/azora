{"version":3,"names":["_globals","require","_supertest","_interopRequireDefault","_database","e","__esModule","default","API_URL","process","env","LEDGER_SERVICE_URL","describe","beforeEach","setupTestDatabase","afterEach","cleanupTestDatabase","it","res","request","post","send","amount","currency","description","accountId","type","expect","status","toBe","body","success","data","id","toBeDefined","error","toContain","get","Array","isArray","createRes","put","delete"],"sources":["ledger-entries.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\r\nimport request from 'supertest';\r\nimport { setupTestDatabase, cleanupTestDatabase } from '../../../tests/utils/database';\r\n\r\nconst API_URL = process.env.LEDGER_SERVICE_URL || 'http://localhost:3012';\r\n\r\ndescribe('Azora Ledger - Ledger Entries', () => {\r\n  beforeEach(async () => {\r\n    await setupTestDatabase();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    await cleanupTestDatabase();\r\n  });\r\n\r\n  describe('Transaction Creation', () => {\r\n    it('should create ledger entry', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          description: 'Test transaction',\r\n          accountId: 'account-123',\r\n          type: 'credit',\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.success).toBe(true);\r\n      expect(res.body.data.amount).toBe(100);\r\n      expect(res.body.data.id).toBeDefined();\r\n    });\r\n\r\n    it('should reject entry without required fields', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          description: 'Test transaction',\r\n        });\r\n\r\n      expect(res.status).toBe(400);\r\n      expect(res.body.error).toContain('required');\r\n    });\r\n\r\n    it('should create debit entry', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 50,\r\n          currency: 'USD',\r\n          description: 'Debit transaction',\r\n          accountId: 'account-123',\r\n          type: 'debit',\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.data.type).toBe('debit');\r\n    });\r\n\r\n    it('should create credit entry', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 75,\r\n          currency: 'USD',\r\n          description: 'Credit transaction',\r\n          accountId: 'account-123',\r\n          type: 'credit',\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.data.type).toBe('credit');\r\n    });\r\n  });\r\n\r\n  describe('Transaction Retrieval', () => {\r\n    it('should get all transactions', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/transactions');\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.success).toBe(true);\r\n      expect(Array.isArray(res.body.data)).toBe(true);\r\n    });\r\n\r\n    it('should get transaction by ID', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          description: 'Test',\r\n          accountId: 'account-123',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .get(`/api/transactions/${createRes.body.data.id}`);\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.id).toBe(createRes.body.data.id);\r\n    });\r\n\r\n    it('should return 404 for non-existent transaction', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/transactions/non-existent-id');\r\n\r\n      expect(res.status).toBe(404);\r\n    });\r\n  });\r\n\r\n  describe('Transaction Updates', () => {\r\n    it('should update transaction', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          description: 'Original',\r\n          accountId: 'account-123',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .put(`/api/transactions/${createRes.body.data.id}`)\r\n        .send({\r\n          description: 'Updated description',\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.description).toBe('Updated description');\r\n    });\r\n\r\n    it('should not allow amount modification', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          description: 'Test',\r\n          accountId: 'account-123',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .put(`/api/transactions/${createRes.body.data.id}`)\r\n        .send({\r\n          amount: 200,\r\n        });\r\n\r\n      expect(res.status).toBe(400);\r\n      expect(res.body.error).toContain('amount');\r\n    });\r\n  });\r\n\r\n  describe('Transaction Deletion', () => {\r\n    it('should delete transaction', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/transactions')\r\n        .send({\r\n          amount: 100,\r\n          currency: 'USD',\r\n          description: 'Test',\r\n          accountId: 'account-123',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .delete(`/api/transactions/${createRes.body.data.id}`);\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.success).toBe(true);\r\n    });\r\n\r\n    it('should return 404 when deleting non-existent transaction', async () => {\r\n      const res = await request(API_URL)\r\n        .delete('/api/transactions/non-existent-id');\r\n\r\n      expect(res.status).toBe(404);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}