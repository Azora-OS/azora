{"version":3,"names":["fs","_interopRequireWildcard","require","path","crypto","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ChangesetManager","changesets","Map","constructor","projectRoot","backupDir","join","ensureBackupDir","existsSync","mkdirSync","recursive","createChangeset","description","changes","id","generateChangesetId","timestamp","Date","backupPath","filesMap","originalFiles","createdFiles","change","type","push","originalContent","readFileSync","backupFilePath","basename","writeFileSync","error","console","changeset","files","rollbackData","verified","applied","now","random","randomBytes","toString","getChangesetPreview","changesetId","Array","from","values","filesAffected","length","estimatedImpact","hasDeletions","some","c","applyChangeset","success","filePath","createFile","content","modifyFile","deleteFile","message","rollbackChangeset","promises","unlink","dir","dirname","mkdir","writeFile","getAllChangesets","getChangeset","markAsVerified","deleteChangeset","rm","force","delete","getHistory","limit","sort","a","b","getTime","slice","cleanupOldChangesets","daysToKeep","cutoffDate","setDate","getDate","deletedCount","exportChangeset","exportData","toISOString","entries","map","JSON","stringify","importChangeset","jsonData","data","parse","fileData","exports"],"sources":["ChangesetManager.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\n\nexport interface FileChange {\n  path: string;\n  type: 'create' | 'modify' | 'delete';\n  content?: string;\n  originalContent?: string;\n}\n\nexport interface Changeset {\n  id: string;\n  timestamp: Date;\n  description: string;\n  files: Map<string, FileChange>;\n  rollbackData: RollbackData;\n  verified: boolean;\n  applied: boolean;\n}\n\nexport interface RollbackData {\n  backupPath: string;\n  originalFiles: Map<string, string>; // path -> original content\n  createdFiles: string[]; // files that were created (should be deleted on rollback)\n}\n\nexport interface ChangesetPreview {\n  id: string;\n  description: string;\n  filesAffected: number;\n  changes: FileChange[];\n  estimatedImpact: 'low' | 'medium' | 'high';\n}\n\nexport class ChangesetManager {\n  private changesets: Map<string, Changeset> = new Map();\n  private backupDir: string;\n\n  constructor(projectRoot: string) {\n    this.backupDir = path.join(projectRoot, '.azstudio', 'backups');\n    this.ensureBackupDir();\n  }\n\n  /**\n   * Ensure backup directory exists\n   */\n  private ensureBackupDir(): void {\n    if (!fs.existsSync(this.backupDir)) {\n      fs.mkdirSync(this.backupDir, { recursive: true });\n    }\n  }\n\n  /**\n   * Create a new changeset\n   */\n  createChangeset(description: string, changes: FileChange[]): Changeset {\n    const id = this.generateChangesetId();\n    const timestamp = new Date();\n    const backupPath = path.join(this.backupDir, id);\n\n    // Create backup directory for this changeset\n    fs.mkdirSync(backupPath, { recursive: true });\n\n    const filesMap = new Map<string, FileChange>();\n    const originalFiles = new Map<string, string>();\n    const createdFiles: string[] = [];\n\n    // Process each file change\n    for (const change of changes) {\n      filesMap.set(change.path, change);\n\n      if (change.type === 'create') {\n        createdFiles.push(change.path);\n      } else if (change.type === 'modify' || change.type === 'delete') {\n        // Backup original content\n        try {\n          const originalContent = fs.readFileSync(change.path, 'utf-8');\n          originalFiles.set(change.path, originalContent);\n          \n          // Save backup to disk\n          const backupFilePath = path.join(backupPath, path.basename(change.path));\n          fs.writeFileSync(backupFilePath, originalContent, 'utf-8');\n        } catch (error) {\n          console.error(`Failed to backup file ${change.path}:`, error);\n        }\n      }\n    }\n\n    const changeset: Changeset = {\n      id,\n      timestamp,\n      description,\n      files: filesMap,\n      rollbackData: {\n        backupPath,\n        originalFiles,\n        createdFiles,\n      },\n      verified: false,\n      applied: false,\n    };\n\n    this.changesets.set(id, changeset);\n    return changeset;\n  }\n\n  /**\n   * Generate a unique changeset ID\n   */\n  private generateChangesetId(): string {\n    const timestamp = Date.now();\n    const random = crypto.randomBytes(4).toString('hex');\n    return `cs_${timestamp}_${random}`;\n  }\n\n  /**\n   * Preview a changeset before applying\n   */\n  getChangesetPreview(changesetId: string): ChangesetPreview | null {\n    const changeset = this.changesets.get(changesetId);\n    if (!changeset) {\n      return null;\n    }\n\n    const changes = Array.from(changeset.files.values());\n    const filesAffected = changes.length;\n\n    // Estimate impact based on number of files and types of changes\n    let estimatedImpact: 'low' | 'medium' | 'high' = 'low';\n    if (filesAffected > 10) {\n      estimatedImpact = 'high';\n    } else if (filesAffected > 5) {\n      estimatedImpact = 'medium';\n    }\n\n    // Increase impact if there are deletions\n    const hasDeletions = changes.some(c => c.type === 'delete');\n    if (hasDeletions && estimatedImpact === 'low') {\n      estimatedImpact = 'medium';\n    }\n\n    return {\n      id: changeset.id,\n      description: changeset.description,\n      filesAffected,\n      changes,\n      estimatedImpact,\n    };\n  }\n\n  /**\n   * Apply a changeset\n   */\n  async applyChangeset(changesetId: string): Promise<{ success: boolean; error?: string }> {\n    const changeset = this.changesets.get(changesetId);\n    if (!changeset) {\n      return { success: false, error: 'Changeset not found' };\n    }\n\n    if (changeset.applied) {\n      return { success: false, error: 'Changeset already applied' };\n    }\n\n    try {\n      // Apply each file change\n      for (const [filePath, change] of changeset.files) {\n        switch (change.type) {\n          case 'create':\n            await this.createFile(filePath, change.content || '');\n            break;\n          case 'modify':\n            await this.modifyFile(filePath, change.content || '');\n            break;\n          case 'delete':\n            await this.deleteFile(filePath);\n            break;\n        }\n      }\n\n      changeset.applied = true;\n      return { success: true };\n    } catch (error) {\n      return {\n        success: false,\n        error: (error as Error).message,\n      };\n    }\n  }\n\n  /**\n   * Rollback a changeset\n   */\n  async rollbackChangeset(changesetId: string): Promise<{ success: boolean; error?: string }> {\n    const changeset = this.changesets.get(changesetId);\n    if (!changeset) {\n      return { success: false, error: 'Changeset not found' };\n    }\n\n    if (!changeset.applied) {\n      return { success: false, error: 'Changeset not applied yet' };\n    }\n\n    try {\n      const { originalFiles, createdFiles } = changeset.rollbackData;\n\n      // Delete files that were created\n      for (const filePath of createdFiles) {\n        if (fs.existsSync(filePath)) {\n          await fs.promises.unlink(filePath);\n        }\n      }\n\n      // Restore original content for modified/deleted files\n      for (const [filePath, originalContent] of originalFiles) {\n        await this.modifyFile(filePath, originalContent);\n      }\n\n      changeset.applied = false;\n      return { success: true };\n    } catch (error) {\n      return {\n        success: false,\n        error: (error as Error).message,\n      };\n    }\n  }\n\n  /**\n   * Create a file\n   */\n  private async createFile(filePath: string, content: string): Promise<void> {\n    const dir = path.dirname(filePath);\n    if (!fs.existsSync(dir)) {\n      await fs.promises.mkdir(dir, { recursive: true });\n    }\n    await fs.promises.writeFile(filePath, content, 'utf-8');\n  }\n\n  /**\n   * Modify a file\n   */\n  private async modifyFile(filePath: string, content: string): Promise<void> {\n    await fs.promises.writeFile(filePath, content, 'utf-8');\n  }\n\n  /**\n   * Delete a file\n   */\n  private async deleteFile(filePath: string): Promise<void> {\n    if (fs.existsSync(filePath)) {\n      await fs.promises.unlink(filePath);\n    }\n  }\n\n  /**\n   * Get all changesets\n   */\n  getAllChangesets(): Changeset[] {\n    return Array.from(this.changesets.values());\n  }\n\n  /**\n   * Get a specific changeset\n   */\n  getChangeset(changesetId: string): Changeset | undefined {\n    return this.changesets.get(changesetId);\n  }\n\n  /**\n   * Mark changeset as verified\n   */\n  markAsVerified(changesetId: string): void {\n    const changeset = this.changesets.get(changesetId);\n    if (changeset) {\n      changeset.verified = true;\n    }\n  }\n\n  /**\n   * Delete a changeset and its backup\n   */\n  async deleteChangeset(changesetId: string): Promise<void> {\n    const changeset = this.changesets.get(changesetId);\n    if (changeset) {\n      // Delete backup directory\n      const backupPath = changeset.rollbackData.backupPath;\n      if (fs.existsSync(backupPath)) {\n        await fs.promises.rm(backupPath, { recursive: true, force: true });\n      }\n\n      this.changesets.delete(changesetId);\n    }\n  }\n\n  /**\n   * Get changeset history\n   */\n  getHistory(limit: number = 10): Changeset[] {\n    const changesets = Array.from(this.changesets.values());\n    return changesets\n      .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n      .slice(0, limit);\n  }\n\n  /**\n   * Clean up old changesets\n   */\n  async cleanupOldChangesets(daysToKeep: number = 7): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);\n\n    let deletedCount = 0;\n    for (const [id, changeset] of this.changesets) {\n      if (changeset.timestamp < cutoffDate) {\n        await this.deleteChangeset(id);\n        deletedCount++;\n      }\n    }\n\n    return deletedCount;\n  }\n\n  /**\n   * Export changeset to JSON\n   */\n  exportChangeset(changesetId: string): string | null {\n    const changeset = this.changesets.get(changesetId);\n    if (!changeset) {\n      return null;\n    }\n\n    const exportData = {\n      id: changeset.id,\n      timestamp: changeset.timestamp.toISOString(),\n      description: changeset.description,\n      files: Array.from(changeset.files.entries()).map(([path, change]) => ({\n        path,\n        type: change.type,\n        content: change.content,\n        originalContent: change.originalContent,\n      })),\n      verified: changeset.verified,\n      applied: changeset.applied,\n    };\n\n    return JSON.stringify(exportData, null, 2);\n  }\n\n  /**\n   * Import changeset from JSON\n   */\n  importChangeset(jsonData: string): Changeset | null {\n    try {\n      const data = JSON.parse(jsonData);\n      \n      const files = new Map<string, FileChange>();\n      for (const fileData of data.files) {\n        files.set(fileData.path, {\n          path: fileData.path,\n          type: fileData.type,\n          content: fileData.content,\n          originalContent: fileData.originalContent,\n        });\n      }\n\n      const changeset: Changeset = {\n        id: data.id,\n        timestamp: new Date(data.timestamp),\n        description: data.description,\n        files,\n        rollbackData: {\n          backupPath: path.join(this.backupDir, data.id),\n          originalFiles: new Map(),\n          createdFiles: [],\n        },\n        verified: data.verified,\n        applied: data.applied,\n      };\n\n      this.changesets.set(changeset.id, changeset);\n      return changeset;\n    } catch (error) {\n      console.error('Failed to import changeset:', error);\n      return null;\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}