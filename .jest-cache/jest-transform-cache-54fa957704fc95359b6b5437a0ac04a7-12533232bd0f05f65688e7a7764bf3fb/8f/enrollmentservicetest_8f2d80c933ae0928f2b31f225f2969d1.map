{"version":3,"names":["_getJestObj","mock","prisma","enrollment","create","jest","fn","findUnique","findMany","findFirst","update","course","_enrollment","require","_index","describe","beforeEach","clearAllMocks","it","enrollmentData","studentId","courseId","tier","mockCourse","id","mockEnrollment","status","progress","startDate","Date","completionDate","mockResolvedValue","result","enrollmentService","enrollStudent","expect","toEqual","toHaveBeenCalled","rejects","toThrow","getEnrollment","toBeNull","mockEnrollments","getStudentEnrollments","toHaveBeenCalledWith","where","mockUpdatedEnrollment","updateProgress","data","mockCompletedEnrollment","completeEnrollment","toBe","mockDroppedEnrollment","dropEnrollment"],"sources":["enrollment.service.test.ts"],"sourcesContent":["import { enrollmentService } from '../enrollment.service';\r\nimport { prisma } from '../../index';\r\n\r\njest.mock('../../index', () => ({\r\n  prisma: {\r\n    enrollment: {\r\n      create: jest.fn(),\r\n      findUnique: jest.fn(),\r\n      findMany: jest.fn(),\r\n      findFirst: jest.fn(),\r\n      update: jest.fn(),\r\n    },\r\n    course: {\r\n      findUnique: jest.fn(),\r\n    },\r\n  },\r\n}));\r\n\r\ndescribe('EnrollmentService', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('enrollStudent', () => {\r\n    it('should enroll a student in a course', async () => {\r\n      const enrollmentData = {\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n      };\r\n\r\n      const mockCourse = {\r\n        id: 'course-1',\r\n        tier: 'free',\r\n      };\r\n\r\n      const mockEnrollment = {\r\n        id: 'enrollment-1',\r\n        ...enrollmentData,\r\n        status: 'active',\r\n        progress: 0,\r\n        startDate: new Date(),\r\n        completionDate: null,\r\n      };\r\n\r\n      (prisma.enrollment.findFirst as jest.Mock).mockResolvedValue(null);\r\n      (prisma.course.findUnique as jest.Mock).mockResolvedValue(mockCourse);\r\n      (prisma.enrollment.create as jest.Mock).mockResolvedValue(mockEnrollment);\r\n\r\n      const result = await enrollmentService.enrollStudent(enrollmentData);\r\n\r\n      expect(result).toEqual(mockEnrollment);\r\n      expect(prisma.enrollment.create).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should throw error if student already enrolled', async () => {\r\n      const enrollmentData = {\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n      };\r\n\r\n      (prisma.enrollment.findFirst as jest.Mock).mockResolvedValue({\r\n        id: 'existing-enrollment',\r\n      });\r\n\r\n      await expect(enrollmentService.enrollStudent(enrollmentData)).rejects.toThrow(\r\n        'Student already enrolled in this course'\r\n      );\r\n    });\r\n\r\n    it('should throw error if course not found', async () => {\r\n      const enrollmentData = {\r\n        studentId: 'student-1',\r\n        courseId: 'non-existent',\r\n        tier: 'free',\r\n      };\r\n\r\n      (prisma.enrollment.findFirst as jest.Mock).mockResolvedValue(null);\r\n      (prisma.course.findUnique as jest.Mock).mockResolvedValue(null);\r\n\r\n      await expect(enrollmentService.enrollStudent(enrollmentData)).rejects.toThrow(\r\n        'Course not found'\r\n      );\r\n    });\r\n\r\n    it('should throw error if student tier does not have access', async () => {\r\n      const enrollmentData = {\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n      };\r\n\r\n      const mockCourse = {\r\n        id: 'course-1',\r\n        tier: 'premium', // Premium course\r\n      };\r\n\r\n      (prisma.enrollment.findFirst as jest.Mock).mockResolvedValue(null);\r\n      (prisma.course.findUnique as jest.Mock).mockResolvedValue(mockCourse);\r\n\r\n      await expect(enrollmentService.enrollStudent(enrollmentData)).rejects.toThrow(\r\n        'Student tier does not have access to this course'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('getEnrollment', () => {\r\n    it('should retrieve an enrollment by ID', async () => {\r\n      const mockEnrollment = {\r\n        id: 'enrollment-1',\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n        status: 'active',\r\n        progress: 50,\r\n        startDate: new Date(),\r\n        completionDate: null,\r\n      };\r\n\r\n      (prisma.enrollment.findUnique as jest.Mock).mockResolvedValue(mockEnrollment);\r\n\r\n      const result = await enrollmentService.getEnrollment('enrollment-1');\r\n\r\n      expect(result).toEqual(mockEnrollment);\r\n    });\r\n\r\n    it('should return null if enrollment not found', async () => {\r\n      (prisma.enrollment.findUnique as jest.Mock).mockResolvedValue(null);\r\n\r\n      const result = await enrollmentService.getEnrollment('non-existent');\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('getStudentEnrollments', () => {\r\n    it('should retrieve all enrollments for a student', async () => {\r\n      const mockEnrollments = [\r\n        {\r\n          id: 'enrollment-1',\r\n          studentId: 'student-1',\r\n          courseId: 'course-1',\r\n          tier: 'free',\r\n          status: 'active',\r\n          progress: 50,\r\n        },\r\n        {\r\n          id: 'enrollment-2',\r\n          studentId: 'student-1',\r\n          courseId: 'course-2',\r\n          tier: 'premium',\r\n          status: 'completed',\r\n          progress: 100,\r\n        },\r\n      ];\r\n\r\n      (prisma.enrollment.findMany as jest.Mock).mockResolvedValue(mockEnrollments);\r\n\r\n      const result = await enrollmentService.getStudentEnrollments('student-1');\r\n\r\n      expect(result).toEqual(mockEnrollments);\r\n      expect(prisma.enrollment.findMany).toHaveBeenCalledWith({\r\n        where: { studentId: 'student-1' },\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('updateProgress', () => {\r\n    it('should update enrollment progress', async () => {\r\n      const mockUpdatedEnrollment = {\r\n        id: 'enrollment-1',\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n        status: 'active',\r\n        progress: 75,\r\n      };\r\n\r\n      (prisma.enrollment.update as jest.Mock).mockResolvedValue(mockUpdatedEnrollment);\r\n\r\n      const result = await enrollmentService.updateProgress('enrollment-1', 75);\r\n\r\n      expect(result).toEqual(mockUpdatedEnrollment);\r\n      expect(prisma.enrollment.update).toHaveBeenCalledWith({\r\n        where: { id: 'enrollment-1' },\r\n        data: { progress: 75 },\r\n      });\r\n    });\r\n\r\n    it('should throw error for invalid progress value', async () => {\r\n      await expect(enrollmentService.updateProgress('enrollment-1', 150)).rejects.toThrow(\r\n        'Progress must be between 0 and 100'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('completeEnrollment', () => {\r\n    it('should mark enrollment as completed', async () => {\r\n      const mockCompletedEnrollment = {\r\n        id: 'enrollment-1',\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n        status: 'completed',\r\n        progress: 100,\r\n        completionDate: new Date(),\r\n      };\r\n\r\n      (prisma.enrollment.update as jest.Mock).mockResolvedValue(mockCompletedEnrollment);\r\n\r\n      const result = await enrollmentService.completeEnrollment('enrollment-1');\r\n\r\n      expect(result.status).toBe('completed');\r\n      expect(result.progress).toBe(100);\r\n      expect(prisma.enrollment.update).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('dropEnrollment', () => {\r\n    it('should mark enrollment as dropped', async () => {\r\n      const mockDroppedEnrollment = {\r\n        id: 'enrollment-1',\r\n        studentId: 'student-1',\r\n        courseId: 'course-1',\r\n        tier: 'free',\r\n        status: 'dropped',\r\n        progress: 30,\r\n      };\r\n\r\n      (prisma.enrollment.update as jest.Mock).mockResolvedValue(mockDroppedEnrollment);\r\n\r\n      const result = await enrollmentService.dropEnrollment('enrollment-1');\r\n\r\n      expect(result.status).toBe('dropped');\r\n      expect(prisma.enrollment.update).toHaveBeenCalled();\r\n    });\r\n  });\r\n});\r\n"],"mappings":";;AAGAA,WAAA,GAAKC,IAAI,CAAC,aAAa,EAAE,OAAO;EAC9BC,MAAM,EAAE;IACNC,UAAU,EAAE;MACVC,MAAM,EAAEC,IAAI,CAACC,EAAE,CAAC,CAAC;MACjBC,UAAU,EAAEF,IAAI,CAACC,EAAE,CAAC,CAAC;MACrBE,QAAQ,EAAEH,IAAI,CAACC,EAAE,CAAC,CAAC;MACnBG,SAAS,EAAEJ,IAAI,CAACC,EAAE,CAAC,CAAC;MACpBI,MAAM,EAAEL,IAAI,CAACC,EAAE,CAAC;IAClB,CAAC;IACDK,MAAM,EAAE;MACNJ,UAAU,EAAEF,IAAI,CAACC,EAAE,CAAC;IACtB;EACF;AACF,CAAC,CAAC,CAAC;AAhBH,IAAAM,WAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AAAqC,SAAAb,YAAA;EAAA;IAAAK;EAAA,IAAAQ,OAAA;EAAAb,WAAA,GAAAA,CAAA,KAAAK,IAAA;EAAA,OAAAA,IAAA;AAAA;AAiBrCU,QAAQ,CAAC,mBAAmB,EAAE,MAAM;EAClCC,UAAU,CAAC,MAAM;IACfX,IAAI,CAACY,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFF,QAAQ,CAAC,eAAe,EAAE,MAAM;IAC9BG,EAAE,CAAC,qCAAqC,EAAE,YAAY;MACpD,MAAMC,cAAc,GAAG;QACrBC,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE;MACR,CAAC;MAED,MAAMC,UAAU,GAAG;QACjBC,EAAE,EAAE,UAAU;QACdF,IAAI,EAAE;MACR,CAAC;MAED,MAAMG,cAAc,GAAG;QACrBD,EAAE,EAAE,cAAc;QAClB,GAAGL,cAAc;QACjBO,MAAM,EAAE,QAAQ;QAChBC,QAAQ,EAAE,CAAC;QACXC,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;QACrBC,cAAc,EAAE;MAClB,CAAC;MAEA5B,aAAM,CAACC,UAAU,CAACM,SAAS,CAAesB,iBAAiB,CAAC,IAAI,CAAC;MACjE7B,aAAM,CAACS,MAAM,CAACJ,UAAU,CAAewB,iBAAiB,CAACR,UAAU,CAAC;MACpErB,aAAM,CAACC,UAAU,CAACC,MAAM,CAAe2B,iBAAiB,CAACN,cAAc,CAAC;MAEzE,MAAMO,MAAM,GAAG,MAAMC,6BAAiB,CAACC,aAAa,CAACf,cAAc,CAAC;MAEpEgB,MAAM,CAACH,MAAM,CAAC,CAACI,OAAO,CAACX,cAAc,CAAC;MACtCU,MAAM,CAACjC,aAAM,CAACC,UAAU,CAACC,MAAM,CAAC,CAACiC,gBAAgB,CAAC,CAAC;IACrD,CAAC,CAAC;IAEFnB,EAAE,CAAC,gDAAgD,EAAE,YAAY;MAC/D,MAAMC,cAAc,GAAG;QACrBC,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE;MACR,CAAC;MAEApB,aAAM,CAACC,UAAU,CAACM,SAAS,CAAesB,iBAAiB,CAAC;QAC3DP,EAAE,EAAE;MACN,CAAC,CAAC;MAEF,MAAMW,MAAM,CAACF,6BAAiB,CAACC,aAAa,CAACf,cAAc,CAAC,CAAC,CAACmB,OAAO,CAACC,OAAO,CAC3E,yCACF,CAAC;IACH,CAAC,CAAC;IAEFrB,EAAE,CAAC,wCAAwC,EAAE,YAAY;MACvD,MAAMC,cAAc,GAAG;QACrBC,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,cAAc;QACxBC,IAAI,EAAE;MACR,CAAC;MAEApB,aAAM,CAACC,UAAU,CAACM,SAAS,CAAesB,iBAAiB,CAAC,IAAI,CAAC;MACjE7B,aAAM,CAACS,MAAM,CAACJ,UAAU,CAAewB,iBAAiB,CAAC,IAAI,CAAC;MAE/D,MAAMI,MAAM,CAACF,6BAAiB,CAACC,aAAa,CAACf,cAAc,CAAC,CAAC,CAACmB,OAAO,CAACC,OAAO,CAC3E,kBACF,CAAC;IACH,CAAC,CAAC;IAEFrB,EAAE,CAAC,yDAAyD,EAAE,YAAY;MACxE,MAAMC,cAAc,GAAG;QACrBC,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE;MACR,CAAC;MAED,MAAMC,UAAU,GAAG;QACjBC,EAAE,EAAE,UAAU;QACdF,IAAI,EAAE,SAAS,CAAE;MACnB,CAAC;MAEApB,aAAM,CAACC,UAAU,CAACM,SAAS,CAAesB,iBAAiB,CAAC,IAAI,CAAC;MACjE7B,aAAM,CAACS,MAAM,CAACJ,UAAU,CAAewB,iBAAiB,CAACR,UAAU,CAAC;MAErE,MAAMY,MAAM,CAACF,6BAAiB,CAACC,aAAa,CAACf,cAAc,CAAC,CAAC,CAACmB,OAAO,CAACC,OAAO,CAC3E,kDACF,CAAC;IACH,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFxB,QAAQ,CAAC,eAAe,EAAE,MAAM;IAC9BG,EAAE,CAAC,qCAAqC,EAAE,YAAY;MACpD,MAAMO,cAAc,GAAG;QACrBD,EAAE,EAAE,cAAc;QAClBJ,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE,MAAM;QACZI,MAAM,EAAE,QAAQ;QAChBC,QAAQ,EAAE,EAAE;QACZC,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;QACrBC,cAAc,EAAE;MAClB,CAAC;MAEA5B,aAAM,CAACC,UAAU,CAACI,UAAU,CAAewB,iBAAiB,CAACN,cAAc,CAAC;MAE7E,MAAMO,MAAM,GAAG,MAAMC,6BAAiB,CAACO,aAAa,CAAC,cAAc,CAAC;MAEpEL,MAAM,CAACH,MAAM,CAAC,CAACI,OAAO,CAACX,cAAc,CAAC;IACxC,CAAC,CAAC;IAEFP,EAAE,CAAC,4CAA4C,EAAE,YAAY;MAC1DhB,aAAM,CAACC,UAAU,CAACI,UAAU,CAAewB,iBAAiB,CAAC,IAAI,CAAC;MAEnE,MAAMC,MAAM,GAAG,MAAMC,6BAAiB,CAACO,aAAa,CAAC,cAAc,CAAC;MAEpEL,MAAM,CAACH,MAAM,CAAC,CAACS,QAAQ,CAAC,CAAC;IAC3B,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF1B,QAAQ,CAAC,uBAAuB,EAAE,MAAM;IACtCG,EAAE,CAAC,+CAA+C,EAAE,YAAY;MAC9D,MAAMwB,eAAe,GAAG,CACtB;QACElB,EAAE,EAAE,cAAc;QAClBJ,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE,MAAM;QACZI,MAAM,EAAE,QAAQ;QAChBC,QAAQ,EAAE;MACZ,CAAC,EACD;QACEH,EAAE,EAAE,cAAc;QAClBJ,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE,SAAS;QACfI,MAAM,EAAE,WAAW;QACnBC,QAAQ,EAAE;MACZ,CAAC,CACF;MAEAzB,aAAM,CAACC,UAAU,CAACK,QAAQ,CAAeuB,iBAAiB,CAACW,eAAe,CAAC;MAE5E,MAAMV,MAAM,GAAG,MAAMC,6BAAiB,CAACU,qBAAqB,CAAC,WAAW,CAAC;MAEzER,MAAM,CAACH,MAAM,CAAC,CAACI,OAAO,CAACM,eAAe,CAAC;MACvCP,MAAM,CAACjC,aAAM,CAACC,UAAU,CAACK,QAAQ,CAAC,CAACoC,oBAAoB,CAAC;QACtDC,KAAK,EAAE;UAAEzB,SAAS,EAAE;QAAY;MAClC,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFL,QAAQ,CAAC,gBAAgB,EAAE,MAAM;IAC/BG,EAAE,CAAC,mCAAmC,EAAE,YAAY;MAClD,MAAM4B,qBAAqB,GAAG;QAC5BtB,EAAE,EAAE,cAAc;QAClBJ,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE,MAAM;QACZI,MAAM,EAAE,QAAQ;QAChBC,QAAQ,EAAE;MACZ,CAAC;MAEAzB,aAAM,CAACC,UAAU,CAACO,MAAM,CAAeqB,iBAAiB,CAACe,qBAAqB,CAAC;MAEhF,MAAMd,MAAM,GAAG,MAAMC,6BAAiB,CAACc,cAAc,CAAC,cAAc,EAAE,EAAE,CAAC;MAEzEZ,MAAM,CAACH,MAAM,CAAC,CAACI,OAAO,CAACU,qBAAqB,CAAC;MAC7CX,MAAM,CAACjC,aAAM,CAACC,UAAU,CAACO,MAAM,CAAC,CAACkC,oBAAoB,CAAC;QACpDC,KAAK,EAAE;UAAErB,EAAE,EAAE;QAAe,CAAC;QAC7BwB,IAAI,EAAE;UAAErB,QAAQ,EAAE;QAAG;MACvB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFT,EAAE,CAAC,+CAA+C,EAAE,YAAY;MAC9D,MAAMiB,MAAM,CAACF,6BAAiB,CAACc,cAAc,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC,CAACT,OAAO,CAACC,OAAO,CACjF,oCACF,CAAC;IACH,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFxB,QAAQ,CAAC,oBAAoB,EAAE,MAAM;IACnCG,EAAE,CAAC,qCAAqC,EAAE,YAAY;MACpD,MAAM+B,uBAAuB,GAAG;QAC9BzB,EAAE,EAAE,cAAc;QAClBJ,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE,MAAM;QACZI,MAAM,EAAE,WAAW;QACnBC,QAAQ,EAAE,GAAG;QACbG,cAAc,EAAE,IAAID,IAAI,CAAC;MAC3B,CAAC;MAEA3B,aAAM,CAACC,UAAU,CAACO,MAAM,CAAeqB,iBAAiB,CAACkB,uBAAuB,CAAC;MAElF,MAAMjB,MAAM,GAAG,MAAMC,6BAAiB,CAACiB,kBAAkB,CAAC,cAAc,CAAC;MAEzEf,MAAM,CAACH,MAAM,CAACN,MAAM,CAAC,CAACyB,IAAI,CAAC,WAAW,CAAC;MACvChB,MAAM,CAACH,MAAM,CAACL,QAAQ,CAAC,CAACwB,IAAI,CAAC,GAAG,CAAC;MACjChB,MAAM,CAACjC,aAAM,CAACC,UAAU,CAACO,MAAM,CAAC,CAAC2B,gBAAgB,CAAC,CAAC;IACrD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFtB,QAAQ,CAAC,gBAAgB,EAAE,MAAM;IAC/BG,EAAE,CAAC,mCAAmC,EAAE,YAAY;MAClD,MAAMkC,qBAAqB,GAAG;QAC5B5B,EAAE,EAAE,cAAc;QAClBJ,SAAS,EAAE,WAAW;QACtBC,QAAQ,EAAE,UAAU;QACpBC,IAAI,EAAE,MAAM;QACZI,MAAM,EAAE,SAAS;QACjBC,QAAQ,EAAE;MACZ,CAAC;MAEAzB,aAAM,CAACC,UAAU,CAACO,MAAM,CAAeqB,iBAAiB,CAACqB,qBAAqB,CAAC;MAEhF,MAAMpB,MAAM,GAAG,MAAMC,6BAAiB,CAACoB,cAAc,CAAC,cAAc,CAAC;MAErElB,MAAM,CAACH,MAAM,CAACN,MAAM,CAAC,CAACyB,IAAI,CAAC,SAAS,CAAC;MACrChB,MAAM,CAACjC,aAAM,CAACC,UAAU,CAACO,MAAM,CAAC,CAAC2B,gBAAgB,CAAC,CAAC;IACrD,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}