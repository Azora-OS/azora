{"version":3,"names":["expect","require","describe","redemption","azrToken","owner","requester","treasury","admin","beforeEach","ethers","getSigners","MockERC20","getContractFactory","deploy","utils","parseEther","deployed","Redemption","address","mint","it","to","equal","amount","bankDetails","connect","approve","requestRedeem","emit","withArgs","redemptionData","getRedemption","completed","bankRef","completeRedeem","balanceOf","completedTreasury","be","revertedWith"],"sources":["Redemption.test.js"],"sourcesContent":["// Test script for Redemption contract\r\n// Run with: npx hardhat test --network azora\r\n\r\nconst { expect } = require(\"chai\");\r\n\r\ndescribe(\"Redemption Contract\", function () {\r\n    let redemption, azrToken, owner, requester, treasury, admin;\r\n\r\n    beforeEach(async function () {\r\n        [owner, requester, treasury, admin] = await ethers.getSigners();\r\n\r\n        // Deploy mock AZR token for testing\r\n        const MockERC20 = await ethers.getContractFactory(\"MockERC20\");\r\n        azrToken = await MockERC20.deploy(\"Azora Token\", \"AZR\", ethers.utils.parseEther(\"1000000\"));\r\n        await azrToken.deployed();\r\n\r\n        // Deploy Redemption contract\r\n        const Redemption = await ethers.getContractFactory(\"Redemption\");\r\n        redemption = await Redemption.deploy(azrToken.address, admin.address);\r\n        await redemption.deployed();\r\n\r\n        // Mint tokens to requester\r\n        await azrToken.mint(requester.address, ethers.utils.parseEther(\"1000\"));\r\n    });\r\n\r\n    it(\"Should deploy with correct parameters\", async function () {\r\n        expect(await redemption.azrToken()).to.equal(azrToken.address);\r\n        expect(await redemption.admin()).to.equal(admin.address);\r\n    });\r\n\r\n    it(\"Should allow redemption request\", async function () {\r\n        const amount = ethers.utils.parseEther(\"150\");\r\n        const bankDetails = \"Test bank details\";\r\n\r\n        // Approve tokens\r\n        await azrToken.connect(requester).approve(redemption.address, amount);\r\n\r\n        // Request redemption\r\n        await expect(redemption.connect(requester).requestRedeem(amount, bankDetails))\r\n            .to.emit(redemption, \"RedeemRequested\")\r\n            .withArgs(1, requester.address, amount, bankDetails);\r\n\r\n        // Check redemption details\r\n        const redemptionData = await redemption.getRedemption(1);\r\n        expect(redemptionData.requester).to.equal(requester.address);\r\n        expect(redemptionData.amount).to.equal(amount);\r\n        expect(redemptionData.bankDetails).to.equal(bankDetails);\r\n        expect(redemptionData.completed).to.equal(false);\r\n    });\r\n\r\n    it(\"Should allow admin to complete redemption\", async function () {\r\n        const amount = ethers.utils.parseEther(\"150\");\r\n        const bankDetails = \"Test bank details\";\r\n        const bankRef = \"BANK-12345\";\r\n\r\n        // Setup redemption request\r\n        await azrToken.connect(requester).approve(redemption.address, amount);\r\n        await redemption.connect(requester).requestRedeem(amount, bankDetails);\r\n\r\n        // Complete redemption\r\n        await expect(redemption.connect(admin).completeRedeem(1, treasury.address, bankRef))\r\n            .to.emit(redemption, \"RedeemCompleted\")\r\n            .withArgs(1, treasury.address, bankRef);\r\n\r\n        // Check tokens transferred\r\n        expect(await azrToken.balanceOf(treasury.address)).to.equal(amount);\r\n\r\n        // Check redemption completed\r\n        const redemptionData = await redemption.getRedemption(1);\r\n        expect(redemptionData.completed).to.equal(true);\r\n        expect(redemptionData.bankRef).to.equal(bankRef);\r\n        expect(redemptionData.completedTreasury).to.equal(treasury.address);\r\n    });\r\n\r\n    it(\"Should reject non-admin completion\", async function () {\r\n        const amount = ethers.utils.parseEther(\"150\");\r\n        const bankDetails = \"Test bank details\";\r\n        const bankRef = \"BANK-12345\";\r\n\r\n        // Setup redemption request\r\n        await azrToken.connect(requester).approve(redemption.address, amount);\r\n        await redemption.connect(requester).requestRedeem(amount, bankDetails);\r\n\r\n        // Try to complete with non-admin\r\n        await expect(\r\n            redemption.connect(requester).completeRedeem(1, treasury.address, bankRef)\r\n        ).to.be.revertedWith(\"Only admin can call this function\");\r\n    });\r\n});"],"mappings":";;AAAA;AACA;;AAEA,MAAM;EAAEA;AAAO,CAAC,GAAGC,OAAO,CAAC,MAAM,CAAC;AAElCC,QAAQ,CAAC,qBAAqB,EAAE,YAAY;EACxC,IAAIC,UAAU,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,KAAK;EAE3DC,UAAU,CAAC,kBAAkB;IACzB,CAACJ,KAAK,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,KAAK,CAAC,GAAG,MAAME,MAAM,CAACC,UAAU,CAAC,CAAC;;IAE/D;IACA,MAAMC,SAAS,GAAG,MAAMF,MAAM,CAACG,kBAAkB,CAAC,WAAW,CAAC;IAC9DT,QAAQ,GAAG,MAAMQ,SAAS,CAACE,MAAM,CAAC,aAAa,EAAE,KAAK,EAAEJ,MAAM,CAACK,KAAK,CAACC,UAAU,CAAC,SAAS,CAAC,CAAC;IAC3F,MAAMZ,QAAQ,CAACa,QAAQ,CAAC,CAAC;;IAEzB;IACA,MAAMC,UAAU,GAAG,MAAMR,MAAM,CAACG,kBAAkB,CAAC,YAAY,CAAC;IAChEV,UAAU,GAAG,MAAMe,UAAU,CAACJ,MAAM,CAACV,QAAQ,CAACe,OAAO,EAAEX,KAAK,CAACW,OAAO,CAAC;IACrE,MAAMhB,UAAU,CAACc,QAAQ,CAAC,CAAC;;IAE3B;IACA,MAAMb,QAAQ,CAACgB,IAAI,CAACd,SAAS,CAACa,OAAO,EAAET,MAAM,CAACK,KAAK,CAACC,UAAU,CAAC,MAAM,CAAC,CAAC;EAC3E,CAAC,CAAC;EAEFK,EAAE,CAAC,uCAAuC,EAAE,kBAAkB;IAC1DrB,MAAM,CAAC,MAAMG,UAAU,CAACC,QAAQ,CAAC,CAAC,CAAC,CAACkB,EAAE,CAACC,KAAK,CAACnB,QAAQ,CAACe,OAAO,CAAC;IAC9DnB,MAAM,CAAC,MAAMG,UAAU,CAACK,KAAK,CAAC,CAAC,CAAC,CAACc,EAAE,CAACC,KAAK,CAACf,KAAK,CAACW,OAAO,CAAC;EAC5D,CAAC,CAAC;EAEFE,EAAE,CAAC,iCAAiC,EAAE,kBAAkB;IACpD,MAAMG,MAAM,GAAGd,MAAM,CAACK,KAAK,CAACC,UAAU,CAAC,KAAK,CAAC;IAC7C,MAAMS,WAAW,GAAG,mBAAmB;;IAEvC;IACA,MAAMrB,QAAQ,CAACsB,OAAO,CAACpB,SAAS,CAAC,CAACqB,OAAO,CAACxB,UAAU,CAACgB,OAAO,EAAEK,MAAM,CAAC;;IAErE;IACA,MAAMxB,MAAM,CAACG,UAAU,CAACuB,OAAO,CAACpB,SAAS,CAAC,CAACsB,aAAa,CAACJ,MAAM,EAAEC,WAAW,CAAC,CAAC,CACzEH,EAAE,CAACO,IAAI,CAAC1B,UAAU,EAAE,iBAAiB,CAAC,CACtC2B,QAAQ,CAAC,CAAC,EAAExB,SAAS,CAACa,OAAO,EAAEK,MAAM,EAAEC,WAAW,CAAC;;IAExD;IACA,MAAMM,cAAc,GAAG,MAAM5B,UAAU,CAAC6B,aAAa,CAAC,CAAC,CAAC;IACxDhC,MAAM,CAAC+B,cAAc,CAACzB,SAAS,CAAC,CAACgB,EAAE,CAACC,KAAK,CAACjB,SAAS,CAACa,OAAO,CAAC;IAC5DnB,MAAM,CAAC+B,cAAc,CAACP,MAAM,CAAC,CAACF,EAAE,CAACC,KAAK,CAACC,MAAM,CAAC;IAC9CxB,MAAM,CAAC+B,cAAc,CAACN,WAAW,CAAC,CAACH,EAAE,CAACC,KAAK,CAACE,WAAW,CAAC;IACxDzB,MAAM,CAAC+B,cAAc,CAACE,SAAS,CAAC,CAACX,EAAE,CAACC,KAAK,CAAC,KAAK,CAAC;EACpD,CAAC,CAAC;EAEFF,EAAE,CAAC,2CAA2C,EAAE,kBAAkB;IAC9D,MAAMG,MAAM,GAAGd,MAAM,CAACK,KAAK,CAACC,UAAU,CAAC,KAAK,CAAC;IAC7C,MAAMS,WAAW,GAAG,mBAAmB;IACvC,MAAMS,OAAO,GAAG,YAAY;;IAE5B;IACA,MAAM9B,QAAQ,CAACsB,OAAO,CAACpB,SAAS,CAAC,CAACqB,OAAO,CAACxB,UAAU,CAACgB,OAAO,EAAEK,MAAM,CAAC;IACrE,MAAMrB,UAAU,CAACuB,OAAO,CAACpB,SAAS,CAAC,CAACsB,aAAa,CAACJ,MAAM,EAAEC,WAAW,CAAC;;IAEtE;IACA,MAAMzB,MAAM,CAACG,UAAU,CAACuB,OAAO,CAAClB,KAAK,CAAC,CAAC2B,cAAc,CAAC,CAAC,EAAE5B,QAAQ,CAACY,OAAO,EAAEe,OAAO,CAAC,CAAC,CAC/EZ,EAAE,CAACO,IAAI,CAAC1B,UAAU,EAAE,iBAAiB,CAAC,CACtC2B,QAAQ,CAAC,CAAC,EAAEvB,QAAQ,CAACY,OAAO,EAAEe,OAAO,CAAC;;IAE3C;IACAlC,MAAM,CAAC,MAAMI,QAAQ,CAACgC,SAAS,CAAC7B,QAAQ,CAACY,OAAO,CAAC,CAAC,CAACG,EAAE,CAACC,KAAK,CAACC,MAAM,CAAC;;IAEnE;IACA,MAAMO,cAAc,GAAG,MAAM5B,UAAU,CAAC6B,aAAa,CAAC,CAAC,CAAC;IACxDhC,MAAM,CAAC+B,cAAc,CAACE,SAAS,CAAC,CAACX,EAAE,CAACC,KAAK,CAAC,IAAI,CAAC;IAC/CvB,MAAM,CAAC+B,cAAc,CAACG,OAAO,CAAC,CAACZ,EAAE,CAACC,KAAK,CAACW,OAAO,CAAC;IAChDlC,MAAM,CAAC+B,cAAc,CAACM,iBAAiB,CAAC,CAACf,EAAE,CAACC,KAAK,CAAChB,QAAQ,CAACY,OAAO,CAAC;EACvE,CAAC,CAAC;EAEFE,EAAE,CAAC,oCAAoC,EAAE,kBAAkB;IACvD,MAAMG,MAAM,GAAGd,MAAM,CAACK,KAAK,CAACC,UAAU,CAAC,KAAK,CAAC;IAC7C,MAAMS,WAAW,GAAG,mBAAmB;IACvC,MAAMS,OAAO,GAAG,YAAY;;IAE5B;IACA,MAAM9B,QAAQ,CAACsB,OAAO,CAACpB,SAAS,CAAC,CAACqB,OAAO,CAACxB,UAAU,CAACgB,OAAO,EAAEK,MAAM,CAAC;IACrE,MAAMrB,UAAU,CAACuB,OAAO,CAACpB,SAAS,CAAC,CAACsB,aAAa,CAACJ,MAAM,EAAEC,WAAW,CAAC;;IAEtE;IACA,MAAMzB,MAAM,CACRG,UAAU,CAACuB,OAAO,CAACpB,SAAS,CAAC,CAAC6B,cAAc,CAAC,CAAC,EAAE5B,QAAQ,CAACY,OAAO,EAAEe,OAAO,CAC7E,CAAC,CAACZ,EAAE,CAACgB,EAAE,CAACC,YAAY,CAAC,mCAAmC,CAAC;EAC7D,CAAC,CAAC;AACN,CAAC,CAAC","ignoreList":[]}