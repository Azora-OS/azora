29cb341f1f11b6abb3e317c429e8d8e7
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AuthServiceComponent = void 0;
var path = _interopRequireWildcard(require("path"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
class AuthServiceComponent {
  /**
   * Generate complete JWT authentication system
   */
  generateAuthService(config, outputDir) {
    const changes = [];
    const serviceName = 'auth-service';
    const serviceDir = path.join(outputDir, 'services', serviceName);

    // Main service file
    changes.push({
      path: path.join(serviceDir, 'src', 'index.ts'),
      type: 'create',
      content: this.generateIndexFile(config)
    });

    // Controllers
    changes.push({
      path: path.join(serviceDir, 'src', 'controllers', 'auth.controller.ts'),
      type: 'create',
      content: this.generateAuthController(config)
    });

    // Services
    changes.push({
      path: path.join(serviceDir, 'src', 'services', 'auth.service.ts'),
      type: 'create',
      content: this.generateAuthServiceFile(config)
    });
    changes.push({
      path: path.join(serviceDir, 'src', 'services', 'token.service.ts'),
      type: 'create',
      content: this.generateTokenService(config)
    });
    changes.push({
      path: path.join(serviceDir, 'src', 'services', 'session.service.ts'),
      type: 'create',
      content: this.generateSessionService(config)
    });

    // Repository
    changes.push({
      path: path.join(serviceDir, 'src', 'repositories', 'user.repository.ts'),
      type: 'create',
      content: this.generateUserRepository()
    });

    // Middleware
    changes.push({
      path: path.join(serviceDir, 'src', 'middleware', 'auth.middleware.ts'),
      type: 'create',
      content: this.generateAuthMiddleware()
    });

    // Types
    changes.push({
      path: path.join(serviceDir, 'src', 'types', 'index.ts'),
      type: 'create',
      content: this.generateTypes(config)
    });

    // Validation schemas
    changes.push({
      path: path.join(serviceDir, 'src', 'validation', 'auth.schemas.ts'),
      type: 'create',
      content: this.generateValidationSchemas()
    });

    // Prisma schema
    changes.push({
      path: path.join(serviceDir, 'prisma', 'schema.prisma'),
      type: 'create',
      content: this.generatePrismaSchema(config)
    });

    // Utilities
    changes.push({
      path: path.join(serviceDir, 'src', 'utils', 'password.ts'),
      type: 'create',
      content: this.generatePasswordUtils()
    });

    // Configuration files
    changes.push({
      path: path.join(serviceDir, 'package.json'),
      type: 'create',
      content: this.generatePackageJson(config)
    });
    changes.push({
      path: path.join(serviceDir, '.env.example'),
      type: 'create',
      content: this.generateEnvExample(config)
    });
    changes.push({
      path: path.join(serviceDir, 'README.md'),
      type: 'create',
      content: this.generateReadme(config)
    });
    return changes;
  }
  generateIndexFile(config) {
    const port = config.port || 3001;
    return `import express, { Application } from 'express';
import cors from 'cors';
import helmet from 'helmet';
import { AuthController } from './controllers/auth.controller';
import { errorHandler } from './middleware/error-handler';

const app: Application = express();
const PORT = process.env.PORT || ${port};

// Middleware
app.use(helmet());
app.use(cors({
  origin: process.env.CORS_ORIGIN || 'http://localhost:3000',
  credentials: true,
}));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'healthy', service: 'auth-service' });
});

// Routes
const authController = new AuthController();
app.use('/api/auth', authController.router);

// Error handling
app.use(errorHandler);

// Start server
app.listen(PORT, () => {
  console.log(\`Auth service running on port \${PORT}\`);
});

export default app;
`;
  }
  generateAuthController(config) {
    return `import { Router, Request, Response, NextFunction } from 'express';
import { AuthService } from '../services/auth.service';
import { validate } from '../middleware/validation';
import { AuthSchemas } from '../validation/auth.schemas';
import { authMiddleware } from '../middleware/auth.middleware';

export class AuthController {
  public router: Router;
  private authService: AuthService;

  constructor() {
    this.router = Router();
    this.authService = new AuthService();
    this.initializeRoutes();
  }

  private initializeRoutes(): void {
    // Registration
    this.router.post('/register', validate(AuthSchemas.register), this.register.bind(this));
    
    // Login
    this.router.post('/login', validate(AuthSchemas.login), this.login.bind(this));
    
    // Logout
    this.router.post('/logout', authMiddleware, this.logout.bind(this));
    
    // Refresh token
    this.router.post('/refresh', this.refreshToken.bind(this));
    
    // Password reset request
    this.router.post('/password-reset/request', validate(AuthSchemas.passwordResetRequest), this.requestPasswordReset.bind(this));
    
    // Password reset confirm
    this.router.post('/password-reset/confirm', validate(AuthSchemas.passwordResetConfirm), this.confirmPasswordReset.bind(this));
    
    // Get current user
    this.router.get('/me', authMiddleware, this.getCurrentUser.bind(this));
    
    // Update password
    this.router.put('/password', authMiddleware, validate(AuthSchemas.updatePassword), this.updatePassword.bind(this));
${config.enableMFA ? `
    // MFA endpoints
    this.router.post('/mfa/enable', authMiddleware, this.enableMFA.bind(this));
    this.router.post('/mfa/verify', authMiddleware, validate(AuthSchemas.verifyMFA), this.verifyMFA.bind(this));
    this.router.post('/mfa/disable', authMiddleware, this.disableMFA.bind(this));
` : ''}
  }

  private async register(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.authService.register(req.body);
      res.status(201).json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async login(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.authService.login(req.body);
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async logout(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const token = req.headers.authorization?.replace('Bearer ', '');
      if (token) {
        await this.authService.logout(token);
      }
      res.json({ success: true, message: 'Logged out successfully' });
    } catch (error) {
      next(error);
    }
  }

  private async refreshToken(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const { refreshToken } = req.body;
      const result = await this.authService.refreshToken(refreshToken);
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async requestPasswordReset(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      await this.authService.requestPasswordReset(req.body.email);
      res.json({ success: true, message: 'Password reset email sent' });
    } catch (error) {
      next(error);
    }
  }

  private async confirmPasswordReset(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      await this.authService.confirmPasswordReset(req.body.token, req.body.newPassword);
      res.json({ success: true, message: 'Password reset successfully' });
    } catch (error) {
      next(error);
    }
  }

  private async getCurrentUser(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const user = await this.authService.getUserById(req.user!.userId);
      res.json({ success: true, data: user });
    } catch (error) {
      next(error);
    }
  }

  private async updatePassword(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      await this.authService.updatePassword(req.user!.userId, req.body.currentPassword, req.body.newPassword);
      res.json({ success: true, message: 'Password updated successfully' });
    } catch (error) {
      next(error);
    }
  }
${config.enableMFA ? `
  private async enableMFA(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const result = await this.authService.enableMFA(req.user!.userId);
      res.json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }

  private async verifyMFA(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      await this.authService.verifyMFA(req.user!.userId, req.body.code);
      res.json({ success: true, message: 'MFA verified successfully' });
    } catch (error) {
      next(error);
    }
  }

  private async disableMFA(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      await this.authService.disableMFA(req.user!.userId);
      res.json({ success: true, message: 'MFA disabled successfully' });
    } catch (error) {
      next(error);
    }
  }
` : ''}
}
`;
  }
  generateAuthServiceFile(config) {
    return `import { UserRepository } from '../repositories/user.repository';
import { TokenService } from './token.service';
import { SessionService } from './session.service';
import { hashPassword, verifyPassword } from '../utils/password';
import { AppError } from '../middleware/error-handler';
import { User, RegisterInput, LoginInput, AuthResponse } from '../types';
${config.enableMFA ? "import * as speakeasy from 'speakeasy';\nimport * as QRCode from 'qrcode';" : ''}

export class AuthService {
  private userRepository: UserRepository;
  private tokenService: TokenService;
  private sessionService: SessionService;

  constructor() {
    this.userRepository = new UserRepository();
    this.tokenService = new TokenService();
    this.sessionService = new SessionService();
  }

  async register(input: RegisterInput): Promise<AuthResponse> {
    // Check if user already exists
    const existingUser = await this.userRepository.findByEmail(input.email);
    if (existingUser) {
      throw new AppError(400, 'User already exists');
    }

    // Hash password
    const hashedPassword = await hashPassword(input.password);

    // Create user
    const user = await this.userRepository.create({
      email: input.email,
      password: hashedPassword,
      name: input.name,
    });

    // Generate tokens
    const { accessToken, refreshToken } = this.tokenService.generateTokens({
      userId: user.id,
      email: user.email,
    });

    // Create session
    await this.sessionService.createSession(user.id, refreshToken);

    return {
      user: this.sanitizeUser(user),
      accessToken,
      refreshToken,
    };
  }

  async login(input: LoginInput): Promise<AuthResponse> {
    // Find user
    const user = await this.userRepository.findByEmail(input.email);
    if (!user) {
      throw new AppError(401, 'Invalid credentials');
    }

    // Verify password
    const isValid = await verifyPassword(input.password, user.password);
    if (!isValid) {
      throw new AppError(401, 'Invalid credentials');
    }

    // Generate tokens
    const { accessToken, refreshToken } = this.tokenService.generateTokens({
      userId: user.id,
      email: user.email,
    });

    // Create session
    await this.sessionService.createSession(user.id, refreshToken);

    return {
      user: this.sanitizeUser(user),
      accessToken,
      refreshToken,
    };
  }

  async logout(token: string): Promise<void> {
    await this.sessionService.deleteSessionByToken(token);
  }

  async refreshToken(refreshToken: string): Promise<{ accessToken: string; refreshToken: string }> {
    // Verify refresh token
    const payload = this.tokenService.verifyRefreshToken(refreshToken);

    // Check if session exists
    const session = await this.sessionService.getSessionByToken(refreshToken);
    if (!session) {
      throw new AppError(401, 'Invalid refresh token');
    }

    // Generate new tokens
    const tokens = this.tokenService.generateTokens({
      userId: payload.userId,
      email: payload.email,
    });

    // Update session
    await this.sessionService.updateSession(session.id, tokens.refreshToken);

    return tokens;
  }

  async requestPasswordReset(email: string): Promise<void> {
    const user = await this.userRepository.findByEmail(email);
    if (!user) {
      // Don't reveal if user exists
      return;
    }

    const resetToken = this.tokenService.generatePasswordResetToken(user.id);
    await this.userRepository.savePasswordResetToken(user.id, resetToken);

    // TODO: Send email with reset token
    console.log(\`Password reset token for \${email}: \${resetToken}\`);
  }

  async confirmPasswordReset(token: string, newPassword: string): Promise<void> {
    const userId = this.tokenService.verifyPasswordResetToken(token);
    
    const user = await this.userRepository.findById(userId);
    if (!user || user.passwordResetToken !== token) {
      throw new AppError(400, 'Invalid or expired reset token');
    }

    const hashedPassword = await hashPassword(newPassword);
    await this.userRepository.updatePassword(userId, hashedPassword);
    await this.userRepository.clearPasswordResetToken(userId);
  }

  async updatePassword(userId: string, currentPassword: string, newPassword: string): Promise<void> {
    const user = await this.userRepository.findById(userId);
    if (!user) {
      throw new AppError(404, 'User not found');
    }

    const isValid = await verifyPassword(currentPassword, user.password);
    if (!isValid) {
      throw new AppError(401, 'Current password is incorrect');
    }

    const hashedPassword = await hashPassword(newPassword);
    await this.userRepository.updatePassword(userId, hashedPassword);
  }

  async getUserById(userId: string): Promise<Partial<User>> {
    const user = await this.userRepository.findById(userId);
    if (!user) {
      throw new AppError(404, 'User not found');
    }
    return this.sanitizeUser(user);
  }
${config.enableMFA ? `
  async enableMFA(userId: string): Promise<{ secret: string; qrCode: string }> {
    const secret = speakeasy.generateSecret({
      name: 'AzStudio Auth',
      length: 32,
    });

    await this.userRepository.saveMFASecret(userId, secret.base32);

    const qrCode = await QRCode.toDataURL(secret.otpauth_url!);

    return {
      secret: secret.base32,
      qrCode,
    };
  }

  async verifyMFA(userId: string, code: string): Promise<void> {
    const user = await this.userRepository.findById(userId);
    if (!user || !user.mfaSecret) {
      throw new AppError(400, 'MFA not enabled');
    }

    const verified = speakeasy.totp.verify({
      secret: user.mfaSecret,
      encoding: 'base32',
      token: code,
    });

    if (!verified) {
      throw new AppError(401, 'Invalid MFA code');
    }

    await this.userRepository.enableMFA(userId);
  }

  async disableMFA(userId: string): Promise<void> {
    await this.userRepository.disableMFA(userId);
  }
` : ''}

  private sanitizeUser(user: User): Partial<User> {
    const { password, passwordResetToken, mfaSecret, ...sanitized } = user;
    return sanitized;
  }
}
`;
  }
  generateTokenService(config) {
    const sessionDuration = config.sessionDuration || 24;
    const resetExpiry = config.passwordResetExpiry || 1;
    return `import jwt from 'jsonwebtoken';
import { AppError } from '../middleware/error-handler';

export interface TokenPayload {
  userId: string;
  email: string;
}

export class TokenService {
  private accessTokenSecret: string;
  private refreshTokenSecret: string;
  private resetTokenSecret: string;

  constructor() {
    this.accessTokenSecret = process.env.JWT_ACCESS_SECRET || 'access-secret';
    this.refreshTokenSecret = process.env.JWT_REFRESH_SECRET || 'refresh-secret';
    this.resetTokenSecret = process.env.JWT_RESET_SECRET || 'reset-secret';
  }

  generateTokens(payload: TokenPayload): { accessToken: string; refreshToken: string } {
    const accessToken = jwt.sign(payload, this.accessTokenSecret, {
      expiresIn: '15m',
    });

    const refreshToken = jwt.sign(payload, this.refreshTokenSecret, {
      expiresIn: '${sessionDuration}h',
    });

    return { accessToken, refreshToken };
  }

  verifyAccessToken(token: string): TokenPayload {
    try {
      return jwt.verify(token, this.accessTokenSecret) as TokenPayload;
    } catch (error) {
      throw new AppError(401, 'Invalid or expired access token');
    }
  }

  verifyRefreshToken(token: string): TokenPayload {
    try {
      return jwt.verify(token, this.refreshTokenSecret) as TokenPayload;
    } catch (error) {
      throw new AppError(401, 'Invalid or expired refresh token');
    }
  }

  generatePasswordResetToken(userId: string): string {
    return jwt.sign({ userId }, this.resetTokenSecret, {
      expiresIn: '${resetExpiry}h',
    });
  }

  verifyPasswordResetToken(token: string): string {
    try {
      const payload = jwt.verify(token, this.resetTokenSecret) as { userId: string };
      return payload.userId;
    } catch (error) {
      throw new AppError(400, 'Invalid or expired reset token');
    }
  }
}
`;
  }
  generateSessionService(config) {
    return `import { PrismaClient } from '@prisma/client';
import { Session } from '../types';

const prisma = new PrismaClient();

export class SessionService {
  async createSession(userId: string, refreshToken: string): Promise<Session> {
    return prisma.session.create({
      data: {
        userId,
        refreshToken,
        expiresAt: new Date(Date.now() + ${(config.sessionDuration || 24) * 60 * 60 * 1000}),
      },
    });
  }

  async getSessionByToken(refreshToken: string): Promise<Session | null> {
    return prisma.session.findFirst({
      where: {
        refreshToken,
        expiresAt: {
          gt: new Date(),
        },
      },
    });
  }

  async updateSession(sessionId: string, newRefreshToken: string): Promise<Session> {
    return prisma.session.update({
      where: { id: sessionId },
      data: {
        refreshToken: newRefreshToken,
        expiresAt: new Date(Date.now() + ${(config.sessionDuration || 24) * 60 * 60 * 1000}),
      },
    });
  }

  async deleteSessionByToken(refreshToken: string): Promise<void> {
    await prisma.session.deleteMany({
      where: { refreshToken },
    });
  }

  async deleteUserSessions(userId: string): Promise<void> {
    await prisma.session.deleteMany({
      where: { userId },
    });
  }

  async cleanupExpiredSessions(): Promise<void> {
    await prisma.session.deleteMany({
      where: {
        expiresAt: {
          lt: new Date(),
        },
      },
    });
  }
}
`;
  }
  generateUserRepository() {
    return `import { PrismaClient } from '@prisma/client';
import { User, CreateUserInput } from '../types';

const prisma = new PrismaClient();

export class UserRepository {
  async findById(id: string): Promise<User | null> {
    return prisma.user.findUnique({
      where: { id },
    });
  }

  async findByEmail(email: string): Promise<User | null> {
    return prisma.user.findUnique({
      where: { email },
    });
  }

  async create(data: CreateUserInput): Promise<User> {
    return prisma.user.create({
      data,
    });
  }

  async updatePassword(userId: string, hashedPassword: string): Promise<User> {
    return prisma.user.update({
      where: { id: userId },
      data: { password: hashedPassword },
    });
  }

  async savePasswordResetToken(userId: string, token: string): Promise<User> {
    return prisma.user.update({
      where: { id: userId },
      data: {
        passwordResetToken: token,
        passwordResetExpires: new Date(Date.now() + 60 * 60 * 1000), // 1 hour
      },
    });
  }

  async clearPasswordResetToken(userId: string): Promise<User> {
    return prisma.user.update({
      where: { id: userId },
      data: {
        passwordResetToken: null,
        passwordResetExpires: null,
      },
    });
  }

  async saveMFASecret(userId: string, secret: string): Promise<User> {
    return prisma.user.update({
      where: { id: userId },
      data: { mfaSecret: secret },
    });
  }

  async enableMFA(userId: string): Promise<User> {
    return prisma.user.update({
      where: { id: userId },
      data: { mfaEnabled: true },
    });
  }

  async disableMFA(userId: string): Promise<User> {
    return prisma.user.update({
      where: { id: userId },
      data: {
        mfaEnabled: false,
        mfaSecret: null,
      },
    });
  }
}
`;
  }
  generateAuthMiddleware() {
    return `import { Request, Response, NextFunction } from 'express';
import { TokenService } from '../services/token.service';
import { AppError } from './error-handler';
import { TokenPayload } from '../types';

declare global {
  namespace Express {
    interface Request {
      user?: TokenPayload;
    }
  }
}

const tokenService = new TokenService();

export const authMiddleware = (
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');

    if (!token) {
      throw new AppError(401, 'Authentication required');
    }

    const payload = tokenService.verifyAccessToken(token);
    req.user = payload;
    next();
  } catch (error) {
    next(error);
  }
};

export const optionalAuth = (
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');

    if (token) {
      const payload = tokenService.verifyAccessToken(token);
      req.user = payload;
    }
    next();
  } catch (error) {
    // Continue without authentication
    next();
  }
};
`;
  }
  generateTypes(config) {
    return `export interface User {
  id: string;
  email: string;
  password: string;
  name: string;
  createdAt: Date;
  updatedAt: Date;
  passwordResetToken?: string | null;
  passwordResetExpires?: Date | null;
${config.enableMFA ? `  mfaEnabled: boolean;
  mfaSecret?: string | null;` : ''}
}

export interface CreateUserInput {
  email: string;
  password: string;
  name: string;
}

export interface RegisterInput {
  email: string;
  password: string;
  name: string;
}

export interface LoginInput {
  email: string;
  password: string;
}

export interface TokenPayload {
  userId: string;
  email: string;
}

export interface AuthResponse {
  user: Partial<User>;
  accessToken: string;
  refreshToken: string;
}

export interface Session {
  id: string;
  userId: string;
  refreshToken: string;
  expiresAt: Date;
  createdAt: Date;
}
`;
  }
  generateValidationSchemas() {
    return `import { z } from 'zod';

export const AuthSchemas = {
  register: z.object({
    body: z.object({
      email: z.string().email('Invalid email address'),
      password: z.string().min(8, 'Password must be at least 8 characters'),
      name: z.string().min(1, 'Name is required'),
    }),
  }),

  login: z.object({
    body: z.object({
      email: z.string().email('Invalid email address'),
      password: z.string().min(1, 'Password is required'),
    }),
  }),

  passwordResetRequest: z.object({
    body: z.object({
      email: z.string().email('Invalid email address'),
    }),
  }),

  passwordResetConfirm: z.object({
    body: z.object({
      token: z.string().min(1, 'Token is required'),
      newPassword: z.string().min(8, 'Password must be at least 8 characters'),
    }),
  }),

  updatePassword: z.object({
    body: z.object({
      currentPassword: z.string().min(1, 'Current password is required'),
      newPassword: z.string().min(8, 'New password must be at least 8 characters'),
    }),
  }),

  verifyMFA: z.object({
    body: z.object({
      code: z.string().length(6, 'MFA code must be 6 digits'),
    }),
  }),
};
`;
  }
  generatePrismaSchema(config) {
    return `generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  passwordResetToken   String?
  passwordResetExpires DateTime?
${config.enableMFA ? `  
  mfaEnabled Boolean  @default(false)
  mfaSecret  String?` : ''}
  
  sessions Session[]
  
  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([refreshToken])
  @@map("sessions")
}
`;
  }
  generatePasswordUtils() {
    return `import * as bcrypt from 'bcrypt';

const SALT_ROUNDS = 10;

export async function hashPassword(password: string): Promise<string> {
  return bcrypt.hash(password, SALT_ROUNDS);
}

export async function verifyPassword(password: string, hash: string): Promise<boolean> {
  return bcrypt.compare(password, hash);
}
`;
  }
  generatePackageJson(config) {
    return JSON.stringify({
      name: 'auth-service',
      version: '1.0.0',
      description: 'JWT Authentication Service',
      main: 'dist/index.js',
      scripts: {
        dev: 'ts-node-dev --respawn --transpile-only src/index.ts',
        build: 'tsc',
        start: 'node dist/index.js',
        test: 'jest',
        'test:watch': 'jest --watch',
        'prisma:generate': 'prisma generate',
        'prisma:migrate': 'prisma migrate dev'
      },
      dependencies: {
        express: '^4.18.2',
        cors: '^2.8.5',
        helmet: '^7.1.0',
        zod: '^3.22.4',
        '@prisma/client': '^5.7.1',
        jsonwebtoken: '^9.0.2',
        bcrypt: '^5.1.1',
        ...(config.enableMFA && {
          speakeasy: '^2.0.0',
          qrcode: '^1.5.3'
        })
      },
      devDependencies: {
        '@types/express': '^4.17.21',
        '@types/cors': '^2.8.17',
        '@types/node': '^20.10.5',
        '@types/jsonwebtoken': '^9.0.5',
        '@types/bcrypt': '^5.0.2',
        typescript: '^5.3.3',
        'ts-node-dev': '^2.0.0',
        jest: '^29.7.0',
        '@types/jest': '^29.5.11',
        'ts-jest': '^29.1.1',
        prisma: '^5.7.1',
        ...(config.enableMFA && {
          '@types/speakeasy': '^2.0.10',
          '@types/qrcode': '^1.5.5'
        })
      }
    }, null, 2);
  }
  generateEnvExample(config) {
    return `PORT=${config.port || 3001}
NODE_ENV=development
CORS_ORIGIN=http://localhost:3000

DATABASE_URL=postgresql://user:password@localhost:5432/auth_db

JWT_ACCESS_SECRET=${config.jwtSecret || 'your-access-secret-key'}
JWT_REFRESH_SECRET=your-refresh-secret-key
JWT_RESET_SECRET=your-reset-secret-key
`;
  }
  generateReadme(config) {
    return `# Auth Service

JWT-based authentication service with user registration, login, password reset, and session management.

## Features

- User registration and login
- JWT access and refresh tokens
- Password reset flow
- Session management
${config.enableMFA ? '- Multi-factor authentication (MFA)\n' : ''}- Secure password hashing with bcrypt

## Installation

\`\`\`bash
npm install
\`\`\`

## Database Setup

\`\`\`bash
npx prisma migrate dev
npx prisma generate
\`\`\`

## Configuration

Copy \`.env.example\` to \`.env\` and configure:

- \`DATABASE_URL\`: PostgreSQL connection string
- \`JWT_ACCESS_SECRET\`: Secret for access tokens
- \`JWT_REFRESH_SECRET\`: Secret for refresh tokens
- \`JWT_RESET_SECRET\`: Secret for password reset tokens

## Development

\`\`\`bash
npm run dev
\`\`\`

## Production

\`\`\`bash
npm run build
npm start
\`\`\`

## API Endpoints

### Authentication
- \`POST /api/auth/register\` - Register new user
- \`POST /api/auth/login\` - Login user
- \`POST /api/auth/logout\` - Logout user
- \`POST /api/auth/refresh\` - Refresh access token

### Password Management
- \`POST /api/auth/password-reset/request\` - Request password reset
- \`POST /api/auth/password-reset/confirm\` - Confirm password reset
- \`PUT /api/auth/password\` - Update password (authenticated)

### User
- \`GET /api/auth/me\` - Get current user (authenticated)
${config.enableMFA ? `
### MFA
- \`POST /api/auth/mfa/enable\` - Enable MFA (authenticated)
- \`POST /api/auth/mfa/verify\` - Verify MFA code (authenticated)
- \`POST /api/auth/mfa/disable\` - Disable MFA (authenticated)
` : ''}
## Testing

\`\`\`bash
npm test
\`\`\`
`;
  }
}
exports.AuthServiceComponent = AuthServiceComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiQXV0aFNlcnZpY2VDb21wb25lbnQiLCJnZW5lcmF0ZUF1dGhTZXJ2aWNlIiwiY29uZmlnIiwib3V0cHV0RGlyIiwiY2hhbmdlcyIsInNlcnZpY2VOYW1lIiwic2VydmljZURpciIsImpvaW4iLCJwdXNoIiwidHlwZSIsImNvbnRlbnQiLCJnZW5lcmF0ZUluZGV4RmlsZSIsImdlbmVyYXRlQXV0aENvbnRyb2xsZXIiLCJnZW5lcmF0ZUF1dGhTZXJ2aWNlRmlsZSIsImdlbmVyYXRlVG9rZW5TZXJ2aWNlIiwiZ2VuZXJhdGVTZXNzaW9uU2VydmljZSIsImdlbmVyYXRlVXNlclJlcG9zaXRvcnkiLCJnZW5lcmF0ZUF1dGhNaWRkbGV3YXJlIiwiZ2VuZXJhdGVUeXBlcyIsImdlbmVyYXRlVmFsaWRhdGlvblNjaGVtYXMiLCJnZW5lcmF0ZVByaXNtYVNjaGVtYSIsImdlbmVyYXRlUGFzc3dvcmRVdGlscyIsImdlbmVyYXRlUGFja2FnZUpzb24iLCJnZW5lcmF0ZUVudkV4YW1wbGUiLCJnZW5lcmF0ZVJlYWRtZSIsInBvcnQiLCJlbmFibGVNRkEiLCJzZXNzaW9uRHVyYXRpb24iLCJyZXNldEV4cGlyeSIsInBhc3N3b3JkUmVzZXRFeHBpcnkiLCJKU09OIiwic3RyaW5naWZ5IiwibmFtZSIsInZlcnNpb24iLCJkZXNjcmlwdGlvbiIsIm1haW4iLCJzY3JpcHRzIiwiZGV2IiwiYnVpbGQiLCJzdGFydCIsInRlc3QiLCJkZXBlbmRlbmNpZXMiLCJleHByZXNzIiwiY29ycyIsImhlbG1ldCIsInpvZCIsImpzb253ZWJ0b2tlbiIsImJjcnlwdCIsInNwZWFrZWFzeSIsInFyY29kZSIsImRldkRlcGVuZGVuY2llcyIsInR5cGVzY3JpcHQiLCJqZXN0IiwicHJpc21hIiwiand0U2VjcmV0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIkF1dGhTZXJ2aWNlQ29tcG9uZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBGaWxlQ2hhbmdlIH0gZnJvbSAnLi4vQ2hhbmdlc2V0TWFuYWdlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aFNlcnZpY2VDb25maWcge1xuICBuYW1lOiBzdHJpbmc7XG4gIHBvcnQ/OiBudW1iZXI7XG4gIGp3dFNlY3JldD86IHN0cmluZztcbiAgZW5hYmxlT0F1dGg/OiBib29sZWFuO1xuICBlbmFibGVNRkE/OiBib29sZWFuO1xuICBwYXNzd29yZFJlc2V0RXhwaXJ5PzogbnVtYmVyOyAvLyBpbiBob3Vyc1xuICBzZXNzaW9uRHVyYXRpb24/OiBudW1iZXI7IC8vIGluIGhvdXJzXG59XG5cbmV4cG9ydCBjbGFzcyBBdXRoU2VydmljZUNvbXBvbmVudCB7XG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb21wbGV0ZSBKV1QgYXV0aGVudGljYXRpb24gc3lzdGVtXG4gICAqL1xuICBnZW5lcmF0ZUF1dGhTZXJ2aWNlKGNvbmZpZzogQXV0aFNlcnZpY2VDb25maWcsIG91dHB1dERpcjogc3RyaW5nKTogRmlsZUNoYW5nZVtdIHtcbiAgICBjb25zdCBjaGFuZ2VzOiBGaWxlQ2hhbmdlW10gPSBbXTtcbiAgICBjb25zdCBzZXJ2aWNlTmFtZSA9ICdhdXRoLXNlcnZpY2UnO1xuICAgIGNvbnN0IHNlcnZpY2VEaXIgPSBwYXRoLmpvaW4ob3V0cHV0RGlyLCAnc2VydmljZXMnLCBzZXJ2aWNlTmFtZSk7XG5cbiAgICAvLyBNYWluIHNlcnZpY2UgZmlsZVxuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICdpbmRleC50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlSW5kZXhGaWxlKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICAvLyBDb250cm9sbGVyc1xuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICdjb250cm9sbGVycycsICdhdXRoLmNvbnRyb2xsZXIudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZUF1dGhDb250cm9sbGVyKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICAvLyBTZXJ2aWNlc1xuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICdzZXJ2aWNlcycsICdhdXRoLnNlcnZpY2UudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZUF1dGhTZXJ2aWNlRmlsZShjb25maWcpLFxuICAgIH0pO1xuXG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAnc3JjJywgJ3NlcnZpY2VzJywgJ3Rva2VuLnNlcnZpY2UudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZVRva2VuU2VydmljZShjb25maWcpLFxuICAgIH0pO1xuXG4gICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgIHBhdGg6IHBhdGguam9pbihzZXJ2aWNlRGlyLCAnc3JjJywgJ3NlcnZpY2VzJywgJ3Nlc3Npb24uc2VydmljZS50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlU2Vzc2lvblNlcnZpY2UoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIC8vIFJlcG9zaXRvcnlcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAncmVwb3NpdG9yaWVzJywgJ3VzZXIucmVwb3NpdG9yeS50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlVXNlclJlcG9zaXRvcnkoKSxcbiAgICB9KTtcblxuICAgIC8vIE1pZGRsZXdhcmVcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAnbWlkZGxld2FyZScsICdhdXRoLm1pZGRsZXdhcmUudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZUF1dGhNaWRkbGV3YXJlKCksXG4gICAgfSk7XG5cbiAgICAvLyBUeXBlc1xuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICd0eXBlcycsICdpbmRleC50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlVHlwZXMoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIC8vIFZhbGlkYXRpb24gc2NoZW1hc1xuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ3NyYycsICd2YWxpZGF0aW9uJywgJ2F1dGguc2NoZW1hcy50cycpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlVmFsaWRhdGlvblNjaGVtYXMoKSxcbiAgICB9KTtcblxuICAgIC8vIFByaXNtYSBzY2hlbWFcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdwcmlzbWEnLCAnc2NoZW1hLnByaXNtYScpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlUHJpc21hU2NoZW1hKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICAvLyBVdGlsaXRpZXNcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdzcmMnLCAndXRpbHMnLCAncGFzc3dvcmQudHMnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZVBhc3N3b3JkVXRpbHMoKSxcbiAgICB9KTtcblxuICAgIC8vIENvbmZpZ3VyYXRpb24gZmlsZXNcbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICdwYWNrYWdlLmpzb24nKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZVBhY2thZ2VKc29uKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgcGF0aDogcGF0aC5qb2luKHNlcnZpY2VEaXIsICcuZW52LmV4YW1wbGUnKSxcbiAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgY29udGVudDogdGhpcy5nZW5lcmF0ZUVudkV4YW1wbGUoY29uZmlnKSxcbiAgICB9KTtcblxuICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICBwYXRoOiBwYXRoLmpvaW4oc2VydmljZURpciwgJ1JFQURNRS5tZCcpLFxuICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICBjb250ZW50OiB0aGlzLmdlbmVyYXRlUmVhZG1lKGNvbmZpZyksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVJbmRleEZpbGUoY29uZmlnOiBBdXRoU2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgY29uc3QgcG9ydCA9IGNvbmZpZy5wb3J0IHx8IDMwMDE7XG4gICAgcmV0dXJuIGBpbXBvcnQgZXhwcmVzcywgeyBBcHBsaWNhdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IGNvcnMgZnJvbSAnY29ycyc7XG5pbXBvcnQgaGVsbWV0IGZyb20gJ2hlbG1ldCc7XG5pbXBvcnQgeyBBdXRoQ29udHJvbGxlciB9IGZyb20gJy4vY29udHJvbGxlcnMvYXV0aC5jb250cm9sbGVyJztcbmltcG9ydCB7IGVycm9ySGFuZGxlciB9IGZyb20gJy4vbWlkZGxld2FyZS9lcnJvci1oYW5kbGVyJztcblxuY29uc3QgYXBwOiBBcHBsaWNhdGlvbiA9IGV4cHJlc3MoKTtcbmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8ICR7cG9ydH07XG5cbi8vIE1pZGRsZXdhcmVcbmFwcC51c2UoaGVsbWV0KCkpO1xuYXBwLnVzZShjb3JzKHtcbiAgb3JpZ2luOiBwcm9jZXNzLmVudi5DT1JTX09SSUdJTiB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyxcbiAgY3JlZGVudGlhbHM6IHRydWUsXG59KSk7XG5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xuXG4vLyBIZWFsdGggY2hlY2tcbmFwcC5nZXQoJy9oZWFsdGgnLCAocmVxLCByZXMpID0+IHtcbiAgcmVzLmpzb24oeyBzdGF0dXM6ICdoZWFsdGh5Jywgc2VydmljZTogJ2F1dGgtc2VydmljZScgfSk7XG59KTtcblxuLy8gUm91dGVzXG5jb25zdCBhdXRoQ29udHJvbGxlciA9IG5ldyBBdXRoQ29udHJvbGxlcigpO1xuYXBwLnVzZSgnL2FwaS9hdXRoJywgYXV0aENvbnRyb2xsZXIucm91dGVyKTtcblxuLy8gRXJyb3IgaGFuZGxpbmdcbmFwcC51c2UoZXJyb3JIYW5kbGVyKTtcblxuLy8gU3RhcnQgc2VydmVyXG5hcHAubGlzdGVuKFBPUlQsICgpID0+IHtcbiAgY29uc29sZS5sb2coXFxgQXV0aCBzZXJ2aWNlIHJ1bm5pbmcgb24gcG9ydCBcXCR7UE9SVH1cXGApO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGFwcDtcbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQXV0aENvbnRyb2xsZXIoY29uZmlnOiBBdXRoU2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBpbXBvcnQgeyBSb3V0ZXIsIFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IHZhbGlkYXRlIH0gZnJvbSAnLi4vbWlkZGxld2FyZS92YWxpZGF0aW9uJztcbmltcG9ydCB7IEF1dGhTY2hlbWFzIH0gZnJvbSAnLi4vdmFsaWRhdGlvbi9hdXRoLnNjaGVtYXMnO1xuaW1wb3J0IHsgYXV0aE1pZGRsZXdhcmUgfSBmcm9tICcuLi9taWRkbGV3YXJlL2F1dGgubWlkZGxld2FyZSc7XG5cbmV4cG9ydCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XG4gIHB1YmxpYyByb3V0ZXI6IFJvdXRlcjtcbiAgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5yb3V0ZXIgPSBSb3V0ZXIoKTtcbiAgICB0aGlzLmF1dGhTZXJ2aWNlID0gbmV3IEF1dGhTZXJ2aWNlKCk7XG4gICAgdGhpcy5pbml0aWFsaXplUm91dGVzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVSb3V0ZXMoKTogdm9pZCB7XG4gICAgLy8gUmVnaXN0cmF0aW9uXG4gICAgdGhpcy5yb3V0ZXIucG9zdCgnL3JlZ2lzdGVyJywgdmFsaWRhdGUoQXV0aFNjaGVtYXMucmVnaXN0ZXIpLCB0aGlzLnJlZ2lzdGVyLmJpbmQodGhpcykpO1xuICAgIFxuICAgIC8vIExvZ2luXG4gICAgdGhpcy5yb3V0ZXIucG9zdCgnL2xvZ2luJywgdmFsaWRhdGUoQXV0aFNjaGVtYXMubG9naW4pLCB0aGlzLmxvZ2luLmJpbmQodGhpcykpO1xuICAgIFxuICAgIC8vIExvZ291dFxuICAgIHRoaXMucm91dGVyLnBvc3QoJy9sb2dvdXQnLCBhdXRoTWlkZGxld2FyZSwgdGhpcy5sb2dvdXQuYmluZCh0aGlzKSk7XG4gICAgXG4gICAgLy8gUmVmcmVzaCB0b2tlblxuICAgIHRoaXMucm91dGVyLnBvc3QoJy9yZWZyZXNoJywgdGhpcy5yZWZyZXNoVG9rZW4uYmluZCh0aGlzKSk7XG4gICAgXG4gICAgLy8gUGFzc3dvcmQgcmVzZXQgcmVxdWVzdFxuICAgIHRoaXMucm91dGVyLnBvc3QoJy9wYXNzd29yZC1yZXNldC9yZXF1ZXN0JywgdmFsaWRhdGUoQXV0aFNjaGVtYXMucGFzc3dvcmRSZXNldFJlcXVlc3QpLCB0aGlzLnJlcXVlc3RQYXNzd29yZFJlc2V0LmJpbmQodGhpcykpO1xuICAgIFxuICAgIC8vIFBhc3N3b3JkIHJlc2V0IGNvbmZpcm1cbiAgICB0aGlzLnJvdXRlci5wb3N0KCcvcGFzc3dvcmQtcmVzZXQvY29uZmlybScsIHZhbGlkYXRlKEF1dGhTY2hlbWFzLnBhc3N3b3JkUmVzZXRDb25maXJtKSwgdGhpcy5jb25maXJtUGFzc3dvcmRSZXNldC5iaW5kKHRoaXMpKTtcbiAgICBcbiAgICAvLyBHZXQgY3VycmVudCB1c2VyXG4gICAgdGhpcy5yb3V0ZXIuZ2V0KCcvbWUnLCBhdXRoTWlkZGxld2FyZSwgdGhpcy5nZXRDdXJyZW50VXNlci5iaW5kKHRoaXMpKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgcGFzc3dvcmRcbiAgICB0aGlzLnJvdXRlci5wdXQoJy9wYXNzd29yZCcsIGF1dGhNaWRkbGV3YXJlLCB2YWxpZGF0ZShBdXRoU2NoZW1hcy51cGRhdGVQYXNzd29yZCksIHRoaXMudXBkYXRlUGFzc3dvcmQuYmluZCh0aGlzKSk7XG4ke2NvbmZpZy5lbmFibGVNRkEgPyBgXG4gICAgLy8gTUZBIGVuZHBvaW50c1xuICAgIHRoaXMucm91dGVyLnBvc3QoJy9tZmEvZW5hYmxlJywgYXV0aE1pZGRsZXdhcmUsIHRoaXMuZW5hYmxlTUZBLmJpbmQodGhpcykpO1xuICAgIHRoaXMucm91dGVyLnBvc3QoJy9tZmEvdmVyaWZ5JywgYXV0aE1pZGRsZXdhcmUsIHZhbGlkYXRlKEF1dGhTY2hlbWFzLnZlcmlmeU1GQSksIHRoaXMudmVyaWZ5TUZBLmJpbmQodGhpcykpO1xuICAgIHRoaXMucm91dGVyLnBvc3QoJy9tZmEvZGlzYWJsZScsIGF1dGhNaWRkbGV3YXJlLCB0aGlzLmRpc2FibGVNRkEuYmluZCh0aGlzKSk7XG5gIDogJyd9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlZ2lzdGVyKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVnaXN0ZXIocmVxLmJvZHkpO1xuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9naW4ocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5sb2dpbihyZXEuYm9keSk7XG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHJlc3VsdCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2dvdXQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5yZXBsYWNlKCdCZWFyZXIgJywgJycpO1xuICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UubG9nb3V0KHRva2VuKTtcbiAgICAgIH1cbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ0xvZ2dlZCBvdXQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZWZyZXNoVG9rZW4ocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyByZWZyZXNoVG9rZW4gfSA9IHJlcS5ib2R5O1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5yZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKTtcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogcmVzdWx0IH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlcXVlc3RQYXNzd29yZFJlc2V0KHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVxdWVzdFBhc3N3b3JkUmVzZXQocmVxLmJvZHkuZW1haWwpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnUGFzc3dvcmQgcmVzZXQgZW1haWwgc2VudCcgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY29uZmlybVBhc3N3b3JkUmVzZXQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hdXRoU2VydmljZS5jb25maXJtUGFzc3dvcmRSZXNldChyZXEuYm9keS50b2tlbiwgcmVxLmJvZHkubmV3UGFzc3dvcmQpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnUGFzc3dvcmQgcmVzZXQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50VXNlcihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5nZXRVc2VyQnlJZChyZXEudXNlciEudXNlcklkKTtcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogdXNlciB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVQYXNzd29yZChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLnVwZGF0ZVBhc3N3b3JkKHJlcS51c2VyIS51c2VySWQsIHJlcS5ib2R5LmN1cnJlbnRQYXNzd29yZCwgcmVxLmJvZHkubmV3UGFzc3dvcmQpO1xuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnUGFzc3dvcmQgdXBkYXRlZCBzdWNjZXNzZnVsbHknIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cbiR7Y29uZmlnLmVuYWJsZU1GQSA/IGBcbiAgcHJpdmF0ZSBhc3luYyBlbmFibGVNRkEocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5lbmFibGVNRkEocmVxLnVzZXIhLnVzZXJJZCk7XG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHJlc3VsdCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB2ZXJpZnlNRkEocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hdXRoU2VydmljZS52ZXJpZnlNRkEocmVxLnVzZXIhLnVzZXJJZCwgcmVxLmJvZHkuY29kZSk7XG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdNRkEgdmVyaWZpZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkaXNhYmxlTUZBKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UuZGlzYWJsZU1GQShyZXEudXNlciEudXNlcklkKTtcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ01GQSBkaXNhYmxlZCBzdWNjZXNzZnVsbHknIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cbmAgOiAnJ31cbn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQXV0aFNlcnZpY2VGaWxlKGNvbmZpZzogQXV0aFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaW1wb3J0IHsgVXNlclJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvdXNlci5yZXBvc2l0b3J5JztcbmltcG9ydCB7IFRva2VuU2VydmljZSB9IGZyb20gJy4vdG9rZW4uc2VydmljZSc7XG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZSB9IGZyb20gJy4vc2Vzc2lvbi5zZXJ2aWNlJztcbmltcG9ydCB7IGhhc2hQYXNzd29yZCwgdmVyaWZ5UGFzc3dvcmQgfSBmcm9tICcuLi91dGlscy9wYXNzd29yZCc7XG5pbXBvcnQgeyBBcHBFcnJvciB9IGZyb20gJy4uL21pZGRsZXdhcmUvZXJyb3ItaGFuZGxlcic7XG5pbXBvcnQgeyBVc2VyLCBSZWdpc3RlcklucHV0LCBMb2dpbklucHV0LCBBdXRoUmVzcG9uc2UgfSBmcm9tICcuLi90eXBlcyc7XG4ke2NvbmZpZy5lbmFibGVNRkEgPyBcImltcG9ydCAqIGFzIHNwZWFrZWFzeSBmcm9tICdzcGVha2Vhc3knO1xcbmltcG9ydCAqIGFzIFFSQ29kZSBmcm9tICdxcmNvZGUnO1wiIDogJyd9XG5cbmV4cG9ydCBjbGFzcyBBdXRoU2VydmljZSB7XG4gIHByaXZhdGUgdXNlclJlcG9zaXRvcnk6IFVzZXJSZXBvc2l0b3J5O1xuICBwcml2YXRlIHRva2VuU2VydmljZTogVG9rZW5TZXJ2aWNlO1xuICBwcml2YXRlIHNlc3Npb25TZXJ2aWNlOiBTZXNzaW9uU2VydmljZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnVzZXJSZXBvc2l0b3J5ID0gbmV3IFVzZXJSZXBvc2l0b3J5KCk7XG4gICAgdGhpcy50b2tlblNlcnZpY2UgPSBuZXcgVG9rZW5TZXJ2aWNlKCk7XG4gICAgdGhpcy5zZXNzaW9uU2VydmljZSA9IG5ldyBTZXNzaW9uU2VydmljZSgpO1xuICB9XG5cbiAgYXN5bmMgcmVnaXN0ZXIoaW5wdXQ6IFJlZ2lzdGVySW5wdXQpOiBQcm9taXNlPEF1dGhSZXNwb25zZT4ge1xuICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcbiAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsKGlucHV0LmVtYWlsKTtcbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAwLCAnVXNlciBhbHJlYWR5IGV4aXN0cycpO1xuICAgIH1cblxuICAgIC8vIEhhc2ggcGFzc3dvcmRcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChpbnB1dC5wYXNzd29yZCk7XG5cbiAgICAvLyBDcmVhdGUgdXNlclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICBlbWFpbDogaW5wdXQuZW1haWwsXG4gICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICBuYW1lOiBpbnB1dC5uYW1lLFxuICAgIH0pO1xuXG4gICAgLy8gR2VuZXJhdGUgdG9rZW5zXG4gICAgY29uc3QgeyBhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuIH0gPSB0aGlzLnRva2VuU2VydmljZS5nZW5lcmF0ZVRva2Vucyh7XG4gICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBzZXNzaW9uXG4gICAgYXdhaXQgdGhpcy5zZXNzaW9uU2VydmljZS5jcmVhdGVTZXNzaW9uKHVzZXIuaWQsIHJlZnJlc2hUb2tlbik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdGhpcy5zYW5pdGl6ZVVzZXIodXNlciksXG4gICAgICBhY2Nlc3NUb2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbixcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgbG9naW4oaW5wdXQ6IExvZ2luSW5wdXQpOiBQcm9taXNlPEF1dGhSZXNwb25zZT4ge1xuICAgIC8vIEZpbmQgdXNlclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsKGlucHV0LmVtYWlsKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDEsICdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgfVxuXG4gICAgLy8gVmVyaWZ5IHBhc3N3b3JkXG4gICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGlucHV0LnBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKTtcbiAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDEsICdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgdG9rZW5zXG4gICAgY29uc3QgeyBhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuIH0gPSB0aGlzLnRva2VuU2VydmljZS5nZW5lcmF0ZVRva2Vucyh7XG4gICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBzZXNzaW9uXG4gICAgYXdhaXQgdGhpcy5zZXNzaW9uU2VydmljZS5jcmVhdGVTZXNzaW9uKHVzZXIuaWQsIHJlZnJlc2hUb2tlbik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjogdGhpcy5zYW5pdGl6ZVVzZXIodXNlciksXG4gICAgICBhY2Nlc3NUb2tlbixcbiAgICAgIHJlZnJlc2hUb2tlbixcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgbG9nb3V0KHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnNlc3Npb25TZXJ2aWNlLmRlbGV0ZVNlc3Npb25CeVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIGFzeW5jIHJlZnJlc2hUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8eyBhY2Nlc3NUb2tlbjogc3RyaW5nOyByZWZyZXNoVG9rZW46IHN0cmluZyB9PiB7XG4gICAgLy8gVmVyaWZ5IHJlZnJlc2ggdG9rZW5cbiAgICBjb25zdCBwYXlsb2FkID0gdGhpcy50b2tlblNlcnZpY2UudmVyaWZ5UmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbik7XG5cbiAgICAvLyBDaGVjayBpZiBzZXNzaW9uIGV4aXN0c1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB0aGlzLnNlc3Npb25TZXJ2aWNlLmdldFNlc3Npb25CeVRva2VuKHJlZnJlc2hUb2tlbik7XG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAxLCAnSW52YWxpZCByZWZyZXNoIHRva2VuJyk7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgbmV3IHRva2Vuc1xuICAgIGNvbnN0IHRva2VucyA9IHRoaXMudG9rZW5TZXJ2aWNlLmdlbmVyYXRlVG9rZW5zKHtcbiAgICAgIHVzZXJJZDogcGF5bG9hZC51c2VySWQsXG4gICAgICBlbWFpbDogcGF5bG9hZC5lbWFpbCxcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSBzZXNzaW9uXG4gICAgYXdhaXQgdGhpcy5zZXNzaW9uU2VydmljZS51cGRhdGVTZXNzaW9uKHNlc3Npb24uaWQsIHRva2Vucy5yZWZyZXNoVG9rZW4pO1xuXG4gICAgcmV0dXJuIHRva2VucztcbiAgfVxuXG4gIGFzeW5jIHJlcXVlc3RQYXNzd29yZFJlc2V0KGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbChlbWFpbCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICAvLyBEb24ndCByZXZlYWwgaWYgdXNlciBleGlzdHNcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCByZXNldFRva2VuID0gdGhpcy50b2tlblNlcnZpY2UuZ2VuZXJhdGVQYXNzd29yZFJlc2V0VG9rZW4odXNlci5pZCk7XG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5zYXZlUGFzc3dvcmRSZXNldFRva2VuKHVzZXIuaWQsIHJlc2V0VG9rZW4pO1xuXG4gICAgLy8gVE9ETzogU2VuZCBlbWFpbCB3aXRoIHJlc2V0IHRva2VuXG4gICAgY29uc29sZS5sb2coXFxgUGFzc3dvcmQgcmVzZXQgdG9rZW4gZm9yIFxcJHtlbWFpbH06IFxcJHtyZXNldFRva2VufVxcYCk7XG4gIH1cblxuICBhc3luYyBjb25maXJtUGFzc3dvcmRSZXNldCh0b2tlbjogc3RyaW5nLCBuZXdQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdXNlcklkID0gdGhpcy50b2tlblNlcnZpY2UudmVyaWZ5UGFzc3dvcmRSZXNldFRva2VuKHRva2VuKTtcbiAgICBcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kQnlJZCh1c2VySWQpO1xuICAgIGlmICghdXNlciB8fCB1c2VyLnBhc3N3b3JkUmVzZXRUb2tlbiAhPT0gdG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDAsICdJbnZhbGlkIG9yIGV4cGlyZWQgcmVzZXQgdG9rZW4nKTtcbiAgICB9XG5cbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZCk7XG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS51cGRhdGVQYXNzd29yZCh1c2VySWQsIGhhc2hlZFBhc3N3b3JkKTtcbiAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmNsZWFyUGFzc3dvcmRSZXNldFRva2VuKHVzZXJJZCk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVQYXNzd29yZCh1c2VySWQ6IHN0cmluZywgY3VycmVudFBhc3N3b3JkOiBzdHJpbmcsIG5ld1Bhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kQnlJZCh1c2VySWQpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKDQwNCwgJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XG4gICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAxLCAnQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnKTtcbiAgICB9XG5cbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZCk7XG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS51cGRhdGVQYXNzd29yZCh1c2VySWQsIGhhc2hlZFBhc3N3b3JkKTtcbiAgfVxuXG4gIGFzeW5jIGdldFVzZXJCeUlkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxQYXJ0aWFsPFVzZXI+PiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZEJ5SWQodXNlcklkKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDQsICdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zYW5pdGl6ZVVzZXIodXNlcik7XG4gIH1cbiR7Y29uZmlnLmVuYWJsZU1GQSA/IGBcbiAgYXN5bmMgZW5hYmxlTUZBKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7IHNlY3JldDogc3RyaW5nOyBxckNvZGU6IHN0cmluZyB9PiB7XG4gICAgY29uc3Qgc2VjcmV0ID0gc3BlYWtlYXN5LmdlbmVyYXRlU2VjcmV0KHtcbiAgICAgIG5hbWU6ICdBelN0dWRpbyBBdXRoJyxcbiAgICAgIGxlbmd0aDogMzIsXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LnNhdmVNRkFTZWNyZXQodXNlcklkLCBzZWNyZXQuYmFzZTMyKTtcblxuICAgIGNvbnN0IHFyQ29kZSA9IGF3YWl0IFFSQ29kZS50b0RhdGFVUkwoc2VjcmV0Lm90cGF1dGhfdXJsISk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2VjcmV0OiBzZWNyZXQuYmFzZTMyLFxuICAgICAgcXJDb2RlLFxuICAgIH07XG4gIH1cblxuICBhc3luYyB2ZXJpZnlNRkEodXNlcklkOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKHVzZXJJZCk7XG4gICAgaWYgKCF1c2VyIHx8ICF1c2VyLm1mYVNlY3JldCkge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKDQwMCwgJ01GQSBub3QgZW5hYmxlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHZlcmlmaWVkID0gc3BlYWtlYXN5LnRvdHAudmVyaWZ5KHtcbiAgICAgIHNlY3JldDogdXNlci5tZmFTZWNyZXQsXG4gICAgICBlbmNvZGluZzogJ2Jhc2UzMicsXG4gICAgICB0b2tlbjogY29kZSxcbiAgICB9KTtcblxuICAgIGlmICghdmVyaWZpZWQpIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDEsICdJbnZhbGlkIE1GQSBjb2RlJyk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5lbmFibGVNRkEodXNlcklkKTtcbiAgfVxuXG4gIGFzeW5jIGRpc2FibGVNRkEodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmRpc2FibGVNRkEodXNlcklkKTtcbiAgfVxuYCA6ICcnfVxuXG4gIHByaXZhdGUgc2FuaXRpemVVc2VyKHVzZXI6IFVzZXIpOiBQYXJ0aWFsPFVzZXI+IHtcbiAgICBjb25zdCB7IHBhc3N3b3JkLCBwYXNzd29yZFJlc2V0VG9rZW4sIG1mYVNlY3JldCwgLi4uc2FuaXRpemVkIH0gPSB1c2VyO1xuICAgIHJldHVybiBzYW5pdGl6ZWQ7XG4gIH1cbn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlVG9rZW5TZXJ2aWNlKGNvbmZpZzogQXV0aFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlc3Npb25EdXJhdGlvbiA9IGNvbmZpZy5zZXNzaW9uRHVyYXRpb24gfHwgMjQ7XG4gICAgY29uc3QgcmVzZXRFeHBpcnkgPSBjb25maWcucGFzc3dvcmRSZXNldEV4cGlyeSB8fCAxO1xuICAgIFxuICAgIHJldHVybiBgaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IHsgQXBwRXJyb3IgfSBmcm9tICcuLi9taWRkbGV3YXJlL2Vycm9yLWhhbmRsZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRva2VuUGF5bG9hZCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgVG9rZW5TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhY2Nlc3NUb2tlblNlY3JldDogc3RyaW5nO1xuICBwcml2YXRlIHJlZnJlc2hUb2tlblNlY3JldDogc3RyaW5nO1xuICBwcml2YXRlIHJlc2V0VG9rZW5TZWNyZXQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFjY2Vzc1Rva2VuU2VjcmV0ID0gcHJvY2Vzcy5lbnYuSldUX0FDQ0VTU19TRUNSRVQgfHwgJ2FjY2Vzcy1zZWNyZXQnO1xuICAgIHRoaXMucmVmcmVzaFRva2VuU2VjcmV0ID0gcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfU0VDUkVUIHx8ICdyZWZyZXNoLXNlY3JldCc7XG4gICAgdGhpcy5yZXNldFRva2VuU2VjcmV0ID0gcHJvY2Vzcy5lbnYuSldUX1JFU0VUX1NFQ1JFVCB8fCAncmVzZXQtc2VjcmV0JztcbiAgfVxuXG4gIGdlbmVyYXRlVG9rZW5zKHBheWxvYWQ6IFRva2VuUGF5bG9hZCk6IHsgYWNjZXNzVG9rZW46IHN0cmluZzsgcmVmcmVzaFRva2VuOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSBqd3Quc2lnbihwYXlsb2FkLCB0aGlzLmFjY2Vzc1Rva2VuU2VjcmV0LCB7XG4gICAgICBleHBpcmVzSW46ICcxNW0nLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gand0LnNpZ24ocGF5bG9hZCwgdGhpcy5yZWZyZXNoVG9rZW5TZWNyZXQsIHtcbiAgICAgIGV4cGlyZXNJbjogJyR7c2Vzc2lvbkR1cmF0aW9ufWgnLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiB9O1xuICB9XG5cbiAgdmVyaWZ5QWNjZXNzVG9rZW4odG9rZW46IHN0cmluZyk6IFRva2VuUGF5bG9hZCB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBqd3QudmVyaWZ5KHRva2VuLCB0aGlzLmFjY2Vzc1Rva2VuU2VjcmV0KSBhcyBUb2tlblBheWxvYWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBBcHBFcnJvcig0MDEsICdJbnZhbGlkIG9yIGV4cGlyZWQgYWNjZXNzIHRva2VuJyk7XG4gICAgfVxuICB9XG5cbiAgdmVyaWZ5UmVmcmVzaFRva2VuKHRva2VuOiBzdHJpbmcpOiBUb2tlblBheWxvYWQge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gand0LnZlcmlmeSh0b2tlbiwgdGhpcy5yZWZyZXNoVG9rZW5TZWNyZXQpIGFzIFRva2VuUGF5bG9hZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKDQwMSwgJ0ludmFsaWQgb3IgZXhwaXJlZCByZWZyZXNoIHRva2VuJyk7XG4gICAgfVxuICB9XG5cbiAgZ2VuZXJhdGVQYXNzd29yZFJlc2V0VG9rZW4odXNlcklkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBqd3Quc2lnbih7IHVzZXJJZCB9LCB0aGlzLnJlc2V0VG9rZW5TZWNyZXQsIHtcbiAgICAgIGV4cGlyZXNJbjogJyR7cmVzZXRFeHBpcnl9aCcsXG4gICAgfSk7XG4gIH1cblxuICB2ZXJpZnlQYXNzd29yZFJlc2V0VG9rZW4odG9rZW46IHN0cmluZyk6IHN0cmluZyB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSBqd3QudmVyaWZ5KHRva2VuLCB0aGlzLnJlc2V0VG9rZW5TZWNyZXQpIGFzIHsgdXNlcklkOiBzdHJpbmcgfTtcbiAgICAgIHJldHVybiBwYXlsb2FkLnVzZXJJZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKDQwMCwgJ0ludmFsaWQgb3IgZXhwaXJlZCByZXNldCB0b2tlbicpO1xuICAgIH1cbiAgfVxufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVTZXNzaW9uU2VydmljZShjb25maWc6IEF1dGhTZXJ2aWNlQ29uZmlnKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCB7IFNlc3Npb24gfSBmcm9tICcuLi90eXBlcyc7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZXhwb3J0IGNsYXNzIFNlc3Npb25TZXJ2aWNlIHtcbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbih1c2VySWQ6IHN0cmluZywgcmVmcmVzaFRva2VuOiBzdHJpbmcpOiBQcm9taXNlPFNlc3Npb24+IHtcbiAgICByZXR1cm4gcHJpc21hLnNlc3Npb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArICR7KGNvbmZpZy5zZXNzaW9uRHVyYXRpb24gfHwgMjQpICogNjAgKiA2MCAqIDEwMDB9KSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uQnlUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvbiB8IG51bGw+IHtcbiAgICByZXR1cm4gcHJpc21hLnNlc3Npb24uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHJlZnJlc2hUb2tlbixcbiAgICAgICAgZXhwaXJlc0F0OiB7XG4gICAgICAgICAgZ3Q6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZywgbmV3UmVmcmVzaFRva2VuOiBzdHJpbmcpOiBQcm9taXNlPFNlc3Npb24+IHtcbiAgICByZXR1cm4gcHJpc21hLnNlc3Npb24udXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBzZXNzaW9uSWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcmVmcmVzaFRva2VuOiBuZXdSZWZyZXNoVG9rZW4sXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArICR7KGNvbmZpZy5zZXNzaW9uRHVyYXRpb24gfHwgMjQpICogNjAgKiA2MCAqIDEwMDB9KSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uQnlUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHByaXNtYS5zZXNzaW9uLmRlbGV0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHsgcmVmcmVzaFRva2VuIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVVc2VyU2Vzc2lvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBwcmlzbWEuc2Vzc2lvbi5kZWxldGVNYW55KHtcbiAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY2xlYW51cEV4cGlyZWRTZXNzaW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBwcmlzbWEuc2Vzc2lvbi5kZWxldGVNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGV4cGlyZXNBdDoge1xuICAgICAgICAgIGx0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVVc2VyUmVwb3NpdG9yeSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHsgVXNlciwgQ3JlYXRlVXNlcklucHV0IH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmV4cG9ydCBjbGFzcyBVc2VyUmVwb3NpdG9yeSB7XG4gIGFzeW5jIGZpbmRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgcmV0dXJuIHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGZpbmRCeUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gICAgcmV0dXJuIHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgZW1haWwgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZShkYXRhOiBDcmVhdGVVc2VySW5wdXQpOiBQcm9taXNlPFVzZXI+IHtcbiAgICByZXR1cm4gcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgIGRhdGEsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVQYXNzd29yZCh1c2VySWQ6IHN0cmluZywgaGFzaGVkUGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8VXNlcj4ge1xuICAgIHJldHVybiBwcmlzbWEudXNlci51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgZGF0YTogeyBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVQYXNzd29yZFJlc2V0VG9rZW4odXNlcklkOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPFVzZXI+IHtcbiAgICByZXR1cm4gcHJpc21hLnVzZXIudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcGFzc3dvcmRSZXNldFRva2VuOiB0b2tlbixcbiAgICAgICAgcGFzc3dvcmRSZXNldEV4cGlyZXM6IG5ldyBEYXRlKERhdGUubm93KCkgKyA2MCAqIDYwICogMTAwMCksIC8vIDEgaG91clxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNsZWFyUGFzc3dvcmRSZXNldFRva2VuKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyPiB7XG4gICAgcmV0dXJuIHByaXNtYS51c2VyLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHBhc3N3b3JkUmVzZXRUb2tlbjogbnVsbCxcbiAgICAgICAgcGFzc3dvcmRSZXNldEV4cGlyZXM6IG51bGwsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc2F2ZU1GQVNlY3JldCh1c2VySWQ6IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpOiBQcm9taXNlPFVzZXI+IHtcbiAgICByZXR1cm4gcHJpc21hLnVzZXIudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGRhdGE6IHsgbWZhU2VjcmV0OiBzZWNyZXQgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGVuYWJsZU1GQSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlcj4ge1xuICAgIHJldHVybiBwcmlzbWEudXNlci51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgZGF0YTogeyBtZmFFbmFibGVkOiB0cnVlIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkaXNhYmxlTUZBKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyPiB7XG4gICAgcmV0dXJuIHByaXNtYS51c2VyLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG1mYUVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICBtZmFTZWNyZXQ6IG51bGwsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUF1dGhNaWRkbGV3YXJlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBUb2tlblNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy90b2tlbi5zZXJ2aWNlJztcbmltcG9ydCB7IEFwcEVycm9yIH0gZnJvbSAnLi9lcnJvci1oYW5kbGVyJztcbmltcG9ydCB7IFRva2VuUGF5bG9hZCB9IGZyb20gJy4uL3R5cGVzJztcblxuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgRXhwcmVzcyB7XG4gICAgaW50ZXJmYWNlIFJlcXVlc3Qge1xuICAgICAgdXNlcj86IFRva2VuUGF5bG9hZDtcbiAgICB9XG4gIH1cbn1cblxuY29uc3QgdG9rZW5TZXJ2aWNlID0gbmV3IFRva2VuU2VydmljZSgpO1xuXG5leHBvcnQgY29uc3QgYXV0aE1pZGRsZXdhcmUgPSAoXG4gIHJlcTogUmVxdWVzdCxcbiAgcmVzOiBSZXNwb25zZSxcbiAgbmV4dDogTmV4dEZ1bmN0aW9uXG4pOiB2b2lkID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24/LnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XG5cbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoNDAxLCAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXlsb2FkID0gdG9rZW5TZXJ2aWNlLnZlcmlmeUFjY2Vzc1Rva2VuKHRva2VuKTtcbiAgICByZXEudXNlciA9IHBheWxvYWQ7XG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIG5leHQoZXJyb3IpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3Qgb3B0aW9uYWxBdXRoID0gKFxuICByZXE6IFJlcXVlc3QsXG4gIHJlczogUmVzcG9uc2UsXG4gIG5leHQ6IE5leHRGdW5jdGlvblxuKTogdm9pZCA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5yZXBsYWNlKCdCZWFyZXIgJywgJycpO1xuXG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBjb25zdCBwYXlsb2FkID0gdG9rZW5TZXJ2aWNlLnZlcmlmeUFjY2Vzc1Rva2VuKHRva2VuKTtcbiAgICAgIHJlcS51c2VyID0gcGF5bG9hZDtcbiAgICB9XG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIENvbnRpbnVlIHdpdGhvdXQgYXV0aGVudGljYXRpb25cbiAgICBuZXh0KCk7XG4gIH1cbn07XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVR5cGVzKGNvbmZpZzogQXV0aFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgZXhwb3J0IGludGVyZmFjZSBVc2VyIHtcbiAgaWQ6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHVwZGF0ZWRBdDogRGF0ZTtcbiAgcGFzc3dvcmRSZXNldFRva2VuPzogc3RyaW5nIHwgbnVsbDtcbiAgcGFzc3dvcmRSZXNldEV4cGlyZXM/OiBEYXRlIHwgbnVsbDtcbiR7Y29uZmlnLmVuYWJsZU1GQSA/IGAgIG1mYUVuYWJsZWQ6IGJvb2xlYW47XG4gIG1mYVNlY3JldD86IHN0cmluZyB8IG51bGw7YCA6ICcnfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVVzZXJJbnB1dCB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWdpc3RlcklucHV0IHtcbiAgZW1haWw6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvZ2luSW5wdXQge1xuICBlbWFpbDogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRva2VuUGF5bG9hZCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXNwb25zZSB7XG4gIHVzZXI6IFBhcnRpYWw8VXNlcj47XG4gIGFjY2Vzc1Rva2VuOiBzdHJpbmc7XG4gIHJlZnJlc2hUb2tlbjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb24ge1xuICBpZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgcmVmcmVzaFRva2VuOiBzdHJpbmc7XG4gIGV4cGlyZXNBdDogRGF0ZTtcbiAgY3JlYXRlZEF0OiBEYXRlO1xufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVWYWxpZGF0aW9uU2NoZW1hcygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbmV4cG9ydCBjb25zdCBBdXRoU2NoZW1hcyA9IHtcbiAgcmVnaXN0ZXI6IHoub2JqZWN0KHtcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgnSW52YWxpZCBlbWFpbCBhZGRyZXNzJyksXG4gICAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oOCwgJ1Bhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzJyksXG4gICAgICBuYW1lOiB6LnN0cmluZygpLm1pbigxLCAnTmFtZSBpcyByZXF1aXJlZCcpLFxuICAgIH0pLFxuICB9KSxcblxuICBsb2dpbjogei5vYmplY3Qoe1xuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCdJbnZhbGlkIGVtYWlsIGFkZHJlc3MnKSxcbiAgICAgIHBhc3N3b3JkOiB6LnN0cmluZygpLm1pbigxLCAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnKSxcbiAgICB9KSxcbiAgfSksXG5cbiAgcGFzc3dvcmRSZXNldFJlcXVlc3Q6IHoub2JqZWN0KHtcbiAgICBib2R5OiB6Lm9iamVjdCh7XG4gICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgnSW52YWxpZCBlbWFpbCBhZGRyZXNzJyksXG4gICAgfSksXG4gIH0pLFxuXG4gIHBhc3N3b3JkUmVzZXRDb25maXJtOiB6Lm9iamVjdCh7XG4gICAgYm9keTogei5vYmplY3Qoe1xuICAgICAgdG9rZW46IHouc3RyaW5nKCkubWluKDEsICdUb2tlbiBpcyByZXF1aXJlZCcpLFxuICAgICAgbmV3UGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDgsICdQYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycycpLFxuICAgIH0pLFxuICB9KSxcblxuICB1cGRhdGVQYXNzd29yZDogei5vYmplY3Qoe1xuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIGN1cnJlbnRQYXNzd29yZDogei5zdHJpbmcoKS5taW4oMSwgJ0N1cnJlbnQgcGFzc3dvcmQgaXMgcmVxdWlyZWQnKSxcbiAgICAgIG5ld1Bhc3N3b3JkOiB6LnN0cmluZygpLm1pbig4LCAnTmV3IHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzJyksXG4gICAgfSksXG4gIH0pLFxuXG4gIHZlcmlmeU1GQTogei5vYmplY3Qoe1xuICAgIGJvZHk6IHoub2JqZWN0KHtcbiAgICAgIGNvZGU6IHouc3RyaW5nKCkubGVuZ3RoKDYsICdNRkEgY29kZSBtdXN0IGJlIDYgZGlnaXRzJyksXG4gICAgfSksXG4gIH0pLFxufTtcbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUHJpc21hU2NoZW1hKGNvbmZpZzogQXV0aFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgZ2VuZXJhdG9yIGNsaWVudCB7XG4gIHByb3ZpZGVyID0gXCJwcmlzbWEtY2xpZW50LWpzXCJcbn1cblxuZGF0YXNvdXJjZSBkYiB7XG4gIHByb3ZpZGVyID0gXCJwb3N0Z3Jlc3FsXCJcbiAgdXJsICAgICAgPSBlbnYoXCJEQVRBQkFTRV9VUkxcIilcbn1cblxubW9kZWwgVXNlciB7XG4gIGlkICAgICAgICBTdHJpbmcgICBAaWQgQGRlZmF1bHQoY3VpZCgpKVxuICBlbWFpbCAgICAgU3RyaW5nICAgQHVuaXF1ZVxuICBwYXNzd29yZCAgU3RyaW5nXG4gIG5hbWUgICAgICBTdHJpbmdcbiAgY3JlYXRlZEF0IERhdGVUaW1lIEBkZWZhdWx0KG5vdygpKVxuICB1cGRhdGVkQXQgRGF0ZVRpbWUgQHVwZGF0ZWRBdFxuICBcbiAgcGFzc3dvcmRSZXNldFRva2VuICAgU3RyaW5nP1xuICBwYXNzd29yZFJlc2V0RXhwaXJlcyBEYXRlVGltZT9cbiR7Y29uZmlnLmVuYWJsZU1GQSA/IGAgIFxuICBtZmFFbmFibGVkIEJvb2xlYW4gIEBkZWZhdWx0KGZhbHNlKVxuICBtZmFTZWNyZXQgIFN0cmluZz9gIDogJyd9XG4gIFxuICBzZXNzaW9ucyBTZXNzaW9uW11cbiAgXG4gIEBAbWFwKFwidXNlcnNcIilcbn1cblxubW9kZWwgU2Vzc2lvbiB7XG4gIGlkICAgICAgICAgICBTdHJpbmcgICBAaWQgQGRlZmF1bHQoY3VpZCgpKVxuICB1c2VySWQgICAgICAgU3RyaW5nXG4gIHJlZnJlc2hUb2tlbiBTdHJpbmcgICBAdW5pcXVlXG4gIGV4cGlyZXNBdCAgICBEYXRlVGltZVxuICBjcmVhdGVkQXQgICAgRGF0ZVRpbWUgQGRlZmF1bHQobm93KCkpXG4gIFxuICB1c2VyIFVzZXIgQHJlbGF0aW9uKGZpZWxkczogW3VzZXJJZF0sIHJlZmVyZW5jZXM6IFtpZF0sIG9uRGVsZXRlOiBDYXNjYWRlKVxuICBcbiAgQEBpbmRleChbdXNlcklkXSlcbiAgQEBpbmRleChbcmVmcmVzaFRva2VuXSlcbiAgQEBtYXAoXCJzZXNzaW9uc1wiKVxufVxuYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVQYXNzd29yZFV0aWxzKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBpbXBvcnQgKiBhcyBiY3J5cHQgZnJvbSAnYmNyeXB0JztcblxuY29uc3QgU0FMVF9ST1VORFMgPSAxMDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc2hQYXNzd29yZChwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgcmV0dXJuIGJjcnlwdC5oYXNoKHBhc3N3b3JkLCBTQUxUX1JPVU5EUyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZChwYXNzd29yZDogc3RyaW5nLCBoYXNoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCBoYXNoKTtcbn1cbmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUGFja2FnZUpzb24oY29uZmlnOiBBdXRoU2VydmljZUNvbmZpZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIG5hbWU6ICdhdXRoLXNlcnZpY2UnLFxuICAgICAgdmVyc2lvbjogJzEuMC4wJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnSldUIEF1dGhlbnRpY2F0aW9uIFNlcnZpY2UnLFxuICAgICAgbWFpbjogJ2Rpc3QvaW5kZXguanMnLFxuICAgICAgc2NyaXB0czoge1xuICAgICAgICBkZXY6ICd0cy1ub2RlLWRldiAtLXJlc3Bhd24gLS10cmFuc3BpbGUtb25seSBzcmMvaW5kZXgudHMnLFxuICAgICAgICBidWlsZDogJ3RzYycsXG4gICAgICAgIHN0YXJ0OiAnbm9kZSBkaXN0L2luZGV4LmpzJyxcbiAgICAgICAgdGVzdDogJ2plc3QnLFxuICAgICAgICAndGVzdDp3YXRjaCc6ICdqZXN0IC0td2F0Y2gnLFxuICAgICAgICAncHJpc21hOmdlbmVyYXRlJzogJ3ByaXNtYSBnZW5lcmF0ZScsXG4gICAgICAgICdwcmlzbWE6bWlncmF0ZSc6ICdwcmlzbWEgbWlncmF0ZSBkZXYnLFxuICAgICAgfSxcbiAgICAgIGRlcGVuZGVuY2llczoge1xuICAgICAgICBleHByZXNzOiAnXjQuMTguMicsXG4gICAgICAgIGNvcnM6ICdeMi44LjUnLFxuICAgICAgICBoZWxtZXQ6ICdeNy4xLjAnLFxuICAgICAgICB6b2Q6ICdeMy4yMi40JyxcbiAgICAgICAgJ0BwcmlzbWEvY2xpZW50JzogJ141LjcuMScsXG4gICAgICAgIGpzb253ZWJ0b2tlbjogJ145LjAuMicsXG4gICAgICAgIGJjcnlwdDogJ141LjEuMScsXG4gICAgICAgIC4uLihjb25maWcuZW5hYmxlTUZBICYmIHtcbiAgICAgICAgICBzcGVha2Vhc3k6ICdeMi4wLjAnLFxuICAgICAgICAgIHFyY29kZTogJ14xLjUuMycsXG4gICAgICAgIH0pLFxuICAgICAgfSxcbiAgICAgIGRldkRlcGVuZGVuY2llczoge1xuICAgICAgICAnQHR5cGVzL2V4cHJlc3MnOiAnXjQuMTcuMjEnLFxuICAgICAgICAnQHR5cGVzL2NvcnMnOiAnXjIuOC4xNycsXG4gICAgICAgICdAdHlwZXMvbm9kZSc6ICdeMjAuMTAuNScsXG4gICAgICAgICdAdHlwZXMvanNvbndlYnRva2VuJzogJ145LjAuNScsXG4gICAgICAgICdAdHlwZXMvYmNyeXB0JzogJ141LjAuMicsXG4gICAgICAgIHR5cGVzY3JpcHQ6ICdeNS4zLjMnLFxuICAgICAgICAndHMtbm9kZS1kZXYnOiAnXjIuMC4wJyxcbiAgICAgICAgamVzdDogJ14yOS43LjAnLFxuICAgICAgICAnQHR5cGVzL2plc3QnOiAnXjI5LjUuMTEnLFxuICAgICAgICAndHMtamVzdCc6ICdeMjkuMS4xJyxcbiAgICAgICAgcHJpc21hOiAnXjUuNy4xJyxcbiAgICAgICAgLi4uKGNvbmZpZy5lbmFibGVNRkEgJiYge1xuICAgICAgICAgICdAdHlwZXMvc3BlYWtlYXN5JzogJ14yLjAuMTAnLFxuICAgICAgICAgICdAdHlwZXMvcXJjb2RlJzogJ14xLjUuNScsXG4gICAgICAgIH0pLFxuICAgICAgfSxcbiAgICB9LCBudWxsLCAyKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVFbnZFeGFtcGxlKGNvbmZpZzogQXV0aFNlcnZpY2VDb25maWcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgUE9SVD0ke2NvbmZpZy5wb3J0IHx8IDMwMDF9XG5OT0RFX0VOVj1kZXZlbG9wbWVudFxuQ09SU19PUklHSU49aHR0cDovL2xvY2FsaG9zdDozMDAwXG5cbkRBVEFCQVNFX1VSTD1wb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBsb2NhbGhvc3Q6NTQzMi9hdXRoX2RiXG5cbkpXVF9BQ0NFU1NfU0VDUkVUPSR7Y29uZmlnLmp3dFNlY3JldCB8fCAneW91ci1hY2Nlc3Mtc2VjcmV0LWtleSd9XG5KV1RfUkVGUkVTSF9TRUNSRVQ9eW91ci1yZWZyZXNoLXNlY3JldC1rZXlcbkpXVF9SRVNFVF9TRUNSRVQ9eW91ci1yZXNldC1zZWNyZXQta2V5XG5gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJlYWRtZShjb25maWc6IEF1dGhTZXJ2aWNlQ29uZmlnKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCMgQXV0aCBTZXJ2aWNlXG5cbkpXVC1iYXNlZCBhdXRoZW50aWNhdGlvbiBzZXJ2aWNlIHdpdGggdXNlciByZWdpc3RyYXRpb24sIGxvZ2luLCBwYXNzd29yZCByZXNldCwgYW5kIHNlc3Npb24gbWFuYWdlbWVudC5cblxuIyMgRmVhdHVyZXNcblxuLSBVc2VyIHJlZ2lzdHJhdGlvbiBhbmQgbG9naW5cbi0gSldUIGFjY2VzcyBhbmQgcmVmcmVzaCB0b2tlbnNcbi0gUGFzc3dvcmQgcmVzZXQgZmxvd1xuLSBTZXNzaW9uIG1hbmFnZW1lbnRcbiR7Y29uZmlnLmVuYWJsZU1GQSA/ICctIE11bHRpLWZhY3RvciBhdXRoZW50aWNhdGlvbiAoTUZBKVxcbicgOiAnJ30tIFNlY3VyZSBwYXNzd29yZCBoYXNoaW5nIHdpdGggYmNyeXB0XG5cbiMjIEluc3RhbGxhdGlvblxuXG5cXGBcXGBcXGBiYXNoXG5ucG0gaW5zdGFsbFxuXFxgXFxgXFxgXG5cbiMjIERhdGFiYXNlIFNldHVwXG5cblxcYFxcYFxcYGJhc2hcbm5weCBwcmlzbWEgbWlncmF0ZSBkZXZcbm5weCBwcmlzbWEgZ2VuZXJhdGVcblxcYFxcYFxcYFxuXG4jIyBDb25maWd1cmF0aW9uXG5cbkNvcHkgXFxgLmVudi5leGFtcGxlXFxgIHRvIFxcYC5lbnZcXGAgYW5kIGNvbmZpZ3VyZTpcblxuLSBcXGBEQVRBQkFTRV9VUkxcXGA6IFBvc3RncmVTUUwgY29ubmVjdGlvbiBzdHJpbmdcbi0gXFxgSldUX0FDQ0VTU19TRUNSRVRcXGA6IFNlY3JldCBmb3IgYWNjZXNzIHRva2Vuc1xuLSBcXGBKV1RfUkVGUkVTSF9TRUNSRVRcXGA6IFNlY3JldCBmb3IgcmVmcmVzaCB0b2tlbnNcbi0gXFxgSldUX1JFU0VUX1NFQ1JFVFxcYDogU2VjcmV0IGZvciBwYXNzd29yZCByZXNldCB0b2tlbnNcblxuIyMgRGV2ZWxvcG1lbnRcblxuXFxgXFxgXFxgYmFzaFxubnBtIHJ1biBkZXZcblxcYFxcYFxcYFxuXG4jIyBQcm9kdWN0aW9uXG5cblxcYFxcYFxcYGJhc2hcbm5wbSBydW4gYnVpbGRcbm5wbSBzdGFydFxuXFxgXFxgXFxgXG5cbiMjIEFQSSBFbmRwb2ludHNcblxuIyMjIEF1dGhlbnRpY2F0aW9uXG4tIFxcYFBPU1QgL2FwaS9hdXRoL3JlZ2lzdGVyXFxgIC0gUmVnaXN0ZXIgbmV3IHVzZXJcbi0gXFxgUE9TVCAvYXBpL2F1dGgvbG9naW5cXGAgLSBMb2dpbiB1c2VyXG4tIFxcYFBPU1QgL2FwaS9hdXRoL2xvZ291dFxcYCAtIExvZ291dCB1c2VyXG4tIFxcYFBPU1QgL2FwaS9hdXRoL3JlZnJlc2hcXGAgLSBSZWZyZXNoIGFjY2VzcyB0b2tlblxuXG4jIyMgUGFzc3dvcmQgTWFuYWdlbWVudFxuLSBcXGBQT1NUIC9hcGkvYXV0aC9wYXNzd29yZC1yZXNldC9yZXF1ZXN0XFxgIC0gUmVxdWVzdCBwYXNzd29yZCByZXNldFxuLSBcXGBQT1NUIC9hcGkvYXV0aC9wYXNzd29yZC1yZXNldC9jb25maXJtXFxgIC0gQ29uZmlybSBwYXNzd29yZCByZXNldFxuLSBcXGBQVVQgL2FwaS9hdXRoL3Bhc3N3b3JkXFxgIC0gVXBkYXRlIHBhc3N3b3JkIChhdXRoZW50aWNhdGVkKVxuXG4jIyMgVXNlclxuLSBcXGBHRVQgL2FwaS9hdXRoL21lXFxgIC0gR2V0IGN1cnJlbnQgdXNlciAoYXV0aGVudGljYXRlZClcbiR7Y29uZmlnLmVuYWJsZU1GQSA/IGBcbiMjIyBNRkFcbi0gXFxgUE9TVCAvYXBpL2F1dGgvbWZhL2VuYWJsZVxcYCAtIEVuYWJsZSBNRkEgKGF1dGhlbnRpY2F0ZWQpXG4tIFxcYFBPU1QgL2FwaS9hdXRoL21mYS92ZXJpZnlcXGAgLSBWZXJpZnkgTUZBIGNvZGUgKGF1dGhlbnRpY2F0ZWQpXG4tIFxcYFBPU1QgL2FwaS9hdXRoL21mYS9kaXNhYmxlXFxgIC0gRGlzYWJsZSBNRkEgKGF1dGhlbnRpY2F0ZWQpXG5gIDogJyd9XG4jIyBUZXN0aW5nXG5c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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRXhCLE1BQU0sQ0FBQ3dCLFNBQVMsR0FBRztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxHQUFHLEVBQUU7QUFDTjtBQUNBLENBQUM7RUFDQztFQUVRYix1QkFBdUJBLENBQUNYLE1BQXlCLEVBQVU7SUFDakUsT0FBTztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFQSxNQUFNLENBQUN3QixTQUFTLEdBQUcsNEVBQTRFLEdBQUcsRUFBRTtBQUN0RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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