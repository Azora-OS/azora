{"version":3,"names":["request","require","express","createTestApp","app","helmet","cors","use","json","post","req","res","eventData","source","body","status","error","threatAnalysis","threatId","Date","now","severity","threatType","detected","confidence","timestamp","toISOString","suspicious","get","threats","count","lastUpdated","describe","beforeEach","it","response","send","action","ip","expect","toBe","toHaveProperty","Array","isArray"],"sources":["threat-detection.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst express = require('express');\r\n\r\nfunction createTestApp() {\r\n  const app = express();\r\n  const helmet = require('helmet');\r\n  const cors = require('cors');\r\n\r\n  app.use(helmet());\r\n  app.use(cors());\r\n  app.use(express.json());\r\n\r\n  app.post('/api/security/detect-threat', (req, res) => {\r\n    const { eventData, source } = req.body;\r\n\r\n    if (!eventData) {\r\n      return res.status(400).json({ error: 'Event data is required' });\r\n    }\r\n\r\n    const threatAnalysis = {\r\n      threatId: `threat_${Date.now()}`,\r\n      source: source || 'unknown',\r\n      severity: 'low',\r\n      threatType: 'none',\r\n      detected: false,\r\n      confidence: 0.95,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    // Simulate threat detection logic\r\n    if (eventData.suspicious === true) {\r\n      threatAnalysis.detected = true;\r\n      threatAnalysis.severity = 'high';\r\n      threatAnalysis.threatType = 'suspicious_activity';\r\n    }\r\n\r\n    res.json(threatAnalysis);\r\n  });\r\n\r\n  app.get('/api/security/threats', (req, res) => {\r\n    res.json({\r\n      threats: [],\r\n      count: 0,\r\n      lastUpdated: new Date().toISOString()\r\n    });\r\n  });\r\n\r\n  return app;\r\n}\r\n\r\ndescribe('Azora Aegis - Threat Detection Tests', () => {\r\n  let app;\r\n\r\n  beforeEach(() => {\r\n    app = createTestApp();\r\n  });\r\n\r\n  describe('POST /api/security/detect-threat', () => {\r\n    it('should analyze event data for threats', async () => {\r\n      const response = await request(app)\r\n        .post('/api/security/detect-threat')\r\n        .send({\r\n          eventData: { action: 'login', ip: '192.168.1.1' },\r\n          source: 'auth-service'\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('threatId');\r\n      expect(response.body.source).toBe('auth-service');\r\n      expect(response.body).toHaveProperty('severity');\r\n      expect(response.body).toHaveProperty('detected');\r\n    });\r\n\r\n    it('should detect suspicious activity', async () => {\r\n      const response = await request(app)\r\n        .post('/api/security/detect-threat')\r\n        .send({\r\n          eventData: { suspicious: true, action: 'unauthorized_access' },\r\n          source: 'api-gateway'\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.detected).toBe(true);\r\n      expect(response.body.severity).toBe('high');\r\n      expect(response.body.threatType).toBe('suspicious_activity');\r\n    });\r\n\r\n    it('should return error when event data is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/security/detect-threat')\r\n        .send({ source: 'test' });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Event data is required');\r\n    });\r\n\r\n    it('should include confidence score in analysis', async () => {\r\n      const response = await request(app)\r\n        .post('/api/security/detect-threat')\r\n        .send({\r\n          eventData: { action: 'login' }\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('confidence');\r\n      expect(typeof response.body.confidence).toBe('number');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/security/threats', () => {\r\n    it('should return list of detected threats', async () => {\r\n      const response = await request(app)\r\n        .get('/api/security/threats');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('threats');\r\n      expect(Array.isArray(response.body.threats)).toBe(true);\r\n      expect(response.body).toHaveProperty('count');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}