2b5cae247480e61146d0e0e1e47ae2a7
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AIOrchestrator = void 0;
var _openai = _interopRequireDefault(require("openai"));
var _sdk = _interopRequireDefault(require("@anthropic-ai/sdk"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
class AIOrchestrator {
  openai = null;
  anthropic = null;
  cache = new Map();
  CACHE_TTL = 3600000; // 1 hour
  totalTokensUsed = 0;
  totalCost = 0;
  constructor() {
    this.validator = ConstitutionalValidator.getInstance();
    // Initialize clients if API keys are available
    if (process.env.OPENAI_API_KEY) {
      this.openai = new _openai.default({
        apiKey: process.env.OPENAI_API_KEY
      });
    }
    if (process.env.ANTHROPIC_API_KEY) {
      this.anthropic = new _sdk.default({
        apiKey: process.env.ANTHROPIC_API_KEY
      });
    }
  }
  async generateCode(prompt, context, model) {
    // Check cache first
    const cacheKey = this.getCacheKey(prompt, context);
    const cached = this.getCachedResponse(cacheKey);
    if (cached) {
      console.log('Using cached AI response');
      return {
        content: cached.response,
        model: cached.model,
        tokensUsed: 0,
        cost: 0
      };
    }

    // Select model
    const selectedModel = model || this.selectModel('code-generation');

    // Build full prompt with context
    const fullPrompt = this.buildPrompt(prompt, context);

    // Generate response
    let response;
    if (selectedModel.provider === 'openai') {
      response = await this.generateWithOpenAI(fullPrompt, selectedModel);
    } else {
      response = await this.generateWithClaude(fullPrompt, selectedModel);
    }

    // CONSTITUTIONAL CHECK (The Conscience)
    console.log('[AIOrchestrator] Validating generated code against Divine Law...');
    const ethicalAnalysis = await this.validator.validateContent(response.content, prompt);
    if (!ethicalAnalysis.approved) {
      console.warn('[AIOrchestrator] Code generation VETOED by Constitution:', ethicalAnalysis.concerns);
      throw new Error(`Constitutional Violation: ${ethicalAnalysis.concerns.join(', ')}`);
    }

    // Cache response
    this.cacheResponse(cacheKey, response.content, response.model);

    // Track usage
    this.totalTokensUsed += response.tokensUsed;
    this.totalCost += response.cost;
    return response;
  }
  async generateWithOpenAI(prompt, model) {
    if (!this.openai) {
      throw new Error('OpenAI client not initialized. Please set OPENAI_API_KEY.');
    }
    const completion = await this.openai.chat.completions.create({
      model: model.model,
      messages: [{
        role: 'system',
        content: 'You are an expert software developer assistant. Generate clean, production-ready code following best practices.'
      }, {
        role: 'user',
        content: prompt
      }],
      max_tokens: model.maxTokens,
      temperature: model.temperature
    });
    const content = completion.choices[0]?.message?.content || '';
    const tokensUsed = completion.usage?.total_tokens || 0;
    const cost = this.calculateCost('openai', model.model, tokensUsed);
    return {
      content,
      model: model.model,
      tokensUsed,
      cost
    };
  }
  async generateWithClaude(prompt, model) {
    if (!this.anthropic) {
      throw new Error('Anthropic client not initialized. Please set ANTHROPIC_API_KEY.');
    }
    const message = await this.anthropic.messages.create({
      model: model.model,
      max_tokens: model.maxTokens,
      temperature: model.temperature,
      messages: [{
        role: 'user',
        content: prompt
      }]
    });
    const content = message.content[0]?.type === 'text' ? message.content[0].text : '';
    const tokensUsed = message.usage.input_tokens + message.usage.output_tokens;
    const cost = this.calculateCost('anthropic', model.model, tokensUsed);
    return {
      content,
      model: model.model,
      tokensUsed,
      cost
    };
  }
  selectModel(taskType) {
    // Select appropriate model based on task type
    switch (taskType) {
      case 'code-generation':
        return {
          provider: 'openai',
          model: 'gpt-4-turbo-preview',
          maxTokens: 4096,
          temperature: 0.2
        };
      case 'refactoring':
        return {
          provider: 'anthropic',
          model: 'claude-3-opus-20240229',
          maxTokens: 4096,
          temperature: 0.1
        };
      case 'explanation':
        return {
          provider: 'openai',
          model: 'gpt-4-turbo-preview',
          maxTokens: 2048,
          temperature: 0.7
        };
      default:
        return {
          provider: 'openai',
          model: 'gpt-4-turbo-preview',
          maxTokens: 4096,
          temperature: 0.3
        };
    }
  }
  buildPrompt(userPrompt, context) {
    let prompt = `# Task\n${userPrompt}\n\n`;

    // Add project context
    if (context.projectInfo.frameworks.length > 0) {
      prompt += `# Project Frameworks\n${context.projectInfo.frameworks.join(', ')}\n\n`;
    }

    // Add relevant files
    if (context.files.length > 0) {
      prompt += `# Relevant Files\n\n`;
      for (const file of context.files) {
        prompt += `## ${file.path}\n\`\`\`\n${file.content}\n\`\`\`\n\n`;
      }
    }

    // Add conventions
    if (context.projectInfo.conventions) {
      prompt += `# Project Conventions\n`;
      prompt += `- Package Manager: ${context.projectInfo.conventions.packageManager}\n`;
      prompt += `- TypeScript: ${context.projectInfo.conventions.typescript ? 'Yes' : 'No'}\n`;
      if (context.projectInfo.conventions.testing.length > 0) {
        prompt += `- Testing: ${context.projectInfo.conventions.testing.join(', ')}\n`;
      }
      prompt += `\n`;
    }
    prompt += `# Instructions\n`;
    prompt += `- Generate clean, production-ready code\n`;
    prompt += `- Follow the project's existing patterns and conventions\n`;
    prompt += `- Include proper error handling\n`;
    prompt += `- Add TypeScript types where applicable\n`;
    prompt += `- Write self-documenting code with clear variable names\n`;
    return prompt;
  }
  async estimateCost(prompt, context) {
    const fullPrompt = this.buildPrompt(prompt, context);
    const estimatedTokens = Math.ceil(fullPrompt.length / 4); // Rough estimate: 1 token â‰ˆ 4 chars
    const model = this.selectModel('code-generation');
    return this.calculateCost(model.provider, model.model, estimatedTokens);
  }
  calculateCost(provider, model, tokens) {
    // Pricing per 1M tokens (as of 2024)
    const pricing = {
      'gpt-4-turbo-preview': {
        input: 10,
        output: 30
      },
      'gpt-4': {
        input: 30,
        output: 60
      },
      'gpt-3.5-turbo': {
        input: 0.5,
        output: 1.5
      },
      'claude-3-opus-20240229': {
        input: 15,
        output: 75
      },
      'claude-3-sonnet-20240229': {
        input: 3,
        output: 15
      }
    };
    const modelPricing = pricing[model] || {
      input: 10,
      output: 30
    };
    // Assume 50/50 split between input and output tokens
    const inputTokens = tokens * 0.5;
    const outputTokens = tokens * 0.5;
    return (inputTokens * modelPricing.input + outputTokens * modelPricing.output) / 1000000;
  }
  getCacheKey(prompt, context) {
    const contextStr = JSON.stringify({
      prompt,
      files: context.files.map(f => f.path),
      frameworks: context.projectInfo.frameworks
    });

    // Simple hash function
    let hash = 0;
    for (let i = 0; i < contextStr.length; i++) {
      const char = contextStr.charCodeAt(i);
      hash = (hash << 5) - hash + char;
      hash = hash & hash;
    }
    return hash.toString(36);
  }
  getCachedResponse(key) {
    const cached = this.cache.get(key);
    if (!cached) return null;

    // Check if cache is still valid
    if (Date.now() - cached.timestamp > this.CACHE_TTL) {
      this.cache.delete(key);
      return null;
    }
    return cached;
  }
  cacheResponse(key, response, model) {
    this.cache.set(key, {
      prompt: key,
      response,
      timestamp: Date.now(),
      model
    });

    // Limit cache size
    if (this.cache.size > 100) {
      const firstKey = this.cache.keys().next().value;
      if (firstKey) {
        this.cache.delete(firstKey);
      }
    }
  }
  getUsageStats() {
    return {
      totalTokens: this.totalTokensUsed,
      totalCost: this.totalCost,
      cacheSize: this.cache.size
    };
  }
  clearCache() {
    this.cache.clear();
  }
}
exports.AIOrchestrator = AIOrchestrator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfb3BlbmFpIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfc2RrIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiQUlPcmNoZXN0cmF0b3IiLCJvcGVuYWkiLCJhbnRocm9waWMiLCJjYWNoZSIsIk1hcCIsIkNBQ0hFX1RUTCIsInRvdGFsVG9rZW5zVXNlZCIsInRvdGFsQ29zdCIsImNvbnN0cnVjdG9yIiwidmFsaWRhdG9yIiwiQ29uc3RpdHV0aW9uYWxWYWxpZGF0b3IiLCJnZXRJbnN0YW5jZSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsIk9wZW5BSSIsImFwaUtleSIsIkFOVEhST1BJQ19BUElfS0VZIiwiQW50aHJvcGljIiwiZ2VuZXJhdGVDb2RlIiwicHJvbXB0IiwiY29udGV4dCIsIm1vZGVsIiwiY2FjaGVLZXkiLCJnZXRDYWNoZUtleSIsImNhY2hlZCIsImdldENhY2hlZFJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsImNvbnRlbnQiLCJyZXNwb25zZSIsInRva2Vuc1VzZWQiLCJjb3N0Iiwic2VsZWN0ZWRNb2RlbCIsInNlbGVjdE1vZGVsIiwiZnVsbFByb21wdCIsImJ1aWxkUHJvbXB0IiwicHJvdmlkZXIiLCJnZW5lcmF0ZVdpdGhPcGVuQUkiLCJnZW5lcmF0ZVdpdGhDbGF1ZGUiLCJldGhpY2FsQW5hbHlzaXMiLCJ2YWxpZGF0ZUNvbnRlbnQiLCJhcHByb3ZlZCIsIndhcm4iLCJjb25jZXJucyIsIkVycm9yIiwiam9pbiIsImNhY2hlUmVzcG9uc2UiLCJjb21wbGV0aW9uIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwibWF4X3Rva2VucyIsIm1heFRva2VucyIsInRlbXBlcmF0dXJlIiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJ1c2FnZSIsInRvdGFsX3Rva2VucyIsImNhbGN1bGF0ZUNvc3QiLCJ0eXBlIiwidGV4dCIsImlucHV0X3Rva2VucyIsIm91dHB1dF90b2tlbnMiLCJ0YXNrVHlwZSIsInVzZXJQcm9tcHQiLCJwcm9qZWN0SW5mbyIsImZyYW1ld29ya3MiLCJsZW5ndGgiLCJmaWxlcyIsImZpbGUiLCJwYXRoIiwiY29udmVudGlvbnMiLCJwYWNrYWdlTWFuYWdlciIsInR5cGVzY3JpcHQiLCJ0ZXN0aW5nIiwiZXN0aW1hdGVDb3N0IiwiZXN0aW1hdGVkVG9rZW5zIiwiTWF0aCIsImNlaWwiLCJ0b2tlbnMiLCJwcmljaW5nIiwiaW5wdXQiLCJvdXRwdXQiLCJtb2RlbFByaWNpbmciLCJpbnB1dFRva2VucyIsIm91dHB1dFRva2VucyIsImNvbnRleHRTdHIiLCJKU09OIiwic3RyaW5naWZ5IiwibWFwIiwiZiIsImhhc2giLCJpIiwiY2hhciIsImNoYXJDb2RlQXQiLCJ0b1N0cmluZyIsImtleSIsImdldCIsIkRhdGUiLCJub3ciLCJ0aW1lc3RhbXAiLCJkZWxldGUiLCJzZXQiLCJzaXplIiwiZmlyc3RLZXkiLCJrZXlzIiwibmV4dCIsInZhbHVlIiwiZ2V0VXNhZ2VTdGF0cyIsInRvdGFsVG9rZW5zIiwiY2FjaGVTaXplIiwiY2xlYXJDYWNoZSIsImNsZWFyIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIkFJT3JjaGVzdHJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPcGVuQUkgZnJvbSAnb3BlbmFpJztcbmltcG9ydCBBbnRocm9waWMgZnJvbSAnQGFudGhyb3BpYy1haS9zZGsnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFJTW9kZWwge1xuICBwcm92aWRlcjogJ29wZW5haScgfCAnYW50aHJvcGljJztcbiAgbW9kZWw6IHN0cmluZztcbiAgbWF4VG9rZW5zOiBudW1iZXI7XG4gIHRlbXBlcmF0dXJlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQUlDb250ZXh0IHtcbiAgZmlsZXM6IEFycmF5PHsgcGF0aDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfT47XG4gIHByb2plY3RJbmZvOiB7XG4gICAgZnJhbWV3b3Jrczogc3RyaW5nW107XG4gICAgY29udmVudGlvbnM6IGFueTtcbiAgfTtcbiAgdXNlclByb21wdDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFJUmVzcG9uc2Uge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIG1vZGVsOiBzdHJpbmc7XG4gIHRva2Vuc1VzZWQ6IG51bWJlcjtcbiAgY29zdDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENhY2hlZFJlc3BvbnNlIHtcbiAgcHJvbXB0OiBzdHJpbmc7XG4gIHJlc3BvbnNlOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBtb2RlbDogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQUlPcmNoZXN0cmF0b3Ige1xuICBwcml2YXRlIG9wZW5haTogT3BlbkFJIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYW50aHJvcGljOiBBbnRocm9waWMgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSB2YWxpZGF0b3I6IENvbnN0aXR1dGlvbmFsVmFsaWRhdG9yO1xuICBwcml2YXRlIGNhY2hlOiBNYXA8c3RyaW5nLCBDYWNoZWRSZXNwb25zZT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgQ0FDSEVfVFRMID0gMzYwMDAwMDsgLy8gMSBob3VyXG4gIHByaXZhdGUgdG90YWxUb2tlbnNVc2VkID0gMDtcbiAgcHJpdmF0ZSB0b3RhbENvc3QgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMudmFsaWRhdG9yID0gQ29uc3RpdHV0aW9uYWxWYWxpZGF0b3IuZ2V0SW5zdGFuY2UoKTtcbiAgICAvLyBJbml0aWFsaXplIGNsaWVudHMgaWYgQVBJIGtleXMgYXJlIGF2YWlsYWJsZVxuICAgIGlmIChwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSkge1xuICAgICAgdGhpcy5vcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgICAgICAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSkge1xuICAgICAgdGhpcy5hbnRocm9waWMgPSBuZXcgQW50aHJvcGljKHtcbiAgICAgICAgYXBpS2V5OiBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdlbmVyYXRlQ29kZShwcm9tcHQ6IHN0cmluZywgY29udGV4dDogQUlDb250ZXh0LCBtb2RlbD86IEFJTW9kZWwpOiBQcm9taXNlPEFJUmVzcG9uc2U+IHtcbiAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5nZXRDYWNoZUtleShwcm9tcHQsIGNvbnRleHQpO1xuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuZ2V0Q2FjaGVkUmVzcG9uc2UoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdVc2luZyBjYWNoZWQgQUkgcmVzcG9uc2UnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnQ6IGNhY2hlZC5yZXNwb25zZSxcbiAgICAgICAgbW9kZWw6IGNhY2hlZC5tb2RlbCxcbiAgICAgICAgdG9rZW5zVXNlZDogMCxcbiAgICAgICAgY29zdDogMCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gU2VsZWN0IG1vZGVsXG4gICAgY29uc3Qgc2VsZWN0ZWRNb2RlbCA9IG1vZGVsIHx8IHRoaXMuc2VsZWN0TW9kZWwoJ2NvZGUtZ2VuZXJhdGlvbicpO1xuXG4gICAgLy8gQnVpbGQgZnVsbCBwcm9tcHQgd2l0aCBjb250ZXh0XG4gICAgY29uc3QgZnVsbFByb21wdCA9IHRoaXMuYnVpbGRQcm9tcHQocHJvbXB0LCBjb250ZXh0KTtcblxuICAgIC8vIEdlbmVyYXRlIHJlc3BvbnNlXG4gICAgbGV0IHJlc3BvbnNlOiBBSVJlc3BvbnNlO1xuICAgIGlmIChzZWxlY3RlZE1vZGVsLnByb3ZpZGVyID09PSAnb3BlbmFpJykge1xuICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdlbmVyYXRlV2l0aE9wZW5BSShmdWxsUHJvbXB0LCBzZWxlY3RlZE1vZGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdlbmVyYXRlV2l0aENsYXVkZShmdWxsUHJvbXB0LCBzZWxlY3RlZE1vZGVsKTtcbiAgICB9XG5cbiAgICAvLyBDT05TVElUVVRJT05BTCBDSEVDSyAoVGhlIENvbnNjaWVuY2UpXG4gICAgY29uc29sZS5sb2coJ1tBSU9yY2hlc3RyYXRvcl0gVmFsaWRhdGluZyBnZW5lcmF0ZWQgY29kZSBhZ2FpbnN0IERpdmluZSBMYXcuLi4nKTtcbiAgICBjb25zdCBldGhpY2FsQW5hbHlzaXMgPSBhd2FpdCB0aGlzLnZhbGlkYXRvci52YWxpZGF0ZUNvbnRlbnQocmVzcG9uc2UuY29udGVudCwgcHJvbXB0KTtcblxuICAgIGlmICghZXRoaWNhbEFuYWx5c2lzLmFwcHJvdmVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1tBSU9yY2hlc3RyYXRvcl0gQ29kZSBnZW5lcmF0aW9uIFZFVE9FRCBieSBDb25zdGl0dXRpb246JywgZXRoaWNhbEFuYWx5c2lzLmNvbmNlcm5zKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ29uc3RpdHV0aW9uYWwgVmlvbGF0aW9uOiAke2V0aGljYWxBbmFseXNpcy5jb25jZXJucy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIC8vIENhY2hlIHJlc3BvbnNlXG4gICAgdGhpcy5jYWNoZVJlc3BvbnNlKGNhY2hlS2V5LCByZXNwb25zZS5jb250ZW50LCByZXNwb25zZS5tb2RlbCk7XG5cbiAgICAvLyBUcmFjayB1c2FnZVxuICAgIHRoaXMudG90YWxUb2tlbnNVc2VkICs9IHJlc3BvbnNlLnRva2Vuc1VzZWQ7XG4gICAgdGhpcy50b3RhbENvc3QgKz0gcmVzcG9uc2UuY29zdDtcblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVXaXRoT3BlbkFJKHByb21wdDogc3RyaW5nLCBtb2RlbDogQUlNb2RlbCk6IFByb21pc2U8QUlSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5vcGVuYWkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignT3BlbkFJIGNsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBzZXQgT1BFTkFJX0FQSV9LRVkuJyk7XG4gICAgfVxuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IHRoaXMub3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBtb2RlbC5tb2RlbCxcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcbiAgICAgICAgICBjb250ZW50OiAnWW91IGFyZSBhbiBleHBlcnQgc29mdHdhcmUgZGV2ZWxvcGVyIGFzc2lzdGFudC4gR2VuZXJhdGUgY2xlYW4sIHByb2R1Y3Rpb24tcmVhZHkgY29kZSBmb2xsb3dpbmcgYmVzdCBwcmFjdGljZXMuJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICBjb250ZW50OiBwcm9tcHQsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgbWF4X3Rva2VuczogbW9kZWwubWF4VG9rZW5zLFxuICAgICAgdGVtcGVyYXR1cmU6IG1vZGVsLnRlbXBlcmF0dXJlLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29udGVudCA9IGNvbXBsZXRpb24uY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudCB8fCAnJztcbiAgICBjb25zdCB0b2tlbnNVc2VkID0gY29tcGxldGlvbi51c2FnZT8udG90YWxfdG9rZW5zIHx8IDA7XG4gICAgY29uc3QgY29zdCA9IHRoaXMuY2FsY3VsYXRlQ29zdCgnb3BlbmFpJywgbW9kZWwubW9kZWwsIHRva2Vuc1VzZWQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRlbnQsXG4gICAgICBtb2RlbDogbW9kZWwubW9kZWwsXG4gICAgICB0b2tlbnNVc2VkLFxuICAgICAgY29zdCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVdpdGhDbGF1ZGUocHJvbXB0OiBzdHJpbmcsIG1vZGVsOiBBSU1vZGVsKTogUHJvbWlzZTxBSVJlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLmFudGhyb3BpYykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbnRocm9waWMgY2xpZW50IG5vdCBpbml0aWFsaXplZC4gUGxlYXNlIHNldCBBTlRIUk9QSUNfQVBJX0tFWS4nKTtcbiAgICB9XG5cbiAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgdGhpcy5hbnRocm9waWMubWVzc2FnZXMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBtb2RlbC5tb2RlbCxcbiAgICAgIG1heF90b2tlbnM6IG1vZGVsLm1heFRva2VucyxcbiAgICAgIHRlbXBlcmF0dXJlOiBtb2RlbC50ZW1wZXJhdHVyZSxcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgY29udGVudDogcHJvbXB0LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBtZXNzYWdlLmNvbnRlbnRbMF0/LnR5cGUgPT09ICd0ZXh0JyA/IG1lc3NhZ2UuY29udGVudFswXS50ZXh0IDogJyc7XG4gICAgY29uc3QgdG9rZW5zVXNlZCA9IG1lc3NhZ2UudXNhZ2UuaW5wdXRfdG9rZW5zICsgbWVzc2FnZS51c2FnZS5vdXRwdXRfdG9rZW5zO1xuICAgIGNvbnN0IGNvc3QgPSB0aGlzLmNhbGN1bGF0ZUNvc3QoJ2FudGhyb3BpYycsIG1vZGVsLm1vZGVsLCB0b2tlbnNVc2VkKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb250ZW50LFxuICAgICAgbW9kZWw6IG1vZGVsLm1vZGVsLFxuICAgICAgdG9rZW5zVXNlZCxcbiAgICAgIGNvc3QsXG4gICAgfTtcbiAgfVxuXG4gIHNlbGVjdE1vZGVsKHRhc2tUeXBlOiBzdHJpbmcpOiBBSU1vZGVsIHtcbiAgICAvLyBTZWxlY3QgYXBwcm9wcmlhdGUgbW9kZWwgYmFzZWQgb24gdGFzayB0eXBlXG4gICAgc3dpdGNoICh0YXNrVHlwZSkge1xuICAgICAgY2FzZSAnY29kZS1nZW5lcmF0aW9uJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXG4gICAgICAgICAgbW9kZWw6ICdncHQtNC10dXJiby1wcmV2aWV3JyxcbiAgICAgICAgICBtYXhUb2tlbnM6IDQwOTYsXG4gICAgICAgICAgdGVtcGVyYXR1cmU6IDAuMixcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ3JlZmFjdG9yaW5nJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwcm92aWRlcjogJ2FudGhyb3BpYycsXG4gICAgICAgICAgbW9kZWw6ICdjbGF1ZGUtMy1vcHVzLTIwMjQwMjI5JyxcbiAgICAgICAgICBtYXhUb2tlbnM6IDQwOTYsXG4gICAgICAgICAgdGVtcGVyYXR1cmU6IDAuMSxcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ2V4cGxhbmF0aW9uJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwcm92aWRlcjogJ29wZW5haScsXG4gICAgICAgICAgbW9kZWw6ICdncHQtNC10dXJiby1wcmV2aWV3JyxcbiAgICAgICAgICBtYXhUb2tlbnM6IDIwNDgsXG4gICAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgfTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcHJvdmlkZXI6ICdvcGVuYWknLFxuICAgICAgICAgIG1vZGVsOiAnZ3B0LTQtdHVyYm8tcHJldmlldycsXG4gICAgICAgICAgbWF4VG9rZW5zOiA0MDk2LFxuICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFByb21wdCh1c2VyUHJvbXB0OiBzdHJpbmcsIGNvbnRleHQ6IEFJQ29udGV4dCk6IHN0cmluZyB7XG4gICAgbGV0IHByb21wdCA9IGAjIFRhc2tcXG4ke3VzZXJQcm9tcHR9XFxuXFxuYDtcblxuICAgIC8vIEFkZCBwcm9qZWN0IGNvbnRleHRcbiAgICBpZiAoY29udGV4dC5wcm9qZWN0SW5mby5mcmFtZXdvcmtzLmxlbmd0aCA+IDApIHtcbiAgICAgIHByb21wdCArPSBgIyBQcm9qZWN0IEZyYW1ld29ya3NcXG4ke2NvbnRleHQucHJvamVjdEluZm8uZnJhbWV3b3Jrcy5qb2luKCcsICcpfVxcblxcbmA7XG4gICAgfVxuXG4gICAgLy8gQWRkIHJlbGV2YW50IGZpbGVzXG4gICAgaWYgKGNvbnRleHQuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgcHJvbXB0ICs9IGAjIFJlbGV2YW50IEZpbGVzXFxuXFxuYDtcbiAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBjb250ZXh0LmZpbGVzKSB7XG4gICAgICAgIHByb21wdCArPSBgIyMgJHtmaWxlLnBhdGh9XFxuXFxgXFxgXFxgXFxuJHtmaWxlLmNvbnRlbnR9XFxuXFxgXFxgXFxgXFxuXFxuYDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgY29udmVudGlvbnNcbiAgICBpZiAoY29udGV4dC5wcm9qZWN0SW5mby5jb252ZW50aW9ucykge1xuICAgICAgcHJvbXB0ICs9IGAjIFByb2plY3QgQ29udmVudGlvbnNcXG5gO1xuICAgICAgcHJvbXB0ICs9IGAtIFBhY2thZ2UgTWFuYWdlcjogJHtjb250ZXh0LnByb2plY3RJbmZvLmNvbnZlbnRpb25zLnBhY2thZ2VNYW5hZ2VyfVxcbmA7XG4gICAgICBwcm9tcHQgKz0gYC0gVHlwZVNjcmlwdDogJHtjb250ZXh0LnByb2plY3RJbmZvLmNvbnZlbnRpb25zLnR5cGVzY3JpcHQgPyAnWWVzJyA6ICdObyd9XFxuYDtcbiAgICAgIGlmIChjb250ZXh0LnByb2plY3RJbmZvLmNvbnZlbnRpb25zLnRlc3RpbmcubGVuZ3RoID4gMCkge1xuICAgICAgICBwcm9tcHQgKz0gYC0gVGVzdGluZzogJHtjb250ZXh0LnByb2plY3RJbmZvLmNvbnZlbnRpb25zLnRlc3Rpbmcuam9pbignLCAnKX1cXG5gO1xuICAgICAgfVxuICAgICAgcHJvbXB0ICs9IGBcXG5gO1xuICAgIH1cblxuICAgIHByb21wdCArPSBgIyBJbnN0cnVjdGlvbnNcXG5gO1xuICAgIHByb21wdCArPSBgLSBHZW5lcmF0ZSBjbGVhbiwgcHJvZHVjdGlvbi1yZWFkeSBjb2RlXFxuYDtcbiAgICBwcm9tcHQgKz0gYC0gRm9sbG93IHRoZSBwcm9qZWN0J3MgZXhpc3RpbmcgcGF0dGVybnMgYW5kIGNvbnZlbnRpb25zXFxuYDtcbiAgICBwcm9tcHQgKz0gYC0gSW5jbHVkZSBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcXG5gO1xuICAgIHByb21wdCArPSBgLSBBZGQgVHlwZVNjcmlwdCB0eXBlcyB3aGVyZSBhcHBsaWNhYmxlXFxuYDtcbiAgICBwcm9tcHQgKz0gYC0gV3JpdGUgc2VsZi1kb2N1bWVudGluZyBjb2RlIHdpdGggY2xlYXIgdmFyaWFibGUgbmFtZXNcXG5gO1xuXG4gICAgcmV0dXJuIHByb21wdDtcbiAgfVxuXG4gIGFzeW5jIGVzdGltYXRlQ29zdChwcm9tcHQ6IHN0cmluZywgY29udGV4dDogQUlDb250ZXh0KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBmdWxsUHJvbXB0ID0gdGhpcy5idWlsZFByb21wdChwcm9tcHQsIGNvbnRleHQpO1xuICAgIGNvbnN0IGVzdGltYXRlZFRva2VucyA9IE1hdGguY2VpbChmdWxsUHJvbXB0Lmxlbmd0aCAvIDQpOyAvLyBSb3VnaCBlc3RpbWF0ZTogMSB0b2tlbiDiiYggNCBjaGFyc1xuICAgIGNvbnN0IG1vZGVsID0gdGhpcy5zZWxlY3RNb2RlbCgnY29kZS1nZW5lcmF0aW9uJyk7XG4gICAgcmV0dXJuIHRoaXMuY2FsY3VsYXRlQ29zdChtb2RlbC5wcm92aWRlciwgbW9kZWwubW9kZWwsIGVzdGltYXRlZFRva2Vucyk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUNvc3QocHJvdmlkZXI6IHN0cmluZywgbW9kZWw6IHN0cmluZywgdG9rZW5zOiBudW1iZXIpOiBudW1iZXIge1xuICAgIC8vIFByaWNpbmcgcGVyIDFNIHRva2VucyAoYXMgb2YgMjAyNClcbiAgICBjb25zdCBwcmljaW5nOiBSZWNvcmQ8c3RyaW5nLCB7IGlucHV0OiBudW1iZXI7IG91dHB1dDogbnVtYmVyIH0+ID0ge1xuICAgICAgJ2dwdC00LXR1cmJvLXByZXZpZXcnOiB7IGlucHV0OiAxMCwgb3V0cHV0OiAzMCB9LFxuICAgICAgJ2dwdC00JzogeyBpbnB1dDogMzAsIG91dHB1dDogNjAgfSxcbiAgICAgICdncHQtMy41LXR1cmJvJzogeyBpbnB1dDogMC41LCBvdXRwdXQ6IDEuNSB9LFxuICAgICAgJ2NsYXVkZS0zLW9wdXMtMjAyNDAyMjknOiB7IGlucHV0OiAxNSwgb3V0cHV0OiA3NSB9LFxuICAgICAgJ2NsYXVkZS0zLXNvbm5ldC0yMDI0MDIyOSc6IHsgaW5wdXQ6IDMsIG91dHB1dDogMTUgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9kZWxQcmljaW5nID0gcHJpY2luZ1ttb2RlbF0gfHwgeyBpbnB1dDogMTAsIG91dHB1dDogMzAgfTtcbiAgICAvLyBBc3N1bWUgNTAvNTAgc3BsaXQgYmV0d2VlbiBpbnB1dCBhbmQgb3V0cHV0IHRva2Vuc1xuICAgIGNvbnN0IGlucHV0VG9rZW5zID0gdG9rZW5zICogMC41O1xuICAgIGNvbnN0IG91dHB1dFRva2VucyA9IHRva2VucyAqIDAuNTtcbiAgICBcbiAgICByZXR1cm4gKGlucHV0VG9rZW5zICogbW9kZWxQcmljaW5nLmlucHV0ICsgb3V0cHV0VG9rZW5zICogbW9kZWxQcmljaW5nLm91dHB1dCkgLyAxMDAwMDAwO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDYWNoZUtleShwcm9tcHQ6IHN0cmluZywgY29udGV4dDogQUlDb250ZXh0KTogc3RyaW5nIHtcbiAgICBjb25zdCBjb250ZXh0U3RyID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgcHJvbXB0LFxuICAgICAgZmlsZXM6IGNvbnRleHQuZmlsZXMubWFwKGYgPT4gZi5wYXRoKSxcbiAgICAgIGZyYW1ld29ya3M6IGNvbnRleHQucHJvamVjdEluZm8uZnJhbWV3b3JrcyxcbiAgICB9KTtcbiAgICBcbiAgICAvLyBTaW1wbGUgaGFzaCBmdW5jdGlvblxuICAgIGxldCBoYXNoID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRleHRTdHIubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNoYXIgPSBjb250ZXh0U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaGFyO1xuICAgICAgaGFzaCA9IGhhc2ggJiBoYXNoO1xuICAgIH1cbiAgICByZXR1cm4gaGFzaC50b1N0cmluZygzNik7XG4gIH1cblxuICBnZXRDYWNoZWRSZXNwb25zZShrZXk6IHN0cmluZyk6IENhY2hlZFJlc3BvbnNlIHwgbnVsbCB7XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICBpZiAoIWNhY2hlZCkgcmV0dXJuIG51bGw7XG5cbiAgICAvLyBDaGVjayBpZiBjYWNoZSBpcyBzdGlsbCB2YWxpZFxuICAgIGlmIChEYXRlLm5vdygpIC0gY2FjaGVkLnRpbWVzdGFtcCA+IHRoaXMuQ0FDSEVfVFRMKSB7XG4gICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNhY2hlZDtcbiAgfVxuXG4gIGNhY2hlUmVzcG9uc2Uoa2V5OiBzdHJpbmcsIHJlc3BvbnNlOiBzdHJpbmcsIG1vZGVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLnNldChrZXksIHtcbiAgICAgIHByb21wdDoga2V5LFxuICAgICAgcmVzcG9uc2UsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBtb2RlbCxcbiAgICB9KTtcblxuICAgIC8vIExpbWl0IGNhY2hlIHNpemVcbiAgICBpZiAodGhpcy5jYWNoZS5zaXplID4gMTAwKSB7XG4gICAgICBjb25zdCBmaXJzdEtleSA9IHRoaXMuY2FjaGUua2V5cygpLm5leHQoKS52YWx1ZSBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAoZmlyc3RLZXkpIHtcbiAgICAgICAgdGhpcy5jYWNoZS5kZWxldGUoZmlyc3RLZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldFVzYWdlU3RhdHMoKTogeyB0b3RhbFRva2VuczogbnVtYmVyOyB0b3RhbENvc3Q6IG51bWJlcjsgY2FjaGVTaXplOiBudW1iZXIgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsVG9rZW5zOiB0aGlzLnRvdGFsVG9rZW5zVXNlZCxcbiAgICAgIHRvdGFsQ29zdDogdGhpcy50b3RhbENvc3QsXG4gICAgICBjYWNoZVNpemU6IHRoaXMuY2FjaGUuc2l6ZSxcbiAgICB9O1xuICB9XG5cbiAgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsSUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQTBDLFNBQUFELHVCQUFBRyxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBO0FBZ0NuQyxNQUFNRyxjQUFjLENBQUM7RUFDbEJDLE1BQU0sR0FBa0IsSUFBSTtFQUM1QkMsU0FBUyxHQUFxQixJQUFJO0VBRWxDQyxLQUFLLEdBQWdDLElBQUlDLEdBQUcsQ0FBQyxDQUFDO0VBQ3JDQyxTQUFTLEdBQUcsT0FBTyxDQUFDLENBQUM7RUFDOUJDLGVBQWUsR0FBRyxDQUFD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