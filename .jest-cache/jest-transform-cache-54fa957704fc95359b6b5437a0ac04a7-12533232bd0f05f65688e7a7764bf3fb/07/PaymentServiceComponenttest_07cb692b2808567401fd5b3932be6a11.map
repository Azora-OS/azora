{"version":3,"names":["_PaymentServiceComponent","require","describe","paymentComponent","outputDir","beforeEach","PaymentServiceComponent","it","config","name","port","changes","generatePaymentService","expect","toBeInstanceOf","Array","length","toBeGreaterThan","filePaths","map","c","path","toContain","stringContaining","enableSubscriptions","stripeFile","find","includes","toBeDefined","content","enableRefunds","controllerFile","webhookFile","serviceFile","subscriptionFile","schemaFile","validationFile","packageFile","packageJson","JSON","parse","dependencies","toHaveProperty","readmeFile"],"sources":["PaymentServiceComponent.test.ts"],"sourcesContent":["import { PaymentServiceComponent, PaymentServiceConfig } from '../PaymentServiceComponent';\n\ndescribe('PaymentServiceComponent', () => {\n  let paymentComponent: PaymentServiceComponent;\n  const outputDir = '/test/output';\n\n  beforeEach(() => {\n    paymentComponent = new PaymentServiceComponent();\n  });\n\n  describe('generatePaymentService', () => {\n    it('should generate basic payment service files', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        port: 3002,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n\n      expect(changes).toBeInstanceOf(Array);\n      expect(changes.length).toBeGreaterThan(0);\n\n      const filePaths = changes.map(c => c.path);\n      expect(filePaths).toContain(expect.stringContaining('index.ts'));\n      expect(filePaths).toContain(expect.stringContaining('payment.controller.ts'));\n      expect(filePaths).toContain(expect.stringContaining('webhook.controller.ts'));\n      expect(filePaths).toContain(expect.stringContaining('stripe.service.ts'));\n      expect(filePaths).toContain(expect.stringContaining('payment.service.ts'));\n      expect(filePaths).toContain(expect.stringContaining('payment.repository.ts'));\n      expect(filePaths).toContain(expect.stringContaining('schema.prisma'));\n    });\n\n    it('should include subscription service when enabled', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableSubscriptions: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const filePaths = changes.map(c => c.path);\n      \n      expect(filePaths).toContain(expect.stringContaining('subscription.service.ts'));\n    });\n\n    it('should generate Stripe integration', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const stripeFile = changes.find(c => c.path.includes('stripe.service.ts'));\n\n      expect(stripeFile).toBeDefined();\n      expect(stripeFile!.content).toContain('createPaymentIntent');\n      expect(stripeFile!.content).toContain('confirmPaymentIntent');\n      expect(stripeFile!.content).toContain('constructWebhookEvent');\n    });\n\n    it('should include refund functionality when enabled', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableRefunds: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const stripeFile = changes.find(c => c.path.includes('stripe.service.ts'));\n      const controllerFile = changes.find(c => c.path.includes('payment.controller.ts'));\n\n      expect(stripeFile!.content).toContain('createRefund');\n      expect(controllerFile!.content).toContain('refundPayment');\n    });\n\n    it('should generate webhook handling', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableSubscriptions: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const webhookFile = changes.find(c => c.path.includes('webhook.controller.ts'));\n\n      expect(webhookFile).toBeDefined();\n      expect(webhookFile!.content).toContain('handleStripeWebhook');\n      expect(webhookFile!.content).toContain('payment_intent.succeeded');\n      expect(webhookFile!.content).toContain('customer.subscription.created');\n    });\n\n    it('should generate payment processing logic', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const serviceFile = changes.find(c => c.path.includes('payment.service.ts'));\n\n      expect(serviceFile).toBeDefined();\n      expect(serviceFile!.content).toContain('createPaymentIntent');\n      expect(serviceFile!.content).toContain('confirmPayment');\n      expect(serviceFile!.content).toContain('handlePaymentSuccess');\n      expect(serviceFile!.content).toContain('handlePaymentFailure');\n    });\n\n    it('should generate subscription management when enabled', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableSubscriptions: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const subscriptionFile = changes.find(c => c.path.includes('subscription.service.ts'));\n\n      expect(subscriptionFile).toBeDefined();\n      expect(subscriptionFile!.content).toContain('createSubscription');\n      expect(subscriptionFile!.content).toContain('cancelSubscription');\n      expect(subscriptionFile!.content).toContain('listUserSubscriptions');\n    });\n\n    it('should generate Prisma schema with Payment model', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const schemaFile = changes.find(c => c.path.includes('schema.prisma'));\n\n      expect(schemaFile).toBeDefined();\n      expect(schemaFile!.content).toContain('model Payment');\n      expect(schemaFile!.content).toContain('stripePaymentIntentId');\n      expect(schemaFile!.content).toContain('amount');\n      expect(schemaFile!.content).toContain('status');\n    });\n\n    it('should include subscription models when enabled', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableSubscriptions: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const schemaFile = changes.find(c => c.path.includes('schema.prisma'));\n\n      expect(schemaFile).toBeDefined();\n      expect(schemaFile!.content).toContain('model Customer');\n      expect(schemaFile!.content).toContain('model Subscription');\n    });\n\n    it('should generate validation schemas', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableRefunds: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const validationFile = changes.find(c => c.path.includes('payment.schemas.ts'));\n\n      expect(validationFile).toBeDefined();\n      expect(validationFile!.content).toContain('createIntent');\n      expect(validationFile!.content).toContain('confirmPayment');\n      expect(validationFile!.content).toContain('refund');\n    });\n\n    it('should generate package.json with Stripe dependency', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const packageFile = changes.find(c => c.path.includes('package.json'));\n\n      expect(packageFile).toBeDefined();\n      const packageJson = JSON.parse(packageFile!.content);\n      \n      expect(packageJson.dependencies).toHaveProperty('stripe');\n      expect(packageJson.dependencies).toHaveProperty('@prisma/client');\n    });\n\n    it('should generate README with webhook setup instructions', () => {\n      const config: PaymentServiceConfig = {\n        name: 'test-payment',\n        enableSubscriptions: true,\n      };\n\n      const changes = paymentComponent.generatePaymentService(config, outputDir);\n      const readmeFile = changes.find(c => c.path.includes('README.md'));\n\n      expect(readmeFile).toBeDefined();\n      expect(readmeFile!.content).toContain('Payment Service');\n      expect(readmeFile!.content).toContain('Stripe webhook');\n      expect(readmeFile!.content).toContain('/api/payments/intent');\n    });\n  });\n});\n"],"mappings":"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","ignoreList":[]}