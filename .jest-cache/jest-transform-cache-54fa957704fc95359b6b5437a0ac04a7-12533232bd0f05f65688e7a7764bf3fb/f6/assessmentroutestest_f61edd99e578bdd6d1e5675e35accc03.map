{"version":3,"names":["_getJestObj","mock","_supertest","_interopRequireDefault","require","_express","_assessment","_assessment2","e","__esModule","default","jest","app","express","use","json","assessmentRoutes","describe","beforeEach","clearAllMocks","it","submissionData","enrollmentId","answers","timeSpent","mockResult","score","passed","feedback","outcome","id","courseId","moduleId","assessmentScore","conceptMastery","completedAt","Date","assessmentService","submitAssessment","mockResolvedValue","response","request","post","send","expect","status","toBe","body","success","data","mockRejectedValue","Error","mockResults","assessment","title","questions","passingScore","submissions","averageScore","passRate","getAssessmentResults","get","mockHistory","assessments","totalAttempts","passedCount","getStudentAssessmentHistory"],"sources":["assessment.routes.test.ts"],"sourcesContent":["import request from 'supertest';\r\nimport express from 'express';\r\nimport assessmentRoutes from '../assessment.routes';\r\nimport { assessmentService } from '../../services/assessment.service';\r\n\r\njest.mock('../../services/assessment.service');\r\n\r\nconst app = express();\r\napp.use(express.json());\r\napp.use('/api/v1/assessments', assessmentRoutes);\r\n\r\ndescribe('Assessment Routes', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('POST /api/v1/assessments/:id/submit', () => {\r\n    it('should submit an assessment and return score', async () => {\r\n      const submissionData = {\r\n        enrollmentId: 'enrollment-1',\r\n        answers: ['answer1', 'answer2', 'answer3'],\r\n        timeSpent: 1200,\r\n      };\r\n\r\n      const mockResult = {\r\n        score: 100,\r\n        passed: true,\r\n        feedback: 'Congratulations! You passed with a score of 100%.',\r\n        outcome: {\r\n          id: 'outcome-1',\r\n          enrollmentId: 'enrollment-1',\r\n          courseId: 'course-1',\r\n          moduleId: 'module-1',\r\n          assessmentScore: 100,\r\n          timeSpent: 1200,\r\n          conceptMastery: 100,\r\n          completedAt: new Date(),\r\n        },\r\n      };\r\n\r\n      (assessmentService.submitAssessment as jest.Mock).mockResolvedValue(mockResult);\r\n\r\n      const response = await request(app)\r\n        .post('/api/v1/assessments/assessment-1/submit')\r\n        .send(submissionData);\r\n\r\n      expect(response.status).toBe(201);\r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.score).toBe(100);\r\n      expect(response.body.data.passed).toBe(true);\r\n    });\r\n\r\n    it('should handle failed assessment submission', async () => {\r\n      const submissionData = {\r\n        enrollmentId: 'enrollment-1',\r\n        answers: ['answer1'],\r\n        timeSpent: 600,\r\n      };\r\n\r\n      const mockResult = {\r\n        score: 50,\r\n        passed: false,\r\n        feedback: 'You scored 50%. You need 70% to pass. Try again!',\r\n        outcome: {\r\n          id: 'outcome-1',\r\n          enrollmentId: 'enrollment-1',\r\n          courseId: 'course-1',\r\n          moduleId: 'module-1',\r\n          assessmentScore: 50,\r\n          timeSpent: 600,\r\n          conceptMastery: 50,\r\n          completedAt: new Date(),\r\n        },\r\n      };\r\n\r\n      (assessmentService.submitAssessment as jest.Mock).mockResolvedValue(mockResult);\r\n\r\n      const response = await request(app)\r\n        .post('/api/v1/assessments/assessment-1/submit')\r\n        .send(submissionData);\r\n\r\n      expect(response.status).toBe(201);\r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.score).toBe(50);\r\n      expect(response.body.data.passed).toBe(false);\r\n    });\r\n\r\n    it('should handle validation errors', async () => {\r\n      (assessmentService.submitAssessment as jest.Mock).mockRejectedValue(\r\n        new Error('Validation error: enrollmentId is required')\r\n      );\r\n\r\n      const response = await request(app)\r\n        .post('/api/v1/assessments/assessment-1/submit')\r\n        .send({ answers: ['answer1'] });\r\n\r\n      expect(response.status).toBe(500);\r\n    });\r\n  });\r\n\r\n  describe('GET /api/v1/assessments/:id/results', () => {\r\n    it('should get assessment results', async () => {\r\n      const mockResults = {\r\n        assessment: {\r\n          id: 'assessment-1',\r\n          courseId: 'course-1',\r\n          moduleId: 'module-1',\r\n          title: 'Quiz 1',\r\n          questions: ['Q1', 'Q2', 'Q3'],\r\n          passingScore: 70,\r\n        },\r\n        submissions: [\r\n          {\r\n            id: 'outcome-1',\r\n            assessmentScore: 100,\r\n            timeSpent: 1200,\r\n          },\r\n          {\r\n            id: 'outcome-2',\r\n            assessmentScore: 85,\r\n            timeSpent: 1500,\r\n          },\r\n        ],\r\n        averageScore: 92.5,\r\n        passRate: 100,\r\n      };\r\n\r\n      (assessmentService.getAssessmentResults as jest.Mock).mockResolvedValue(mockResults);\r\n\r\n      const response = await request(app).get('/api/v1/assessments/assessment-1/results');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.averageScore).toBe(92.5);\r\n      expect(response.body.data.passRate).toBe(100);\r\n    });\r\n\r\n    it('should handle assessment not found', async () => {\r\n      (assessmentService.getAssessmentResults as jest.Mock).mockRejectedValue(\r\n        new Error('Assessment not found')\r\n      );\r\n\r\n      const response = await request(app).get('/api/v1/assessments/non-existent/results');\r\n\r\n      expect(response.status).toBe(500);\r\n    });\r\n  });\r\n\r\n  describe('GET /api/v1/assessments/student/:studentId/history', () => {\r\n    it('should get student assessment history', async () => {\r\n      const mockHistory = {\r\n        assessments: [\r\n          {\r\n            id: 'outcome-1',\r\n            enrollmentId: 'enrollment-1',\r\n            courseId: 'course-1',\r\n            moduleId: 'module-1',\r\n            assessmentScore: 100,\r\n            timeSpent: 1200,\r\n            conceptMastery: 100,\r\n            completedAt: new Date(),\r\n          },\r\n          {\r\n            id: 'outcome-2',\r\n            enrollmentId: 'enrollment-2',\r\n            courseId: 'course-2',\r\n            moduleId: 'module-2',\r\n            assessmentScore: 85,\r\n            timeSpent: 1500,\r\n            conceptMastery: 85,\r\n            completedAt: new Date(),\r\n          },\r\n        ],\r\n        totalAttempts: 2,\r\n        averageScore: 92.5,\r\n        passedCount: 2,\r\n      };\r\n\r\n      (assessmentService.getStudentAssessmentHistory as jest.Mock).mockResolvedValue(mockHistory);\r\n\r\n      const response = await request(app).get('/api/v1/assessments/student/student-1/history');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.totalAttempts).toBe(2);\r\n      expect(response.body.data.averageScore).toBe(92.5);\r\n      expect(response.body.data.passedCount).toBe(2);\r\n    });\r\n\r\n    it('should return empty history for new student', async () => {\r\n      const mockHistory = {\r\n        assessments: [],\r\n        totalAttempts: 0,\r\n        averageScore: 0,\r\n        passedCount: 0,\r\n      };\r\n\r\n      (assessmentService.getStudentAssessmentHistory as jest.Mock).mockResolvedValue(mockHistory);\r\n\r\n      const response = await request(app).get('/api/v1/assessments/student/new-student/history');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.totalAttempts).toBe(0);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}