5205d9073949a4c0eef20d0d155f1f92
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PreviewGenerator = void 0;
var fs = _interopRequireWildcard(require("fs"));
var path = _interopRequireWildcard(require("path"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
/**
 * PreviewGenerator captures before/after screenshots of components
 * when design filters are applied
 */
class PreviewGenerator {
  defaultViewports = [{
    name: 'desktop',
    width: 1920,
    height: 1080
  }, {
    name: 'tablet',
    width: 768,
    height: 1024
  }, {
    name: 'mobile',
    width: 375,
    height: 667
  }];
  constructor(projectRoot) {
    this.projectRoot = projectRoot;
    this.previewDir = path.join(projectRoot, '.azstudio', 'previews');
    this.ensurePreviewDirectory();
  }

  /**
   * Ensure preview directory exists
   */
  ensurePreviewDirectory() {
    if (!fs.existsSync(this.previewDir)) {
      fs.mkdirSync(this.previewDir, {
        recursive: true
      });
    }
  }

  /**
   * Generate before/after preview for design filter application
   */
  async generateFilterPreview(filter, components, options = {}) {
    const {
      maxComponents = 10,
      viewports = this.defaultViewports,
      outputDir = this.previewDir,
      includeMetadata = true
    } = options;
    console.log(`Generating preview for filter: ${filter.name}`);
    console.log(`Components to preview: ${Math.min(components.length, maxComponents)}`);

    // Create filter-specific directory
    const filterDir = path.join(outputDir, this.sanitizeFileName(filter.name));
    if (!fs.existsSync(filterDir)) {
      fs.mkdirSync(filterDir, {
        recursive: true
      });
    }
    const previews = [];
    const componentsToPreview = components.slice(0, maxComponents);
    for (const component of componentsToPreview) {
      try {
        const preview = await this.generateComponentPreview(component, filter, filterDir, viewports);
        previews.push(preview);
      } catch (error) {
        console.warn(`Failed to generate preview for ${component.componentName}:`, error);
      }
    }
    const comparison = {
      filterName: filter.name,
      componentsAffected: components.length,
      previews,
      timestamp: new Date(),
      approved: false
    };

    // Save comparison metadata
    if (includeMetadata) {
      await this.saveComparisonMetadata(comparison, filterDir);
    }

    // Generate HTML comparison view
    await this.generateComparisonHTML(comparison, filterDir);
    console.log(`Preview generated at: ${filterDir}`);
    return comparison;
  }

  /**
   * Generate preview for a single component
   */
  async generateComponentPreview(component, filter, outputDir, viewports) {
    const componentDir = path.join(outputDir, this.sanitizeFileName(component.componentName));
    if (!fs.existsSync(componentDir)) {
      fs.mkdirSync(componentDir, {
        recursive: true
      });
    }

    // Capture before screenshot
    const beforeScreenshot = await this.captureComponentScreenshot(component, 'before', componentDir, viewports[0] // Use desktop viewport by default
    );

    // Simulate after state (in real implementation, this would apply the filter temporarily)
    const afterScreenshot = await this.captureComponentScreenshot(component, 'after', componentDir, viewports[0]);

    // Extract changes from component
    const changes = this.extractChanges(component, filter);
    return {
      componentPath: component.filePath,
      componentName: component.componentName,
      before: beforeScreenshot,
      after: afterScreenshot,
      changes
    };
  }

  /**
   * Capture screenshot of a component
   * Note: This is a placeholder implementation. In production, this would:
   * 1. Start a dev server or use existing one
   * 2. Use Playwright/Puppeteer to render the component
   * 3. Capture actual screenshots
   */
  async captureComponentScreenshot(component, stage, outputDir, viewport) {
    const timestamp = new Date();
    const fileName = `${stage}-${viewport.name}-${timestamp.getTime()}.png`;
    const imagePath = path.join(outputDir, fileName);

    // Placeholder: Create a metadata file instead of actual screenshot
    // In production, this would use Playwright to capture real screenshots
    const placeholderData = {
      component: component.componentName,
      stage,
      viewport: viewport.name,
      timestamp: timestamp.toISOString(),
      note: 'Placeholder - actual screenshot would be captured here'
    };

    // Write placeholder metadata
    const metadataPath = imagePath.replace('.png', '.json');
    await fs.promises.writeFile(metadataPath, JSON.stringify(placeholderData, null, 2), 'utf-8');

    // Create a simple placeholder image file (empty file for now)
    await fs.promises.writeFile(imagePath, '', 'utf-8');
    return {
      componentPath: component.filePath,
      componentName: component.componentName,
      imagePath,
      timestamp,
      metadata: {
        width: viewport.width,
        height: viewport.height,
        viewport: viewport.name
      }
    };
  }

  /**
   * Extract changes that will be applied to component
   */
  extractChanges(component, filter) {
    const changes = [];

    // Check class transformations
    for (const className of component.classNames) {
      for (const [oldClass, newClass] of Object.entries(filter.classTransforms)) {
        if (className.includes(oldClass)) {
          changes.push(`Class: ${oldClass} → ${newClass}`);
        }
      }
    }

    // Check token updates
    if (filter.tokens.colors) {
      changes.push('Colors: Updated to new palette');
    }
    if (filter.tokens.borderRadius) {
      changes.push('Border Radius: Updated to new scale');
    }
    if (filter.tokens.shadows) {
      changes.push('Shadows: Updated to new elevation');
    }

    // Check inline styles
    if (component.hasInlineStyles) {
      changes.push(`Inline Styles: ${component.inlineStyles.length} styles to convert`);
    }

    // Check CSS modules
    if (component.hasCSSModule) {
      changes.push('CSS Module: Will be updated with new tokens');
    }
    return changes;
  }

  /**
   * Save comparison metadata to JSON file
   */
  async saveComparisonMetadata(comparison, outputDir) {
    const metadataPath = path.join(outputDir, 'comparison-metadata.json');
    const metadata = {
      filterName: comparison.filterName,
      componentsAffected: comparison.componentsAffected,
      previewsGenerated: comparison.previews.length,
      timestamp: comparison.timestamp.toISOString(),
      approved: comparison.approved,
      previews: comparison.previews.map(p => ({
        componentName: p.componentName,
        componentPath: p.componentPath,
        changes: p.changes,
        beforeImage: path.relative(outputDir, p.before.imagePath),
        afterImage: path.relative(outputDir, p.after.imagePath)
      }))
    };
    await fs.promises.writeFile(metadataPath, JSON.stringify(metadata, null, 2), 'utf-8');
  }

  /**
   * Generate HTML comparison view
   */
  async generateComparisonHTML(comparison, outputDir) {
    const htmlPath = path.join(outputDir, 'comparison.html');
    const html = this.buildComparisonHTML(comparison, outputDir);
    await fs.promises.writeFile(htmlPath, html, 'utf-8');
  }

  /**
   * Build HTML for comparison view
   */
  buildComparisonHTML(comparison, baseDir) {
    const previewsHTML = comparison.previews.map(preview => {
      const beforePath = path.relative(baseDir, preview.before.imagePath);
      const afterPath = path.relative(baseDir, preview.after.imagePath);
      const changesHTML = preview.changes.map(change => `<li>${this.escapeHtml(change)}</li>`).join('');
      return `
          <div class="component-preview">
            <h3>${this.escapeHtml(preview.componentName)}</h3>
            <p class="component-path">${this.escapeHtml(preview.componentPath)}</p>
            
            <div class="comparison-container">
              <div class="screenshot-container">
                <h4>Before</h4>
                <div class="screenshot-placeholder">
                  <p>Screenshot: ${beforePath}</p>
                  <p class="note">Actual screenshot would be displayed here</p>
                </div>
              </div>
              
              <div class="screenshot-container">
                <h4>After</h4>
                <div class="screenshot-placeholder">
                  <p>Screenshot: ${afterPath}</p>
                  <p class="note">Actual screenshot would be displayed here</p>
                </div>
              </div>
            </div>
            
            <div class="changes">
              <h4>Changes Applied</h4>
              <ul>${changesHTML}</ul>
            </div>
          </div>
        `;
    }).join('');
    return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Filter Preview: ${this.escapeHtml(comparison.filterName)}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 2rem;
      color: #333;
    }
    
    .header {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #1a1a1a;
    }
    
    .header .meta {
      color: #666;
      font-size: 0.9rem;
    }
    
    .actions {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-approve {
      background: #22c55e;
      color: white;
    }
    
    .btn-approve:hover {
      background: #16a34a;
    }
    
    .btn-reject {
      background: #ef4444;
      color: white;
    }
    
    .btn-reject:hover {
      background: #dc2626;
    }
    
    .component-preview {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .component-preview h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #1a1a1a;
    }
    
    .component-path {
      color: #666;
      font-size: 0.85rem;
      margin-bottom: 1.5rem;
      font-family: monospace;
    }
    
    .comparison-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }
    
    .screenshot-container h4 {
      font-size: 1rem;
      margin-bottom: 0.75rem;
      color: #555;
    }
    
    .screenshot-placeholder {
      background: #f9f9f9;
      border: 2px dashed #ddd;
      border-radius: 6px;
      padding: 3rem 2rem;
      text-align: center;
      color: #999;
    }
    
    .screenshot-placeholder .note {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      font-style: italic;
    }
    
    .changes {
      border-top: 1px solid #eee;
      padding-top: 1.5rem;
    }
    
    .changes h4 {
      font-size: 1rem;
      margin-bottom: 0.75rem;
      color: #555;
    }
    
    .changes ul {
      list-style: none;
      padding-left: 0;
    }
    
    .changes li {
      padding: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
    }
    
    .changes li:before {
      content: '→';
      position: absolute;
      left: 0;
      color: #3b82f6;
      font-weight: bold;
    }
    
    @media (max-width: 768px) {
      .comparison-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Design Filter Preview: ${this.escapeHtml(comparison.filterName)}</h1>
    <div class="meta">
      <p>Generated: ${comparison.timestamp.toLocaleString()}</p>
      <p>Components Affected: ${comparison.componentsAffected}</p>
      <p>Previews Generated: ${comparison.previews.length}</p>
    </div>
    <div class="actions">
      <button class="btn btn-approve" onclick="approveChanges()">
        ✓ Approve Changes
      </button>
      <button class="btn btn-reject" onclick="rejectChanges()">
        ✗ Reject Changes
      </button>
    </div>
  </div>
  
  ${previewsHTML}
  
  <script>
    function approveChanges() {
      if (confirm('Approve and apply all design filter changes?')) {
        alert('Changes approved! The design filter will be applied.');
        // In production, this would trigger IPC to apply changes
      }
    }
    
    function rejectChanges() {
      if (confirm('Reject all design filter changes?')) {
        alert('Changes rejected. No modifications will be made.');
        // In production, this would trigger IPC to cancel
      }
    }
  </script>
</body>
</html>
    `.trim();
  }

  /**
   * Escape HTML special characters
   */
  escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  /**
   * Sanitize file name
   */
  sanitizeFileName(name) {
    return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
  }

  /**
   * Load existing comparison
   */
  async loadComparison(filterName) {
    const filterDir = path.join(this.previewDir, this.sanitizeFileName(filterName));
    const metadataPath = path.join(filterDir, 'comparison-metadata.json');
    if (!fs.existsSync(metadataPath)) {
      return null;
    }
    try {
      const content = await fs.promises.readFile(metadataPath, 'utf-8');
      const metadata = JSON.parse(content);
      return {
        filterName: metadata.filterName,
        componentsAffected: metadata.componentsAffected,
        previews: [],
        // Would need to reconstruct from metadata
        timestamp: new Date(metadata.timestamp),
        approved: metadata.approved
      };
    } catch (error) {
      console.error('Failed to load comparison:', error);
      return null;
    }
  }

  /**
   * Approve comparison and mark for application
   */
  async approveComparison(filterName) {
    const comparison = await this.loadComparison(filterName);
    if (!comparison) {
      return false;
    }
    comparison.approved = true;
    const filterDir = path.join(this.previewDir, this.sanitizeFileName(filterName));
    await this.saveComparisonMetadata(comparison, filterDir);
    return true;
  }

  /**
   * Reject comparison and clean up
   */
  async rejectComparison(filterName) {
    const filterDir = path.join(this.previewDir, this.sanitizeFileName(filterName));
    if (!fs.existsSync(filterDir)) {
      return false;
    }

    // Mark as rejected in metadata
    const comparison = await this.loadComparison(filterName);
    if (comparison) {
      comparison.approved = false;
      await this.saveComparisonMetadata(comparison, filterDir);
    }
    return true;
  }

  /**
   * Clean up old previews
   */
  async cleanupOldPreviews(daysOld = 7) {
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - daysOld);
    let cleaned = 0;
    const entries = await fs.promises.readdir(this.previewDir, {
      withFileTypes: true
    });
    for (const entry of entries) {
      if (entry.isDirectory()) {
        const dirPath = path.join(this.previewDir, entry.name);
        const metadataPath = path.join(dirPath, 'comparison-metadata.json');
        if (fs.existsSync(metadataPath)) {
          try {
            const content = await fs.promises.readFile(metadataPath, 'utf-8');
            const metadata = JSON.parse(content);
            const timestamp = new Date(metadata.timestamp);
            if (timestamp < cutoffDate) {
              await fs.promises.rm(dirPath, {
                recursive: true,
                force: true
              });
              cleaned++;
            }
          } catch (error) {
            console.warn(`Failed to process ${dirPath}:`, error);
          }
        }
      }
    }
    return cleaned;
  }

  /**
   * Get all available previews
   */
  async listPreviews() {
    const previews = [];
    if (!fs.existsSync(this.previewDir)) {
      return previews;
    }
    const entries = await fs.promises.readdir(this.previewDir, {
      withFileTypes: true
    });
    for (const entry of entries) {
      if (entry.isDirectory()) {
        const comparison = await this.loadComparison(entry.name);
        if (comparison) {
          previews.push({
            filterName: comparison.filterName,
            timestamp: comparison.timestamp,
            approved: comparison.approved
          });
        }
      }
    }
    return previews.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());
  }
}
exports.PreviewGenerator = PreviewGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsInBhdGgiLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJQcmV2aWV3R2VuZXJhdG9yIiwiZGVmYXVsdFZpZXdwb3J0cyIsIm5hbWUiLCJ3aWR0aCIsImhlaWdodCIsImNvbnN0cnVjdG9yIiwicHJvamVjdFJvb3QiLCJwcmV2aWV3RGlyIiwiam9pbiIsImVuc3VyZVByZXZpZXdEaXJlY3RvcnkiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwiZ2VuZXJhdGVGaWx0ZXJQcmV2aWV3IiwiZmlsdGVyIiwiY29tcG9uZW50cyIsIm9wdGlvbnMiLCJtYXhDb21wb25lbnRzIiwidmlld3BvcnRzIiwib3V0cHV0RGlyIiwiaW5jbHVkZU1ldGFkYXRhIiwiY29uc29sZSIsImxvZyIsIk1hdGgiLCJtaW4iLCJsZW5ndGgiLCJmaWx0ZXJEaXIiLCJzYW5pdGl6ZUZpbGVOYW1lIiwicHJldmlld3MiLCJjb21wb25lbnRzVG9QcmV2aWV3Iiwic2xpY2UiLCJjb21wb25lbnQiLCJwcmV2aWV3IiwiZ2VuZXJhdGVDb21wb25lbnRQcmV2aWV3IiwicHVzaCIsImVycm9yIiwid2FybiIsImNvbXBvbmVudE5hbWUiLCJjb21wYXJpc29uIiwiZmlsdGVyTmFtZSIsImNvbXBvbmVudHNBZmZlY3RlZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJhcHByb3ZlZCIsInNhdmVDb21wYXJpc29uTWV0YWRhdGEiLCJnZW5lcmF0ZUNvbXBhcmlzb25IVE1MIiwiY29tcG9uZW50RGlyIiwiYmVmb3JlU2NyZWVuc2hvdCIsImNhcHR1cmVDb21wb25lbnRTY3JlZW5zaG90IiwiYWZ0ZXJTY3JlZW5zaG90IiwiY2hhbmdlcyIsImV4dHJhY3RDaGFuZ2VzIiwiY29tcG9uZW50UGF0aCIsImZpbGVQYXRoIiwiYmVmb3JlIiwiYWZ0ZXIiLCJzdGFnZSIsInZpZXdwb3J0IiwiZmlsZU5hbWUiLCJnZXRUaW1lIiwiaW1hZ2VQYXRoIiwicGxhY2Vob2xkZXJEYXRhIiwidG9JU09TdHJpbmciLCJub3RlIiwibWV0YWRhdGFQYXRoIiwicmVwbGFjZSIsInByb21pc2VzIiwid3JpdGVGaWxlIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGFkYXRhIiwiY2xhc3NOYW1lIiwiY2xhc3NOYW1lcyIsIm9sZENsYXNzIiwibmV3Q2xhc3MiLCJlbnRyaWVzIiwiY2xhc3NUcmFuc2Zvcm1zIiwiaW5jbHVkZXMiLCJ0b2tlbnMiLCJjb2xvcnMiLCJib3JkZXJSYWRpdXMiLCJzaGFkb3dzIiwiaGFzSW5saW5lU3R5bGVzIiwiaW5saW5lU3R5bGVzIiwiaGFzQ1NTTW9kdWxlIiwicHJldmlld3NHZW5lcmF0ZWQiLCJtYXAiLCJwIiwiYmVmb3JlSW1hZ2UiLCJyZWxhdGl2ZSIsImFmdGVySW1hZ2UiLCJodG1sUGF0aCIsImh0bWwiLCJidWlsZENvbXBhcmlzb25IVE1MIiwiYmFzZURpciIsInByZXZpZXdzSFRNTCIsImJlZm9yZVBhdGgiLCJhZnRlclBhdGgiLCJjaGFuZ2VzSFRNTCIsImNoYW5nZSIsImVzY2FwZUh0bWwiLCJ0b0xvY2FsZVN0cmluZyIsInRyaW0iLCJ0ZXh0IiwibSIsInRvTG93ZXJDYXNlIiwibG9hZENvbXBhcmlzb24iLCJjb250ZW50IiwicmVhZEZpbGUiLCJwYXJzZSIsImFwcHJvdmVDb21wYXJpc29uIiwicmVqZWN0Q29tcGFyaXNvbiIsImNsZWFudXBPbGRQcmV2aWV3cyIsImRheXNPbGQiLCJjdXRvZmZEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJjbGVhbmVkIiwicmVhZGRpciIsIndpdGhGaWxlVHlwZXMiLCJlbnRyeSIsImlzRGlyZWN0b3J5IiwiZGlyUGF0aCIsInJtIiwiZm9yY2UiLCJsaXN0UHJldmlld3MiLCJzb3J0IiwiYSIsImIiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiUHJldmlld0dlbmVyYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRGVzaWduRmlsdGVyIH0gZnJvbSAnLi9EZXNpZ25GaWx0ZXJFbmdpbmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50U3R5bGVJbmZvIH0gZnJvbSAnLi9Db21wb25lbnRTdHlsZVJlZmFjdG9yJztcblxuZXhwb3J0IGludGVyZmFjZSBTY3JlZW5zaG90IHtcbiAgY29tcG9uZW50UGF0aDogc3RyaW5nO1xuICBjb21wb25lbnROYW1lOiBzdHJpbmc7XG4gIGltYWdlUGF0aDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIG1ldGFkYXRhOiB7XG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBoZWlnaHQ6IG51bWJlcjtcbiAgICB2aWV3cG9ydDogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudFByZXZpZXcge1xuICBjb21wb25lbnRQYXRoOiBzdHJpbmc7XG4gIGNvbXBvbmVudE5hbWU6IHN0cmluZztcbiAgYmVmb3JlOiBTY3JlZW5zaG90O1xuICBhZnRlcjogU2NyZWVuc2hvdDtcbiAgY2hhbmdlczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJldmlld0NvbXBhcmlzb24ge1xuICBmaWx0ZXJOYW1lOiBzdHJpbmc7XG4gIGNvbXBvbmVudHNBZmZlY3RlZDogbnVtYmVyO1xuICBwcmV2aWV3czogQ29tcG9uZW50UHJldmlld1tdO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGFwcHJvdmVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByZXZpZXdPcHRpb25zIHtcbiAgbWF4Q29tcG9uZW50cz86IG51bWJlcjtcbiAgdmlld3BvcnRzPzogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH0+O1xuICBvdXRwdXREaXI/OiBzdHJpbmc7XG4gIGluY2x1ZGVNZXRhZGF0YT86IGJvb2xlYW47XG59XG5cbi8qKlxuICogUHJldmlld0dlbmVyYXRvciBjYXB0dXJlcyBiZWZvcmUvYWZ0ZXIgc2NyZWVuc2hvdHMgb2YgY29tcG9uZW50c1xuICogd2hlbiBkZXNpZ24gZmlsdGVycyBhcmUgYXBwbGllZFxuICovXG5leHBvcnQgY2xhc3MgUHJldmlld0dlbmVyYXRvciB7XG4gIHByaXZhdGUgcHJvamVjdFJvb3Q6IHN0cmluZztcbiAgcHJpdmF0ZSBwcmV2aWV3RGlyOiBzdHJpbmc7XG4gIHByaXZhdGUgZGVmYXVsdFZpZXdwb3J0cyA9IFtcbiAgICB7IG5hbWU6ICdkZXNrdG9wJywgd2lkdGg6IDE5MjAsIGhlaWdodDogMTA4MCB9LFxuICAgIHsgbmFtZTogJ3RhYmxldCcsIHdpZHRoOiA3NjgsIGhlaWdodDogMTAyNCB9LFxuICAgIHsgbmFtZTogJ21vYmlsZScsIHdpZHRoOiAzNzUsIGhlaWdodDogNjY3IH0sXG4gIF07XG5cbiAgY29uc3RydWN0b3IocHJvamVjdFJvb3Q6IHN0cmluZykge1xuICAgIHRoaXMucHJvamVjdFJvb3QgPSBwcm9qZWN0Um9vdDtcbiAgICB0aGlzLnByZXZpZXdEaXIgPSBwYXRoLmpvaW4ocHJvamVjdFJvb3QsICcuYXpzdHVkaW8nLCAncHJldmlld3MnKTtcbiAgICB0aGlzLmVuc3VyZVByZXZpZXdEaXJlY3RvcnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmUgcHJldmlldyBkaXJlY3RvcnkgZXhpc3RzXG4gICAqL1xuICBwcml2YXRlIGVuc3VyZVByZXZpZXdEaXJlY3RvcnkoKTogdm9pZCB7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHRoaXMucHJldmlld0RpcikpIHtcbiAgICAgIGZzLm1rZGlyU3luYyh0aGlzLnByZXZpZXdEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBiZWZvcmUvYWZ0ZXIgcHJldmlldyBmb3IgZGVzaWduIGZpbHRlciBhcHBsaWNhdGlvblxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVGaWx0ZXJQcmV2aWV3KFxuICAgIGZpbHRlcjogRGVzaWduRmlsdGVyLFxuICAgIGNvbXBvbmVudHM6IENvbXBvbmVudFN0eWxlSW5mb1tdLFxuICAgIG9wdGlvbnM6IFByZXZpZXdPcHRpb25zID0ge31cbiAgKTogUHJvbWlzZTxQcmV2aWV3Q29tcGFyaXNvbj4ge1xuICAgIGNvbnN0IHtcbiAgICAgIG1heENvbXBvbmVudHMgPSAxMCxcbiAgICAgIHZpZXdwb3J0cyA9IHRoaXMuZGVmYXVsdFZpZXdwb3J0cyxcbiAgICAgIG91dHB1dERpciA9IHRoaXMucHJldmlld0RpcixcbiAgICAgIGluY2x1ZGVNZXRhZGF0YSA9IHRydWUsXG4gICAgfSA9IG9wdGlvbnM7XG5cbiAgICBjb25zb2xlLmxvZyhgR2VuZXJhdGluZyBwcmV2aWV3IGZvciBmaWx0ZXI6ICR7ZmlsdGVyLm5hbWV9YCk7XG4gICAgY29uc29sZS5sb2coYENvbXBvbmVudHMgdG8gcHJldmlldzogJHtNYXRoLm1pbihjb21wb25lbnRzLmxlbmd0aCwgbWF4Q29tcG9uZW50cyl9YCk7XG5cbiAgICAvLyBDcmVhdGUgZmlsdGVyLXNwZWNpZmljIGRpcmVjdG9yeVxuICAgIGNvbnN0IGZpbHRlckRpciA9IHBhdGguam9pbihvdXRwdXREaXIsIHRoaXMuc2FuaXRpemVGaWxlTmFtZShmaWx0ZXIubmFtZSkpO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWx0ZXJEaXIpKSB7XG4gICAgICBmcy5ta2RpclN5bmMoZmlsdGVyRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBwcmV2aWV3czogQ29tcG9uZW50UHJldmlld1tdID0gW107XG4gICAgY29uc3QgY29tcG9uZW50c1RvUHJldmlldyA9IGNvbXBvbmVudHMuc2xpY2UoMCwgbWF4Q29tcG9uZW50cyk7XG5cbiAgICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBjb21wb25lbnRzVG9QcmV2aWV3KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwcmV2aWV3ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUNvbXBvbmVudFByZXZpZXcoXG4gICAgICAgICAgY29tcG9uZW50LFxuICAgICAgICAgIGZpbHRlcixcbiAgICAgICAgICBmaWx0ZXJEaXIsXG4gICAgICAgICAgdmlld3BvcnRzXG4gICAgICAgICk7XG4gICAgICAgIHByZXZpZXdzLnB1c2gocHJldmlldyk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byBnZW5lcmF0ZSBwcmV2aWV3IGZvciAke2NvbXBvbmVudC5jb21wb25lbnROYW1lfTpgLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgY29tcGFyaXNvbjogUHJldmlld0NvbXBhcmlzb24gPSB7XG4gICAgICBmaWx0ZXJOYW1lOiBmaWx0ZXIubmFtZSxcbiAgICAgIGNvbXBvbmVudHNBZmZlY3RlZDogY29tcG9uZW50cy5sZW5ndGgsXG4gICAgICBwcmV2aWV3cyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGFwcHJvdmVkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgLy8gU2F2ZSBjb21wYXJpc29uIG1ldGFkYXRhXG4gICAgaWYgKGluY2x1ZGVNZXRhZGF0YSkge1xuICAgICAgYXdhaXQgdGhpcy5zYXZlQ29tcGFyaXNvbk1ldGFkYXRhKGNvbXBhcmlzb24sIGZpbHRlckRpcik7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgSFRNTCBjb21wYXJpc29uIHZpZXdcbiAgICBhd2FpdCB0aGlzLmdlbmVyYXRlQ29tcGFyaXNvbkhUTUwoY29tcGFyaXNvbiwgZmlsdGVyRGlyKTtcblxuICAgIGNvbnNvbGUubG9nKGBQcmV2aWV3IGdlbmVyYXRlZCBhdDogJHtmaWx0ZXJEaXJ9YCk7XG4gICAgcmV0dXJuIGNvbXBhcmlzb247XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgcHJldmlldyBmb3IgYSBzaW5nbGUgY29tcG9uZW50XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlQ29tcG9uZW50UHJldmlldyhcbiAgICBjb21wb25lbnQ6IENvbXBvbmVudFN0eWxlSW5mbyxcbiAgICBmaWx0ZXI6IERlc2lnbkZpbHRlcixcbiAgICBvdXRwdXREaXI6IHN0cmluZyxcbiAgICB2aWV3cG9ydHM6IEFycmF5PHsgbmFtZTogc3RyaW5nOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9PlxuICApOiBQcm9taXNlPENvbXBvbmVudFByZXZpZXc+IHtcbiAgICBjb25zdCBjb21wb25lbnREaXIgPSBwYXRoLmpvaW4oXG4gICAgICBvdXRwdXREaXIsXG4gICAgICB0aGlzLnNhbml0aXplRmlsZU5hbWUoY29tcG9uZW50LmNvbXBvbmVudE5hbWUpXG4gICAgKTtcbiAgICBcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoY29tcG9uZW50RGlyKSkge1xuICAgICAgZnMubWtkaXJTeW5jKGNvbXBvbmVudERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2FwdHVyZSBiZWZvcmUgc2NyZWVuc2hvdFxuICAgIGNvbnN0IGJlZm9yZVNjcmVlbnNob3QgPSBhd2FpdCB0aGlzLmNhcHR1cmVDb21wb25lbnRTY3JlZW5zaG90KFxuICAgICAgY29tcG9uZW50LFxuICAgICAgJ2JlZm9yZScsXG4gICAgICBjb21wb25lbnREaXIsXG4gICAgICB2aWV3cG9ydHNbMF0gLy8gVXNlIGRlc2t0b3Agdmlld3BvcnQgYnkgZGVmYXVsdFxuICAgICk7XG5cbiAgICAvLyBTaW11bGF0ZSBhZnRlciBzdGF0ZSAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBhcHBseSB0aGUgZmlsdGVyIHRlbXBvcmFyaWx5KVxuICAgIGNvbnN0IGFmdGVyU2NyZWVuc2hvdCA9IGF3YWl0IHRoaXMuY2FwdHVyZUNvbXBvbmVudFNjcmVlbnNob3QoXG4gICAgICBjb21wb25lbnQsXG4gICAgICAnYWZ0ZXInLFxuICAgICAgY29tcG9uZW50RGlyLFxuICAgICAgdmlld3BvcnRzWzBdXG4gICAgKTtcblxuICAgIC8vIEV4dHJhY3QgY2hhbmdlcyBmcm9tIGNvbXBvbmVudFxuICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLmV4dHJhY3RDaGFuZ2VzKGNvbXBvbmVudCwgZmlsdGVyKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb21wb25lbnRQYXRoOiBjb21wb25lbnQuZmlsZVBhdGgsXG4gICAgICBjb21wb25lbnROYW1lOiBjb21wb25lbnQuY29tcG9uZW50TmFtZSxcbiAgICAgIGJlZm9yZTogYmVmb3JlU2NyZWVuc2hvdCxcbiAgICAgIGFmdGVyOiBhZnRlclNjcmVlbnNob3QsXG4gICAgICBjaGFuZ2VzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2FwdHVyZSBzY3JlZW5zaG90IG9mIGEgY29tcG9uZW50XG4gICAqIE5vdGU6IFRoaXMgaXMgYSBwbGFjZWhvbGRlciBpbXBsZW1lbnRhdGlvbi4gSW4gcHJvZHVjdGlvbiwgdGhpcyB3b3VsZDpcbiAgICogMS4gU3RhcnQgYSBkZXYgc2VydmVyIG9yIHVzZSBleGlzdGluZyBvbmVcbiAgICogMi4gVXNlIFBsYXl3cmlnaHQvUHVwcGV0ZWVyIHRvIHJlbmRlciB0aGUgY29tcG9uZW50XG4gICAqIDMuIENhcHR1cmUgYWN0dWFsIHNjcmVlbnNob3RzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNhcHR1cmVDb21wb25lbnRTY3JlZW5zaG90KFxuICAgIGNvbXBvbmVudDogQ29tcG9uZW50U3R5bGVJbmZvLFxuICAgIHN0YWdlOiAnYmVmb3JlJyB8ICdhZnRlcicsXG4gICAgb3V0cHV0RGlyOiBzdHJpbmcsXG4gICAgdmlld3BvcnQ6IHsgbmFtZTogc3RyaW5nOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9XG4gICk6IFByb21pc2U8U2NyZWVuc2hvdD4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZmlsZU5hbWUgPSBgJHtzdGFnZX0tJHt2aWV3cG9ydC5uYW1lfS0ke3RpbWVzdGFtcC5nZXRUaW1lKCl9LnBuZ2A7XG4gICAgY29uc3QgaW1hZ2VQYXRoID0gcGF0aC5qb2luKG91dHB1dERpciwgZmlsZU5hbWUpO1xuXG4gICAgLy8gUGxhY2Vob2xkZXI6IENyZWF0ZSBhIG1ldGFkYXRhIGZpbGUgaW5zdGVhZCBvZiBhY3R1YWwgc2NyZWVuc2hvdFxuICAgIC8vIEluIHByb2R1Y3Rpb24sIHRoaXMgd291bGQgdXNlIFBsYXl3cmlnaHQgdG8gY2FwdHVyZSByZWFsIHNjcmVlbnNob3RzXG4gICAgY29uc3QgcGxhY2Vob2xkZXJEYXRhID0ge1xuICAgICAgY29tcG9uZW50OiBjb21wb25lbnQuY29tcG9uZW50TmFtZSxcbiAgICAgIHN0YWdlLFxuICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0Lm5hbWUsXG4gICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0lTT1N0cmluZygpLFxuICAgICAgbm90ZTogJ1BsYWNlaG9sZGVyIC0gYWN0dWFsIHNjcmVlbnNob3Qgd291bGQgYmUgY2FwdHVyZWQgaGVyZScsXG4gICAgfTtcblxuICAgIC8vIFdyaXRlIHBsYWNlaG9sZGVyIG1ldGFkYXRhXG4gICAgY29uc3QgbWV0YWRhdGFQYXRoID0gaW1hZ2VQYXRoLnJlcGxhY2UoJy5wbmcnLCAnLmpzb24nKTtcbiAgICBhd2FpdCBmcy5wcm9taXNlcy53cml0ZUZpbGUoXG4gICAgICBtZXRhZGF0YVBhdGgsXG4gICAgICBKU09OLnN0cmluZ2lmeShwbGFjZWhvbGRlckRhdGEsIG51bGwsIDIpLFxuICAgICAgJ3V0Zi04J1xuICAgICk7XG5cbiAgICAvLyBDcmVhdGUgYSBzaW1wbGUgcGxhY2Vob2xkZXIgaW1hZ2UgZmlsZSAoZW1wdHkgZmlsZSBmb3Igbm93KVxuICAgIGF3YWl0IGZzLnByb21pc2VzLndyaXRlRmlsZShpbWFnZVBhdGgsICcnLCAndXRmLTgnKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb21wb25lbnRQYXRoOiBjb21wb25lbnQuZmlsZVBhdGgsXG4gICAgICBjb21wb25lbnROYW1lOiBjb21wb25lbnQuY29tcG9uZW50TmFtZSxcbiAgICAgIGltYWdlUGF0aCxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHdpZHRoOiB2aWV3cG9ydC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB2aWV3cG9ydC5oZWlnaHQsXG4gICAgICAgIHZpZXdwb3J0OiB2aWV3cG9ydC5uYW1lLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgY2hhbmdlcyB0aGF0IHdpbGwgYmUgYXBwbGllZCB0byBjb21wb25lbnRcbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdENoYW5nZXMoXG4gICAgY29tcG9uZW50OiBDb21wb25lbnRTdHlsZUluZm8sXG4gICAgZmlsdGVyOiBEZXNpZ25GaWx0ZXJcbiAgKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGNoYW5nZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBDaGVjayBjbGFzcyB0cmFuc2Zvcm1hdGlvbnNcbiAgICBmb3IgKGNvbnN0IGNsYXNzTmFtZSBvZiBjb21wb25lbnQuY2xhc3NOYW1lcykge1xuICAgICAgZm9yIChjb25zdCBbb2xkQ2xhc3MsIG5ld0NsYXNzXSBvZiBPYmplY3QuZW50cmllcyhmaWx0ZXIuY2xhc3NUcmFuc2Zvcm1zKSkge1xuICAgICAgICBpZiAoY2xhc3NOYW1lLmluY2x1ZGVzKG9sZENsYXNzKSkge1xuICAgICAgICAgIGNoYW5nZXMucHVzaChgQ2xhc3M6ICR7b2xkQ2xhc3N9IOKGkiAke25ld0NsYXNzfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgdG9rZW4gdXBkYXRlc1xuICAgIGlmIChmaWx0ZXIudG9rZW5zLmNvbG9ycykge1xuICAgICAgY2hhbmdlcy5wdXNoKCdDb2xvcnM6IFVwZGF0ZWQgdG8gbmV3IHBhbGV0dGUnKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVyLnRva2Vucy5ib3JkZXJSYWRpdXMpIHtcbiAgICAgIGNoYW5nZXMucHVzaCgnQm9yZGVyIFJhZGl1czogVXBkYXRlZCB0byBuZXcgc2NhbGUnKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVyLnRva2Vucy5zaGFkb3dzKSB7XG4gICAgICBjaGFuZ2VzLnB1c2goJ1NoYWRvd3M6IFVwZGF0ZWQgdG8gbmV3IGVsZXZhdGlvbicpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlubGluZSBzdHlsZXNcbiAgICBpZiAoY29tcG9uZW50Lmhhc0lubGluZVN0eWxlcykge1xuICAgICAgY2hhbmdlcy5wdXNoKGBJbmxpbmUgU3R5bGVzOiAke2NvbXBvbmVudC5pbmxpbmVTdHlsZXMubGVuZ3RofSBzdHlsZXMgdG8gY29udmVydGApO1xuICAgIH1cblxuICAgIC8vIENoZWNrIENTUyBtb2R1bGVzXG4gICAgaWYgKGNvbXBvbmVudC5oYXNDU1NNb2R1bGUpIHtcbiAgICAgIGNoYW5nZXMucHVzaCgnQ1NTIE1vZHVsZTogV2lsbCBiZSB1cGRhdGVkIHdpdGggbmV3IHRva2VucycpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGFuZ2VzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNhdmUgY29tcGFyaXNvbiBtZXRhZGF0YSB0byBKU09OIGZpbGVcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2F2ZUNvbXBhcmlzb25NZXRhZGF0YShcbiAgICBjb21wYXJpc29uOiBQcmV2aWV3Q29tcGFyaXNvbixcbiAgICBvdXRwdXREaXI6IHN0cmluZ1xuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBtZXRhZGF0YVBhdGggPSBwYXRoLmpvaW4ob3V0cHV0RGlyLCAnY29tcGFyaXNvbi1tZXRhZGF0YS5qc29uJyk7XG4gICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICBmaWx0ZXJOYW1lOiBjb21wYXJpc29uLmZpbHRlck5hbWUsXG4gICAgICBjb21wb25lbnRzQWZmZWN0ZWQ6IGNvbXBhcmlzb24uY29tcG9uZW50c0FmZmVjdGVkLFxuICAgICAgcHJldmlld3NHZW5lcmF0ZWQ6IGNvbXBhcmlzb24ucHJldmlld3MubGVuZ3RoLFxuICAgICAgdGltZXN0YW1wOiBjb21wYXJpc29uLnRpbWVzdGFtcC50b0lTT1N0cmluZygpLFxuICAgICAgYXBwcm92ZWQ6IGNvbXBhcmlzb24uYXBwcm92ZWQsXG4gICAgICBwcmV2aWV3czogY29tcGFyaXNvbi5wcmV2aWV3cy5tYXAocCA9PiAoe1xuICAgICAgICBjb21wb25lbnROYW1lOiBwLmNvbXBvbmVudE5hbWUsXG4gICAgICAgIGNvbXBvbmVudFBhdGg6IHAuY29tcG9uZW50UGF0aCxcbiAgICAgICAgY2hhbmdlczogcC5jaGFuZ2VzLFxuICAgICAgICBiZWZvcmVJbWFnZTogcGF0aC5yZWxhdGl2ZShvdXRwdXREaXIsIHAuYmVmb3JlLmltYWdlUGF0aCksXG4gICAgICAgIGFmdGVySW1hZ2U6IHBhdGgucmVsYXRpdmUob3V0cHV0RGlyLCBwLmFmdGVyLmltYWdlUGF0aCksXG4gICAgICB9KSksXG4gICAgfTtcblxuICAgIGF3YWl0IGZzLnByb21pc2VzLndyaXRlRmlsZShcbiAgICAgIG1ldGFkYXRhUGF0aCxcbiAgICAgIEpTT04uc3RyaW5naWZ5KG1ldGFkYXRhLCBudWxsLCAyKSxcbiAgICAgICd1dGYtOCdcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIEhUTUwgY29tcGFyaXNvbiB2aWV3XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlQ29tcGFyaXNvbkhUTUwoXG4gICAgY29tcGFyaXNvbjogUHJldmlld0NvbXBhcmlzb24sXG4gICAgb3V0cHV0RGlyOiBzdHJpbmdcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgaHRtbFBhdGggPSBwYXRoLmpvaW4ob3V0cHV0RGlyLCAnY29tcGFyaXNvbi5odG1sJyk7XG4gICAgY29uc3QgaHRtbCA9IHRoaXMuYnVpbGRDb21wYXJpc29uSFRNTChjb21wYXJpc29uLCBvdXRwdXREaXIpO1xuICAgIGF3YWl0IGZzLnByb21pc2VzLndyaXRlRmlsZShodG1sUGF0aCwgaHRtbCwgJ3V0Zi04Jyk7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgSFRNTCBmb3IgY29tcGFyaXNvbiB2aWV3XG4gICAqL1xuICBwcml2YXRlIGJ1aWxkQ29tcGFyaXNvbkhUTUwoXG4gICAgY29tcGFyaXNvbjogUHJldmlld0NvbXBhcmlzb24sXG4gICAgYmFzZURpcjogc3RyaW5nXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgcHJldmlld3NIVE1MID0gY29tcGFyaXNvbi5wcmV2aWV3c1xuICAgICAgLm1hcChwcmV2aWV3ID0+IHtcbiAgICAgICAgY29uc3QgYmVmb3JlUGF0aCA9IHBhdGgucmVsYXRpdmUoYmFzZURpciwgcHJldmlldy5iZWZvcmUuaW1hZ2VQYXRoKTtcbiAgICAgICAgY29uc3QgYWZ0ZXJQYXRoID0gcGF0aC5yZWxhdGl2ZShiYXNlRGlyLCBwcmV2aWV3LmFmdGVyLmltYWdlUGF0aCk7XG4gICAgICAgIGNvbnN0IGNoYW5nZXNIVE1MID0gcHJldmlldy5jaGFuZ2VzXG4gICAgICAgICAgLm1hcChjaGFuZ2UgPT4gYDxsaT4ke3RoaXMuZXNjYXBlSHRtbChjaGFuZ2UpfTwvbGk+YClcbiAgICAgICAgICAuam9pbignJyk7XG5cbiAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29tcG9uZW50LXByZXZpZXdcIj5cbiAgICAgICAgICAgIDxoMz4ke3RoaXMuZXNjYXBlSHRtbChwcmV2aWV3LmNvbXBvbmVudE5hbWUpfTwvaDM+XG4gICAgICAgICAgICA8cCBjbGFzcz1cImNvbXBvbmVudC1wYXRoXCI+JHt0aGlzLmVzY2FwZUh0bWwocHJldmlldy5jb21wb25lbnRQYXRoKX08L3A+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb21wYXJpc29uLWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2NyZWVuc2hvdC1jb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICA8aDQ+QmVmb3JlPC9oND5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2NyZWVuc2hvdC1wbGFjZWhvbGRlclwiPlxuICAgICAgICAgICAgICAgICAgPHA+U2NyZWVuc2hvdDogJHtiZWZvcmVQYXRofTwvcD5cbiAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwibm90ZVwiPkFjdHVhbCBzY3JlZW5zaG90IHdvdWxkIGJlIGRpc3BsYXllZCBoZXJlPC9wPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzY3JlZW5zaG90LWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgICAgIDxoND5BZnRlcjwvaDQ+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNjcmVlbnNob3QtcGxhY2Vob2xkZXJcIj5cbiAgICAgICAgICAgICAgICAgIDxwPlNjcmVlbnNob3Q6ICR7YWZ0ZXJQYXRofTwvcD5cbiAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwibm90ZVwiPkFjdHVhbCBzY3JlZW5zaG90IHdvdWxkIGJlIGRpc3BsYXllZCBoZXJlPC9wPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhbmdlc1wiPlxuICAgICAgICAgICAgICA8aDQ+Q2hhbmdlcyBBcHBsaWVkPC9oND5cbiAgICAgICAgICAgICAgPHVsPiR7Y2hhbmdlc0hUTUx9PC91bD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCcnKTtcblxuICAgIHJldHVybiBgXG48IURPQ1RZUEUgaHRtbD5cbjxodG1sIGxhbmc9XCJlblwiPlxuPGhlYWQ+XG4gIDxtZXRhIGNoYXJzZXQ9XCJVVEYtOFwiPlxuICA8bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwid2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMFwiPlxuICA8dGl0bGU+RGVzaWduIEZpbHRlciBQcmV2aWV3OiAke3RoaXMuZXNjYXBlSHRtbChjb21wYXJpc29uLmZpbHRlck5hbWUpfTwvdGl0bGU+XG4gIDxzdHlsZT5cbiAgICAqIHtcbiAgICAgIG1hcmdpbjogMDtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgIH1cbiAgICBcbiAgICBib2R5IHtcbiAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgc2Fucy1zZXJpZjtcbiAgICAgIGJhY2tncm91bmQ6ICNmNWY1ZjU7XG4gICAgICBwYWRkaW5nOiAycmVtO1xuICAgICAgY29sb3I6ICMzMzM7XG4gICAgfVxuICAgIFxuICAgIC5oZWFkZXIge1xuICAgICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgICBwYWRkaW5nOiAycmVtO1xuICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgbWFyZ2luLWJvdHRvbTogMnJlbTtcbiAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7XG4gICAgfVxuICAgIFxuICAgIC5oZWFkZXIgaDEge1xuICAgICAgZm9udC1zaXplOiAycmVtO1xuICAgICAgbWFyZ2luLWJvdHRvbTogMC41cmVtO1xuICAgICAgY29sb3I6ICMxYTFhMWE7XG4gICAgfVxuICAgIFxuICAgIC5oZWFkZXIgLm1ldGEge1xuICAgICAgY29sb3I6ICM2NjY7XG4gICAgICBmb250LXNpemU6IDAuOXJlbTtcbiAgICB9XG4gICAgXG4gICAgLmFjdGlvbnMge1xuICAgICAgbWFyZ2luLXRvcDogMXJlbTtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBnYXA6IDFyZW07XG4gICAgfVxuICAgIFxuICAgIC5idG4ge1xuICAgICAgcGFkZGluZzogMC43NXJlbSAxLjVyZW07XG4gICAgICBib3JkZXI6IG5vbmU7XG4gICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICBmb250LXNpemU6IDFyZW07XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICBmb250LXdlaWdodDogNTAwO1xuICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7XG4gICAgfVxuICAgIFxuICAgIC5idG4tYXBwcm92ZSB7XG4gICAgICBiYWNrZ3JvdW5kOiAjMjJjNTVlO1xuICAgICAgY29sb3I6IHdoaXRlO1xuICAgIH1cbiAgICBcbiAgICAuYnRuLWFwcHJvdmU6aG92ZXIge1xuICAgICAgYmFja2dyb3VuZDogIzE2YTM0YTtcbiAgICB9XG4gICAgXG4gICAgLmJ0bi1yZWplY3Qge1xuICAgICAgYmFja2dyb3VuZDogI2VmNDQ0NDtcbiAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICB9XG4gICAgXG4gICAgLmJ0bi1yZWplY3Q6aG92ZXIge1xuICAgICAgYmFja2dyb3VuZDogI2RjMjYyNjtcbiAgICB9XG4gICAgXG4gICAgLmNvbXBvbmVudC1wcmV2aWV3IHtcbiAgICAgIGJhY2tncm91bmQ6IHdoaXRlO1xuICAgICAgcGFkZGluZzogMnJlbTtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDhweDtcbiAgICAgIG1hcmdpbi1ib3R0b206IDJyZW07XG4gICAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpO1xuICAgIH1cbiAgICBcbiAgICAuY29tcG9uZW50LXByZXZpZXcgaDMge1xuICAgICAgZm9udC1zaXplOiAxLjVyZW07XG4gICAgICBtYXJnaW4tYm90dG9tOiAwLjVyZW07XG4gICAgICBjb2xvcjogIzFhMWExYTtcbiAgICB9XG4gICAgXG4gICAgLmNvbXBvbmVudC1wYXRoIHtcbiAgICAgIGNvbG9yOiAjNjY2O1xuICAgICAgZm9udC1zaXplOiAwLjg1cmVtO1xuICAgICAgbWFyZ2luLWJvdHRvbTogMS41cmVtO1xuICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbiAgICB9XG4gICAgXG4gICAgLmNvbXBhcmlzb24tY29udGFpbmVyIHtcbiAgICAgIGRpc3BsYXk6IGdyaWQ7XG4gICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7XG4gICAgICBnYXA6IDJyZW07XG4gICAgICBtYXJnaW4tYm90dG9tOiAxLjVyZW07XG4gICAgfVxuICAgIFxuICAgIC5zY3JlZW5zaG90LWNvbnRhaW5lciBoNCB7XG4gICAgICBmb250LXNpemU6IDFyZW07XG4gICAgICBtYXJnaW4tYm90dG9tOiAwLjc1cmVtO1xuICAgICAgY29sb3I6ICM1NTU7XG4gICAgfVxuICAgIFxuICAgIC5zY3JlZW5zaG90LXBsYWNlaG9sZGVyIHtcbiAgICAgIGJhY2tncm91bmQ6ICNmOWY5Zjk7XG4gICAgICBib3JkZXI6IDJweCBkYXNoZWQgI2RkZDtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgIHBhZGRpbmc6IDNyZW0gMnJlbTtcbiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIGNvbG9yOiAjOTk5O1xuICAgIH1cbiAgICBcbiAgICAuc2NyZWVuc2hvdC1wbGFjZWhvbGRlciAubm90ZSB7XG4gICAgICBtYXJnaW4tdG9wOiAwLjVyZW07XG4gICAgICBmb250LXNpemU6IDAuODVyZW07XG4gICAgICBmb250LXN0eWxlOiBpdGFsaWM7XG4gICAgfVxuICAgIFxuICAgIC5jaGFuZ2VzIHtcbiAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWVlO1xuICAgICAgcGFkZGluZy10b3A6IDEuNXJlbTtcbiAgICB9XG4gICAgXG4gICAgLmNoYW5nZXMgaDQge1xuICAgICAgZm9udC1zaXplOiAxcmVtO1xuICAgICAgbWFyZ2luLWJvdHRvbTogMC43NXJlbTtcbiAgICAgIGNvbG9yOiAjNTU1O1xuICAgIH1cbiAgICBcbiAgICAuY2hhbmdlcyB1bCB7XG4gICAgICBsaXN0LXN0eWxlOiBub25lO1xuICAgICAgcGFkZGluZy1sZWZ0OiAwO1xuICAgIH1cbiAgICBcbiAgICAuY2hhbmdlcyBsaSB7XG4gICAgICBwYWRkaW5nOiAwLjVyZW0gMDtcbiAgICAgIHBhZGRpbmctbGVmdDogMS41cmVtO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIH1cbiAgICBcbiAgICAuY2hhbmdlcyBsaTpiZWZvcmUge1xuICAgICAgY29udGVudDogJ+KGkic7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBsZWZ0OiAwO1xuICAgICAgY29sb3I6ICMzYjgyZjY7XG4gICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICB9XG4gICAgXG4gICAgQG1lZGlhIChtYXgtd2lkdGg6IDc2OHB4KSB7XG4gICAgICAuY29tcGFyaXNvbi1jb250YWluZXIge1xuICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmcjtcbiAgICAgIH1cbiAgICB9XG4gIDwvc3R5bGU+XG48L2hlYWQ+XG48Ym9keT5cbiAgPGRpdiBjbGFzcz1cImhlYWRlclwiPlxuICAgIDxoMT5EZXNpZ24gRmlsdGVyIFByZXZpZXc6ICR7dGhpcy5lc2NhcGVIdG1sKGNvbXBhcmlzb24uZmlsdGVyTmFtZSl9PC9oMT5cbiAgICA8ZGl2IGNsYXNzPVwibWV0YVwiPlxuICAgICAgPHA+R2VuZXJhdGVkOiAke2NvbXBhcmlzb24udGltZXN0YW1wLnRvTG9jYWxlU3RyaW5nKCl9PC9wPlxuICAgICAgPHA+Q29tcG9uZW50cyBBZmZlY3RlZDogJHtjb21wYXJpc29uLmNvbXBvbmVudHNBZmZlY3RlZH08L3A+XG4gICAgICA8cD5QcmV2aWV3cyBHZW5lcmF0ZWQ6ICR7Y29tcGFyaXNvbi5wcmV2aWV3cy5sZW5ndGh9PC9wPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJhY3Rpb25zXCI+XG4gICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1hcHByb3ZlXCIgb25jbGljaz1cImFwcHJvdmVDaGFuZ2VzKClcIj5cbiAgICAgICAg4pyTIEFwcHJvdmUgQ2hhbmdlc1xuICAgICAgPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1yZWplY3RcIiBvbmNsaWNrPVwicmVqZWN0Q2hhbmdlcygpXCI+XG4gICAgICAgIOKclyBSZWplY3QgQ2hhbmdlc1xuICAgICAgPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICBcbiAgJHtwcmV2aWV3c0hUTUx9XG4gIFxuICA8c2NyaXB0PlxuICAgIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2VzKCkge1xuICAgICAgaWYgKGNvbmZpcm0oJ0FwcHJvdmUgYW5kIGFwcGx5IGFsbCBkZXNpZ24gZmlsdGVyIGNoYW5nZXM/JykpIHtcbiAgICAgICAgYWxlcnQoJ0NoYW5nZXMgYXBwcm92ZWQhIFRoZSBkZXNpZ24gZmlsdGVyIHdpbGwgYmUgYXBwbGllZC4nKTtcbiAgICAgICAgLy8gSW4gcHJvZHVjdGlvbiwgdGhpcyB3b3VsZCB0cmlnZ2VyIElQQyB0byBhcHBseSBjaGFuZ2VzXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHJlamVjdENoYW5nZXMoKSB7XG4gICAgICBpZiAoY29uZmlybSgnUmVqZWN0IGFsbCBkZXNpZ24gZmlsdGVyIGNoYW5nZXM/JykpIHtcbiAgICAgICAgYWxlcnQoJ0NoYW5nZXMgcmVqZWN0ZWQuIE5vIG1vZGlmaWNhdGlvbnMgd2lsbCBiZSBtYWRlLicpO1xuICAgICAgICAvLyBJbiBwcm9kdWN0aW9uLCB0aGlzIHdvdWxkIHRyaWdnZXIgSVBDIHRvIGNhbmNlbFxuICAgICAgfVxuICAgIH1cbiAgPC9zY3JpcHQ+XG48L2JvZHk+XG48L2h0bWw+XG4gICAgYC50cmltKCk7XG4gIH1cblxuICAvKipcbiAgICogRXNjYXBlIEhUTUwgc3BlY2lhbCBjaGFyYWN0ZXJzXG4gICAqL1xuICBwcml2YXRlIGVzY2FwZUh0bWwodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBtYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICAnJic6ICcmYW1wOycsXG4gICAgICAnPCc6ICcmbHQ7JyxcbiAgICAgICc+JzogJyZndDsnLFxuICAgICAgJ1wiJzogJyZxdW90OycsXG4gICAgICBcIidcIjogJyYjMDM5OycsXG4gICAgfTtcbiAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9bJjw+XCInXS9nLCBtID0+IG1hcFttXSk7XG4gIH1cblxuICAvKipcbiAgICogU2FuaXRpemUgZmlsZSBuYW1lXG4gICAqL1xuICBwcml2YXRlIHNhbml0aXplRmlsZU5hbWUobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbmFtZVxuICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgIC5yZXBsYWNlKC9bXmEtejAtOV0rL2csICctJylcbiAgICAgIC5yZXBsYWNlKC9eLXwtJC9nLCAnJyk7XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBleGlzdGluZyBjb21wYXJpc29uXG4gICAqL1xuICBhc3luYyBsb2FkQ29tcGFyaXNvbihmaWx0ZXJOYW1lOiBzdHJpbmcpOiBQcm9taXNlPFByZXZpZXdDb21wYXJpc29uIHwgbnVsbD4ge1xuICAgIGNvbnN0IGZpbHRlckRpciA9IHBhdGguam9pbih0aGlzLnByZXZpZXdEaXIsIHRoaXMuc2FuaXRpemVGaWxlTmFtZShmaWx0ZXJOYW1lKSk7XG4gICAgY29uc3QgbWV0YWRhdGFQYXRoID0gcGF0aC5qb2luKGZpbHRlckRpciwgJ2NvbXBhcmlzb24tbWV0YWRhdGEuanNvbicpO1xuXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKG1ldGFkYXRhUGF0aCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUobWV0YWRhdGFQYXRoLCAndXRmLTgnKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gSlNPTi5wYXJzZShjb250ZW50KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZmlsdGVyTmFtZTogbWV0YWRhdGEuZmlsdGVyTmFtZSxcbiAgICAgICAgY29tcG9uZW50c0FmZmVjdGVkOiBtZXRhZGF0YS5jb21wb25lbnRzQWZmZWN0ZWQsXG4gICAgICAgIHByZXZpZXdzOiBbXSwgLy8gV291bGQgbmVlZCB0byByZWNvbnN0cnVjdCBmcm9tIG1ldGFkYXRhXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUobWV0YWRhdGEudGltZXN0YW1wKSxcbiAgICAgICAgYXBwcm92ZWQ6IG1ldGFkYXRhLmFwcHJvdmVkLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgY29tcGFyaXNvbjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXBwcm92ZSBjb21wYXJpc29uIGFuZCBtYXJrIGZvciBhcHBsaWNhdGlvblxuICAgKi9cbiAgYXN5bmMgYXBwcm92ZUNvbXBhcmlzb24oZmlsdGVyTmFtZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgY29tcGFyaXNvbiA9IGF3YWl0IHRoaXMubG9hZENvbXBhcmlzb24oZmlsdGVyTmFtZSk7XG4gICAgaWYgKCFjb21wYXJpc29uKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29tcGFyaXNvbi5hcHByb3ZlZCA9IHRydWU7XG4gICAgXG4gICAgY29uc3QgZmlsdGVyRGlyID0gcGF0aC5qb2luKHRoaXMucHJldmlld0RpciwgdGhpcy5zYW5pdGl6ZUZpbGVOYW1lKGZpbHRlck5hbWUpKTtcbiAgICBhd2FpdCB0aGlzLnNhdmVDb21wYXJpc29uTWV0YWRhdGEoY29tcGFyaXNvbiwgZmlsdGVyRGlyKTtcbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWplY3QgY29tcGFyaXNvbiBhbmQgY2xlYW4gdXBcbiAgICovXG4gIGFzeW5jIHJlamVjdENvbXBhcmlzb24oZmlsdGVyTmFtZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgZmlsdGVyRGlyID0gcGF0aC5qb2luKHRoaXMucHJldmlld0RpciwgdGhpcy5zYW5pdGl6ZUZpbGVOYW1lKGZpbHRlck5hbWUpKTtcbiAgICBcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsdGVyRGlyKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIE1hcmsgYXMgcmVqZWN0ZWQgaW4gbWV0YWRhdGFcbiAgICBjb25zdCBjb21wYXJpc29uID0gYXdhaXQgdGhpcy5sb2FkQ29tcGFyaXNvbihmaWx0ZXJOYW1lKTtcbiAgICBpZiAoY29tcGFyaXNvbikge1xuICAgICAgY29tcGFyaXNvbi5hcHByb3ZlZCA9IGZhbHNlO1xuICAgICAgYXdhaXQgdGhpcy5zYXZlQ29tcGFyaXNvbk1ldGFkYXRhKGNvbXBhcmlzb24sIGZpbHRlckRpcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgb2xkIHByZXZpZXdzXG4gICAqL1xuICBhc3luYyBjbGVhbnVwT2xkUHJldmlld3MoZGF5c09sZDogbnVtYmVyID0gNyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgY3V0b2ZmRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY3V0b2ZmRGF0ZS5zZXREYXRlKGN1dG9mZkRhdGUuZ2V0RGF0ZSgpIC0gZGF5c09sZCk7XG5cbiAgICBsZXQgY2xlYW5lZCA9IDA7XG4gICAgY29uc3QgZW50cmllcyA9IGF3YWl0IGZzLnByb21pc2VzLnJlYWRkaXIodGhpcy5wcmV2aWV3RGlyLCB7IHdpdGhGaWxlVHlwZXM6IHRydWUgfSk7XG5cbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgIGlmIChlbnRyeS5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgIGNvbnN0IGRpclBhdGggPSBwYXRoLmpvaW4odGhpcy5wcmV2aWV3RGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgICAgY29uc3QgbWV0YWRhdGFQYXRoID0gcGF0aC5qb2luKGRpclBhdGgsICdjb21wYXJpc29uLW1ldGFkYXRhLmpzb24nKTtcblxuICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhtZXRhZGF0YVBhdGgpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZShtZXRhZGF0YVBhdGgsICd1dGYtOCcpO1xuICAgICAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBKU09OLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUobWV0YWRhdGEudGltZXN0YW1wKTtcblxuICAgICAgICAgICAgaWYgKHRpbWVzdGFtcCA8IGN1dG9mZkRhdGUpIHtcbiAgICAgICAgICAgICAgYXdhaXQgZnMucHJvbWlzZXMucm0oZGlyUGF0aCwgeyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH0pO1xuICAgICAgICAgICAgICBjbGVhbmVkKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHByb2Nlc3MgJHtkaXJQYXRofTpgLCBlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNsZWFuZWQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBhdmFpbGFibGUgcHJldmlld3NcbiAgICovXG4gIGFzeW5jIGxpc3RQcmV2aWV3cygpOiBQcm9taXNlPEFycmF5PHsgZmlsdGVyTmFtZTogc3RyaW5nOyB0aW1lc3RhbXA6IERhdGU7IGFwcHJvdmVkOiBib29sZWFuIH0+PiB7XG4gICAgY29uc3QgcHJldmlld3M6IEFycmF5PHsgZmlsdGVyTmFtZTogc3RyaW5nOyB0aW1lc3RhbXA6IERhdGU7IGFwcHJvdmVkOiBib29sZWFuIH0+ID0gW107XG4gICAgXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHRoaXMucHJldmlld0RpcikpIHtcbiAgICAgIHJldHVybiBwcmV2aWV3cztcbiAgICB9XG5cbiAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZGRpcih0aGlzLnByZXZpZXdEaXIsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KTtcblxuICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgY29uc3QgY29tcGFyaXNvbiA9IGF3YWl0IHRoaXMubG9hZENvbXBhcmlzb24oZW50cnkubmFtZSk7XG4gICAgICAgIGlmIChjb21wYXJpc29uKSB7XG4gICAgICAgICAgcHJldmlld3MucHVzaCh7XG4gICAgICAgICAgICBmaWx0ZXJOYW1lOiBjb21wYXJpc29uLmZpbHRlck5hbWUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IGNvbXBhcmlzb24udGltZXN0YW1wLFxuICAgICAgICAgICAgYXBwcm92ZWQ6IGNvbXBhcmlzb24uYXBwcm92ZWQsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcHJldmlld3Muc29ydCgoYSwgYikgPT4gYi50aW1lc3RhbXAuZ2V0VGltZSgpIC0gYS50aW1lc3RhbXAuZ2V0VGltZSgpKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxFQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxJQUFBLEdBQUFGLHVCQUFBLENBQUFDLE9BQUE7QUFBNkIsU0FBQUQsd0JBQUFHLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFMLHVCQUFBLFlBQUFBLENBQUFHLENBQUEsRUFBQUMsQ0FBQSxTQUFBQSxDQUFBLElBQUFELENBQUEsSUFBQUEsQ0FBQSxDQUFBSyxVQUFBLFNBQUFMLENBQUEsTUFBQU0sQ0FBQSxFQUFBQyxDQUFBLEVBQUFDLENBQUEsS0FBQUMsU0FBQSxRQUFBQyxPQUFBLEVBQUFWLENBQUEsaUJBQUFBLENBQUEsdUJBQUFBLENBQUEseUJBQUFBLENBQUEsU0FBQVEsQ0FBQSxNQUFBRixDQUFBLEdBQUFMLENBQUEsR0FBQUcsQ0FBQSxHQUFBRCxDQUFBLFFBQUFHLENBQUEsQ0FBQUssR0FBQSxDQUFBWCxDQUFBLFVBQUFNLENBQUEsQ0FBQU0sR0FBQSxDQUFBWixDQUFBLEdBQUFNLENBQUEsQ0FBQU8sR0FBQSxDQUFBYixDQUFBLEVBQUFRLENBQUEsZ0JBQUFQLENBQUEsSUFBQUQsQ0FBQSxnQkFBQUMsQ0FBQSxPQUFBYSxjQUFBLENBQUFDLElBQUEsQ0FBQWYsQ0FBQSxFQUFBQyxDQUFBLE9BQUFNLENBQUEsSUFBQUQsQ0FBQSxHQUFBVSxNQUFBLENBQUFDLGNBQUEsS0FBQUQsTUFBQSxDQUFBRSx3QkFBQSxDQUFBbEIsQ0FBQSxFQUFBQyxDQUFBLE9BQUFNLENBQUEsQ0FBQUssR0FBQSxJQUFBTCxDQUFBLENBQUFNLEdBQUEsSUFBQVAsQ0FBQSxDQUFBRSxDQUFBLEVBQUFQLENBQUEsRUFBQU0sQ0FBQSxJQUFBQyxDQUFBLENBQUFQLENBQUEsSUFBQUQsQ0FBQSxDQUFBQyxDQUFBLFdBQUFPLENBQUEsS0FBQVIsQ0FBQSxFQUFBQyxDQUFBO0FBdUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNPLE1BQU1rQixnQkFBZ0IsQ0FBQztFQUdwQkMsZ0JBQWdCLEdBQUcsQ0FDekI7SUFBRUMsSUFBSSxFQUFFLFNBQVM7SUFBRUMsS0FBSyxFQUFFLElBQUk7SUFBRUMsTUFBTSxFQUFFO0VBQUssQ0FBQyxFQUM5QztJQUFFRixJQUFJLEVBQUUsUUFBUTtJQUFFQyxLQUFLLEVBQUUsR0FBRztJQUFFQyxNQUFNLEVBQUU7RUFBSyxDQUFDLEVBQzVDO0lBQUVGLElBQUksRUFBRSxRQUFRO0lBQUVDLEtBQUssRUFBRSxHQUFHO0lBQUVDLE1BQU0sRUFBRTtFQUFJLENBQUMsQ0FDNUM7RUFFREMsV0FBV0EsQ0FBQ0MsV0FBbUIsRUFBRTtJQUMvQixJQUFJLENBQUNBLFdBQVcsR0FBR0EsV0FBVztJQUM5QixJQUFJLENBQUNDLFVBQVUsR0FBRzNCLElBQUksQ0FBQzRCLElBQUksQ0FBQ0YsV0FBVyxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUM7SUFDakUsSUFBSSxDQUFDRyxzQkFBc0IsQ0FBQyxDQUFDO0VBQy9COztFQUVBO0FBQ0Y7QUFDQTtFQUNVQSxzQkFBc0JBLENBQUEsRUFBUztJQUNyQyxJQUFJLENBQUNoQyxFQUFFLENBQUNpQyxVQUFVLENBQUMsSUFBSSxDQUFDSCxVQUFVLENBQUMsRUFBRTtNQUNuQzlCLEVBQUUsQ0FBQ2tDLFNBQVMsQ0FBQyxJQUFJLENBQUNKLFVBQVUsRUFBRTtRQUFFSyxTQUFTLEVBQUU7TUFBSyxDQUFDLENBQUM7SUFDcEQ7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNQyxxQkFBcUJBLENBQ3pCQyxNQUFvQixFQUNwQkMsVUFBZ0MsRUFDaENDLE9BQXVCLEdBQUcsQ0FBQyxDQUFDLEVBQ0E7SUFDNUIsTUFBTTtNQUNKQyxhQUFhLEdBQUcsRUFBRTtNQUNsQkMsU0FBUyxHQUFHLElBQUksQ0FBQ2pCLGdCQUFnQjtNQUNqQ2tCLFNBQVMsR0FBRyxJQUFJLENBQUNaLFVBQVU7TUFDM0JhLGVBQWUsR0FBRztJQUNwQixDQUFDLEdBQUdKLE9BQU87SUFFWEssT0FBTyxDQUFDQyxHQUFHLENBQUMsa0NBQWtDUixNQUFNLENBQUNaLElBQUksRUFBRSxDQUFDO0lBQzVEbUIsT0FBTyxDQUFDQyxHQUFHLENBQUMsMEJBQTBCQyxJQUFJLENBQUNDLEdBQUcsQ0FBQ1QsVUFBVSxDQUFDVSxNQUFNLEVBQUVSLGFBQWEsQ0FBQyxFQUFFLENBQUM7O0lBRW5GO0lBQ0EsTUFBTVMsU0FBUyxHQUFHOUMsSUFBSSxDQUFDNEIsSUFBSSxDQUFDVyxTQUFTLEVBQUUsSUFBSSxDQUFDUSxnQkFBZ0IsQ0FBQ2IsTUFBTSxDQUFDWixJQUFJLENBQUMsQ0FBQztJQUMxRSxJQUFJLENBQUN6QixFQUFFLENBQUNpQyxVQUFVLENBQUNnQixTQUFTLENBQUMsRUFBRTtNQUM3QmpELEVBQUUsQ0FBQ2tDLFNBQVMsQ0FBQ2UsU0FBUyxFQUFFO1FBQUVkLFNBQVMsRUFBRTtNQUFLLENBQUMsQ0FBQztJQUM5QztJQUVBLE1BQU1nQixRQUE0QixHQUFHLEVBQUU7SUFDdkMsTUFBTUMsbUJBQW1CLEdBQUdkLFVBQVUsQ0FBQ2UsS0FBSyxDQUFDLENBQUMsRUFBRWIsYUFBYSxDQUFDO0lBRTlELEtBQUssTUFBTWMsU0FBUyxJQUFJRixtQkFBbUIsRUFBRTtNQUMzQyxJQUFJO1FBQ0YsTUFBTUcsT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDQyx3QkFBd0IsQ0FDakRGLFNBQVMsRUFDVGpCLE1BQU0sRUFDTlksU0FBUyxFQUNUUixTQUNGLENBQUM7UUFDRFUsUUFBUSxDQUFDTSxJQUFJLENBQUNGLE9BQU8sQ0FBQztNQUN4QixDQUFDLENBQUMsT0FBT0csS0FBSyxFQUFFO1FBQ2RkLE9BQU8sQ0FBQ2UsSUFBSSxDQUFDLGtDQUFrQ0wsU0FBUyxDQUFDTSxhQUFhLEdBQUcsRUFBRUYsS0FBSyxDQUFDO01BQ25GO0lBQ0Y7SUFFQSxNQUFNRyxVQUE2QixHQUFHO01BQ3BDQyxVQUFVLEVBQUV6QixNQUFNLENBQUNaLElBQUk7TUFDdkJzQyxrQkFBa0IsRUFBRXpCLFVBQVUsQ0FBQ1UsTUFBTTtNQUNyQ0csUUFBUTtNQUNSYSxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUM7TUFDckJDLFFBQVEsRUFBRTtJQUNaLENBQUM7O0lBRUQ7SUFDQSxJQUFJdkIsZUFBZSxFQUFFO01BQ25CLE1BQU0sSUFBSSxDQUFDd0Isc0JBQXNCLENBQUNOLFVBQVUsRUFBRVosU0FBUyxDQUFDO0lBQzFEOztJQUVBO0lBQ0EsTUFBTSxJQUFJLENBQUNtQixzQkFBc0IsQ0FBQ1AsVUFBVSxFQUFFWixTQUFTLENBQUM7SUFFeERMLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLHlCQUF5QkksU0FBUyxFQUFFLENBQUM7SUFDakQsT0FBT1ksVUFBVTtFQUNuQjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFjTCx3QkFBd0JBLENBQ3BDRixTQUE2QixFQUM3QmpCLE1BQW9CLEVBQ3BCSyxTQUFpQixFQUNqQkQsU0FBaUUsRUFDdEM7SUFDM0IsTUFBTTRCLFlBQVksR0FBR2xFLElBQUksQ0FBQzRCLElBQUksQ0FDNUJXLFNBQVMsRUFDVCxJQUFJLENBQUNRLGdCQUFnQixDQUFDSSxTQUFTLENBQUNNLGFBQWEsQ0FDL0MsQ0FBQztJQUVELElBQUksQ0FBQzVELEVBQUUsQ0FBQ2lDLFVBQVUsQ0FBQ29DLFlBQVksQ0FBQyxFQUFFO01BQ2hDckUsRUFBRSxDQUFDa0MsU0FBUyxDQUFDbUMsWUFBWSxFQUFFO1FBQUVsQyxTQUFTLEVBQUU7TUFBSyxDQUFDLENBQUM7SUFDakQ7O0lBRUE7SUFDQSxNQUFNbUMsZ0JBQWdCLEdBQUcsTUFBTSxJQUFJLENBQUNDLDBCQUEwQixDQUM1RGpCLFNBQVMsRUFDVCxRQUFRLEVBQ1JlLFlBQVksRUFDWjVCLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNmLENBQUM7O0lBRUQ7SUFDQSxNQUFNK0IsZUFBZSxHQUFHLE1BQU0sSUFBSSxDQUFDRCwwQkFBMEIsQ0FDM0RqQixTQUFTLEVBQ1QsT0FBTyxFQUNQZSxZQUFZLEVBQ1o1QixTQUFTLENBQUMsQ0FBQyxDQUNiLENBQUM7O0lBRUQ7SUFDQSxNQUFNZ0MsT0FBTyxHQUFHLElBQUksQ0FBQ0MsY0FBYyxDQUFDcEIsU0FBUyxFQUFFakIsTUFBTSxDQUFDO0lBRXRELE9BQU87TUFDTHNDLGFBQWEsRUFBRXJCLFNBQVMsQ0FBQ3NCLFFBQVE7TUFDakNoQixhQUFhLEVBQUVOLFNBQVMsQ0FBQ00sYUFBYTtNQUN0Q2lCLE1BQU0sRUFBRVAsZ0JBQWdCO01BQ3hCUSxLQUFLLEVBQUVOLGVBQWU7TUFDdEJDO0lBQ0YsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0UsTUFBY0YsMEJBQTBCQSxDQUN0Q2pCLFNBQTZCLEVBQzdCeUIsS0FBeUIsRUFDekJyQyxTQUFpQixFQUNqQnNDLFFBQXlELEVBQ3BDO0lBQ3JCLE1BQU1oQixTQUFTLEdBQUcsSUFBSUMsSUFBSSxDQUFDLENBQUM7SUFDNUIsTUFBTWdCLFFBQVEsR0FBRyxHQUFHRixLQUFLLElBQUlDLFFBQVEsQ0FBQ3ZELElBQUksSUFBSXVDLFNBQVMsQ0FBQ2tCLE9BQU8sQ0FBQyxDQUFDLE1BQU07SUFDdkUsTUFBTUMsU0FBUyxHQUFHaEYsSUFBSSxDQUFDNEIsSUFBSSxDQUFDVyxTQUFTLEVBQUV1QyxRQUFRLENBQUM7O0lBRWhEO0lBQ0E7SUFDQSxNQUFNRyxlQUFlLEdBQUc7TUFDdEI5QixTQUFTLEVBQUVBLFNBQVMsQ0FBQ00sYUFBYTtNQUNsQ21CLEtBQUs7TUFDTEMsUUFBUSxFQUFFQSxRQUFRLENBQUN2RCxJQUFJO01BQ3ZCdUMsU0FBUyxFQUFFQSxTQUFTLENBQUNxQixXQUFXLENBQUMsQ0FBQztNQUNsQ0MsSUFBSSxFQUFFO0lBQ1IsQ0FBQzs7SUFFRDtJQUNBLE1BQU1DLFlBQVksR0FBR0osU0FBUyxDQUFDSyxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztJQUN2RCxNQUFNeEYsRUFBRSxDQUFDeUYsUUFBUSxDQUFDQyxTQUFTLENBQ3pCSCxZQUFZLEVBQ1pJLElBQUksQ0FBQ0MsU0FBUyxDQUFDUixlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUN4QyxPQUNGLENBQUM7O0lBRUQ7SUFDQSxNQUFNcEYsRUFBRSxDQUFDeUYsUUFBUSxDQUFDQyxTQUFTLENBQUNQLFNBQVMsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDO0lBRW5ELE9BQU87TUFDTFIsYUFBYSxFQUFFckIsU0FBUyxDQUFDc0IsUUFBUTtNQUNqQ2hCLGFBQWEsRUFBRU4sU0FBUyxDQUFDTSxhQUFhO01BQ3RDdUIsU0FBUztNQUNUbkIsU0FBUztNQUNUNkIsUUFBUSxFQUFFO1FBQ1JuRSxLQUFLLEVBQUVzRCxRQUFRLENBQUN0RCxLQUFLO1FBQ3JCQyxNQUFNLEVBQUVxRCxRQUFRLENBQUNyRCxNQUFNO1FBQ3ZCcUQsUUFBUSxFQUFFQSxRQUFRLENBQUN2RDtNQUNyQjtJQUNGLENBQUM7RUFDSDs7RUFFQTtBQUNGO0FBQ0E7RUFDVWlELGNBQWNBLENBQ3BCcEIsU0FBNkIsRUFDN0JqQixNQUFvQixFQUNWO0lBQ1YsTUFBTW9DLE9BQWlCLEdBQUcsRUFBRTs7SUFFNUI7SUFDQSxLQUFLLE1BQU1xQixTQUFTLElBQUl4QyxTQUFTLENBQUN5QyxVQUFVLEVBQUU7TUFDNUMsS0FBSyxNQUFNLENBQUNDLFFBQVEsRUFBRUMsUUFBUSxDQUFDLElBQUk3RSxNQUFNLENBQUM4RSxPQUFPLENBQUM3RCxNQUFNLENBQUM4RCxlQUFlLENBQUMsRUFBRTtRQUN6RSxJQUFJTCxTQUFTLENBQUNNLFFBQVEsQ0FBQ0osUUFBUSxDQUFDLEVBQUU7VUFDaEN2QixPQUFPLENBQUNoQixJQUFJLENBQUMsVUFBVXVDLFFBQVEsTUFBTUMsUUFBUSxFQUFFLENBQUM7UUFDbEQ7TUFDRjtJQUNGOztJQUVBO0lBQ0EsSUFBSTVELE1BQU0sQ0FBQ2dFLE1BQU0sQ0FBQ0MsTUFBTSxFQUFFO01BQ3hCN0IsT0FBTyxDQUFDaEIsSUFBSSxDQUFDLGdDQUFnQyxDQUFDO0lBQ2hEO0lBRUEsSUFBSXBCLE1BQU0sQ0FBQ2dFLE1BQU0sQ0FBQ0UsWUFBWSxFQUFFO01BQzlCOUIsT0FBTyxDQUFDaEIsSUFBSSxDQUFDLHFDQUFxQyxDQUFDO0lBQ3JEO0lBRUEsSUFBSXBCLE1BQU0sQ0FBQ2dFLE1BQU0sQ0FBQ0csT0FBTyxFQUFFO01BQ3pCL0IsT0FBTyxDQUFDaEIsSUFBSSxDQUFDLG1DQUFtQyxDQUFDO0lBQ25EOztJQUVBO0lBQ0EsSUFBSUgsU0FBUyxDQUFDbUQsZUFBZSxFQUFFO01BQzdCaEMsT0FBTyxDQUFDaEIsSUFBSSxDQUFDLGtCQUFrQkgsU0FBUyxDQUFDb0QsWUFBWSxDQUFDMUQsTUFBTSxvQkFBb0IsQ0FBQztJQUNuRjs7SUFFQTtJQUNBLElBQUlNLFNBQVMsQ0FBQ3FELFlBQVksRUFBRTtNQUMxQmxDLE9BQU8sQ0FBQ2hCLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQztJQUM3RDtJQUVBLE9BQU9nQixPQUFPO0VBQ2hCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLE1BQWNOLHNCQUFzQkEsQ0FDbENOLFVBQTZCLEVBQzdCbkIsU0FBaUIsRUFDRjtJQUNmLE1BQU02QyxZQUFZLEdBQUdwRixJQUFJLENBQUM0QixJQUFJLENBQUNXLFNBQVMsRUFBRSwwQkFBMEIsQ0FBQztJQUNyRSxNQUFNbUQsUUFBUSxHQUFHO01BQ2YvQixVQUFVLEVBQUVELFVBQVUsQ0FBQ0MsVUFBVTtNQUNqQ0Msa0JBQWtCLEVBQUVGLFVBQVUsQ0FBQ0Usa0JBQWtCO01BQ2pENkMsaUJBQWlCLEVBQUUvQyxVQUFVLENBQUNWLFFBQVEsQ0FBQ0gsTUFBTTtNQUM3Q2dCLFNBQVMsRUFBRUgsVUFBVSxDQUFDRyxTQUFTLENBQUNxQixXQUFXLENBQUMsQ0FBQztNQUM3Q25CLFFBQVEsRUFBRUwsVUFBVSxDQUFDSyxRQUFRO01BQzdCZixRQUFRLEVBQUVVLFVBQVUsQ0FBQ1YsUUFBUSxDQUFDMEQsR0FBRyxDQUFDQyxDQUFDLEtBQUs7UUFDdENsRCxhQUFhLEVBQUVrRCxDQUFDLENBQUNsRCxhQUFhO1FBQzlCZSxhQUFhLEVBQUVtQyxDQUFDLENBQUNuQyxhQUFhO1FBQzlCRixPQUFPLEVBQUVxQyxDQUFDLENBQUNyQyxPQUFPO1FBQ2xCc0MsV0FBVyxFQUFFNUcsSUFBSSxDQUFDNkcsUUFBUSxDQUFDdEUsU0FBUyxFQUFFb0UsQ0FBQyxDQUFDakMsTUFBTSxDQUFDTSxTQUFTLENBQUM7UUFDekQ4QixVQUFVLEVBQUU5RyxJQUFJLENBQUM2RyxRQUFRLENBQUN0RSxTQUFTLEVBQUVvRSxDQUFDLENBQUNoQyxLQUFLLENBQUNLLFNBQVM7TUFDeEQsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELE1BQU1uRixFQUFFLENBQUN5RixRQUFRLENBQUNDLFNBQVMsQ0FDekJILFlBQVksRUFDWkksSUFBSSxDQUFDQyxTQUFTLENBQUNDLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQ2pDLE9BQ0YsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLE1BQWN6QixzQkFBc0JBLENBQ2xDUCxVQUE2QixFQUM3Qm5CLFNBQWlCLEVBQ0Y7SUFDZixNQUFNd0UsUUFBUSxHQUFHL0csSUFBSSxDQUFDNEIsSUFBSSxDQUFDVyxTQUFTLEVBQUUsaUJBQWlCLENBQUM7SUFDeEQsTUFBTXlFLElBQUksR0FBRyxJQUFJLENBQUNDLG1CQUFtQixDQUFDdkQsVUFBVSxFQUFFbkIsU0FBUyxDQUFDO0lBQzVELE1BQU0xQyxFQUFFLENBQUN5RixRQUFRLENBQUNDLFNBQVMsQ0FBQ3dCLFFBQVEsRUFBRUMsSUFBSSxFQUFFLE9BQU8sQ0FBQztFQUN0RDs7RUFFQTtBQUNGO0FBQ0E7RUFDVUMsbUJBQW1CQSxDQUN6QnZELFVBQTZCLEVBQzdCd0QsT0FBZSxFQUNQO0lBQ1IsTUFBTUMsWUFBWSxHQUFHekQsVUFBVSxDQUFDVixRQUFRLENBQ3JDMEQsR0FBRyxDQUFDdEQsT0FBTyxJQUFJO01BQ2QsTUFBTWdFLFVBQVUsR0FBR3BILElBQUksQ0FBQzZHLFFBQVEsQ0FBQ0ssT0FBTyxFQUFFOUQsT0FBTyxDQUFDc0IsTUFBTSxDQUFDTSxTQUFTLENBQUM7TUFDbkUsTUFBTXFDLFNBQVMsR0FBR3JILElBQUksQ0FBQzZHLFFBQVEsQ0FBQ0ssT0FBTyxFQUFFOUQsT0FBTyxDQUFDdUIsS0FBSyxDQUFDSyxTQUFTLENBQUM7TUFDakUsTUFBTXNDLFdBQVcsR0FBR2xFLE9BQU8sQ0FBQ2tCLE9BQU8sQ0FDaENvQyxHQUFHLENBQUNhLE1BQU0sSUFBSSxPQUFPLElBQUksQ0FBQ0MsVUFBVSxDQUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQ3BEM0YsSUFBSSxDQUFDLEVBQUUsQ0FBQztNQUVYLE9BQU87QUFDZjtBQUNBLGtCQUFrQixJQUFJLENBQUM0RixVQUFVLENBQUNwRSxPQUFPLENBQUNLLGFBQWEsQ0FBQztBQUN4RCx3Q0FBd0MsSUFBSSxDQUFDK0QsVUFBVSxDQUFDcEUsT0FBTyxDQUFDb0IsYUFBYSxDQUFDO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM0QyxVQUFVO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DQyxTQUFTO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CQyxXQUFXO0FBQy9CO0FBQ0E7QUFDQSxTQUFTO0lBQ0gsQ0FBQyxDQUFDLENBQ0QxRixJQUFJLENBQUMsRUFBRSxDQUFDO0lBRVgsT0FBTztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsSUFBSSxDQUFDNEYsVUFBVSxDQUFDOUQsVUFBVSxDQUFDQyxVQUFVLENBQUM7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxJQUFJLENBQUM2RCxVQUFVLENBQUM5RCxVQUFVLENBQUNDLFVBQVUsQ0FBQztBQUN2RTtBQUNBLHNCQUFzQkQsVUFBVSxDQUFDRyxTQUFTLENBQUM0RCxjQUFjLENBQUMsQ0FBQztBQUMzRCxnQ0FBZ0MvRCxVQUFVLENBQUNFLGtCQUFrQjtBQUM3RCwrQkFBK0JGLFVBQVUsQ0FBQ1YsUUFBUSxDQUFDSCxNQUFNO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJc0UsWUFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLENBQUNPLElBQUksQ0FBQyxDQUFDO0VBQ1Y7O0VBRUE7QUFDRjtBQUNBO0VBQ1VGLFVBQVVBLENBQUNHLElBQVksRUFBVTtJQUN2QyxNQUFNakIsR0FBMkIsR0FBRztNQUNsQyxHQUFHLEVBQUUsT0FBTztNQUNaLEdBQUcsRUFBRSxNQUFNO01BQ1gsR0FBRyxFQUFFLE1BQU07TUFDWCxHQUFHLEVBQUUsUUFBUTtNQUNiLEdBQUcsRUFBRTtJQUNQLENBQUM7SUFDRCxPQUFPaUIsSUFBSSxDQUFDdEMsT0FBTyxDQUFDLFVBQVUsRUFBRXVDLENBQUMsSUFBSWxCLEdBQUcsQ0FBQ2tCLENBQUMsQ0FBQyxDQUFDO0VBQzlDOztFQUVBO0FBQ0Y7QUFDQTtFQUNVN0UsZ0JBQWdCQSxDQUFDekIsSUFBWSxFQUFVO0lBQzdDLE9BQU9BLElBQUksQ0FDUnVHLFdBQVcsQ0FBQyxDQUFDLENBQ2J4QyxPQUFPLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUMzQkEsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUM7RUFDMUI7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsTUFBTXlDLGNBQWNBLENBQUNuRSxVQUFrQixFQUFxQztJQUMxRSxNQUFNYixTQUFTLEdBQUc5QyxJQUFJLENBQUM0QixJQUFJLENBQUMsSUFBSSxDQUFDRCxVQUFVLEVBQUUsSUFBSSxDQUFDb0IsZ0JBQWdCLENBQUNZLFVBQVUsQ0FBQyxDQUFDO0lBQy9FLE1BQU15QixZQUFZLEdBQUdwRixJQUFJLENBQUM0QixJQUFJLENBQUNrQixTQUFTLEVBQUUsMEJBQTBCLENBQUM7SUFFckUsSUFBSSxDQUFDakQsRUFBRSxDQUFDaUMsVUFBVSxDQUFDc0QsWUFBWSxDQUFDLEVBQUU7TUFDaEMsT0FBTyxJQUFJO0lBQ2I7SUFFQSxJQUFJO01BQ0YsTUFBTTJDLE9BQU8sR0FBRyxNQUFNbEksRUFBRSxDQUFDeUYsUUFBUSxDQUFDMEMsUUFBUSxDQUFDNUMsWUFBWSxFQUFFLE9BQU8sQ0FBQztNQUNqRSxNQUFNTSxRQUFRLEdBQUdGLElBQUksQ0FBQ3lDLEtBQUssQ0FBQ0YsT0FBTyxDQUFDO01BRXBDLE9BQU87UUFDTHBFLFVBQVUsRUFBRStCLFFBQVEsQ0FBQy9CLFVBQVU7UUFDL0JDLGtCQUFrQixFQUFFOEIsUUFBUSxDQUFDOUIsa0JBQWtCO1FBQy9DWixRQUFRLEVBQUUsRUFBRTtRQUFFO1FBQ2RhLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUM0QixRQUFRLENBQUM3QixTQUFTLENBQUM7UUFDdkNFLFFBQVEsRUFBRTJCLFFBQVEsQ0FBQzNCO01BQ3JCLENBQUM7SUFDSCxDQUFDLENBQUMsT0FBT1IsS0FBSyxFQUFFO01BQ2RkLE9BQU8sQ0FBQ2MsS0FBSyxDQUFDLDRCQUE0QixFQUFFQSxLQUFLLENBQUM7TUFDbEQsT0FBTyxJQUFJO0lBQ2I7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNMkUsaUJBQWlCQSxDQUFDdkUsVUFBa0IsRUFBb0I7SUFDNUQsTUFBTUQsVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDb0UsY0FBYyxDQUFDbkUsVUFBVSxDQUFDO0lBQ3hELElBQUksQ0FBQ0QsVUFBVSxFQUFFO01BQ2YsT0FBTyxLQUFLO0lBQ2Q7SUFFQUEsVUFBVSxDQUFDSyxRQUFRLEdBQUcsSUFBSTtJQUUxQixNQUFNakIsU0FBUyxHQUFHOUMsSUFBSSxDQUFDNEIsSUFBSSxDQUFDLElBQUksQ0FBQ0QsVUFBVSxFQUFFLElBQUksQ0FBQ29CLGdCQUFnQixDQUFDWSxVQUFVLENBQUMsQ0FBQztJQUMvRSxNQUFNLElBQUksQ0FBQ0ssc0JBQXNCLENBQUNOLFVBQVUsRUFBRVosU0FBUyxDQUFDO0lBRXhELE9BQU8sSUFBSTtFQUNiOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLE1BQU1xRixnQkFBZ0JBLENBQUN4RSxVQUFrQixFQUFvQjtJQUMzRCxNQUFNYixTQUFTLEdBQUc5QyxJQUFJLENBQUM0QixJQUFJLENBQUMsSUFBSSxDQUFDRCxVQUFVLEVBQUUsSUFBSSxDQUFDb0IsZ0JBQWdCLENBQUNZLFVBQVUsQ0FBQyxDQUFDO0lBRS9FLElBQUksQ0FBQzlELEVBQUUsQ0FBQ2lDLFVBQVUsQ0FBQ2dCLFNBQVMsQ0FBQyxFQUFFO01BQzdCLE9BQU8sS0FBSztJQUNkOztJQUVBO0lBQ0EsTUFBTVksVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDb0UsY0FBYyxDQUFDbkUsVUFBVSxDQUFDO0lBQ3hELElBQUlELFVBQVUsRUFBRTtNQUNkQSxVQUFVLENBQUNLLFFBQVEsR0FBRyxLQUFLO01BQzNCLE1BQU0sSUFBSSxDQUFDQyxzQkFBc0IsQ0FBQ04sVUFBVSxFQUFFWixTQUFTLENBQUM7SUFDMUQ7SUFFQSxPQUFPLElBQUk7RUFDYjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxNQUFNc0Ysa0JBQWtCQSxDQUFDQyxPQUFlLEdBQUcsQ0FBQyxFQUFtQjtJQUM3RCxNQUFNQyxVQUFVLEdBQUcsSUFBSXhFLElBQUksQ0FBQyxDQUFDO0lBQzdCd0UsVUFBVSxDQUFDQyxPQUFPLENBQUNELFVBQVUsQ0FBQ0UsT0FBTyxDQUFDLENBQUMsR0FBR0gsT0FBTyxDQUFDO0lBRWxELElBQUlJLE9BQU8sR0FBRyxDQUFDO0lBQ2YsTUFBTTFDLE9BQU8sR0FBRyxNQUFNbEcsRUFBRSxDQUFDeUYsUUFBUSxDQUFDb0QsT0FBTyxDQUFDLElBQUksQ0FBQy9HLFVBQVUsRUFBRTtNQUFFZ0gsYUFBYSxFQUFFO0lBQUssQ0FBQyxDQUFDO0lBRW5GLEtBQUssTUFBTUMsS0FBSyxJQUFJN0MsT0FBTyxFQUFFO01BQzNCLElBQUk2QyxLQUFLLENBQUNDLFdBQVcsQ0FBQyxDQUFDLEVBQUU7UUFDdkIsTUFBTUMsT0FBTyxHQUFHOUksSUFBSSxDQUFDNEIsSUFBSSxDQUFDLElBQUksQ0FBQ0QsVUFBVSxFQUFFaUgsS0FBSyxDQUFDdEgsSUFBSSxDQUFDO1FBQ3RELE1BQU04RCxZQUFZLEdBQUdwRixJQUFJLENBQUM0QixJQUFJLENBQUNrSCxPQUFPLEVBQUUsMEJBQTBCLENBQUM7UUFFbkUsSUFBSWpKLEVBQUUsQ0FBQ2lDLFVBQVUsQ0FBQ3NELFlBQVksQ0FBQyxFQUFFO1VBQy9CLElBQUk7WUFDRixNQUFNMkMsT0FBTyxHQUFHLE1BQU1sSSxFQUFFLENBQUN5RixRQUFRLENBQUMwQyxRQUFRLENBQUM1QyxZQUFZLEVBQUUsT0FBTyxDQUFDO1lBQ2pFLE1BQU1NLFFBQVEsR0FBR0YsSUFBSSxDQUFDeUMsS0FBSyxDQUFDRixPQUFPLENBQUM7WUFDcEMsTUFBTWxFLFNBQVMsR0FBRyxJQUFJQyxJQUFJLENBQUM0QixRQUFRLENBQUM3QixTQUFTLENBQUM7WUFFOUMsSUFBSUEsU0FBUyxHQUFHeUUsVUFBVSxFQUFFO2NBQzFCLE1BQU16SSxFQUFFLENBQUN5RixRQUFRLENBQUN5RCxFQUFFLENBQUNELE9BQU8sRUFBRTtnQkFBRTlHLFNBQVMsRUFBRSxJQUFJO2dCQUFFZ0gsS0FBSyxFQUFFO2NBQUssQ0FBQyxDQUFDO2NBQy9EUCxPQUFPLEVBQUU7WUFDWDtVQUNGLENBQUMsQ0FBQyxPQUFPbEYsS0FBSyxFQUFFO1lBQ2RkLE9BQU8sQ0FBQ2UsSUFBSSxDQUFDLHFCQUFxQnNGLE9BQU8sR0FBRyxFQUFFdkYsS0FBSyxDQUFDO1VBQ3REO1FBQ0Y7TUFDRjtJQUNGO0lBRUEsT0FBT2tGLE9BQU87RUFDaEI7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsTUFBTVEsWUFBWUEsQ0FBQSxFQUErRTtJQUMvRixNQUFNakcsUUFBMkUsR0FBRyxFQUFFO0lBRXRGLElBQUksQ0FBQ25ELEVBQUUsQ0FBQ2lDLFVBQVUsQ0FBQyxJQUFJLENBQUNILFVBQVUsQ0FBQyxFQUFFO01BQ25DLE9BQU9xQixRQUFRO0lBQ2pCO0lBRUEsTUFBTStDLE9BQU8sR0FBRyxNQUFNbEcsRUFBRSxDQUFDeUYsUUFBUSxDQUFDb0QsT0FBTyxDQUFDLElBQUksQ0FBQy9HLFVBQVUsRUFBRTtNQUFFZ0gsYUFBYSxFQUFFO0lBQUssQ0FBQyxDQUFDO0lBRW5GLEtBQUssTUFBTUMsS0FBSyxJQUFJN0MsT0FBTyxFQUFFO01BQzNCLElBQUk2QyxLQUFLLENBQUNDLFdBQVcsQ0FBQyxDQUFDLEVBQUU7UUFDdkIsTUFBTW5GLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQ29FLGNBQWMsQ0FBQ2MsS0FBSyxDQUFDdEgsSUFBSSxDQUFDO1FBQ3hELElBQUlvQyxVQUFVLEVBQUU7VUFDZFYsUUFBUSxDQUFDTSxJQUFJLENBQUM7WUFDWkssVUFBVSxFQUFFRCxVQUFVLENBQUNDLFVBQVU7WUFDakNFLFNBQVMsRUFBRUgsVUFBVSxDQUFDRyxTQUFTO1lBQy9CRSxRQUFRLEVBQUVMLFVBQVUsQ0FBQ0s7VUFDdkIsQ0FBQyxDQUFDO1FBQ0o7TUFDRjtJQUNGO0lBRUEsT0FBT2YsUUFBUSxDQUFDa0csSUFBSSxDQUFDLENBQUNDLENBQUMsRUFBRUMsQ0FBQyxLQUFLQSxDQUFDLENBQUN2RixTQUFTLENBQUNrQixPQUFPLENBQUMsQ0FBQyxHQUFHb0UsQ0FBQyxDQUFDdEYsU0FBUyxDQUFDa0IsT0FBTyxDQUFDLENBQUMsQ0FBQztFQUMvRTtBQUNGO0FBQUNzRSxPQUFBLENBQUFqSSxnQkFBQSxHQUFBQSxnQkFBQSIsImlnbm9yZUxpc3QiOltdfQ==