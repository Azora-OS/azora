{"version":3,"names":["_getJestObj","mock","_AIOrchestrator","require","_ContextManager","_PlannerAgent","_CodeGeneratorAgent","jest","describe","orchestrator","mockContextManager","mockPlannerAgent","mockCodeGenerator","beforeEach","ContextManager","PlannerAgent","CodeGeneratorAgent","AIOrchestrator","contextManager","plannerAgent","codeGenerator","clearAllMocks","it","prompt","mockContext","files","projectInfo","frameworks","mockDAG","tasks","id","type","description","dependencies","rollbackPoint","operations","verification","estimatedDuration","Map","rollbackPoints","buildContext","fn","mockResolvedValue","generatePlan","result","planTask","expect","toBeDefined","length","toBe","toHaveBeenCalled","toHaveBeenCalledWith","mockRejectedValue","Error","rejects","toThrow","task","target","action","code","reversible","executeOperation","success","output","executeTask","taskId","error","model","selectModel","cost","estimateCost","toBeGreaterThan","shortPrompt","longPrompt","shortCost","longCost","response","cacheResponse","cached","getCachedResponse","toBeNull"],"sources":["AIOrchestrator.test.ts"],"sourcesContent":["import { AIOrchestrator, Task, TaskDAG, AIModel } from '../AIOrchestrator';\nimport { ContextManager } from '../ContextManager';\nimport { PlannerAgent } from '../PlannerAgent';\nimport { CodeGeneratorAgent } from '../CodeGeneratorAgent';\n\n// Mock dependencies\njest.mock('../ContextManager');\njest.mock('../PlannerAgent');\njest.mock('../CodeGeneratorAgent');\n\ndescribe('AIOrchestrator', () => {\n  let orchestrator: AIOrchestrator;\n  let mockContextManager: jest.Mocked<ContextManager>;\n  let mockPlannerAgent: jest.Mocked<PlannerAgent>;\n  let mockCodeGenerator: jest.Mocked<CodeGeneratorAgent>;\n\n  beforeEach(() => {\n    mockContextManager = new ContextManager('/test/project') as jest.Mocked<ContextManager>;\n    mockPlannerAgent = new PlannerAgent() as jest.Mocked<PlannerAgent>;\n    mockCodeGenerator = new CodeGeneratorAgent() as jest.Mocked<CodeGeneratorAgent>;\n    \n    orchestrator = new AIOrchestrator('/test/project');\n    (orchestrator as any).contextManager = mockContextManager;\n    (orchestrator as any).plannerAgent = mockPlannerAgent;\n    (orchestrator as any).codeGenerator = mockCodeGenerator;\n    \n    jest.clearAllMocks();\n  });\n\n  describe('planTask', () => {\n    it('should generate a task DAG from user prompt', async () => {\n      const prompt = 'Add authentication to the user service';\n      const mockContext = {\n        files: ['/test/project/src/user-service.ts'],\n        projectInfo: { frameworks: ['express', 'typescript'] },\n      };\n\n      const mockDAG: TaskDAG = {\n        tasks: [\n          {\n            id: 'task-1',\n            type: 'create-file',\n            description: 'Create auth middleware',\n            dependencies: [],\n            rollbackPoint: 'before-task-1',\n            operations: [],\n            verification: [],\n            estimatedDuration: 30,\n          },\n        ],\n        dependencies: new Map([['task-1', []]]),\n        rollbackPoints: ['before-task-1'],\n        estimatedDuration: 30,\n      };\n\n      mockContextManager.buildContext = jest.fn().mockResolvedValue(mockContext);\n      mockPlannerAgent.generatePlan = jest.fn().mockResolvedValue(mockDAG);\n\n      const result = await orchestrator.planTask(prompt, mockContext as any);\n\n      expect(result).toBeDefined();\n      expect(result.tasks.length).toBe(1);\n      expect(result.tasks[0].description).toBe('Create auth middleware');\n      expect(mockContextManager.buildContext).toHaveBeenCalled();\n      expect(mockPlannerAgent.generatePlan).toHaveBeenCalledWith(prompt, mockContext);\n    });\n\n    it('should handle planning errors gracefully', async () => {\n      const prompt = 'Invalid task';\n      const mockContext = { files: [], projectInfo: {} };\n\n      mockContextManager.buildContext = jest.fn().mockResolvedValue(mockContext);\n      mockPlannerAgent.generatePlan = jest.fn().mockRejectedValue(new Error('Planning failed'));\n\n      await expect(orchestrator.planTask(prompt, mockContext as any)).rejects.toThrow('Planning failed');\n    });\n  });\n\n  describe('executeTask', () => {\n    it('should execute a task successfully', async () => {\n      const task: Task = {\n        id: 'task-1',\n        type: 'create-file',\n        description: 'Create test file',\n        dependencies: [],\n        rollbackPoint: 'before-task-1',\n        operations: [\n          {\n            type: 'create',\n            target: '/test/project/src/test.ts',\n            action: { code: 'export function test() {}' },\n            reversible: true,\n          },\n        ],\n        verification: [],\n        estimatedDuration: 10,\n      };\n\n      mockCodeGenerator.executeOperation = jest.fn().mockResolvedValue({\n        success: true,\n        output: 'File created successfully',\n      });\n\n      const result = await orchestrator.executeTask(task);\n\n      expect(result.success).toBe(true);\n      expect(result.taskId).toBe('task-1');\n      expect(mockCodeGenerator.executeOperation).toHaveBeenCalled();\n    });\n\n    it('should rollback on execution failure', async () => {\n      const task: Task = {\n        id: 'task-1',\n        type: 'modify-file',\n        description: 'Modify test file',\n        dependencies: [],\n        rollbackPoint: 'before-task-1',\n        operations: [\n          {\n            type: 'modify',\n            target: '/test/project/src/test.ts',\n            action: { code: 'invalid syntax' },\n            reversible: true,\n          },\n        ],\n        verification: [],\n        estimatedDuration: 10,\n      };\n\n      mockCodeGenerator.executeOperation = jest.fn().mockRejectedValue(new Error('Execution failed'));\n\n      const result = await orchestrator.executeTask(task);\n\n      expect(result.success).toBe(false);\n      expect(result.error).toBeDefined();\n    });\n  });\n\n  describe('selectModel', () => {\n    it('should select GPT-4 for complex tasks', () => {\n      const model = orchestrator.selectModel('refactor');\n      expect(model).toBe('gpt-4-turbo');\n    });\n\n    it('should select Claude for code generation', () => {\n      const model = orchestrator.selectModel('generate-code');\n      expect(model).toBe('claude-3-opus');\n    });\n\n    it('should select GPT-3.5 for simple tasks', () => {\n      const model = orchestrator.selectModel('simple');\n      expect(model).toBe('gpt-3.5-turbo');\n    });\n  });\n\n  describe('estimateCost', () => {\n    it('should estimate cost based on prompt length', async () => {\n      const prompt = 'Test prompt';\n      const cost = await orchestrator.estimateCost(prompt);\n      \n      expect(cost).toBeGreaterThan(0);\n      expect(typeof cost).toBe('number');\n    });\n\n    it('should return higher cost for longer prompts', async () => {\n      const shortPrompt = 'Short';\n      const longPrompt = 'This is a much longer prompt that should cost more to process';\n      \n      const shortCost = await orchestrator.estimateCost(shortPrompt);\n      const longCost = await orchestrator.estimateCost(longPrompt);\n      \n      expect(longCost).toBeGreaterThan(shortCost);\n    });\n  });\n\n  describe('caching', () => {\n    it('should cache AI responses', async () => {\n      const prompt = 'Test prompt';\n      const response = 'Test response';\n      \n      await orchestrator.cacheResponse(prompt, response);\n      const cached = await orchestrator.getCachedResponse(prompt);\n      \n      expect(cached).toBe(response);\n    });\n\n    it('should return null for uncached prompts', async () => {\n      const cached = await orchestrator.getCachedResponse('non-existent');\n      expect(cached).toBeNull();\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}