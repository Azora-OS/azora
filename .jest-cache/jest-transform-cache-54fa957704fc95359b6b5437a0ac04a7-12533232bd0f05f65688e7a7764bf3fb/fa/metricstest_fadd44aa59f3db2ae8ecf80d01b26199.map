{"version":3,"names":["_metrics","require","describe","it","initialCount","httpRequestTotal","get","method","route","status_code","values","value","recordHttpRequest","finalCount","expect","toBeGreaterThan","httpRequestDuration","toBeDefined","httpErrorsTotal","error_type","recordHttpError","dbQueryTotal","operation","table","status","recordDbQuery","aiQueryTotal","engine","recordAiQuery","aiErrorsTotal","recordAiError","cacheHitTotal","cache_type","recordCacheHit","cacheMissTotal","recordCacheMiss","updateSystemMetrics","not","toThrow"],"sources":["metrics.test.ts"],"sourcesContent":["/**\r\n * Metrics Tests\r\n */\r\n\r\nimport {\r\n  recordHttpRequest,\r\n  recordHttpError,\r\n  recordDbQuery,\r\n  recordAiQuery,\r\n  recordAiError,\r\n  recordCacheHit,\r\n  recordCacheMiss,\r\n  updateSystemMetrics,\r\n  httpRequestDuration,\r\n  httpRequestTotal,\r\n  httpErrorsTotal,\r\n  dbQueryDuration,\r\n  dbQueryTotal,\r\n  aiQueryDuration,\r\n  aiQueryTotal,\r\n  aiErrorsTotal,\r\n  cacheHitTotal,\r\n  cacheMissTotal,\r\n} from '../metrics';\r\n\r\ndescribe('Metrics', () => {\r\n  describe('recordHttpRequest', () => {\r\n    it('should record HTTP request metrics', () => {\r\n      const initialCount = (httpRequestTotal as any).get({\r\n        method: 'GET',\r\n        route: '/api/v1/courses',\r\n        status_code: '200',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordHttpRequest('GET', '/api/v1/courses', 200, 0.5);\r\n\r\n      const finalCount = (httpRequestTotal as any).get({\r\n        method: 'GET',\r\n        route: '/api/v1/courses',\r\n        status_code: '200',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n\r\n    it('should record HTTP request duration', () => {\r\n      recordHttpRequest('POST', '/api/v1/enrollments', 201, 1.2);\r\n      // Histogram records are stored internally\r\n      expect(httpRequestDuration).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('recordHttpError', () => {\r\n    it('should record HTTP errors', () => {\r\n      const initialCount = (httpErrorsTotal as any).get({\r\n        method: 'GET',\r\n        route: '/api/v1/courses',\r\n        error_type: 'ValidationError',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordHttpError('GET', '/api/v1/courses', 'ValidationError');\r\n\r\n      const finalCount = (httpErrorsTotal as any).get({\r\n        method: 'GET',\r\n        route: '/api/v1/courses',\r\n        error_type: 'ValidationError',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  describe('recordDbQuery', () => {\r\n    it('should record successful database queries', () => {\r\n      const initialCount = (dbQueryTotal as any).get({\r\n        operation: 'SELECT',\r\n        table: 'courses',\r\n        status: 'success',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordDbQuery('SELECT', 'courses', 0.05, 'success');\r\n\r\n      const finalCount = (dbQueryTotal as any).get({\r\n        operation: 'SELECT',\r\n        table: 'courses',\r\n        status: 'success',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n\r\n    it('should record failed database queries', () => {\r\n      const initialCount = (dbQueryTotal as any).get({\r\n        operation: 'INSERT',\r\n        table: 'enrollments',\r\n        status: 'error',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordDbQuery('INSERT', 'enrollments', 0.1, 'error');\r\n\r\n      const finalCount = (dbQueryTotal as any).get({\r\n        operation: 'INSERT',\r\n        table: 'enrollments',\r\n        status: 'error',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  describe('recordAiQuery', () => {\r\n    it('should record successful AI queries', () => {\r\n      const initialCount = (aiQueryTotal as any).get({\r\n        engine: 'elara',\r\n        operation: 'tutoring',\r\n        status: 'success',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordAiQuery('elara', 'tutoring', 2.5, 'success');\r\n\r\n      const finalCount = (aiQueryTotal as any).get({\r\n        engine: 'elara',\r\n        operation: 'tutoring',\r\n        status: 'success',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n\r\n    it('should record failed AI queries', () => {\r\n      const initialCount = (aiQueryTotal as any).get({\r\n        engine: 'knowledge-ocean',\r\n        operation: 'retrieval',\r\n        status: 'error',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordAiQuery('knowledge-ocean', 'retrieval', 5.0, 'error');\r\n\r\n      const finalCount = (aiQueryTotal as any).get({\r\n        engine: 'knowledge-ocean',\r\n        operation: 'retrieval',\r\n        status: 'error',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  describe('recordAiError', () => {\r\n    it('should record AI errors', () => {\r\n      const initialCount = (aiErrorsTotal as any).get({\r\n        engine: 'constitutional-ai',\r\n        error_type: 'ValidationError',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordAiError('constitutional-ai', 'ValidationError');\r\n\r\n      const finalCount = (aiErrorsTotal as any).get({\r\n        engine: 'constitutional-ai',\r\n        error_type: 'ValidationError',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  describe('recordCacheHit', () => {\r\n    it('should record cache hits', () => {\r\n      const initialCount = (cacheHitTotal as any).get({\r\n        cache_type: 'redis',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordCacheHit('redis');\r\n\r\n      const finalCount = (cacheHitTotal as any).get({\r\n        cache_type: 'redis',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  describe('recordCacheMiss', () => {\r\n    it('should record cache misses', () => {\r\n      const initialCount = (cacheMissTotal as any).get({\r\n        cache_type: 'redis',\r\n      })?.values[0]?.value || 0;\r\n\r\n      recordCacheMiss('redis');\r\n\r\n      const finalCount = (cacheMissTotal as any).get({\r\n        cache_type: 'redis',\r\n      })?.values[0]?.value || 0;\r\n\r\n      expect(finalCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  describe('updateSystemMetrics', () => {\r\n    it('should update system metrics without errors', () => {\r\n      expect(() => {\r\n        updateSystemMetrics();\r\n      }).not.toThrow();\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}