f777269559e370fd2d97d86d3b5057b1
"use strict";

_getJestObj().mock('@prisma/client');
var _globals = require("@jest/globals");
var _licenseService = require("../license-service");
var _client = require("@prisma/client");
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
(0, _globals.describe)('EnterpriseLicenseService', () => {
  let licenseService;
  let mockPrisma;
  (0, _globals.beforeEach)(() => {
    mockPrisma = new _client.PrismaClient();
    licenseService = new _licenseService.EnterpriseLicenseService();
  });
  (0, _globals.describe)('createLicense', () => {
    (0, _globals.it)('should create a new enterprise license', async () => {
      const licenseData = {
        organizationName: 'Acme Corp',
        organizationEmail: 'admin@acme.com',
        tier: 'PROFESSIONAL',
        maxUsers: 100,
        maxCourses: 50,
        startDate: new Date(),
        expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000)
      };
      const mockLicense = {
        id: 'lic_123',
        licenseKey: 'LIC-ABC-123-XYZ',
        ...licenseData,
        status: 'ACTIVE',
        createdAt: new Date()
      };
      mockPrisma.enterpriseLicense.create = _globals.jest.fn().mockResolvedValue(mockLicense);
      const result = await licenseService.createLicense(licenseData);
      (0, _globals.expect)(result.organizationName).toBe('Acme Corp');
      (0, _globals.expect)(result.status).toBe('ACTIVE');
      (0, _globals.expect)(mockPrisma.enterpriseLicense.create).toHaveBeenCalled();
    });
    (0, _globals.it)('should throw error if expiry date is before start date', async () => {
      const licenseData = {
        organizationName: 'Acme Corp',
        organizationEmail: 'admin@acme.com',
        tier: 'PROFESSIONAL',
        maxUsers: 100,
        startDate: new Date(),
        expiryDate: new Date(Date.now() - 1000)
      };
      await (0, _globals.expect)(licenseService.createLicense(licenseData)).rejects.toThrow('Expiry date must be after start date');
    });
  });
  (0, _globals.describe)('activateLicense', () => {
    (0, _globals.it)('should activate a license with valid key', async () => {
      const licenseKey = 'LIC-ABC-123-XYZ';
      const mockLicense = {
        id: 'lic_123',
        licenseKey,
        status: 'ACTIVE',
        organizationName: 'Acme Corp'
      };
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(mockLicense);
      mockPrisma.enterpriseLicense.update = _globals.jest.fn().mockResolvedValue({
        ...mockLicense,
        activatedAt: new Date()
      });
      const result = await licenseService.activateLicense(licenseKey);
      (0, _globals.expect)(result.status).toBe('ACTIVE');
      (0, _globals.expect)(mockPrisma.enterpriseLicense.findUnique).toHaveBeenCalledWith({
        where: {
          licenseKey
        }
      });
    });
    (0, _globals.it)('should throw error if license not found', async () => {
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(null);
      await (0, _globals.expect)(licenseService.activateLicense('INVALID-KEY')).rejects.toThrow('License not found');
    });
    (0, _globals.it)('should throw error if license is expired', async () => {
      const mockLicense = {
        id: 'lic_123',
        licenseKey: 'LIC-ABC-123-XYZ',
        status: 'EXPIRED',
        expiryDate: new Date(Date.now() - 1000)
      };
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(mockLicense);
      await (0, _globals.expect)(licenseService.activateLicense('LIC-ABC-123-XYZ')).rejects.toThrow('License has expired');
    });
  });
  (0, _globals.describe)('checkLicenseValidity', () => {
    (0, _globals.it)('should return true for valid active license', async () => {
      const licenseKey = 'LIC-ABC-123-XYZ';
      const mockLicense = {
        licenseKey,
        status: 'ACTIVE',
        expiryDate: new Date(Date.now() + 1000)
      };
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(mockLicense);
      const result = await licenseService.checkLicenseValidity(licenseKey);
      (0, _globals.expect)(result).toBe(true);
    });
    (0, _globals.it)('should return false for expired license', async () => {
      const licenseKey = 'LIC-ABC-123-XYZ';
      const mockLicense = {
        licenseKey,
        status: 'ACTIVE',
        expiryDate: new Date(Date.now() - 1000)
      };
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(mockLicense);
      const result = await licenseService.checkLicenseValidity(licenseKey);
      (0, _globals.expect)(result).toBe(false);
    });
    (0, _globals.it)('should return false if license not found', async () => {
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(null);
      const result = await licenseService.checkLicenseValidity('INVALID-KEY');
      (0, _globals.expect)(result).toBe(false);
    });
  });
  (0, _globals.describe)('getLicenseUsage', () => {
    (0, _globals.it)('should retrieve license usage statistics', async () => {
      const licenseId = 'lic_123';
      const mockUsage = {
        licenseId,
        activeUsers: 45,
        maxUsers: 100,
        coursesCreated: 12,
        maxCourses: 50,
        apiCallsThisMonth: 5000,
        maxApiCalls: 10000
      };
      mockPrisma.enterpriseLicense.findUnique = _globals.jest.fn().mockResolvedValue(mockUsage);
      const result = await licenseService.getLicenseUsage(licenseId);
      (0, _globals.expect)(result.activeUsers).toBe(45);
      (0, _globals.expect)(result.coursesCreated).toBe(12);
    });
  });
  (0, _globals.describe)('renewLicense', () => {
    (0, _globals.it)('should renew an expiring license', async () => {
      const licenseId = 'lic_123';
      const newExpiryDate = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000);
      const mockRenewedLicense = {
        id: licenseId,
        status: 'ACTIVE',
        expiryDate: newExpiryDate,
        renewedAt: new Date()
      };
      mockPrisma.enterpriseLicense.update = _globals.jest.fn().mockResolvedValue(mockRenewedLicense);
      const result = await licenseService.renewLicense(licenseId, newExpiryDate);
      (0, _globals.expect)(result.status).toBe('ACTIVE');
      (0, _globals.expect)(mockPrisma.enterpriseLicense.update).toHaveBeenCalled();
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfZ2xvYmFscyIsInJlcXVpcmUiLCJfbGljZW5zZVNlcnZpY2UiLCJfY2xpZW50IiwiamVzdCIsImRlc2NyaWJlIiwibGljZW5zZVNlcnZpY2UiLCJtb2NrUHJpc21hIiwiYmVmb3JlRWFjaCIsIlByaXNtYUNsaWVudCIsIkVudGVycHJpc2VMaWNlbnNlU2VydmljZSIsIml0IiwibGljZW5zZURhdGEiLCJvcmdhbml6YXRpb25OYW1lIiwib3JnYW5pemF0aW9uRW1haWwiLCJ0aWVyIiwibWF4VXNlcnMiLCJtYXhDb3Vyc2VzIiwic3RhcnREYXRlIiwiRGF0ZSIsImV4cGlyeURhdGUiLCJub3ciLCJtb2NrTGljZW5zZSIsImlkIiwibGljZW5zZUtleSIsInN0YXR1cyIsImNyZWF0ZWRBdCIsImVudGVycHJpc2VMaWNlbnNlIiwiY3JlYXRlIiwiZm4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInJlc3VsdCIsImNyZWF0ZUxpY2Vuc2UiLCJleHBlY3QiLCJ0b0JlIiwidG9IYXZlQmVlbkNhbGxlZCIsInJlamVjdHMiLCJ0b1Rocm93IiwiZmluZFVuaXF1ZSIsInVwZGF0ZSIsImFjdGl2YXRlZEF0IiwiYWN0aXZhdGVMaWNlbnNlIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJ3aGVyZSIsImNoZWNrTGljZW5zZVZhbGlkaXR5IiwibGljZW5zZUlkIiwibW9ja1VzYWdlIiwiYWN0aXZlVXNlcnMiLCJjb3Vyc2VzQ3JlYXRlZCIsImFwaUNhbGxzVGhpc01vbnRoIiwibWF4QXBpQ2FsbHMiLCJnZXRMaWNlbnNlVXNhZ2UiLCJuZXdFeHBpcnlEYXRlIiwibW9ja1JlbmV3ZWRMaWNlbnNlIiwicmVuZXdlZEF0IiwicmVuZXdMaWNlbnNlIl0sInNvdXJjZXMiOlsibGljZW5zZS1zZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcclxuaW1wb3J0IHsgRW50ZXJwcmlzZUxpY2Vuc2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGljZW5zZS1zZXJ2aWNlJztcclxuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xyXG5cclxuamVzdC5tb2NrKCdAcHJpc21hL2NsaWVudCcpO1xyXG5cclxuZGVzY3JpYmUoJ0VudGVycHJpc2VMaWNlbnNlU2VydmljZScsICgpID0+IHtcclxuICBsZXQgbGljZW5zZVNlcnZpY2U6IEVudGVycHJpc2VMaWNlbnNlU2VydmljZTtcclxuICBsZXQgbW9ja1ByaXNtYTogamVzdC5Nb2NrZWQ8UHJpc21hQ2xpZW50PjtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBtb2NrUHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpIGFzIGplc3QuTW9ja2VkPFByaXNtYUNsaWVudD47XHJcbiAgICBsaWNlbnNlU2VydmljZSA9IG5ldyBFbnRlcnByaXNlTGljZW5zZVNlcnZpY2UoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NyZWF0ZUxpY2Vuc2UnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyBlbnRlcnByaXNlIGxpY2Vuc2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxpY2Vuc2VEYXRhID0ge1xyXG4gICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6ICdBY21lIENvcnAnLFxyXG4gICAgICAgIG9yZ2FuaXphdGlvbkVtYWlsOiAnYWRtaW5AYWNtZS5jb20nLFxyXG4gICAgICAgIHRpZXI6ICdQUk9GRVNTSU9OQUwnIGFzIGNvbnN0LFxyXG4gICAgICAgIG1heFVzZXJzOiAxMDAsXHJcbiAgICAgICAgbWF4Q291cnNlczogNTAsXHJcbiAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIGV4cGlyeURhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tMaWNlbnNlID0ge1xyXG4gICAgICAgIGlkOiAnbGljXzEyMycsXHJcbiAgICAgICAgbGljZW5zZUtleTogJ0xJQy1BQkMtMTIzLVhZWicsXHJcbiAgICAgICAgLi4ubGljZW5zZURhdGEsXHJcbiAgICAgICAgc3RhdHVzOiAnQUNUSVZFJyxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrUHJpc21hLmVudGVycHJpc2VMaWNlbnNlLmNyZWF0ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTGljZW5zZSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaWNlbnNlU2VydmljZS5jcmVhdGVMaWNlbnNlKGxpY2Vuc2VEYXRhKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQub3JnYW5pemF0aW9uTmFtZSkudG9CZSgnQWNtZSBDb3JwJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKCdBQ1RJVkUnKTtcclxuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEuZW50ZXJwcmlzZUxpY2Vuc2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGV4cGlyeSBkYXRlIGlzIGJlZm9yZSBzdGFydCBkYXRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsaWNlbnNlRGF0YSA9IHtcclxuICAgICAgICBvcmdhbml6YXRpb25OYW1lOiAnQWNtZSBDb3JwJyxcclxuICAgICAgICBvcmdhbml6YXRpb25FbWFpbDogJ2FkbWluQGFjbWUuY29tJyxcclxuICAgICAgICB0aWVyOiAnUFJPRkVTU0lPTkFMJyBhcyBjb25zdCxcclxuICAgICAgICBtYXhVc2VyczogMTAwLFxyXG4gICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICBleHBpcnlEYXRlOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMTAwMCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCBleHBlY3QobGljZW5zZVNlcnZpY2UuY3JlYXRlTGljZW5zZShsaWNlbnNlRGF0YSkpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgICAnRXhwaXJ5IGRhdGUgbXVzdCBiZSBhZnRlciBzdGFydCBkYXRlJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdhY3RpdmF0ZUxpY2Vuc2UnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGFjdGl2YXRlIGEgbGljZW5zZSB3aXRoIHZhbGlkIGtleScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbGljZW5zZUtleSA9ICdMSUMtQUJDLTEyMy1YWVonO1xyXG4gICAgICBjb25zdCBtb2NrTGljZW5zZSA9IHtcclxuICAgICAgICBpZDogJ2xpY18xMjMnLFxyXG4gICAgICAgIGxpY2Vuc2VLZXksXHJcbiAgICAgICAgc3RhdHVzOiAnQUNUSVZFJyxcclxuICAgICAgICBvcmdhbml6YXRpb25OYW1lOiAnQWNtZSBDb3JwJyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tQcmlzbWEuZW50ZXJwcmlzZUxpY2Vuc2UuZmluZFVuaXF1ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTGljZW5zZSk7XHJcbiAgICAgIG1vY2tQcmlzbWEuZW50ZXJwcmlzZUxpY2Vuc2UudXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAuLi5tb2NrTGljZW5zZSxcclxuICAgICAgICBhY3RpdmF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaWNlbnNlU2VydmljZS5hY3RpdmF0ZUxpY2Vuc2UobGljZW5zZUtleSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZSgnQUNUSVZFJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmVudGVycHJpc2VMaWNlbnNlLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICB3aGVyZTogeyBsaWNlbnNlS2V5IH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBsaWNlbnNlIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja1ByaXNtYS5lbnRlcnByaXNlTGljZW5zZS5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KGxpY2Vuc2VTZXJ2aWNlLmFjdGl2YXRlTGljZW5zZSgnSU5WQUxJRC1LRVknKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgICdMaWNlbnNlIG5vdCBmb3VuZCdcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgaWYgbGljZW5zZSBpcyBleHBpcmVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTGljZW5zZSA9IHtcclxuICAgICAgICBpZDogJ2xpY18xMjMnLFxyXG4gICAgICAgIGxpY2Vuc2VLZXk6ICdMSUMtQUJDLTEyMy1YWVonLFxyXG4gICAgICAgIHN0YXR1czogJ0VYUElSRUQnLFxyXG4gICAgICAgIGV4cGlyeURhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgLSAxMDAwKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tQcmlzbWEuZW50ZXJwcmlzZUxpY2Vuc2UuZmluZFVuaXF1ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTGljZW5zZSk7XHJcblxyXG4gICAgICBhd2FpdCBleHBlY3QobGljZW5zZVNlcnZpY2UuYWN0aXZhdGVMaWNlbnNlKCdMSUMtQUJDLTEyMy1YWVonKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgICdMaWNlbnNlIGhhcyBleHBpcmVkJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjaGVja0xpY2Vuc2VWYWxpZGl0eScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgZm9yIHZhbGlkIGFjdGl2ZSBsaWNlbnNlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsaWNlbnNlS2V5ID0gJ0xJQy1BQkMtMTIzLVhZWic7XHJcbiAgICAgIGNvbnN0IG1vY2tMaWNlbnNlID0ge1xyXG4gICAgICAgIGxpY2Vuc2VLZXksXHJcbiAgICAgICAgc3RhdHVzOiAnQUNUSVZFJyxcclxuICAgICAgICBleHBpcnlEYXRlOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTAwMCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrUHJpc21hLmVudGVycHJpc2VMaWNlbnNlLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xpY2Vuc2UpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbGljZW5zZVNlcnZpY2UuY2hlY2tMaWNlbnNlVmFsaWRpdHkobGljZW5zZUtleSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIGV4cGlyZWQgbGljZW5zZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbGljZW5zZUtleSA9ICdMSUMtQUJDLTEyMy1YWVonO1xyXG4gICAgICBjb25zdCBtb2NrTGljZW5zZSA9IHtcclxuICAgICAgICBsaWNlbnNlS2V5LFxyXG4gICAgICAgIHN0YXR1czogJ0FDVElWRScsXHJcbiAgICAgICAgZXhwaXJ5RGF0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDEwMDApLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja1ByaXNtYS5lbnRlcnByaXNlTGljZW5zZS5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMaWNlbnNlKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxpY2Vuc2VTZXJ2aWNlLmNoZWNrTGljZW5zZVZhbGlkaXR5KGxpY2Vuc2VLZXkpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBpZiBsaWNlbnNlIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja1ByaXNtYS5lbnRlcnByaXNlTGljZW5zZS5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbGljZW5zZVNlcnZpY2UuY2hlY2tMaWNlbnNlVmFsaWRpdHkoJ0lOVkFMSUQtS0VZJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0TGljZW5zZVVzYWdlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBsaWNlbnNlIHVzYWdlIHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxpY2Vuc2VJZCA9ICdsaWNfMTIzJztcclxuICAgICAgY29uc3QgbW9ja1VzYWdlID0ge1xyXG4gICAgICAgIGxpY2Vuc2VJZCxcclxuICAgICAgICBhY3RpdmVVc2VyczogNDUsXHJcbiAgICAgICAgbWF4VXNlcnM6IDEwMCxcclxuICAgICAgICBjb3Vyc2VzQ3JlYXRlZDogMTIsXHJcbiAgICAgICAgbWF4Q291cnNlczogNTAsXHJcbiAgICAgICAgYXBpQ2FsbHNUaGlzTW9udGg6IDUwMDAsXHJcbiAgICAgICAgbWF4QXBpQ2FsbHM6IDEwMDAwLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja1ByaXNtYS5lbnRlcnByaXNlTGljZW5zZS5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2FnZSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaWNlbnNlU2VydmljZS5nZXRMaWNlbnNlVXNhZ2UobGljZW5zZUlkKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYWN0aXZlVXNlcnMpLnRvQmUoNDUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvdXJzZXNDcmVhdGVkKS50b0JlKDEyKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncmVuZXdMaWNlbnNlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZW5ldyBhbiBleHBpcmluZyBsaWNlbnNlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsaWNlbnNlSWQgPSAnbGljXzEyMyc7XHJcbiAgICAgIGNvbnN0IG5ld0V4cGlyeURhdGUgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XHJcblxyXG4gICAgICBjb25zdCBtb2NrUmVuZXdlZExpY2Vuc2UgPSB7XHJcbiAgICAgICAgaWQ6IGxpY2Vuc2VJZCxcclxuICAgICAgICBzdGF0dXM6ICdBQ1RJVkUnLFxyXG4gICAgICAgIGV4cGlyeURhdGU6IG5ld0V4cGlyeURhdGUsXHJcbiAgICAgICAgcmVuZXdlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja1ByaXNtYS5lbnRlcnByaXNlTGljZW5zZS51cGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlbmV3ZWRMaWNlbnNlKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxpY2Vuc2VTZXJ2aWNlLnJlbmV3TGljZW5zZShsaWNlbnNlSWQsIG5ld0V4cGlyeURhdGUpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoJ0FDVElWRScpO1xyXG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5lbnRlcnByaXNlTGljZW5zZS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUlBQSxXQUFBLEdBQUtDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztBQUozQixJQUFBQyxRQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxlQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxPQUFBLEdBQUFGLE9BQUE7QUFBOEMsU0FBQUgsWUFBQTtFQUFBO0lBQUFNO0VBQUEsSUFBQUgsT0FBQTtFQUFBSCxXQUFBLEdBQUFBLENBQUEsS0FBQU0sSUFBQTtFQUFBLE9BQUFBLElBQUE7QUFBQTtBQUk5QyxJQUFBQyxpQkFBUSxFQUFDLDBCQUEwQixFQUFFLE1BQU07RUFDekMsSUFBSUMsY0FBd0M7RUFDNUMsSUFBSUMsVUFBcUM7RUFFekMsSUFBQUMsbUJBQVUsRUFBQyxNQUFNO0lBQ2ZELFVBQVUsR0FBRyxJQUFJRSxvQkFBWSxDQUFDLENBQThCO0lBQzVESCxjQUFjLEdBQUcsSUFBSUksd0NBQXdCLENBQUMsQ0FBQztFQUNqRCxDQUFDLENBQUM7RUFFRixJQUFBTCxpQkFBUSxFQUFDLGVBQWUsRUFBRSxNQUFNO0lBQzlCLElBQUFNLFdBQUUsRUFBQyx3Q0FBd0MsRUFBRSxZQUFZO01BQ3ZELE1BQU1DLFdBQVcsR0FBRztRQUNsQkMsZ0JBQWdCLEVBQUUsV0FBVztRQUM3QkMsaUJBQWlCLEVBQUUsZ0JBQWdCO1FBQ25DQyxJQUFJLEVBQUUsY0FBdUI7UUFDN0JDLFFBQVEsRUFBRSxHQUFHO1FBQ2JDLFVBQVUsRUFBRSxFQUFFO1FBQ2RDLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQztRQUNyQkMsVUFBVSxFQUFFLElBQUlELElBQUksQ0FBQ0EsSUFB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