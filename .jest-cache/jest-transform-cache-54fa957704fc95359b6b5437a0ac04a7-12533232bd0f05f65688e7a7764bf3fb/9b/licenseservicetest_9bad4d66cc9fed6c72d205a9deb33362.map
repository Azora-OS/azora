{"version":3,"names":["_getJestObj","mock","_globals","require","_licenseService","_client","jest","describe","licenseService","mockPrisma","beforeEach","PrismaClient","EnterpriseLicenseService","it","licenseData","organizationName","organizationEmail","tier","maxUsers","maxCourses","startDate","Date","expiryDate","now","mockLicense","id","licenseKey","status","createdAt","enterpriseLicense","create","fn","mockResolvedValue","result","createLicense","expect","toBe","toHaveBeenCalled","rejects","toThrow","findUnique","update","activatedAt","activateLicense","toHaveBeenCalledWith","where","checkLicenseValidity","licenseId","mockUsage","activeUsers","coursesCreated","apiCallsThisMonth","maxApiCalls","getLicenseUsage","newExpiryDate","mockRenewedLicense","renewedAt","renewLicense"],"sources":["license-service.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, jest } from '@jest/globals';\r\nimport { EnterpriseLicenseService } from '../license-service';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\njest.mock('@prisma/client');\r\n\r\ndescribe('EnterpriseLicenseService', () => {\r\n  let licenseService: EnterpriseLicenseService;\r\n  let mockPrisma: jest.Mocked<PrismaClient>;\r\n\r\n  beforeEach(() => {\r\n    mockPrisma = new PrismaClient() as jest.Mocked<PrismaClient>;\r\n    licenseService = new EnterpriseLicenseService();\r\n  });\r\n\r\n  describe('createLicense', () => {\r\n    it('should create a new enterprise license', async () => {\r\n      const licenseData = {\r\n        organizationName: 'Acme Corp',\r\n        organizationEmail: 'admin@acme.com',\r\n        tier: 'PROFESSIONAL' as const,\r\n        maxUsers: 100,\r\n        maxCourses: 50,\r\n        startDate: new Date(),\r\n        expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),\r\n      };\r\n\r\n      const mockLicense = {\r\n        id: 'lic_123',\r\n        licenseKey: 'LIC-ABC-123-XYZ',\r\n        ...licenseData,\r\n        status: 'ACTIVE',\r\n        createdAt: new Date(),\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.create = jest.fn().mockResolvedValue(mockLicense);\r\n\r\n      const result = await licenseService.createLicense(licenseData);\r\n\r\n      expect(result.organizationName).toBe('Acme Corp');\r\n      expect(result.status).toBe('ACTIVE');\r\n      expect(mockPrisma.enterpriseLicense.create).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should throw error if expiry date is before start date', async () => {\r\n      const licenseData = {\r\n        organizationName: 'Acme Corp',\r\n        organizationEmail: 'admin@acme.com',\r\n        tier: 'PROFESSIONAL' as const,\r\n        maxUsers: 100,\r\n        startDate: new Date(),\r\n        expiryDate: new Date(Date.now() - 1000),\r\n      };\r\n\r\n      await expect(licenseService.createLicense(licenseData)).rejects.toThrow(\r\n        'Expiry date must be after start date'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('activateLicense', () => {\r\n    it('should activate a license with valid key', async () => {\r\n      const licenseKey = 'LIC-ABC-123-XYZ';\r\n      const mockLicense = {\r\n        id: 'lic_123',\r\n        licenseKey,\r\n        status: 'ACTIVE',\r\n        organizationName: 'Acme Corp',\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(mockLicense);\r\n      mockPrisma.enterpriseLicense.update = jest.fn().mockResolvedValue({\r\n        ...mockLicense,\r\n        activatedAt: new Date(),\r\n      });\r\n\r\n      const result = await licenseService.activateLicense(licenseKey);\r\n\r\n      expect(result.status).toBe('ACTIVE');\r\n      expect(mockPrisma.enterpriseLicense.findUnique).toHaveBeenCalledWith({\r\n        where: { licenseKey },\r\n      });\r\n    });\r\n\r\n    it('should throw error if license not found', async () => {\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(null);\r\n\r\n      await expect(licenseService.activateLicense('INVALID-KEY')).rejects.toThrow(\r\n        'License not found'\r\n      );\r\n    });\r\n\r\n    it('should throw error if license is expired', async () => {\r\n      const mockLicense = {\r\n        id: 'lic_123',\r\n        licenseKey: 'LIC-ABC-123-XYZ',\r\n        status: 'EXPIRED',\r\n        expiryDate: new Date(Date.now() - 1000),\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(mockLicense);\r\n\r\n      await expect(licenseService.activateLicense('LIC-ABC-123-XYZ')).rejects.toThrow(\r\n        'License has expired'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('checkLicenseValidity', () => {\r\n    it('should return true for valid active license', async () => {\r\n      const licenseKey = 'LIC-ABC-123-XYZ';\r\n      const mockLicense = {\r\n        licenseKey,\r\n        status: 'ACTIVE',\r\n        expiryDate: new Date(Date.now() + 1000),\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(mockLicense);\r\n\r\n      const result = await licenseService.checkLicenseValidity(licenseKey);\r\n\r\n      expect(result).toBe(true);\r\n    });\r\n\r\n    it('should return false for expired license', async () => {\r\n      const licenseKey = 'LIC-ABC-123-XYZ';\r\n      const mockLicense = {\r\n        licenseKey,\r\n        status: 'ACTIVE',\r\n        expiryDate: new Date(Date.now() - 1000),\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(mockLicense);\r\n\r\n      const result = await licenseService.checkLicenseValidity(licenseKey);\r\n\r\n      expect(result).toBe(false);\r\n    });\r\n\r\n    it('should return false if license not found', async () => {\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(null);\r\n\r\n      const result = await licenseService.checkLicenseValidity('INVALID-KEY');\r\n\r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('getLicenseUsage', () => {\r\n    it('should retrieve license usage statistics', async () => {\r\n      const licenseId = 'lic_123';\r\n      const mockUsage = {\r\n        licenseId,\r\n        activeUsers: 45,\r\n        maxUsers: 100,\r\n        coursesCreated: 12,\r\n        maxCourses: 50,\r\n        apiCallsThisMonth: 5000,\r\n        maxApiCalls: 10000,\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.findUnique = jest.fn().mockResolvedValue(mockUsage);\r\n\r\n      const result = await licenseService.getLicenseUsage(licenseId);\r\n\r\n      expect(result.activeUsers).toBe(45);\r\n      expect(result.coursesCreated).toBe(12);\r\n    });\r\n  });\r\n\r\n  describe('renewLicense', () => {\r\n    it('should renew an expiring license', async () => {\r\n      const licenseId = 'lic_123';\r\n      const newExpiryDate = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000);\r\n\r\n      const mockRenewedLicense = {\r\n        id: licenseId,\r\n        status: 'ACTIVE',\r\n        expiryDate: newExpiryDate,\r\n        renewedAt: new Date(),\r\n      };\r\n\r\n      mockPrisma.enterpriseLicense.update = jest.fn().mockResolvedValue(mockRenewedLicense);\r\n\r\n      const result = await licenseService.renewLicense(licenseId, newExpiryDate);\r\n\r\n      expect(result.status).toBe('ACTIVE');\r\n      expect(mockPrisma.enterpriseLicense.update).toHaveBeenCalled();\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}