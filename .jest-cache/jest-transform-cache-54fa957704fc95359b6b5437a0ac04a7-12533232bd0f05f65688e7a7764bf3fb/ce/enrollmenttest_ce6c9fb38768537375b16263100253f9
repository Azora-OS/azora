6c961aafc52810b86e8e51b9abc35f7f
"use strict";

var _factories = require("../../../tests/factories");
var _database = require("../../../tests/utils/database");
const prisma = (0, _database.getTestPrismaClient)();
describe('Education Service - Enrollment', () => {
  afterEach(async () => {
    await (0, _database.cleanupTestDatabase)();
  });
  it('should create enrollment', async () => {
    const student = await _factories.userFactory.createStudent();
    const instructor = await _factories.userFactory.createInstructor();
    const course = await _factories.courseFactory.create({
      instructorId: instructor.id
    });
    const enrollment = await _factories.enrollmentFactory.create({
      userId: student.id,
      courseId: course.id
    });
    expect(enrollment).toBeDefined();
    expect(enrollment.userId).toBe(student.id);
    expect(enrollment.courseId).toBe(course.id);
  });
  it('should update enrollment progress', async () => {
    const student = await _factories.userFactory.createStudent();
    const instructor = await _factories.userFactory.createInstructor();
    const course = await _factories.courseFactory.create({
      instructorId: instructor.id
    });
    const enrollment = await _factories.enrollmentFactory.create({
      userId: student.id,
      courseId: course.id,
      progress: 50
    });
    const updated = await prisma.enrollment.update({
      where: {
        id: enrollment.id
      },
      data: {
        progress: 75
      }
    });
    expect(updated.progress).toBe(75);
  });
  it('should complete enrollment', async () => {
    const student = await _factories.userFactory.createStudent();
    const instructor = await _factories.userFactory.createInstructor();
    const course = await _factories.courseFactory.create({
      instructorId: instructor.id
    });
    const enrollment = await _factories.enrollmentFactory.create({
      userId: student.id,
      courseId: course.id
    });
    const completed = await prisma.enrollment.update({
      where: {
        id: enrollment.id
      },
      data: {
        status: 'COMPLETED',
        progress: 100,
        completedAt: new Date()
      }
    });
    expect(completed.status).toBe('COMPLETED');
    expect(completed.progress).toBe(100);
    expect(completed.completedAt).toBeDefined();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmFjdG9yaWVzIiwicmVxdWlyZSIsIl9kYXRhYmFzZSIsInByaXNtYSIsImdldFRlc3RQcmlzbWFDbGllbnQiLCJkZXNjcmliZSIsImFmdGVyRWFjaCIsImNsZWFudXBUZXN0RGF0YWJhc2UiLCJpdCIsInN0dWRlbnQiLCJ1c2VyRmFjdG9yeSIsImNyZWF0ZVN0dWRlbnQiLCJpbnN0cnVjdG9yIiwiY3JlYXRlSW5zdHJ1Y3RvciIsImNvdXJzZSIsImNvdXJzZUZhY3RvcnkiLCJjcmVhdGUiLCJpbnN0cnVjdG9ySWQiLCJpZCIsImVucm9sbG1lbnQiLCJlbnJvbGxtZW50RmFjdG9yeSIsInVzZXJJZCIsImNvdXJzZUlkIiwiZXhwZWN0IiwidG9CZURlZmluZWQiLCJ0b0JlIiwicHJvZ3Jlc3MiLCJ1cGRhdGVkIiwidXBkYXRlIiwid2hlcmUiLCJkYXRhIiwiY29tcGxldGVkIiwic3RhdHVzIiwiY29tcGxldGVkQXQiLCJEYXRlIl0sInNvdXJjZXMiOlsiZW5yb2xsbWVudC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZXJGYWN0b3J5LCBjb3Vyc2VGYWN0b3J5LCBlbnJvbGxtZW50RmFjdG9yeSB9IGZyb20gJy4uLy4uLy4uL3Rlc3RzL2ZhY3Rvcmllcyc7XG5pbXBvcnQgeyBnZXRUZXN0UHJpc21hQ2xpZW50LCBjbGVhbnVwVGVzdERhdGFiYXNlIH0gZnJvbSAnLi4vLi4vLi4vdGVzdHMvdXRpbHMvZGF0YWJhc2UnO1xuXG5jb25zdCBwcmlzbWEgPSBnZXRUZXN0UHJpc21hQ2xpZW50KCk7XG5cbmRlc2NyaWJlKCdFZHVjYXRpb24gU2VydmljZSAtIEVucm9sbG1lbnQnLCAoKSA9PiB7XG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgY2xlYW51cFRlc3REYXRhYmFzZSgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNyZWF0ZSBlbnJvbGxtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCB1c2VyRmFjdG9yeS5jcmVhdGVTdHVkZW50KCk7XG4gICAgY29uc3QgaW5zdHJ1Y3RvciA9IGF3YWl0IHVzZXJGYWN0b3J5LmNyZWF0ZUluc3RydWN0b3IoKTtcbiAgICBjb25zdCBjb3Vyc2UgPSBhd2FpdCBjb3Vyc2VGYWN0b3J5LmNyZWF0ZSh7IGluc3RydWN0b3JJZDogaW5zdHJ1Y3Rvci5pZCB9KTtcblxuICAgIGNvbnN0IGVucm9sbG1lbnQgPSBhd2FpdCBlbnJvbGxtZW50RmFjdG9yeS5jcmVhdGUoe1xuICAgICAgdXNlcklkOiBzdHVkZW50LmlkLFxuICAgICAgY291cnNlSWQ6IGNvdXJzZS5pZCxcbiAgICB9KTtcblxuICAgIGV4cGVjdChlbnJvbGxtZW50KS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChlbnJvbGxtZW50LnVzZXJJZCkudG9CZShzdHVkZW50LmlkKTtcbiAgICBleHBlY3QoZW5yb2xsbWVudC5jb3Vyc2VJZCkudG9CZShjb3Vyc2UuaWQpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHVwZGF0ZSBlbnJvbGxtZW50IHByb2dyZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCB1c2VyRmFjdG9yeS5jcmVhdGVTdHVkZW50KCk7XG4gICAgY29uc3QgaW5zdHJ1Y3RvciA9IGF3YWl0IHVzZXJGYWN0b3J5LmNyZWF0ZUluc3RydWN0b3IoKTtcbiAgICBjb25zdCBjb3Vyc2UgPSBhd2FpdCBjb3Vyc2VGYWN0b3J5LmNyZWF0ZSh7IGluc3RydWN0b3JJZDogaW5zdHJ1Y3Rvci5pZCB9KTtcblxuICAgIGNvbnN0IGVucm9sbG1lbnQgPSBhd2FpdCBlbnJvbGxtZW50RmFjdG9yeS5jcmVhdGUoe1xuICAgICAgdXNlcklkOiBzdHVkZW50LmlkLFxuICAgICAgY291cnNlSWQ6IGNvdXJzZS5pZCxcbiAgICAgIHByb2dyZXNzOiA1MCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBwcmlzbWEuZW5yb2xsbWVudC51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IGVucm9sbG1lbnQuaWQgfSxcbiAgICAgIGRhdGE6IHsgcHJvZ3Jlc3M6IDc1IH0sXG4gICAgfSk7XG5cbiAgICBleHBlY3QodXBkYXRlZC5wcm9ncmVzcykudG9CZSg3NSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY29tcGxldGUgZW5yb2xsbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgdXNlckZhY3RvcnkuY3JlYXRlU3R1ZGVudCgpO1xuICAgIGNvbnN0IGluc3RydWN0b3IgPSBhd2FpdCB1c2VyRmFjdG9yeS5jcmVhdGVJbnN0cnVjdG9yKCk7XG4gICAgY29uc3QgY291cnNlID0gYXdhaXQgY291cnNlRmFjdG9yeS5jcmVhdGUoeyBpbnN0cnVjdG9ySWQ6IGluc3RydWN0b3IuaWQgfSk7XG5cbiAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgZW5yb2xsbWVudEZhY3RvcnkuY3JlYXRlKHtcbiAgICAgIHVzZXJJZDogc3R1ZGVudC5pZCxcbiAgICAgIGNvdXJzZUlkOiBjb3Vyc2UuaWQsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjb21wbGV0ZWQgPSBhd2FpdCBwcmlzbWEuZW5yb2xsbWVudC51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IGVucm9sbG1lbnQuaWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICAgICAgcHJvZ3Jlc3M6IDEwMCxcbiAgICAgICAgY29tcGxldGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KGNvbXBsZXRlZC5zdGF0dXMpLnRvQmUoJ0NPTVBMRVRFRCcpO1xuICAgIGV4cGVjdChjb21wbGV0ZWQucHJvZ3Jlc3MpLnRvQmUoMTAwKTtcbiAgICBleHBlY3QoY29tcGxldGVkLmNvbXBsZXRlZEF0KS50b0JlRGVmaW5lZCgpO1xuICB9KTtcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7QUFB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