{"version":3,"names":["request","require","app","describe","it","response","get","expect","body","status","toBe","service","success","Array","isArray","data","count","toBeGreaterThanOrEqual","id","error","caseData","title","description","priority","parties","post","send","caseId","beforeAll","updateData","resolution","put","complianceData","action","context","userId","dataType","compliant","complianceResponse","length","violationId","violationResponse"],"sources":["constitutional-court.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst app = require('../index.js');\r\n\r\ndescribe('Constitutional Court Service', () => {\r\n  // Health check test\r\n  describe('GET /health', () => {\r\n    it('should return health status', async () => {\r\n      const response = await request(app)\r\n        .get('/health')\r\n        .expect(200);\r\n      \r\n      expect(response.body.status).toBe('healthy');\r\n      expect(response.body.service).toBe('constitutional-court-service');\r\n    });\r\n  });\r\n\r\n  // Get all constitutional cases test\r\n  describe('GET /api/cases', () => {\r\n    it('should return all constitutional cases', async () => {\r\n      const response = await request(app)\r\n        .get('/api/cases')\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(Array.isArray(response.body.data)).toBe(true);\r\n      expect(response.body.count).toBeGreaterThanOrEqual(0);\r\n    });\r\n  });\r\n\r\n  // Get specific constitutional case test\r\n  describe('GET /api/cases/:caseId', () => {\r\n    it('should return specific constitutional case', async () => {\r\n      const response = await request(app)\r\n        .get('/api/cases/case_1')\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.id).toBe('case_1');\r\n    });\r\n\r\n    it('should return 404 for non-existent case', async () => {\r\n      const response = await request(app)\r\n        .get('/api/cases/non-existent')\r\n        .expect(404);\r\n      \r\n      expect(response.body.error).toBe('Case not found');\r\n    });\r\n  });\r\n\r\n  // File a new constitutional case test\r\n  describe('POST /api/cases', () => {\r\n    it('should file a new constitutional case', async () => {\r\n      const caseData = {\r\n        title: 'New Constitutional Case',\r\n        description: 'Description of the new case',\r\n        priority: 'high',\r\n        parties: ['Party A', 'Party B']\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/cases')\r\n        .send(caseData)\r\n        .expect(201);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.title).toBe('New Constitutional Case');\r\n      expect(response.body.data.status).toBe('open');\r\n    });\r\n\r\n    it('should return 400 for missing required fields', async () => {\r\n      const caseData = {\r\n        title: 'New Case'\r\n        // Missing description\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/cases')\r\n        .send(caseData)\r\n        .expect(400);\r\n      \r\n      expect(response.body.error).toBe('Title and description are required');\r\n    });\r\n  });\r\n\r\n  // Update constitutional case status test\r\n  describe('PUT /api/cases/:caseId', () => {\r\n    let caseId;\r\n\r\n    beforeAll(async () => {\r\n      // Create a case first\r\n      const caseData = {\r\n        title: 'Test Case',\r\n        description: 'Test case for updating'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/cases')\r\n        .send(caseData);\r\n\r\n      caseId = response.body.data.id;\r\n    });\r\n\r\n    it('should update constitutional case status', async () => {\r\n      const updateData = {\r\n        status: 'in_progress',\r\n        resolution: 'Case is under investigation',\r\n        priority: 'high'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .put(`/api/cases/${caseId}`)\r\n        .send(updateData)\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.status).toBe('in_progress');\r\n      expect(response.body.data.resolution).toBe('Case is under investigation');\r\n      expect(response.body.data.priority).toBe('high');\r\n    });\r\n\r\n    it('should return 404 for non-existent case', async () => {\r\n      const updateData = {\r\n        status: 'resolved'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .put('/api/cases/non-existent')\r\n        .send(updateData)\r\n        .expect(404);\r\n      \r\n      expect(response.body.error).toBe('Case not found');\r\n    });\r\n  });\r\n\r\n  // Constitutional compliance check test\r\n  describe('POST /api/compliance/check', () => {\r\n    it('should check constitutional compliance', async () => {\r\n      const complianceData = {\r\n        action: 'data_processing',\r\n        context: { userId: 'user_123', dataType: 'personal' },\r\n        userId: 'user_123'\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/compliance/check')\r\n        .send(complianceData)\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(response.body.data.action).toBe('data_processing');\r\n      expect(typeof response.body.data.compliant).toBe('boolean');\r\n    });\r\n\r\n    it('should return 400 for missing required fields', async () => {\r\n      const complianceData = {\r\n        context: { userId: 'user_123' }\r\n        // Missing action\r\n      };\r\n\r\n      const response = await request(app)\r\n        .post('/api/compliance/check')\r\n        .send(complianceData)\r\n        .expect(400);\r\n      \r\n      expect(response.body.error).toBe('Action is required');\r\n    });\r\n  });\r\n\r\n  // Get all constitutional violations test\r\n  describe('GET /api/compliance/violations', () => {\r\n    it('should return all constitutional violations', async () => {\r\n      const response = await request(app)\r\n        .get('/api/compliance/violations')\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(Array.isArray(response.body.data)).toBe(true);\r\n      expect(response.body.count).toBeGreaterThanOrEqual(0);\r\n    });\r\n  });\r\n\r\n  // Get specific constitutional violation test\r\n  describe('GET /api/compliance/violations/:violationId', () => {\r\n    it('should return specific constitutional violation', async () => {\r\n      // First trigger a compliance check that generates a violation\r\n      const complianceData = {\r\n        action: 'unauthorized_data_access',\r\n        context: { userId: 'user_123' }\r\n      };\r\n\r\n      const complianceResponse = await request(app)\r\n        .post('/api/compliance/check')\r\n        .send(complianceData);\r\n\r\n      // Then fetch violations\r\n      const response = await request(app)\r\n        .get('/api/compliance/violations')\r\n        .expect(200);\r\n\r\n      if (response.body.data.length > 0) {\r\n        const violationId = response.body.data[0].id;\r\n        const violationResponse = await request(app)\r\n          .get(`/api/compliance/violations/${violationId}`)\r\n          .expect(200);\r\n        \r\n        expect(violationResponse.body.success).toBe(true);\r\n        expect(violationResponse.body.data.id).toBe(violationId);\r\n      }\r\n    });\r\n\r\n    it('should return 404 for non-existent violation', async () => {\r\n      const response = await request(app)\r\n        .get('/api/compliance/violations/non-existent')\r\n        .expect(404);\r\n      \r\n      expect(response.body.error).toBe('Violation not found');\r\n    });\r\n  });\r\n\r\n  // Search cases test\r\n  describe('GET /api/cases/search', () => {\r\n    it('should search cases by status', async () => {\r\n      const response = await request(app)\r\n        .get('/api/cases/search?status=open')\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(Array.isArray(response.body.data)).toBe(true);\r\n    });\r\n\r\n    it('should search cases by priority', async () => {\r\n      const response = await request(app)\r\n        .get('/api/cases/search?priority=high')\r\n        .expect(200);\r\n      \r\n      expect(response.body.success).toBe(true);\r\n      expect(Array.isArray(response.body.data)).toBe(true);\r\n    });\r\n  });\r\n});"],"mappings":"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","ignoreList":[]}