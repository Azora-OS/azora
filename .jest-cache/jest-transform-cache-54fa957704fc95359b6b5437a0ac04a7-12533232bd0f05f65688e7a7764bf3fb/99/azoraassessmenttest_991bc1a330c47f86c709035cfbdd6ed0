57a120ad180b0d418161be594547723d
"use strict";

const request = require('supertest');
const app = require('../server');
describe('azora-assessment Service', () => {
  describe('Health Check', () => {
    it('should return healthy status', async () => {
      const response = await request(app).get('/api/health').expect(200);
      expect(response.body.status).toBe('healthy');
      expect(response.body.service).toBeDefined();
      expect(response.body.timestamp).toBeDefined();
    });
  });
  describe('API Endpoints', () => {
    it('should handle 404 for non-existent endpoints', async () => {
      const response = await request(app).get('/api/non-existent').expect(404);
      expect(response.body.success).toBe(false);
      expect(response.body.error).toBe('Endpoint not found');
    });
    it('should handle invalid JSON', async () => {
      const response = await request(app).post('/api/test').send('invalid json').expect(400);
    });
  });
  describe('Security', () => {
    it('should have security headers', async () => {
      const response = await request(app).get('/api/health');
      expect(response.headers['x-content-type-options']).toBeDefined();
      expect(response.headers['x-frame-options']).toBeDefined();
    });
    it('should handle rate limiting', async () => {
      // Make multiple requests to test rate limiting
      const promises = Array(10).fill().map(() => request(app).get('/api/health'));
      const responses = await Promise.all(promises);
      expect(responses.every(r => r.status === 200 || r.status === 429)).toBe(true);
    });
  });
  describe('Error Handling', () => {
    it('should handle server errors gracefully', async () => {
      // Test error middleware
      const response = await request(app).get('/api/health');
      expect(response.status).toBeLessThan(500);
    });
  });
  describe('Input Validation', () => {
    it('should sanitize XSS attempts', async () => {
      const maliciousInput = '<script>alert("xss")</script>';
      const response = await request(app).post('/api/test').send({
        data: maliciousInput
      });

      // Should not contain script tags in response
      expect(JSON.stringify(response.body)).not.toContain('<script>');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsImJvZHkiLCJzdGF0dXMiLCJ0b0JlIiwic2VydmljZSIsInRvQmVEZWZpbmVkIiwidGltZXN0YW1wIiwic3VjY2VzcyIsImVycm9yIiwicG9zdCIsInNlbmQiLCJoZWFkZXJzIiwicHJvbWlzZXMiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJyZXNwb25zZXMiLCJQcm9taXNlIiwiYWxsIiwiZXZlcnkiLCJyIiwidG9CZUxlc3NUaGFuIiwibWFsaWNpb3VzSW5wdXQiLCJkYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5vdCIsInRvQ29udGFpbiJdLCJzb3VyY2VzIjpbImF6b3JhLWFzc2Vzc21lbnQudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG5jb25zdCBhcHAgPSByZXF1aXJlKCcuLi9zZXJ2ZXInKTtcblxuZGVzY3JpYmUoJ2F6b3JhLWFzc2Vzc21lbnQgU2VydmljZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0hlYWx0aCBDaGVjaycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBoZWFsdGh5IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvaGVhbHRoJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoJ2hlYWx0aHknKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS50aW1lc3RhbXApLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBUEkgRW5kcG9pbnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIDQwNCBmb3Igbm9uLWV4aXN0ZW50IGVuZHBvaW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvbm9uLWV4aXN0ZW50JylcbiAgICAgICAgLmV4cGVjdCg0MDQpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlKCdFbmRwb2ludCBub3QgZm91bmQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgSlNPTicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3Rlc3QnKVxuICAgICAgICAuc2VuZCgnaW52YWxpZCBqc29uJylcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYXZlIHNlY3VyaXR5IGhlYWRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2hlYWx0aCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVyc1sneC1jb250ZW50LXR5cGUtb3B0aW9ucyddKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnNbJ3gtZnJhbWUtb3B0aW9ucyddKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmF0ZSBsaW1pdGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1ha2UgbXVsdGlwbGUgcmVxdWVzdHMgdG8gdGVzdCByYXRlIGxpbWl0aW5nXG4gICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5KDEwKS5maWxsKCkubWFwKCgpID0+IFxuICAgICAgICByZXF1ZXN0KGFwcCkuZ2V0KCcvYXBpL2hlYWx0aCcpXG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZXMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBleHBlY3QocmVzcG9uc2VzLmV2ZXJ5KHIgPT4gci5zdGF0dXMgPT09IDIwMCB8fCByLnN0YXR1cyA9PT0gNDI5KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZlciBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgZXJyb3IgbWlkZGxld2FyZVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9oZWFsdGgnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZUxlc3NUaGFuKDUwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnB1dCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgWFNTIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWFsaWNpb3VzSW5wdXQgPSAnPHNjcmlwdD5hbGVydChcInhzc1wiKTwvc2NyaXB0Pic7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3Rlc3QnKVxuICAgICAgICAuc2VuZCh7IGRhdGE6IG1hbGljaW91c0lucHV0IH0pO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IGNvbnRhaW4gc2NyaXB0IHRhZ3MgaW4gcmVzcG9uc2VcbiAgICAgIGV4cGVjdChKU09OLnN0cmluZ2lmeShyZXNwb25zZS5ib2R5KSkubm90LnRvQ29udGFpbignPHNjcmlwdD4nKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ3BDLE1BQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUVoQ0UsUUFBUSxDQUFDLDBCQUEwQixFQUFFLE1BQU07RUFDekNBLFFBQVEsQ0FBQyxjQUFjLEVBQUUsTUFBTTtJQUM3QkMsRUFBRSxDQUFDLDhCQUE4QixFQUFFLFlBQVk7TUFDN0MsTUFBTUMsUUFBUSxHQUFHLE1BQU1MLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQ2hDSSxHQUFHLENBQUMsYUFBYSxDQUFDLENBQ2xCQyxNQUFNLENBQUMsR0FBRyxDQUFDO01BRWRBLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDRyxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsU0FBUyxDQUFDO01BQzVDSCxNQUFNLENBQUNGLFFBQVEsQ0FBQ0csSUFBSSxDQUFDRyxPQUFPLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7TUFDM0NMLE1BQU0sQ0FBQ0YsUUFBUSxDQUFDRyxJQUFJLENBQUNLLFNBQVMsQ0FBQyxDQUFDRCxXQUFXLENBQUMsQ0FBQztJQUMvQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRlQsUUFBUSxDQUFDLGVBQWUsRUFBRSxNQUFNO0lBQzlCQyxFQUFFLENBQUMsOENBQThDLEVBQUUsWUFBWTtNQUM3RCxNQUFNQyxRQUFRLEdBQUcsTUFBTUwsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDaENJLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUN4QkMsTUFBTSxDQUFDLEdBQUcsQ0FBQztNQUVkQSxNQUFNLENBQUNGLFFBQVEsQ0FBQ0csSUFBSSxDQUFDTSxPQUFP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