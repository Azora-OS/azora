{"version":3,"names":["request","require","express","createTestApp","app","use","json","get","req","res","status","service","timestamp","Date","toISOString","post","familyMember","message","body","error","response_data","conversationId","now","response","selectedMember","members","id","name","specialty","count","topic","consultation","consultationId","responses","describe","beforeEach","it","expect","toBe","send","toHaveProperty","Array","isArray","length","toBeGreaterThan"],"sources":["ai-family.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst express = require('express');\r\n\r\nfunction createTestApp() {\r\n  const app = express();\r\n  app.use(express.json());\r\n\r\n  app.get('/api/health', (req, res) => {\r\n    res.json({\r\n      status: 'OK',\r\n      service: 'AI Family Service',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  });\r\n\r\n  app.post('/api/chat/chat', (req, res) => {\r\n    const { familyMember, message } = req.body;\r\n\r\n    if (!familyMember || !message) {\r\n      return res.status(400).json({ error: 'Family member and message are required' });\r\n    }\r\n\r\n    const response_data = {\r\n      conversationId: `conv_${Date.now()}`,\r\n      familyMember,\r\n      message,\r\n      response: `Response from ${familyMember}`,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    res.json(response_data);\r\n  });\r\n\r\n  app.post('/api/chat/auto-chat', (req, res) => {\r\n    const { message } = req.body;\r\n\r\n    if (!message) {\r\n      return res.status(400).json({ error: 'Message is required' });\r\n    }\r\n\r\n    const response_data = {\r\n      conversationId: `conv_${Date.now()}`,\r\n      selectedMember: 'elara',\r\n      message,\r\n      response: 'Auto-selected response',\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    res.json(response_data);\r\n  });\r\n\r\n  app.get('/api/chat/family-config', (req, res) => {\r\n    res.json({\r\n      members: [\r\n        { id: 'elara', name: 'Elara', specialty: 'education' },\r\n        { id: 'sage', name: 'Sage', specialty: 'wisdom' }\r\n      ],\r\n      count: 2\r\n    });\r\n  });\r\n\r\n  app.post('/api/chat/consult-family', (req, res) => {\r\n    const { topic, members } = req.body;\r\n\r\n    if (!topic) {\r\n      return res.status(400).json({ error: 'Topic is required' });\r\n    }\r\n\r\n    const consultation = {\r\n      consultationId: `consult_${Date.now()}`,\r\n      topic,\r\n      responses: [],\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    res.json(consultation);\r\n  });\r\n\r\n  return app;\r\n}\r\n\r\ndescribe('AI Family Service - AI Family Tests', () => {\r\n  let app;\r\n\r\n  beforeEach(() => {\r\n    app = createTestApp();\r\n  });\r\n\r\n  describe('GET /api/health', () => {\r\n    it('should return health status', async () => {\r\n      const response = await request(app)\r\n        .get('/api/health');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.status).toBe('OK');\r\n      expect(response.body.service).toBe('AI Family Service');\r\n    });\r\n  });\r\n\r\n  describe('POST /api/chat/chat', () => {\r\n    it('should chat with specific family member', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/chat')\r\n        .send({\r\n          familyMember: 'elara',\r\n          message: 'Hello, how can you help me?'\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('conversationId');\r\n      expect(response.body.familyMember).toBe('elara');\r\n      expect(response.body).toHaveProperty('response');\r\n    });\r\n\r\n    it('should return error when family member is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/chat')\r\n        .send({ message: 'Hello' });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Family member and message are required');\r\n    });\r\n\r\n    it('should return error when message is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/chat')\r\n        .send({ familyMember: 'elara' });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Family member and message are required');\r\n    });\r\n  });\r\n\r\n  describe('POST /api/chat/auto-chat', () => {\r\n    it('should auto-select family member for message', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/auto-chat')\r\n        .send({ message: 'I need help with education' });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('conversationId');\r\n      expect(response.body).toHaveProperty('selectedMember');\r\n      expect(response.body).toHaveProperty('response');\r\n    });\r\n\r\n    it('should return error when message is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/auto-chat')\r\n        .send({});\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Message is required');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/chat/family-config', () => {\r\n    it('should return family member configuration', async () => {\r\n      const response = await request(app)\r\n        .get('/api/chat/family-config');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('members');\r\n      expect(Array.isArray(response.body.members)).toBe(true);\r\n      expect(response.body.members.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should include member details', async () => {\r\n      const response = await request(app)\r\n        .get('/api/chat/family-config');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.members[0]).toHaveProperty('id');\r\n      expect(response.body.members[0]).toHaveProperty('name');\r\n      expect(response.body.members[0]).toHaveProperty('specialty');\r\n    });\r\n  });\r\n\r\n  describe('POST /api/chat/consult-family', () => {\r\n    it('should consult multiple family members', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/consult-family')\r\n        .send({\r\n          topic: 'Career guidance',\r\n          members: ['elara', 'sage']\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('consultationId');\r\n      expect(response.body.topic).toBe('Career guidance');\r\n      expect(response.body).toHaveProperty('responses');\r\n    });\r\n\r\n    it('should return error when topic is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/chat/consult-family')\r\n        .send({ members: ['elara'] });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Topic is required');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}