{"version":3,"names":["_globals","require","describe","baseUrl","testUserId","testAdminId","it","courseData","title","description","category","level","duration","price"],"sources":["monetization-api.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach } from '@jest/globals';\r\n\r\n/**\r\n * Integration tests for monetization API endpoints\r\n * These tests verify that all endpoints work correctly with the services\r\n */\r\n\r\ndescribe('Monetization API Integration Tests', () => {\r\n  const baseUrl = 'http://localhost:3000/api';\r\n  const testUserId = 'test-user-123';\r\n  const testAdminId = 'test-admin-123';\r\n\r\n  describe('Course Marketplace Endpoints', () => {\r\n    describe('POST /api/courses/upload', () => {\r\n      it('should upload a course successfully', async () => {\r\n        const courseData = {\r\n          title: 'Learn TypeScript',\r\n          description: 'Complete TypeScript course',\r\n          category: 'programming',\r\n          level: 'BEGINNER',\r\n          duration: 40,\r\n          price: 49.99,\r\n        };\r\n\r\n        // This would be an actual HTTP request in a real test\r\n        // const response = await fetch(`${baseUrl}/courses/upload`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //   },\r\n        //   body: JSON.stringify(courseData),\r\n        // });\r\n\r\n        // expect(response.status).toBe(201);\r\n        // const result = await response.json();\r\n        // expect(result.success).toBe(true);\r\n        // expect(result.course.title).toBe(courseData.title);\r\n      });\r\n\r\n      it('should reject upload without authentication', async () => {\r\n        // const response = await fetch(`${baseUrl}/courses/upload`, {\r\n        //   method: 'POST',\r\n        //   headers: { 'Content-Type': 'application/json' },\r\n        //   body: JSON.stringify({}),\r\n        // });\r\n\r\n        // expect(response.status).toBe(401);\r\n      });\r\n    });\r\n\r\n    describe('GET /api/courses/list', () => {\r\n      it('should list courses with pagination', async () => {\r\n        // const response = await fetch(`${baseUrl}/courses/list?page=1&limit=10`);\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // expect(Array.isArray(result.courses)).toBe(true);\r\n        // expect(result.total).toBeGreaterThanOrEqual(0);\r\n      });\r\n\r\n      it('should filter courses by category', async () => {\r\n        // const response = await fetch(`${baseUrl}/courses/list?category=programming`);\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // result.courses.forEach((course: any) => {\r\n        //   expect(course.category).toBe('programming');\r\n        // });\r\n      });\r\n\r\n      it('should search courses by title', async () => {\r\n        // const response = await fetch(`${baseUrl}/courses/list?search=TypeScript`);\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // expect(result.courses.length).toBeGreaterThan(0);\r\n      });\r\n    });\r\n\r\n    describe('POST /api/courses/purchase', () => {\r\n      it('should purchase a course successfully', async () => {\r\n        // const response = await fetch(`${baseUrl}/courses/purchase`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     courseId: 'course-123',\r\n        //     paymentMethodId: 'pm_123',\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(201);\r\n        // const result = await response.json();\r\n        // expect(result.success).toBe(true);\r\n        // expect(result.purchase).toBeDefined();\r\n      });\r\n\r\n      it('should reject purchase without payment method', async () => {\r\n        // const response = await fetch(`${baseUrl}/courses/purchase`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //   },\r\n        //   body: JSON.stringify({ courseId: 'course-123' }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(400);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Token Rewards Endpoints', () => {\r\n    describe('GET /api/tokens/balance', () => {\r\n      it('should retrieve user token balance', async () => {\r\n        // const response = await fetch(`${baseUrl}/tokens/balance`, {\r\n        //   headers: { 'x-user-id': testUserId },\r\n        // });\r\n\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // expect(result.balance).toBeDefined();\r\n        // expect(result.userId).toBe(testUserId);\r\n      });\r\n\r\n      it('should reject request without authentication', async () => {\r\n        // const response = await fetch(`${baseUrl}/tokens/balance`);\r\n        // expect(response.status).toBe(401);\r\n      });\r\n    });\r\n\r\n    describe('POST /api/tokens/award', () => {\r\n      it('should award tokens to user (admin only)', async () => {\r\n        // const response = await fetch(`${baseUrl}/tokens/award`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testAdminId,\r\n        //     'x-user-role': 'ADMIN',\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     userId: testUserId,\r\n        //     amount: 100,\r\n        //     reason: 'course_completion',\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(201);\r\n        // const result = await response.json();\r\n        // expect(result.success).toBe(true);\r\n      });\r\n\r\n      it('should reject non-admin token award', async () => {\r\n        // const response = await fetch(`${baseUrl}/tokens/award`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //     'x-user-role': 'USER',\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     userId: testUserId,\r\n        //     amount: 100,\r\n        //     reason: 'test',\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(403);\r\n      });\r\n    });\r\n\r\n    describe('POST /api/tokens/redeem', () => {\r\n      it('should redeem tokens for feature', async () => {\r\n        // const response = await fetch(`${baseUrl}/tokens/redeem`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     amount: 50,\r\n        //     feature: 'premium_content',\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(201);\r\n        // const result = await response.json();\r\n        // expect(result.success).toBe(true);\r\n      });\r\n\r\n      it('should reject redemption with insufficient balance', async () => {\r\n        // const response = await fetch(`${baseUrl}/tokens/redeem`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     amount: 999999,\r\n        //     feature: 'premium_content',\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(400);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Leaderboard Endpoints', () => {\r\n    describe('GET /api/leaderboard/global', () => {\r\n      it('should retrieve global leaderboard', async () => {\r\n        // const response = await fetch(`${baseUrl}/leaderboard/global?limit=100`);\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // expect(Array.isArray(result.entries)).toBe(true);\r\n      });\r\n    });\r\n\r\n    describe('GET /api/leaderboard/friends', () => {\r\n      it('should retrieve friend leaderboard', async () => {\r\n        // const response = await fetch(`${baseUrl}/leaderboard/friends`, {\r\n        //   headers: { 'x-user-id': testUserId },\r\n        // });\r\n\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // expect(Array.isArray(result.entries)).toBe(true);\r\n      });\r\n\r\n      it('should reject request without authentication', async () => {\r\n        // const response = await fetch(`${baseUrl}/leaderboard/friends`);\r\n        // expect(response.status).toBe(401);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Enterprise Licensing Endpoints', () => {\r\n    describe('POST /api/enterprise/licenses/create', () => {\r\n      it('should create enterprise license (admin only)', async () => {\r\n        // const response = await fetch(`${baseUrl}/enterprise/licenses/create`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testAdminId,\r\n        //     'x-user-role': 'ADMIN',\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     organizationName: 'Acme Corp',\r\n        //     organizationEmail: 'admin@acme.com',\r\n        //     tier: 'PROFESSIONAL',\r\n        //     maxUsers: 100,\r\n        //     startDate: new Date().toISOString(),\r\n        //     expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(201);\r\n        // const result = await response.json();\r\n        // expect(result.success).toBe(true);\r\n      });\r\n    });\r\n\r\n    describe('POST /api/enterprise/licenses/activate', () => {\r\n      it('should activate enterprise license', async () => {\r\n        // const response = await fetch(`${baseUrl}/enterprise/licenses/activate`, {\r\n        //   method: 'POST',\r\n        //   headers: {\r\n        //     'Content-Type': 'application/json',\r\n        //     'x-user-id': testUserId,\r\n        //   },\r\n        //   body: JSON.stringify({\r\n        //     licenseKey: 'LIC-ABC-123-XYZ',\r\n        //   }),\r\n        // });\r\n\r\n        // expect(response.status).toBe(200);\r\n        // const result = await response.json();\r\n        // expect(result.success).toBe(true);\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"mappings":";;AAAA,IAAAA,QAAA,GAAAC,OAAA;AAEA;AACA;AACA;AACA;;AAEA,IAAAC,iBAAQ,EAAC,oCAAoC,EAAE,MAAM;EACnD,MAAMC,OAAO,GAAG,2BAA2B;EAC3C,MAAMC,UAAU,GAAG,eAAe;EAClC,MAAMC,WAAW,GAAG,gBAAgB;EAEpC,IAAAH,iBAAQ,EAAC,8BAA8B,EAAE,MAAM;IAC7C,IAAAA,iBAAQ,EAAC,0BAA0B,EAAE,MAAM;MACzC,IAAAI,WAAE,EAAC,qCAAqC,EAAE,YAAY;QACpD,MAAMC,UAAU,GAAG;UACjBC,KAAK,EAAE,kBAAkB;UACzBC,WAAW,EAAE,4BAA4B;UACzCC,QAAQ,EAAE,aAAa;UACvBC,KAAK,EAAE,UAAU;UACjBC,QAAQ,EAAE,EAAE;UACZC,KAAK,EAAE;QACT,CAAC;;QAED;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;MACF,CAAC,CAAC;MAEF,IAAAP,WAAE,EAAC,6CAA6C,EAAE,YAAY;QAC5D;QACA;QACA;QACA;QACA;;QAEA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;IAEF,IAAAJ,iBAAQ,EAAC,uBAAuB,EAAE,MAAM;MACtC,IAAAI,WAAE,EAAC,qCAAqC,EAAE,YAAY;QACpD;QACA;QACA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,mCAAmC,EAAE,YAAY;QAClD;QACA;QACA;QACA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,gCAAgC,EAAE,YAAY;QAC/C;QACA;QACA;QACA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;IAEF,IAAAJ,iBAAQ,EAAC,4BAA4B,EAAE,MAAM;MAC3C,IAAAI,WAAE,EAAC,uCAAuC,EAAE,YAAY;QACtD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,+CAA+C,EAAE,YAAY;QAC9D;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,IAAAJ,iBAAQ,EAAC,yBAAyB,EAAE,MAAM;IACxC,IAAAA,iBAAQ,EAAC,yBAAyB,EAAE,MAAM;MACxC,IAAAI,WAAE,EAAC,oCAAoC,EAAE,YAAY;QACnD;QACA;QACA;;QAEA;QACA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,8CAA8C,EAAE,YAAY;QAC7D;QACA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;IAEF,IAAAJ,iBAAQ,EAAC,wBAAwB,EAAE,MAAM;MACvC,IAAAI,WAAE,EAAC,0CAA0C,EAAE,YAAY;QACzD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,qCAAqC,EAAE,YAAY;QACpD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;IAEF,IAAAJ,iBAAQ,EAAC,yBAAyB,EAAE,MAAM;MACxC,IAAAI,WAAE,EAAC,kCAAkC,EAAE,YAAY;QACjD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,oDAAoD,EAAE,YAAY;QACnE;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,IAAAJ,iBAAQ,EAAC,uBAAuB,EAAE,MAAM;IACtC,IAAAA,iBAAQ,EAAC,6BAA6B,EAAE,MAAM;MAC5C,IAAAI,WAAE,EAAC,oCAAoC,EAAE,YAAY;QACnD;QACA;QACA;QACA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;IAEF,IAAAJ,iBAAQ,EAAC,8BAA8B,EAAE,MAAM;MAC7C,IAAAI,WAAE,EAAC,oCAAoC,EAAE,YAAY;QACnD;QACA;QACA;;QAEA;QACA;QACA;MAAA,CACD,CAAC;MAEF,IAAAA,WAAE,EAAC,8CAA8C,EAAE,YAAY;QAC7D;QACA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,IAAAJ,iBAAQ,EAAC,gCAAgC,EAAE,MAAM;IAC/C,IAAAA,iBAAQ,EAAC,sCAAsC,EAAE,MAAM;MACrD,IAAAI,WAAE,EAAC,+CAA+C,EAAE,YAAY;QAC9D;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;IAEF,IAAAJ,iBAAQ,EAAC,wCAAwC,EAAE,MAAM;MACvD,IAAAI,WAAE,EAAC,oCAAoC,EAAE,YAAY;QACnD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;MAAA,CACD,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}