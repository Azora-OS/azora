{"version":3,"names":["_globals","require","_supertest","_interopRequireDefault","e","__esModule","default","API_URL","process","env","TREASURY_SERVICE_URL","describe","it","res","request","get","expect","status","toBe","body","success","Array","isArray","data","assets","totalValue","toBeDefined","createRes","post","send","type","name","symbol","amount","value","id","error","toContain","put","toBeGreaterThan","assetId","action","description","txnRes","length","forEach","asset","percentage","toBeGreaterThanOrEqual","toBeLessThanOrEqual","targetAllocations","rebalanced"],"sources":["fund-management.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\r\nimport request from 'supertest';\r\n\r\nconst API_URL = process.env.TREASURY_SERVICE_URL || 'http://localhost:3028';\r\n\r\ndescribe('Azora Treasury - Fund Management', () => {\r\n  describe('Asset Management', () => {\r\n    it('should retrieve all treasury assets', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/assets');\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.success).toBe(true);\r\n      expect(Array.isArray(res.body.data.assets)).toBe(true);\r\n      expect(res.body.data.totalValue).toBeDefined();\r\n    });\r\n\r\n    it('should retrieve specific asset', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          type: 'cryptocurrency',\r\n          name: 'Bitcoin',\r\n          symbol: 'BTC',\r\n          amount: 1.5,\r\n          value: 50000,\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .get(`/api/assets/${createRes.body.data.id}`);\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.name).toBe('Bitcoin');\r\n    });\r\n\r\n    it('should add new asset', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          type: 'fiat',\r\n          name: 'US Dollar',\r\n          symbol: 'USD',\r\n          amount: 100000,\r\n          value: 100000,\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.success).toBe(true);\r\n      expect(res.body.data.id).toBeDefined();\r\n    });\r\n\r\n    it('should reject asset without required fields', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          name: 'Incomplete Asset',\r\n        });\r\n\r\n      expect(res.status).toBe(400);\r\n      expect(res.body.error).toContain('required');\r\n    });\r\n\r\n    it('should update asset value', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          type: 'cryptocurrency',\r\n          name: 'Ethereum',\r\n          symbol: 'ETH',\r\n          amount: 10,\r\n          value: 20000,\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .put(`/api/assets/${createRes.body.data.id}`)\r\n        .send({\r\n          value: 25000,\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.value).toBe(25000);\r\n    });\r\n\r\n    it('should calculate total portfolio value', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/assets');\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.totalValue).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('Reserve Operations', () => {\r\n    it('should add funds to reserves', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          type: 'fiat',\r\n          name: 'USD',\r\n          symbol: 'USD',\r\n          amount: 50000,\r\n          value: 50000,\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .post('/api/reserves')\r\n        .send({\r\n          assetId: createRes.body.data.id,\r\n          amount: 10000,\r\n          action: 'add',\r\n          description: 'Monthly contribution',\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.success).toBe(true);\r\n      expect(res.body.data.action).toBe('add');\r\n    });\r\n\r\n    it('should remove funds from reserves', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          type: 'fiat',\r\n          name: 'USD',\r\n          symbol: 'USD',\r\n          amount: 50000,\r\n          value: 50000,\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .post('/api/reserves')\r\n        .send({\r\n          assetId: createRes.body.data.id,\r\n          amount: 5000,\r\n          action: 'remove',\r\n          description: 'Operational expenses',\r\n        });\r\n\r\n      expect(res.status).toBe(201);\r\n      expect(res.body.success).toBe(true);\r\n      expect(res.body.data.action).toBe('remove');\r\n    });\r\n\r\n    it('should retrieve reserve transaction history', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/reserves');\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.success).toBe(true);\r\n      expect(Array.isArray(res.body.data)).toBe(true);\r\n    });\r\n\r\n    it('should retrieve specific reserve transaction', async () => {\r\n      const createRes = await request(API_URL)\r\n        .post('/api/assets')\r\n        .send({\r\n          type: 'fiat',\r\n          name: 'USD',\r\n          symbol: 'USD',\r\n          amount: 50000,\r\n          value: 50000,\r\n        });\r\n\r\n      const txnRes = await request(API_URL)\r\n        .post('/api/reserves')\r\n        .send({\r\n          assetId: createRes.body.data.id,\r\n          amount: 1000,\r\n          action: 'add',\r\n        });\r\n\r\n      const res = await request(API_URL)\r\n        .get(`/api/reserves/${txnRes.body.data.id}`);\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.id).toBe(txnRes.body.data.id);\r\n    });\r\n  });\r\n\r\n  describe('Asset Allocation', () => {\r\n    it('should calculate asset allocation percentages', async () => {\r\n      const res = await request(API_URL)\r\n        .get('/api/assets');\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.data.assets.length).toBeGreaterThan(0);\r\n      \r\n      const totalValue = res.body.data.totalValue;\r\n      res.body.data.assets.forEach((asset: any) => {\r\n        const percentage = (asset.value / totalValue) * 100;\r\n        expect(percentage).toBeGreaterThanOrEqual(0);\r\n        expect(percentage).toBeLessThanOrEqual(100);\r\n      });\r\n    });\r\n\r\n    it('should rebalance portfolio', async () => {\r\n      const res = await request(API_URL)\r\n        .post('/api/portfolio/rebalance')\r\n        .send({\r\n          targetAllocations: {\r\n            'cryptocurrency': 40,\r\n            'fiat': 60,\r\n          },\r\n        });\r\n\r\n      expect(res.status).toBe(200);\r\n      expect(res.body.rebalanced).toBe(true);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}