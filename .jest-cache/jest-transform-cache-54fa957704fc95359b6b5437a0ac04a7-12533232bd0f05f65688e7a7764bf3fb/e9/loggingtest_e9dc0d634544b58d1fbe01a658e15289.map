{"version":3,"names":["_logging","require","describe","logger","beforeEach","createLogger","afterEach","close","it","testLogger","expect","toBeDefined","defaultMeta","toEqual","service","transports","length","toBeGreaterThan","spy","jest","spyOn","logInfo","toHaveBeenCalledWith","undefined","meta","userId","action","logWarn","error","Error","logError","toHaveBeenCalled","callArgs","mock","calls","toHaveProperty","logDebug","logDatabaseOperation","any","Object","logAuthEvent","objectContaining","event","ip","logBusinessEvent","courseId","logPaymentEvent","transactionId","amount","currency","logErrorWithContext","orderId","context","middleware","requestLoggingMiddleware","toBe","req","method","path","get","fn","mockReturnValue","res","statusCode","send","mockImplementation","data","next"],"sources":["logging.test.ts"],"sourcesContent":["import winston from 'winston';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport {\r\n  createLogger,\r\n  requestLoggingMiddleware,\r\n  logInfo,\r\n  logWarn,\r\n  logError,\r\n  logDebug,\r\n  logDatabaseOperation,\r\n  logAuthEvent,\r\n  logBusinessEvent,\r\n  logPaymentEvent,\r\n  logErrorWithContext\r\n} from '../logging';\r\n\r\ndescribe('Shared Utilities - Logging', () => {\r\n  let logger: winston.Logger;\r\n  \r\n  beforeEach(() => {\r\n    logger = createLogger('test-service');\r\n  });\r\n  \r\n  afterEach(() => {\r\n    logger.close();\r\n  });\r\n  \r\n  describe('createLogger', () => {\r\n    it('should create logger with service name', () => {\r\n      const testLogger = createLogger('test-service');\r\n      expect(testLogger).toBeDefined();\r\n      expect(testLogger.defaultMeta).toEqual({ service: 'test-service' });\r\n    });\r\n    \r\n    it('should have console transport', () => {\r\n      const testLogger = createLogger('test-service');\r\n      const transports = testLogger.transports;\r\n      expect(transports.length).toBeGreaterThan(0);\r\n    });\r\n  });\r\n  \r\n  describe('logInfo', () => {\r\n    it('should log info message', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      logInfo(logger, 'Test message');\r\n      expect(spy).toHaveBeenCalledWith('Test message', undefined);\r\n    });\r\n    \r\n    it('should log info message with metadata', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      const meta = { userId: '123', action: 'test' };\r\n      logInfo(logger, 'Test message', meta);\r\n      expect(spy).toHaveBeenCalledWith('Test message', meta);\r\n    });\r\n  });\r\n  \r\n  describe('logWarn', () => {\r\n    it('should log warning message', () => {\r\n      const spy = jest.spyOn(logger, 'warn');\r\n      logWarn(logger, 'Warning message');\r\n      expect(spy).toHaveBeenCalledWith('Warning message', undefined);\r\n    });\r\n  });\r\n  \r\n  describe('logError', () => {\r\n    it('should log error message', () => {\r\n      const spy = jest.spyOn(logger, 'error');\r\n      const error = new Error('Test error');\r\n      logError(logger, 'Error occurred', error);\r\n      expect(spy).toHaveBeenCalled();\r\n    });\r\n    \r\n    it('should include error stack', () => {\r\n      const spy = jest.spyOn(logger, 'error');\r\n      const error = new Error('Test error');\r\n      logError(logger, 'Error occurred', error);\r\n      const callArgs = spy.mock.calls[0];\r\n      expect(callArgs[1]).toHaveProperty('stack');\r\n    });\r\n  });\r\n  \r\n  describe('logDebug', () => {\r\n    it('should log debug message', () => {\r\n      const spy = jest.spyOn(logger, 'debug');\r\n      logDebug(logger, 'Debug message');\r\n      expect(spy).toHaveBeenCalledWith('Debug message', undefined);\r\n    });\r\n  });\r\n  \r\n  describe('logDatabaseOperation', () => {\r\n    it('should log successful database operation', () => {\r\n      const spy = jest.spyOn(logger, 'log');\r\n      logDatabaseOperation(logger, 'SELECT', 'users', 50, true);\r\n      expect(spy).toHaveBeenCalledWith('info', 'Database SELECT on users', expect.any(Object));\r\n    });\r\n    \r\n    it('should log failed database operation', () => {\r\n      const spy = jest.spyOn(logger, 'log');\r\n      const error = new Error('Connection failed');\r\n      logDatabaseOperation(logger, 'INSERT', 'users', 100, false, error);\r\n      expect(spy).toHaveBeenCalledWith('error', 'Database INSERT on users', expect.any(Object));\r\n    });\r\n  });\r\n  \r\n  describe('logAuthEvent', () => {\r\n    it('should log login event', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      logAuthEvent(logger, 'login', 'user123');\r\n      expect(spy).toHaveBeenCalledWith('Auth: login', expect.objectContaining({\r\n        event: 'login',\r\n        userId: 'user123'\r\n      }));\r\n    });\r\n    \r\n    it('should log failed login event', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      logAuthEvent(logger, 'failed_login', undefined, { ip: '192.168.1.1' });\r\n      expect(spy).toHaveBeenCalledWith('Auth: failed_login', expect.objectContaining({\r\n        event: 'failed_login',\r\n        ip: '192.168.1.1'\r\n      }));\r\n    });\r\n  });\r\n  \r\n  describe('logBusinessEvent', () => {\r\n    it('should log business event', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      logBusinessEvent(logger, 'course_enrolled', 'user123', { courseId: 'course456' });\r\n      expect(spy).toHaveBeenCalledWith('Business: course_enrolled', expect.objectContaining({\r\n        event: 'course_enrolled',\r\n        userId: 'user123',\r\n        courseId: 'course456'\r\n      }));\r\n    });\r\n  });\r\n  \r\n  describe('logPaymentEvent', () => {\r\n    it('should log payment event', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      logPaymentEvent(logger, 'payment_completed', 'txn123', 99.99, 'USD');\r\n      expect(spy).toHaveBeenCalledWith('Payment: payment_completed', expect.objectContaining({\r\n        event: 'payment_completed',\r\n        transactionId: 'txn123',\r\n        amount: 99.99,\r\n        currency: 'USD'\r\n      }));\r\n    });\r\n  });\r\n  \r\n  describe('logErrorWithContext', () => {\r\n    it('should log error with context', () => {\r\n      const spy = jest.spyOn(logger, 'error');\r\n      const error = new Error('Test error');\r\n      logErrorWithContext(logger, error, 'payment processing', { orderId: '123' });\r\n      expect(spy).toHaveBeenCalledWith('Error in payment processing', expect.objectContaining({\r\n        error: 'Test error',\r\n        context: 'payment processing',\r\n        orderId: '123'\r\n      }));\r\n    });\r\n  });\r\n  \r\n  describe('requestLoggingMiddleware', () => {\r\n    it('should create middleware function', () => {\r\n      const middleware = requestLoggingMiddleware(logger);\r\n      expect(typeof middleware).toBe('function');\r\n    });\r\n    \r\n    it('should log HTTP requests', () => {\r\n      const spy = jest.spyOn(logger, 'info');\r\n      const middleware = requestLoggingMiddleware(logger);\r\n      \r\n      const req = {\r\n        method: 'GET',\r\n        path: '/api/test',\r\n        ip: '127.0.0.1',\r\n        get: jest.fn().mockReturnValue('test-agent')\r\n      } as unknown as Request;\r\n      \r\n      const res = {\r\n        statusCode: 200,\r\n        send: jest.fn().mockImplementation(function(data: any) {\r\n          return data;\r\n        })\r\n      } as unknown as Response;\r\n      \r\n      const next = jest.fn() as NextFunction;\r\n      \r\n      middleware(req, res, next);\r\n      expect(next).toHaveBeenCalled();\r\n    });\r\n  });\r\n});\r\n"],"mappings":";;AAEA,IAAAA,QAAA,GAAAC,OAAA;AAcAC,QAAQ,CAAC,4BAA4B,EAAE,MAAM;EAC3C,IAAIC,MAAsB;EAE1BC,UAAU,CAAC,MAAM;IACfD,MAAM,GAAG,IAAAE,qBAAY,EAAC,cAAc,CAAC;EACvC,CAAC,CAAC;EAEFC,SAAS,CAAC,MAAM;IACdH,MAAM,CAACI,KAAK,CAAC,CAAC;EAChB,CAAC,CAAC;EAEFL,QAAQ,CAAC,cAAc,EAAE,MAAM;IAC7BM,EAAE,CAAC,wCAAwC,EAAE,MAAM;MACjD,MAAMC,UAAU,GAAG,IAAAJ,qBAAY,EAAC,cAAc,CAAC;MAC/CK,MAAM,CAACD,UAAU,CAAC,CAACE,WAAW,CAAC,CAAC;MAChCD,MAAM,CAACD,UAAU,CAACG,WAAW,CAAC,CAACC,OAAO,CAAC;QAAEC,OAAO,EAAE;MAAe,CAAC,CAAC;IACrE,CAAC,CAAC;IAEFN,EAAE,CAAC,+BAA+B,EAAE,MAAM;MACxC,MAAMC,UAAU,GAAG,IAAAJ,qBAAY,EAAC,cAAc,CAAC;MAC/C,MAAMU,UAAU,GAAGN,UAAU,CAACM,UAAU;MACxCL,MAAM,CAACK,UAAU,CAACC,MAAM,CAAC,CAACC,eAAe,CAAC,CAAC,CAAC;IAC9C,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFf,QAAQ,CAAC,SAAS,EAAE,MAAM;IACxBM,EAAE,CAAC,yBAAyB,EAAE,MAAM;MAClC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,IAAAkB,gBAAO,EAAClB,MAAM,EAAE,cAAc,CAAC;MAC/BO,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,cAAc,EAAEC,SAAS,CAAC;IAC7D,CAAC,CAAC;IAEFf,EAAE,CAAC,uCAAuC,EAAE,MAAM;MAChD,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,MAAMqB,IAAI,GAAG;QAAEC,MAAM,EAAE,KAAK;QAAEC,MAAM,EAAE;MAAO,CAAC;MAC9C,IAAAL,gBAAO,EAAClB,MAAM,EAAE,cAAc,EAAEqB,IAAI,CAAC;MACrCd,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,cAAc,EAAEE,IAAI,CAAC;IACxD,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFtB,QAAQ,CAAC,SAAS,EAAE,MAAM;IACxBM,EAAE,CAAC,4BAA4B,EAAE,MAAM;MACrC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,IAAAwB,gBAAO,EAACxB,MAAM,EAAE,iBAAiB,CAAC;MAClCO,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,iBAAiB,EAAEC,SAAS,CAAC;IAChE,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,UAAU,EAAE,MAAM;IACzBM,EAAE,CAAC,0BAA0B,EAAE,MAAM;MACnC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,OAAO,CAAC;MACvC,MAAMyB,KAAK,GAAG,IAAIC,KAAK,CAAC,YAAY,CAAC;MACrC,IAAAC,iBAAQ,EAAC3B,MAAM,EAAE,gBAAgB,EAAEyB,KAAK,CAAC;MACzClB,MAAM,CAACQ,GAAG,CAAC,CAACa,gBAAgB,CAAC,CAAC;IAChC,CAAC,CAAC;IAEFvB,EAAE,CAAC,4BAA4B,EAAE,MAAM;MACrC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,OAAO,CAAC;MACvC,MAAMyB,KAAK,GAAG,IAAIC,KAAK,CAAC,YAAY,CAAC;MACrC,IAAAC,iBAAQ,EAAC3B,MAAM,EAAE,gBAAgB,EAAEyB,KAAK,CAAC;MACzC,MAAMI,QAAQ,GAAGd,GAAG,CAACe,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;MAClCxB,MAAM,CAACsB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAACG,cAAc,CAAC,OAAO,CAAC;IAC7C,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFjC,QAAQ,CAAC,UAAU,EAAE,MAAM;IACzBM,EAAE,CAAC,0BAA0B,EAAE,MAAM;MACnC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,OAAO,CAAC;MACvC,IAAAiC,iBAAQ,EAACjC,MAAM,EAAE,eAAe,CAAC;MACjCO,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,eAAe,EAAEC,SAAS,CAAC;IAC9D,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrB,QAAQ,CAAC,sBAAsB,EAAE,MAAM;IACrCM,EAAE,CAAC,0CAA0C,EAAE,MAAM;MACnD,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,KAAK,CAAC;MACrC,IAAAkC,6BAAoB,EAAClC,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,CAAC;MACzDO,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,MAAM,EAAE,0BAA0B,EAAEZ,MAAM,CAAC4B,GAAG,CAACC,MAAM,CAAC,CAAC;IAC1F,CAAC,CAAC;IAEF/B,EAAE,CAAC,sCAAsC,EAAE,MAAM;MAC/C,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,KAAK,CAAC;MACrC,MAAMyB,KAAK,GAAG,IAAIC,KAAK,CAAC,mBAAmB,CAAC;MAC5C,IAAAQ,6BAAoB,EAAClC,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK,EAAEyB,KAAK,CAAC;MAClElB,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,OAAO,EAAE,0BAA0B,EAAEZ,MAAM,CAAC4B,GAAG,CAACC,MAAM,CAAC,CAAC;IAC3F,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFrC,QAAQ,CAAC,cAAc,EAAE,MAAM;IAC7BM,EAAE,CAAC,wBAAwB,EAAE,MAAM;MACjC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,IAAAqC,qBAAY,EAACrC,MAAM,EAAE,OAAO,EAAE,SAAS,CAAC;MACxCO,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,aAAa,EAAEZ,MAAM,CAAC+B,gBAAgB,CAAC;QACtEC,KAAK,EAAE,OAAO;QACdjB,MAAM,EAAE;MACV,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;IAEFjB,EAAE,CAAC,+BAA+B,EAAE,MAAM;MACxC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,IAAAqC,qBAAY,EAACrC,MAAM,EAAE,cAAc,EAAEoB,SAAS,EAAE;QAAEoB,EAAE,EAAE;MAAc,CAAC,CAAC;MACtEjC,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,oBAAoB,EAAEZ,MAAM,CAAC+B,gBAAgB,CAAC;QAC7EC,KAAK,EAAE,cAAc;QACrBC,EAAE,EAAE;MACN,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFzC,QAAQ,CAAC,kBAAkB,EAAE,MAAM;IACjCM,EAAE,CAAC,2BAA2B,EAAE,MAAM;MACpC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,IAAAyC,yBAAgB,EAACzC,MAAM,EAAE,iBAAiB,EAAE,SAAS,EAAE;QAAE0C,QAAQ,EAAE;MAAY,CAAC,CAAC;MACjFnC,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,2BAA2B,EAAEZ,MAAM,CAAC+B,gBAAgB,CAAC;QACpFC,KAAK,EAAE,iBAAiB;QACxBjB,MAAM,EAAE,SAAS;QACjBoB,QAAQ,EAAE;MACZ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF3C,QAAQ,CAAC,iBAAiB,EAAE,MAAM;IAChCM,EAAE,CAAC,0BAA0B,EAAE,MAAM;MACnC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,IAAA2C,wBAAe,EAAC3C,MAAM,EAAE,mBAAmB,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,CAAC;MACpEO,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,4BAA4B,EAAEZ,MAAM,CAAC+B,gBAAgB,CAAC;QACrFC,KAAK,EAAE,mBAAmB;QAC1BK,aAAa,EAAE,QAAQ;QACvBC,MAAM,EAAE,KAAK;QACbC,QAAQ,EAAE;MACZ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF/C,QAAQ,CAAC,qBAAqB,EAAE,MAAM;IACpCM,EAAE,CAAC,+BAA+B,EAAE,MAAM;MACxC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,OAAO,CAAC;MACvC,MAAMyB,KAAK,GAAG,IAAIC,KAAK,CAAC,YAAY,CAAC;MACrC,IAAAqB,4BAAmB,EAAC/C,MAAM,EAAEyB,KAAK,EAAE,oBAAoB,EAAE;QAAEuB,OAAO,EAAE;MAAM,CAAC,CAAC;MAC5EzC,MAAM,CAACQ,GAAG,CAAC,CAACI,oBAAoB,CAAC,6BAA6B,EAAEZ,MAAM,CAAC+B,gBAAgB,CAAC;QACtFb,KAAK,EAAE,YAAY;QACnBwB,OAAO,EAAE,oBAAoB;QAC7BD,OAAO,EAAE;MACX,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFjD,QAAQ,CAAC,0BAA0B,EAAE,MAAM;IACzCM,EAAE,CAAC,mCAAmC,EAAE,MAAM;MAC5C,MAAM6C,UAAU,GAAG,IAAAC,iCAAwB,EAACnD,MAAM,CAAC;MACnDO,MAAM,CAAC,OAAO2C,UAAU,CAAC,CAACE,IAAI,CAAC,UAAU,CAAC;IAC5C,CAAC,CAAC;IAEF/C,EAAE,CAAC,0BAA0B,EAAE,MAAM;MACnC,MAAMU,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACjB,MAAM,EAAE,MAAM,CAAC;MACtC,MAAMkD,UAAU,GAAG,IAAAC,iCAAwB,EAACnD,MAAM,CAAC;MAEnD,MAAMqD,GAAG,GAAG;QACVC,MAAM,EAAE,KAAK;QACbC,IAAI,EAAE,WAAW;QACjBf,EAAE,EAAE,WAAW;QACfgB,GAAG,EAAExC,IAAI,CAACyC,EAAE,CAAC,CAAC,CAACC,eAAe,CAAC,YAAY;MAC7C,CAAuB;MAEvB,MAAMC,GAAG,GAAG;QACVC,UAAU,EAAE,GAAG;QACfC,IAAI,EAAE7C,IAAI,CAACyC,EAAE,CAAC,CAAC,CAACK,kBAAkB,CAAC,UAASC,IAAS,EAAE;UACrD,OAAOA,IAAI;QACb,CAAC;MACH,CAAwB;MAExB,MAAMC,IAAI,GAAGhD,IAAI,CAACyC,EAAE,CAAC,CAAiB;MAEtCP,UAAU,CAACG,GAAG,EAAEM,GAAG,EAAEK,IAAI,CAAC;MAC1BzD,MAAM,CAACyD,IAAI,CAAC,CAACpC,gBAAgB,CAAC,CAAC;IACjC,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}