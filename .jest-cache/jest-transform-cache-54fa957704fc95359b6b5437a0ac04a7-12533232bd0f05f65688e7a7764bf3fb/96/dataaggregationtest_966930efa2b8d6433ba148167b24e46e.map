{"version":3,"names":["request","require","express","createTestApp","app","helmet","cors","use","json","post","req","res","dataSource","metrics","timeRange","body","status","error","aggregation","aggregationId","Date","now","results","timestamp","toISOString","forEach","metric","value","Math","floor","random","trend","get","sources","count","describe","beforeEach","it","response","send","expect","toBe","toHaveProperty","toEqual","Array","isArray"],"sources":["data-aggregation.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst express = require('express');\r\n\r\nfunction createTestApp() {\r\n  const app = express();\r\n  const helmet = require('helmet');\r\n  const cors = require('cors');\r\n\r\n  app.use(helmet());\r\n  app.use(cors());\r\n  app.use(express.json());\r\n\r\n  app.post('/api/analytics/aggregate', (req, res) => {\r\n    const { dataSource, metrics, timeRange } = req.body;\r\n\r\n    if (!dataSource || !metrics) {\r\n      return res.status(400).json({ error: 'Data source and metrics are required' });\r\n    }\r\n\r\n    const aggregation = {\r\n      aggregationId: `agg_${Date.now()}`,\r\n      dataSource,\r\n      metrics,\r\n      timeRange: timeRange || 'last_24h',\r\n      results: {},\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    // Simulate aggregation results\r\n    metrics.forEach(metric => {\r\n      aggregation.results[metric] = {\r\n        value: Math.floor(Math.random() * 1000),\r\n        trend: Math.random() > 0.5 ? 'up' : 'down'\r\n      };\r\n    });\r\n\r\n    res.json(aggregation);\r\n  });\r\n\r\n  app.get('/api/analytics/data-sources', (req, res) => {\r\n    res.json({\r\n      sources: ['users', 'transactions', 'courses', 'payments'],\r\n      count: 4\r\n    });\r\n  });\r\n\r\n  return app;\r\n}\r\n\r\ndescribe('Azora Analytics - Data Aggregation Tests', () => {\r\n  let app;\r\n\r\n  beforeEach(() => {\r\n    app = createTestApp();\r\n  });\r\n\r\n  describe('POST /api/analytics/aggregate', () => {\r\n    it('should aggregate data from specified source', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/aggregate')\r\n        .send({\r\n          dataSource: 'users',\r\n          metrics: ['total_count', 'active_users'],\r\n          timeRange: 'last_7d'\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('aggregationId');\r\n      expect(response.body.dataSource).toBe('users');\r\n      expect(response.body.metrics).toEqual(['total_count', 'active_users']);\r\n    });\r\n\r\n    it('should return error when data source is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/aggregate')\r\n        .send({ metrics: ['count'] });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Data source and metrics are required');\r\n    });\r\n\r\n    it('should return error when metrics are missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/aggregate')\r\n        .send({ dataSource: 'users' });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Data source and metrics are required');\r\n    });\r\n\r\n    it('should default to last 24 hours when timeRange not specified', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/aggregate')\r\n        .send({\r\n          dataSource: 'transactions',\r\n          metrics: ['total_amount']\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.timeRange).toBe('last_24h');\r\n    });\r\n\r\n    it('should return aggregated results for all metrics', async () => {\r\n      const response = await request(app)\r\n        .post('/api/analytics/aggregate')\r\n        .send({\r\n          dataSource: 'courses',\r\n          metrics: ['enrollments', 'completions', 'revenue']\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.results).toHaveProperty('enrollments');\r\n      expect(response.body.results).toHaveProperty('completions');\r\n      expect(response.body.results).toHaveProperty('revenue');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/analytics/data-sources', () => {\r\n    it('should return available data sources', async () => {\r\n      const response = await request(app)\r\n        .get('/api/analytics/data-sources');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('sources');\r\n      expect(Array.isArray(response.body.sources)).toBe(true);\r\n      expect(response.body).toHaveProperty('count');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}