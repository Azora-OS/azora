{"version":3,"names":["_consentManager","require","describe","consentManager","testUserId","beforeEach","ConsentManager","it","record","userId","consentType","ConsentType","ANALYTICS","granted","timestamp","Date","ipAddress","expect","recordConsent","resolves","not","toThrow","MARKETING","grantConsent","hasConsent","getConsent","toBe","ESSENTIAL","status","getConsentStatus","essential","analytics","marketing","personalization","withdrawConsent","userData","exportUserData","toHaveProperty","user","rejects","deleteUserData","PERSONALIZATION"],"sources":["consent-manager.test.ts"],"sourcesContent":["import { ConsentManager, ConsentType } from '../consent-manager';\r\n\r\ndescribe('ConsentManager', () => {\r\n  let consentManager: ConsentManager;\r\n  const testUserId = 'test-user-123';\r\n\r\n  beforeEach(() => {\r\n    consentManager = new ConsentManager();\r\n  });\r\n\r\n  describe('recordConsent', () => {\r\n    it('should record user consent', async () => {\r\n      const record = {\r\n        userId: testUserId,\r\n        consentType: ConsentType.ANALYTICS,\r\n        granted: true,\r\n        timestamp: new Date(),\r\n        ipAddress: '192.168.1.1'\r\n      };\r\n\r\n      await expect(consentManager.recordConsent(record)).resolves.not.toThrow();\r\n    });\r\n\r\n    it('should record consent withdrawal', async () => {\r\n      const record = {\r\n        userId: testUserId,\r\n        consentType: ConsentType.MARKETING,\r\n        granted: false,\r\n        timestamp: new Date()\r\n      };\r\n\r\n      await expect(consentManager.recordConsent(record)).resolves.not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('getConsent', () => {\r\n    it('should retrieve consent status', async () => {\r\n      // First grant consent\r\n      await consentManager.grantConsent(testUserId, ConsentType.ANALYTICS);\r\n\r\n      // Then retrieve it\r\n      const hasConsent = await consentManager.getConsent(testUserId, ConsentType.ANALYTICS);\r\n      expect(hasConsent).toBe(true);\r\n    });\r\n\r\n    it('should return false for non-existent consent', async () => {\r\n      const hasConsent = await consentManager.getConsent('non-existent-user', ConsentType.ANALYTICS);\r\n      expect(hasConsent).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('getConsentStatus', () => {\r\n    it('should return complete consent status', async () => {\r\n      // Grant some consents\r\n      await consentManager.grantConsent(testUserId, ConsentType.ESSENTIAL);\r\n      await consentManager.grantConsent(testUserId, ConsentType.ANALYTICS);\r\n\r\n      const status = await consentManager.getConsentStatus(testUserId);\r\n\r\n      expect(status.userId).toBe(testUserId);\r\n      expect(status.essential).toBe(true);\r\n      expect(status.analytics).toBe(true);\r\n      expect(status.marketing).toBe(false);\r\n      expect(status.personalization).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('withdrawConsent', () => {\r\n    it('should withdraw specific consent', async () => {\r\n      // Grant consent first\r\n      await consentManager.grantConsent(testUserId, ConsentType.MARKETING);\r\n\r\n      // Verify it's granted\r\n      let hasConsent = await consentManager.getConsent(testUserId, ConsentType.MARKETING);\r\n      expect(hasConsent).toBe(true);\r\n\r\n      // Withdraw consent\r\n      await consentManager.withdrawConsent(testUserId, ConsentType.MARKETING);\r\n\r\n      // Verify it's withdrawn\r\n      hasConsent = await consentManager.getConsent(testUserId, ConsentType.MARKETING);\r\n      expect(hasConsent).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('exportUserData', () => {\r\n    it('should export user data in machine-readable format', async () => {\r\n      const userData = await consentManager.exportUserData(testUserId);\r\n\r\n      expect(userData).toHaveProperty('user');\r\n      expect(userData).toHaveProperty('enrollments');\r\n      expect(userData).toHaveProperty('payments');\r\n      expect(userData).toHaveProperty('wallets');\r\n      expect(userData).toHaveProperty('assessments');\r\n      expect(userData).toHaveProperty('chatSessions');\r\n      expect(userData).toHaveProperty('consentRecords');\r\n    });\r\n\r\n    it('should include user profile in export', async () => {\r\n      const userData = await consentManager.exportUserData(testUserId);\r\n\r\n      expect(userData.user).toHaveProperty('id');\r\n      expect(userData.user).toHaveProperty('email');\r\n      expect(userData.user).toHaveProperty('name');\r\n      expect(userData.user).toHaveProperty('role');\r\n      expect(userData.user).toHaveProperty('createdAt');\r\n    });\r\n\r\n    it('should throw error for non-existent user', async () => {\r\n      await expect(consentManager.exportUserData('non-existent-user')).rejects.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('deleteUserData', () => {\r\n    it('should delete all user data', async () => {\r\n      // This test verifies the deletion process\r\n      // In a real scenario, you'd verify the user is actually deleted\r\n      await expect(consentManager.deleteUserData(testUserId)).resolves.not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('grantConsent', () => {\r\n    it('should grant consent with IP and user agent', async () => {\r\n      await consentManager.grantConsent(\r\n        testUserId,\r\n        ConsentType.PERSONALIZATION,\r\n        '192.168.1.1',\r\n        'Mozilla/5.0...'\r\n      );\r\n\r\n      const hasConsent = await consentManager.getConsent(testUserId, ConsentType.PERSONALIZATION);\r\n      expect(hasConsent).toBe(true);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}