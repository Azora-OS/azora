166a8d29941507ffcad94c9b42db2bc9
"use strict";

const request = require('supertest');
const express = require('express');
const rateLimit = require('express-rate-limit');

// Create test app
const createTestApp = () => {
  const app = express();
  app.use(express.json());

  // Mock rate limiter for testing
  const testLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,
    max: 5,
    // Lower limit for testing
    message: {
      error: 'Rate limit exceeded'
    }
  });

  // Mock authentication middleware
  const mockAuth = (req, res, next) => {
    const authHeader = req.headers.authorization;
    if (authHeader && authHeader.startsWith('Bearer ')) {
      req.user = {
        userId: 1,
        email: 'test@azora.world'
      };
      next();
    } else {
      res.status(401).json({
        error: 'Unauthorized'
      });
    }
  };

  // Test routes
  app.get('/health', (req, res) => {
    res.json({
      status: 'healthy',
      service: 'azora-api-gateway'
    });
  });
  app.get('/api/test', (req, res) => {
    res.json({
      success: true,
      message: 'Test route'
    });
  });
  app.get('/api/protected', mockAuth, (req, res) => {
    res.json({
      success: true,
      user: req.user
    });
  });
  app.use('/api/limited', testLimiter, (req, res) => {
    res.json({
      success: true
    });
  });

  // Service discovery mock
  app.get('/api/services', (req, res) => {
    res.json({
      services: {
        education: 'http://localhost:4001',
        finance: 'http://localhost:4002',
        marketplace: 'http://localhost:4003',
        auth: 'http://localhost:4004'
      }
    });
  });

  // Error handling
  app.use((err, req, res, next) => {
    res.status(err.status || 500).json({
      error: err.message
    });
  });
  return app;
};
describe('API Gateway - Request Routing', () => {
  let app;
  beforeEach(() => {
    app = createTestApp();
  });
  it('should route requests to health endpoint', async () => {
    const res = await request(app).get('/health').expect(200);
    expect(res.body.status).toBe('healthy');
    expect(res.body.service).toBe('azora-api-gateway');
  });
  it('should route requests to API endpoints', async () => {
    const res = await request(app).get('/api/test').expect(200);
    expect(res.body.success).toBe(true);
  });
  it('should handle service discovery', async () => {
    const res = await request(app).get('/api/services').expect(200);
    expect(res.body.services).toBeDefined();
    expect(res.body.services.education).toBeDefined();
    expect(res.body.services.auth).toBeDefined();
  });
});
describe('API Gateway - Rate Limiting', () => {
  let app;
  beforeEach(() => {
    app = createTestApp();
  });
  it('should allow requests within rate limit', async () => {
    const res = await request(app).get('/api/limited').expect(200);
    expect(res.body.success).toBe(true);
  });
  it('should enforce rate limits', async () => {
    // Make multiple requests to exceed limit
    for (let i = 0; i < 5; i++) {
      await request(app).get('/api/limited');
    }

    // Next request should be rate limited
    const res = await request(app).get('/api/limited').expect(429);
    expect(res.body.error).toBeDefined();
  });
});
describe('API Gateway - Authentication Middleware', () => {
  let app;
  beforeEach(() => {
    app = createTestApp();
  });
  it('should allow authenticated requests', async () => {
    const res = await request(app).get('/api/protected').set('Authorization', 'Bearer valid-token').expect(200);
    expect(res.body.success).toBe(true);
    expect(res.body.user).toBeDefined();
  });
  it('should reject unauthenticated requests', async () => {
    const res = await request(app).get('/api/protected').expect(401);
    expect(res.body.error).toBe('Unauthorized');
  });
  it('should reject requests with invalid token format', async () => {
    const res = await request(app).get('/api/protected').set('Authorization', 'InvalidFormat').expect(401);
    expect(res.body.error).toBe('Unauthorized');
  });
});
describe('API Gateway - Service Discovery', () => {
  let app;
  beforeEach(() => {
    app = createTestApp();
  });
  it('should return list of available services', async () => {
    const res = await request(app).get('/api/services').expect(200);
    expect(res.body.services).toBeDefined();
    expect(Object.keys(res.body.services).length).toBeGreaterThan(0);
  });
  it('should include service URLs', async () => {
    const res = await request(app).get('/api/services').expect(200);
    const services = res.body.services;
    Object.values(services).forEach(url => {
      expect(url).toMatch(/^http:\/\//);
    });
  });
});
describe('API Gateway - Error Handling', () => {
  let app;
  beforeEach(() => {
    app = createTestApp();
  });
  it('should handle 404 errors', async () => {
    const res = await request(app).get('/api/nonexistent').expect(404);
  });
  it('should handle errors gracefully', async () => {
    const errorApp = express();
    errorApp.use(express.json());
    errorApp.get('/api/error', (req, res, next) => {
      next(new Error('Test error'));
    });
    errorApp.use((err, req, res, next) => {
      res.status(500).json({
        error: err.message
      });
    });
    const res = await request(errorApp).get('/api/error').expect(500);
    expect(res.body.error).toBe('Test error');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImV4cHJlc3MiLCJyYXRlTGltaXQiLCJjcmVhdGVUZXN0QXBwIiwiYXBwIiwidXNlIiwianNvbiIsInRlc3RMaW1pdGVyIiwid2luZG93TXMiLCJtYXgiLCJtZXNzYWdlIiwiZXJyb3IiLCJtb2NrQXV0aCIsInJlcSIsInJlcyIsIm5leHQiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdGFydHNXaXRoIiwidXNlciIsInVzZXJJZCIsImVtYWlsIiwic3RhdHVzIiwiZ2V0Iiwic2VydmljZSIsInN1Y2Nlc3MiLCJzZXJ2aWNlcyIsImVkdWNhdGlvbiIsImZpbmFuY2UiLCJtYXJrZXRwbGFjZSIsImF1dGgiLCJlcnIiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJpdCIsImV4cGVjdCIsImJvZHkiLCJ0b0JlIiwidG9CZURlZmluZWQiLCJpIiwic2V0IiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInRvQmVHcmVhdGVyVGhhbiIsInZhbHVlcyIsImZvckVhY2giLCJ1cmwiLCJ0b01hdGNoIiwiZXJyb3JBcHAiLCJFcnJvciJdLCJzb3VyY2VzIjpbImFwaS1nYXRld2F5LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xyXG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByYXRlTGltaXQgPSByZXF1aXJlKCdleHByZXNzLXJhdGUtbGltaXQnKTtcclxuXHJcbi8vIENyZWF0ZSB0ZXN0IGFwcFxyXG5jb25zdCBjcmVhdGVUZXN0QXBwID0gKCkgPT4ge1xyXG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcclxuICBcclxuICAvLyBNb2NrIHJhdGUgbGltaXRlciBmb3IgdGVzdGluZ1xyXG4gIGNvbnN0IHRlc3RMaW1pdGVyID0gcmF0ZUxpbWl0KHtcclxuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCxcclxuICAgIG1heDogNSwgLy8gTG93ZXIgbGltaXQgZm9yIHRlc3RpbmdcclxuICAgIG1lc3NhZ2U6IHsgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VlZGVkJyB9XHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gTW9jayBhdXRoZW50aWNhdGlvbiBtaWRkbGV3YXJlXHJcbiAgY29uc3QgbW9ja0F1dGggPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG4gICAgaWYgKGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcclxuICAgICAgcmVxLnVzZXIgPSB7IHVzZXJJZDogMSwgZW1haWw6ICd0ZXN0QGF6b3JhLndvcmxkJyB9O1xyXG4gICAgICBuZXh0KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcclxuICAgIH1cclxuICB9O1xyXG4gIFxyXG4gIC8vIFRlc3Qgcm91dGVzXHJcbiAgYXBwLmdldCgnL2hlYWx0aCcsIChyZXEsIHJlcykgPT4ge1xyXG4gICAgcmVzLmpzb24oeyBzdGF0dXM6ICdoZWFsdGh5Jywgc2VydmljZTogJ2F6b3JhLWFwaS1nYXRld2F5JyB9KTtcclxuICB9KTtcclxuICBcclxuICBhcHAuZ2V0KCcvYXBpL3Rlc3QnLCAocmVxLCByZXMpID0+IHtcclxuICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ1Rlc3Qgcm91dGUnIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGFwcC5nZXQoJy9hcGkvcHJvdGVjdGVkJywgbW9ja0F1dGgsIChyZXEsIHJlcykgPT4ge1xyXG4gICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCB1c2VyOiByZXEudXNlciB9KTtcclxuICB9KTtcclxuICBcclxuICBhcHAudXNlKCcvYXBpL2xpbWl0ZWQnLCB0ZXN0TGltaXRlciwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gU2VydmljZSBkaXNjb3ZlcnkgbW9ja1xyXG4gIGFwcC5nZXQoJy9hcGkvc2VydmljZXMnLCAocmVxLCByZXMpID0+IHtcclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgc2VydmljZXM6IHtcclxuICAgICAgICBlZHVjYXRpb246ICdodHRwOi8vbG9jYWxob3N0OjQwMDEnLFxyXG4gICAgICAgIGZpbmFuY2U6ICdodHRwOi8vbG9jYWxob3N0OjQwMDInLFxyXG4gICAgICAgIG1hcmtldHBsYWNlOiAnaHR0cDovL2xvY2FsaG9zdDo0MDAzJyxcclxuICAgICAgICBhdXRoOiAnaHR0cDovL2xvY2FsaG9zdDo0MDA0J1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICAvLyBFcnJvciBoYW5kbGluZ1xyXG4gIGFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHJlcy5zdGF0dXMoZXJyLnN0YXR1cyB8fCA1MDApLmpzb24oeyBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIGFwcDtcclxufTtcclxuXHJcbmRlc2NyaWJlKCdBUEkgR2F0ZXdheSAtIFJlcXVlc3QgUm91dGluZycsICgpID0+IHtcclxuICBsZXQgYXBwO1xyXG4gIFxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgYXBwID0gY3JlYXRlVGVzdEFwcCgpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgcm91dGUgcmVxdWVzdHMgdG8gaGVhbHRoIGVuZHBvaW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgIC5nZXQoJy9oZWFsdGgnKVxyXG4gICAgICAuZXhwZWN0KDIwMCk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5zdGF0dXMpLnRvQmUoJ2hlYWx0aHknKTtcclxuICAgIGV4cGVjdChyZXMuYm9keS5zZXJ2aWNlKS50b0JlKCdhem9yYS1hcGktZ2F0ZXdheScpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgcm91dGUgcmVxdWVzdHMgdG8gQVBJIGVuZHBvaW50cycsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAuZ2V0KCcvYXBpL3Rlc3QnKVxyXG4gICAgICAuZXhwZWN0KDIwMCk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZGlzY292ZXJ5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgIC5nZXQoJy9hcGkvc2VydmljZXMnKVxyXG4gICAgICAuZXhwZWN0KDIwMCk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5zZXJ2aWNlcykudG9CZURlZmluZWQoKTtcclxuICAgIGV4cGVjdChyZXMuYm9keS5zZXJ2aWNlcy5lZHVjYXRpb24pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICBleHBlY3QocmVzLmJvZHkuc2VydmljZXMuYXV0aCkudG9CZURlZmluZWQoKTtcclxuICB9KTtcclxufSk7XHJcblxyXG5kZXNjcmliZSgnQVBJIEdhdGV3YXkgLSBSYXRlIExpbWl0aW5nJywgKCkgPT4ge1xyXG4gIGxldCBhcHA7XHJcbiAgXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBhcHAgPSBjcmVhdGVUZXN0QXBwKCk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgaXQoJ3Nob3VsZCBhbGxvdyByZXF1ZXN0cyB3aXRoaW4gcmF0ZSBsaW1pdCcsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAuZ2V0KCcvYXBpL2xpbWl0ZWQnKVxyXG4gICAgICAuZXhwZWN0KDIwMCk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgZW5mb3JjZSByYXRlIGxpbWl0cycsIGFzeW5jICgpID0+IHtcclxuICAgIC8vIE1ha2UgbXVsdGlwbGUgcmVxdWVzdHMgdG8gZXhjZWVkIGxpbWl0XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xyXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcCkuZ2V0KCcvYXBpL2xpbWl0ZWQnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gTmV4dCByZXF1ZXN0IHNob3VsZCBiZSByYXRlIGxpbWl0ZWRcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAuZ2V0KCcvYXBpL2xpbWl0ZWQnKVxyXG4gICAgICAuZXhwZWN0KDQyOSk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5lcnJvcikudG9CZURlZmluZWQoKTtcclxuICB9KTtcclxufSk7XHJcblxyXG5kZXNjcmliZSgnQVBJIEdhdGV3YXkgLSBBdXRoZW50aWNhdGlvbiBNaWRkbGV3YXJlJywgKCkgPT4ge1xyXG4gIGxldCBhcHA7XHJcbiAgXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBhcHAgPSBjcmVhdGVUZXN0QXBwKCk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgaXQoJ3Nob3VsZCBhbGxvdyBhdXRoZW50aWNhdGVkIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgIC5nZXQoJy9hcGkvcHJvdGVjdGVkJylcclxuICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgdmFsaWQtdG9rZW4nKVxyXG4gICAgICAuZXhwZWN0KDIwMCk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgZXhwZWN0KHJlcy5ib2R5LnVzZXIpLnRvQmVEZWZpbmVkKCk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgaXQoJ3Nob3VsZCByZWplY3QgdW5hdXRoZW50aWNhdGVkIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgIC5nZXQoJy9hcGkvcHJvdGVjdGVkJylcclxuICAgICAgLmV4cGVjdCg0MDEpO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzLmJvZHkuZXJyb3IpLnRvQmUoJ1VuYXV0aG9yaXplZCcpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgcmVqZWN0IHJlcXVlc3RzIHdpdGggaW52YWxpZCB0b2tlbiBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgLmdldCgnL2FwaS9wcm90ZWN0ZWQnKVxyXG4gICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgJ0ludmFsaWRGb3JtYXQnKVxyXG4gICAgICAuZXhwZWN0KDQwMSk7XHJcbiAgICBcclxuICAgIGV4cGVjdChyZXMuYm9keS5lcnJvcikudG9CZSgnVW5hdXRob3JpemVkJyk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ0FQSSBHYXRld2F5IC0gU2VydmljZSBEaXNjb3ZlcnknLCAoKSA9PiB7XHJcbiAgbGV0IGFwcDtcclxuICBcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGFwcCA9IGNyZWF0ZVRlc3RBcHAoKTtcclxuICB9KTtcclxuICBcclxuICBpdCgnc2hvdWxkIHJldHVybiBsaXN0IG9mIGF2YWlsYWJsZSBzZXJ2aWNlcycsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAuZ2V0KCcvYXBpL3NlcnZpY2VzJylcclxuICAgICAgLmV4cGVjdCgyMDApO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzLmJvZHkuc2VydmljZXMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICBleHBlY3QoT2JqZWN0LmtleXMocmVzLmJvZHkuc2VydmljZXMpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgaW5jbHVkZSBzZXJ2aWNlIFVSTHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgLmdldCgnL2FwaS9zZXJ2aWNlcycpXHJcbiAgICAgIC5leHBlY3QoMjAwKTtcclxuICAgIFxyXG4gICAgY29uc3Qgc2VydmljZXMgPSByZXMuYm9keS5zZXJ2aWNlcztcclxuICAgIE9iamVjdC52YWx1ZXMoc2VydmljZXMpLmZvckVhY2godXJsID0+IHtcclxuICAgICAgZXhwZWN0KHVybCkudG9NYXRjaCgvXmh0dHA6XFwvXFwvLyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcblxyXG5kZXNjcmliZSgnQVBJIEdhdGV3YXkgLSBFcnJvciBIYW5kbGluZycsICgpID0+IHtcclxuICBsZXQgYXBwO1xyXG4gIFxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgYXBwID0gY3JlYXRlVGVzdEFwcCgpO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGl0KCdzaG91bGQgaGFuZGxlIDQwNCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgLmdldCgnL2FwaS9ub25leGlzdGVudCcpXHJcbiAgICAgIC5leHBlY3QoNDA0KTtcclxuICB9KTtcclxuICBcclxuICBpdCgnc2hvdWxkIGhhbmRsZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IGVycm9yQXBwID0gZXhwcmVzcygpO1xyXG4gICAgZXJyb3JBcHAudXNlKGV4cHJlc3MuanNvbigpKTtcclxuICAgIFxyXG4gICAgZXJyb3JBcHAuZ2V0KCcvYXBpL2Vycm9yJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICAgIG5leHQobmV3IEVycm9yKCdUZXN0IGVycm9yJykpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGVycm9yQXBwLnVzZSgoZXJyLCByZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnIubWVzc2FnZSB9KTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGVycm9yQXBwKVxyXG4gICAgICAuZ2V0KCcvYXBpL2Vycm9yJylcclxuICAgICAgLmV4cGVjdCg1MDApO1xyXG4gICAgXHJcbiAgICBleHBlY3QocmVzLmJvZHkuZXJyb3IpLnRvQmUoJ1Rlc3QgZXJyb3InKTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDcEMsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1FLFNBQVMsR0FBR0YsT0FBTyxDQUFDLG9CQUFvQixDQUFDOztBQUUvQztBQUNBLE1BQU1HLGFBQWEsR0FBR0EsQ0FBQSxLQUFNO0VBQzFCLE1BQU1DLEdBQUcsR0FBR0gsT0FBTyxDQUFDLENBQUM7RUFDckJHLEdBQUcsQ0FBQ0MsR0FBRyxDQUFDSixPQUFPLENBQUNLLElBQUksQ0FBQyxDQUFDLENBQUM7O0VBRXZCO0VBQ0EsTUFBTUMsV0FBVyxHQUFHTCxTQUFTLENBQUM7SUFDNUJNLFFBQVEsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUk7SUFDeEJDLEdBQUcsRUFBRSxDQUFDO0lBQUU7SUFDUkMsT0FBTyxFQUFFO01BQUVDLEtBQUss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