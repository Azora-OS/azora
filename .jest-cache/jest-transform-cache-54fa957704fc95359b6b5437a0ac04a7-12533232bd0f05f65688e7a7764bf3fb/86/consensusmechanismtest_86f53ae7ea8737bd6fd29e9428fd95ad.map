{"version":3,"names":["request","require","express","createTestApp","app","use","json","get","req","res","mechanism","active","validators","Math","floor","random","currentEpoch","post","validator","transactions","body","status","error","proposal","proposalId","Date","now","blockNumber","transactionCount","length","timestamp","toISOString","vote","undefined","voteRecord","voteId","address","stake","totalStake","describe","beforeEach","it","response","expect","toBe","toHaveProperty","send","Array","isArray"],"sources":["consensus-mechanism.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst express = require('express');\r\n\r\nfunction createTestApp() {\r\n  const app = express();\r\n  app.use(express.json());\r\n\r\n  app.get('/api/blockchain/consensus/status', (req, res) => {\r\n    res.json({\r\n      mechanism: 'proof-of-stake',\r\n      active: true,\r\n      validators: Math.floor(Math.random() * 100) + 20,\r\n      currentEpoch: Math.floor(Math.random() * 1000)\r\n    });\r\n  });\r\n\r\n  app.post('/api/blockchain/consensus/propose-block', (req, res) => {\r\n    const { validator, transactions } = req.body;\r\n\r\n    if (!validator) {\r\n      return res.status(400).json({ error: 'Validator address is required' });\r\n    }\r\n\r\n    const proposal = {\r\n      proposalId: `prop_${Date.now()}`,\r\n      validator,\r\n      blockNumber: Math.floor(Math.random() * 1000000),\r\n      transactionCount: transactions?.length || 0,\r\n      status: 'pending',\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    res.json(proposal);\r\n  });\r\n\r\n  app.post('/api/blockchain/consensus/vote', (req, res) => {\r\n    const { proposalId, validator, vote } = req.body;\r\n\r\n    if (!proposalId || !validator || vote === undefined) {\r\n      return res.status(400).json({ error: 'Proposal ID, validator, and vote are required' });\r\n    }\r\n\r\n    const voteRecord = {\r\n      voteId: `vote_${Date.now()}`,\r\n      proposalId,\r\n      validator,\r\n      vote,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    res.json(voteRecord);\r\n  });\r\n\r\n  app.get('/api/blockchain/consensus/validators', (req, res) => {\r\n    res.json({\r\n      validators: [\r\n        { address: '0x1234', stake: '1000000', active: true },\r\n        { address: '0x5678', stake: '500000', active: true }\r\n      ],\r\n      totalStake: '1500000'\r\n    });\r\n  });\r\n\r\n  return app;\r\n}\r\n\r\ndescribe('Azora Blockchain - Consensus Mechanism Tests', () => {\r\n  let app;\r\n\r\n  beforeEach(() => {\r\n    app = createTestApp();\r\n  });\r\n\r\n  describe('GET /api/blockchain/consensus/status', () => {\r\n    it('should return consensus mechanism status', async () => {\r\n      const response = await request(app)\r\n        .get('/api/blockchain/consensus/status');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('mechanism');\r\n      expect(response.body).toHaveProperty('active');\r\n      expect(response.body).toHaveProperty('validators');\r\n    });\r\n\r\n    it('should report current epoch', async () => {\r\n      const response = await request(app)\r\n        .get('/api/blockchain/consensus/status');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('currentEpoch');\r\n      expect(typeof response.body.currentEpoch).toBe('number');\r\n    });\r\n  });\r\n\r\n  describe('POST /api/blockchain/consensus/propose-block', () => {\r\n    it('should allow validator to propose block', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/propose-block')\r\n        .send({\r\n          validator: '0x1234567890123456789012345678901234567890',\r\n          transactions: ['tx1', 'tx2', 'tx3']\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('proposalId');\r\n      expect(response.body.validator).toBe('0x1234567890123456789012345678901234567890');\r\n      expect(response.body.transactionCount).toBe(3);\r\n    });\r\n\r\n    it('should return error when validator is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/propose-block')\r\n        .send({ transactions: [] });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Validator address is required');\r\n    });\r\n\r\n    it('should handle proposals without transactions', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/propose-block')\r\n        .send({ validator: '0x1234' });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.transactionCount).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('POST /api/blockchain/consensus/vote', () => {\r\n    it('should record validator vote on proposal', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/vote')\r\n        .send({\r\n          proposalId: 'prop_123',\r\n          validator: '0x1234567890123456789012345678901234567890',\r\n          vote: true\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('voteId');\r\n      expect(response.body.proposalId).toBe('prop_123');\r\n      expect(response.body.vote).toBe(true);\r\n    });\r\n\r\n    it('should return error when proposal ID is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/vote')\r\n        .send({ validator: '0x1234', vote: true });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Proposal ID, validator, and vote are required');\r\n    });\r\n\r\n    it('should return error when validator is missing', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/vote')\r\n        .send({ proposalId: 'prop_123', vote: true });\r\n\r\n      expect(response.status).toBe(400);\r\n      expect(response.body.error).toBe('Proposal ID, validator, and vote are required');\r\n    });\r\n\r\n    it('should accept negative votes', async () => {\r\n      const response = await request(app)\r\n        .post('/api/blockchain/consensus/vote')\r\n        .send({\r\n          proposalId: 'prop_123',\r\n          validator: '0x1234',\r\n          vote: false\r\n        });\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.vote).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('GET /api/blockchain/consensus/validators', () => {\r\n    it('should return list of validators', async () => {\r\n      const response = await request(app)\r\n        .get('/api/blockchain/consensus/validators');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toHaveProperty('validators');\r\n      expect(Array.isArray(response.body.validators)).toBe(true);\r\n      expect(response.body).toHaveProperty('totalStake');\r\n    });\r\n\r\n    it('should include validator stake information', async () => {\r\n      const response = await request(app)\r\n        .get('/api/blockchain/consensus/validators');\r\n\r\n      expect(response.status).toBe(200);\r\n      expect(response.body.validators[0]).toHaveProperty('stake');\r\n      expect(response.body.validators[0]).toHaveProperty('active');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}