d04d71fad7ce703ff55c83f1f9e3be6d
"use strict";

const request = require('supertest');
const express = require('express');
function createTestApp() {
  const app = express();
  app.use(express.json());
  app.get('/api/blockchain/consensus/status', (req, res) => {
    res.json({
      mechanism: 'proof-of-stake',
      active: true,
      validators: Math.floor(Math.random() * 100) + 20,
      currentEpoch: Math.floor(Math.random() * 1000)
    });
  });
  app.post('/api/blockchain/consensus/propose-block', (req, res) => {
    const {
      validator,
      transactions
    } = req.body;
    if (!validator) {
      return res.status(400).json({
        error: 'Validator address is required'
      });
    }
    const proposal = {
      proposalId: `prop_${Date.now()}`,
      validator,
      blockNumber: Math.floor(Math.random() * 1000000),
      transactionCount: transactions?.length || 0,
      status: 'pending',
      timestamp: new Date().toISOString()
    };
    res.json(proposal);
  });
  app.post('/api/blockchain/consensus/vote', (req, res) => {
    const {
      proposalId,
      validator,
      vote
    } = req.body;
    if (!proposalId || !validator || vote === undefined) {
      return res.status(400).json({
        error: 'Proposal ID, validator, and vote are required'
      });
    }
    const voteRecord = {
      voteId: `vote_${Date.now()}`,
      proposalId,
      validator,
      vote,
      timestamp: new Date().toISOString()
    };
    res.json(voteRecord);
  });
  app.get('/api/blockchain/consensus/validators', (req, res) => {
    res.json({
      validators: [{
        address: '0x1234',
        stake: '1000000',
        active: true
      }, {
        address: '0x5678',
        stake: '500000',
        active: true
      }],
      totalStake: '1500000'
    });
  });
  return app;
}
describe('Azora Blockchain - Consensus Mechanism Tests', () => {
  let app;
  beforeEach(() => {
    app = createTestApp();
  });
  describe('GET /api/blockchain/consensus/status', () => {
    it('should return consensus mechanism status', async () => {
      const response = await request(app).get('/api/blockchain/consensus/status');
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('mechanism');
      expect(response.body).toHaveProperty('active');
      expect(response.body).toHaveProperty('validators');
    });
    it('should report current epoch', async () => {
      const response = await request(app).get('/api/blockchain/consensus/status');
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('currentEpoch');
      expect(typeof response.body.currentEpoch).toBe('number');
    });
  });
  describe('POST /api/blockchain/consensus/propose-block', () => {
    it('should allow validator to propose block', async () => {
      const response = await request(app).post('/api/blockchain/consensus/propose-block').send({
        validator: '0x1234567890123456789012345678901234567890',
        transactions: ['tx1', 'tx2', 'tx3']
      });
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('proposalId');
      expect(response.body.validator).toBe('0x1234567890123456789012345678901234567890');
      expect(response.body.transactionCount).toBe(3);
    });
    it('should return error when validator is missing', async () => {
      const response = await request(app).post('/api/blockchain/consensus/propose-block').send({
        transactions: []
      });
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Validator address is required');
    });
    it('should handle proposals without transactions', async () => {
      const response = await request(app).post('/api/blockchain/consensus/propose-block').send({
        validator: '0x1234'
      });
      expect(response.status).toBe(200);
      expect(response.body.transactionCount).toBe(0);
    });
  });
  describe('POST /api/blockchain/consensus/vote', () => {
    it('should record validator vote on proposal', async () => {
      const response = await request(app).post('/api/blockchain/consensus/vote').send({
        proposalId: 'prop_123',
        validator: '0x1234567890123456789012345678901234567890',
        vote: true
      });
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('voteId');
      expect(response.body.proposalId).toBe('prop_123');
      expect(response.body.vote).toBe(true);
    });
    it('should return error when proposal ID is missing', async () => {
      const response = await request(app).post('/api/blockchain/consensus/vote').send({
        validator: '0x1234',
        vote: true
      });
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Proposal ID, validator, and vote are required');
    });
    it('should return error when validator is missing', async () => {
      const response = await request(app).post('/api/blockchain/consensus/vote').send({
        proposalId: 'prop_123',
        vote: true
      });
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Proposal ID, validator, and vote are required');
    });
    it('should accept negative votes', async () => {
      const response = await request(app).post('/api/blockchain/consensus/vote').send({
        proposalId: 'prop_123',
        validator: '0x1234',
        vote: false
      });
      expect(response.status).toBe(200);
      expect(response.body.vote).toBe(false);
    });
  });
  describe('GET /api/blockchain/consensus/validators', () => {
    it('should return list of validators', async () => {
      const response = await request(app).get('/api/blockchain/consensus/validators');
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('validators');
      expect(Array.isArray(response.body.validators)).toBe(true);
      expect(response.body).toHaveProperty('totalStake');
    });
    it('should include validator stake information', async () => {
      const response = await request(app).get('/api/blockchain/consensus/validators');
      expect(response.status).toBe(200);
      expect(response.body.validators[0]).toHaveProperty('stake');
      expect(response.body.validators[0]).toHaveProperty('active');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImV4cHJlc3MiLCJjcmVhdGVUZXN0QXBwIiwiYXBwIiwidXNlIiwianNvbiIsImdldCIsInJlcSIsInJlcyIsIm1lY2hhbmlzbSIsImFjdGl2ZSIsInZhbGlkYXRvcnMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjdXJyZW50RXBvY2giLCJwb3N0IiwidmFsaWRhdG9yIiwidHJhbnNhY3Rpb25zIiwiYm9keSIsInN0YXR1cyIsImVycm9yIiwicHJvcG9zYWwiLCJwcm9wb3NhbElkIiwiRGF0ZSIsIm5vdyIsImJsb2NrTnVtYmVyIiwidHJhbnNhY3Rpb25Db3VudCIsImxlbmd0aCIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwidm90ZSIsInVuZGVmaW5lZCIsInZvdGVSZWNvcmQiLCJ2b3RlSWQiLCJhZGRyZXNzIiwic3Rha2UiLCJ0b3RhbFN0YWtlIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiaXQiLCJyZXNwb25zZSIsImV4cGVjdCIsInRvQmUiLCJ0b0hhdmVQcm9wZXJ0eSIsInNlbmQiLCJBcnJheSIsImlzQXJyYXkiXSwic291cmNlcyI6WyJjb25zZW5zdXMtbWVjaGFuaXNtLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xyXG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlVGVzdEFwcCgpIHtcclxuICBjb25zdCBhcHAgPSBleHByZXNzKCk7XHJcbiAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XHJcblxyXG4gIGFwcC5nZXQoJy9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvc3RhdHVzJywgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICByZXMuanNvbih7XHJcbiAgICAgIG1lY2hhbmlzbTogJ3Byb29mLW9mLXN0YWtlJyxcclxuICAgICAgYWN0aXZlOiB0cnVlLFxyXG4gICAgICB2YWxpZGF0b3JzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICsgMjAsXHJcbiAgICAgIGN1cnJlbnRFcG9jaDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMClcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBhcHAucG9zdCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy9wcm9wb3NlLWJsb2NrJywgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IHZhbGlkYXRvciwgdHJhbnNhY3Rpb25zIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoIXZhbGlkYXRvcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1ZhbGlkYXRvciBhZGRyZXNzIGlzIHJlcXVpcmVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwcm9wb3NhbCA9IHtcclxuICAgICAgcHJvcG9zYWxJZDogYHByb3BfJHtEYXRlLm5vdygpfWAsXHJcbiAgICAgIHZhbGlkYXRvcixcclxuICAgICAgYmxvY2tOdW1iZXI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApLFxyXG4gICAgICB0cmFuc2FjdGlvbkNvdW50OiB0cmFuc2FjdGlvbnM/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH07XHJcblxyXG4gICAgcmVzLmpzb24ocHJvcG9zYWwpO1xyXG4gIH0pO1xyXG5cclxuICBhcHAucG9zdCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy92b3RlJywgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IHByb3Bvc2FsSWQsIHZhbGlkYXRvciwgdm90ZSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgaWYgKCFwcm9wb3NhbElkIHx8ICF2YWxpZGF0b3IgfHwgdm90ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnUHJvcG9zYWwgSUQsIHZhbGlkYXRvciwgYW5kIHZvdGUgYXJlIHJlcXVpcmVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB2b3RlUmVjb3JkID0ge1xyXG4gICAgICB2b3RlSWQ6IGB2b3RlXyR7RGF0ZS5ub3coKX1gLFxyXG4gICAgICBwcm9wb3NhbElkLFxyXG4gICAgICB2YWxpZGF0b3IsXHJcbiAgICAgIHZvdGUsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9O1xyXG5cclxuICAgIHJlcy5qc29uKHZvdGVSZWNvcmQpO1xyXG4gIH0pO1xyXG5cclxuICBhcHAuZ2V0KCcvYXBpL2Jsb2NrY2hhaW4vY29uc2Vuc3VzL3ZhbGlkYXRvcnMnLCAocmVxLCByZXMpID0+IHtcclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgIHsgYWRkcmVzczogJzB4MTIzNCcsIHN0YWtlOiAnMTAwMDAwMCcsIGFjdGl2ZTogdHJ1ZSB9LFxyXG4gICAgICAgIHsgYWRkcmVzczogJzB4NTY3OCcsIHN0YWtlOiAnNTAwMDAwJywgYWN0aXZlOiB0cnVlIH1cclxuICAgICAgXSxcclxuICAgICAgdG90YWxTdGFrZTogJzE1MDAwMDAnXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGFwcDtcclxufVxyXG5cclxuZGVzY3JpYmUoJ0F6b3JhIEJsb2NrY2hhaW4gLSBDb25zZW5zdXMgTWVjaGFuaXNtIFRlc3RzJywgKCkgPT4ge1xyXG4gIGxldCBhcHA7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgYXBwID0gY3JlYXRlVGVzdEFwcCgpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnR0VUIC9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvc3RhdHVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29uc2Vuc3VzIG1lY2hhbmlzbSBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLmdldCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy9zdGF0dXMnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdtZWNoYW5pc20nKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdhY3RpdmUnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCd2YWxpZGF0b3JzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlcG9ydCBjdXJyZW50IGVwb2NoJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5nZXQoJy9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvc3RhdHVzJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnY3VycmVudEVwb2NoJyk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzcG9uc2UuYm9keS5jdXJyZW50RXBvY2gpLnRvQmUoJ251bWJlcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQT1NUIC9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvcHJvcG9zZS1ibG9jaycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgYWxsb3cgdmFsaWRhdG9yIHRvIHByb3Bvc2UgYmxvY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvcHJvcG9zZS1ibG9jaycpXHJcbiAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgdmFsaWRhdG9yOiAnMHgxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwJyxcclxuICAgICAgICAgIHRyYW5zYWN0aW9uczogWyd0eDEnLCAndHgyJywgJ3R4MyddXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgncHJvcG9zYWxJZCcpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS52YWxpZGF0b3IpLnRvQmUoJzB4MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5MCcpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS50cmFuc2FjdGlvbkNvdW50KS50b0JlKDMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3Igd2hlbiB2YWxpZGF0b3IgaXMgbWlzc2luZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAucG9zdCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy9wcm9wb3NlLWJsb2NrJylcclxuICAgICAgICAuc2VuZCh7IHRyYW5zYWN0aW9uczogW10gfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlKCdWYWxpZGF0b3IgYWRkcmVzcyBpcyByZXF1aXJlZCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcHJvcG9zYWxzIHdpdGhvdXQgdHJhbnNhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL2Jsb2NrY2hhaW4vY29uc2Vuc3VzL3Byb3Bvc2UtYmxvY2snKVxyXG4gICAgICAgIC5zZW5kKHsgdmFsaWRhdG9yOiAnMHgxMjM0JyB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudHJhbnNhY3Rpb25Db3VudCkudG9CZSgwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUE9TVCAvYXBpL2Jsb2NrY2hhaW4vY29uc2Vuc3VzL3ZvdGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJlY29yZCB2YWxpZGF0b3Igdm90ZSBvbiBwcm9wb3NhbCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAucG9zdCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy92b3RlJylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBwcm9wb3NhbElkOiAncHJvcF8xMjMnLFxyXG4gICAgICAgICAgdmFsaWRhdG9yOiAnMHgxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwJyxcclxuICAgICAgICAgIHZvdGU6IHRydWVcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCd2b3RlSWQnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkucHJvcG9zYWxJZCkudG9CZSgncHJvcF8xMjMnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudm90ZSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHdoZW4gcHJvcG9zYWwgSUQgaXMgbWlzc2luZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAucG9zdCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy92b3RlJylcclxuICAgICAgICAuc2VuZCh7IHZhbGlkYXRvcjogJzB4MTIzNCcsIHZvdGU6IHRydWUgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlKCdQcm9wb3NhbCBJRCwgdmFsaWRhdG9yLCBhbmQgdm90ZSBhcmUgcmVxdWlyZWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHdoZW4gdmFsaWRhdG9yIGlzIG1pc3NpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvdm90ZScpXHJcbiAgICAgICAgLnNlbmQoeyBwcm9wb3NhbElkOiAncHJvcF8xMjMnLCB2b3RlOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG9CZSgnUHJvcG9zYWwgSUQsIHZhbGlkYXRvciwgYW5kIHZvdGUgYXJlIHJlcXVpcmVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBuZWdhdGl2ZSB2b3RlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAucG9zdCgnL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy92b3RlJylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBwcm9wb3NhbElkOiAncHJvcF8xMjMnLFxyXG4gICAgICAgICAgdmFsaWRhdG9yOiAnMHgxMjM0JyxcclxuICAgICAgICAgIHZvdGU6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnZvdGUpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdHRVQgL2FwaS9ibG9ja2NoYWluL2NvbnNlbnN1cy92YWxpZGF0b3JzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbGlzdCBvZiB2YWxpZGF0b3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5nZXQoJy9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvdmFsaWRhdG9ycycpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3ZhbGlkYXRvcnMnKTtcclxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS52YWxpZGF0b3JzKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbFN0YWtlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgdmFsaWRhdG9yIHN0YWtlIGluZm9ybWF0aW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5nZXQoJy9hcGkvYmxvY2tjaGFpbi9jb25zZW5zdXMvdmFsaWRhdG9ycycpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS52YWxpZGF0b3JzWzBdKS50b0hhdmVQcm9wZXJ0eSgnc3Rha2UnKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudmFsaWRhdG9yc1swXSkudG9IYXZlUHJvcGVydHkoJ2FjdGl2ZScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ3BDLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUVsQyxTQUFTRSxhQUFhQSxDQUFBLEVBQUc7RUFDdkIsTUFBTUMsR0FBRyxHQUFHRixPQUFPLENBQUMsQ0FBQztFQUNyQkUsR0FBRyxDQUFDQyxHQUFHLENBQUNILE9BQU8sQ0FBQ0ksSUFBSSxDQUFDLENBQUMsQ0FBQztFQUV2QkYsR0FBRyxDQUFDRyxHQUFHLENBQUMsa0NBQWtDLEVBQUUsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7SUFDeERBLEdBQUcsQ0FBQ0gsSUFBSSxDQUFDO01BQ1BJLFNBQVMsRUFBRSxnQkFBZ0I7TUFDM0JDLE1BQU0sRUFBRSxJQUFJO01BQ1pDLFVBQVUsRUFBRUMsSUFBSSxDQUFDQyxLQUFLLENBQUNELElBQUksQ0FBQ0UsTUFBTSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxFQUFFO01BQ2hEQyxZQUFZLEVBQUVILElBQUksQ0FBQ0MsS0FBSyxDQUFDRCxJQUFJLENBQUNFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSTtJQUMvQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRlgsR0FBRyxDQUFDYSxJQUFJLENBQUMseUNBQXlDLEVBQUUsQ0FBQ1QsR0FBRyxFQUFFQyxHQUFHLEtB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