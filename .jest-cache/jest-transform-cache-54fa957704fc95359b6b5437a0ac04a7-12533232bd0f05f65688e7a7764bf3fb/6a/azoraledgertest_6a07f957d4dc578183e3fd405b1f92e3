625458ee49ec1b88d998cb963719126f
"use strict";

const request = require('supertest');
const app = require('../server.js');
describe('Azora Ledger Service', () => {
  describe('GET /health', () => {
    it('should return health status', async () => {
      const response = await request(app).get('/health');
      expect(response.status).toBe(200);
      expect(response.body.status).toBe('OK');
      expect(response.body.service).toBe('azora-ledger');
    });
  });
  describe('GET /api/transactions', () => {
    it('should return a list of transactions', async () => {
      const response = await request(app).get('/api/transactions').set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.data).toBeDefined();
      expect(response.body.count).toBeDefined();
    });
  });
  describe('POST /api/transactions', () => {
    it('should create a new transaction', async () => {
      const transactionData = {
        amount: 100,
        currency: 'USD',
        description: 'Test transaction',
        accountId: 'account_123'
      };
      const response = await request(app).post('/api/transactions').send(transactionData).set('Accept', 'application/json');
      expect(response.status).toBe(201);
      expect(response.body.success).toBe(true);
      expect(response.body.data).toBeDefined();
      expect(response.body.data.amount).toBe(transactionData.amount);
    });
    it('should return error when required fields are missing', async () => {
      const transactionData = {
        description: 'Test transaction'
      };
      const response = await request(app).post('/api/transactions').send(transactionData).set('Accept', 'application/json');
      expect(response.status).toBe(400);
      expect(response.body.error).toBe('Amount and currency are required');
    });
  });
  describe('GET /api/transactions/:transactionId', () => {
    it('should return a specific transaction', async () => {
      const transactionId = 'transaction_123';
      const response = await request(app).get(`/api/transactions/${transactionId}`).set('Accept', 'application/json');
      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.data).toBeDefined();
      expect(response.body.data.id).toBe(transactionId);
    });
  });
  describe('404 handling', () => {
    it('should return 404 for unknown routes', async () => {
      const response = await request(app).get('/non-existent-route');
      expect(response.status).toBe(404);
      expect(response.body.error).toBe('Route not found');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiaXQiLCJyZXNwb25zZSIsImdldCIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5Iiwic2VydmljZSIsInNldCIsInN1Y2Nlc3MiLCJkYXRhIiwidG9CZURlZmluZWQiLCJjb3VudCIsInRyYW5zYWN0aW9uRGF0YSIsImFtb3VudCIsImN1cnJlbmN5IiwiZGVzY3JpcHRpb24iLCJhY2NvdW50SWQiLCJwb3N0Iiwic2VuZCIsImVycm9yIiwidHJhbnNhY3Rpb25JZCIsImlkIl0sInNvdXJjZXMiOlsiYXpvcmEtbGVkZ2VyLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xuY29uc3QgYXBwID0gcmVxdWlyZSgnLi4vc2VydmVyLmpzJyk7XG5cbmRlc2NyaWJlKCdBem9yYSBMZWRnZXIgU2VydmljZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0dFVCAvaGVhbHRoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGhlYWx0aCBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9oZWFsdGgnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN0YXR1cykudG9CZSgnT0snKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnNlcnZpY2UpLnRvQmUoJ2F6b3JhLWxlZGdlcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hcGkvdHJhbnNhY3Rpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgbGlzdCBvZiB0cmFuc2FjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3RyYW5zYWN0aW9ucycpXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuY291bnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQT1NUIC9hcGkvdHJhbnNhY3Rpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgbmV3IHRyYW5zYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHJhbnNhY3Rpb25EYXRhID0ge1xuICAgICAgICBhbW91bnQ6IDEwMCxcbiAgICAgICAgY3VycmVuY3k6ICdVU0QnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgdHJhbnNhY3Rpb24nLFxuICAgICAgICBhY2NvdW50SWQ6ICdhY2NvdW50XzEyMydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3RyYW5zYWN0aW9ucycpXG4gICAgICAgIC5zZW5kKHRyYW5zYWN0aW9uRGF0YSlcbiAgICAgICAgLnNldCgnQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDEpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLmFtb3VudCkudG9CZSh0cmFuc2FjdGlvbkRhdGEuYW1vdW50KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHdoZW4gcmVxdWlyZWQgZmllbGRzIGFyZSBtaXNzaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHJhbnNhY3Rpb25EYXRhID0ge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgdHJhbnNhY3Rpb24nXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS90cmFuc2FjdGlvbnMnKVxuICAgICAgICAuc2VuZCh0cmFuc2FjdGlvbkRhdGEpXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlKCdBbW91bnQgYW5kIGN1cnJlbmN5IGFyZSByZXF1aXJlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hcGkvdHJhbnNhY3Rpb25zLzp0cmFuc2FjdGlvbklkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgc3BlY2lmaWMgdHJhbnNhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0cmFuc2FjdGlvbklkID0gJ3RyYW5zYWN0aW9uXzEyMyc7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoYC9hcGkvdHJhbnNhY3Rpb25zLyR7dHJhbnNhY3Rpb25JZH1gKVxuICAgICAgICAuc2V0KCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEuaWQpLnRvQmUodHJhbnNhY3Rpb25JZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCc0MDQgaGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gNDA0IGZvciB1bmtub3duIHJvdXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmdldCgnL25vbi1leGlzdGVudC1yb3V0ZScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDQpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvQmUoJ1JvdXRlIG5vdCBmb3VuZCcpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDcEMsTUFBTUMsR0FBRyxHQUFHRCxPQUFPLENBQUMsY0FBYyxDQUFDO0FBRW5DRSxRQUFRLENBQUMsc0JBQXNCLEVBQUUsTUFBTTtFQUNyQ0EsUUFBUSxDQUFDLGFBQWEsRUFBRSxNQUFNO0lBQzVCQyxFQUFFLENBQUMsNkJBQTZCLEVBQUUsWUFBWTtNQUM1QyxNQUFNQyxRQUFRLEdBQUcsTUFBTUwsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FBQ0ksR0FBRyxDQUFDLFNBQVMsQ0FBQztNQUNsREMsTUFBTSxDQUFDRixRQUFRLENBQUNHLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO01BQ2pDRixNQUFNLENBQUNGLFFBQVEsQ0FBQ0ssSUFBSSxDQUFDRixNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQztNQUN2Q0YsTUFBTSxDQUFDRixRQUFRLENBQUNLLElBQUksQ0FBQ0MsT0FBTyxD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