{"version":3,"names":["_alerts","require","describe","beforeEach","alertsService","stopAlertChecking","it","rule","id","name","description","metric","threshold","operator","duration","severity","enabled","actions","type","addRule","rules","getRules","expect","toContainEqual","removeRule","find","r","toBeUndefined","Array","isArray","toBe","length","toBeGreaterThan","ruleIds","map","toContain","alerts","getActiveAlerts","unresolvedAlerts","filter","a","resolved","history","getAlertHistory","toBeLessThanOrEqual","stats","getAlertStatistics","toHaveProperty","totalActive","critical","warning","info","totalHistory","startAlertChecking","alertId","resolveAlert","updatedAlerts","resolvedAlert","toBeDefined"],"sources":["alerts.service.test.ts"],"sourcesContent":["/**\r\n * Alerts Service Tests\r\n */\r\n\r\nimport { alertsService, AlertRule } from '../alerts.service';\r\n\r\ndescribe('AlertsService', () => {\r\n  beforeEach(() => {\r\n    // Clear active alerts before each test\r\n    alertsService.stopAlertChecking();\r\n  });\r\n\r\n  describe('addRule', () => {\r\n    it('should add an alert rule', () => {\r\n      const rule: AlertRule = {\r\n        id: 'test-rule',\r\n        name: 'Test Rule',\r\n        description: 'Test alert rule',\r\n        metric: 'http_error_rate',\r\n        threshold: 5,\r\n        operator: 'gt',\r\n        duration: 300000,\r\n        severity: 'warning',\r\n        enabled: true,\r\n        actions: [{ type: 'log' }],\r\n      };\r\n\r\n      alertsService.addRule(rule);\r\n      const rules = alertsService.getRules();\r\n\r\n      expect(rules).toContainEqual(rule);\r\n    });\r\n  });\r\n\r\n  describe('removeRule', () => {\r\n    it('should remove an alert rule', () => {\r\n      const rule: AlertRule = {\r\n        id: 'test-rule-2',\r\n        name: 'Test Rule 2',\r\n        description: 'Test alert rule',\r\n        metric: 'http_error_rate',\r\n        threshold: 5,\r\n        operator: 'gt',\r\n        duration: 300000,\r\n        severity: 'warning',\r\n        enabled: true,\r\n        actions: [{ type: 'log' }],\r\n      };\r\n\r\n      alertsService.addRule(rule);\r\n      alertsService.removeRule('test-rule-2');\r\n      const rules = alertsService.getRules();\r\n\r\n      expect(rules.find(r => r.id === 'test-rule-2')).toBeUndefined();\r\n    });\r\n  });\r\n\r\n  describe('getRules', () => {\r\n    it('should return all alert rules', () => {\r\n      const rules = alertsService.getRules();\r\n      expect(Array.isArray(rules)).toBe(true);\r\n      expect(rules.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should include default rules', () => {\r\n      const rules = alertsService.getRules();\r\n      const ruleIds = rules.map(r => r.id);\r\n\r\n      expect(ruleIds).toContain('api-error-rate-high');\r\n      expect(ruleIds).toContain('api-latency-high');\r\n      expect(ruleIds).toContain('db-error-rate-high');\r\n    });\r\n  });\r\n\r\n  describe('getActiveAlerts', () => {\r\n    it('should return active alerts', () => {\r\n      const alerts = alertsService.getActiveAlerts();\r\n      expect(Array.isArray(alerts)).toBe(true);\r\n    });\r\n\r\n    it('should not include resolved alerts', () => {\r\n      const alerts = alertsService.getActiveAlerts();\r\n      const unresolvedAlerts = alerts.filter(a => !a.resolved);\r\n\r\n      expect(unresolvedAlerts.length).toBe(alerts.length);\r\n    });\r\n  });\r\n\r\n  describe('getAlertHistory', () => {\r\n    it('should return alert history', () => {\r\n      const history = alertsService.getAlertHistory();\r\n      expect(Array.isArray(history)).toBe(true);\r\n    });\r\n\r\n    it('should respect limit parameter', () => {\r\n      const history = alertsService.getAlertHistory(10);\r\n      expect(history.length).toBeLessThanOrEqual(10);\r\n    });\r\n  });\r\n\r\n  describe('getAlertStatistics', () => {\r\n    it('should return alert statistics', () => {\r\n      const stats = alertsService.getAlertStatistics();\r\n\r\n      expect(stats).toHaveProperty('totalActive');\r\n      expect(stats).toHaveProperty('critical');\r\n      expect(stats).toHaveProperty('warning');\r\n      expect(stats).toHaveProperty('info');\r\n      expect(stats).toHaveProperty('totalHistory');\r\n      expect(stats).toHaveProperty('rules');\r\n    });\r\n\r\n    it('should have correct statistics structure', () => {\r\n      const stats = alertsService.getAlertStatistics();\r\n\r\n      expect(typeof stats.totalActive).toBe('number');\r\n      expect(typeof stats.critical).toBe('number');\r\n      expect(typeof stats.warning).toBe('number');\r\n      expect(typeof stats.info).toBe('number');\r\n      expect(typeof stats.totalHistory).toBe('number');\r\n      expect(typeof stats.rules).toBe('number');\r\n    });\r\n  });\r\n\r\n  describe('startAlertChecking', () => {\r\n    it('should start alert checking', () => {\r\n      alertsService.startAlertChecking(1000);\r\n      // Alert checking should be running\r\n      expect(true).toBe(true);\r\n      alertsService.stopAlertChecking();\r\n    });\r\n  });\r\n\r\n  describe('stopAlertChecking', () => {\r\n    it('should stop alert checking', () => {\r\n      alertsService.startAlertChecking(1000);\r\n      alertsService.stopAlertChecking();\r\n      // Alert checking should be stopped\r\n      expect(true).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('resolveAlert', () => {\r\n    it('should resolve an alert', () => {\r\n      const alerts = alertsService.getActiveAlerts();\r\n      if (alerts.length > 0) {\r\n        const alertId = alerts[0].id;\r\n        alertsService.resolveAlert(alertId);\r\n\r\n        const updatedAlerts = alertsService.getActiveAlerts();\r\n        const resolvedAlert = updatedAlerts.find(a => a.id === alertId);\r\n\r\n        expect(resolvedAlert?.resolved).toBe(true);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('default rules', () => {\r\n    it('should have api-error-rate-high rule', () => {\r\n      const rules = alertsService.getRules();\r\n      const rule = rules.find(r => r.id === 'api-error-rate-high');\r\n\r\n      expect(rule).toBeDefined();\r\n      expect(rule?.name).toBe('High API Error Rate');\r\n      expect(rule?.threshold).toBe(5);\r\n      expect(rule?.operator).toBe('gt');\r\n      expect(rule?.severity).toBe('critical');\r\n    });\r\n\r\n    it('should have api-latency-high rule', () => {\r\n      const rules = alertsService.getRules();\r\n      const rule = rules.find(r => r.id === 'api-latency-high');\r\n\r\n      expect(rule).toBeDefined();\r\n      expect(rule?.name).toBe('High API Latency');\r\n      expect(rule?.threshold).toBe(2000);\r\n      expect(rule?.operator).toBe('gt');\r\n      expect(rule?.severity).toBe('warning');\r\n    });\r\n\r\n    it('should have memory-usage-high rule', () => {\r\n      const rules = alertsService.getRules();\r\n      const rule = rules.find(r => r.id === 'memory-usage-high');\r\n\r\n      expect(rule).toBeDefined();\r\n      expect(rule?.name).toBe('High Memory Usage');\r\n      expect(rule?.threshold).toBe(90);\r\n      expect(rule?.operator).toBe('gt');\r\n      expect(rule?.severity).toBe('critical');\r\n    });\r\n\r\n    it('should have conversion-rate-low rule', () => {\r\n      const rules = alertsService.getRules();\r\n      const rule = rules.find(r => r.id === 'conversion-rate-low');\r\n\r\n      expect(rule).toBeDefined();\r\n      expect(rule?.name).toBe('Low Conversion Rate');\r\n      expect(rule?.threshold).toBe(30);\r\n      expect(rule?.operator).toBe('lt');\r\n      expect(rule?.severity).toBe('warning');\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}