65e25f07335b5c6a58e061c21cf05a9a
"use strict";

const request = require('supertest');
const {
  rateLimiters,
  validateInput,
  sanitizeInput
} = require('../../packages/security-middleware');
const {
  schemas
} = require('../../packages/input-validation');
describe('Security Tests', () => {
  describe('Rate Limiting', () => {
    test('should enforce rate limits', () => {
      expect(rateLimiters.standard).toBeDefined();
      expect(rateLimiters.auth).toBeDefined();
      expect(rateLimiters.financial).toBeDefined();
    });
  });
  describe('Input Validation', () => {
    test('should validate user creation', () => {
      const valid = {
        email: 'test@test.com',
        password: 'password123',
        name: 'Test'
      };
      expect(() => schemas.user.create.parse(valid)).not.toThrow();
    });
    test('should reject invalid email', () => {
      const invalid = {
        email: 'invalid',
        password: 'password123',
        name: 'Test'
      };
      expect(() => schemas.user.create.parse(invalid)).toThrow();
    });
    test('should reject short password', () => {
      const invalid = {
        email: 'test@test.com',
        password: '123',
        name: 'Test'
      };
      expect(() => schemas.user.create.parse(invalid)).toThrow();
    });
  });
  describe('Input Sanitization', () => {
    test('should sanitize XSS attempts', () => {
      const req = {
        body: {
          name: '<script>alert("xss")</script>'
        },
        query: {},
        params: {}
      };
      const res = {};
      const next = jest.fn();
      sanitizeInput(req, res, next);
      expect(req.body.name).not.toContain('<script>');
      expect(next).toHaveBeenCalled();
    });
  });
  describe('CORS', () => {
    test('should allow localhost origins', () => {
      const allowedOrigins = ['http://localhost:3000', 'http://localhost:3001'];
      expect(allowedOrigins).toContain('http://localhost:3000');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsInJhdGVMaW1pdGVycyIsInZhbGlkYXRlSW5wdXQiLCJzYW5pdGl6ZUlucHV0Iiwic2NoZW1hcyIsImRlc2NyaWJlIiwidGVzdCIsImV4cGVjdCIsInN0YW5kYXJkIiwidG9CZURlZmluZWQiLCJhdXRoIiwiZmluYW5jaWFsIiwidmFsaWQiLCJlbWFpbCIsInBhc3N3b3JkIiwibmFtZSIsInVzZXIiLCJjcmVhdGUiLCJwYXJzZSIsIm5vdCIsInRvVGhyb3ciLCJpbnZhbGlkIiwicmVxIiwiYm9keSIsInF1ZXJ5IiwicGFyYW1zIiwicmVzIiwibmV4dCIsImplc3QiLCJmbiIsInRvQ29udGFpbiIsInRvSGF2ZUJlZW5DYWxsZWQiLCJhbGxvd2VkT3JpZ2lucyJdLCJzb3VyY2VzIjpbInNlY3VyaXR5LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xuY29uc3QgeyByYXRlTGltaXRlcnMsIHZhbGlkYXRlSW5wdXQsIHNhbml0aXplSW5wdXQgfSA9IHJlcXVpcmUoJy4uLy4uL3BhY2thZ2VzL3NlY3VyaXR5LW1pZGRsZXdhcmUnKTtcbmNvbnN0IHsgc2NoZW1hcyB9ID0gcmVxdWlyZSgnLi4vLi4vcGFja2FnZXMvaW5wdXQtdmFsaWRhdGlvbicpO1xuXG5kZXNjcmliZSgnU2VjdXJpdHkgVGVzdHMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdSYXRlIExpbWl0aW5nJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBlbmZvcmNlIHJhdGUgbGltaXRzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHJhdGVMaW1pdGVycy5zdGFuZGFyZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyYXRlTGltaXRlcnMuYXV0aCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyYXRlTGltaXRlcnMuZmluYW5jaWFsKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW5wdXQgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgdXNlciBjcmVhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkID0geyBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLCBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJywgbmFtZTogJ1Rlc3QnIH07XG4gICAgICBleHBlY3QoKCkgPT4gc2NoZW1hcy51c2VyLmNyZWF0ZS5wYXJzZSh2YWxpZCkpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgZW1haWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkID0geyBlbWFpbDogJ2ludmFsaWQnLCBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJywgbmFtZTogJ1Rlc3QnIH07XG4gICAgICBleHBlY3QoKCkgPT4gc2NoZW1hcy51c2VyLmNyZWF0ZS5wYXJzZShpbnZhbGlkKSkudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJlamVjdCBzaG9ydCBwYXNzd29yZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWQgPSB7IGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsIHBhc3N3b3JkOiAnMTIzJywgbmFtZTogJ1Rlc3QnIH07XG4gICAgICBleHBlY3QoKCkgPT4gc2NoZW1hcy51c2VyLmNyZWF0ZS5wYXJzZShpbnZhbGlkKSkudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW5wdXQgU2FuaXRpemF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBzYW5pdGl6ZSBYU1MgYXR0ZW1wdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXEgPSB7IGJvZHk6IHsgbmFtZTogJzxzY3JpcHQ+YWxlcnQoXCJ4c3NcIik8L3NjcmlwdD4nIH0sIHF1ZXJ5OiB7fSwgcGFyYW1zOiB7fSB9O1xuICAgICAgY29uc3QgcmVzID0ge307XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpO1xuICAgICAgXG4gICAgICBzYW5pdGl6ZUlucHV0KHJlcSwgcmVzLCBuZXh0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlcS5ib2R5Lm5hbWUpLm5vdC50b0NvbnRhaW4oJzxzY3JpcHQ+Jyk7XG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ09SUycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYWxsb3cgbG9jYWxob3N0IG9yaWdpbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGxvd2VkT3JpZ2lucyA9IFsnaHR0cDovL2xvY2FsaG9zdDozMDAwJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMSddO1xuICAgICAgZXhwZWN0KGFsbG93ZWRPcmlnaW5zKS50b0NvbnRhaW4oJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNwQyxNQUFNO0VBQUVDLFlBQVk7RUFBRUMsYUFBYTtFQUFFQztBQUFjLENBQUMsR0FBR0gsT0FBTyxDQUFDLG9DQUFvQyxDQUFDO0FBQ3BHLE1BQU07RUFBRUk7QUFBUSxDQUFDLEdBQUdKLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQztBQUU5REssUUFBUSxDQUFDLGdCQUFnQixFQUFFLE1BQU07RUFDL0JBLFFBQVEsQ0FBQyxlQUFlLEVBQUUsTUFBTTtJQUM5QkMsSUFBSSxDQUFDLDRCQUE0QixFQUFFLE1BQU07TUFDdkNDLE1BQU0sQ0FBQ04sWUFBWSxDQUFDTyxRQUFRLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7TUFDM0NGLE1BQU0sQ0FBQ04sWUFBWSxDQUFDUyxJQUFJLENBQUMsQ0FBQ0QsV0FBVyxDQUFDLENBQUM7TUFDdkNGLE1BQU0sQ0FBQ04sWUFBWSxDQUFDVSxTQUFT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