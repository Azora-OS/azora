{"version":3,"names":["_dataRetention","require","describe","manager","beforeEach","DataRetentionManager","it","policy","getRetentionPolicy","expect","toBeDefined","dataType","toBe","retentionDays","autoDelete","toBeUndefined","policies","getAllRetentionPolicies","Array","isArray","length","toBeGreaterThan","dataTypes","map","p","toContain","forEach","cleanupExpiredData","resolves","not","toThrow","autoDeletePolicies","filter","scheduleCleanup","customCron","transactionPolicy","find","auditPolicy","sessionPolicy","temporaryDataTypes"],"sources":["data-retention.test.ts"],"sourcesContent":["import { DataRetentionManager } from '../data-retention';\r\n\r\ndescribe('DataRetentionManager', () => {\r\n  let manager: DataRetentionManager;\r\n\r\n  beforeEach(() => {\r\n    manager = new DataRetentionManager();\r\n  });\r\n\r\n  describe('getRetentionPolicy', () => {\r\n    it('should return retention policy for known data type', () => {\r\n      const policy = manager.getRetentionPolicy('user_activity_logs');\r\n\r\n      expect(policy).toBeDefined();\r\n      expect(policy?.dataType).toBe('user_activity_logs');\r\n      expect(policy?.retentionDays).toBe(90);\r\n      expect(policy?.autoDelete).toBe(true);\r\n    });\r\n\r\n    it('should return undefined for unknown data type', () => {\r\n      const policy = manager.getRetentionPolicy('unknown_type');\r\n      expect(policy).toBeUndefined();\r\n    });\r\n\r\n    it('should return correct retention for transaction records', () => {\r\n      const policy = manager.getRetentionPolicy('transaction_records');\r\n\r\n      expect(policy?.retentionDays).toBe(2555); // 7 years\r\n      expect(policy?.autoDelete).toBe(false);\r\n    });\r\n\r\n    it('should return correct retention for course progress', () => {\r\n      const policy = manager.getRetentionPolicy('course_progress');\r\n\r\n      expect(policy?.retentionDays).toBe(1825); // 5 years\r\n      expect(policy?.autoDelete).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('getAllRetentionPolicies', () => {\r\n    it('should return all retention policies', () => {\r\n      const policies = manager.getAllRetentionPolicies();\r\n\r\n      expect(Array.isArray(policies)).toBe(true);\r\n      expect(policies.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should include essential policies', () => {\r\n      const policies = manager.getAllRetentionPolicies();\r\n      const dataTypes = policies.map(p => p.dataType);\r\n\r\n      expect(dataTypes).toContain('user_activity_logs');\r\n      expect(dataTypes).toContain('transaction_records');\r\n      expect(dataTypes).toContain('course_progress');\r\n      expect(dataTypes).toContain('session_data');\r\n      expect(dataTypes).toContain('audit_logs');\r\n    });\r\n\r\n    it('should have valid retention days', () => {\r\n      const policies = manager.getAllRetentionPolicies();\r\n\r\n      policies.forEach(policy => {\r\n        expect(policy.retentionDays).toBeGreaterThan(0);\r\n        expect(typeof policy.autoDelete).toBe('boolean');\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('cleanupExpiredData', () => {\r\n    it('should run cleanup without errors', async () => {\r\n      await expect(manager.cleanupExpiredData()).resolves.not.toThrow();\r\n    });\r\n\r\n    it('should handle cleanup for auto-delete policies', async () => {\r\n      const policies = manager.getAllRetentionPolicies();\r\n      const autoDeletePolicies = policies.filter(p => p.autoDelete);\r\n\r\n      expect(autoDeletePolicies.length).toBeGreaterThan(0);\r\n      await expect(manager.cleanupExpiredData()).resolves.not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('scheduleCleanup', () => {\r\n    it('should schedule cleanup with default cron', async () => {\r\n      await expect(manager.scheduleCleanup()).resolves.not.toThrow();\r\n    });\r\n\r\n    it('should schedule cleanup with custom cron', async () => {\r\n      const customCron = '0 3 * * *'; // 3 AM daily\r\n      await expect(manager.scheduleCleanup(customCron)).resolves.not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('GDPR Compliance', () => {\r\n    it('should comply with GDPR retention requirements', () => {\r\n      const policies = manager.getAllRetentionPolicies();\r\n\r\n      // Verify transaction records are retained for 7 years (legal requirement)\r\n      const transactionPolicy = policies.find(p => p.dataType === 'transaction_records');\r\n      expect(transactionPolicy?.retentionDays).toBe(2555); // 7 years\r\n\r\n      // Verify audit logs are retained for 7 years\r\n      const auditPolicy = policies.find(p => p.dataType === 'audit_logs');\r\n      expect(auditPolicy?.retentionDays).toBe(2555); // 7 years\r\n\r\n      // Verify session data is auto-deleted\r\n      const sessionPolicy = policies.find(p => p.dataType === 'session_data');\r\n      expect(sessionPolicy?.autoDelete).toBe(true);\r\n    });\r\n\r\n    it('should have auto-delete enabled for temporary data', () => {\r\n      const policies = manager.getAllRetentionPolicies();\r\n\r\n      const temporaryDataTypes = ['user_activity_logs', 'session_data', 'error_logs', 'performance_metrics'];\r\n      temporaryDataTypes.forEach(dataType => {\r\n        const policy = policies.find(p => p.dataType === dataType);\r\n        expect(policy?.autoDelete).toBe(true);\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}