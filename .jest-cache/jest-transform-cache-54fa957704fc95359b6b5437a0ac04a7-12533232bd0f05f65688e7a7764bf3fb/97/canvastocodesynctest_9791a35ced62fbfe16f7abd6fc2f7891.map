{"version":3,"names":["_CodeExecutor","require","_ProjectIndexer","describe","canvas","editor","codeExecutor","indexer","testProjectPath","beforeEach","CodeExecutor","ProjectIndexer","it","serviceComponent","id","type","name","position","x","y","properties","port","framework","generatedCode","generateService","expect","toBeDefined","files","toContain","component","updatedCode","updateServiceConfig","success","toBe","code","uiComponent","connection","source","target","apiCode","generateAPIConnection","indexProject","codeChange","file","content","updateIndex","graph","getProjectGraph","service","services","get","newServiceCode","toBeUndefined","changes","property","value","change","canvasChange","result","applyTransform","options","newValue","startTime","Date","now","components","Array","from","length","_","i","endTime","duration","toBeLessThan"],"sources":["canvas-to-code-sync.test.ts"],"sourcesContent":["import { VisualCanvas } from '../../src/renderer/components/VisualCanvas';\nimport { MonacoEditor } from '../../src/renderer/components/MonacoEditor';\nimport { CodeExecutor } from '../../src/main/services/CodeExecutor';\nimport { ProjectIndexer } from '../../src/main/services/ProjectIndexer';\n\n/**\n * Integration tests for canvas-to-code synchronization\n * Tests the bidirectional sync between visual canvas and code editor\n */\ndescribe('Canvas-to-Code Synchronization', () => {\n  let canvas: VisualCanvas;\n  let editor: MonacoEditor;\n  let codeExecutor: CodeExecutor;\n  let indexer: ProjectIndexer;\n  const testProjectPath = '/test/project';\n\n  beforeEach(() => {\n    codeExecutor = new CodeExecutor();\n    indexer = new ProjectIndexer();\n  });\n\n  describe('Canvas to Code', () => {\n    it('should generate code when component is added to canvas', async () => {\n      // Add a service component to canvas\n      const serviceComponent = {\n        id: 'service-1',\n        type: 'service',\n        name: 'AuthService',\n        position: { x: 100, y: 100 },\n        properties: {\n          port: 3001,\n          framework: 'express',\n        },\n      };\n\n      // Simulate adding component to canvas\n      // In real implementation, this would trigger code generation\n      const generatedCode = await codeExecutor.generateService(serviceComponent);\n\n      expect(generatedCode).toBeDefined();\n      expect(generatedCode.files).toContain('src/services/auth-service.ts');\n    });\n\n    it('should update code when component properties change', async () => {\n      // Initial component\n      const component = {\n        id: 'service-1',\n        type: 'service',\n        name: 'UserService',\n        properties: { port: 3000 },\n      };\n\n      // Update properties\n      component.properties.port = 3001;\n\n      // Code should be updated\n      const updatedCode = await codeExecutor.updateServiceConfig(\n        'src/services/user-service.ts',\n        { port: 3001 }\n      );\n\n      expect(updatedCode.success).toBe(true);\n      expect(updatedCode.code).toContain('3001');\n    });\n\n    it('should generate connections when components are linked', async () => {\n      const uiComponent = {\n        id: 'ui-1',\n        type: 'ui',\n        name: 'LoginPage',\n      };\n\n      const serviceComponent = {\n        id: 'service-1',\n        type: 'service',\n        name: 'AuthService',\n      };\n\n      // Create connection\n      const connection = {\n        id: 'conn-1',\n        source: 'ui-1',\n        target: 'service-1',\n        type: 'api-call',\n      };\n\n      // Should generate API client code\n      const apiCode = await codeExecutor.generateAPIConnection(\n        uiComponent,\n        serviceComponent,\n        connection\n      );\n\n      expect(apiCode).toBeDefined();\n      expect(apiCode.code).toContain('fetch');\n      expect(apiCode.code).toContain('AuthService');\n    });\n  });\n\n  describe('Code to Canvas', () => {\n    it('should update canvas when code is edited', async () => {\n      // Index project to detect changes\n      await indexer.indexProject(testProjectPath);\n\n      // Simulate code change\n      const codeChange = {\n        file: 'src/services/user-service.ts',\n        type: 'modify',\n        content: `\n          export class UserService {\n            constructor(private port: number = 3002) {}\n          }\n        `,\n      };\n\n      // Update index\n      await indexer.updateIndex([codeChange.file]);\n\n      // Canvas should reflect the change\n      const graph = indexer.getProjectGraph();\n      const service = graph?.services.get('UserService');\n\n      expect(service).toBeDefined();\n      expect(service?.port).toBe(3002);\n    });\n\n    it('should detect new components added via code', async () => {\n      await indexer.indexProject(testProjectPath);\n\n      // Add new service file\n      const newServiceCode = `\n        export class PaymentService {\n          constructor() {}\n          \n          async processPayment(amount: number) {\n            return { success: true };\n          }\n        }\n      `;\n\n      // Update index with new file\n      await indexer.updateIndex(['src/services/payment-service.ts']);\n\n      // Canvas should show new component\n      const graph = indexer.getProjectGraph();\n      const service = graph?.services.get('PaymentService');\n\n      expect(service).toBeDefined();\n      expect(service?.name).toBe('PaymentService');\n    });\n\n    it('should remove components from canvas when code is deleted', async () => {\n      await indexer.indexProject(testProjectPath);\n\n      // Remove file\n      await indexer.updateIndex(['src/services/old-service.ts']);\n\n      // Canvas should not show deleted component\n      const graph = indexer.getProjectGraph();\n      const service = graph?.services.get('OldService');\n\n      expect(service).toBeUndefined();\n    });\n  });\n\n  describe('Bidirectional Sync', () => {\n    it('should maintain consistency during rapid changes', async () => {\n      await indexer.indexProject(testProjectPath);\n\n      // Make multiple changes in quick succession\n      const changes = [\n        { type: 'add-component', name: 'Service1' },\n        { type: 'modify-property', name: 'Service1', property: 'port', value: 3001 },\n        { type: 'add-connection', source: 'UI1', target: 'Service1' },\n      ];\n\n      for (const change of changes) {\n        if (change.type === 'add-component') {\n          await codeExecutor.generateService({ name: change.name });\n        } else if (change.type === 'modify-property') {\n          await codeExecutor.updateServiceConfig(`src/services/${change.name}.ts`, {\n            [change.property]: change.value,\n          });\n        }\n      }\n\n      // Verify final state is consistent\n      await indexer.updateIndex(['src/services/Service1.ts']);\n      const graph = indexer.getProjectGraph();\n      const service = graph?.services.get('Service1');\n\n      expect(service).toBeDefined();\n      expect(service?.port).toBe(3001);\n    });\n\n    it('should handle conflicts gracefully', async () => {\n      // Canvas change\n      const canvasChange = {\n        component: 'UserService',\n        property: 'port',\n        value: 3001,\n      };\n\n      // Simultaneous code change\n      const codeChange = {\n        file: 'src/services/user-service.ts',\n        property: 'port',\n        value: 3002,\n      };\n\n      // System should detect conflict and prompt user\n      // In this test, we verify that both changes are tracked\n      const result = await codeExecutor.applyTransform(\n        codeChange.file,\n        {\n          type: 'custom',\n          target: 'port',\n          options: { newValue: canvasChange.value },\n        }\n      );\n\n      expect(result.success).toBe(true);\n      // Last write wins or user is prompted\n    });\n  });\n\n  describe('Performance', () => {\n    it('should sync large projects efficiently', async () => {\n      const startTime = Date.now();\n\n      // Simulate large project with 100 components\n      const components = Array.from({ length: 100 }, (_, i) => ({\n        id: `service-${i}`,\n        type: 'service',\n        name: `Service${i}`,\n      }));\n\n      for (const component of components) {\n        await codeExecutor.generateService(component);\n      }\n\n      const endTime = Date.now();\n      const duration = endTime - startTime;\n\n      // Should complete within reasonable time (10 seconds for 100 components)\n      expect(duration).toBeLessThan(10000);\n    });\n  });\n});\n"],"mappings":"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","ignoreList":[]}