70469f6d0dd4c393f323b6588afb3b07
"use strict";

const request = require('supertest');
const express = require('express');
const gdprRoutes = require('../src/routes/gdpr');
const {
  generateAccessToken
} = require('../src/middleware/jwt');
const app = express();
app.use(express.json());
app.use('/api/gdpr', gdprRoutes);
describe('GDPR Compliance', () => {
  let token;
  beforeAll(() => {
    token = generateAccessToken({
      userId: 1,
      email: 'test@azora.world',
      role: 'student'
    });
  });
  test('should export user data', async () => {
    const res = await request(app).get('/api/gdpr/export').set('Authorization', `Bearer ${token}`);
    expect(res.status).toBe(200);
    expect(res.body.success).toBe(true);
    expect(res.body.data).toHaveProperty('profile');
  });
  test('should schedule data deletion', async () => {
    const res = await request(app).post('/api/gdpr/delete').set('Authorization', `Bearer ${token}`);
    expect(res.status).toBe(200);
    expect(res.body.retentionPeriod).toBe('30 days');
  });
  test('should update consent preferences', async () => {
    const res = await request(app).post('/api/gdpr/consent').set('Authorization', `Bearer ${token}`).send({
      marketing: true,
      analytics: true
    });
    expect(res.status).toBe(200);
    expect(res.body.consent.marketing).toBe(true);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImV4cHJlc3MiLCJnZHByUm91dGVzIiwiZ2VuZXJhdGVBY2Nlc3NUb2tlbiIsImFwcCIsInVzZSIsImpzb24iLCJkZXNjcmliZSIsInRva2VuIiwiYmVmb3JlQWxsIiwidXNlcklkIiwiZW1haWwiLCJyb2xlIiwidGVzdCIsInJlcyIsImdldCIsInNldCIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5Iiwic3VjY2VzcyIsImRhdGEiLCJ0b0hhdmVQcm9wZXJ0eSIsInBvc3QiLCJyZXRlbnRpb25QZXJpb2QiLCJzZW5kIiwibWFya2V0aW5nIiwiYW5hbHl0aWNzIiwiY29uc2VudCJdLCJzb3VyY2VzIjpbImdkcHIudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgZ2RwclJvdXRlcyA9IHJlcXVpcmUoJy4uL3NyYy9yb3V0ZXMvZ2RwcicpO1xuY29uc3QgeyBnZW5lcmF0ZUFjY2Vzc1Rva2VuIH0gPSByZXF1aXJlKCcuLi9zcmMvbWlkZGxld2FyZS9qd3QnKTtcblxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5hcHAudXNlKCcvYXBpL2dkcHInLCBnZHByUm91dGVzKTtcblxuZGVzY3JpYmUoJ0dEUFIgQ29tcGxpYW5jZScsICgpID0+IHtcbiAgbGV0IHRva2VuO1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgdG9rZW4gPSBnZW5lcmF0ZUFjY2Vzc1Rva2VuKHsgdXNlcklkOiAxLCBlbWFpbDogJ3Rlc3RAYXpvcmEud29ybGQnLCByb2xlOiAnc3R1ZGVudCcgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBleHBvcnQgdXNlciBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLmdldCgnL2FwaS9nZHByL2V4cG9ydCcpXG4gICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApO1xuICAgIFxuICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KHJlcy5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KHJlcy5ib2R5LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCdwcm9maWxlJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBzY2hlZHVsZSBkYXRhIGRlbGV0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLnBvc3QoJy9hcGkvZ2Rwci9kZWxldGUnKVxuICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKTtcbiAgICBcbiAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApO1xuICAgIGV4cGVjdChyZXMuYm9keS5yZXRlbnRpb25QZXJpb2QpLnRvQmUoJzMwIGRheXMnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHVwZGF0ZSBjb25zZW50IHByZWZlcmVuY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLnBvc3QoJy9hcGkvZ2Rwci9jb25zZW50JylcbiAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW59YClcbiAgICAgIC5zZW5kKHsgbWFya2V0aW5nOiB0cnVlLCBhbmFseXRpY3M6IHRydWUgfSk7XG4gICAgXG4gICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QocmVzLmJvZHkuY29uc2VudC5tYXJrZXRpbmcpLnRvQmUodHJ1ZSk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FB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