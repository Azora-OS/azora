684156b168e9412bd928f005ad288ea9
"use strict";

var _queryClassifier = require("../query-classifier");
describe('AI Routing Service - Query Routing', () => {
  let classifier;
  beforeEach(() => {
    classifier = new _queryClassifier.QueryClassifier();
  });
  describe('Query Classification', () => {
    it('should classify simple queries correctly', async () => {
      const query = {
        query: 'What is 2+2?'
      };
      const result = await classifier.classify(query);
      expect(result).toBeDefined();
      expect(result.classifiedAs).toBeDefined();
      expect(result.confidence).toBeGreaterThan(0);
      expect(result.routedTo).toBeDefined();
    });
    it('should classify moderate complexity queries', async () => {
      const query = {
        query: 'Explain the benefits of renewable energy and compare it with fossil fuels'
      };
      const result = await classifier.classify(query);
      expect(result).toBeDefined();
      expect(result.classifiedAs).toBeDefined();
      expect(result.confidence).toBeGreaterThan(0);
    });
    it('should classify complex queries', async () => {
      const query = {
        query: 'Develop a comprehensive strategic plan for global expansion including market analysis, risk assessment, financial projections, and implementation timeline'
      };
      const result = await classifier.classify(query);
      expect(result).toBeDefined();
      expect(result.classifiedAs).toBeDefined();
      expect(result.confidence).toBeGreaterThan(0);
    });
    it('should provide routing tier recommendation', async () => {
      const query = {
        query: 'What is AI?'
      };
      const result = await classifier.classify(query);
      expect(result.routedTo).toBeDefined();
      expect(['LOCAL_LLM', 'RAP_SYSTEM', 'EXTERNAL_LLM']).toContain(result.routedTo);
    });
    it('should include reasoning for classification', async () => {
      const query = {
        query: 'Test query'
      };
      const result = await classifier.classify(query);
      expect(result.reasoning).toBeDefined();
      expect(typeof result.reasoning).toBe('string');
    });
    it('should handle empty queries', async () => {
      const query = {
        query: ''
      };
      const result = await classifier.classify(query);
      expect(result).toBeDefined();
      expect(result.classifiedAs).toBeDefined();
    });
    it('should handle very long queries', async () => {
      const longQuery = 'word '.repeat(500);
      const query = {
        query: longQuery
      };
      const result = await classifier.classify(query);
      expect(result).toBeDefined();
      expect(result.classifiedAs).toBeDefined();
    });
    it('should calculate confidence score', async () => {
      const query = {
        query: 'What is machine learning?'
      };
      const result = await classifier.classify(query);
      expect(result.confidence).toBeGreaterThanOrEqual(0);
      expect(result.confidence).toBeLessThanOrEqual(1);
    });
  });
  describe('Provider Routing', () => {
    it('should route to local LLM for simple queries', async () => {
      const query = {
        query: 'Hello'
      };
      const result = await classifier.classify(query);
      expect(['LOCAL_LLM', 'RAP_SYSTEM', 'EXTERNAL_LLM']).toContain(result.routedTo);
    });
    it('should consider query complexity in routing', async () => {
      const simpleQuery = {
        query: 'Hi'
      };
      const complexQuery = {
        query: 'Analyze the geopolitical implications of climate change on global trade patterns'
      };
      const simpleResult = await classifier.classify(simpleQuery);
      const complexResult = await classifier.classify(complexQuery);
      expect(simpleResult.routedTo).toBeDefined();
      expect(complexResult.routedTo).toBeDefined();
    });
    it('should provide consistent routing for same query', async () => {
      const query = {
        query: 'What is Python?'
      };
      const result1 = await classifier.classify(query);
      const result2 = await classifier.classify(query);
      expect(result1.classifiedAs).toBe(result2.classifiedAs);
      expect(result1.routedTo).toBe(result2.routedTo);
    });
  });
  describe('Load Balancing', () => {
    it('should track classification statistics', async () => {
      const queries = [{
        query: 'Simple query 1'
      }, {
        query: 'Simple query 2'
      }, {
        query: 'More complex analytical query about economics'
      }];
      for (const query of queries) {
        await classifier.classify(query);
      }
      const stats = classifier.getClassificationMetrics();
      expect(stats).toBeDefined();
    });
    it('should handle concurrent classifications', async () => {
      const queries = Array.from({
        length: 10
      }, (_, i) => ({
        query: `Test query ${i}`
      }));
      const results = await Promise.all(queries.map(q => classifier.classify(q)));
      expect(results.length).toBe(10);
      results.forEach(result => {
        expect(result).toBeDefined();
        expect(result.classifiedAs).toBeDefined();
      });
    });
  });
  describe('Routing Priority', () => {
    it('should prioritize based on query characteristics', async () => {
      const urgentQuery = {
        query: 'Emergency: System down',
        priority: 'high'
      };
      const normalQuery = {
        query: 'What is AI?'
      };
      const urgentResult = await classifier.classify(urgentQuery);
      const normalResult = await classifier.classify(normalQuery);
      expect(urgentResult).toBeDefined();
      expect(normalResult).toBeDefined();
    });
    it('should consider user context in routing', async () => {
      const query = {
        query: 'Explain quantum computing',
        userId: 'user-123',
        context: {
          userLevel: 'beginner'
        }
      };
      const result = await classifier.classify(query);
      expect(result).toBeDefined();
      expect(result.classifiedAs).toBeDefined();
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcXVlcnlDbGFzc2lmaWVyIiwicmVxdWlyZSIsImRlc2NyaWJlIiwiY2xhc3NpZmllciIsImJlZm9yZUVhY2giLCJRdWVyeUNsYXNzaWZpZXIiLCJpdCIsInF1ZXJ5IiwicmVzdWx0IiwiY2xhc3NpZnkiLCJleHBlY3QiLCJ0b0JlRGVmaW5lZCIsImNsYXNzaWZpZWRBcyIsImNvbmZpZGVuY2UiLCJ0b0JlR3JlYXRlclRoYW4iLCJyb3V0ZWRUbyIsInRvQ29udGFpbiIsInJlYXNvbmluZyIsInRvQmUiLCJsb25nUXVlcnkiLCJyZXBlYXQiLCJ0b0JlR3JlYXRlclRoYW5PckVxdWFsIiwidG9CZUxlc3NUaGFuT3JFcXVhbCIsInNpbXBsZVF1ZXJ5IiwiY29tcGxleFF1ZXJ5Iiwic2ltcGxlUmVzdWx0IiwiY29tcGxleFJlc3VsdCIsInJlc3VsdDEiLCJyZXN1bHQyIiwicXVlcmllcyIsInN0YXRzIiwiZ2V0Q2xhc3NpZmljYXRpb25NZXRyaWNzIiwiQXJyYXkiLCJmcm9tIiwibGVuZ3RoIiwiXyIsImkiLCJyZXN1bHRzIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsInEiLCJmb3JFYWNoIiwidXJnZW50UXVlcnkiLCJwcmlvcml0eSIsIm5vcm1hbFF1ZXJ5IiwidXJnZW50UmVzdWx0Iiwibm9ybWFsUmVzdWx0IiwidXNlcklkIiwiY29udGV4dCIsInVzZXJMZXZlbCJdLCJzb3VyY2VzIjpbInJvdXRpbmcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBRdWVyeUNsYXNzaWZpZXIgfSBmcm9tICcuLi9xdWVyeS1jbGFzc2lmaWVyJztcclxuXHJcbmRlc2NyaWJlKCdBSSBSb3V0aW5nIFNlcnZpY2UgLSBRdWVyeSBSb3V0aW5nJywgKCkgPT4ge1xyXG4gIGxldCBjbGFzc2lmaWVyOiBRdWVyeUNsYXNzaWZpZXI7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgY2xhc3NpZmllciA9IG5ldyBRdWVyeUNsYXNzaWZpZXIoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1F1ZXJ5IENsYXNzaWZpY2F0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSBzaW1wbGUgcXVlcmllcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBxdWVyeTogJ1doYXQgaXMgMisyPycgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsYXNzaWZpZXIuY2xhc3NpZnkocXVlcnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc2lmaWVkQXMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY29uZmlkZW5jZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJvdXRlZFRvKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSBtb2RlcmF0ZSBjb21wbGV4aXR5IHF1ZXJpZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBxdWVyeTogJ0V4cGxhaW4gdGhlIGJlbmVmaXRzIG9mIHJlbmV3YWJsZSBlbmVyZ3kgYW5kIGNvbXBhcmUgaXQgd2l0aCBmb3NzaWwgZnVlbHMnIH07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NpZmllZEFzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgY29tcGxleCBxdWVyaWVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgICBxdWVyeTogJ0RldmVsb3AgYSBjb21wcmVoZW5zaXZlIHN0cmF0ZWdpYyBwbGFuIGZvciBnbG9iYWwgZXhwYW5zaW9uIGluY2x1ZGluZyBtYXJrZXQgYW5hbHlzaXMsIHJpc2sgYXNzZXNzbWVudCwgZmluYW5jaWFsIHByb2plY3Rpb25zLCBhbmQgaW1wbGVtZW50YXRpb24gdGltZWxpbmUnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NpZmllZEFzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSByb3V0aW5nIHRpZXIgcmVjb21tZW5kYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBxdWVyeTogJ1doYXQgaXMgQUk/JyB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xhc3NpZmllci5jbGFzc2lmeShxdWVyeSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnJvdXRlZFRvKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoWydMT0NBTF9MTE0nLCAnUkFQX1NZU1RFTScsICdFWFRFUk5BTF9MTE0nXSkudG9Db250YWluKHJlc3VsdC5yb3V0ZWRUbyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgcmVhc29uaW5nIGZvciBjbGFzc2lmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcXVlcnkgPSB7IHF1ZXJ5OiAnVGVzdCBxdWVyeScgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsYXNzaWZpZXIuY2xhc3NpZnkocXVlcnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWFzb25pbmcpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnJlYXNvbmluZykudG9CZSgnc3RyaW5nJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBxdWVyaWVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBxdWVyeSA9IHsgcXVlcnk6ICcnIH07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NpZmllZEFzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmVyeSBsb25nIHF1ZXJpZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvbmdRdWVyeSA9ICd3b3JkICcucmVwZWF0KDUwMCk7XHJcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBxdWVyeTogbG9uZ1F1ZXJ5IH07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NpZmllZEFzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29uZmlkZW5jZSBzY29yZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcXVlcnkgPSB7IHF1ZXJ5OiAnV2hhdCBpcyBtYWNoaW5lIGxlYXJuaW5nPycgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsYXNzaWZpZXIuY2xhc3NpZnkocXVlcnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5jb25maWRlbmNlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvbmZpZGVuY2UpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1Byb3ZpZGVyIFJvdXRpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJvdXRlIHRvIGxvY2FsIExMTSBmb3Igc2ltcGxlIHF1ZXJpZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBxdWVyeTogJ0hlbGxvJyB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xhc3NpZmllci5jbGFzc2lmeShxdWVyeSk7XHJcblxyXG4gICAgICBleHBlY3QoWydMT0NBTF9MTE0nLCAnUkFQX1NZU1RFTScsICdFWFRFUk5BTF9MTE0nXSkudG9Db250YWluKHJlc3VsdC5yb3V0ZWRUbyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGNvbnNpZGVyIHF1ZXJ5IGNvbXBsZXhpdHkgaW4gcm91dGluZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2ltcGxlUXVlcnkgPSB7IHF1ZXJ5OiAnSGknIH07XHJcbiAgICAgIGNvbnN0IGNvbXBsZXhRdWVyeSA9IHsgcXVlcnk6ICdBbmFseXplIHRoZSBnZW9wb2xpdGljYWwgaW1wbGljYXRpb25zIG9mIGNsaW1hdGUgY2hhbmdlIG9uIGdsb2JhbCB0cmFkZSBwYXR0ZXJucycgfTtcclxuXHJcbiAgICAgIGNvbnN0IHNpbXBsZVJlc3VsdCA9IGF3YWl0IGNsYXNzaWZpZXIuY2xhc3NpZnkoc2ltcGxlUXVlcnkpO1xyXG4gICAgICBjb25zdCBjb21wbGV4UmVzdWx0ID0gYXdhaXQgY2xhc3NpZmllci5jbGFzc2lmeShjb21wbGV4UXVlcnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHNpbXBsZVJlc3VsdC5yb3V0ZWRUbykudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KGNvbXBsZXhSZXN1bHQucm91dGVkVG8pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgY29uc2lzdGVudCByb3V0aW5nIGZvciBzYW1lIHF1ZXJ5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBxdWVyeSA9IHsgcXVlcnk6ICdXaGF0IGlzIFB5dGhvbj8nIH07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQxID0gYXdhaXQgY2xhc3NpZmllci5jbGFzc2lmeShxdWVyeSk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQxLmNsYXNzaWZpZWRBcykudG9CZShyZXN1bHQyLmNsYXNzaWZpZWRBcyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQxLnJvdXRlZFRvKS50b0JlKHJlc3VsdDIucm91dGVkVG8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdMb2FkIEJhbGFuY2luZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdHJhY2sgY2xhc3NpZmljYXRpb24gc3RhdGlzdGljcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcXVlcmllcyA9IFtcclxuICAgICAgICB7IHF1ZXJ5OiAnU2ltcGxlIHF1ZXJ5IDEnIH0sXHJcbiAgICAgICAgeyBxdWVyeTogJ1NpbXBsZSBxdWVyeSAyJyB9LFxyXG4gICAgICAgIHsgcXVlcnk6ICdNb3JlIGNvbXBsZXggYW5hbHl0aWNhbCBxdWVyeSBhYm91dCBlY29ub21pY3MnIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IHF1ZXJ5IG9mIHF1ZXJpZXMpIHtcclxuICAgICAgICBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgc3RhdHMgPSBjbGFzc2lmaWVyLmdldENsYXNzaWZpY2F0aW9uTWV0cmljcygpO1xyXG4gICAgICBleHBlY3Qoc3RhdHMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IGNsYXNzaWZpY2F0aW9ucycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcXVlcmllcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDEwIH0sIChfLCBpKSA9PiAoe1xyXG4gICAgICAgIHF1ZXJ5OiBgVGVzdCBxdWVyeSAke2l9YFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgcXVlcmllcy5tYXAocSA9PiBjbGFzc2lmaWVyLmNsYXNzaWZ5KHEpKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdHMubGVuZ3RoKS50b0JlKDEwKTtcclxuICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgICBleHBlY3QocmVzdWx0LmNsYXNzaWZpZWRBcykudG9CZURlZmluZWQoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1JvdXRpbmcgUHJpb3JpdHknLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHByaW9yaXRpemUgYmFzZWQgb24gcXVlcnkgY2hhcmFjdGVyaXN0aWNzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1cmdlbnRRdWVyeSA9IHsgcXVlcnk6ICdFbWVyZ2VuY3k6IFN5c3RlbSBkb3duJywgcHJpb3JpdHk6ICdoaWdoJyB9O1xyXG4gICAgICBjb25zdCBub3JtYWxRdWVyeSA9IHsgcXVlcnk6ICdXaGF0IGlzIEFJPycgfTtcclxuXHJcbiAgICAgIGNvbnN0IHVyZ2VudFJlc3VsdCA9IGF3YWl0IGNsYXNzaWZpZXIuY2xhc3NpZnkodXJnZW50UXVlcnkpO1xyXG4gICAgICBjb25zdCBub3JtYWxSZXN1bHQgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KG5vcm1hbFF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdCh1cmdlbnRSZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChub3JtYWxSZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGNvbnNpZGVyIHVzZXIgY29udGV4dCBpbiByb3V0aW5nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgICBxdWVyeTogJ0V4cGxhaW4gcXVhbnR1bSBjb21wdXRpbmcnLFxyXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcclxuICAgICAgICBjb250ZXh0OiB7IHVzZXJMZXZlbDogJ2JlZ2lubmVyJyB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGFzc2lmaWVyLmNsYXNzaWZ5KHF1ZXJ5KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NpZmllZEFzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsZ0JBQUEsR0FBQUMsT0FBQTtBQUVBQyxRQUFRLENBQUMsb0NBQW9DLEVBQUUsTUFBTTtFQUNuRCxJQUFJQyxVQUEyQjtFQUUvQkMsVUFBVSxDQUFDLE1BQU07SUFDZkQsVUFBVSxHQUFHLElBQUlFLGdDQUFlLENBQUMsQ0FBQztFQUNwQyxDQUFDLENBQUM7RUFFRkgsUUFB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