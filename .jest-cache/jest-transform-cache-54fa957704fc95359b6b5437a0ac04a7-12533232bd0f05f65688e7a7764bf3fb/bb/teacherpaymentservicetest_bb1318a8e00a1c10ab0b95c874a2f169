76d42ecaf5e8b6e868794ade86deaaec
"use strict";

_getJestObj().mock('@prisma/client', () => ({
  PrismaClient: jest.fn(() => ({
    course: {
      findMany: jest.fn()
    },
    payment: {
      findMany: jest.fn()
    }
  }))
}));
var _teacherPayment = require("../teacher-payment.service");
var _client = require("@prisma/client");
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
describe('TeacherPaymentService', () => {
  let mockPrisma;
  beforeEach(() => {
    jest.clearAllMocks();
    mockPrisma = new _client.PrismaClient();
  });
  describe('calculateRevenue', () => {
    it('should calculate revenue with 70/30 split', async () => {
      mockPrisma.course.findMany.mockResolvedValue([{
        id: 'course-1'
      }]);
      mockPrisma.payment.findMany.mockResolvedValue([{
        amount: 100,
        status: 'completed'
      }, {
        amount: 200,
        status: 'completed'
      }]);
      const revenue = await _teacherPayment.teacherPaymentService.calculateRevenue('instructor-1', '2024-01');
      expect(revenue.totalRevenue).toBe(300);
      expect(revenue.instructorCut).toBe(210); // 70%
      expect(revenue.azoraCut).toBe(90); // 30%
    });
  });
  describe('processWithdrawal', () => {
    it('should process withdrawal', async () => {
      const result = await _teacherPayment.teacherPaymentService.processWithdrawal('instructor-1', 100);
      expect(result.success).toBe(true);
      expect(result.amount).toBe(100);
    });
  });
  describe('getPaymentHistory', () => {
    it('should retrieve payment history', async () => {
      mockPrisma.course.findMany.mockResolvedValue([{
        id: 'course-1'
      }]);
      mockPrisma.payment.findMany.mockResolvedValue([{
        id: 'payment-1',
        amount: 100
      }, {
        id: 'payment-2',
        amount: 200
      }]);
      const history = await _teacherPayment.teacherPaymentService.getPaymentHistory('instructor-1');
      expect(history).toHaveLength(2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJQcmlzbWFDbGllbnQiLCJqZXN0IiwiZm4iLCJjb3Vyc2UiLCJmaW5kTWFueSIsInBheW1lbnQiLCJfdGVhY2hlclBheW1lbnQiLCJyZXF1aXJlIiwiX2NsaWVudCIsImRlc2NyaWJlIiwibW9ja1ByaXNtYSIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwiaXQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImlkIiwiYW1vdW50Iiwic3RhdHVzIiwicmV2ZW51ZSIsInRlYWNoZXJQYXltZW50U2VydmljZSIsImNhbGN1bGF0ZVJldmVudWUiLCJleHBlY3QiLCJ0b3RhbFJldmVudWUiLCJ0b0JlIiwiaW5zdHJ1Y3RvckN1dCIsImF6b3JhQ3V0IiwicmVzdWx0IiwicHJvY2Vzc1dpdGhkcmF3YWwiLCJzdWNjZXNzIiwiaGlzdG9yeSIsImdldFBheW1lbnRIaXN0b3J5IiwidG9IYXZlTGVuZ3RoIl0sInNvdXJjZXMiOlsidGVhY2hlci1wYXltZW50LnNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZWFjaGVyUGF5bWVudFNlcnZpY2UgfSBmcm9tICcuLi90ZWFjaGVyLXBheW1lbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcclxuXHJcbmplc3QubW9jaygnQHByaXNtYS9jbGllbnQnLCAoKSA9PiAoe1xyXG4gIFByaXNtYUNsaWVudDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgY291cnNlOiB7IGZpbmRNYW55OiBqZXN0LmZuKCkgfSxcclxuICAgIHBheW1lbnQ6IHsgZmluZE1hbnk6IGplc3QuZm4oKSB9LFxyXG4gIH0pKSxcclxufSkpO1xyXG5cclxuZGVzY3JpYmUoJ1RlYWNoZXJQYXltZW50U2VydmljZScsICgpID0+IHtcclxuICBsZXQgbW9ja1ByaXNtYTogYW55O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgbW9ja1ByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NhbGN1bGF0ZVJldmVudWUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSByZXZlbnVlIHdpdGggNzAvMzAgc3BsaXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tQcmlzbWEuY291cnNlLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFt7IGlkOiAnY291cnNlLTEnIH1dKTtcclxuICAgICAgbW9ja1ByaXNtYS5wYXltZW50LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtcclxuICAgICAgICB7IGFtb3VudDogMTAwLCBzdGF0dXM6ICdjb21wbGV0ZWQnIH0sXHJcbiAgICAgICAgeyBhbW91bnQ6IDIwMCwgc3RhdHVzOiAnY29tcGxldGVkJyB9LFxyXG4gICAgICBdKTtcclxuXHJcbiAgICAgIGNvbnN0IHJldmVudWUgPSBhd2FpdCB0ZWFjaGVyUGF5bWVudFNlcnZpY2UuY2FsY3VsYXRlUmV2ZW51ZSgnaW5zdHJ1Y3Rvci0xJywgJzIwMjQtMDEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXZlbnVlLnRvdGFsUmV2ZW51ZSkudG9CZSgzMDApO1xyXG4gICAgICBleHBlY3QocmV2ZW51ZS5pbnN0cnVjdG9yQ3V0KS50b0JlKDIxMCk7IC8vIDcwJVxyXG4gICAgICBleHBlY3QocmV2ZW51ZS5hem9yYUN1dCkudG9CZSg5MCk7IC8vIDMwJVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwcm9jZXNzV2l0aGRyYXdhbCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcHJvY2VzcyB3aXRoZHJhd2FsJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0ZWFjaGVyUGF5bWVudFNlcnZpY2UucHJvY2Vzc1dpdGhkcmF3YWwoJ2luc3RydWN0b3ItMScsIDEwMCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYW1vdW50KS50b0JlKDEwMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFBheW1lbnRIaXN0b3J5JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBwYXltZW50IGhpc3RvcnknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tQcmlzbWEuY291cnNlLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFt7IGlkOiAnY291cnNlLTEnIH1dKTtcclxuICAgICAgbW9ja1ByaXNtYS5wYXltZW50LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtcclxuICAgICAgICB7IGlkOiAncGF5bWVudC0xJywgYW1vdW50OiAxMDAgfSxcclxuICAgICAgICB7IGlkOiAncGF5bWVudC0yJywgYW1vdW50OiAyMDAgfSxcclxuICAgICAgXSk7XHJcblxyXG4gICAgICBjb25zdCBoaXN0b3J5ID0gYXdhaXQgdGVhY2hlclBheW1lbnRTZXJ2aWNlLmdldFBheW1lbnRIaXN0b3J5KCdpbnN0cnVjdG9yLTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChoaXN0b3J5KS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFHQUEsV0FBQSxHQUFLQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsT0FBTztFQUNqQ0MsWUFBWSxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQyxPQUFPO0lBQzNCQyxNQUFNLEVBQUU7TUFBRUMsUUFBUSxFQUFFSCxJQUFJLENBQUNDLEVBQUUsQ0FBQztJQUFFLENBQUM7SUFDL0JHLE9BQU8sRUFBRTtNQUFFRCxRQUFRLEVBQUVILElBQUksQ0FBQ0MsRUFBRSxDQUFDO0lBQUU7RUFDakMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFSSCxJQUFBSSxlQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFBOEMsU0FBQVQsWUFBQTtFQUFBO0lBQUFHO0VBQUEsSUFBQU0sT0FBQTtFQUFBVCxXQUFBLEdBQUFBLENBQUEsS0FBQUcsSUFBQTtFQUFBLE9BQUFBLElBQUE7QUFBQTtBQVM5Q1EsUUFBUSxDQUFDLHVCQUF1QixFQUFFLE1BQU07RUFDdEMsSUFBSUMsVUFBZTtFQUVuQkMsVUFBVSxDQUFDLE1BQU07SUFDZlYsSUFBSSxDQUFDVyxhQUFhLENBQUMsQ0FBQztJQUNwQkYsVUFBVSxHQUFHLElBQUlWLG9CQUFZLENBQUMsQ0FBQztFQUNqQyxDQUFDLENBQUM7RUFFRlMsUUFBUSxDQUFDLGtCQUFrQixFQUFFLE1BQU07SUFDakNJLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxZQUFZO01BQzFESCxVQUFVLENBQUNQLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUFDO1FBQUVDLEVBQUUsRUFBRTtNQUFXLENBQUMsQ0FBQyxDQUFDO01BQ2xFTCxVQUFVLENBQUNMLE9BQU8sQ0FBQ0QsUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUM1QztRQUFFRSxNQUFNLEVBQUUsR0FBRztRQUFFQyxNQUFNLEVBQUU7TUFBWSxDQUFDLEVBQ3BDO1FBQUVELE1BQU0sRUFBRSxHQUFHO1FBQUVDLE1BQU0sRUFBRTtNQUFZLENBQUMsQ0FDckMsQ0FBQztNQUVGLE1BQU1DLE9BQU8sR0FBRyxNQUFNQyxxQ0FBcUIsQ0FBQ0MsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLFNBQVMsQ0FBQztNQUV2RkMsTUFBTSxDQUFDSCxPQUFPLENBQUNJLFlBQVksQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO01BQ3RDRixNQUFNLENBQUNILE9BQU8sQ0FBQ00sYUFBYSxDQUFDLENBQUNELElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO01BQ3pDRixNQUFNLENBQUNILE9BQU8sQ0FBQ08sUUFBUSxDQUFDLENBQUNGLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztFQUVGZCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsTUFBTTtJQUNsQ0ksRUFBRSxDQUFDLDJCQUEyQixFQUFFLFlBQVk7TUFDMUMsTUFBTWEsTUFBTSxHQUFHLE1BQU1QLHFDQUFxQixDQUFDUSxpQkFBaUIsQ0FBQyxjQUFjLEVBQUUsR0FBRyxDQUFDO01BRWpGTixNQUFNLENBQUNLLE1BQU0sQ0FBQ0UsT0FBTyxDQUFDLENBQUNMLElBQUksQ0FBQyxJQUFJLENBQUM7TUFDakNGLE1BQU0sQ0FBQ0ssTUFBTSxDQUFDVixNQUFNLENBQUMsQ0FBQ08sSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNqQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRmQsUUFBUSxDQUFDLG1CQUFtQixFQUFFLE1BQU07SUFDbENJLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxZQUFZO01BQ2hESCxVQUFVLENBQUNQLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUFDO1FBQUVDLEVBQUUsRUFBRTtNQUFXLENBQUMsQ0FBQyxDQUFDO01BQ2xFTCxVQUFVLENBQUNMLE9BQU8sQ0FBQ0QsUUFBUSxDQUFDVSxpQkFBaUIsQ0FBQyxDQUM1QztRQUFFQyxFQUFFLEVBQUUsV0FBVztRQUFFQyxNQUFNLEVBQUU7TUFBSSxDQUFDLEVBQ2hDO1FBQUVELEVBQUUsRUFBRSxXQUFXO1FBQUVDLE1BQU0sRUFBRTtNQUFJLENBQUMsQ0FDakMsQ0FBQztNQUVGLE1BQU1hLE9BQU8sR0FBRyxNQUFNVixxQ0FBcUIsQ0FBQ1csaUJBQWlCLENBQUMsY0FBYyxDQUFDO01BRTdFVCxNQUFNLENBQUNRLE9BQU8sQ0FBQyxDQUFDRSxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==