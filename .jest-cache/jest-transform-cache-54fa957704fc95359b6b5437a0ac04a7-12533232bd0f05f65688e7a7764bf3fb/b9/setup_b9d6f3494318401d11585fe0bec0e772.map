{"version":3,"names":["_env","require","_database","_redis","_testExecutionOptimizer","loadTestEnv","prisma","redis","useOptimizations","process","env","USE_TEST_OPTIMIZATIONS","beforeAll","setupTestDatabase","setupTestRedis","initializeTestOptimizer","console","log","timeout","parseInt","TEST_TIMEOUT","jest","setTimeout","global","error","afterAll","saveTestOptimizer","disconnectTestDatabase","disconnectTestRedis","beforeEach","setupOptimizedTest","afterEach","cleanupOptimizedTest","cleanupTestDatabase","cleanupTestRedis"],"sources":["setup.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport Redis from 'ioredis';\nimport { loadTestEnv } from './utils/env';\nimport { \n  setupTestDatabase, \n  cleanupTestDatabase, \n  disconnectTestDatabase,\n  getTestPrismaClient \n} from './utils/database';\nimport { \n  setupTestRedis, \n  cleanupTestRedis, \n  disconnectTestRedis,\n  getTestRedisClient \n} from './utils/redis';\nimport {\n  initializeTestOptimizer,\n  saveTestOptimizer,\n  setupOptimizedTest,\n  cleanupOptimizedTest,\n} from './utils/test-execution-optimizer';\n\n// Load test environment variables\nloadTestEnv();\n\nlet prisma: PrismaClient;\nlet redis: Redis;\nlet useOptimizations = process.env.USE_TEST_OPTIMIZATIONS !== 'false';\n\n// Global setup\nbeforeAll(async () => {\n  try {\n    // Database setup\n    prisma = await setupTestDatabase();\n    \n    // Redis setup\n    redis = await setupTestRedis();\n    \n    // Initialize test optimizer\n    if (useOptimizations) {\n      await initializeTestOptimizer();\n      console.log('Test optimizations enabled');\n    }\n    \n    // Global test timeout\n    const timeout = parseInt(process.env.TEST_TIMEOUT || '30000', 10);\n    jest.setTimeout(timeout);\n    \n    // Make available globally\n    (global as any).prisma = prisma;\n    (global as any).redis = redis;\n    \n    console.log('Test environment setup complete');\n  } catch (error) {\n    console.error('Failed to setup test environment:', error);\n    throw error;\n  }\n});\n\n// Global teardown\nafterAll(async () => {\n  try {\n    // Save test optimizer state\n    if (useOptimizations) {\n      await saveTestOptimizer();\n      console.log('Test optimization state saved');\n    }\n    \n    await disconnectTestDatabase();\n    await disconnectTestRedis();\n    console.log('Test environment teardown complete');\n  } catch (error) {\n    console.error('Error during test teardown:', error);\n  }\n});\n\n// Setup before each test\nbeforeEach(async () => {\n  try {\n    if (useOptimizations) {\n      // Use optimized setup (begin transaction)\n      await setupOptimizedTest();\n    }\n  } catch (error) {\n    console.error('Error during test setup:', error);\n    // Don't throw to avoid breaking test execution\n  }\n});\n\n// Clean up after each test\nafterEach(async () => {\n  try {\n    if (useOptimizations) {\n      // Use optimized cleanup (transaction rollback + pipeline operations)\n      await cleanupOptimizedTest();\n    } else {\n      // Use standard cleanup\n      await cleanupTestDatabase();\n      await cleanupTestRedis();\n    }\n  } catch (error) {\n    console.error('Error during test cleanup:', error);\n    // Don't throw to avoid breaking test execution\n  }\n});\n"],"mappings":";;AAEA,IAAAA,IAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAMA,IAAAE,MAAA,GAAAF,OAAA;AAMA,IAAAG,uBAAA,GAAAH,OAAA;AAOA;AACA,IAAAI,gBAAW,EAAC,CAAC;AAEb,IAAIC,MAAoB;AACxB,IAAIC,KAAY;AAChB,IAAIC,gBAAgB,GAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,KAAK,OAAO;;AAErE;AACAC,SAAS,CAAC,YAAY;EACpB,IAAI;IACF;IACAN,MAAM,GAAG,MAAM,IAAAO,2BAAiB,EAAC,CAAC;;IAElC;IACAN,KAAK,GAAG,MAAM,IAAAO,qBAAc,EAAC,CAAC;;IAE9B;IACA,IAAIN,gBAAgB,EAAE;MACpB,MAAM,IAAAO,+CAAuB,EAAC,CAAC;MAC/BC,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;IAC3C;;IAEA;IACA,MAAMC,OAAO,GAAGC,QAAQ,CAACV,OAAO,CAACC,GAAG,CAACU,YAAY,IAAI,OAAO,EAAE,EAAE,CAAC;IACjEC,IAAI,CAACC,UAAU,CAACJ,OAAO,CAAC;;IAExB;IACCK,MAAM,CAASjB,MAAM,GAAGA,MAAM;IAC9BiB,MAAM,CAAShB,KAAK,GAAGA,KAAK;IAE7BS,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC;EAChD,CAAC,CAAC,OAAOO,KAAK,EAAE;IACdR,OAAO,CAACQ,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;IACzD,MAAMA,KAAK;EACb;AACF,CAAC,CAAC;;AAEF;AACAC,QAAQ,CAAC,YAAY;EACnB,IAAI;IACF;IACA,IAAIjB,gBAAgB,EAAE;MACpB,MAAM,IAAAkB,yCAAiB,EAAC,CAAC;MACzBV,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;IAC9C;IAEA,MAAM,IAAAU,gCAAsB,EAAC,CAAC;IAC9B,MAAM,IAAAC,0BAAmB,EAAC,CAAC;IAC3BZ,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;EACnD,CAAC,CAAC,OAAOO,KAAK,EAAE;IACdR,OAAO,CAACQ,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;EACrD;AACF,CAAC,CAAC;;AAEF;AACAK,UAAU,CAAC,YAAY;EACrB,IAAI;IACF,IAAIrB,gBAAgB,EAAE;MACpB;MACA,MAAM,IAAAsB,0CAAkB,EAAC,CAAC;IAC5B;EACF,CAAC,CAAC,OAAON,KAAK,EAAE;IACdR,OAAO,CAACQ,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAChD;EACF;AACF,CAAC,CAAC;;AAEF;AACAO,SAAS,CAAC,YAAY;EACpB,IAAI;IACF,IAAIvB,gBAAgB,EAAE;MACpB;MACA,MAAM,IAAAwB,4CAAoB,EAAC,CAAC;IAC9B,CAAC,MAAM;MACL;MACA,MAAM,IAAAC,6BAAmB,EAAC,CAAC;MAC3B,MAAM,IAAAC,uBAAgB,EAAC,CAAC;IAC1B;EACF,CAAC,CAAC,OAAOV,KAAK,EAAE;IACdR,OAAO,CAACQ,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IAClD;EACF;AACF,CAAC,CAAC","ignoreList":[]}