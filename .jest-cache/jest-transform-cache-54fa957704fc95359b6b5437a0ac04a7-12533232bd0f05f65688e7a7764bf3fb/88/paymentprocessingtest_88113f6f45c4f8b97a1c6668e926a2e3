cd5f75c4627931f5b3f6f85088a12201
"use strict";

var _globals = require("@jest/globals");
var _supertest = _interopRequireDefault(require("supertest"));
var _stripe = require("../../../tests/mocks/stripe.mock");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const API_URL = process.env.PAY_SERVICE_URL || 'http://localhost:3010';
(0, _globals.describe)('Azora Pay - Payment Processing', () => {
  (0, _globals.beforeEach)(() => {
    _stripe.mockStripe.reset();
  });
  (0, _globals.afterEach)(() => {
    _stripe.mockStripe.reset();
  });
  (0, _globals.describe)('Payment Intent Creation', () => {
    (0, _globals.it)('should create payment intent', async () => {
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/intent').send({
        amount: 1000,
        currency: 'usd',
        userId: 'user-123'
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.clientSecret).toBeDefined();
      (0, _globals.expect)(res.body.id).toBeDefined();
    });
    (0, _globals.it)('should reject payment intent without amount', async () => {
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/intent').send({
        currency: 'usd',
        userId: 'user-123'
      });
      (0, _globals.expect)(res.status).toBe(400);
    });
    (0, _globals.it)('should record payment to blockchain', async () => {
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/intent').send({
        amount: 1000,
        currency: 'usd',
        userId: 'user-123'
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.blockchainRecordId).toBeDefined();
    });
    (0, _globals.it)('should contribute to CitadelFund', async () => {
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/intent').send({
        amount: 1000,
        currency: 'usd',
        userId: 'user-123'
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.citadelContribution).toBe(100);
    });
  });
  (0, _globals.describe)('Payment Processing', () => {
    (0, _globals.it)('should process payment successfully', async () => {
      const intentRes = await (0, _supertest.default)(API_URL).post('/api/payments/intent').send({
        amount: 1000,
        currency: 'usd',
        userId: 'user-123'
      });
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/process').send({
        paymentIntentId: intentRes.body.id
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.status).toBeDefined();
    });
    (0, _globals.it)('should handle payment failure', async () => {
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/process').send({
        paymentIntentId: 'invalid-intent-id'
      });
      (0, _globals.expect)(res.status).toBe(500);
    });
  });
  (0, _globals.describe)('Refund Handling', () => {
    (0, _globals.it)('should process refund', async () => {
      const intentRes = await (0, _supertest.default)(API_URL).post('/api/payments/intent').send({
        amount: 1000,
        currency: 'usd',
        userId: 'user-123'
      });
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/refund').send({
        paymentIntentId: intentRes.body.id,
        amount: 500
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.refundId).toBeDefined();
    });
    (0, _globals.it)('should reject refund for invalid payment', async () => {
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/refund').send({
        paymentIntentId: 'invalid-id',
        amount: 500
      });
      (0, _globals.expect)(res.status).toBe(404);
    });
  });
  (0, _globals.describe)('Payment History', () => {
    (0, _globals.it)('should retrieve payment history for user', async () => {
      const res = await (0, _supertest.default)(API_URL).get('/api/payments/history').query({
        userId: 'user-123'
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(Array.isArray(res.body.payments)).toBe(true);
    });
    (0, _globals.it)('should filter payment history by date', async () => {
      const res = await (0, _supertest.default)(API_URL).get('/api/payments/history').query({
        userId: 'user-123',
        startDate: '2024-01-01',
        endDate: '2024-12-31'
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(Array.isArray(res.body.payments)).toBe(true);
    });
    (0, _globals.it)('should filter payment history by status', async () => {
      const res = await (0, _supertest.default)(API_URL).get('/api/payments/history').query({
        userId: 'user-123',
        status: 'succeeded'
      });
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(Array.isArray(res.body.payments)).toBe(true);
    });
  });
  (0, _globals.describe)('Webhook Processing', () => {
    (0, _globals.it)('should process payment success webhook', async () => {
      const webhookEvent = {
        type: 'payment_intent.succeeded',
        data: {
          object: {
            id: 'pi_test_123',
            amount: 1000,
            currency: 'usd'
          }
        }
      };
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/webhook').set('stripe-signature', 'test-signature').send(webhookEvent);
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.received).toBe(true);
    });
    (0, _globals.it)('should process payment failure webhook', async () => {
      const webhookEvent = {
        type: 'payment_intent.payment_failed',
        data: {
          object: {
            id: 'pi_test_123',
            amount: 1000,
            currency: 'usd'
          }
        }
      };
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/webhook').set('stripe-signature', 'test-signature').send(webhookEvent);
      (0, _globals.expect)(res.status).toBe(200);
      (0, _globals.expect)(res.body.received).toBe(true);
    });
    (0, _globals.it)('should reject webhook with invalid signature', async () => {
      const webhookEvent = {
        type: 'payment_intent.succeeded',
        data: {
          object: {
            id: 'pi_test_123'
          }
        }
      };
      const res = await (0, _supertest.default)(API_URL).post('/api/payments/webhook').send(webhookEvent);
      (0, _globals.expect)(res.status).toBe(400);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2xvYmFscyIsInJlcXVpcmUiLCJfc3VwZXJ0ZXN0IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9zdHJpcGUiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJBUElfVVJMIiwicHJvY2VzcyIsImVudiIsIlBBWV9TRVJWSUNFX1VSTCIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsIm1vY2tTdHJpcGUiLCJyZXNldCIsImFmdGVyRWFjaCIsIml0IiwicmVzIiwicmVxdWVzdCIsInBvc3QiLCJzZW5kIiwiYW1vdW50IiwiY3VycmVuY3kiLCJ1c2VySWQiLCJleHBlY3QiLCJzdGF0dXMiLCJ0b0JlIiwiYm9keSIsImNsaWVudFNlY3JldCIsInRvQmVEZWZpbmVkIiwiaWQiLCJibG9ja2NoYWluUmVjb3JkSWQiLCJjaXRhZGVsQ29udHJpYnV0aW9uIiwiaW50ZW50UmVzIiwicGF5bWVudEludGVudElkIiwicmVmdW5kSWQiLCJnZXQiLCJxdWVyeSIsIkFycmF5IiwiaXNBcnJheSIsInBheW1lbnRzIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsIndlYmhvb2tFdmVudCIsInR5cGUiLCJkYXRhIiwib2JqZWN0Iiwic2V0IiwicmVjZWl2ZWQiXSwic291cmNlcyI6WyJwYXltZW50LXByb2Nlc3NpbmcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XHJcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XHJcbmltcG9ydCB7IG1vY2tTdHJpcGUgfSBmcm9tICcuLi8uLi8uLi90ZXN0cy9tb2Nrcy9zdHJpcGUubW9jayc7XHJcblxyXG5jb25zdCBBUElfVVJMID0gcHJvY2Vzcy5lbnYuUEFZX1NFUlZJQ0VfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMTAnO1xyXG5cclxuZGVzY3JpYmUoJ0F6b3JhIFBheSAtIFBheW1lbnQgUHJvY2Vzc2luZycsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIG1vY2tTdHJpcGUucmVzZXQoKTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIG1vY2tTdHJpcGUucmVzZXQoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1BheW1lbnQgSW50ZW50IENyZWF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF5bWVudCBpbnRlbnQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy9pbnRlbnQnKVxyXG4gICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgIGFtb3VudDogMTAwMCxcclxuICAgICAgICAgIGN1cnJlbmN5OiAndXNkJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXMuYm9keS5jbGllbnRTZWNyZXQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXMuYm9keS5pZCkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHBheW1lbnQgaW50ZW50IHdpdGhvdXQgYW1vdW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvcGF5bWVudHMvaW50ZW50JylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBjdXJyZW5jeTogJ3VzZCcsXHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSg0MDApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZWNvcmQgcGF5bWVudCB0byBibG9ja2NoYWluJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvcGF5bWVudHMvaW50ZW50JylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBhbW91bnQ6IDEwMDAsXHJcbiAgICAgICAgICBjdXJyZW5jeTogJ3VzZCcsXHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzLmJvZHkuYmxvY2tjaGFpblJlY29yZElkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjb250cmlidXRlIHRvIENpdGFkZWxGdW5kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvcGF5bWVudHMvaW50ZW50JylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBhbW91bnQ6IDEwMDAsXHJcbiAgICAgICAgICBjdXJyZW5jeTogJ3VzZCcsXHJcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzLmJvZHkuY2l0YWRlbENvbnRyaWJ1dGlvbikudG9CZSgxMDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQYXltZW50IFByb2Nlc3NpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgcGF5bWVudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludGVudFJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy9pbnRlbnQnKVxyXG4gICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgIGFtb3VudDogMTAwMCxcclxuICAgICAgICAgIGN1cnJlbmN5OiAndXNkJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy9wcm9jZXNzJylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBwYXltZW50SW50ZW50SWQ6IGludGVudFJlcy5ib2R5LmlkLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlcy5ib2R5LnN0YXR1cykudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBheW1lbnQgZmFpbHVyZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChBUElfVVJMKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL3BheW1lbnRzL3Byb2Nlc3MnKVxyXG4gICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgIHBheW1lbnRJbnRlbnRJZDogJ2ludmFsaWQtaW50ZW50LWlkJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDUwMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1JlZnVuZCBIYW5kbGluZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcHJvY2VzcyByZWZ1bmQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludGVudFJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy9pbnRlbnQnKVxyXG4gICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgIGFtb3VudDogMTAwMCxcclxuICAgICAgICAgIGN1cnJlbmN5OiAndXNkJyxcclxuICAgICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy9yZWZ1bmQnKVxyXG4gICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgIHBheW1lbnRJbnRlbnRJZDogaW50ZW50UmVzLmJvZHkuaWQsXHJcbiAgICAgICAgICBhbW91bnQ6IDUwMCxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXMuYm9keS5yZWZ1bmRJZCkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlZnVuZCBmb3IgaW52YWxpZCBwYXltZW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvcGF5bWVudHMvcmVmdW5kJylcclxuICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICBwYXltZW50SW50ZW50SWQ6ICdpbnZhbGlkLWlkJyxcclxuICAgICAgICAgIGFtb3VudDogNTAwLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoNDA0KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUGF5bWVudCBIaXN0b3J5JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBwYXltZW50IGhpc3RvcnkgZm9yIHVzZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAuZ2V0KCcvYXBpL3BheW1lbnRzL2hpc3RvcnknKVxyXG4gICAgICAgIC5xdWVyeSh7IHVzZXJJZDogJ3VzZXItMTIzJyB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlcy5ib2R5LnBheW1lbnRzKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZmlsdGVyIHBheW1lbnQgaGlzdG9yeSBieSBkYXRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLmdldCgnL2FwaS9wYXltZW50cy9oaXN0b3J5JylcclxuICAgICAgICAucXVlcnkoe1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxyXG4gICAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXHJcbiAgICAgICAgICBlbmREYXRlOiAnMjAyNC0xMi0zMScsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXMuYm9keS5wYXltZW50cykpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGZpbHRlciBwYXltZW50IGhpc3RvcnkgYnkgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLmdldCgnL2FwaS9wYXltZW50cy9oaXN0b3J5JylcclxuICAgICAgICAucXVlcnkoe1xyXG4gICAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxyXG4gICAgICAgICAgc3RhdHVzOiAnc3VjY2VlZGVkJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlcy5ib2R5LnBheW1lbnRzKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnV2ViaG9vayBQcm9jZXNzaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBwcm9jZXNzIHBheW1lbnQgc3VjY2VzcyB3ZWJob29rJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB3ZWJob29rRXZlbnQgPSB7XHJcbiAgICAgICAgdHlwZTogJ3BheW1lbnRfaW50ZW50LnN1Y2NlZWRlZCcsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgb2JqZWN0OiB7XHJcbiAgICAgICAgICAgIGlkOiAncGlfdGVzdF8xMjMnLFxyXG4gICAgICAgICAgICBhbW91bnQ6IDEwMDAsXHJcbiAgICAgICAgICAgIGN1cnJlbmN5OiAndXNkJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoQVBJX1VSTClcclxuICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy93ZWJob29rJylcclxuICAgICAgICAuc2V0KCdzdHJpcGUtc2lnbmF0dXJlJywgJ3Rlc3Qtc2lnbmF0dXJlJylcclxuICAgICAgICAuc2VuZCh3ZWJob29rRXZlbnQpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlcy5ib2R5LnJlY2VpdmVkKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBwcm9jZXNzIHBheW1lbnQgZmFpbHVyZSB3ZWJob29rJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB3ZWJob29rRXZlbnQgPSB7XHJcbiAgICAgICAgdHlwZTogJ3BheW1lbnRfaW50ZW50LnBheW1lbnRfZmFpbGVkJyxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBvYmplY3Q6IHtcclxuICAgICAgICAgICAgaWQ6ICdwaV90ZXN0XzEyMycsXHJcbiAgICAgICAgICAgIGFtb3VudDogMTAwMCxcclxuICAgICAgICAgICAgY3VycmVuY3k6ICd1c2QnLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChBUElfVVJMKVxyXG4gICAgICAgIC5wb3N0KCcvYXBpL3BheW1lbnRzL3dlYmhvb2snKVxyXG4gICAgICAgIC5zZXQoJ3N0cmlwZS1zaWduYXR1cmUnLCAndGVzdC1zaWduYXR1cmUnKVxyXG4gICAgICAgIC5zZW5kKHdlYmhvb2tFdmVudCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzLmJvZHkucmVjZWl2ZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlamVjdCB3ZWJob29rIHdpdGggaW52YWxpZCBzaWduYXR1cmUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHdlYmhvb2tFdmVudCA9IHtcclxuICAgICAgICB0eXBlOiAncGF5bWVudF9pbnRlbnQuc3VjY2VlZGVkJyxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBvYmplY3Q6IHtcclxuICAgICAgICAgICAgaWQ6ICdwaV90ZXN0XzEyMycsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KEFQSV9VUkwpXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvcGF5bWVudHMvd2ViaG9vaycpXHJcbiAgICAgICAgLnNlbmQod2ViaG9va0V2ZW50KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDQwMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxRQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxVQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxPQUFBLEdBQUFILE9BQUE7QUFBOEQsU0FBQUUsdUJBQUFFLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFFOUQsTUFBTUcsT0FBTyxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsZUFBZSxJQUFJLHVCQUF1QjtBQUV0RSxJQUFBQyxpQkFBUSxFQUFDLGdDQUFnQyxFQUFFLE1BQU07RUFDL0MsSUFBQUMsbUJBQVUsRUFBQyxNQUFNO0lBQ2ZDLGtCQUFVLENBQUNDLEtBQUssQ0FBQyxDQUFDO0VBQ3BCLENBQUMsQ0FBQztFQUVGLElBQUFDLGtCQUFTLEVBQUMsTUFBTTtJQUNkRixrQkFBVSxDQUFDQyxLQUFLLENBQUMsQ0FBQztFQUNwQixDQUFDLENBQUM7RUFFRixJQUFBSCxpQkFBUSxFQUFDLHlCQUF5QixFQUFFLE1BQU07SUFDeEMsSUFBQUssV0FBRSxFQUFDLDhCQUE4QixFQUFFLFlBQVk7TUFDN0MsTUFBTUMsR0FBRyxHQUFHLE1BQU0sSUFBQUMsa0JBQU8sRUFBQ1gsT0FBTyxDQUFDLENBQy9CWSxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FDNUJDLElBQUksQ0FBQztRQUNKQyxNQUFNLEVBQUUsSUFBSTtRQUNaQyxRQUFRLEVBQUUsS0FBSztRQUNmQyxNQUFNLEVBQUU7TUFDVixDQUFDLENBQUM7TUFFSixJQUFBQyxlQUFNLEVBQUNQLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFD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QUUsZ0JBQWdCLENBQUMsQ0FDekMzQixJQUFJLENBQUN1QixZQUFZLENBQUM7TUFFckIsSUFBQW5CLGVBQU0sRUFBQ1AsR0FBRyxDQUFDUSxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQztNQUM1QixJQUFBRixlQUFNLEVBQUNQLEdBQUcsQ0FBQ1UsSUFBSSxDQUFDcUIsUUFBUSxDQUFDLENBQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ3RDLENBQUMsQ0FBQztJQUVGLElBQUFWLFdBQUUsRUFBQyx3Q0FBd0MsRUFBRSxZQUFZO01BQ3ZELE1BQU0yQixZQUFZLEdBQUc7UUFDbkJDLElBQUksRUFBRSwrQkFBK0I7UUFDckNDLElBQUksRUFBRTtVQUNKQyxNQUFNLEVBQUU7WUFDTmhCLEVBQUUsRUFBRSxhQUFhO1lBQ2pCVCxNQUFNLEVBQUUsSUFBSTtZQUNaQyxRQUFRLEVBQUU7VUFDWjtRQUNGO01BQ0YsQ0FBQztNQUVELE1BQU1MLEdBQUcsR0FBRyxNQUFNLElBQUFDLGtCQUFPLEVBQUNYLE9BQU8sQ0FBQyxDQUMvQlksSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQzdCNEIsR0FBRyxDQUFDLGtCQUFrQixFQUFFLGdCQUFnQixDQUFDLENBQ3pDM0IsSUFBSSxDQUFDdUIsWUFBWSxDQUFDO01BRXJCLElBQUFuQixlQUFNLEVBQUNQLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDNUIsSUFBQUYsZUFBTSxFQUFDUCxHQUFHLENBQUNVLElBQUksQ0FBQ3FCLFFBQVEsQ0FBQyxDQUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN0QyxDQUFDLENBQUM7SUFFRixJQUFBVixXQUFFLEVBQUMsOENBQThDLEVBQUUsWUFBWTtNQUM3RCxNQUFNMkIsWUFBWSxHQUFHO1FBQ25CQyxJQUFJLEVBQUUsMEJBQTBCO1FBQ2hDQyxJQUFJLEVBQUU7VUFDSkMsTUFBTSxFQUFFO1lBQ05oQixFQUFFLEVBQUU7VUFDTjtRQUNGO01BQ0YsQ0FBQztNQUVELE1BQU1iLEdBQUcsR0FBRyxNQUFNLElBQUFDLGtCQUFPLEVBQUNYLE9BQU8sQ0FBQyxDQUMvQlksSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQzdCQyxJQUFJLENBQUN1QixZQUFZLENBQUM7TUFFckIsSUFBQW5CLGVBQU0sRUFBQ1AsR0FBRyxDQUFDUSxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUM5QixDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=