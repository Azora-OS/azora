4698b0eb6bab0685e1e19260ca6dd278
"use strict";

const DistributedTracing = require('../distributed-tracing');
describe('Distributed Tracing', () => {
  let tracing;
  beforeEach(() => {
    tracing = new DistributedTracing();
  });
  describe('Trace Management', () => {
    it('should start a new trace', () => {
      const traceId = tracing.startTrace('test-operation');
      expect(traceId).toBeDefined();
      expect(typeof traceId).toBe('string');
    });
    it('should create trace with operation name', () => {
      const traceId = tracing.startTrace('user-registration');
      const trace = tracing.getTrace(traceId);
      expect(trace).toBeDefined();
      expect(trace.operationName).toBe('user-registration');
    });
    it('should support parent trace ID', () => {
      const parentTraceId = tracing.startTrace('parent-operation');
      const childTraceId = tracing.startTrace('child-operation', parentTraceId);
      const childTrace = tracing.getTrace(childTraceId);
      expect(childTrace.parentTraceId).toBe(parentTraceId);
    });
    it('should track trace start time', () => {
      const traceId = tracing.startTrace('test-operation');
      const trace = tracing.getTrace(traceId);
      expect(trace.startTime).toBeDefined();
      expect(typeof trace.startTime).toBe('number');
    });
    it('should initialize trace with active status', () => {
      const traceId = tracing.startTrace('test-operation');
      const trace = tracing.getTrace(traceId);
      expect(trace.status).toBe('active');
    });
  });
  describe('Span Management', () => {
    it('should start a span within a trace', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'database-query');
      expect(spanId).toBeDefined();
      expect(typeof spanId).toBe('string');
    });
    it('should associate span with trace', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'api-call');
      const trace = tracing.getTrace(traceId);
      expect(trace.spans).toContain(spanId);
    });
    it('should support span tags', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'http-request', {
        'http.method': 'GET',
        'http.url': '/api/users'
      });
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.tags['http.method']).toBe('GET');
      expect(span.tags['http.url']).toBe('/api/users');
    });
    it('should finish span and calculate duration', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'test-span');
      tracing.finishSpan(spanId);
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.status).toBe('finished');
      expect(span.duration).toBeDefined();
      expect(span.duration).toBeGreaterThanOrEqual(0);
    });
    it('should add tags when finishing span', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'test-span');
      tracing.finishSpan(spanId, {
        'result': 'success'
      });
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.tags.result).toBe('success');
    });
  });
  describe('Span Logging', () => {
    it('should add logs to span', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'test-span');
      tracing.addLog(spanId, 'Processing request');
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.logs).toHaveLength(1);
      expect(span.logs[0].message).toBe('Processing request');
    });
    it('should support log levels', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'test-span');
      tracing.addLog(spanId, 'Error occurred', 'error');
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.logs[0].level).toBe('error');
    });
    it('should default to info level', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'test-span');
      tracing.addLog(spanId, 'Info message');
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.logs[0].level).toBe('info');
    });
    it('should include timestamp in logs', () => {
      const traceId = tracing.startTrace('test-operation');
      const spanId = tracing.startSpan(traceId, 'test-span');
      tracing.addLog(spanId, 'Test log');
      const trace = tracing.getTrace(traceId);
      const span = trace.spans.find(s => s.spanId === spanId);
      expect(span.logs[0].timestamp).toBeDefined();
    });
  });
  describe('Middleware Integration', () => {
    it('should create middleware function', () => {
      const middleware = tracing.middleware();
      expect(typeof middleware).toBe('function');
      expect(middleware.length).toBe(3); // req, res, next
    });
    it('should add trace ID to request', done => {
      const middleware = tracing.middleware();
      const req = {
        headers: {},
        method: 'GET',
        path: '/test',
        url: '/test'
      };
      const res = {
        setHeader: jest.fn(),
        on: jest.fn()
      };
      const next = () => {
        expect(req.traceId).toBeDefined();
        expect(req.spanId).toBeDefined();
        done();
      };
      middleware(req, res, next);
    });
    it('should set trace ID header in response', done => {
      const middleware = tracing.middleware();
      const req = {
        headers: {},
        method: 'GET',
        path: '/test',
        url: '/test'
      };
      const res = {
        setHeader: jest.fn(),
        on: jest.fn()
      };
      const next = () => {
        expect(res.setHeader).toHaveBeenCalledWith('x-trace-id', expect.any(String));
        done();
      };
      middleware(req, res, next);
    });
    it('should use existing trace ID from header', done => {
      const existingTraceId = 'existing-trace-123';
      const middleware = tracing.middleware();
      const req = {
        headers: {
          'x-trace-id': existingTraceId
        },
        method: 'GET',
        path: '/test',
        url: '/test'
      };
      const res = {
        setHeader: jest.fn(),
        on: jest.fn()
      };
      const next = () => {
        expect(req.traceId).toBe(existingTraceId);
        done();
      };
      middleware(req, res, next);
    });
    it('should create span with HTTP metadata', done => {
      const middleware = tracing.middleware();
      const req = {
        headers: {
          'user-agent': 'test-agent'
        },
        method: 'POST',
        path: '/api/users',
        url: '/api/users'
      };
      const res = {
        setHeader: jest.fn(),
        on: jest.fn()
      };
      const next = () => {
        const trace = tracing.getTrace(req.traceId);
        const span = trace.spans.find(s => s.spanId === req.spanId);
        expect(span.tags['http.method']).toBe('POST');
        expect(span.tags['http.url']).toBe('/api/users');
        done();
      };
      middleware(req, res, next);
    });
  });
  describe('Trace Retrieval', () => {
    it('should retrieve trace by ID', () => {
      const traceId = tracing.startTrace('test-operation');
      const trace = tracing.getTrace(traceId);
      expect(trace).toBeDefined();
      expect(trace.traceId).toBe(traceId);
    });
    it('should return null for non-existent trace', () => {
      const trace = tracing.getTrace('non-existent-id');
      expect(trace).toBeNull();
    });
    it('should include all spans in trace', () => {
      const traceId = tracing.startTrace('test-operation');
      tracing.startSpan(traceId, 'span-1');
      tracing.startSpan(traceId, 'span-2');
      const trace = tracing.getTrace(traceId);
      expect(trace.spans).toHaveLength(2);
    });
  });
  describe('Multiple Traces', () => {
    it('should handle multiple concurrent traces', () => {
      const trace1 = tracing.startTrace('operation-1');
      const trace2 = tracing.startTrace('operation-2');
      expect(trace1).not.toBe(trace2);
      expect(tracing.getTrace(trace1)).toBeDefined();
      expect(tracing.getTrace(trace2)).toBeDefined();
    });
    it('should keep traces isolated', () => {
      const trace1 = tracing.startTrace('operation-1');
      const trace2 = tracing.startTrace('operation-2');
      tracing.startSpan(trace1, 'span-1');
      tracing.startSpan(trace2, 'span-2');
      const t1 = tracing.getTrace(trace1);
      const t2 = tracing.getTrace(trace2);
      expect(t1.spans).toHaveLength(1);
      expect(t2.spans).toHaveLength(1);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaXN0cmlidXRlZFRyYWNpbmciLCJyZXF1aXJlIiwiZGVzY3JpYmUiLCJ0cmFjaW5nIiwiYmVmb3JlRWFjaCIsIml0IiwidHJhY2VJZCIsInN0YXJ0VHJhY2UiLCJleHBlY3QiLCJ0b0JlRGVmaW5lZCIsInRvQmUiLCJ0cmFjZSIsImdldFRyYWNlIiwib3BlcmF0aW9uTmFtZSIsInBhcmVudFRyYWNlSWQiLCJjaGlsZFRyYWNlSWQiLCJjaGlsZFRyYWNlIiwic3RhcnRUaW1lIiwic3RhdHVzIiwic3BhbklkIiwic3RhcnRTcGFuIiwic3BhbnMiLCJ0b0NvbnRhaW4iLCJzcGFuIiwiZmluZCIsInMiLCJ0YWdzIiwiZmluaXNoU3BhbiIsImR1cmF0aW9uIiwidG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCIsInJlc3VsdCIsImFkZExvZyIsImxvZ3MiLCJ0b0hhdmVMZW5ndGgiLCJtZXNzYWdlIiwibGV2ZWwiLCJ0aW1lc3RhbXAiLCJtaWRkbGV3YXJlIiwibGVuZ3RoIiwiZG9uZSIsInJlcSIsImhlYWRlcnMiLCJtZXRob2QiLCJwYXRoIiwidXJsIiwicmVzIiwic2V0SGVhZGVyIiwiamVzdCIsImZuIiwib24iLCJuZXh0IiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJhbnkiLCJTdHJpbmciLCJleGlzdGluZ1RyYWNlSWQiLCJ0b0JlTnVsbCIsInRyYWNlMSIsInRyYWNlMiIsIm5vdCIsInQxIiwidDIiXSwic291cmNlcyI6WyJkaXN0cmlidXRlZC10cmFjaW5nLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgRGlzdHJpYnV0ZWRUcmFjaW5nID0gcmVxdWlyZSgnLi4vZGlzdHJpYnV0ZWQtdHJhY2luZycpO1xyXG5cclxuZGVzY3JpYmUoJ0Rpc3RyaWJ1dGVkIFRyYWNpbmcnLCAoKSA9PiB7XHJcbiAgbGV0IHRyYWNpbmc7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgdHJhY2luZyA9IG5ldyBEaXN0cmlidXRlZFRyYWNpbmcoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1RyYWNlIE1hbmFnZW1lbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGEgbmV3IHRyYWNlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFjZUlkID0gdHJhY2luZy5zdGFydFRyYWNlKCd0ZXN0LW9wZXJhdGlvbicpO1xyXG5cclxuICAgICAgZXhwZWN0KHRyYWNlSWQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgdHJhY2VJZCkudG9CZSgnc3RyaW5nJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSB0cmFjZSB3aXRoIG9wZXJhdGlvbiBuYW1lJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFjZUlkID0gdHJhY2luZy5zdGFydFRyYWNlKCd1c2VyLXJlZ2lzdHJhdGlvbicpO1xyXG4gICAgICBjb25zdCB0cmFjZSA9IHRyYWNpbmcuZ2V0VHJhY2UodHJhY2VJZCk7XHJcblxyXG4gICAgICBleHBlY3QodHJhY2UpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0cmFjZS5vcGVyYXRpb25OYW1lKS50b0JlKCd1c2VyLXJlZ2lzdHJhdGlvbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBzdXBwb3J0IHBhcmVudCB0cmFjZSBJRCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcGFyZW50VHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgncGFyZW50LW9wZXJhdGlvbicpO1xyXG4gICAgICBjb25zdCBjaGlsZFRyYWNlSWQgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ2NoaWxkLW9wZXJhdGlvbicsIHBhcmVudFRyYWNlSWQpO1xyXG5cclxuICAgICAgY29uc3QgY2hpbGRUcmFjZSA9IHRyYWNpbmcuZ2V0VHJhY2UoY2hpbGRUcmFjZUlkKTtcclxuICAgICAgZXhwZWN0KGNoaWxkVHJhY2UucGFyZW50VHJhY2VJZCkudG9CZShwYXJlbnRUcmFjZUlkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdHJhY2sgdHJhY2Ugc3RhcnQgdGltZScsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3QgdHJhY2UgPSB0cmFjaW5nLmdldFRyYWNlKHRyYWNlSWQpO1xyXG5cclxuICAgICAgZXhwZWN0KHRyYWNlLnN0YXJ0VGltZSkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiB0cmFjZS5zdGFydFRpbWUpLnRvQmUoJ251bWJlcicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHRyYWNlIHdpdGggYWN0aXZlIHN0YXR1cycsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3QgdHJhY2UgPSB0cmFjaW5nLmdldFRyYWNlKHRyYWNlSWQpO1xyXG5cclxuICAgICAgZXhwZWN0KHRyYWNlLnN0YXR1cykudG9CZSgnYWN0aXZlJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1NwYW4gTWFuYWdlbWVudCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgc3RhcnQgYSBzcGFuIHdpdGhpbiBhIHRyYWNlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFjZUlkID0gdHJhY2luZy5zdGFydFRyYWNlKCd0ZXN0LW9wZXJhdGlvbicpO1xyXG4gICAgICBjb25zdCBzcGFuSWQgPSB0cmFjaW5nLnN0YXJ0U3Bhbih0cmFjZUlkLCAnZGF0YWJhc2UtcXVlcnknKTtcclxuXHJcbiAgICAgIGV4cGVjdChzcGFuSWQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2Ygc3BhbklkKS50b0JlKCdzdHJpbmcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgYXNzb2NpYXRlIHNwYW4gd2l0aCB0cmFjZScsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3Qgc3BhbklkID0gdHJhY2luZy5zdGFydFNwYW4odHJhY2VJZCwgJ2FwaS1jYWxsJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFjZSA9IHRyYWNpbmcuZ2V0VHJhY2UodHJhY2VJZCk7XHJcbiAgICAgIGV4cGVjdCh0cmFjZS5zcGFucykudG9Db250YWluKHNwYW5JZCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgc3BhbiB0YWdzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFjZUlkID0gdHJhY2luZy5zdGFydFRyYWNlKCd0ZXN0LW9wZXJhdGlvbicpO1xyXG4gICAgICBjb25zdCBzcGFuSWQgPSB0cmFjaW5nLnN0YXJ0U3Bhbih0cmFjZUlkLCAnaHR0cC1yZXF1ZXN0Jywge1xyXG4gICAgICAgICdodHRwLm1ldGhvZCc6ICdHRVQnLFxyXG4gICAgICAgICdodHRwLnVybCc6ICcvYXBpL3VzZXJzJ1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYWNlID0gdHJhY2luZy5nZXRUcmFjZSh0cmFjZUlkKTtcclxuICAgICAgY29uc3Qgc3BhbiA9IHRyYWNlLnNwYW5zLmZpbmQocyA9PiBzLnNwYW5JZCA9PT0gc3BhbklkKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChzcGFuLnRhZ3NbJ2h0dHAubWV0aG9kJ10pLnRvQmUoJ0dFVCcpO1xyXG4gICAgICBleHBlY3Qoc3Bhbi50YWdzWydodHRwLnVybCddKS50b0JlKCcvYXBpL3VzZXJzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGZpbmlzaCBzcGFuIGFuZCBjYWxjdWxhdGUgZHVyYXRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRyYWNlSWQgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ3Rlc3Qtb3BlcmF0aW9uJyk7XHJcbiAgICAgIGNvbnN0IHNwYW5JZCA9IHRyYWNpbmcuc3RhcnRTcGFuKHRyYWNlSWQsICd0ZXN0LXNwYW4nKTtcclxuXHJcbiAgICAgIHRyYWNpbmcuZmluaXNoU3BhbihzcGFuSWQpO1xyXG5cclxuICAgICAgY29uc3QgdHJhY2UgPSB0cmFjaW5nLmdldFRyYWNlKHRyYWNlSWQpO1xyXG4gICAgICBjb25zdCBzcGFuID0gdHJhY2Uuc3BhbnMuZmluZChzID0+IHMuc3BhbklkID09PSBzcGFuSWQpO1xyXG5cclxuICAgICAgZXhwZWN0KHNwYW4uc3RhdHVzKS50b0JlKCdmaW5pc2hlZCcpO1xyXG4gICAgICBleHBlY3Qoc3Bhbi5kdXJhdGlvbikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHNwYW4uZHVyYXRpb24pLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGFkZCB0YWdzIHdoZW4gZmluaXNoaW5nIHNwYW4nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRyYWNlSWQgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ3Rlc3Qtb3BlcmF0aW9uJyk7XHJcbiAgICAgIGNvbnN0IHNwYW5JZCA9IHRyYWNpbmcuc3RhcnRTcGFuKHRyYWNlSWQsICd0ZXN0LXNwYW4nKTtcclxuXHJcbiAgICAgIHRyYWNpbmcuZmluaXNoU3BhbihzcGFuSWQsIHsgJ3Jlc3VsdCc6ICdzdWNjZXNzJyB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYWNlID0gdHJhY2luZy5nZXRUcmFjZSh0cmFjZUlkKTtcclxuICAgICAgY29uc3Qgc3BhbiA9IHRyYWNlLnNwYW5zLmZpbmQocyA9PiBzLnNwYW5JZCA9PT0gc3BhbklkKTtcclxuXHJcbiAgICAgIGV4cGVjdChzcGFuLnRhZ3MucmVzdWx0KS50b0JlKCdzdWNjZXNzJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1NwYW4gTG9nZ2luZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgYWRkIGxvZ3MgdG8gc3BhbicsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3Qgc3BhbklkID0gdHJhY2luZy5zdGFydFNwYW4odHJhY2VJZCwgJ3Rlc3Qtc3BhbicpO1xyXG5cclxuICAgICAgdHJhY2luZy5hZGRMb2coc3BhbklkLCAnUHJvY2Vzc2luZyByZXF1ZXN0Jyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFjZSA9IHRyYWNpbmcuZ2V0VHJhY2UodHJhY2VJZCk7XHJcbiAgICAgIGNvbnN0IHNwYW4gPSB0cmFjZS5zcGFucy5maW5kKHMgPT4gcy5zcGFuSWQgPT09IHNwYW5JZCk7XHJcblxyXG4gICAgICBleHBlY3Qoc3Bhbi5sb2dzKS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGV4cGVjdChzcGFuLmxvZ3NbMF0ubWVzc2FnZSkudG9CZSgnUHJvY2Vzc2luZyByZXF1ZXN0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgbG9nIGxldmVscycsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3Qgc3BhbklkID0gdHJhY2luZy5zdGFydFNwYW4odHJhY2VJZCwgJ3Rlc3Qtc3BhbicpO1xyXG5cclxuICAgICAgdHJhY2luZy5hZGRMb2coc3BhbklkLCAnRXJyb3Igb2NjdXJyZWQnLCAnZXJyb3InKTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYWNlID0gdHJhY2luZy5nZXRUcmFjZSh0cmFjZUlkKTtcclxuICAgICAgY29uc3Qgc3BhbiA9IHRyYWNlLnNwYW5zLmZpbmQocyA9PiBzLnNwYW5JZCA9PT0gc3BhbklkKTtcclxuXHJcbiAgICAgIGV4cGVjdChzcGFuLmxvZ3NbMF0ubGV2ZWwpLnRvQmUoJ2Vycm9yJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRlZmF1bHQgdG8gaW5mbyBsZXZlbCcsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3Qgc3BhbklkID0gdHJhY2luZy5zdGFydFNwYW4odHJhY2VJZCwgJ3Rlc3Qtc3BhbicpO1xyXG5cclxuICAgICAgdHJhY2luZy5hZGRMb2coc3BhbklkLCAnSW5mbyBtZXNzYWdlJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFjZSA9IHRyYWNpbmcuZ2V0VHJhY2UodHJhY2VJZCk7XHJcbiAgICAgIGNvbnN0IHNwYW4gPSB0cmFjZS5zcGFucy5maW5kKHMgPT4gcy5zcGFuSWQgPT09IHNwYW5JZCk7XHJcblxyXG4gICAgICBleHBlY3Qoc3Bhbi5sb2dzWzBdLmxldmVsKS50b0JlKCdpbmZvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgdGltZXN0YW1wIGluIGxvZ3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRyYWNlSWQgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ3Rlc3Qtb3BlcmF0aW9uJyk7XHJcbiAgICAgIGNvbnN0IHNwYW5JZCA9IHRyYWNpbmcuc3RhcnRTcGFuKHRyYWNlSWQsICd0ZXN0LXNwYW4nKTtcclxuXHJcbiAgICAgIHRyYWNpbmcuYWRkTG9nKHNwYW5JZCwgJ1Rlc3QgbG9nJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFjZSA9IHRyYWNpbmcuZ2V0VHJhY2UodHJhY2VJZCk7XHJcbiAgICAgIGNvbnN0IHNwYW4gPSB0cmFjZS5zcGFucy5maW5kKHMgPT4gcy5zcGFuSWQgPT09IHNwYW5JZCk7XHJcblxyXG4gICAgICBleHBlY3Qoc3Bhbi5sb2dzWzBdLnRpbWVzdGFtcCkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTWlkZGxld2FyZSBJbnRlZ3JhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG1pZGRsZXdhcmUgZnVuY3Rpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB0cmFjaW5nLm1pZGRsZXdhcmUoKTtcclxuXHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgbWlkZGxld2FyZSkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgZXhwZWN0KG1pZGRsZXdhcmUubGVuZ3RoKS50b0JlKDMpOyAvLyByZXEsIHJlcywgbmV4dFxyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBhZGQgdHJhY2UgSUQgdG8gcmVxdWVzdCcsIChkb25lKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB0cmFjaW5nLm1pZGRsZXdhcmUoKTtcclxuICAgICAgY29uc3QgcmVxID0geyBoZWFkZXJzOiB7fSwgbWV0aG9kOiAnR0VUJywgcGF0aDogJy90ZXN0JywgdXJsOiAnL3Rlc3QnIH07XHJcbiAgICAgIGNvbnN0IHJlcyA9IHtcclxuICAgICAgICBzZXRIZWFkZXI6IGplc3QuZm4oKSxcclxuICAgICAgICBvbjogamVzdC5mbigpXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IG5leHQgPSAoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHJlcS50cmFjZUlkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgIGV4cGVjdChyZXEuc3BhbklkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgIGRvbmUoKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBzZXQgdHJhY2UgSUQgaGVhZGVyIGluIHJlc3BvbnNlJywgKGRvbmUpID0+IHtcclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHRyYWNpbmcubWlkZGxld2FyZSgpO1xyXG4gICAgICBjb25zdCByZXEgPSB7IGhlYWRlcnM6IHt9LCBtZXRob2Q6ICdHRVQnLCBwYXRoOiAnL3Rlc3QnLCB1cmw6ICcvdGVzdCcgfTtcclxuICAgICAgY29uc3QgcmVzID0ge1xyXG4gICAgICAgIHNldEhlYWRlcjogamVzdC5mbigpLFxyXG4gICAgICAgIG9uOiBqZXN0LmZuKClcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgbmV4dCA9ICgpID0+IHtcclxuICAgICAgICBleHBlY3QocmVzLnNldEhlYWRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3gtdHJhY2UtaWQnLCBleHBlY3QuYW55KFN0cmluZykpO1xyXG4gICAgICAgIGRvbmUoKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB1c2UgZXhpc3RpbmcgdHJhY2UgSUQgZnJvbSBoZWFkZXInLCAoZG9uZSkgPT4ge1xyXG4gICAgICBjb25zdCBleGlzdGluZ1RyYWNlSWQgPSAnZXhpc3RpbmctdHJhY2UtMTIzJztcclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHRyYWNpbmcubWlkZGxld2FyZSgpO1xyXG4gICAgICBjb25zdCByZXEgPSB7XHJcbiAgICAgICAgaGVhZGVyczogeyAneC10cmFjZS1pZCc6IGV4aXN0aW5nVHJhY2VJZCB9LFxyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgcGF0aDogJy90ZXN0JyxcclxuICAgICAgICB1cmw6ICcvdGVzdCdcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVzID0ge1xyXG4gICAgICAgIHNldEhlYWRlcjogamVzdC5mbigpLFxyXG4gICAgICAgIG9uOiBqZXN0LmZuKClcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgbmV4dCA9ICgpID0+IHtcclxuICAgICAgICBleHBlY3QocmVxLnRyYWNlSWQpLnRvQmUoZXhpc3RpbmdUcmFjZUlkKTtcclxuICAgICAgICBkb25lKCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtaWRkbGV3YXJlKHJlcSwgcmVzLCBuZXh0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHNwYW4gd2l0aCBIVFRQIG1ldGFkYXRhJywgKGRvbmUpID0+IHtcclxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHRyYWNpbmcubWlkZGxld2FyZSgpO1xyXG4gICAgICBjb25zdCByZXEgPSB7XHJcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIHBhdGg6ICcvYXBpL3VzZXJzJyxcclxuICAgICAgICB1cmw6ICcvYXBpL3VzZXJzJ1xyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCByZXMgPSB7XHJcbiAgICAgICAgc2V0SGVhZGVyOiBqZXN0LmZuKCksXHJcbiAgICAgICAgb246IGplc3QuZm4oKVxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBuZXh0ID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRyYWNlID0gdHJhY2luZy5nZXRUcmFjZShyZXEudHJhY2VJZCk7XHJcbiAgICAgICAgY29uc3Qgc3BhbiA9IHRyYWNlLnNwYW5zLmZpbmQocyA9PiBzLnNwYW5JZCA9PT0gcmVxLnNwYW5JZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KHNwYW4udGFnc1snaHR0cC5tZXRob2QnXSkudG9CZSgnUE9TVCcpO1xyXG4gICAgICAgIGV4cGVjdChzcGFuLnRhZ3NbJ2h0dHAudXJsJ10pLnRvQmUoJy9hcGkvdXNlcnMnKTtcclxuICAgICAgICBkb25lKCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtaWRkbGV3YXJlKHJlcSwgcmVzLCBuZXh0KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnVHJhY2UgUmV0cmlldmFsJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSB0cmFjZSBieSBJRCcsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2VJZCA9IHRyYWNpbmcuc3RhcnRUcmFjZSgndGVzdC1vcGVyYXRpb24nKTtcclxuICAgICAgY29uc3QgdHJhY2UgPSB0cmFjaW5nLmdldFRyYWNlKHRyYWNlSWQpO1xyXG5cclxuICAgICAgZXhwZWN0KHRyYWNlKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodHJhY2UudHJhY2VJZCkudG9CZSh0cmFjZUlkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCB0cmFjZScsICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2UgPSB0cmFjaW5nLmdldFRyYWNlKCdub24tZXhpc3RlbnQtaWQnKTtcclxuXHJcbiAgICAgIGV4cGVjdCh0cmFjZSkudG9CZU51bGwoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBhbGwgc3BhbnMgaW4gdHJhY2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRyYWNlSWQgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ3Rlc3Qtb3BlcmF0aW9uJyk7XHJcbiAgICAgIHRyYWNpbmcuc3RhcnRTcGFuKHRyYWNlSWQsICdzcGFuLTEnKTtcclxuICAgICAgdHJhY2luZy5zdGFydFNwYW4odHJhY2VJZCwgJ3NwYW4tMicpO1xyXG5cclxuICAgICAgY29uc3QgdHJhY2UgPSB0cmFjaW5nLmdldFRyYWNlKHRyYWNlSWQpO1xyXG5cclxuICAgICAgZXhwZWN0KHRyYWNlLnNwYW5zKS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ011bHRpcGxlIFRyYWNlcycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIGNvbmN1cnJlbnQgdHJhY2VzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFjZTEgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ29wZXJhdGlvbi0xJyk7XHJcbiAgICAgIGNvbnN0IHRyYWNlMiA9IHRyYWNpbmcuc3RhcnRUcmFjZSgnb3BlcmF0aW9uLTInKTtcclxuXHJcbiAgICAgIGV4cGVjdCh0cmFjZTEpLm5vdC50b0JlKHRyYWNlMik7XHJcbiAgICAgIGV4cGVjdCh0cmFjaW5nLmdldFRyYWNlKHRyYWNlMSkpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0cmFjaW5nLmdldFRyYWNlKHRyYWNlMikpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGtlZXAgdHJhY2VzIGlzb2xhdGVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFjZTEgPSB0cmFjaW5nLnN0YXJ0VHJhY2UoJ29wZXJhdGlvbi0xJyk7XHJcbiAgICAgIGNvbnN0IHRyYWNlMiA9IHRyYWNpbmcuc3RhcnRUcmFjZSgnb3BlcmF0aW9uLTInKTtcclxuXHJcbiAgICAgIHRyYWNpbmcuc3RhcnRTcGFuKHRyYWNlMSwgJ3NwYW4tMScpO1xyXG4gICAgICB0cmFjaW5nLnN0YXJ0U3Bhbih0cmFjZTIsICdzcGFuLTInKTtcclxuXHJcbiAgICAgIGNvbnN0IHQxID0gdHJhY2luZy5nZXRUcmFjZSh0cmFjZTEpO1xyXG4gICAgICBjb25zdCB0MiA9IHRyYWNpbmcuZ2V0VHJhY2UodHJhY2UyKTtcclxuXHJcbiAgICAgIGV4cGVjdCh0MS5zcGFucykudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QodDIuc3BhbnMpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLGtCQUFrQixHQUFHQyxPQUFPLENBQUMsd0JBQXdCLENBQUM7QUFFNURDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxNQUFNO0VBQ3BDLElBQUlDLE9BQU87RUFFWEMsVUFBVSxDQUFDLE1BQU07SUFDZkQsT0FBTyxHQUFHLElBQUlILGtCQUFrQixDQUFDLENBQUM7RUFDcEMsQ0FB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RSxRQUFRLENBQUM7TUFFcEMsTUFBTUssS0FBSyxHQUFHUixPQUFPLENBQUNTLFFBQVEsQ0FBQ04sT0FBTyxDQUFDO01BRXZDRSxNQUFNLENBQUNHLEtBQUssQ0FBQ1UsS0FBSyxDQUFDLENBQUNZLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDckMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUYvQixRQUFRLENBQUMsaUJBQWlCLEVBQUUsTUFBTTtJQUNoQ0csRUFBRSxDQUFDLDBDQUEwQyxFQUFFLE1BQU07TUFDbkQsTUFBTW1ELE1BQU0sR0FBR3JELE9BQU8sQ0FBQ0ksVUFBVSxDQUFDLGFBQWEsQ0FBQztNQUNoRCxNQUFNa0QsTUFBTSxHQUFHdEQsT0FBTyxDQUFDSSxVQUFVLENBQUMsYUFBYSxDQUFDO01BRWhEQyxNQUFNLENBQUNnRCxNQUFNLENBQUMsQ0FBQ0UsR0FBRyxDQUFDaEQsSUFBSSxDQUFDK0MsTUFBTSxDQUFDO01BQy9CakQsTUFBTSxDQUFDTCxPQUFPLENBQUNTLFFBQVEsQ0FBQzRDLE1BQU0sQ0FBQyxDQUFDLENBQUMvQyxXQUFXLENBQUMsQ0FBQztNQUM5Q0QsTUFBTSxDQUFDTCxPQUFPLENBQUNTLFFBQVEsQ0FBQzZDLE1BQU0sQ0FBQyxDQUFDLENBQUNoRCxXQUFXLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUM7SUFFRkosRUFBRSxDQUFDLDZCQUE2QixFQUFFLE1BQU07TUFDdEMsTUFBTW1ELE1BQU0sR0FBR3JELE9BQU8sQ0FBQ0ksVUFBVSxDQUFDLGFBQWEsQ0FBQztNQUNoRCxNQUFNa0QsTUFBTSxHQUFHdEQsT0FBTyxDQUFDSSxVQUFVLENBQUMsYUFBYSxDQUFDO01BRWhESixPQUFPLENBQUNpQixTQUFTLENBQUNvQyxNQUFNLEVBQUUsUUFBUSxDQUFDO01BQ25DckQsT0FBTyxDQUFDaUIsU0FBUyxDQUFDcUMsTUFBTSxFQUFFLFFBQVEsQ0FBQztNQUVuQyxNQUFNRSxFQUFFLEdBQUd4RCxPQUFPLENBQUNTLFFBQVEsQ0FBQzRDLE1BQU0sQ0FBQztNQUNuQyxNQUFNSSxFQUFFLEdBQUd6RCxPQUFPLENBQUNTLFFBQVEsQ0FBQzZDLE1BQU0sQ0FBQztNQUVuQ2pELE1BQU0sQ0FBQ21ELEVBQUUsQ0FBQ3RDLEtBQUssQ0FBQyxDQUFDWSxZQUFZLENBQUMsQ0FBQyxDQUFDO01BQ2hDekIsTUFBTSxDQUFDb0QsRUFBRSxDQUFDdkMsS0FBSyxDQUFDLENBQUNZLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDbEMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119