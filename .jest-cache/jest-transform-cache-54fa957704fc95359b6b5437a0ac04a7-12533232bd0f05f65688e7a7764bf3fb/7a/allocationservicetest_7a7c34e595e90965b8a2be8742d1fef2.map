{"version":3,"names":["_allocationService","require","_errorHandler","describe","businessId","userId","ipAddress","transactionId","beforeEach","jest","clearAllMocks","Date","now","Math","random","toString","substr","it","amount","allocation","allocationService","createAllocation","expect","toBeDefined","businessOwnerAmount","toBe","citadelFundAmount","testCases","expectedBusiness","expectedFund","testCase","toBeCloseTo","total","id","allocatedAt","uniqueTxId","created","retrieved","getAllocationByTransaction","fakeTransactionId","toBeNull","rule","getAllocationRule","businessShare","fundShare","rejects","toThrow","AppError","validation","validateAllocation","valid","errors","toHaveLength","length","toBeGreaterThan","updateAllocationRule","auditTrail","getAllocationAuditTrail","action","ruleKey","details","toContain","testBusinessId","tx1","tx2","result","recalculateAllocations","before","after","timestamp","getTime","toBeGreaterThanOrEqual","toBeLessThanOrEqual","testUserId","testIpAddress","csv","exportAllocationAuditTrailAsCSV","allocation1","allocation2","allTrails","getAllAllocationAuditTrails","Object","keys","totals","calculateTotalAllocations","totalRevenue","businessOwnerTotal","citadelFundTotal","allocationCount","startDate","endDate","breakdown","getAllocationBreakdown","businessOwnerShare","citadelFundShare","businessOwnerPercentage","citadelFundPercentage","tx3","stats","getAllocationStats","totalAllocations","largestAllocation","smallestAllocation","averageAllocation","totalBusinessOwnerAmount","totalCitadelFundAmount","averageBusinessShare","averageFundShare","recalculated","totalNewBusinessOwnerAmount","totalNewCitadelFundAmount","amount1","amount2","totalBefore","totalAfter","amounts","i","expectedTotal","reduce","a","b"],"sources":["allocation-service.test.ts"],"sourcesContent":["import { allocationService } from '../services/allocation.service.js';\r\nimport { auditService } from '../services/audit.service.js';\r\nimport { AppError } from '../middleware/errorHandler.js';\r\n\r\ndescribe('Allocation Service - Revenue Allocation Engine', () => {\r\n  const businessId = '550e8400-e29b-41d4-a716-446655440001';\r\n  const userId = '550e8400-e29b-41d4-a716-446655440003';\r\n  const ipAddress = '192.168.1.1';\r\n  let transactionId: string;\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    // Generate unique transaction ID for each test\r\n    transactionId = `tx_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  });\r\n\r\n  describe('90/10 Split Calculation', () => {\r\n    it('should create allocation with default 90/10 split', async () => {\r\n      const amount = 1000;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      expect(allocation).toBeDefined();\r\n      expect(allocation.businessOwnerAmount).toBe(900);\r\n      expect(allocation.citadelFundAmount).toBe(100);\r\n      expect(allocation.businessOwnerAmount + allocation.citadelFundAmount).toBe(amount);\r\n    });\r\n\r\n    it('should calculate correct amounts for various transaction amounts', async () => {\r\n      const testCases = [\r\n        { amount: 100, expectedBusiness: 90, expectedFund: 10 },\r\n        { amount: 1000, expectedBusiness: 900, expectedFund: 100 },\r\n        { amount: 5000, expectedBusiness: 4500, expectedFund: 500 },\r\n        { amount: 12345.67, expectedBusiness: 11111.103, expectedFund: 1234.567 },\r\n      ];\r\n\r\n      for (const testCase of testCases) {\r\n        const allocation = await allocationService.createAllocation(\r\n          `tx_${testCase.amount}`,\r\n          testCase.amount,\r\n          90,\r\n          10,\r\n          userId,\r\n          ipAddress,\r\n          businessId\r\n        );\r\n\r\n        expect(allocation.businessOwnerAmount).toBeCloseTo(testCase.expectedBusiness, 2);\r\n        expect(allocation.citadelFundAmount).toBeCloseTo(testCase.expectedFund, 2);\r\n      }\r\n    });\r\n\r\n    it('should support custom allocation splits', async () => {\r\n      const amount = 1000;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        80,\r\n        20,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      expect(allocation.businessOwnerAmount).toBe(800);\r\n      expect(allocation.citadelFundAmount).toBe(200);\r\n    });\r\n\r\n    it('should maintain precision for decimal amounts', async () => {\r\n      const amount = 123.45;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      const total = allocation.businessOwnerAmount + allocation.citadelFundAmount;\r\n      expect(total).toBeCloseTo(amount, 2);\r\n    });\r\n  });\r\n\r\n  describe('Allocation Transaction Records', () => {\r\n    it('should create allocation transaction record', async () => {\r\n      const amount = 1000;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      expect(allocation.id).toBeDefined();\r\n      expect(allocation.transactionId).toBe(transactionId);\r\n      expect(allocation.allocatedAt).toBeDefined();\r\n      expect(allocation.allocatedAt instanceof Date).toBe(true);\r\n    });\r\n\r\n    it('should retrieve allocation by transaction ID', async () => {\r\n      const amount = 1000;\r\n      const uniqueTxId = `tx_retrieve_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n      const created = await allocationService.createAllocation(\r\n        uniqueTxId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      const retrieved = await allocationService.getAllocationByTransaction(uniqueTxId);\r\n\r\n      expect(retrieved).toBeDefined();\r\n      expect(retrieved?.id).toBe(created.id);\r\n      expect(retrieved?.businessOwnerAmount).toBe(900);\r\n      expect(retrieved?.citadelFundAmount).toBe(100);\r\n    });\r\n\r\n    it('should return null for non-existent allocation', async () => {\r\n      const fakeTransactionId = '550e8400-e29b-41d4-a716-446655440099';\r\n      const allocation = await allocationService.getAllocationByTransaction(fakeTransactionId);\r\n\r\n      expect(allocation).toBeNull();\r\n    });\r\n\r\n    it('should store allocation rule for transaction', async () => {\r\n      const amount = 1000;\r\n      await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        85,\r\n        15,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      const rule = await allocationService.getAllocationRule(transactionId);\r\n\r\n      expect(rule).toBeDefined();\r\n      expect(rule?.businessShare).toBe(85);\r\n      expect(rule?.fundShare).toBe(15);\r\n    });\r\n  });\r\n\r\n  describe('Allocation Validation', () => {\r\n    it('should validate that shares add up to 100%', async () => {\r\n      const amount = 1000;\r\n\r\n      await expect(\r\n        allocationService.createAllocation(transactionId, amount, 80, 15, userId, ipAddress, businessId)\r\n      ).rejects.toThrow(AppError);\r\n    });\r\n\r\n    it('should validate positive amount', async () => {\r\n      await expect(\r\n        allocationService.createAllocation(transactionId, -100, 90, 10, userId, ipAddress, businessId)\r\n      ).rejects.toThrow(AppError);\r\n\r\n      await expect(\r\n        allocationService.createAllocation(transactionId, 0, 90, 10, userId, ipAddress, businessId)\r\n      ).rejects.toThrow(AppError);\r\n    });\r\n\r\n    it('should validate allocation amounts match transaction', async () => {\r\n      const amount = 1000;\r\n      const businessOwnerAmount = 900;\r\n      const citadelFundAmount = 100;\r\n\r\n      const validation = allocationService.validateAllocation(\r\n        amount,\r\n        businessOwnerAmount,\r\n        citadelFundAmount\r\n      );\r\n\r\n      expect(validation.valid).toBe(true);\r\n      expect(validation.errors).toHaveLength(0);\r\n    });\r\n\r\n    it('should detect mismatched allocation amounts', async () => {\r\n      const amount = 1000;\r\n      const businessOwnerAmount = 800;\r\n      const citadelFundAmount = 100;\r\n\r\n      const validation = allocationService.validateAllocation(\r\n        amount,\r\n        businessOwnerAmount,\r\n        citadelFundAmount\r\n      );\r\n\r\n      expect(validation.valid).toBe(false);\r\n      expect(validation.errors.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should detect negative allocated amounts', async () => {\r\n      const amount = 1000;\r\n      const businessOwnerAmount = -900;\r\n      const citadelFundAmount = 100;\r\n\r\n      const validation = allocationService.validateAllocation(\r\n        amount,\r\n        businessOwnerAmount,\r\n        citadelFundAmount\r\n      );\r\n\r\n      expect(validation.valid).toBe(false);\r\n      expect(validation.errors.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should validate allocation rule shares', async () => {\r\n      await expect(\r\n        allocationService.updateAllocationRule(businessId, 150, -50, userId, ipAddress)\r\n      ).rejects.toThrow(AppError);\r\n\r\n      await expect(\r\n        allocationService.updateAllocationRule(businessId, 50, 60, userId, ipAddress)\r\n      ).rejects.toThrow(AppError);\r\n    });\r\n  });\r\n\r\n  describe('Allocation Audit Logging', () => {\r\n    it('should log allocation creation', async () => {\r\n      const amount = 1000;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      const auditTrail = await allocationService.getAllocationAuditTrail(allocation.id);\r\n\r\n      expect(auditTrail).toBeDefined();\r\n      expect(auditTrail.length).toBeGreaterThan(0);\r\n      expect(auditTrail[0].action).toBe('allocation_created');\r\n      expect(auditTrail[0].userId).toBe(userId);\r\n      expect(auditTrail[0].ipAddress).toBe(ipAddress);\r\n    });\r\n\r\n    it('should log allocation rule updates', async () => {\r\n      const ruleKey = `business_${businessId}`;\r\n      await allocationService.updateAllocationRule(businessId, 85, 15, userId, ipAddress);\r\n\r\n      const auditTrail = await allocationService.getAllocationAuditTrail(ruleKey);\r\n\r\n      expect(auditTrail).toBeDefined();\r\n      expect(auditTrail.length).toBeGreaterThan(0);\r\n      expect(auditTrail[0].action).toBe('allocation_rule_updated');\r\n      expect(auditTrail[0].details).toContain('85%');\r\n      expect(auditTrail[0].details).toContain('15%');\r\n    });\r\n\r\n    it('should log allocation recalculation', async () => {\r\n      const testBusinessId = `recalc_test_${Date.now()}`;\r\n      const tx1 = `tx_recalc_1_${Date.now()}`;\r\n      const tx2 = `tx_recalc_2_${Date.now()}`;\r\n      \r\n      // Create initial allocations\r\n      await allocationService.createAllocation(\r\n        tx1,\r\n        1000,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        testBusinessId\r\n      );\r\n      await allocationService.createAllocation(\r\n        tx2,\r\n        2000,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        testBusinessId\r\n      );\r\n\r\n      // Recalculate with new shares\r\n      const result = await allocationService.recalculateAllocations(\r\n        testBusinessId,\r\n        80,\r\n        20,\r\n        userId,\r\n        ipAddress\r\n      );\r\n\r\n      const ruleKey = `recalc_${testBusinessId}`;\r\n      const auditTrail = await allocationService.getAllocationAuditTrail(ruleKey);\r\n\r\n      expect(auditTrail).toBeDefined();\r\n      expect(auditTrail.length).toBeGreaterThan(0);\r\n      expect(auditTrail[0].action).toBe('allocation_recalculated');\r\n      expect(auditTrail[0].details).toContain('2 allocations');\r\n    });\r\n\r\n    it('should include timestamp in audit trail', async () => {\r\n      const before = new Date();\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        1000,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n      const after = new Date();\r\n\r\n      const auditTrail = await allocationService.getAllocationAuditTrail(allocation.id);\r\n\r\n      expect(auditTrail[0].timestamp.getTime()).toBeGreaterThanOrEqual(before.getTime());\r\n      expect(auditTrail[0].timestamp.getTime()).toBeLessThanOrEqual(after.getTime());\r\n    });\r\n\r\n    it('should track user and IP in audit trail', async () => {\r\n      const testUserId = 'test-user-123';\r\n      const testIpAddress = '10.0.0.1';\r\n\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        1000,\r\n        90,\r\n        10,\r\n        testUserId,\r\n        testIpAddress,\r\n        businessId\r\n      );\r\n\r\n      const auditTrail = await allocationService.getAllocationAuditTrail(allocation.id);\r\n\r\n      expect(auditTrail[0].userId).toBe(testUserId);\r\n      expect(auditTrail[0].ipAddress).toBe(testIpAddress);\r\n    });\r\n\r\n    it('should export allocation audit trail as CSV', async () => {\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        1000,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      const csv = await allocationService.exportAllocationAuditTrailAsCSV(allocation.id);\r\n\r\n      expect(csv).toBeDefined();\r\n      expect(csv).toContain('Timestamp');\r\n      expect(csv).toContain('Action');\r\n      expect(csv).toContain('allocation_created');\r\n      expect(csv).toContain(userId);\r\n      expect(csv).toContain(ipAddress);\r\n    });\r\n\r\n    it('should retrieve all allocation audit trails', async () => {\r\n      const allocation1 = await allocationService.createAllocation(\r\n        `tx_1`,\r\n        1000,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n      const allocation2 = await allocationService.createAllocation(\r\n        `tx_2`,\r\n        2000,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      const allTrails = await allocationService.getAllAllocationAuditTrails();\r\n\r\n      expect(Object.keys(allTrails).length).toBeGreaterThanOrEqual(2);\r\n      expect(allTrails[allocation1.id]).toBeDefined();\r\n      expect(allTrails[allocation2.id]).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('Allocation Calculations', () => {\r\n    it('should calculate total allocations correctly', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440010';\r\n      await allocationService.createAllocation(`tx_1`, 1000, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(`tx_2`, 2000, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(`tx_3`, 500, 90, 10, userId, ipAddress, testBusinessId);\r\n\r\n      const totals = await allocationService.calculateTotalAllocations(testBusinessId);\r\n\r\n      expect(totals.totalRevenue).toBe(3500);\r\n      expect(totals.businessOwnerTotal).toBe(3150);\r\n      expect(totals.citadelFundTotal).toBe(350);\r\n      expect(totals.allocationCount).toBe(3);\r\n    });\r\n\r\n    it('should get allocation breakdown by period', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440011';\r\n      const now = new Date();\r\n      const startDate = new Date(now.getTime() - 24 * 60 * 60 * 1000); // yesterday\r\n      const endDate = new Date(now.getTime() + 24 * 60 * 60 * 1000); // tomorrow\r\n\r\n      await allocationService.createAllocation(`tx_1`, 1000, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(`tx_2`, 2000, 90, 10, userId, ipAddress, testBusinessId);\r\n\r\n      const breakdown = await allocationService.getAllocationBreakdown(testBusinessId, startDate, endDate);\r\n\r\n      expect(breakdown.totalRevenue).toBeGreaterThan(0);\r\n      expect(breakdown.businessOwnerShare).toBeCloseTo(breakdown.totalRevenue * 0.9, 1);\r\n      expect(breakdown.citadelFundShare).toBeCloseTo(breakdown.totalRevenue * 0.1, 1);\r\n      expect(breakdown.businessOwnerPercentage).toBeCloseTo(90, 1);\r\n      expect(breakdown.citadelFundPercentage).toBeCloseTo(10, 1);\r\n    });\r\n\r\n    it('should get allocation statistics', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440012';\r\n      const tx1 = `tx_stats_1_${Date.now()}`;\r\n      const tx2 = `tx_stats_2_${Date.now()}`;\r\n      const tx3 = `tx_stats_3_${Date.now()}`;\r\n      \r\n      await allocationService.createAllocation(tx1, 1000, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(tx2, 2000, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(tx3, 500, 90, 10, userId, ipAddress, testBusinessId);\r\n\r\n      const stats = await allocationService.getAllocationStats(testBusinessId);\r\n\r\n      expect(stats.totalAllocations).toBe(3);\r\n      expect(stats.largestAllocation).toBe(2000);\r\n      expect(stats.smallestAllocation).toBe(500);\r\n      expect(stats.averageAllocation).toBeCloseTo(1166.67, 1);\r\n      // Total revenue is 3500, so business owner gets 3150 (90%) and fund gets 350 (10%)\r\n      expect(stats.totalBusinessOwnerAmount).toBe(3150);\r\n      expect(stats.totalCitadelFundAmount).toBe(350);\r\n      expect(stats.averageBusinessShare).toBeCloseTo(90, 1);\r\n      expect(stats.averageFundShare).toBeCloseTo(10, 1);\r\n    });\r\n\r\n    it('should return zero statistics for business with no allocations', async () => {\r\n      const stats = await allocationService.getAllocationStats('non-existent-business');\r\n\r\n      expect(stats.totalAllocations).toBe(0);\r\n      expect(stats.averageAllocation).toBe(0);\r\n      expect(stats.largestAllocation).toBe(0);\r\n      expect(stats.smallestAllocation).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('Allocation Recalculation', () => {\r\n    it('should recalculate allocations with new shares', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440013';\r\n      await allocationService.createAllocation(`tx_1`, 1000, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(`tx_2`, 2000, 90, 10, userId, ipAddress, testBusinessId);\r\n\r\n      const result = await allocationService.recalculateAllocations(\r\n        testBusinessId,\r\n        80,\r\n        20,\r\n        userId,\r\n        ipAddress\r\n      );\r\n\r\n      expect(result.recalculated).toBe(2);\r\n      expect(result.totalNewBusinessOwnerAmount).toBe(2400); // (1000 + 2000) * 0.8\r\n      expect(result.totalNewCitadelFundAmount).toBe(600); // (1000 + 2000) * 0.2\r\n    });\r\n\r\n    it('should validate new shares during recalculation', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440014';\r\n      await expect(\r\n        allocationService.recalculateAllocations(testBusinessId, 70, 40, userId, ipAddress)\r\n      ).rejects.toThrow(AppError);\r\n    });\r\n\r\n    it('should maintain total amount during recalculation', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440015';\r\n      const amount1 = 1000;\r\n      const amount2 = 2000;\r\n\r\n      await allocationService.createAllocation(`tx_1`, amount1, 90, 10, userId, ipAddress, testBusinessId);\r\n      await allocationService.createAllocation(`tx_2`, amount2, 90, 10, userId, ipAddress, testBusinessId);\r\n\r\n      const result = await allocationService.recalculateAllocations(\r\n        testBusinessId,\r\n        75,\r\n        25,\r\n        userId,\r\n        ipAddress\r\n      );\r\n\r\n      const totalBefore = amount1 + amount2;\r\n      const totalAfter = result.totalNewBusinessOwnerAmount + result.totalNewCitadelFundAmount;\r\n\r\n      expect(totalAfter).toBeCloseTo(totalBefore, 2);\r\n    });\r\n  });\r\n\r\n  describe('Allocation Rule Management', () => {\r\n    it('should update allocation rule', async () => {\r\n      const rule = await allocationService.updateAllocationRule(\r\n        businessId,\r\n        85,\r\n        15,\r\n        userId,\r\n        ipAddress\r\n      );\r\n\r\n      expect(rule.businessShare).toBe(85);\r\n      expect(rule.fundShare).toBe(15);\r\n    });\r\n\r\n    it('should retrieve allocation rule', async () => {\r\n      await allocationService.updateAllocationRule(businessId, 80, 20, userId, ipAddress);\r\n\r\n      const ruleKey = `business_${businessId}`;\r\n      const rule = await allocationService.getAllocationRule(ruleKey);\r\n\r\n      expect(rule).toBeDefined();\r\n      expect(rule?.businessShare).toBe(80);\r\n      expect(rule?.fundShare).toBe(20);\r\n    });\r\n\r\n    it('should validate rule shares add up to 100%', async () => {\r\n      await expect(\r\n        allocationService.updateAllocationRule(businessId, 80, 25, userId, ipAddress)\r\n      ).rejects.toThrow(AppError);\r\n    });\r\n\r\n    it('should validate rule shares are within valid range', async () => {\r\n      await expect(\r\n        allocationService.updateAllocationRule(businessId, 150, -50, userId, ipAddress)\r\n      ).rejects.toThrow(AppError);\r\n    });\r\n  });\r\n\r\n  describe('Allocation Accuracy and Precision', () => {\r\n    it('should maintain accuracy across multiple allocations', async () => {\r\n      const testBusinessId = '550e8400-e29b-41d4-a716-446655440016';\r\n      const amounts = [100, 250, 1000, 5000, 12345.67];\r\n\r\n      for (let i = 0; i < amounts.length; i++) {\r\n        await allocationService.createAllocation(\r\n          `tx_${i}`,\r\n          amounts[i],\r\n          90,\r\n          10,\r\n          userId,\r\n          ipAddress,\r\n          testBusinessId\r\n        );\r\n      }\r\n\r\n      const totals = await allocationService.calculateTotalAllocations(testBusinessId);\r\n      const expectedTotal = amounts.reduce((a, b) => a + b, 0);\r\n\r\n      expect(totals.totalRevenue).toBeCloseTo(expectedTotal, 2);\r\n      expect(totals.businessOwnerTotal).toBeCloseTo(expectedTotal * 0.9, 2);\r\n      expect(totals.citadelFundTotal).toBeCloseTo(expectedTotal * 0.1, 2);\r\n    });\r\n\r\n    it('should handle very small amounts', async () => {\r\n      const amount = 0.01;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      expect(allocation.businessOwnerAmount).toBeCloseTo(0.009, 3);\r\n      expect(allocation.citadelFundAmount).toBeCloseTo(0.001, 3);\r\n    });\r\n\r\n    it('should handle very large amounts', async () => {\r\n      const amount = 999999999.99;\r\n      const allocation = await allocationService.createAllocation(\r\n        transactionId,\r\n        amount,\r\n        90,\r\n        10,\r\n        userId,\r\n        ipAddress,\r\n        businessId\r\n      );\r\n\r\n      expect(allocation.businessOwnerAmount).toBeCloseTo(amount * 0.9, 2);\r\n      expect(allocation.citadelFundAmount).toBeCloseTo(amount * 0.1, 2);\r\n    });\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}