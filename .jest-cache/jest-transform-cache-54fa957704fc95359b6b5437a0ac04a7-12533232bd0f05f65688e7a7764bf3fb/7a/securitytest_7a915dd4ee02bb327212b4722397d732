820b4769243ae14ec52bc1bb8973c91c
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
describe('Shared Utilities - Security', () => {
  let mockRequest;
  let mockResponse;
  let nextFunction;
  beforeEach(() => {
    mockRequest = {
      headers: {},
      body: {},
      query: {}
    };
    mockResponse = {
      setHeader: jest.fn(),
      status: jest.fn().mockReturnThis(),
      json: jest.fn().mockReturnThis()
    };
    nextFunction = jest.fn();
  });
  describe('Security Headers', () => {
    it('should set security headers', () => {
      const securityHeadersMiddleware = (req, res, next) => {
        res.setHeader('X-Content-Type-Options', 'nosniff');
        res.setHeader('X-Frame-Options', 'DENY');
        res.setHeader('X-XSS-Protection', '1; mode=block');
        res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
        next();
      };
      securityHeadersMiddleware(mockRequest, mockResponse, nextFunction);
      expect(mockResponse.setHeader).toHaveBeenCalledWith('X-Content-Type-Options', 'nosniff');
      expect(mockResponse.setHeader).toHaveBeenCalledWith('X-Frame-Options', 'DENY');
      expect(nextFunction).toHaveBeenCalled();
    });
    it('should set HSTS header', () => {
      const hstsMiddleware = (req, res, next) => {
        res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
        next();
      };
      hstsMiddleware(mockRequest, mockResponse, nextFunction);
      expect(mockResponse.setHeader).toHaveBeenCalledWith('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
    });
  });
  describe('Input Sanitization', () => {
    it('should sanitize user input', () => {
      const sanitize = input => {
        return input.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\//g, '&#x2F;');
      };
      const maliciousInput = '<script>alert("XSS")</script>';
      const sanitized = sanitize(maliciousInput);
      expect(sanitized).not.toContain('<script>');
      expect(sanitized).toContain('&lt;script&gt;');
    });
    it('should handle SQL injection attempts', () => {
      const sanitizeSQL = input => {
        return input.replace(/['";\\]/g, '');
      };
      const sqlInjection = "'; DROP TABLE users; --";
      const sanitized = sanitizeSQL(sqlInjection);
      expect(sanitized).not.toContain("'");
      expect(sanitized).not.toContain(';');
    });
  });
  describe('CORS Configuration', () => {
    it('should validate allowed origins', () => {
      const allowedOrigins = ['http://localhost:3000', 'https://azora.world'];
      const isOriginAllowed = origin => {
        return allowedOrigins.includes(origin);
      };
      expect(isOriginAllowed('http://localhost:3000')).toBe(true);
      expect(isOriginAllowed('https://azora.world')).toBe(true);
      expect(isOriginAllowed('https://malicious.com')).toBe(false);
    });
    it('should handle CORS preflight requests', () => {
      mockRequest.method = 'OPTIONS';
      mockRequest.headers = {
        'access-control-request-method': 'POST',
        'access-control-request-headers': 'content-type'
      };
      const corsMiddleware = (req, res, next) => {
        if (req.method === 'OPTIONS') {
          res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
          res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
          res.status(204);
          return;
        }
        next();
      };
      corsMiddleware(mockRequest, mockResponse, nextFunction);
      expect(mockResponse.setHeader).toHaveBeenCalledWith('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
    });
  });
  describe('Rate Limiting', () => {
    it('should track request counts', () => {
      const requestCounts = new Map();
      const trackRequest = ip => {
        const count = requestCounts.get(ip) || 0;
        requestCounts.set(ip, count + 1);
        return count + 1;
      };
      expect(trackRequest('192.168.1.1')).toBe(1);
      expect(trackRequest('192.168.1.1')).toBe(2);
      expect(trackRequest('192.168.1.2')).toBe(1);
    });
    it('should enforce rate limits', () => {
      const MAX_REQUESTS = 5;
      const requestCounts = new Map();
      const isRateLimited = ip => {
        const count = requestCounts.get(ip) || 0;
        return count >= MAX_REQUESTS;
      };
      for (let i = 0; i < MAX_REQUESTS; i++) {
        requestCounts.set('192.168.1.1', i + 1);
      }
      expect(isRateLimited('192.168.1.1')).toBe(true);
      expect(isRateLimited('192.168.1.2')).toBe(false);
    });
  });
  describe('Token Validation', () => {
    it('should validate token format', () => {
      const isValidTokenFormat = token => {
        return /^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(token);
      };
      expect(isValidTokenFormat('header.payload.signature')).toBe(true);
      expect(isValidTokenFormat('invalid-token')).toBe(false);
      expect(isValidTokenFormat('')).toBe(false);
    });
    it('should validate token expiration', () => {
      const isTokenExpired = exp => {
        return exp < Date.now() / 1000;
      };
      const futureTime = Math.floor(Date.now() / 1000) + 3600;
      const pastTime = Math.floor(Date.now() / 1000) - 3600;
      expect(isTokenExpired(futureTime)).toBe(false);
      expect(isTokenExpired(pastTime)).toBe(true);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXNjcmliZSIsIm1vY2tSZXF1ZXN0IiwibW9ja1Jlc3BvbnNlIiwibmV4dEZ1bmN0aW9uIiwiYmVmb3JlRWFjaCIsImhlYWRlcnMiLCJib2R5IiwicXVlcnkiLCJzZXRIZWFkZXIiLCJqZXN0IiwiZm4iLCJzdGF0dXMiLCJtb2NrUmV0dXJuVGhpcyIsImpzb24iLCJpdCIsInNlY3VyaXR5SGVhZGVyc01pZGRsZXdhcmUiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZXhwZWN0IiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwiaHN0c01pZGRsZXdhcmUiLCJzYW5pdGl6ZSIsImlucHV0IiwicmVwbGFjZSIsIm1hbGljaW91c0lucHV0Iiwic2FuaXRpemVkIiwibm90IiwidG9Db250YWluIiwic2FuaXRpemVTUUwiLCJzcWxJbmplY3Rpb24iLCJhbGxvd2VkT3JpZ2lucyIsImlzT3JpZ2luQWxsb3dlZCIsIm9yaWdpbiIsImluY2x1ZGVzIiwidG9CZSIsIm1ldGhvZCIsImNvcnNNaWRkbGV3YXJlIiwicmVxdWVzdENvdW50cyIsIk1hcCIsInRyYWNrUmVxdWVzdCIsImlwIiwiY291bnQiLCJnZXQiLCJzZXQiLCJNQVhfUkVRVUVTVFMiLCJpc1JhdGVMaW1pdGVkIiwiaSIsImlzVmFsaWRUb2tlbkZvcm1hdCIsInRva2VuIiwidGVzdCIsImlzVG9rZW5FeHBpcmVkIiwiZXhwIiwiRGF0ZSIsIm5vdyIsImZ1dHVyZVRpbWUiLCJNYXRoIiwiZmxvb3IiLCJwYXN0VGltZSJdLCJzb3VyY2VzIjpbInNlY3VyaXR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xyXG5cclxuZGVzY3JpYmUoJ1NoYXJlZCBVdGlsaXRpZXMgLSBTZWN1cml0eScsICgpID0+IHtcclxuICBsZXQgbW9ja1JlcXVlc3Q6IFBhcnRpYWw8UmVxdWVzdD47XHJcbiAgbGV0IG1vY2tSZXNwb25zZTogUGFydGlhbDxSZXNwb25zZT47XHJcbiAgbGV0IG5leHRGdW5jdGlvbjogTmV4dEZ1bmN0aW9uO1xyXG4gIFxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgIGhlYWRlcnM6IHt9LFxyXG4gICAgICBib2R5OiB7fSxcclxuICAgICAgcXVlcnk6IHt9XHJcbiAgICB9O1xyXG4gICAgbW9ja1Jlc3BvbnNlID0ge1xyXG4gICAgICBzZXRIZWFkZXI6IGplc3QuZm4oKSxcclxuICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAganNvbjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKClcclxuICAgIH07XHJcbiAgICBuZXh0RnVuY3Rpb24gPSBqZXN0LmZuKCk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ1NlY3VyaXR5IEhlYWRlcnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHNldCBzZWN1cml0eSBoZWFkZXJzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZWN1cml0eUhlYWRlcnNNaWRkbGV3YXJlID0gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XHJcbiAgICAgICAgcmVzLnNldEhlYWRlcignWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJyk7XHJcbiAgICAgICAgcmVzLnNldEhlYWRlcignWC1GcmFtZS1PcHRpb25zJywgJ0RFTlknKTtcclxuICAgICAgICByZXMuc2V0SGVhZGVyKCdYLVhTUy1Qcm90ZWN0aW9uJywgJzE7IG1vZGU9YmxvY2snKTtcclxuICAgICAgICByZXMuc2V0SGVhZGVyKCdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JywgJ21heC1hZ2U9MzE1MzYwMDA7IGluY2x1ZGVTdWJEb21haW5zJyk7XHJcbiAgICAgICAgbmV4dCgpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgc2VjdXJpdHlIZWFkZXJzTWlkZGxld2FyZShcclxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxyXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcclxuICAgICAgICBuZXh0RnVuY3Rpb25cclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc2V0SGVhZGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc2V0SGVhZGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnWC1GcmFtZS1PcHRpb25zJywgJ0RFTlknKTtcclxuICAgICAgZXhwZWN0KG5leHRGdW5jdGlvbikudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgc2V0IEhTVFMgaGVhZGVyJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBoc3RzTWlkZGxld2FyZSA9IChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xyXG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ1N0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHknLCAnbWF4LWFnZT0zMTUzNjAwMDsgaW5jbHVkZVN1YkRvbWFpbnMnKTtcclxuICAgICAgICBuZXh0KCk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBoc3RzTWlkZGxld2FyZShcclxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxyXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcclxuICAgICAgICBuZXh0RnVuY3Rpb25cclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc2V0SGVhZGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAnU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eScsXHJcbiAgICAgICAgJ21heC1hZ2U9MzE1MzYwMDA7IGluY2x1ZGVTdWJEb21haW5zJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ0lucHV0IFNhbml0aXphdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgdXNlciBpbnB1dCcsICgpID0+IHtcclxuICAgICAgY29uc3Qgc2FuaXRpemUgPSAoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0XHJcbiAgICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXHJcbiAgICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXHJcbiAgICAgICAgICAucmVwbGFjZSgvXCIvZywgJyZxdW90OycpXHJcbiAgICAgICAgICAucmVwbGFjZSgvJy9nLCAnJiN4Mjc7JylcclxuICAgICAgICAgIC5yZXBsYWNlKC9cXC8vZywgJyYjeDJGOycpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgbWFsaWNpb3VzSW5wdXQgPSAnPHNjcmlwdD5hbGVydChcIlhTU1wiKTwvc2NyaXB0Pic7XHJcbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplKG1hbGljaW91c0lucHV0KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChzYW5pdGl6ZWQpLm5vdC50b0NvbnRhaW4oJzxzY3JpcHQ+Jyk7XHJcbiAgICAgIGV4cGVjdChzYW5pdGl6ZWQpLnRvQ29udGFpbignJmx0O3NjcmlwdCZndDsnKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBTUUwgaW5qZWN0aW9uIGF0dGVtcHRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzYW5pdGl6ZVNRTCA9IChpbnB1dDogc3RyaW5nKTogc3RyaW5nID0+IHtcclxuICAgICAgICByZXR1cm4gaW5wdXQucmVwbGFjZSgvWydcIjtcXFxcXS9nLCAnJyk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBzcWxJbmplY3Rpb24gPSBcIic7IERST1AgVEFCTEUgdXNlcnM7IC0tXCI7XHJcbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU1FMKHNxbEluamVjdGlvbik7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKFwiJ1wiKTtcclxuICAgICAgZXhwZWN0KHNhbml0aXplZCkubm90LnRvQ29udGFpbignOycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ0NPUlMgQ29uZmlndXJhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYWxsb3dlZCBvcmlnaW5zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBhbGxvd2VkT3JpZ2lucyA9IFtcclxuICAgICAgICAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyxcclxuICAgICAgICAnaHR0cHM6Ly9hem9yYS53b3JsZCdcclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGlzT3JpZ2luQWxsb3dlZCA9IChvcmlnaW46IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgIHJldHVybiBhbGxvd2VkT3JpZ2lucy5pbmNsdWRlcyhvcmlnaW4pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGlzT3JpZ2luQWxsb3dlZCgnaHR0cDovL2xvY2FsaG9zdDozMDAwJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChpc09yaWdpbkFsbG93ZWQoJ2h0dHBzOi8vYXpvcmEud29ybGQnKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGlzT3JpZ2luQWxsb3dlZCgnaHR0cHM6Ly9tYWxpY2lvdXMuY29tJykpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIENPUlMgcHJlZmxpZ2h0IHJlcXVlc3RzJywgKCkgPT4ge1xyXG4gICAgICBtb2NrUmVxdWVzdC5tZXRob2QgPSAnT1BUSU9OUyc7XHJcbiAgICAgIG1vY2tSZXF1ZXN0LmhlYWRlcnMgPSB7XHJcbiAgICAgICAgJ2FjY2Vzcy1jb250cm9sLXJlcXVlc3QtbWV0aG9kJzogJ1BPU1QnLFxyXG4gICAgICAgICdhY2Nlc3MtY29udHJvbC1yZXF1ZXN0LWhlYWRlcnMnOiAnY29udGVudC10eXBlJ1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgY29yc01pZGRsZXdhcmUgPSAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IHtcclxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XHJcbiAgICAgICAgICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCwgUE9TVCwgUFVULCBERUxFVEUnKTtcclxuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnMnLCAnQ29udGVudC1UeXBlLCBBdXRob3JpemF0aW9uJyk7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDIwNCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5leHQoKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvcnNNaWRkbGV3YXJlKFxyXG4gICAgICAgIG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsXHJcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxyXG4gICAgICAgIG5leHRGdW5jdGlvblxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zZXRIZWFkZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJyxcclxuICAgICAgICAnR0VULCBQT1NULCBQVVQsIERFTEVURSdcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdSYXRlIExpbWl0aW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB0cmFjayByZXF1ZXN0IGNvdW50cycsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVxdWVzdENvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB0cmFja1JlcXVlc3QgPSAoaXA6IHN0cmluZyk6IG51bWJlciA9PiB7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSByZXF1ZXN0Q291bnRzLmdldChpcCkgfHwgMDtcclxuICAgICAgICByZXF1ZXN0Q291bnRzLnNldChpcCwgY291bnQgKyAxKTtcclxuICAgICAgICByZXR1cm4gY291bnQgKyAxO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHRyYWNrUmVxdWVzdCgnMTkyLjE2OC4xLjEnKSkudG9CZSgxKTtcclxuICAgICAgZXhwZWN0KHRyYWNrUmVxdWVzdCgnMTkyLjE2OC4xLjEnKSkudG9CZSgyKTtcclxuICAgICAgZXhwZWN0KHRyYWNrUmVxdWVzdCgnMTkyLjE2OC4xLjInKSkudG9CZSgxKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgcmF0ZSBsaW1pdHMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IE1BWF9SRVFVRVNUUyA9IDU7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3RDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaXNSYXRlTGltaXRlZCA9IChpcDogc3RyaW5nKTogYm9vbGVhbiA9PiB7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSByZXF1ZXN0Q291bnRzLmdldChpcCkgfHwgMDtcclxuICAgICAgICByZXR1cm4gY291bnQgPj0gTUFYX1JFUVVFU1RTO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNQVhfUkVRVUVTVFM7IGkrKykge1xyXG4gICAgICAgIHJlcXVlc3RDb3VudHMuc2V0KCcxOTIuMTY4LjEuMScsIGkgKyAxKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGlzUmF0ZUxpbWl0ZWQoJzE5Mi4xNjguMS4xJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChpc1JhdGVMaW1pdGVkKCcxOTIuMTY4LjEuMicpKS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdUb2tlbiBWYWxpZGF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB0b2tlbiBmb3JtYXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGlzVmFsaWRUb2tlbkZvcm1hdCA9ICh0b2tlbjogc3RyaW5nKTogYm9vbGVhbiA9PiB7XHJcbiAgICAgICAgcmV0dXJuIC9eW0EtWmEtejAtOS1fXStcXC5bQS1aYS16MC05LV9dK1xcLltBLVphLXowLTktX10rJC8udGVzdCh0b2tlbik7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaXNWYWxpZFRva2VuRm9ybWF0KCdoZWFkZXIucGF5bG9hZC5zaWduYXR1cmUnKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGlzVmFsaWRUb2tlbkZvcm1hdCgnaW52YWxpZC10b2tlbicpKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGlzVmFsaWRUb2tlbkZvcm1hdCgnJykpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdG9rZW4gZXhwaXJhdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3QgaXNUb2tlbkV4cGlyZWQgPSAoZXhwOiBudW1iZXIpOiBib29sZWFuID0+IHtcclxuICAgICAgICByZXR1cm4gZXhwIDwgRGF0ZS5ub3coKSAvIDEwMDA7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBmdXR1cmVUaW1lID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyAzNjAwO1xyXG4gICAgICBjb25zdCBwYXN0VGltZSA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gMzYwMDtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChpc1Rva2VuRXhwaXJlZChmdXR1cmVUaW1lKSkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChpc1Rva2VuRXhwaXJlZChwYXN0VGltZSkpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQUEsUUFBUSxDQUFDLDZCQUE2QixFQUFFLE1BQU07RUFDNUMsSUFBSUMsV0FBNkI7RUFDakMsSUFBSUMsWUFBK0I7RUFDbkMsSUFBSUMsWUFBMEI7RUFFOUJDLFVBQVUsQ0FBQyxNQUFNO0lBQ2ZILFdBQVcsR0FBRztNQUNaSSxPQUFPLEVBQUUsQ0FBQyxDQUFDO01BQ1hDLElBQUksRUFBRSxDQUFDLENBQUM7TUFDUkMsS0FBSyxFQUFFLENBQUM7SUFDVixDQUFDO0lBQ0RMLFlBQVksR0FBRztNQUNiTSxTQUFTLEVBQUVDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7TUFDcEJDLE1BQU0sRUFBRUYsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQyxDQUFDRSxjQUFjLENBQUMsQ0FBQztNQUNsQ0MsSUFBSSxFQUFFSixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDLENBQUNFLGNBQWMsQ0FBQztJQUNqQyxDQUFDO0lBQ0RULFlBQVksR0FBR00sSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztFQUMxQixDQUFDLENBQUM7RUFFRlYsUUFBUSxDQUFDLGtCQUFrQixFQUFFLE1BQU07SUFDakNjLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxNQUFNO01BQ3RD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