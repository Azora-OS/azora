{"version":3,"names":["cov_2pk8kjmgq4","actualCoverage","KnowledgeOceanRetriever","constructor","vectorDBClient","embeddingService","options","b","f","s","defaultTopK","topK","defaultMinScore","minScore","enforceSeventyThirty","retrieve","query","startTime","Date","now","queryEmbedding","embed","searchOptions","includeMetadata","documents","search","embedding","length","internalCount","externalCount","totalRelevanceScore","retrievalTime","finalDocuments","applySeventyThirtyRule","slice","filter","d","metadata","source","reduce","sum","doc","score","error","console","Error","message","targetCount","internalTarget","Math","ceil","externalTarget","floor","internal","external","selectedInternal","selectedExternal","combined","remaining","additionalInternal","push","additionalExternal","sort","a","getSeventyThirtyCompliance","total","internalPercentage","externalPercentage","isSeventyThirtyCompliant","tolerance","compliance","abs","retrieveWithFilter","exports"],"sources":["retriever.ts"],"sourcesContent":["/**\r\n * Knowledge Ocean Retriever\r\n * Implements document retrieval with 70/30 rule enforcement and relevance scoring\r\n */\r\n\r\nimport { VectorDBClient } from './vector-db-client';\r\nimport { DocumentEmbeddingService } from './embedding-service';\r\nimport { Document, RetrievalResult, SearchOptions } from './types';\r\n\r\nexport interface RetrieverOptions {\r\n  topK?: number;\r\n  minScore?: number;\r\n  enforceSeventyThirty?: boolean;\r\n  diversityWeight?: number;\r\n}\r\n\r\nexport interface SeventyThirtyResult {\r\n  documents: Document[];\r\n  internalCount: number;\r\n  externalCount: number;\r\n  internalPercentage: number;\r\n  externalPercentage: number;\r\n}\r\n\r\n/**\r\n * Knowledge Ocean Retriever\r\n * Handles document retrieval with 70/30 rule enforcement\r\n */\r\nexport class KnowledgeOceanRetriever {\r\n  private vectorDBClient: VectorDBClient;\r\n  private embeddingService: DocumentEmbeddingService;\r\n  private defaultTopK: number;\r\n  private defaultMinScore: number;\r\n  private enforceSeventyThirty: boolean;\r\n  constructor(\r\n    vectorDBClient: VectorDBClient,\r\n    embeddingService: DocumentEmbeddingService,\r\n    options: RetrieverOptions = {}\r\n  ) {\r\n    this.vectorDBClient = vectorDBClient;\r\n    this.embeddingService = embeddingService;\r\n    this.defaultTopK = options.topK || 10;\r\n    this.defaultMinScore = options.minScore || 0.7;\r\n    this.enforceSeventyThirty = options.enforceSeventyThirty !== false;\r\n  }\r\n\r\n  /**\r\n   * Retrieve documents for a query with 70/30 rule enforcement\r\n   */\r\n  public async retrieve(\r\n    query: string,\r\n    options: RetrieverOptions = {}\r\n  ): Promise<RetrievalResult> {\r\n    const startTime = Date.now();\r\n    const topK = options.topK || this.defaultTopK;\r\n    const minScore = options.minScore || this.defaultMinScore;\r\n\r\n    try {\r\n      // Generate embedding for query\r\n      const queryEmbedding = await this.embeddingService.embed(query);\r\n\r\n      // Search for similar documents\r\n      const searchOptions: SearchOptions = {\r\n        topK: topK * 2, // Fetch more to apply 70/30 rule\r\n        minScore,\r\n        includeMetadata: true\r\n      };\r\n\r\n      const documents = await this.vectorDBClient.search(\r\n        queryEmbedding.embedding,\r\n        searchOptions\r\n      );\r\n\r\n      if (documents.length === 0) {\r\n        return {\r\n          documents: [],\r\n          internalCount: 0,\r\n          externalCount: 0,\r\n          totalRelevanceScore: 0,\r\n          retrievalTime: Date.now() - startTime\r\n        };\r\n      }\r\n\r\n      // Apply 70/30 rule if enabled\r\n      let finalDocuments = documents;\r\n      if (this.enforceSeventyThirty) {\r\n        finalDocuments = this.applySeventyThirtyRule(documents, topK);\r\n      } else {\r\n        finalDocuments = documents.slice(0, topK);\r\n      }\r\n\r\n      // Calculate metrics\r\n      const internalCount = finalDocuments.filter(d => d.metadata.source === 'internal').length;\r\n      const externalCount = finalDocuments.filter(d => d.metadata.source === 'external').length;\r\n      const totalRelevanceScore = finalDocuments.reduce((sum, doc) => sum + (doc.score || 0), 0) / finalDocuments.length;\r\n\r\n      return {\r\n        documents: finalDocuments,\r\n        internalCount,\r\n        externalCount,\r\n        totalRelevanceScore,\r\n        retrievalTime: Date.now() - startTime\r\n      };\r\n    } catch (error) {\r\n      console.error('Retrieval failed:', error);\r\n      throw new Error(`Retrieval failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply 70/30 rule: 70% internal sources, 30% external sources\r\n   * Maintains relevance ordering while enforcing the ratio\r\n   */\r\n  private applySeventyThirtyRule(documents: Document[], targetCount: number): Document[] {\r\n    const internalTarget = Math.ceil(targetCount * 0.7);\r\n    const externalTarget = Math.floor(targetCount * 0.3);\r\n\r\n    const internal = documents.filter(d => d.metadata.source === 'internal');\r\n    const external = documents.filter(d => d.metadata.source === 'external');\r\n\r\n    // Take top documents from each source up to target\r\n    const selectedInternal = internal.slice(0, internalTarget);\r\n    const selectedExternal = external.slice(0, externalTarget);\r\n\r\n    // If we don't have enough of one type, fill with the other\r\n    const combined = [...selectedInternal, ...selectedExternal];\r\n    if (combined.length < targetCount) {\r\n      const remaining = targetCount - combined.length;\r\n      if (selectedInternal.length < internalTarget) {\r\n        const additionalInternal = internal.slice(internalTarget, internalTarget + remaining);\r\n        combined.push(...additionalInternal);\r\n      } else if (selectedExternal.length < externalTarget) {\r\n        const additionalExternal = external.slice(externalTarget, externalTarget + remaining);\r\n        combined.push(...additionalExternal);\r\n      }\r\n    }\r\n\r\n    // Sort by relevance score to maintain ordering\r\n    return combined\r\n      .sort((a, b) => (b.score || 0) - (a.score || 0))\r\n      .slice(0, targetCount);\r\n  }\r\n\r\n  /**\r\n   * Get 70/30 rule compliance for a set of documents\r\n   */\r\n  public getSeventyThirtyCompliance(documents: Document[]): SeventyThirtyResult {\r\n    const internalCount = documents.filter(d => d.metadata.source === 'internal').length;\r\n    const externalCount = documents.filter(d => d.metadata.source === 'external').length;\r\n    const total = internalCount + externalCount;\r\n\r\n    return {\r\n      documents,\r\n      internalCount,\r\n      externalCount,\r\n      internalPercentage: total > 0 ? (internalCount / total) * 100 : 0,\r\n      externalPercentage: total > 0 ? (externalCount / total) * 100 : 0\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if documents comply with 70/30 rule\r\n   */\r\n  public isSeventyThirtyCompliant(documents: Document[], tolerance: number = 5): boolean {\r\n    const compliance = this.getSeventyThirtyCompliance(documents);\r\n    const internalTarget = 70;\r\n    const externalTarget = 30;\r\n\r\n    return (\r\n      Math.abs(compliance.internalPercentage - internalTarget) <= tolerance &&\r\n      Math.abs(compliance.externalPercentage - externalTarget) <= tolerance\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Retrieve documents with custom filtering\r\n   */\r\n  public async retrieveWithFilter(\r\n    query: string,\r\n    filter: Record<string, any>,\r\n    options: RetrieverOptions = {}\r\n  ): Promise<RetrievalResult> {\r\n    const startTime = Date.now();\r\n    const topK = options.topK || this.defaultTopK;\r\n    const minScore = options.minScore || this.defaultMinScore;\r\n\r\n    try {\r\n      const queryEmbedding = await this.embeddingService.embed(query);\r\n\r\n      const searchOptions: SearchOptions = {\r\n        topK: topK * 2,\r\n        minScore,\r\n        filter,\r\n        includeMetadata: true\r\n      };\r\n\r\n      const documents = await this.vectorDBClient.search(\r\n        queryEmbedding.embedding,\r\n        searchOptions\r\n      );\r\n\r\n      if (documents.length === 0) {\r\n        return {\r\n          documents: [],\r\n          internalCount: 0,\r\n          externalCount: 0,\r\n          totalRelevanceScore: 0,\r\n          retrievalTime: Date.now() - startTime\r\n        };\r\n      }\r\n\r\n      let finalDocuments = documents;\r\n      if (this.enforceSeventyThirty) {\r\n        finalDocuments = this.applySeventyThirtyRule(documents, topK);\r\n      } else {\r\n        finalDocuments = documents.slice(0, topK);\r\n      }\r\n\r\n      const internalCount = finalDocuments.filter(d => d.metadata.source === 'internal').length;\r\n      const externalCount = finalDocuments.filter(d => d.metadata.source === 'external').length;\r\n      const totalRelevanceScore = finalDocuments.reduce((sum, doc) => sum + (doc.score || 0), 0) / finalDocuments.length;\r\n\r\n      return {\r\n        documents: finalDocuments,\r\n        internalCount,\r\n        externalCount,\r\n        totalRelevanceScore,\r\n        retrievalTime: Date.now() - startTime\r\n      };\r\n    } catch (error) {\r\n      console.error('Filtered retrieval failed:', error);\r\n      throw new Error(`Filtered retrieval failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}