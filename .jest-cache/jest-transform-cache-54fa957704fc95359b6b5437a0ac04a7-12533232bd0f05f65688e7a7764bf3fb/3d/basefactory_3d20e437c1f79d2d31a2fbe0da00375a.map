{"version":3,"names":["_faker","require","_database","BaseFactory","createdRecords","constructor","prisma","getTestPrismaClient","createMany","count","overrides","promises","Array","from","length","create","Promise","all","trackRecord","model","id","push","cleanup","record","reverse","delete","where","error","generateEmail","prefix","uniqueId","faker","string","alphanumeric","emailPrefix","internet","userName","generateUsername","usernamePrefix","generateDate","start","end","date","between","Date","to","generateText","sentences","lorem","generateNumber","min","max","number","int","pickRandom","items","helpers","arrayElement","generateBoolean","datatype","boolean","exports","FactoryRegistry","factories","Map","register","name","factory","set","get","cleanupAll","cleanupPromises","values","map","factoryRegistry"],"sources":["base.factory.ts"],"sourcesContent":["import { faker } from '@faker-js/faker';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { getTestPrismaClient } from '../utils/database';\r\n\r\n/**\r\n * Base factory class for creating test data\r\n */\r\nexport abstract class BaseFactory<T> {\r\n  protected prisma: PrismaClient;\r\n  protected createdRecords: Array<{ model: string; id: string }> = [];\r\n\r\n  constructor() {\r\n    this.prisma = getTestPrismaClient();\r\n  }\r\n\r\n  /**\r\n   * Create a single entity with optional overrides\r\n   */\r\n  abstract create(overrides?: Partial<T>): Promise<T>;\r\n\r\n  /**\r\n   * Create multiple entities\r\n   */\r\n  async createMany(count: number, overrides?: Partial<T>): Promise<T[]> {\r\n    const promises = Array.from({ length: count }, () => this.create(overrides));\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  /**\r\n   * Track created record for cleanup\r\n   */\r\n  protected trackRecord(model: string, id: string): void {\r\n    this.createdRecords.push({ model, id });\r\n  }\r\n\r\n  /**\r\n   * Clean up all created records\r\n   */\r\n  async cleanup(): Promise<void> {\r\n    // Delete in reverse order of creation\r\n    for (const record of this.createdRecords.reverse()) {\r\n      try {\r\n        const model = (this.prisma as any)[record.model];\r\n        if (model) {\r\n          await model.delete({ where: { id: record.id } });\r\n        }\r\n      } catch (error) {\r\n        // Record might already be deleted, ignore\r\n      }\r\n    }\r\n    this.createdRecords = [];\r\n  }\r\n\r\n  /**\r\n   * Generate a unique email\r\n   */\r\n  protected generateEmail(prefix?: string): string {\r\n    const uniqueId = faker.string.alphanumeric(8);\r\n    const emailPrefix = prefix || faker.internet.userName();\r\n    return `${emailPrefix}-${uniqueId}@test.azora.com`;\r\n  }\r\n\r\n  /**\r\n   * Generate a unique username\r\n   */\r\n  protected generateUsername(prefix?: string): string {\r\n    const uniqueId = faker.string.alphanumeric(6);\r\n    const usernamePrefix = prefix || faker.internet.userName();\r\n    return `${usernamePrefix}_${uniqueId}`;\r\n  }\r\n\r\n  /**\r\n   * Generate a random date within range\r\n   */\r\n  protected generateDate(start?: Date, end?: Date): Date {\r\n    return faker.date.between({\r\n      from: start || new Date(2020, 0, 1),\r\n      to: end || new Date(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Generate random text\r\n   */\r\n  protected generateText(sentences: number = 3): string {\r\n    return faker.lorem.sentences(sentences);\r\n  }\r\n\r\n  /**\r\n   * Generate random number within range\r\n   */\r\n  protected generateNumber(min: number = 0, max: number = 100): number {\r\n    return faker.number.int({ min, max });\r\n  }\r\n\r\n  /**\r\n   * Pick random item from array\r\n   */\r\n  protected pickRandom<T>(items: T[]): T {\r\n    return faker.helpers.arrayElement(items);\r\n  }\r\n\r\n  /**\r\n   * Generate random boolean\r\n   */\r\n  protected generateBoolean(): boolean {\r\n    return faker.datatype.boolean();\r\n  }\r\n}\r\n\r\n/**\r\n * Factory registry for managing multiple factories\r\n */\r\nexport class FactoryRegistry {\r\n  private factories: Map<string, BaseFactory<any>> = new Map();\r\n\r\n  /**\r\n   * Register a factory\r\n   */\r\n  register<T>(name: string, factory: BaseFactory<T>): void {\r\n    this.factories.set(name, factory);\r\n  }\r\n\r\n  /**\r\n   * Get a factory by name\r\n   */\r\n  get<T>(name: string): BaseFactory<T> | undefined {\r\n    return this.factories.get(name);\r\n  }\r\n\r\n  /**\r\n   * Clean up all registered factories\r\n   */\r\n  async cleanupAll(): Promise<void> {\r\n    const cleanupPromises = Array.from(this.factories.values()).map(factory =>\r\n      factory.cleanup()\r\n    );\r\n    await Promise.all(cleanupPromises);\r\n  }\r\n}\r\n\r\n// Global factory registry\r\nexport const factoryRegistry = new FactoryRegistry();\r\n"],"mappings":"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","ignoreList":[]}