{"version":3,"names":["request","require","app","describe","afterAll","done","it","response","get","expect","body","status","toBe","service","name","capabilities","toEqual","arrayContaining","success","Array","isArray","data","userData","username","email","password","post","send","token","toBeDefined","loginData","adminToken","testBookId","testCourseId","beforeAll","adminData","bookData","title","author","description","category","price","set","id","required","courseId","bookId","length","toBeGreaterThan","courseIds","toContain","aiLibrarian","delete","message"],"sources":["library.test.js"],"sourcesContent":["const request = require('supertest');\nconst app = require('../index.js');\n\ndescribe('Azora Library Service', () => {\n  // Close the server after all tests\n  afterAll((done) => {\n    // Close any open connections\n    done();\n  });\n\n  // Health check test\n  describe('GET /health', () => {\n    it('should return health status', async () => {\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body.status).toBe('OK');\n      expect(response.body.service).toBe('Azora Library');\n    });\n  });\n\n  // AI Librarian info test\n  describe('GET /ai-librarian', () => {\n    it('should return AI librarian information', async () => {\n      const response = await request(app)\n        .get('/ai-librarian')\n        .expect(200);\n\n      expect(response.body.name).toBe('Libra');\n      expect(response.body.capabilities).toEqual(\n        expect.arrayContaining(['search', 'recommend', 'summarize', 'categorize'])\n      );\n    });\n  });\n\n  // Get all books test\n  describe('GET /books', () => {\n    it('should return a list of books', async () => {\n      const response = await request(app)\n        .get('/books')\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(Array.isArray(response.body.data)).toBe(true);\n    });\n  });\n\n  // User registration test\n  describe('POST /users/register', () => {\n    it('should register a new user', async () => {\n      const userData = {\n        username: 'testuser',\n        email: 'test@example.com',\n        password: 'password123'\n      };\n\n      const response = await request(app)\n        .post('/users/register')\n        .send(userData)\n        .expect(201);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.username).toBe(userData.username);\n      expect(response.body.data.email).toBe(userData.email);\n      expect(response.body.token).toBeDefined();\n    });\n  });\n\n  // User login test\n  describe('POST /users/login', () => {\n    it('should login an existing user', async () => {\n      const loginData = {\n        email: 'test@example.com',\n        password: 'password123'\n      };\n\n      const response = await request(app)\n        .post('/users/login')\n        .send(loginData)\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.email).toBe(loginData.email);\n      expect(response.body.token).toBeDefined();\n    });\n  });\n\n  // Education system integration tests\n  describe('Education System Integration', () => {\n    let adminToken;\n    let testBookId;\n    const testCourseId = 'course-123';\n\n    // Register and login as admin for testing\n    beforeAll(async () => {\n      // Register admin user\n      const adminData = {\n        username: 'adminuser',\n        email: 'admin@example.com',\n        password: 'adminpassword123'\n      };\n\n      await request(app)\n        .post('/users/register')\n        .send(adminData);\n\n      // Login to get token\n      const response = await request(app)\n        .post('/users/login')\n        .send({\n          email: 'admin@example.com',\n          password: 'adminpassword123'\n        });\n\n      adminToken = response.body.token;\n    });\n\n    // Create a test book\n    beforeAll(async () => {\n      const bookData = {\n        title: 'Test Book for Education Integration',\n        author: 'Test Author',\n        description: 'A test book for education integration',\n        category: 'Education',\n        price: 0\n      };\n\n      const response = await request(app)\n        .post('/books')\n        .set('Authorization', `Bearer ${adminToken}`)\n        .send(bookData);\n\n      testBookId = response.body.data.id;\n    });\n\n    // Test assigning a book to a course\n    it('should assign a book to a course', async () => {\n      const response = await request(app)\n        .post(`/courses/${testCourseId}/books/${testBookId}`)\n        .set('Authorization', `Bearer ${adminToken}`)\n        .send({ required: true })\n        .expect(201);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.courseId).toBe(testCourseId);\n      expect(response.body.data.bookId).toBe(testBookId);\n      expect(response.body.data.required).toBe(true);\n    });\n\n    // Test getting books for a course\n    it('should get all books for a course', async () => {\n      const response = await request(app)\n        .get(`/courses/${testCourseId}/books`)\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(Array.isArray(response.body.data)).toBe(true);\n      expect(response.body.data.length).toBeGreaterThan(0);\n      expect(response.body.data[0].id).toBe(testBookId);\n    });\n\n    // Test getting courses for a book\n    it('should get all courses that use a specific book', async () => {\n      const response = await request(app)\n        .get(`/books/${testBookId}/courses`)\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.bookId).toBe(testBookId);\n      expect(Array.isArray(response.body.data.courseIds)).toBe(true);\n      expect(response.body.data.courseIds).toContain(testCourseId);\n    });\n\n    // Test student recommendations\n    it('should get book recommendations for a student', async () => {\n      const response = await request(app)\n        .get('/students/student-123/recommendations')\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(Array.isArray(response.body.data)).toBe(true);\n      expect(response.body.aiLibrarian).toBeDefined();\n    });\n\n    // Test removing a book from a course\n    it('should remove a book from a course', async () => {\n      const response = await request(app)\n        .delete(`/courses/${testCourseId}/books/${testBookId}`)\n        .set('Authorization', `Bearer ${adminToken}`)\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.message).toBe('Book removed from course successfully');\n    });\n  });\n});\n"],"mappings":"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","ignoreList":[]}