c9416880b87d1050aa2057f920f22e02
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
describe('Shared Utilities - Observability', () => {
  describe('Tracing', () => {
    it('should generate trace ID', () => {
      const generateTraceId = () => {
        return `trace-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      };
      const traceId = generateTraceId();
      expect(traceId).toMatch(/^trace-\d+-[a-z0-9]+$/);
    });
    it('should generate span ID', () => {
      const generateSpanId = () => {
        return Math.random().toString(36).substr(2, 16);
      };
      const spanId = generateSpanId();
      expect(spanId).toBeDefined();
      expect(spanId.length).toBeGreaterThan(0);
    });
    it('should attach trace context to request', () => {
      const mockRequest = {
        headers: {}
      };
      const tracingMiddleware = (req, res, next) => {
        req.traceId = `trace-${Date.now()}`;
        req.spanId = Math.random().toString(36).substr(2, 16);
        next();
      };
      const mockResponse = {};
      const nextFunction = jest.fn();
      tracingMiddleware(mockRequest, mockResponse, nextFunction);
      expect(mockRequest.traceId).toBeDefined();
      expect(mockRequest.spanId).toBeDefined();
      expect(nextFunction).toHaveBeenCalled();
    });
  });
  describe('Metrics', () => {
    it('should track request duration', () => {
      const startTime = Date.now();
      const endTime = startTime + 150;
      const duration = endTime - startTime;
      expect(duration).toBe(150);
    });
    it('should count requests by endpoint', () => {
      const requestCounts = new Map();
      const incrementCounter = endpoint => {
        const count = requestCounts.get(endpoint) || 0;
        requestCounts.set(endpoint, count + 1);
      };
      incrementCounter('/api/users');
      incrementCounter('/api/users');
      incrementCounter('/api/courses');
      expect(requestCounts.get('/api/users')).toBe(2);
      expect(requestCounts.get('/api/courses')).toBe(1);
    });
    it('should track error rates', () => {
      const metrics = {
        totalRequests: 0,
        errorRequests: 0
      };
      const recordRequest = isError => {
        metrics.totalRequests++;
        if (isError) metrics.errorRequests++;
      };
      const getErrorRate = () => {
        return metrics.totalRequests > 0 ? metrics.errorRequests / metrics.totalRequests * 100 : 0;
      };
      recordRequest(false);
      recordRequest(false);
      recordRequest(true);
      recordRequest(false);
      expect(getErrorRate()).toBe(25);
    });
  });
  describe('Health Checks', () => {
    it('should check service health', () => {
      const checkHealth = () => {
        return {
          status: 'healthy',
          timestamp: new Date().toISOString()
        };
      };
      const health = checkHealth();
      expect(health.status).toBe('healthy');
      expect(health.timestamp).toBeDefined();
    });
    it('should check dependency health', () => {
      const checkDependencies = () => {
        return {
          database: true,
          redis: true,
          externalAPI: false
        };
      };
      const dependencies = checkDependencies();
      expect(dependencies.database).toBe(true);
      expect(dependencies.redis).toBe(true);
      expect(dependencies.externalAPI).toBe(false);
    });
  });
  describe('Performance Monitoring', () => {
    it('should measure function execution time', async () => {
      const measureExecutionTime = async fn => {
        const start = Date.now();
        await fn();
        return Date.now() - start;
      };
      const testFunction = async () => {
        await new Promise(resolve => setTimeout(resolve, 10));
      };
      const duration = await measureExecutionTime(testFunction);
      expect(duration).toBeGreaterThanOrEqual(10);
    });
    it('should track slow queries', () => {
      const slowQueries = [];
      const SLOW_QUERY_THRESHOLD = 100;
      const recordQuery = (query, duration) => {
        if (duration > SLOW_QUERY_THRESHOLD) {
          slowQueries.push({
            query,
            duration
          });
        }
      };
      recordQuery('SELECT * FROM users', 50);
      recordQuery('SELECT * FROM large_table', 150);
      recordQuery('SELECT * FROM another_table', 200);
      expect(slowQueries.length).toBe(2);
      expect(slowQueries[0].duration).toBe(150);
    });
  });
  describe('Error Tracking', () => {
    it('should capture error details', () => {
      const captureError = (error, context) => {
        return {
          message: error.message,
          stack: error.stack,
          timestamp: new Date().toISOString(),
          ...context
        };
      };
      const error = new Error('Test error');
      const errorDetails = captureError(error, {
        userId: '123',
        endpoint: '/api/test'
      });
      expect(errorDetails.message).toBe('Test error');
      expect(errorDetails.stack).toBeDefined();
      expect(errorDetails.userId).toBe('123');
      expect(errorDetails.endpoint).toBe('/api/test');
    });
    it('should categorize errors', () => {
      const categorizeError = statusCode => {
        if (statusCode >= 500) return 'server_error';
        if (statusCode >= 400) return 'client_error';
        return 'unknown';
      };
      expect(categorizeError(500)).toBe('server_error');
      expect(categorizeError(404)).toBe('client_error');
      expect(categorizeError(200)).toBe('unknown');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwiZ2VuZXJhdGVUcmFjZUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInRyYWNlSWQiLCJleHBlY3QiLCJ0b01hdGNoIiwiZ2VuZXJhdGVTcGFuSWQiLCJzcGFuSWQiLCJ0b0JlRGVmaW5lZCIsImxlbmd0aCIsInRvQmVHcmVhdGVyVGhhbiIsIm1vY2tSZXF1ZXN0IiwiaGVhZGVycyIsInRyYWNpbmdNaWRkbGV3YXJlIiwicmVxIiwicmVzIiwibmV4dCIsIm1vY2tSZXNwb25zZSIsIm5leHRGdW5jdGlvbiIsImplc3QiLCJmbiIsInRvSGF2ZUJlZW5DYWxsZWQiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiZHVyYXRpb24iLCJ0b0JlIiwicmVxdWVzdENvdW50cyIsIk1hcCIsImluY3JlbWVudENvdW50ZXIiLCJlbmRwb2ludCIsImNvdW50IiwiZ2V0Iiwic2V0IiwibWV0cmljcyIsInRvdGFsUmVxdWVzdHMiLCJlcnJvclJlcXVlc3RzIiwicmVjb3JkUmVxdWVzdCIsImlzRXJyb3IiLCJnZXRFcnJvclJhdGUiLCJjaGVja0hlYWx0aCIsInN0YXR1cyIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwiaGVhbHRoIiwiY2hlY2tEZXBlbmRlbmNpZXMiLCJkYXRhYmFzZSIsInJlZGlzIiwiZXh0ZXJuYWxBUEkiLCJkZXBlbmRlbmNpZXMiLCJtZWFzdXJlRXhlY3V0aW9uVGltZSIsInN0YXJ0IiwidGVzdEZ1bmN0aW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwidG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCIsInNsb3dRdWVyaWVzIiwiU0xPV19RVUVSWV9USFJFU0hPTEQiLCJyZWNvcmRRdWVyeSIsInF1ZXJ5IiwicHVzaCIsImNhcHR1cmVFcnJvciIsImVycm9yIiwiY29udGV4dCIsIm1lc3NhZ2UiLCJzdGFjayIsIkVycm9yIiwiZXJyb3JEZXRhaWxzIiwidXNlcklkIiwiY2F0ZWdvcml6ZUVycm9yIiwic3RhdHVzQ29kZSJdLCJzb3VyY2VzIjpbIm9ic2VydmFiaWxpdHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XHJcblxyXG5kZXNjcmliZSgnU2hhcmVkIFV0aWxpdGllcyAtIE9ic2VydmFiaWxpdHknLCAoKSA9PiB7XHJcbiAgZGVzY3JpYmUoJ1RyYWNpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHRyYWNlIElEJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBnZW5lcmF0ZVRyYWNlSWQgPSAoKTogc3RyaW5nID0+IHtcclxuICAgICAgICByZXR1cm4gYHRyYWNlLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHRyYWNlSWQgPSBnZW5lcmF0ZVRyYWNlSWQoKTtcclxuICAgICAgZXhwZWN0KHRyYWNlSWQpLnRvTWF0Y2goL150cmFjZS1cXGQrLVthLXowLTldKyQvKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHNwYW4gSUQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGdlbmVyYXRlU3BhbklkID0gKCk6IHN0cmluZyA9PiB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCAxNik7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBzcGFuSWQgPSBnZW5lcmF0ZVNwYW5JZCgpO1xyXG4gICAgICBleHBlY3Qoc3BhbklkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3Qoc3BhbklkLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgYXR0YWNoIHRyYWNlIGNvbnRleHQgdG8gcmVxdWVzdCcsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1JlcXVlc3Q6IGFueSA9IHtcclxuICAgICAgICBoZWFkZXJzOiB7fVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgdHJhY2luZ01pZGRsZXdhcmUgPSAocmVxOiBhbnksIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xyXG4gICAgICAgIHJlcS50cmFjZUlkID0gYHRyYWNlLSR7RGF0ZS5ub3coKX1gO1xyXG4gICAgICAgIHJlcS5zcGFuSWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgMTYpO1xyXG4gICAgICAgIG5leHQoKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHt9IGFzIFJlc3BvbnNlO1xyXG4gICAgICBjb25zdCBuZXh0RnVuY3Rpb24gPSBqZXN0LmZuKCk7XHJcbiAgICAgIFxyXG4gICAgICB0cmFjaW5nTWlkZGxld2FyZShtb2NrUmVxdWVzdCwgbW9ja1Jlc3BvbnNlLCBuZXh0RnVuY3Rpb24pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0LnRyYWNlSWQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVxdWVzdC5zcGFuSWQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChuZXh0RnVuY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdNZXRyaWNzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB0cmFjayByZXF1ZXN0IGR1cmF0aW9uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgICBjb25zdCBlbmRUaW1lID0gc3RhcnRUaW1lICsgMTUwO1xyXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmUoMTUwKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGNvdW50IHJlcXVlc3RzIGJ5IGVuZHBvaW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXF1ZXN0Q291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGluY3JlbWVudENvdW50ZXIgPSAoZW5kcG9pbnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gcmVxdWVzdENvdW50cy5nZXQoZW5kcG9pbnQpIHx8IDA7XHJcbiAgICAgICAgcmVxdWVzdENvdW50cy5zZXQoZW5kcG9pbnQsIGNvdW50ICsgMSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBpbmNyZW1lbnRDb3VudGVyKCcvYXBpL3VzZXJzJyk7XHJcbiAgICAgIGluY3JlbWVudENvdW50ZXIoJy9hcGkvdXNlcnMnKTtcclxuICAgICAgaW5jcmVtZW50Q291bnRlcignL2FwaS9jb3Vyc2VzJyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVxdWVzdENvdW50cy5nZXQoJy9hcGkvdXNlcnMnKSkudG9CZSgyKTtcclxuICAgICAgZXhwZWN0KHJlcXVlc3RDb3VudHMuZ2V0KCcvYXBpL2NvdXJzZXMnKSkudG9CZSgxKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIHRyYWNrIGVycm9yIHJhdGVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtZXRyaWNzID0ge1xyXG4gICAgICAgIHRvdGFsUmVxdWVzdHM6IDAsXHJcbiAgICAgICAgZXJyb3JSZXF1ZXN0czogMFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVjb3JkUmVxdWVzdCA9IChpc0Vycm9yOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgbWV0cmljcy50b3RhbFJlcXVlc3RzKys7XHJcbiAgICAgICAgaWYgKGlzRXJyb3IpIG1ldHJpY3MuZXJyb3JSZXF1ZXN0cysrO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgZ2V0RXJyb3JSYXRlID0gKCk6IG51bWJlciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MudG90YWxSZXF1ZXN0cyA+IDBcclxuICAgICAgICAgID8gKG1ldHJpY3MuZXJyb3JSZXF1ZXN0cyAvIG1ldHJpY3MudG90YWxSZXF1ZXN0cykgKiAxMDBcclxuICAgICAgICAgIDogMDtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIHJlY29yZFJlcXVlc3QoZmFsc2UpO1xyXG4gICAgICByZWNvcmRSZXF1ZXN0KGZhbHNlKTtcclxuICAgICAgcmVjb3JkUmVxdWVzdCh0cnVlKTtcclxuICAgICAgcmVjb3JkUmVxdWVzdChmYWxzZSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoZ2V0RXJyb3JSYXRlKCkpLnRvQmUoMjUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgZGVzY3JpYmUoJ0hlYWx0aCBDaGVja3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNoZWNrIHNlcnZpY2UgaGVhbHRoJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjaGVja0hlYWx0aCA9ICgpOiB7IHN0YXR1czogc3RyaW5nOyB0aW1lc3RhbXA6IHN0cmluZyB9ID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3RhdHVzOiAnaGVhbHRoeScsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH07XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBoZWFsdGggPSBjaGVja0hlYWx0aCgpO1xyXG4gICAgICBleHBlY3QoaGVhbHRoLnN0YXR1cykudG9CZSgnaGVhbHRoeScpO1xyXG4gICAgICBleHBlY3QoaGVhbHRoLnRpbWVzdGFtcCkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnc2hvdWxkIGNoZWNrIGRlcGVuZGVuY3kgaGVhbHRoJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjaGVja0RlcGVuZGVuY2llcyA9ICgpOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPiA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGRhdGFiYXNlOiB0cnVlLFxyXG4gICAgICAgICAgcmVkaXM6IHRydWUsXHJcbiAgICAgICAgICBleHRlcm5hbEFQSTogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgZGVwZW5kZW5jaWVzID0gY2hlY2tEZXBlbmRlbmNpZXMoKTtcclxuICAgICAgZXhwZWN0KGRlcGVuZGVuY2llcy5kYXRhYmFzZSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGRlcGVuZGVuY2llcy5yZWRpcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGRlcGVuZGVuY2llcy5leHRlcm5hbEFQSSkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgTW9uaXRvcmluZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbWVhc3VyZSBmdW5jdGlvbiBleGVjdXRpb24gdGltZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWVhc3VyZUV4ZWN1dGlvblRpbWUgPSBhc3luYyAoZm46ICgpID0+IFByb21pc2U8dm9pZD4pOiBQcm9taXNlPG51bWJlcj4gPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBhd2FpdCBmbigpO1xyXG4gICAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gc3RhcnQ7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB0ZXN0RnVuY3Rpb24gPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IGF3YWl0IG1lYXN1cmVFeGVjdXRpb25UaW1lKHRlc3RGdW5jdGlvbik7XHJcbiAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxMCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBzbG93IHF1ZXJpZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNsb3dRdWVyaWVzOiBBcnJheTx7IHF1ZXJ5OiBzdHJpbmc7IGR1cmF0aW9uOiBudW1iZXIgfT4gPSBbXTtcclxuICAgICAgY29uc3QgU0xPV19RVUVSWV9USFJFU0hPTEQgPSAxMDA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZWNvcmRRdWVyeSA9IChxdWVyeTogc3RyaW5nLCBkdXJhdGlvbjogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgaWYgKGR1cmF0aW9uID4gU0xPV19RVUVSWV9USFJFU0hPTEQpIHtcclxuICAgICAgICAgIHNsb3dRdWVyaWVzLnB1c2goeyBxdWVyeSwgZHVyYXRpb24gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgcmVjb3JkUXVlcnkoJ1NFTEVDVCAqIEZST00gdXNlcnMnLCA1MCk7XHJcbiAgICAgIHJlY29yZFF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGxhcmdlX3RhYmxlJywgMTUwKTtcclxuICAgICAgcmVjb3JkUXVlcnkoJ1NFTEVDVCAqIEZST00gYW5vdGhlcl90YWJsZScsIDIwMCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3Qoc2xvd1F1ZXJpZXMubGVuZ3RoKS50b0JlKDIpO1xyXG4gICAgICBleHBlY3Qoc2xvd1F1ZXJpZXNbMF0uZHVyYXRpb24pLnRvQmUoMTUwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIFxyXG4gIGRlc2NyaWJlKCdFcnJvciBUcmFja2luZycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY2FwdHVyZSBlcnJvciBkZXRhaWxzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjYXB0dXJlRXJyb3IgPSAoZXJyb3I6IEVycm9yLCBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIC4uLmNvbnRleHRcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcclxuICAgICAgY29uc3QgZXJyb3JEZXRhaWxzID0gY2FwdHVyZUVycm9yKGVycm9yLCB7IHVzZXJJZDogJzEyMycsIGVuZHBvaW50OiAnL2FwaS90ZXN0JyB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChlcnJvckRldGFpbHMubWVzc2FnZSkudG9CZSgnVGVzdCBlcnJvcicpO1xyXG4gICAgICBleHBlY3QoZXJyb3JEZXRhaWxzLnN0YWNrKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoZXJyb3JEZXRhaWxzLnVzZXJJZCkudG9CZSgnMTIzJyk7XHJcbiAgICAgIGV4cGVjdChlcnJvckRldGFpbHMuZW5kcG9pbnQpLnRvQmUoJy9hcGkvdGVzdCcpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdzaG91bGQgY2F0ZWdvcml6ZSBlcnJvcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhdGVnb3JpemVFcnJvciA9IChzdGF0dXNDb2RlOiBudW1iZXIpOiBzdHJpbmcgPT4ge1xyXG4gICAgICAgIGlmIChzdGF0dXNDb2RlID49IDUwMCkgcmV0dXJuICdzZXJ2ZXJfZXJyb3InO1xyXG4gICAgICAgIGlmIChzdGF0dXNDb2RlID49IDQwMCkgcmV0dXJuICdjbGllbnRfZXJyb3InO1xyXG4gICAgICAgIHJldHVybiAndW5rbm93bic7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoY2F0ZWdvcml6ZUVycm9yKDUwMCkpLnRvQmUoJ3NlcnZlcl9lcnJvcicpO1xyXG4gICAgICBleHBlY3QoY2F0ZWdvcml6ZUVycm9yKDQwNCkpLnRvQmUoJ2NsaWVudF9lcnJvcicpO1xyXG4gICAgICBleHBlY3QoY2F0ZWdvcml6ZUVycm9yKDIwMCkpLnRvQmUoJ3Vua25vd24nKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiOzs7OztBQUVBQSxRQUFRLENBQUMsa0NBQWtDLEVBQUUsTUFBTTtFQUNqREEsUUFBUSxDQUFDLFNBQVMsRUFBRSxNQUFNO0lBQ3hCQyxFQUFFLENBQUMsMEJBQTBCLEVBQUUsTUFBTTtNQUNuQyxNQUFNQyxlQUFlLEdBQUdBLENBQUEsS0FBYztRQUNwQyxPQUFPLFNBQVNDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsSUFBSUMsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUNDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7TUFDekUsQ0FBQztNQUVELE1BQU1DLE9BQU8sR0FBR1AsZUFBZSxDQUFDLENBQUM7TUFDakNRLE1BQU0sQ0FBQ0QsT0FBTyxDQUFDLENBQUNFLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQztJQUNsRCxDQUFDLENBQUM7SUFFRlYsRUFBRSxDQUFDLHlCQUF5QixFQUFFLE1BQU07TUFDbEMsTUFBTVcsY0FBYyxHQUFHQSxDQUFBLEtBQWM7UUFDbkMsT0FBT1AsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENB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