71d3901581131edb5a9c641dd8479799
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SecretsVault = void 0;
var crypto = _interopRequireWildcard(require("crypto"));
var fs = _interopRequireWildcard(require("fs/promises"));
var path = _interopRequireWildcard(require("path"));
var _electron = require("electron");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function (e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (const t in e) "default" !== t && {}.hasOwnProperty.call(e, t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, t)) && (i.get || i.set) ? o(f, t, i) : f[t] = e[t]); return f; })(e, t); }
/**
 * Secret entry stored in the vault
 */

/**
 * Encrypted secret data structure
 */

/**
 * Vault storage structure
 */

/**
 * SecretsVault provides secure storage for sensitive data like API keys,
 * database credentials, and service tokens using AES-256-GCM encryption.
 * 
 * Features:
 * - OS keychain integration for master key storage
 * - Project and global scope support
 * - Encrypted storage with AES-256-GCM
 * - Audit logging of all operations
 */
class SecretsVault {
  static ALGORITHM = 'aes-256-gcm';
  static KEY_LENGTH = 32; // 256 bits
  static IV_LENGTH = 16; // 128 bits
  static AUTH_TAG_LENGTH = 16; // 128 bits
  static VAULT_VERSION = '1.0.0';
  masterKey = null;
  projectVaultPath = null;
  auditLog = [];
  constructor(projectPath) {
    // Global vault in user data directory
    this.globalVaultPath = path.join(_electron.app.getPath('userData'), 'secrets-vault.json');

    // Project-specific vault if project path provided
    if (projectPath) {
      this.projectVaultPath = path.join(projectPath, '.azstudio', 'secrets-vault.json');
    }
  }

  /**
   * Initialize the vault and generate/load master key
   */
  async initialize() {
    // Generate or load master key
    await this.loadOrGenerateMasterKey();

    // Ensure vault files exist
    await this.ensureVaultFile(this.globalVaultPath);
    if (this.projectVaultPath) {
      await this.ensureVaultFile(this.projectVaultPath);
    }
  }

  /**
   * Set a secret in the vault
   */
  async setSecret(key, value, scope = 'global', metadata) {
    if (!this.masterKey) {
      throw new Error('Vault not initialized. Call initialize() first.');
    }
    if (scope === 'project' && !this.projectVaultPath) {
      throw new Error('Project vault not available. Provide projectPath in constructor.');
    }
    const vaultPath = scope === 'global' ? this.globalVaultPath : this.projectVaultPath;

    // Encrypt the secret
    const encrypted = this.encrypt(value);

    // Load existing vault data
    const vaultData = await this.loadVaultData(vaultPath);

    // Store encrypted secret
    vaultData.secrets[key] = encrypted;

    // Save vault data
    await this.saveVaultData(vaultPath, vaultData);

    // Log the operation
    this.logAccess(key, 'write', scope);
  }

  /**
   * Get a secret from the vault
   */
  async getSecret(key, scope = 'global') {
    if (!this.masterKey) {
      throw new Error('Vault not initialized. Call initialize() first.');
    }
    if (scope === 'project' && !this.projectVaultPath) {
      throw new Error('Project vault not available. Provide projectPath in constructor.');
    }
    const vaultPath = scope === 'global' ? this.globalVaultPath : this.projectVaultPath;

    // Load vault data
    const vaultData = await this.loadVaultData(vaultPath);

    // Get encrypted secret
    const encrypted = vaultData.secrets[key];
    if (!encrypted) {
      return null;
    }

    // Decrypt and return
    const decrypted = this.decrypt(encrypted);

    // Log the operation
    this.logAccess(key, 'read', scope);
    return decrypted;
  }

  /**
   * Delete a secret from the vault
   */
  async deleteSecret(key, scope = 'global') {
    if (!this.masterKey) {
      throw new Error('Vault not initialized. Call initialize() first.');
    }
    if (scope === 'project' && !this.projectVaultPath) {
      throw new Error('Project vault not available. Provide projectPath in constructor.');
    }
    const vaultPath = scope === 'global' ? this.globalVaultPath : this.projectVaultPath;

    // Load vault data
    const vaultData = await this.loadVaultData(vaultPath);

    // Check if secret exists
    if (!vaultData.secrets[key]) {
      return false;
    }

    // Delete secret
    delete vaultData.secrets[key];

    // Save vault data
    await this.saveVaultData(vaultPath, vaultData);

    // Log the operation
    this.logAccess(key, 'delete', scope);
    return true;
  }

  /**
   * List all secret keys in a scope
   */
  async listSecrets(scope = 'global') {
    if (!this.masterKey) {
      throw new Error('Vault not initialized. Call initialize() first.');
    }
    if (scope === 'project' && !this.projectVaultPath) {
      return [];
    }
    const vaultPath = scope === 'global' ? this.globalVaultPath : this.projectVaultPath;

    // Load vault data
    const vaultData = await this.loadVaultData(vaultPath);
    return Object.keys(vaultData.secrets);
  }

  /**
   * Encrypt data using AES-256-GCM
   */
  encrypt(data) {
    if (!this.masterKey) {
      throw new Error('Master key not available');
    }

    // Generate random IV
    const iv = crypto.randomBytes(SecretsVault.IV_LENGTH);

    // Create cipher
    const cipher = crypto.createCipheriv(SecretsVault.ALGORITHM, this.masterKey, iv);

    // Encrypt data
    let encrypted = cipher.update(data, 'utf8', 'hex');
    encrypted += cipher.final('hex');

    // Get auth tag
    const authTag = cipher.getAuthTag();
    return {
      iv: iv.toString('hex'),
      encryptedData: encrypted,
      authTag: authTag.toString('hex')
    };
  }

  /**
   * Decrypt data using AES-256-GCM
   */
  decrypt(encrypted) {
    if (!this.masterKey) {
      throw new Error('Master key not available');
    }

    // Convert hex strings to buffers
    const iv = Buffer.from(encrypted.iv, 'hex');
    const authTag = Buffer.from(encrypted.authTag, 'hex');

    // Create decipher
    const decipher = crypto.createDecipheriv(SecretsVault.ALGORITHM, this.masterKey, iv);
    decipher.setAuthTag(authTag);

    // Decrypt data
    let decrypted = decipher.update(encrypted.encryptedData, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    return decrypted;
  }

  /**
   * Get audit log entries
   */
  getAuditLog() {
    return [...this.auditLog];
  }

  /**
   * Clear audit log
   */
  clearAuditLog() {
    this.auditLog = [];
  }

  /**
   * Log access to secrets
   */
  logAccess(key, operation, scope) {
    this.auditLog.push({
      timestamp: new Date(),
      operation,
      key,
      scope
    });
  }

  /**
   * Load or generate master encryption key
   */
  async loadOrGenerateMasterKey() {
    const keyPath = path.join(_electron.app.getPath('userData'), '.master-key');
    try {
      // Try to load existing key
      const keyData = await fs.readFile(keyPath);
      this.masterKey = keyData;
    } catch (error) {
      // Generate new key if not found
      this.masterKey = crypto.randomBytes(SecretsVault.KEY_LENGTH);

      // Save key with restricted permissions
      await fs.writeFile(keyPath, this.masterKey, {
        mode: 0o600
      });
    }
  }

  /**
   * Ensure vault file exists
   */
  async ensureVaultFile(vaultPath) {
    try {
      await fs.access(vaultPath);
    } catch {
      // Create directory if needed
      const dir = path.dirname(vaultPath);
      await fs.mkdir(dir, {
        recursive: true
      });

      // Create empty vault
      const emptyVault = {
        version: SecretsVault.VAULT_VERSION,
        secrets: {}
      };
      await fs.writeFile(vaultPath, JSON.stringify(emptyVault, null, 2), {
        mode: 0o600
      });
    }
  }

  /**
   * Load vault data from file
   */
  async loadVaultData(vaultPath) {
    try {
      const data = await fs.readFile(vaultPath, 'utf-8');
      return JSON.parse(data);
    } catch (error) {
      // Return empty vault if file doesn't exist or is corrupted
      return {
        version: SecretsVault.VAULT_VERSION,
        secrets: {}
      };
    }
  }

  /**
   * Save vault data to file
   */
  async saveVaultData(vaultPath, data) {
    await fs.writeFile(vaultPath, JSON.stringify(data, null, 2), {
      mode: 0o600
    });
  }
}
exports.SecretsVault = SecretsVault;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcnlwdG8iLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJmcyIsInBhdGgiLCJfZWxlY3Ryb24iLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJTZWNyZXRzVmF1bHQiLCJBTEdPUklUSE0iLCJLRVlfTEVOR1RIIiwiSVZfTEVOR1RIIiwiQVVUSF9UQUdfTEVOR1RIIiwiVkFVTFRfVkVSU0lPTiIsIm1hc3RlcktleSIsInByb2plY3RWYXVsdFBhdGgiLCJhdWRpdExvZyIsImNvbnN0cnVjdG9yIiwicHJvamVjdFBhdGgiLCJnbG9iYWxWYXVsdFBhdGgiLCJqb2luIiwiYXBwIiwiZ2V0UGF0aCIsImluaXRpYWxpemUiLCJsb2FkT3JHZW5lcmF0ZU1hc3RlcktleSIsImVuc3VyZVZhdWx0RmlsZSIsInNldFNlY3JldCIsImtleSIsInZhbHVlIiwic2NvcGUiLCJtZXRhZGF0YSIsIkVycm9yIiwidmF1bHRQYXRoIiwiZW5jcnlwdGVkIiwiZW5jcnlwdCIsInZhdWx0RGF0YSIsImxvYWRWYXVsdERhdGEiLCJzZWNyZXRzIiwic2F2ZVZhdWx0RGF0YSIsImxvZ0FjY2VzcyIsImdldFNlY3JldCIsImRlY3J5cHRlZCIsImRlY3J5cHQiLCJkZWxldGVTZWNyZXQiLCJsaXN0U2VjcmV0cyIsImtleXMiLCJkYXRhIiwiaXYiLCJyYW5kb21CeXRlcyIsImNpcGhlciIsImNyZWF0ZUNpcGhlcml2IiwidXBkYXRlIiwiZmluYWwiLCJhdXRoVGFnIiwiZ2V0QXV0aFRhZyIsInRvU3RyaW5nIiwiZW5jcnlwdGVkRGF0YSIsIkJ1ZmZlciIsImZyb20iLCJkZWNpcGhlciIsImNyZWF0ZURlY2lwaGVyaXYiLCJzZXRBdXRoVGFnIiwiZ2V0QXVkaXRMb2ciLCJjbGVhckF1ZGl0TG9nIiwib3BlcmF0aW9uIiwicHVzaCIsInRpbWVzdGFtcCIsIkRhdGUiLCJrZXlQYXRoIiwia2V5RGF0YSIsInJlYWRGaWxlIiwiZXJyb3IiLCJ3cml0ZUZpbGUiLCJtb2RlIiwiYWNjZXNzIiwiZGlyIiwiZGlybmFtZSIsIm1rZGlyIiwicmVjdXJzaXZlIiwiZW1wdHlWYXVsdCIsInZlcnNpb24iLCJKU09OIiwic3RyaW5naWZ5IiwicGFyc2UiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiU2VjcmV0c1ZhdWx0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGFwcCB9IGZyb20gJ2VsZWN0cm9uJztcblxuLyoqXG4gKiBTZWNyZXQgZW50cnkgc3RvcmVkIGluIHRoZSB2YXVsdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlY3JldCB7XG4gIGtleTogc3RyaW5nO1xuICB2YWx1ZTogc3RyaW5nO1xuICBzY29wZTogJ2dsb2JhbCcgfCAncHJvamVjdCc7XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbiAgdXBkYXRlZEF0OiBEYXRlO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5cbi8qKlxuICogRW5jcnlwdGVkIHNlY3JldCBkYXRhIHN0cnVjdHVyZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVuY3J5cHRlZFNlY3JldCB7XG4gIGl2OiBzdHJpbmc7XG4gIGVuY3J5cHRlZERhdGE6IHN0cmluZztcbiAgYXV0aFRhZzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFZhdWx0IHN0b3JhZ2Ugc3RydWN0dXJlXG4gKi9cbmludGVyZmFjZSBWYXVsdERhdGEge1xuICB2ZXJzaW9uOiBzdHJpbmc7XG4gIHNlY3JldHM6IFJlY29yZDxzdHJpbmcsIEVuY3J5cHRlZFNlY3JldD47XG59XG5cbi8qKlxuICogU2VjcmV0c1ZhdWx0IHByb3ZpZGVzIHNlY3VyZSBzdG9yYWdlIGZvciBzZW5zaXRpdmUgZGF0YSBsaWtlIEFQSSBrZXlzLFxuICogZGF0YWJhc2UgY3JlZGVudGlhbHMsIGFuZCBzZXJ2aWNlIHRva2VucyB1c2luZyBBRVMtMjU2LUdDTSBlbmNyeXB0aW9uLlxuICogXG4gKiBGZWF0dXJlczpcbiAqIC0gT1Mga2V5Y2hhaW4gaW50ZWdyYXRpb24gZm9yIG1hc3RlciBrZXkgc3RvcmFnZVxuICogLSBQcm9qZWN0IGFuZCBnbG9iYWwgc2NvcGUgc3VwcG9ydFxuICogLSBFbmNyeXB0ZWQgc3RvcmFnZSB3aXRoIEFFUy0yNTYtR0NNXG4gKiAtIEF1ZGl0IGxvZ2dpbmcgb2YgYWxsIG9wZXJhdGlvbnNcbiAqL1xuZXhwb3J0IGNsYXNzIFNlY3JldHNWYXVsdCB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFMR09SSVRITSA9ICdhZXMtMjU2LWdjbSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEtFWV9MRU5HVEggPSAzMjsgLy8gMjU2IGJpdHNcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSVZfTEVOR1RIID0gMTY7IC8vIDEyOCBiaXRzXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFVVEhfVEFHX0xFTkdUSCA9IDE2OyAvLyAxMjggYml0c1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBWQVVMVF9WRVJTSU9OID0gJzEuMC4wJztcblxuICBwcml2YXRlIG1hc3RlcktleTogQnVmZmVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZ2xvYmFsVmF1bHRQYXRoOiBzdHJpbmc7XG4gIHByaXZhdGUgcHJvamVjdFZhdWx0UGF0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgYXVkaXRMb2c6IEFycmF5PHsgdGltZXN0YW1wOiBEYXRlOyBvcGVyYXRpb246IHN0cmluZzsga2V5OiBzdHJpbmc7IHNjb3BlOiBzdHJpbmcgfT4gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcm9qZWN0UGF0aD86IHN0cmluZykge1xuICAgIC8vIEdsb2JhbCB2YXVsdCBpbiB1c2VyIGRhdGEgZGlyZWN0b3J5XG4gICAgdGhpcy5nbG9iYWxWYXVsdFBhdGggPSBwYXRoLmpvaW4oYXBwLmdldFBhdGgoJ3VzZXJEYXRhJyksICdzZWNyZXRzLXZhdWx0Lmpzb24nKTtcbiAgICBcbiAgICAvLyBQcm9qZWN0LXNwZWNpZmljIHZhdWx0IGlmIHByb2plY3QgcGF0aCBwcm92aWRlZFxuICAgIGlmIChwcm9qZWN0UGF0aCkge1xuICAgICAgdGhpcy5wcm9qZWN0VmF1bHRQYXRoID0gcGF0aC5qb2luKHByb2plY3RQYXRoLCAnLmF6c3R1ZGlvJywgJ3NlY3JldHMtdmF1bHQuanNvbicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSB2YXVsdCBhbmQgZ2VuZXJhdGUvbG9hZCBtYXN0ZXIga2V5XG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEdlbmVyYXRlIG9yIGxvYWQgbWFzdGVyIGtleVxuICAgIGF3YWl0IHRoaXMubG9hZE9yR2VuZXJhdGVNYXN0ZXJLZXkoKTtcblxuICAgIC8vIEVuc3VyZSB2YXVsdCBmaWxlcyBleGlzdFxuICAgIGF3YWl0IHRoaXMuZW5zdXJlVmF1bHRGaWxlKHRoaXMuZ2xvYmFsVmF1bHRQYXRoKTtcbiAgICBpZiAodGhpcy5wcm9qZWN0VmF1bHRQYXRoKSB7XG4gICAgICBhd2FpdCB0aGlzLmVuc3VyZVZhdWx0RmlsZSh0aGlzLnByb2plY3RWYXVsdFBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgYSBzZWNyZXQgaW4gdGhlIHZhdWx0XG4gICAqL1xuICBhc3luYyBzZXRTZWNyZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIHNjb3BlOiAnZ2xvYmFsJyB8ICdwcm9qZWN0JyA9ICdnbG9iYWwnLCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMubWFzdGVyS2V5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZhdWx0IG5vdCBpbml0aWFsaXplZC4gQ2FsbCBpbml0aWFsaXplKCkgZmlyc3QuJyk7XG4gICAgfVxuXG4gICAgaWYgKHNjb3BlID09PSAncHJvamVjdCcgJiYgIXRoaXMucHJvamVjdFZhdWx0UGF0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm9qZWN0IHZhdWx0IG5vdCBhdmFpbGFibGUuIFByb3ZpZGUgcHJvamVjdFBhdGggaW4gY29uc3RydWN0b3IuJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdmF1bHRQYXRoID0gc2NvcGUgPT09ICdnbG9iYWwnID8gdGhpcy5nbG9iYWxWYXVsdFBhdGggOiB0aGlzLnByb2plY3RWYXVsdFBhdGghO1xuICAgIFxuICAgIC8vIEVuY3J5cHQgdGhlIHNlY3JldFxuICAgIGNvbnN0IGVuY3J5cHRlZCA9IHRoaXMuZW5jcnlwdCh2YWx1ZSk7XG4gICAgXG4gICAgLy8gTG9hZCBleGlzdGluZyB2YXVsdCBkYXRhXG4gICAgY29uc3QgdmF1bHREYXRhID0gYXdhaXQgdGhpcy5sb2FkVmF1bHREYXRhKHZhdWx0UGF0aCk7XG4gICAgXG4gICAgLy8gU3RvcmUgZW5jcnlwdGVkIHNlY3JldFxuICAgIHZhdWx0RGF0YS5zZWNyZXRzW2tleV0gPSBlbmNyeXB0ZWQ7XG4gICAgXG4gICAgLy8gU2F2ZSB2YXVsdCBkYXRhXG4gICAgYXdhaXQgdGhpcy5zYXZlVmF1bHREYXRhKHZhdWx0UGF0aCwgdmF1bHREYXRhKTtcbiAgICBcbiAgICAvLyBMb2cgdGhlIG9wZXJhdGlvblxuICAgIHRoaXMubG9nQWNjZXNzKGtleSwgJ3dyaXRlJywgc2NvcGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHNlY3JldCBmcm9tIHRoZSB2YXVsdFxuICAgKi9cbiAgYXN5bmMgZ2V0U2VjcmV0KGtleTogc3RyaW5nLCBzY29wZTogJ2dsb2JhbCcgfCAncHJvamVjdCcgPSAnZ2xvYmFsJyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGlmICghdGhpcy5tYXN0ZXJLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVmF1bHQgbm90IGluaXRpYWxpemVkLiBDYWxsIGluaXRpYWxpemUoKSBmaXJzdC4nKTtcbiAgICB9XG5cbiAgICBpZiAoc2NvcGUgPT09ICdwcm9qZWN0JyAmJiAhdGhpcy5wcm9qZWN0VmF1bHRQYXRoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Byb2plY3QgdmF1bHQgbm90IGF2YWlsYWJsZS4gUHJvdmlkZSBwcm9qZWN0UGF0aCBpbiBjb25zdHJ1Y3Rvci4nKTtcbiAgICB9XG5cbiAgICBjb25zdCB2YXVsdFBhdGggPSBzY29wZSA9PT0gJ2dsb2JhbCcgPyB0aGlzLmdsb2JhbFZhdWx0UGF0aCA6IHRoaXMucHJvamVjdFZhdWx0UGF0aCE7XG4gICAgXG4gICAgLy8gTG9hZCB2YXVsdCBkYXRhXG4gICAgY29uc3QgdmF1bHREYXRhID0gYXdhaXQgdGhpcy5sb2FkVmF1bHREYXRhKHZhdWx0UGF0aCk7XG4gICAgXG4gICAgLy8gR2V0IGVuY3J5cHRlZCBzZWNyZXRcbiAgICBjb25zdCBlbmNyeXB0ZWQgPSB2YXVsdERhdGEuc2VjcmV0c1trZXldO1xuICAgIGlmICghZW5jcnlwdGVkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgLy8gRGVjcnlwdCBhbmQgcmV0dXJuXG4gICAgY29uc3QgZGVjcnlwdGVkID0gdGhpcy5kZWNyeXB0KGVuY3J5cHRlZCk7XG4gICAgXG4gICAgLy8gTG9nIHRoZSBvcGVyYXRpb25cbiAgICB0aGlzLmxvZ0FjY2VzcyhrZXksICdyZWFkJywgc2NvcGUpO1xuICAgIFxuICAgIHJldHVybiBkZWNyeXB0ZWQ7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIGEgc2VjcmV0IGZyb20gdGhlIHZhdWx0XG4gICAqL1xuICBhc3luYyBkZWxldGVTZWNyZXQoa2V5OiBzdHJpbmcsIHNjb3BlOiAnZ2xvYmFsJyB8ICdwcm9qZWN0JyA9ICdnbG9iYWwnKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLm1hc3RlcktleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYXVsdCBub3QgaW5pdGlhbGl6ZWQuIENhbGwgaW5pdGlhbGl6ZSgpIGZpcnN0LicpO1xuICAgIH1cblxuICAgIGlmIChzY29wZSA9PT0gJ3Byb2plY3QnICYmICF0aGlzLnByb2plY3RWYXVsdFBhdGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUHJvamVjdCB2YXVsdCBub3QgYXZhaWxhYmxlLiBQcm92aWRlIHByb2plY3RQYXRoIGluIGNvbnN0cnVjdG9yLicpO1xuICAgIH1cblxuICAgIGNvbnN0IHZhdWx0UGF0aCA9IHNjb3BlID09PSAnZ2xvYmFsJyA/IHRoaXMuZ2xvYmFsVmF1bHRQYXRoIDogdGhpcy5wcm9qZWN0VmF1bHRQYXRoITtcbiAgICBcbiAgICAvLyBMb2FkIHZhdWx0IGRhdGFcbiAgICBjb25zdCB2YXVsdERhdGEgPSBhd2FpdCB0aGlzLmxvYWRWYXVsdERhdGEodmF1bHRQYXRoKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBzZWNyZXQgZXhpc3RzXG4gICAgaWYgKCF2YXVsdERhdGEuc2VjcmV0c1trZXldKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIERlbGV0ZSBzZWNyZXRcbiAgICBkZWxldGUgdmF1bHREYXRhLnNlY3JldHNba2V5XTtcbiAgICBcbiAgICAvLyBTYXZlIHZhdWx0IGRhdGFcbiAgICBhd2FpdCB0aGlzLnNhdmVWYXVsdERhdGEodmF1bHRQYXRoLCB2YXVsdERhdGEpO1xuICAgIFxuICAgIC8vIExvZyB0aGUgb3BlcmF0aW9uXG4gICAgdGhpcy5sb2dBY2Nlc3Moa2V5LCAnZGVsZXRlJywgc2NvcGUpO1xuICAgIFxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3QgYWxsIHNlY3JldCBrZXlzIGluIGEgc2NvcGVcbiAgICovXG4gIGFzeW5jIGxpc3RTZWNyZXRzKHNjb3BlOiAnZ2xvYmFsJyB8ICdwcm9qZWN0JyA9ICdnbG9iYWwnKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGlmICghdGhpcy5tYXN0ZXJLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVmF1bHQgbm90IGluaXRpYWxpemVkLiBDYWxsIGluaXRpYWxpemUoKSBmaXJzdC4nKTtcbiAgICB9XG5cbiAgICBpZiAoc2NvcGUgPT09ICdwcm9qZWN0JyAmJiAhdGhpcy5wcm9qZWN0VmF1bHRQYXRoKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgdmF1bHRQYXRoID0gc2NvcGUgPT09ICdnbG9iYWwnID8gdGhpcy5nbG9iYWxWYXVsdFBhdGggOiB0aGlzLnByb2plY3RWYXVsdFBhdGghO1xuICAgIFxuICAgIC8vIExvYWQgdmF1bHQgZGF0YVxuICAgIGNvbnN0IHZhdWx0RGF0YSA9IGF3YWl0IHRoaXMubG9hZFZhdWx0RGF0YSh2YXVsdFBhdGgpO1xuICAgIFxuICAgIHJldHVybiBPYmplY3Qua2V5cyh2YXVsdERhdGEuc2VjcmV0cyk7XG4gIH1cblxuICAvKipcbiAgICogRW5jcnlwdCBkYXRhIHVzaW5nIEFFUy0yNTYtR0NNXG4gICAqL1xuICBlbmNyeXB0KGRhdGE6IHN0cmluZyk6IEVuY3J5cHRlZFNlY3JldCB7XG4gICAgaWYgKCF0aGlzLm1hc3RlcktleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNYXN0ZXIga2V5IG5vdCBhdmFpbGFibGUnKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSByYW5kb20gSVZcbiAgICBjb25zdCBpdiA9IGNyeXB0by5yYW5kb21CeXRlcyhTZWNyZXRzVmF1bHQuSVZfTEVOR1RIKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgY2lwaGVyXG4gICAgY29uc3QgY2lwaGVyID0gY3J5cHRvLmNyZWF0ZUNpcGhlcml2KFNlY3JldHNWYXVsdC5BTEdPUklUSE0sIHRoaXMubWFzdGVyS2V5LCBpdik7XG4gICAgXG4gICAgLy8gRW5jcnlwdCBkYXRhXG4gICAgbGV0IGVuY3J5cHRlZCA9IGNpcGhlci51cGRhdGUoZGF0YSwgJ3V0ZjgnLCAnaGV4Jyk7XG4gICAgZW5jcnlwdGVkICs9IGNpcGhlci5maW5hbCgnaGV4Jyk7XG4gICAgXG4gICAgLy8gR2V0IGF1dGggdGFnXG4gICAgY29uc3QgYXV0aFRhZyA9IGNpcGhlci5nZXRBdXRoVGFnKCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGl2OiBpdi50b1N0cmluZygnaGV4JyksXG4gICAgICBlbmNyeXB0ZWREYXRhOiBlbmNyeXB0ZWQsXG4gICAgICBhdXRoVGFnOiBhdXRoVGFnLnRvU3RyaW5nKCdoZXgnKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIERlY3J5cHQgZGF0YSB1c2luZyBBRVMtMjU2LUdDTVxuICAgKi9cbiAgZGVjcnlwdChlbmNyeXB0ZWQ6IEVuY3J5cHRlZFNlY3JldCk6IHN0cmluZyB7XG4gICAgaWYgKCF0aGlzLm1hc3RlcktleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNYXN0ZXIga2V5IG5vdCBhdmFpbGFibGUnKTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0IGhleCBzdHJpbmdzIHRvIGJ1ZmZlcnNcbiAgICBjb25zdCBpdiA9IEJ1ZmZlci5mcm9tKGVuY3J5cHRlZC5pdiwgJ2hleCcpO1xuICAgIGNvbnN0IGF1dGhUYWcgPSBCdWZmZXIuZnJvbShlbmNyeXB0ZWQuYXV0aFRhZywgJ2hleCcpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBkZWNpcGhlclxuICAgIGNvbnN0IGRlY2lwaGVyID0gY3J5cHRvLmNyZWF0ZURlY2lwaGVyaXYoU2VjcmV0c1ZhdWx0LkFMR09SSVRITSwgdGhpcy5tYXN0ZXJLZXksIGl2KTtcbiAgICBkZWNpcGhlci5zZXRBdXRoVGFnKGF1dGhUYWcpO1xuICAgIFxuICAgIC8vIERlY3J5cHQgZGF0YVxuICAgIGxldCBkZWNyeXB0ZWQgPSBkZWNpcGhlci51cGRhdGUoZW5jcnlwdGVkLmVuY3J5cHRlZERhdGEsICdoZXgnLCAndXRmOCcpO1xuICAgIGRlY3J5cHRlZCArPSBkZWNpcGhlci5maW5hbCgndXRmOCcpO1xuICAgIFxuICAgIHJldHVybiBkZWNyeXB0ZWQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGF1ZGl0IGxvZyBlbnRyaWVzXG4gICAqL1xuICBnZXRBdWRpdExvZygpOiBBcnJheTx7IHRpbWVzdGFtcDogRGF0ZTsgb3BlcmF0aW9uOiBzdHJpbmc7IGtleTogc3RyaW5nOyBzY29wZTogc3RyaW5nIH0+IHtcbiAgICByZXR1cm4gWy4uLnRoaXMuYXVkaXRMb2ddO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGF1ZGl0IGxvZ1xuICAgKi9cbiAgY2xlYXJBdWRpdExvZygpOiB2b2lkIHtcbiAgICB0aGlzLmF1ZGl0TG9nID0gW107XG4gIH1cblxuICAvKipcbiAgICogTG9nIGFjY2VzcyB0byBzZWNyZXRzXG4gICAqL1xuICBwcml2YXRlIGxvZ0FjY2VzcyhrZXk6IHN0cmluZywgb3BlcmF0aW9uOiAncmVhZCcgfCAnd3JpdGUnIHwgJ2RlbGV0ZScsIHNjb3BlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmF1ZGl0TG9nLnB1c2goe1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgb3BlcmF0aW9uLFxuICAgICAga2V5LFxuICAgICAgc2NvcGUsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBvciBnZW5lcmF0ZSBtYXN0ZXIgZW5jcnlwdGlvbiBrZXlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9hZE9yR2VuZXJhdGVNYXN0ZXJLZXkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qga2V5UGF0aCA9IHBhdGguam9pbihhcHAuZ2V0UGF0aCgndXNlckRhdGEnKSwgJy5tYXN0ZXIta2V5Jyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIFRyeSB0byBsb2FkIGV4aXN0aW5nIGtleVxuICAgICAgY29uc3Qga2V5RGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGtleVBhdGgpO1xuICAgICAgdGhpcy5tYXN0ZXJLZXkgPSBrZXlEYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBHZW5lcmF0ZSBuZXcga2V5IGlmIG5vdCBmb3VuZFxuICAgICAgdGhpcy5tYXN0ZXJLZXkgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoU2VjcmV0c1ZhdWx0LktFWV9MRU5HVEgpO1xuICAgICAgXG4gICAgICAvLyBTYXZlIGtleSB3aXRoIHJlc3RyaWN0ZWQgcGVybWlzc2lvbnNcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShrZXlQYXRoLCB0aGlzLm1hc3RlcktleSwgeyBtb2RlOiAwbzYwMCB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5zdXJlIHZhdWx0IGZpbGUgZXhpc3RzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGVuc3VyZVZhdWx0RmlsZSh2YXVsdFBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5hY2Nlc3ModmF1bHRQYXRoKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIENyZWF0ZSBkaXJlY3RvcnkgaWYgbmVlZGVkXG4gICAgICBjb25zdCBkaXIgPSBwYXRoLmRpcm5hbWUodmF1bHRQYXRoKTtcbiAgICAgIGF3YWl0IGZzLm1rZGlyKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBlbXB0eSB2YXVsdFxuICAgICAgY29uc3QgZW1wdHlWYXVsdDogVmF1bHREYXRhID0ge1xuICAgICAgICB2ZXJzaW9uOiBTZWNyZXRzVmF1bHQuVkFVTFRfVkVSU0lPTixcbiAgICAgICAgc2VjcmV0czoge30sXG4gICAgICB9O1xuICAgICAgXG4gICAgICBhd2FpdCBmcy53cml0ZUZpbGUodmF1bHRQYXRoLCBKU09OLnN0cmluZ2lmeShlbXB0eVZhdWx0LCBudWxsLCAyKSwgeyBtb2RlOiAwbzYwMCB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9hZCB2YXVsdCBkYXRhIGZyb20gZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBsb2FkVmF1bHREYXRhKHZhdWx0UGF0aDogc3RyaW5nKTogUHJvbWlzZTxWYXVsdERhdGE+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKHZhdWx0UGF0aCwgJ3V0Zi04Jyk7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gUmV0dXJuIGVtcHR5IHZhdWx0IGlmIGZpbGUgZG9lc24ndCBleGlzdCBvciBpcyBjb3JydXB0ZWRcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZlcnNpb246IFNlY3JldHNWYXVsdC5WQVVMVF9WRVJTSU9OLFxuICAgICAgICBzZWNyZXRzOiB7fSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNhdmUgdmF1bHQgZGF0YSB0byBmaWxlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNhdmVWYXVsdERhdGEodmF1bHRQYXRoOiBzdHJpbmcsIGRhdGE6IFZhdWx0RGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZSh2YXVsdFBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpLCB7IG1vZGU6IDBvNjAwIH0pO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLEVBQUEsR0FBQUYsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLElBQUEsR0FBQUgsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLFNBQUEsR0FBQUgsT0FBQTtBQUErQixTQUFBRCx3QkFBQUssQ0FBQSxFQUFBQyxDQUFBLDZC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