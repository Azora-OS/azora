e118db135120e4b7884cd15586f738f4
"use strict";

const {
  generateAccessToken,
  generateRefreshToken,
  verifyToken,
  revokeToken
} = require('../src/middleware/jwt');
describe('JWT Implementation', () => {
  describe('Token Generation', () => {
    test('should generate access token with RS256', () => {
      const payload = {
        userId: 1,
        email: 'test@azora.world',
        role: 'student'
      };
      const token = generateAccessToken(payload);
      expect(token).toBeDefined();
      expect(typeof token).toBe('string');
      expect(token.split('.').length).toBe(3);
    });
    test('should generate refresh token', () => {
      const payload = {
        userId: 1
      };
      const token = generateRefreshToken(payload);
      expect(token).toBeDefined();
      expect(typeof token).toBe('string');
    });
  });
  describe('Token Verification', () => {
    test('should verify valid token', () => {
      const payload = {
        userId: 1,
        email: 'test@azora.world',
        role: 'student'
      };
      const token = generateAccessToken(payload);
      const decoded = verifyToken(token);
      expect(decoded.userId).toBe(1);
      expect(decoded.email).toBe('test@azora.world');
      expect(decoded.role).toBe('student');
    });
    test('should reject revoked token', () => {
      const payload = {
        userId: 1,
        email: 'test@azora.world'
      };
      const token = generateAccessToken(payload);
      revokeToken(token);
      expect(() => verifyToken(token)).toThrow('Token has been revoked');
    });
  });
  describe('Token Expiry', () => {
    test('access token should expire in 1 hour', () => {
      const payload = {
        userId: 1
      };
      const token = generateAccessToken(payload);
      const decoded = verifyToken(token);
      const expiryTime = decoded.exp - decoded.iat;
      expect(expiryTime).toBe(3600); // 1 hour in seconds
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0ZUFjY2Vzc1Rva2VuIiwiZ2VuZXJhdGVSZWZyZXNoVG9rZW4iLCJ2ZXJpZnlUb2tlbiIsInJldm9rZVRva2VuIiwicmVxdWlyZSIsImRlc2NyaWJlIiwidGVzdCIsInBheWxvYWQiLCJ1c2VySWQiLCJlbWFpbCIsInJvbGUiLCJ0b2tlbiIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwidG9CZSIsInNwbGl0IiwibGVuZ3RoIiwiZGVjb2RlZCIsInRvVGhyb3ciLCJleHBpcnlUaW1lIiwiZXhwIiwiaWF0Il0sInNvdXJjZXMiOlsiand0LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBnZW5lcmF0ZUFjY2Vzc1Rva2VuLCBnZW5lcmF0ZVJlZnJlc2hUb2tlbiwgdmVyaWZ5VG9rZW4sIHJldm9rZVRva2VuIH0gPSByZXF1aXJlKCcuLi9zcmMvbWlkZGxld2FyZS9qd3QnKTtcblxuZGVzY3JpYmUoJ0pXVCBJbXBsZW1lbnRhdGlvbicsICgpID0+IHtcbiAgZGVzY3JpYmUoJ1Rva2VuIEdlbmVyYXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGdlbmVyYXRlIGFjY2VzcyB0b2tlbiB3aXRoIFJTMjU2JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgdXNlcklkOiAxLCBlbWFpbDogJ3Rlc3RAYXpvcmEud29ybGQnLCByb2xlOiAnc3R1ZGVudCcgfTtcbiAgICAgIGNvbnN0IHRva2VuID0gZ2VuZXJhdGVBY2Nlc3NUb2tlbihwYXlsb2FkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHRva2VuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB0b2tlbikudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QodG9rZW4uc3BsaXQoJy4nKS5sZW5ndGgpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZ2VuZXJhdGUgcmVmcmVzaCB0b2tlbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IHVzZXJJZDogMSB9O1xuICAgICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVJlZnJlc2hUb2tlbihwYXlsb2FkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHRva2VuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB0b2tlbikudG9CZSgnc3RyaW5nJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdUb2tlbiBWZXJpZmljYXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHZlcmlmeSB2YWxpZCB0b2tlbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IHVzZXJJZDogMSwgZW1haWw6ICd0ZXN0QGF6b3JhLndvcmxkJywgcm9sZTogJ3N0dWRlbnQnIH07XG4gICAgICBjb25zdCB0b2tlbiA9IGdlbmVyYXRlQWNjZXNzVG9rZW4ocGF5bG9hZCk7XG4gICAgICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5VG9rZW4odG9rZW4pO1xuICAgICAgXG4gICAgICBleHBlY3QoZGVjb2RlZC51c2VySWQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoZGVjb2RlZC5lbWFpbCkudG9CZSgndGVzdEBhem9yYS53b3JsZCcpO1xuICAgICAgZXhwZWN0KGRlY29kZWQucm9sZSkudG9CZSgnc3R1ZGVudCcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJlamVjdCByZXZva2VkIHRva2VuJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgdXNlcklkOiAxLCBlbWFpbDogJ3Rlc3RAYXpvcmEud29ybGQnIH07XG4gICAgICBjb25zdCB0b2tlbiA9IGdlbmVyYXRlQWNjZXNzVG9rZW4ocGF5bG9hZCk7XG4gICAgICBcbiAgICAgIHJldm9rZVRva2VuKHRva2VuKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KCgpID0+IHZlcmlmeVRva2VuKHRva2VuKSkudG9UaHJvdygnVG9rZW4gaGFzIGJlZW4gcmV2b2tlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVG9rZW4gRXhwaXJ5JywgKCkgPT4ge1xuICAgIHRlc3QoJ2FjY2VzcyB0b2tlbiBzaG91bGQgZXhwaXJlIGluIDEgaG91cicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IHVzZXJJZDogMSB9O1xuICAgICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZUFjY2Vzc1Rva2VuKHBheWxvYWQpO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IHZlcmlmeVRva2VuKHRva2VuKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhwaXJ5VGltZSA9IGRlY29kZWQuZXhwIC0gZGVjb2RlZC5pYXQ7XG4gICAgICBleHBlY3QoZXhwaXJ5VGltZSkudG9CZSgzNjAwKTsgLy8gMSBob3VyIGluIHNlY29uZHNcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNO0VBQUVBLG1CQUFtQjtFQUFFQyxvQkFBb0I7RUFBRUMsV0FBVztFQUFFQztBQUFZLENBQUMsR0FBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBRWhIQyxRQUFRLENBQUMsb0JBQW9CLEVBQUUsTUFBTTtFQUNuQ0EsUUFBUSxDQUFDLGtCQUFrQixFQUFFLE1BQU07SUFDakNDLElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxNQUFNO01BQ3BELE1BQU1DLE9BQU8sR0FBRztRQUFFQyxNQUFNLEVBQUUsQ0FBQztRQUFFQyxLQUFLLEVBQUUsa0JBQWtCO1FBQUVDLElBQUksRUFBRTtNQUFVLENBQUM7TUFDekUsTUFBTUMsS0FBSyxHQUFHWCxtQkFBbUIsQ0FBQ08sT0FBTyxDQUFDO01BRTFDSyxNQUFNLENBQUNELEtBQUssQ0FBQyxDQUFDRSxXQUFXLENBQUMsQ0FBQztNQUMzQkQsTUFBTSxDQUFDLE9BQU9ELEtBQUssQ0FBQyxDQUFDRyxJQUFJLENBQUMsUUFBUSxDQUFDO01BQ25DRixNQUFNLENBQUNELEtBQUssQ0FBQ0ksS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxNQUFNLENBQUMsQ0FBQ0YsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUM7SUFFRlIsSUFBSSxDQUFDLCtCQUErQixFQUFFLE1BQU07TUFDMUMsTUFBTUMsT0FBTyxHQUFHO1FBQUVDLE1BQU0sRUFBRTtNQUFFLENBQUM7TUFDN0IsTUFBTUcsS0FBSyxHQUFHVixvQkFBb0IsQ0FBQ00sT0FBTyxDQUFDO01BRTNDSyxNQUFNLENBQUNELEtBQUssQ0FBQyxDQUFDRSxXQUFXLENBQUMsQ0FBQztNQUMzQkQsTUFBTSxDQUFDLE9BQU9ELEtBQUssQ0FBQyxDQUFDRyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3JDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztFQUVGVCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsTUFBTTtJQUNuQ0MsSUFBSSxDQUFDLDJCQUEyQixFQUFFLE1BQU07TUFDdEMsTUFBTUMsT0FBTyxHQUFHO1FBQUVDLE1BQU0sRUFBRSxDQUFDO1FBQUVDLEtBQUssRUFBRSxrQkFBa0I7UUFBRUMsSUFBSSxFQUFFO01BQVUsQ0FBQztNQUN6RSxNQUFNQyxLQUFLLEdBQUdYLG1CQUFtQixDQUFDTyxPQUFPLENBQUM7TUFDMUMsTUFBTVUsT0FBTyxHQUFHZixXQUFXLENBQUNTLEtBQUssQ0FBQztNQUVsQ0MsTUFBTSxDQUFDSyxPQUFPLENBQUNULE1BQU0sQ0FBQyxDQUFDTSxJQUFJLENBQUMsQ0FBQyxDQUFDO01BQzlCRixNQUFNLENBQUNLLE9BQU8sQ0FBQ1IsS0FBSyxDQUFDLENBQUNLLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztNQUM5Q0YsTUFBTSxDQUFDSyxPQUFPLENBQUNQLElBQUksQ0FBQyxDQUFDSSxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3RDLENBQUMsQ0FBQztJQUVGUixJQUFJLENBQUMsNkJBQTZCLEVBQUUsTUFBTTtNQUN4QyxNQUFNQyxPQUFPLEdBQUc7UUFBRUMsTUFBTSxFQUFFLENBQUM7UUFBRUMsS0FBSyxFQUFFO01BQW1CLENBQUM7TUFDeEQsTUFBTUUsS0FBSyxHQUFHWCxtQkFBbUIsQ0FBQ08sT0FBTyxDQUFDO01BRTFDSixXQUFXLENBQUNRLEtBQUssQ0FBQztNQUVsQkMsTUFBTSxDQUFDLE1BQU1WLFdBQVcsQ0FBQ1MsS0FBSyxDQUFDLENBQUMsQ0FBQ08sT0FBTyxDQUFDLHdCQUF3QixDQUFDO0lBQ3BFLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztFQUVGYixRQUFRLENBQUMsY0FBYyxFQUFFLE1BQU07SUFDN0JDLElBQUksQ0FBQyxzQ0FBc0MsRUFBRSxNQUFNO01BQ2pELE1BQU1DLE9BQU8sR0FBRztRQUFFQyxNQUFNLEVBQUU7TUFBRSxDQUFDO01BQzdCLE1BQU1HLEtBQUssR0FBR1gsbUJBQW1CLENBQUNPLE9BQU8sQ0FBQztNQUMxQyxNQUFNVSxPQUFPLEdBQUdmLFdBQVcsQ0FBQ1MsS0FBSyxDQUFDO01BRWxDLE1BQU1RLFVBQVUsR0FBR0YsT0FBTyxDQUFDRyxHQUFHLEdBQUdILE9BQU8sQ0FBQ0ksR0FBRztNQUM1Q1QsTUFBTSxDQUFDTyxVQUFVLENBQUMsQ0FBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDakMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119