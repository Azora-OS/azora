{"version":3,"names":["cov_29lptg3v8","actualCoverage","PrismaClient","logger","prisma","s","TeacherPaymentService","calculateRevenue","instructorId","period","f","courses","course","findMany","where","courseIds","map","c","id","payments","payment","courseId","in","status","totalRevenue","reduce","sum","p","Number","amount","azoraCut","instructorCut","info","paymentCount","length","error","processWithdrawal","success","message","getPaymentHistory","orderBy","createdAt","teacherPaymentService"],"sources":["teacher-payment.service.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { logger } from '../utils/logger';\n\nconst prisma = new PrismaClient();\n\nexport class TeacherPaymentService {\n  async calculateRevenue(instructorId: string, period: string) {\n    try {\n      const courses = await prisma.course.findMany({ where: { instructorId } });\n      const courseIds = courses.map(c => c.id);\n\n      const payments = await prisma.payment.findMany({\n        where: { courseId: { in: courseIds }, status: 'completed' },\n      });\n\n      const totalRevenue = payments.reduce((sum, p) => sum + Number(p.amount), 0);\n      const azoraCut = totalRevenue * 0.3;\n      const instructorCut = totalRevenue * 0.7;\n\n      logger.info('Revenue calculated', { instructorId, period, totalRevenue });\n      return { totalRevenue, azoraCut, instructorCut, paymentCount: payments.length };\n    } catch (error) {\n      logger.error('Error calculating revenue', { error, instructorId });\n      throw error;\n    }\n  }\n\n  async processWithdrawal(instructorId: string, amount: number) {\n    try {\n      logger.info('Withdrawal processed', { instructorId, amount });\n      return { success: true, message: 'Withdrawal processed', amount };\n    } catch (error) {\n      logger.error('Error processing withdrawal', { error, instructorId });\n      throw error;\n    }\n  }\n\n  async getPaymentHistory(instructorId: string) {\n    try {\n      const courses = await prisma.course.findMany({ where: { instructorId } });\n      const courseIds = courses.map(c => c.id);\n\n      const payments = await prisma.payment.findMany({\n        where: { courseId: { in: courseIds } },\n        orderBy: { createdAt: 'desc' },\n      });\n\n      logger.info('Payment history retrieved', { instructorId });\n      return payments;\n    } catch (error) {\n      logger.error('Error retrieving payment history', { error, instructorId });\n      throw error;\n    }\n  }\n}\n\nexport const teacherPaymentService = new TeacherPaymentService();\n"],"mappings":"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","ignoreList":[]}