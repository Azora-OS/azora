{"version":3,"names":["cov_1ylmlegmgh","actualCoverage","PrismaClient","logger","ErrorHandler","prisma","s","SLA_RESPONSE_TIMES","LOW","NORMAL","HIGH","CRITICAL","EnterpriseSupportService","createTicket","input","f","info","licenseId","priority","license","enterpriseLicense","findUnique","where","id","b","Error","ticketNumber","Date","now","Math","random","toString","substr","toUpperCase","ticket","enterpriseSupportTicket","create","data","title","description","status","createdBy","mapTicketResponse","error","handle","assignTicket","ticketId","assignedTo","updated","update","updateTicketStatus","resolvedAt","getTicket","getLicenseTickets","page","limit","skip","tickets","total","Promise","all","findMany","take","orderBy","createdAt","count","map","t","getOpenTickets","in","getSLABreachedTickets","breachedTickets","slaHours","slaDeadline","getTime","push","getSupportStats","open","resolved","resolvedTickets","totalResolutionTime","slaCompliant","resolutionTime","averageResolutionTime","length","slaComplianceRate","totalTickets","openTickets","round","hoursElapsed","slaStatus","slaResponseTime"],"sources":["support-service.ts"],"sourcesContent":["/**\n * Enterprise Support Service\n * Manages support tickets, SLA tracking, and priority routing\n */\n\nimport { PrismaClient, SupportPriority, SupportTicketStatus } from '@prisma/client';\nimport { logger } from '../shared/logging';\nimport { ErrorHandler } from '../payment/error-handler';\n\nconst prisma = new PrismaClient();\n\n// SLA response times in hours\nconst SLA_RESPONSE_TIMES: Record<SupportPriority, number> = {\n  LOW: 48,\n  NORMAL: 24,\n  HIGH: 4,\n  CRITICAL: 1,\n};\n\nexport interface CreateTicketInput {\n  licenseId: string;\n  title: string;\n  description: string;\n  priority: SupportPriority;\n  createdBy: string;\n}\n\nexport interface TicketResponse {\n  id: string;\n  ticketNumber: string;\n  title: string;\n  description: string;\n  priority: SupportPriority;\n  status: SupportTicketStatus;\n  assignedTo: string | null;\n  createdBy: string;\n  createdAt: Date;\n  resolvedAt: Date | null;\n  slaResponseTime: number; // in hours\n  slaStatus: 'ON_TRACK' | 'AT_RISK' | 'BREACHED';\n}\n\nexport class EnterpriseSupportService {\n  /**\n   * Create support ticket\n   */\n  async createTicket(input: CreateTicketInput): Promise<TicketResponse> {\n    try {\n      logger.info('Creating support ticket', {\n        licenseId: input.licenseId,\n        priority: input.priority,\n      });\n\n      const license = await prisma.enterpriseLicense.findUnique({\n        where: { id: input.licenseId },\n      });\n\n      if (!license) {\n        throw new Error(`License ${input.licenseId} not found`);\n      }\n\n      // Generate ticket number\n      const ticketNumber = `TKT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`.toUpperCase();\n\n      const ticket = await prisma.enterpriseSupportTicket.create({\n        data: {\n          licenseId: input.licenseId,\n          ticketNumber,\n          title: input.title,\n          description: input.description,\n          priority: input.priority,\n          status: 'OPEN',\n          createdBy: input.createdBy,\n        },\n      });\n\n      logger.info('Support ticket created', { ticketNumber });\n\n      return this.mapTicketResponse(ticket);\n    } catch (error) {\n      logger.error('Failed to create support ticket', { error, ...input });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Assign ticket\n   */\n  async assignTicket(ticketId: string, assignedTo: string): Promise<TicketResponse> {\n    try {\n      logger.info('Assigning ticket', { ticketId, assignedTo });\n\n      const ticket = await prisma.enterpriseSupportTicket.findUnique({\n        where: { id: ticketId },\n      });\n\n      if (!ticket) {\n        throw new Error(`Ticket ${ticketId} not found`);\n      }\n\n      const updated = await prisma.enterpriseSupportTicket.update({\n        where: { id: ticketId },\n        data: {\n          assignedTo,\n          status: 'IN_PROGRESS',\n        },\n      });\n\n      logger.info('Ticket assigned', { ticketId, assignedTo });\n\n      return this.mapTicketResponse(updated);\n    } catch (error) {\n      logger.error('Failed to assign ticket', { error, ticketId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Update ticket status\n   */\n  async updateTicketStatus(ticketId: string, status: SupportTicketStatus): Promise<TicketResponse> {\n    try {\n      logger.info('Updating ticket status', { ticketId, status });\n\n      const ticket = await prisma.enterpriseSupportTicket.findUnique({\n        where: { id: ticketId },\n      });\n\n      if (!ticket) {\n        throw new Error(`Ticket ${ticketId} not found`);\n      }\n\n      const resolvedAt = status === 'RESOLVED' || status === 'CLOSED' ? new Date() : null;\n\n      const updated = await prisma.enterpriseSupportTicket.update({\n        where: { id: ticketId },\n        data: {\n          status,\n          resolvedAt,\n        },\n      });\n\n      logger.info('Ticket status updated', { ticketId, status });\n\n      return this.mapTicketResponse(updated);\n    } catch (error) {\n      logger.error('Failed to update ticket status', { error, ticketId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get ticket by ID\n   */\n  async getTicket(ticketId: string): Promise<TicketResponse | null> {\n    try {\n      const ticket = await prisma.enterpriseSupportTicket.findUnique({\n        where: { id: ticketId },\n      });\n\n      if (!ticket) {\n        return null;\n      }\n\n      return this.mapTicketResponse(ticket);\n    } catch (error) {\n      logger.error('Failed to get ticket', { error, ticketId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get tickets for license\n   */\n  async getLicenseTickets(\n    licenseId: string,\n    status?: SupportTicketStatus,\n    page: number = 1,\n    limit: number = 20\n  ): Promise<{\n    tickets: TicketResponse[];\n    total: number;\n    page: number;\n    limit: number;\n  }> {\n    try {\n      const skip = (page - 1) * limit;\n\n      const where: any = { licenseId };\n      if (status) {\n        where.status = status;\n      }\n\n      const [tickets, total] = await Promise.all([\n        prisma.enterpriseSupportTicket.findMany({\n          where,\n          skip,\n          take: limit,\n          orderBy: { createdAt: 'desc' },\n        }),\n        prisma.enterpriseSupportTicket.count({ where }),\n      ]);\n\n      return {\n        tickets: tickets.map((t) => this.mapTicketResponse(t)),\n        total,\n        page,\n        limit,\n      };\n    } catch (error) {\n      logger.error('Failed to get license tickets', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get open tickets\n   */\n  async getOpenTickets(): Promise<TicketResponse[]> {\n    try {\n      const tickets = await prisma.enterpriseSupportTicket.findMany({\n        where: {\n          status: {\n            in: ['OPEN', 'IN_PROGRESS', 'WAITING_CUSTOMER'],\n          },\n        },\n        orderBy: [{ priority: 'asc' }, { createdAt: 'asc' }],\n      });\n\n      return tickets.map((t) => this.mapTicketResponse(t));\n    } catch (error) {\n      logger.error('Failed to get open tickets', { error });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get SLA breached tickets\n   */\n  async getSLABreachedTickets(): Promise<TicketResponse[]> {\n    try {\n      const tickets = await prisma.enterpriseSupportTicket.findMany({\n        where: {\n          status: {\n            in: ['OPEN', 'IN_PROGRESS', 'WAITING_CUSTOMER'],\n          },\n        },\n      });\n\n      const now = new Date();\n      const breachedTickets: TicketResponse[] = [];\n\n      for (const ticket of tickets) {\n        const slaHours = SLA_RESPONSE_TIMES[ticket.priority];\n        const slaDeadline = new Date(ticket.createdAt.getTime() + slaHours * 60 * 60 * 1000);\n\n        if (now > slaDeadline) {\n          breachedTickets.push(this.mapTicketResponse(ticket));\n        }\n      }\n\n      return breachedTickets;\n    } catch (error) {\n      logger.error('Failed to get SLA breached tickets', { error });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get support statistics\n   */\n  async getSupportStats(): Promise<{\n    totalTickets: number;\n    openTickets: number;\n    resolvedTickets: number;\n    averageResolutionTime: number; // in hours\n    slaComplianceRate: number; // percentage\n  }> {\n    try {\n      const [total, open, resolved] = await Promise.all([\n        prisma.enterpriseSupportTicket.count(),\n        prisma.enterpriseSupportTicket.count({\n          where: { status: { in: ['OPEN', 'IN_PROGRESS', 'WAITING_CUSTOMER'] } },\n        }),\n        prisma.enterpriseSupportTicket.count({\n          where: { status: { in: ['RESOLVED', 'CLOSED'] } },\n        }),\n      ]);\n\n      const resolvedTickets = await prisma.enterpriseSupportTicket.findMany({\n        where: { status: { in: ['RESOLVED', 'CLOSED'] } },\n      });\n\n      let totalResolutionTime = 0;\n      let slaCompliant = 0;\n\n      for (const ticket of resolvedTickets) {\n        if (ticket.resolvedAt) {\n          const resolutionTime = (ticket.resolvedAt.getTime() - ticket.createdAt.getTime()) / (1000 * 60 * 60);\n          totalResolutionTime += resolutionTime;\n\n          const slaHours = SLA_RESPONSE_TIMES[ticket.priority];\n          if (resolutionTime <= slaHours) {\n            slaCompliant++;\n          }\n        }\n      }\n\n      const averageResolutionTime = resolvedTickets.length > 0 ? totalResolutionTime / resolvedTickets.length : 0;\n      const slaComplianceRate = resolvedTickets.length > 0 ? (slaCompliant / resolvedTickets.length) * 100 : 0;\n\n      return {\n        totalTickets: total,\n        openTickets: open,\n        resolvedTickets: resolved,\n        averageResolutionTime: Math.round(averageResolutionTime),\n        slaComplianceRate: Math.round(slaComplianceRate),\n      };\n    } catch (error) {\n      logger.error('Failed to get support stats', { error });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Map ticket to response format\n   */\n  private mapTicketResponse(ticket: any): TicketResponse {\n    const slaHours = SLA_RESPONSE_TIMES[ticket.priority];\n    const slaDeadline = new Date(ticket.createdAt.getTime() + slaHours * 60 * 60 * 1000);\n    const now = new Date();\n    const hoursElapsed = (now.getTime() - ticket.createdAt.getTime()) / (1000 * 60 * 60);\n\n    let slaStatus: 'ON_TRACK' | 'AT_RISK' | 'BREACHED' = 'ON_TRACK';\n    if (now > slaDeadline) {\n      slaStatus = 'BREACHED';\n    } else if (hoursElapsed > slaHours * 0.8) {\n      slaStatus = 'AT_RISK';\n    }\n\n    return {\n      id: ticket.id,\n      ticketNumber: ticket.ticketNumber,\n      title: ticket.title,\n      description: ticket.description,\n      priority: ticket.priority,\n      status: ticket.status,\n      assignedTo: ticket.assignedTo,\n      createdBy: ticket.createdBy,\n      createdAt: ticket.createdAt,\n      resolvedAt: ticket.resolvedAt,\n      slaResponseTime: slaHours,\n      slaStatus,\n    };\n  }\n}\n\nexport default new EnterpriseSupportService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}