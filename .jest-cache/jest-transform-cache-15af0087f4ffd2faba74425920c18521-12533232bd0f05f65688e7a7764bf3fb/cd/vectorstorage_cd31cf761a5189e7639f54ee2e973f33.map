{"version":3,"names":["cov_1ht7dh6r08","actualCoverage","Pinecone","VectorStorageService","constructor","apiKey","indexName","b","f","s","pinecone","storeVector","record","index","Index","upsert","id","values","metadata","error","console","storeVectorsBatch","records","vectors","map","batchSize","i","length","batch","slice","semanticSearch","queryVector","topK","filters","results","query","vector","includeMetadata","filter","matches","match","score","deleteVector","deleteOne","deleteVectorsBatch","ids","deleteMany","getVector","result","fetch","getIndexStats","stats","describeIndexStats"],"sources":["vector-storage.ts"],"sourcesContent":["import { Pinecone } from '@pinecone-database/pinecone';\n\nexport interface KnowledgeMetadata {\n  date: string;\n  source: string;\n  category: string;\n  verified: boolean;\n  relevance: number;\n  tags: string[];\n  url?: string;\n  title?: string;\n}\n\n// Type assertion for Pinecone compatibility\ntype PineconeMetadata = Record<string, string | number | boolean | string[]>;\n\nexport interface VectorRecord {\n  id: string;\n  values: number[];\n  metadata: KnowledgeMetadata;\n}\n\nexport interface SearchResult {\n  id: string;\n  score: number;\n  metadata: KnowledgeMetadata;\n}\n\nexport class VectorStorageService {\n  private pinecone: Pinecone;\n  private indexName: string;\n\n  constructor(apiKey: string, indexName: string = 'azora-knowledge') {\n    this.pinecone = new Pinecone({ apiKey });\n    this.indexName = indexName;\n  }\n\n  /**\n   * Store a vector with metadata\n   */\n  async storeVector(record: VectorRecord): Promise<void> {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      await index.upsert([\n        {\n          id: record.id,\n          values: record.values,\n          metadata: record.metadata as any,\n        },\n      ]);\n    } catch (error) {\n      console.error('Error storing vector:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Store multiple vectors in batch\n   */\n  async storeVectorsBatch(records: VectorRecord[]): Promise<void> {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      const vectors = records.map((record) => ({\n        id: record.id,\n        values: record.values,\n        metadata: record.metadata as any,\n      }));\n\n      // Batch in chunks of 100\n      const batchSize = 100;\n      for (let i = 0; i < vectors.length; i += batchSize) {\n        const batch = vectors.slice(i, i + batchSize);\n        await index.upsert(batch);\n      }\n    } catch (error) {\n      console.error('Error storing vectors batch:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Semantic search using vector similarity\n   */\n  async semanticSearch(\n    queryVector: number[],\n    topK: number = 10,\n    filters?: Record<string, unknown>\n  ): Promise<SearchResult[]> {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      const results = await index.query({\n        vector: queryVector,\n        topK,\n        includeMetadata: true,\n        filter: filters,\n      });\n\n      return results.matches.map((match) => ({\n        id: match.id,\n        score: match.score || 0,\n        metadata: match.metadata as any,\n      }));\n    } catch (error) {\n      console.error('Error performing semantic search:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Delete a vector by ID\n   */\n  async deleteVector(id: string): Promise<void> {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      await index.deleteOne(id);\n    } catch (error) {\n      console.error('Error deleting vector:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Delete multiple vectors\n   */\n  async deleteVectorsBatch(ids: string[]): Promise<void> {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      await index.deleteMany(ids);\n    } catch (error) {\n      console.error('Error deleting vectors batch:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get vector by ID\n   */\n  async getVector(id: string): Promise<VectorRecord | null> {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      const result = await index.fetch([id]);\n\n      if (result.records && result.records[id]) {\n        const record = result.records[id];\n        return {\n          id,\n          values: record.values,\n          metadata: record.metadata as any,\n        };\n      }\n\n      return null;\n    } catch (error) {\n      console.error('Error fetching vector:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get index stats\n   */\n  async getIndexStats() {\n    try {\n      const index = this.pinecone.Index(this.indexName);\n      const stats = await index.describeIndexStats();\n      return stats;\n    } catch (error) {\n      console.error('Error getting index stats:', error);\n      throw error;\n    }\n  }\n}\n\nexport default VectorStorageService;\n"],"mappings":"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","ignoreList":[]}