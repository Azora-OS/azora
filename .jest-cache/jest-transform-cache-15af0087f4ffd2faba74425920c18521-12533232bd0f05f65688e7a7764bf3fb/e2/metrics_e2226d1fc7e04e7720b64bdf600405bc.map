{"version":3,"names":["cov_4tf8sqwgk","actualCoverage","promClient","register","s","Registry","collectDefaultMetrics","customMetrics","httpRequestsTotal","Counter","name","help","labelNames","registers","httpRequestDuration","Histogram","buckets","listingsCreatedTotal","transactionsTotal","domainsListedTotal","bidsPlacedTotal","domainsSoldTotal","metricsMiddleware","req","res","next","f","start","Date","now","on","duration","labels","method","b","route","path","statusCode","toString","inc","observe","getMetrics","metrics"],"sources":["metrics.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nimport { Request, Response, NextFunction } from 'express';\nimport promClient from 'prom-client';\n\nconst register = new promClient.Registry();\n\n// Add default metrics\npromClient.collectDefaultMetrics({ register });\n\n// Custom metrics\nexport const customMetrics = {\n  httpRequestsTotal: new promClient.Counter({\n    name: 'http_requests_total',\n    help: 'Total number of HTTP requests',\n    labelNames: ['method', 'route', 'status_code'],\n    registers: [register],\n  }),\n\n  httpRequestDuration: new promClient.Histogram({\n    name: 'http_request_duration_seconds',\n    help: 'Duration of HTTP requests in seconds',\n    labelNames: ['method', 'route'],\n    buckets: [0.1, 0.5, 1, 2, 5],\n    registers: [register],\n  }),\n\n  listingsCreatedTotal: new promClient.Counter({\n    name: 'listings_created_total',\n    help: 'Total number of marketplace listings created',\n    registers: [register],\n  }),\n\n  transactionsTotal: new promClient.Counter({\n    name: 'marketplace_transactions_total',\n    help: 'Total number of marketplace transactions',\n    registers: [register],\n  }),\n\n  domainsListedTotal: new promClient.Counter({\n    name: 'domains_listed_total',\n    help: 'Total number of domains listed for sale',\n    registers: [register],\n  }),\n\n  bidsPlacedTotal: new promClient.Counter({\n    name: 'bids_placed_total',\n    help: 'Total number of bids placed on domains',\n    registers: [register],\n  }),\n\n  domainsSoldTotal: new promClient.Counter({\n    name: 'domains_sold_total',\n    help: 'Total number of domains sold',\n    registers: [register],\n  }),\n};\n\nexport const metricsMiddleware = (req: Request, res: Response, next: NextFunction): void => {\n  const start = Date.now();\n\n  res.on('finish', () => {\n    const duration = (Date.now() - start) / 1000;\n\n    customMetrics.httpRequestsTotal\n      .labels(req.method, req.route?.path || req.path, res.statusCode.toString())\n      .inc();\n\n    customMetrics.httpRequestDuration\n      .labels(req.method, req.route?.path || req.path)\n      .observe(duration);\n  });\n\n  next();\n};\n\n// Metrics endpoint handler\nexport const getMetrics = async (): Promise<string> => {\n  return register.metrics();\n};"],"mappings":"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","ignoreList":[]}