{"version":3,"names":["cov_19zlzfiv7","actualCoverage","PrismaClient","prisma","s","AuditService","log","eventType","details","userId","f","auditLog","create","data","MarketplaceService","createListing","item","price","listing","getListings","findMany","where","status","orderBy","createdAt","purchaseListing","listingId","buyerId","findUnique","id","b","Error","transaction","amount","update"],"sources":["marketplaceService.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nimport { PrismaClient } from '@prisma/client';\nconst prisma = new PrismaClient();\n\nexport class AuditService {\n  static async log(eventType: string, details: any, userId?: string) {\n    await prisma.auditLog.create({\n      data: {\n        eventType,\n        details,\n        userId,\n      },\n    });\n  }\n}\n\nexport class MarketplaceService {\n  static async createListing(userId: string, item: string, price: number) {\n    const listing = await prisma.listing.create({\n      data: {\n        item,\n        price,\n        userId,\n      },\n    });\n    await AuditService.log('LISTING_CREATED', { item, price }, userId);\n    return listing;\n  }\n\n  static async getListings() {\n    return await prisma.listing.findMany({\n      where: { status: 'active' },\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  static async purchaseListing(listingId: string, buyerId: string) {\n    const listing = await prisma.listing.findUnique({ where: { id: listingId } });\n    if (!listing || listing.status !== 'active') {\n      throw new Error('Listing not available');\n    }\n    const transaction = await prisma.transaction.create({\n      data: {\n        listingId,\n        buyerId,\n        amount: listing.price,\n      },\n    });\n    await prisma.listing.update({\n      where: { id: listingId },\n      data: { status: 'sold' },\n    });\n    await AuditService.log('LISTING_PURCHASED', { listingId, amount: listing.price }, buyerId);\n    return transaction;\n  }\n}"],"mappings":"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","ignoreList":[]}