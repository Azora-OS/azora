{"version":3,"names":["cov_oh7sz50e1","actualCoverage","ethers","TreasuryService","priceCache","s","Map","lastPriceUpdate","CACHE_DURATION","ASSETS","b","process","env","CONTRACT_AZR_TOKEN","constructor","f","provider","providers","JsonRpcProvider","BLOCKCHAIN_RPC_URL","getPortfolio","assets","totalValueUsd","treasuryAddress","TREASURY_WALLET_ADDRESS","azrBalance","usdcBalance","wethBalance","azrPrice","getPrice","usdcPrice","wethPrice","push","symbol","amount","valueUsd","contractAddress","AZR","USDC","WETH","reduce","sum","asset","lastUpdated","Date","toISOString","error","console","Error","now","has","get","price","set","trackRealAsset","assetId","value","proof","log"],"sources":["treasury-service.ts"],"sourcesContent":["import { ethers } from 'ethers';\nimport axios from 'axios';\n\nexport interface Asset {\n  symbol: string;\n  amount: number;\n  valueUsd: number;\n  contractAddress?: string;\n}\n\nexport interface Portfolio {\n  totalValueUsd: number;\n  assets: Asset[];\n  lastUpdated: string;\n}\n\nexport class TreasuryService {\n  private provider: ethers.providers.JsonRpcProvider;\n  private priceCache: Map<string, number> = new Map();\n  private lastPriceUpdate: number = 0;\n  private readonly CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n  // Mock contract addresses for demo\n  private readonly ASSETS = {\n    'AZR': process.env.CONTRACT_AZR_TOKEN || '0x...',\n    'USDC': '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',\n    'WETH': '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'\n  };\n\n  constructor() {\n    this.provider = new ethers.providers.JsonRpcProvider(process.env.BLOCKCHAIN_RPC_URL || 'http://localhost:8545');\n  }\n\n  async getPortfolio(): Promise<Portfolio> {\n    try {\n      const assets: Asset[] = [];\n      let totalValueUsd = 0;\n\n      // In a real app, we would query the Treasury wallet address\n      const treasuryAddress = process.env.TREASURY_WALLET_ADDRESS || '0x...';\n\n      // 1. Get Balances (Mocking for now as we don't have deployed contracts for all)\n      const azrBalance = 1000000; // Mock balance\n      const usdcBalance = 500000; // Mock balance\n      const wethBalance = 10;     // Mock balance\n\n      // 2. Get Prices\n      const azrPrice = await this.getPrice('AZR');\n      const usdcPrice = await this.getPrice('USDC');\n      const wethPrice = await this.getPrice('WETH');\n\n      // 3. Construct Asset List\n      assets.push({ symbol: 'AZR', amount: azrBalance, valueUsd: azrBalance * azrPrice, contractAddress: this.ASSETS.AZR });\n      assets.push({ symbol: 'USDC', amount: usdcBalance, valueUsd: usdcBalance * usdcPrice, contractAddress: this.ASSETS.USDC });\n      assets.push({ symbol: 'WETH', amount: wethBalance, valueUsd: wethBalance * wethPrice, contractAddress: this.ASSETS.WETH });\n\n      // 4. Calculate Total Value\n      totalValueUsd = assets.reduce((sum, asset) => sum + asset.valueUsd, 0);\n\n      return {\n        totalValueUsd,\n        assets,\n        lastUpdated: new Date().toISOString()\n      };\n    } catch (error: any) {\n      console.error('Failed to fetch portfolio:', error);\n      throw new Error('Treasury service unavailable');\n    }\n  }\n\n  async getPrice(symbol: string): Promise<number> {\n    // Check cache\n    if (Date.now() - this.lastPriceUpdate < this.CACHE_DURATION && this.priceCache.has(symbol)) {\n      return this.priceCache.get(symbol)!;\n    }\n\n    try {\n      // Mock price fetching - in prod use Chainlink or Coingecko API\n      let price = 0;\n      switch (symbol) {\n        case 'AZR': price = 1.50; break; // Fixed peg for now\n        case 'USDC': price = 1.00; break;\n        case 'WETH': price = 2500.00; break; // Mock ETH price\n        default: price = 0;\n      }\n\n      this.priceCache.set(symbol, price);\n      this.lastPriceUpdate = Date.now();\n      return price;\n    } catch (error) {\n      console.error(`Failed to fetch price for ${symbol}:`, error);\n      return 0;\n    }\n  }\n\n  async trackRealAsset(assetId: string, value: number, proof: string): Promise<boolean> {\n    // This would interact with a \"RealWorldAsset\" smart contract\n    console.log(`Tracking RWA: ${assetId}, Value: ${value}, Proof: ${proof}`);\n    return true;\n  }\n}\n"],"mappings":"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","ignoreList":[]}