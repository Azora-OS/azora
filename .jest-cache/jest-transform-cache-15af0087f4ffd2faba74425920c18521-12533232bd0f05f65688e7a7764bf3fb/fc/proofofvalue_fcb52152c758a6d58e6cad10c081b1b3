a62797076ec36db30f73b2fa5be7319d
/* istanbul ignore next */
function cov_2kuzrz4n1w() {
  var path = "/workspaces/azora/services/azora-cloud/azora-mint/src/mining/proof-of-value.ts";
  var hash = "584fa98136e042ca016212d5e6cc90201db3a435";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/azora-cloud/azora-mint/src/mining/proof-of-value.ts",
    statementMap: {
      "0": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 53
        }
      },
      "1": {
        start: {
          line: 21,
          column: 8
        },
        end: {
          line: 21,
          column: 37
        }
      },
      "2": {
        start: {
          line: 22,
          column: 8
        },
        end: {
          line: 22,
          column: 40
        }
      },
      "3": {
        start: {
          line: 29,
          column: 8
        },
        end: {
          line: 29,
          column: 85
        }
      },
      "4": {
        start: {
          line: 32,
          column: 27
        },
        end: {
          line: 32,
          column: 77
        }
      },
      "5": {
        start: {
          line: 35,
          column: 34
        },
        end: {
          line: 35,
          column: 95
        }
      },
      "6": {
        start: {
          line: 36,
          column: 33
        },
        end: {
          line: 36,
          column: 77
        }
      },
      "7": {
        start: {
          line: 38,
          column: 23
        },
        end: {
          line: 42,
          column: 9
        }
      },
      "8": {
        start: {
          line: 45,
          column: 43
        },
        end: {
          line: 53,
          column: 9
        }
      },
      "9": {
        start: {
          line: 56,
          column: 8
        },
        end: {
          line: 56,
          column: 44
        }
      },
      "10": {
        start: {
          line: 58,
          column: 8
        },
        end: {
          line: 58,
          column: 72
        }
      },
      "11": {
        start: {
          line: 60,
          column: 8
        },
        end: {
          line: 60,
          column: 28
        }
      },
      "12": {
        start: {
          line: 71,
          column: 8
        },
        end: {
          line: 71,
          column: 90
        }
      },
      "13": {
        start: {
          line: 79,
          column: 8
        },
        end: {
          line: 82,
          column: 9
        }
      },
      "14": {
        start: {
          line: 80,
          column: 26
        },
        end: {
          line: 80,
          column: 73
        }
      },
      "15": {
        start: {
          line: 81,
          column: 12
        },
        end: {
          line: 81,
          column: 46
        }
      },
      "16": {
        start: {
          line: 83,
          column: 8
        },
        end: {
          line: 83,
          column: 17
        }
      },
      "17": {
        start: {
          line: 90,
          column: 8
        },
        end: {
          line: 112,
          column: 9
        }
      },
      "18": {
        start: {
          line: 92,
          column: 12
        },
        end: {
          line: 108,
          column: 15
        }
      },
      "19": {
        start: {
          line: 110,
          column: 12
        },
        end: {
          line: 110,
          column: 59
        }
      },
      "20": {
        start: {
          line: 111,
          column: 12
        },
        end: {
          line: 111,
          column: 24
        }
      },
      "21": {
        start: {
          line: 120,
          column: 8
        },
        end: {
          line: 124,
          column: 9
        }
      },
      "22": {
        start: {
          line: 121,
          column: 12
        },
        end: {
          line: 121,
          column: 45
        }
      },
      "23": {
        start: {
          line: 122,
          column: 15
        },
        end: {
          line: 124,
          column: 9
        }
      },
      "24": {
        start: {
          line: 123,
          column: 12
        },
        end: {
          line: 123,
          column: 45
        }
      },
      "25": {
        start: {
          line: 126,
          column: 8
        },
        end: {
          line: 126,
          column: 78
        }
      },
      "26": {
        start: {
          line: 133,
          column: 8
        },
        end: {
          line: 137,
          column: 10
        }
      },
      "27": {
        start: {
          line: 144,
          column: 8
        },
        end: {
          line: 144,
          column: 57
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        loc: {
          start: {
            line: 19,
            column: 41
          },
          end: {
            line: 23,
            column: 5
          }
        },
        line: 19
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 28,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        loc: {
          start: {
            line: 28,
            column: 71
          },
          end: {
            line: 61,
            column: 5
          }
        },
        line: 28
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 66,
            column: 4
          },
          end: {
            line: 66,
            column: 5
          }
        },
        loc: {
          start: {
            line: 70,
            column: 14
          },
          end: {
            line: 72,
            column: 5
          }
        },
        line: 70
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 77,
            column: 4
          },
          end: {
            line: 77,
            column: 5
          }
        },
        loc: {
          start: {
            line: 77,
            column: 79
          },
          end: {
            line: 84,
            column: 5
          }
        },
        line: 77
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 89,
            column: 4
          },
          end: {
            line: 89,
            column: 5
          }
        },
        loc: {
          start: {
            line: 89,
            column: 66
          },
          end: {
            line: 113,
            column: 5
          }
        },
        line: 89
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 118,
            column: 4
          },
          end: {
            line: 118,
            column: 5
          }
        },
        loc: {
          start: {
            line: 118,
            column: 52
          },
          end: {
            line: 127,
            column: 5
          }
        },
        line: 118
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 132,
            column: 4
          },
          end: {
            line: 132,
            column: 5
          }
        },
        loc: {
          start: {
            line: 132,
            column: 15
          },
          end: {
            line: 138,
            column: 5
          }
        },
        line: 132
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 143,
            column: 4
          },
          end: {
            line: 143,
            column: 5
          }
        },
        loc: {
          start: {
            line: 143,
            column: 57
          },
          end: {
            line: 145,
            column: 5
          }
        },
        line: 143
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 19,
            column: 16
          },
          end: {
            line: 19,
            column: 39
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 19,
            column: 37
          },
          end: {
            line: 19,
            column: 39
          }
        }],
        line: 19
      },
      "1": {
        loc: {
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 82,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 82,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 79
      },
      "2": {
        loc: {
          start: {
            line: 120,
            column: 8
          },
          end: {
            line: 124,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 120,
            column: 8
          },
          end: {
            line: 124,
            column: 9
          }
        }, {
          start: {
            line: 122,
            column: 15
          },
          end: {
            line: 124,
            column: 9
          }
        }],
        line: 120
      },
      "3": {
        loc: {
          start: {
            line: 122,
            column: 15
          },
          end: {
            line: 124,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 122,
            column: 15
          },
          end: {
            line: 124,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 122
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0
    },
    b: {
      "0": [0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "584fa98136e042ca016212d5e6cc90201db3a435"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_2kuzrz4n1w = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_2kuzrz4n1w();
import { ValueCalculator } from './value-calculator';
import crypto from 'crypto';
export class ProofOfValue {
  constructor(baseReward =
  /* istanbul ignore next */
  (cov_2kuzrz4n1w().b[0][0]++, 10)) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[0]++;
    cov_2kuzrz4n1w().s[0]++;
    this.valueCalculator = new ValueCalculator();
    /* istanbul ignore next */
    cov_2kuzrz4n1w().s[1]++;
    this.baseReward = baseReward;
    /* istanbul ignore next */
    cov_2kuzrz4n1w().s[2]++;
    this.difficultyAdjustment = 1.0;
  }

  /**
   * Mine AZR tokens based on value contribution
   */
  async mine(contribution) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[1]++;
    cov_2kuzrz4n1w().s[3]++;
    console.log(`⛏️ PoV Mining: ${contribution.type} by ${contribution.userId}`);

    // Calculate value score
    const valueScore =
    /* istanbul ignore next */
    (cov_2kuzrz4n1w().s[4]++, this.valueCalculator.updateUserScore(contribution));

    // Calculate reward
    const contributionValue =
    /* istanbul ignore next */
    (cov_2kuzrz4n1w().s[5]++, this.valueCalculator.calculateContributionValue(contribution));
    const attributionBonus =
    /* istanbul ignore next */
    (cov_2kuzrz4n1w().s[6]++, this.calculateAttributionBonus(contribution));
    const reward =
    /* istanbul ignore next */
    (cov_2kuzrz4n1w().s[7]++, this.calculateReward(contributionValue, this.difficultyAdjustment, attributionBonus));

    // Create mining reward
    const miningReward =
    /* istanbul ignore next */
    (cov_2kuzrz4n1w().s[8]++, {
      userId: contribution.userId,
      amount: reward,
      valueScore: contributionValue,
      difficulty: this.difficultyAdjustment,
      attributionBonus,
      timestamp: new Date().toISOString(),
      transactionId: `pov-${crypto.randomUUID()}`
    });

    // Mint tokens (integrate with blockchain)
    /* istanbul ignore next */
    cov_2kuzrz4n1w().s[9]++;
    await this.mintTokens(miningReward);
    /* istanbul ignore next */
    cov_2kuzrz4n1w().s[10]++;
    console.log(`✅ Mined ${reward} AZR for ${contribution.userId}`);
    /* istanbul ignore next */
    cov_2kuzrz4n1w().s[11]++;
    return miningReward;
  }

  /**
   * Calculate mining reward
   */
  calculateReward(valueScore, difficulty, attributionBonus) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[2]++;
    cov_2kuzrz4n1w().s[12]++;
    return this.baseReward * (valueScore / 100) * difficulty * (1 + attributionBonus);
  }

  /**
   * Calculate attribution bonus
   */
  calculateAttributionBonus(contribution) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[3]++;
    cov_2kuzrz4n1w().s[13]++;
    // Bonus for properly attributing others
    if (contribution.metadata.attributedCreators) {
      /* istanbul ignore next */
      cov_2kuzrz4n1w().b[1][0]++;
      const count =
      /* istanbul ignore next */
      (cov_2kuzrz4n1w().s[14]++, contribution.metadata.attributedCreators.length);
      /* istanbul ignore next */
      cov_2kuzrz4n1w().s[15]++;
      return Math.min(0.5, count * 0.1); // Max 50% bonus, 10% per attribution
    } else
    /* istanbul ignore next */
    {
      cov_2kuzrz4n1w().b[1][1]++;
    }
    cov_2kuzrz4n1w().s[16]++;
    return 0;
  }

  /**
   * Mint tokens to user's wallet
   */
  async mintTokens(reward) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[4]++;
    cov_2kuzrz4n1w().s[17]++;
    try {
      /* istanbul ignore next */
      cov_2kuzrz4n1w().s[18]++;
      // Integrate with blockchain
      await fetch('http://localhost:3011/api/blockchain/transaction', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          from: 'ubo-fund',
          // Ubuntu fund mints new tokens
          to: reward.userId,
          amount: reward.amount,
          currency: 'AZR',
          type: 'Mining',
          data: {
            proofOfValue: true,
            valueScore: reward.valueScore,
            difficulty: reward.difficulty,
            attributionBonus: reward.attributionBonus
          }
        })
      });
    } catch (error) {
      /* istanbul ignore next */
      cov_2kuzrz4n1w().s[19]++;
      console.error('Failed to mint tokens:', error);
      /* istanbul ignore next */
      cov_2kuzrz4n1w().s[20]++;
      throw error;
    }
  }

  /**
   * Adjust difficulty based on network activity
   */
  adjustDifficulty(networkHashRate) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[5]++;
    cov_2kuzrz4n1w().s[21]++;
    // Increase difficulty if too many tokens being mined
    if (networkHashRate > 1000) {
      /* istanbul ignore next */
      cov_2kuzrz4n1w().b[2][0]++;
      cov_2kuzrz4n1w().s[22]++;
      this.difficultyAdjustment *= 1.1;
    } else {
      /* istanbul ignore next */
      cov_2kuzrz4n1w().b[2][1]++;
      cov_2kuzrz4n1w().s[23]++;
      if (networkHashRate < 100) {
        /* istanbul ignore next */
        cov_2kuzrz4n1w().b[3][0]++;
        cov_2kuzrz4n1w().s[24]++;
        this.difficultyAdjustment *= 0.9;
      } else
      /* istanbul ignore next */
      {
        cov_2kuzrz4n1w().b[3][1]++;
      }
    }
    /* istanbul ignore next */
    cov_2kuzrz4n1w().s[25]++;
    console.log(`⚙️ Difficulty adjusted to ${this.difficultyAdjustment}`);
  }

  /**
   * Get mining statistics
   */
  getStats() {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[6]++;
    cov_2kuzrz4n1w().s[26]++;
    return {
      baseReward: this.baseReward,
      difficulty: this.difficultyAdjustment,
      leaderboard: this.valueCalculator.getLeaderboard(10)
    };
  }

  /**
   * Get user's value score
   */
  getUserScore(userId) {
    /* istanbul ignore next */
    cov_2kuzrz4n1w().f[7]++;
    cov_2kuzrz4n1w().s[27]++;
    return this.valueCalculator.getUserScore(userId);
  }
}
export default ProofOfValue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMmt1enJ6NG4xdyIsImFjdHVhbENvdmVyYWdlIiwiVmFsdWVDYWxjdWxhdG9yIiwiY3J5cHRvIiwiUHJvb2ZPZlZhbHVlIiwiY29uc3RydWN0b3IiLCJiYXNlUmV3YXJkIiwiYiIsImYiLCJzIiwidmFsdWVDYWxjdWxhdG9yIiwiZGlmZmljdWx0eUFkanVzdG1lbnQiLCJtaW5lIiwiY29udHJpYnV0aW9uIiwiY29uc29sZSIsImxvZyIsInR5cGUiLCJ1c2VySWQiLCJ2YWx1ZVNjb3JlIiwidXBkYXRlVXNlclNjb3JlIiwiY29udHJpYnV0aW9uVmFsdWUiLCJjYWxjdWxhdGVDb250cmlidXRpb25WYWx1ZSIsImF0dHJpYnV0aW9uQm9udXMiLCJjYWxjdWxhdGVBdHRyaWJ1dGlvbkJvbnVzIiwicmV3YXJkIiwiY2FsY3VsYXRlUmV3YXJkIiwibWluaW5nUmV3YXJkIiwiYW1vdW50IiwiZGlmZmljdWx0eSIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInRyYW5zYWN0aW9uSWQiLCJyYW5kb21VVUlEIiwibWludFRva2VucyIsIm1ldGFkYXRhIiwiYXR0cmlidXRlZENyZWF0b3JzIiwiY291bnQiLCJsZW5ndGgiLCJNYXRoIiwibWluIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJmcm9tIiwidG8iLCJjdXJyZW5jeSIsImRhdGEiLCJwcm9vZk9mVmFsdWUiLCJlcnJvciIsImFkanVzdERpZmZpY3VsdHkiLCJuZXR3b3JrSGFzaFJhdGUiLCJnZXRTdGF0cyIsImxlYWRlcmJvYXJkIiwiZ2V0TGVhZGVyYm9hcmQiLCJnZXRVc2VyU2NvcmUiXSwic291cmNlcyI6WyJwcm9vZi1vZi12YWx1ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWx1ZUNhbGN1bGF0b3IsIFZhbHVlQ29udHJpYnV0aW9uLCBWYWx1ZVNjb3JlIH0gZnJvbSAnLi92YWx1ZS1jYWxjdWxhdG9yJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuZXhwb3J0IGludGVyZmFjZSBNaW5pbmdSZXdhcmQge1xuICAgIHVzZXJJZDogc3RyaW5nO1xuICAgIGFtb3VudDogbnVtYmVyO1xuICAgIHZhbHVlU2NvcmU6IG51bWJlcjtcbiAgICBkaWZmaWN1bHR5OiBudW1iZXI7XG4gICAgYXR0cmlidXRpb25Cb251czogbnVtYmVyO1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICAgIHRyYW5zYWN0aW9uSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFByb29mT2ZWYWx1ZSB7XG4gICAgcHJpdmF0ZSB2YWx1ZUNhbGN1bGF0b3I6IFZhbHVlQ2FsY3VsYXRvcjtcbiAgICBwcml2YXRlIGJhc2VSZXdhcmQ6IG51bWJlcjtcbiAgICBwcml2YXRlIGRpZmZpY3VsdHlBZGp1c3RtZW50OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihiYXNlUmV3YXJkOiBudW1iZXIgPSAxMCkge1xuICAgICAgICB0aGlzLnZhbHVlQ2FsY3VsYXRvciA9IG5ldyBWYWx1ZUNhbGN1bGF0b3IoKTtcbiAgICAgICAgdGhpcy5iYXNlUmV3YXJkID0gYmFzZVJld2FyZDtcbiAgICAgICAgdGhpcy5kaWZmaWN1bHR5QWRqdXN0bWVudCA9IDEuMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNaW5lIEFaUiB0b2tlbnMgYmFzZWQgb24gdmFsdWUgY29udHJpYnV0aW9uXG4gICAgICovXG4gICAgYXN5bmMgbWluZShjb250cmlidXRpb246IFZhbHVlQ29udHJpYnV0aW9uKTogUHJvbWlzZTxNaW5pbmdSZXdhcmQ+IHtcbiAgICAgICAgY29uc29sZS5sb2coYOKbj++4jyBQb1YgTWluaW5nOiAke2NvbnRyaWJ1dGlvbi50eXBlfSBieSAke2NvbnRyaWJ1dGlvbi51c2VySWR9YCk7XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHZhbHVlIHNjb3JlXG4gICAgICAgIGNvbnN0IHZhbHVlU2NvcmUgPSB0aGlzLnZhbHVlQ2FsY3VsYXRvci51cGRhdGVVc2VyU2NvcmUoY29udHJpYnV0aW9uKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgcmV3YXJkXG4gICAgICAgIGNvbnN0IGNvbnRyaWJ1dGlvblZhbHVlID0gdGhpcy52YWx1ZUNhbGN1bGF0b3IuY2FsY3VsYXRlQ29udHJpYnV0aW9uVmFsdWUoY29udHJpYnV0aW9uKTtcbiAgICAgICAgY29uc3QgYXR0cmlidXRpb25Cb251cyA9IHRoaXMuY2FsY3VsYXRlQXR0cmlidXRpb25Cb251cyhjb250cmlidXRpb24pO1xuXG4gICAgICAgIGNvbnN0IHJld2FyZCA9IHRoaXMuY2FsY3VsYXRlUmV3YXJkKFxuICAgICAgICAgICAgY29udHJpYnV0aW9uVmFsdWUsXG4gICAgICAgICAgICB0aGlzLmRpZmZpY3VsdHlBZGp1c3RtZW50LFxuICAgICAgICAgICAgYXR0cmlidXRpb25Cb251c1xuICAgICAgICApO1xuXG4gICAgICAgIC8vIENyZWF0ZSBtaW5pbmcgcmV3YXJkXG4gICAgICAgIGNvbnN0IG1pbmluZ1Jld2FyZDogTWluaW5nUmV3YXJkID0ge1xuICAgICAgICAgICAgdXNlcklkOiBjb250cmlidXRpb24udXNlcklkLFxuICAgICAgICAgICAgYW1vdW50OiByZXdhcmQsXG4gICAgICAgICAgICB2YWx1ZVNjb3JlOiBjb250cmlidXRpb25WYWx1ZSxcbiAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRoaXMuZGlmZmljdWx0eUFkanVzdG1lbnQsXG4gICAgICAgICAgICBhdHRyaWJ1dGlvbkJvbnVzLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB0cmFuc2FjdGlvbklkOiBgcG92LSR7Y3J5cHRvLnJhbmRvbVVVSUQoKX1gXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTWludCB0b2tlbnMgKGludGVncmF0ZSB3aXRoIGJsb2NrY2hhaW4pXG4gICAgICAgIGF3YWl0IHRoaXMubWludFRva2VucyhtaW5pbmdSZXdhcmQpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgTWluZWQgJHtyZXdhcmR9IEFaUiBmb3IgJHtjb250cmlidXRpb24udXNlcklkfWApO1xuXG4gICAgICAgIHJldHVybiBtaW5pbmdSZXdhcmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIG1pbmluZyByZXdhcmRcbiAgICAgKi9cbiAgICBwcml2YXRlIGNhbGN1bGF0ZVJld2FyZChcbiAgICAgICAgdmFsdWVTY29yZTogbnVtYmVyLFxuICAgICAgICBkaWZmaWN1bHR5OiBudW1iZXIsXG4gICAgICAgIGF0dHJpYnV0aW9uQm9udXM6IG51bWJlclxuICAgICk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VSZXdhcmQgKiAodmFsdWVTY29yZSAvIDEwMCkgKiBkaWZmaWN1bHR5ICogKDEgKyBhdHRyaWJ1dGlvbkJvbnVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgYXR0cmlidXRpb24gYm9udXNcbiAgICAgKi9cbiAgICBwcml2YXRlIGNhbGN1bGF0ZUF0dHJpYnV0aW9uQm9udXMoY29udHJpYnV0aW9uOiBWYWx1ZUNvbnRyaWJ1dGlvbik6IG51bWJlciB7XG4gICAgICAgIC8vIEJvbnVzIGZvciBwcm9wZXJseSBhdHRyaWJ1dGluZyBvdGhlcnNcbiAgICAgICAgaWYgKGNvbnRyaWJ1dGlvbi5tZXRhZGF0YS5hdHRyaWJ1dGVkQ3JlYXRvcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY29udHJpYnV0aW9uLm1ldGFkYXRhLmF0dHJpYnV0ZWRDcmVhdG9ycy5sZW5ndGg7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oMC41LCBjb3VudCAqIDAuMSk7IC8vIE1heCA1MCUgYm9udXMsIDEwJSBwZXIgYXR0cmlidXRpb25cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNaW50IHRva2VucyB0byB1c2VyJ3Mgd2FsbGV0XG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBtaW50VG9rZW5zKHJld2FyZDogTWluaW5nUmV3YXJkKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBJbnRlZ3JhdGUgd2l0aCBibG9ja2NoYWluXG4gICAgICAgICAgICBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDExL2FwaS9ibG9ja2NoYWluL3RyYW5zYWN0aW9uJywge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbTogJ3Viby1mdW5kJywgLy8gVWJ1bnR1IGZ1bmQgbWludHMgbmV3IHRva2Vuc1xuICAgICAgICAgICAgICAgICAgICB0bzogcmV3YXJkLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiByZXdhcmQuYW1vdW50LFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogJ0FaUicsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNaW5pbmcnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9vZk9mVmFsdWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVNjb3JlOiByZXdhcmQudmFsdWVTY29yZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHJld2FyZC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRpb25Cb251czogcmV3YXJkLmF0dHJpYnV0aW9uQm9udXNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBtaW50IHRva2VuczonLCBlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkanVzdCBkaWZmaWN1bHR5IGJhc2VkIG9uIG5ldHdvcmsgYWN0aXZpdHlcbiAgICAgKi9cbiAgICBhZGp1c3REaWZmaWN1bHR5KG5ldHdvcmtIYXNoUmF0ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIC8vIEluY3JlYXNlIGRpZmZpY3VsdHkgaWYgdG9vIG1hbnkgdG9rZW5zIGJlaW5nIG1pbmVkXG4gICAgICAgIGlmIChuZXR3b3JrSGFzaFJhdGUgPiAxMDAwKSB7XG4gICAgICAgICAgICB0aGlzLmRpZmZpY3VsdHlBZGp1c3RtZW50ICo9IDEuMTtcbiAgICAgICAgfSBlbHNlIGlmIChuZXR3b3JrSGFzaFJhdGUgPCAxMDApIHtcbiAgICAgICAgICAgIHRoaXMuZGlmZmljdWx0eUFkanVzdG1lbnQgKj0gMC45O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coYOKame+4jyBEaWZmaWN1bHR5IGFkanVzdGVkIHRvICR7dGhpcy5kaWZmaWN1bHR5QWRqdXN0bWVudH1gKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbWluaW5nIHN0YXRpc3RpY3NcbiAgICAgKi9cbiAgICBnZXRTdGF0cygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJhc2VSZXdhcmQ6IHRoaXMuYmFzZVJld2FyZCxcbiAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRoaXMuZGlmZmljdWx0eUFkanVzdG1lbnQsXG4gICAgICAgICAgICBsZWFkZXJib2FyZDogdGhpcy52YWx1ZUNhbGN1bGF0b3IuZ2V0TGVhZGVyYm9hcmQoMTApXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHVzZXIncyB2YWx1ZSBzY29yZVxuICAgICAqL1xuICAgIGdldFVzZXJTY29yZSh1c2VySWQ6IHN0cmluZyk6IFZhbHVlU2NvcmUgfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUNhbGN1bGF0b3IuZ2V0VXNlclNjb3JlKHVzZXJJZCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQcm9vZk9mVmFsdWU7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFlWTtJQUFBQSxjQUFBLFlBQUFBLENBQUE7TUFBQSxPQUFBQyxj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