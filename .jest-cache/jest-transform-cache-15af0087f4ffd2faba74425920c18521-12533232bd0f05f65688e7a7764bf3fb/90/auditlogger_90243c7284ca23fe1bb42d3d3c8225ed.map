{"version":3,"names":["cov_1vtk76nt2t","actualCoverage","crypto","DEFAULT_CONFIG","s","enabled","encryptionEnabled","encryptionKey","process","env","AUDIT_LOG_ENCRYPTION_KEY","retentionDays","batchSize","flushInterval","AuditLogger","encryptionAlgorithm","constructor","config","b","f","logBuffer","flushTimer","console","warn","startFlushTimer","log","result","userId","query","originalOutput","tier","processingTime","auditLog","id","generateLogId","validatedOutput","violations","complianceScore","timestamp","push","length","flush","logsToFlush","storedLogs","Promise","all","map","prepareForStorage","persistLogs","error","unshift","violationsJson","JSON","stringify","encrypted","encryptedViolations","encrypt","data","Error","iv","randomBytes","key","scryptSync","cipher","createCipheriv","update","final","authTag","getAuthTag","toString","decrypt","encryptedData","parse","decipher","createDecipheriv","Buffer","from","setAuthTag","decrypted","logs","NODE_ENV","getLogsForUser","options","getComplianceStats","startDate","endDate","totalLogs","averageComplianceScore","violationsByType","successRate","cleanupOldLogs","cutoffDate","Date","setDate","getDate","clearInterval","setInterval","catch","stopFlushTimer","now","shutdown","updateConfig","undefined","getConfig","getBufferSize","createAuditLogger"],"sources":["audit-logger.ts"],"sourcesContent":["/**\n * Constitutional AI Audit Logger\n * Handles persistent audit logging with encryption\n */\n\nimport crypto from 'crypto';\nimport {\n  ConstitutionalResult,\n  ConstitutionalAuditLog,\n  Violation\n} from '../types';\n\n/**\n * Audit logger configuration\n */\nexport interface AuditLoggerConfig {\n  enabled: boolean;\n  encryptionEnabled: boolean;\n  encryptionKey?: string;\n  retentionDays: number;\n  batchSize: number;\n  flushInterval: number; // milliseconds\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_CONFIG: AuditLoggerConfig = {\n  enabled: true,\n  encryptionEnabled: true,\n  encryptionKey: process.env.AUDIT_LOG_ENCRYPTION_KEY,\n  retentionDays: 90,\n  batchSize: 100,\n  flushInterval: 5000\n};\n\n/**\n * Audit log entry for storage\n */\ninterface StoredAuditLog {\n  id: string;\n  userId: string;\n  query: string;\n  originalOutput: string;\n  validatedOutput: string;\n  violations: string; // JSON string (encrypted if enabled)\n  complianceScore: number;\n  timestamp: Date;\n  tier: string;\n  processingTime: number;\n  encrypted: boolean;\n}\n\n/**\n * Audit Logger Implementation\n */\nexport class AuditLogger {\n  private config: AuditLoggerConfig;\n  private logBuffer: ConstitutionalAuditLog[];\n  private flushTimer: NodeJS.Timeout | null;\n  private encryptionAlgorithm: string = 'aes-256-gcm';\n\n  constructor(config: Partial<AuditLoggerConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.logBuffer = [];\n    this.flushTimer = null;\n    \n    // Validate encryption key if encryption is enabled\n    if (this.config.encryptionEnabled && !this.config.encryptionKey) {\n      console.warn('Audit log encryption enabled but no key provided. Disabling encryption.');\n      this.config.encryptionEnabled = false;\n    }\n    \n    // Start flush timer\n    if (this.config.enabled) {\n      this.startFlushTimer();\n    }\n  }\n\n  /**\n   * Log a constitutional validation result\n   */\n  async log(\n    result: ConstitutionalResult,\n    userId: string,\n    query: string,\n    originalOutput: string,\n    tier: string = 'unknown',\n    processingTime: number = 0\n  ): Promise<void> {\n    if (!this.config.enabled) {\n      return;\n    }\n\n    const auditLog: ConstitutionalAuditLog = {\n      id: this.generateLogId(),\n      userId,\n      query,\n      originalOutput,\n      validatedOutput: result.validatedOutput,\n      violations: result.violations,\n      complianceScore: result.complianceScore,\n      timestamp: result.timestamp,\n      tier,\n      processingTime\n    };\n\n    // Add to buffer\n    this.logBuffer.push(auditLog);\n\n    // Flush if buffer is full\n    if (this.logBuffer.length >= this.config.batchSize) {\n      await this.flush();\n    }\n  }\n\n  /**\n   * Flush buffered logs to storage\n   */\n  async flush(): Promise<void> {\n    if (this.logBuffer.length === 0) {\n      return;\n    }\n\n    const logsToFlush = [...this.logBuffer];\n    this.logBuffer = [];\n\n    try {\n      // Prepare logs for storage\n      const storedLogs = await Promise.all(\n        logsToFlush.map(log => this.prepareForStorage(log))\n      );\n\n      // In production, this would write to database\n      // For now, we'll simulate storage\n      await this.persistLogs(storedLogs);\n\n      console.log(`Flushed ${storedLogs.length} audit logs`);\n    } catch (error) {\n      console.error('Failed to flush audit logs:', error);\n      // Re-add logs to buffer for retry\n      this.logBuffer.unshift(...logsToFlush);\n    }\n  }\n\n  /**\n   * Prepare log entry for storage\n   */\n  private async prepareForStorage(log: ConstitutionalAuditLog): Promise<StoredAuditLog> {\n    // Serialize violations\n    const violationsJson = JSON.stringify(log.violations);\n\n    // Encrypt sensitive data if enabled\n    const encrypted = this.config.encryptionEnabled;\n    const encryptedViolations = encrypted\n      ? await this.encrypt(violationsJson)\n      : violationsJson;\n\n    return {\n      id: log.id,\n      userId: log.userId,\n      query: log.query,\n      originalOutput: log.originalOutput,\n      validatedOutput: log.validatedOutput,\n      violations: encryptedViolations,\n      complianceScore: log.complianceScore,\n      timestamp: log.timestamp,\n      tier: log.tier,\n      processingTime: log.processingTime,\n      encrypted\n    };\n  }\n\n  /**\n   * Encrypt data using AES-256-GCM\n   */\n  private async encrypt(data: string): Promise<string> {\n    if (!this.config.encryptionKey) {\n      throw new Error('Encryption key not configured');\n    }\n\n    try {\n      // Generate IV\n      const iv = crypto.randomBytes(16);\n\n      // Create cipher\n      const key = crypto.scryptSync(this.config.encryptionKey, 'salt', 32);\n      const cipher = crypto.createCipheriv(this.encryptionAlgorithm, key, iv);\n\n      // Encrypt\n      let encrypted = cipher.update(data, 'utf8', 'hex');\n      encrypted += cipher.final('hex');\n\n      // Get auth tag\n      const authTag = cipher.getAuthTag();\n\n      // Combine IV + authTag + encrypted data\n      const result = {\n        iv: iv.toString('hex'),\n        authTag: authTag.toString('hex'),\n        data: encrypted\n      };\n\n      return JSON.stringify(result);\n    } catch (error) {\n      console.error('Encryption error:', error);\n      throw new Error('Failed to encrypt audit log data');\n    }\n  }\n\n  /**\n   * Decrypt data\n   */\n  private async decrypt(encryptedData: string): Promise<string> {\n    if (!this.config.encryptionKey) {\n      throw new Error('Encryption key not configured');\n    }\n\n    try {\n      const { iv, authTag, data } = JSON.parse(encryptedData);\n\n      // Create decipher\n      const key = crypto.scryptSync(this.config.encryptionKey, 'salt', 32);\n      const decipher = crypto.createDecipheriv(\n        this.encryptionAlgorithm,\n        key,\n        Buffer.from(iv, 'hex')\n      );\n\n      // Set auth tag\n      decipher.setAuthTag(Buffer.from(authTag, 'hex'));\n\n      // Decrypt\n      let decrypted = decipher.update(data, 'hex', 'utf8');\n      decrypted += decipher.final('utf8');\n\n      return decrypted;\n    } catch (error) {\n      console.error('Decryption error:', error);\n      throw new Error('Failed to decrypt audit log data');\n    }\n  }\n\n  /**\n   * Persist logs to storage\n   * In production, this would write to PostgreSQL/MongoDB\n   */\n  private async persistLogs(logs: StoredAuditLog[]): Promise<void> {\n    // Simulate database write\n    // In production, use Prisma or similar ORM:\n    // await prisma.constitutionalAuditLog.createMany({ data: logs });\n    \n    // For now, just log to console in development\n    if (process.env.NODE_ENV === 'development') {\n      console.log(`[Audit] Persisting ${logs.length} logs`);\n    }\n  }\n\n  /**\n   * Retrieve audit logs for a user\n   */\n  async getLogsForUser(\n    userId: string,\n    options: {\n      startDate?: Date;\n      endDate?: Date;\n      limit?: number;\n      offset?: number;\n    } = {}\n  ): Promise<ConstitutionalAuditLog[]> {\n    // In production, query from database\n    // For now, return empty array\n    return [];\n  }\n\n  /**\n   * Get compliance statistics\n   */\n  async getComplianceStats(\n    startDate: Date,\n    endDate: Date\n  ): Promise<{\n    totalLogs: number;\n    averageComplianceScore: number;\n    violationsByType: Record<string, number>;\n    successRate: number;\n  }> {\n    // In production, aggregate from database\n    return {\n      totalLogs: 0,\n      averageComplianceScore: 0,\n      violationsByType: {},\n      successRate: 0\n    };\n  }\n\n  /**\n   * Clean up old logs based on retention policy\n   */\n  async cleanupOldLogs(): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - this.config.retentionDays);\n\n    // In production, delete from database:\n    // const result = await prisma.constitutionalAuditLog.deleteMany({\n    //   where: { timestamp: { lt: cutoffDate } }\n    // });\n    // return result.count;\n\n    return 0;\n  }\n\n  /**\n   * Start automatic flush timer\n   */\n  private startFlushTimer(): void {\n    if (this.flushTimer) {\n      clearInterval(this.flushTimer);\n    }\n\n    this.flushTimer = setInterval(() => {\n      this.flush().catch(error => {\n        console.error('Auto-flush error:', error);\n      });\n    }, this.config.flushInterval);\n  }\n\n  /**\n   * Stop flush timer\n   */\n  private stopFlushTimer(): void {\n    if (this.flushTimer) {\n      clearInterval(this.flushTimer);\n      this.flushTimer = null;\n    }\n  }\n\n  /**\n   * Generate unique log ID\n   */\n  private generateLogId(): string {\n    return `audit_${Date.now()}_${crypto.randomBytes(8).toString('hex')}`;\n  }\n\n  /**\n   * Shutdown logger gracefully\n   */\n  async shutdown(): Promise<void> {\n    this.stopFlushTimer();\n    await this.flush();\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(config: Partial<AuditLoggerConfig>): void {\n    this.config = { ...this.config, ...config };\n\n    // Restart flush timer if interval changed\n    if (config.flushInterval !== undefined) {\n      this.startFlushTimer();\n    }\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): AuditLoggerConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Get buffer size\n   */\n  getBufferSize(): number {\n    return this.logBuffer.length;\n  }\n}\n\n/**\n * Factory function\n */\nexport function createAuditLogger(config?: Partial<AuditLoggerConfig>): AuditLogger {\n  return new AuditLogger(config);\n}\n\n/**\n * Export default instance\n */\nexport default createAuditLogger();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}