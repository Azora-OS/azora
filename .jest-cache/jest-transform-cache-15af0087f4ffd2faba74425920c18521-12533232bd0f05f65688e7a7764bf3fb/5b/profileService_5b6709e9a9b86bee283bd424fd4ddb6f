9e3faef38743b855d1ad66754fc81569
/* istanbul ignore next */
function cov_sf9bx0en6() {
  var path = "/workspaces/azora/services/azora-forge/src/profiles/profileService.ts";
  var hash = "947d55dffb834fcf67f88d7cfe89497446b4b4cc";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/azora-forge/src/profiles/profileService.ts",
    statementMap: {
      "0": {
        start: {
          line: 124,
          column: 44
        },
        end: {
          line: 150,
          column: 5
        }
      },
      "1": {
        start: {
          line: 153,
          column: 4
        },
        end: {
          line: 153,
          column: 83
        }
      },
      "2": {
        start: {
          line: 156,
          column: 4
        },
        end: {
          line: 156,
          column: 84
        }
      },
      "3": {
        start: {
          line: 161,
          column: 4
        },
        end: {
          line: 161,
          column: 47
        }
      },
      "4": {
        start: {
          line: 163,
          column: 4
        },
        end: {
          line: 163,
          column: 19
        }
      },
      "5": {
        start: {
          line: 175,
          column: 4
        },
        end: {
          line: 175,
          column: 16
        }
      },
      "6": {
        start: {
          line: 191,
          column: 4
        },
        end: {
          line: 191,
          column: 59
        }
      },
      "7": {
        start: {
          line: 193,
          column: 4
        },
        end: {
          line: 193,
          column: 40
        }
      },
      "8": {
        start: {
          line: 203,
          column: 41
        },
        end: {
          line: 206,
          column: 5
        }
      },
      "9": {
        start: {
          line: 213,
          column: 4
        },
        end: {
          line: 213,
          column: 79
        }
      },
      "10": {
        start: {
          line: 215,
          column: 4
        },
        end: {
          line: 215,
          column: 25
        }
      },
      "11": {
        start: {
          line: 225,
          column: 43
        },
        end: {
          line: 228,
          column: 5
        }
      },
      "12": {
        start: {
          line: 235,
          column: 4
        },
        end: {
          line: 235,
          column: 81
        }
      },
      "13": {
        start: {
          line: 237,
          column: 4
        },
        end: {
          line: 237,
          column: 26
        }
      },
      "14": {
        start: {
          line: 253,
          column: 4
        },
        end: {
          line: 253,
          column: 77
        }
      },
      "15": {
        start: {
          line: 284,
          column: 4
        },
        end: {
          line: 284,
          column: 56
        }
      },
      "16": {
        start: {
          line: 297,
          column: 4
        },
        end: {
          line: 297,
          column: 74
        }
      },
      "17": {
        start: {
          line: 307,
          column: 40
        },
        end: {
          line: 311,
          column: 5
        }
      },
      "18": {
        start: {
          line: 318,
          column: 4
        },
        end: {
          line: 318,
          column: 92
        }
      },
      "19": {
        start: {
          line: 320,
          column: 4
        },
        end: {
          line: 320,
          column: 26
        }
      },
      "20": {
        start: {
          line: 349,
          column: 4
        },
        end: {
          line: 349,
          column: 38
        }
      },
      "21": {
        start: {
          line: 362,
          column: 4
        },
        end: {
          line: 362,
          column: 14
        }
      },
      "22": {
        start: {
          line: 377,
          column: 4
        },
        end: {
          line: 377,
          column: 52
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 115,
            column: 2
          },
          end: {
            line: 115,
            column: 3
          }
        },
        loc: {
          start: {
            line: 123,
            column: 38
          },
          end: {
            line: 164,
            column: 3
          }
        },
        line: 123
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 169,
            column: 2
          },
          end: {
            line: 169,
            column: 3
          }
        },
        loc: {
          start: {
            line: 169,
            column: 82
          },
          end: {
            line: 176,
            column: 3
          }
        },
        line: 169
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 181,
            column: 2
          },
          end: {
            line: 181,
            column: 3
          }
        },
        loc: {
          start: {
            line: 184,
            column: 37
          },
          end: {
            line: 194,
            column: 3
          }
        },
        line: 184
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 199,
            column: 2
          },
          end: {
            line: 199,
            column: 3
          }
        },
        loc: {
          start: {
            line: 202,
            column: 28
          },
          end: {
            line: 216,
            column: 3
          }
        },
        line: 202
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 221,
            column: 2
          },
          end: {
            line: 221,
            column: 3
          }
        },
        loc: {
          start: {
            line: 224,
            column: 29
          },
          end: {
            line: 238,
            column: 3
          }
        },
        line: 224
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 243,
            column: 2
          },
          end: {
            line: 243,
            column: 3
          }
        },
        loc: {
          start: {
            line: 246,
            column: 19
          },
          end: {
            line: 254,
            column: 3
          }
        },
        line: 246
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 259,
            column: 2
          },
          end: {
            line: 259,
            column: 3
          }
        },
        loc: {
          start: {
            line: 267,
            column: 19
          },
          end: {
            line: 285,
            column: 3
          }
        },
        line: 267
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 290,
            column: 2
          },
          end: {
            line: 290,
            column: 3
          }
        },
        loc: {
          start: {
            line: 290,
            column: 76
          },
          end: {
            line: 298,
            column: 3
          }
        },
        line: 290
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 303,
            column: 2
          },
          end: {
            line: 303,
            column: 3
          }
        },
        loc: {
          start: {
            line: 306,
            column: 26
          },
          end: {
            line: 321,
            column: 3
          }
        },
        line: 306
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 326,
            column: 2
          },
          end: {
            line: 326,
            column: 3
          }
        },
        loc: {
          start: {
            line: 334,
            column: 69
          },
          end: {
            line: 350,
            column: 3
          }
        },
        line: 334
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 355,
            column: 2
          },
          end: {
            line: 355,
            column: 3
          }
        },
        loc: {
          start: {
            line: 355,
            column: 90
          },
          end: {
            line: 363,
            column: 3
          }
        },
        line: 355
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 368,
            column: 2
          },
          end: {
            line: 368,
            column: 3
          }
        },
        loc: {
          start: {
            line: 368,
            column: 63
          },
          end: {
            line: 374,
            column: 3
          }
        },
        line: 368
      },
      "12": {
        name: "(anonymous_12)",
        decl: {
          start: {
            line: 376,
            column: 2
          },
          end: {
            line: 376,
            column: 3
          }
        },
        loc: {
          start: {
            line: 376,
            column: 53
          },
          end: {
            line: 380,
            column: 3
          }
        },
        line: 376
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 355,
            column: 35
          },
          end: {
            line: 355,
            column: 53
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 355,
            column: 51
          },
          end: {
            line: 355,
            column: 53
          }
        }],
        line: 355
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0
    },
    b: {
      "0": [0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "947d55dffb834fcf67f88d7cfe89497446b4b4cc"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_sf9bx0en6 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_sf9bx0en6();
/*
AZORA PROPRIETARY LICENSE

Copyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.

See LICENSE file for details.
*/

import { SkillVerificationService } from '../verification/skillVerificationService';
import { RatingService } from '../ratings/ratingService';
/**
 * ðŸ‘¤ SERVICE PROVIDER PROFILE SERVICE
 * 
 * Comprehensive profiles for sellers showcasing their skills,
 * portfolio, and reputation.
 */
export class ProfileService {
  /**
   * Create a new service provider profile
   */
  static async createProfile(data) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[0]++;
    const profile =
    /* istanbul ignore next */
    (cov_sf9bx0en6().s[0]++, {
      id: `profile_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      ...data,
      timezone: 'Africa/Johannesburg',
      skills: [],
      portfolio: [],
      packages: [],
      availability: {
        status: 'available',
        hoursPerWeek: 40,
        responseTime: 'within 24 hours'
      },
      stats: {
        totalProjects: 0,
        completedProjects: 0,
        ongoingProjects: 0,
        totalEarnings: 0,
        repeatClients: 0,
        averageDeliveryTime: 0
      },
      badges: [],
      achievements: [],
      ratingSummary: {},
      createdAt: new Date(),
      updatedAt: new Date(),
      lastActiveAt: new Date()
    });

    // Load verified skills from Education
    /* istanbul ignore next */
    cov_sf9bx0en6().s[1]++;
    profile.skills = await SkillVerificationService.getVerifiedSkills(data.userId);

    // Load rating summary
    /* istanbul ignore next */
    cov_sf9bx0en6().s[2]++;
    profile.ratingSummary = await RatingService.getSellerRatingSummary(data.userId);

    // TODO: Save to database
    // await prisma.serviceProviderProfile.create({ data: profile });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[3]++;
    this.emitEvent('profile:created', profile);
    /* istanbul ignore next */
    cov_sf9bx0en6().s[4]++;
    return profile;
  }

  /**
   * Get profile by user ID
   */
  static async getProfile(userId) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[1]++;
    cov_sf9bx0en6().s[5]++;
    // TODO: Fetch from database
    // return await prisma.serviceProviderProfile.findUnique({
    //   where: { userId },
    //   include: { portfolio: true, packages: true, skills: true }
    // });
    return null;
  }

  /**
   * Update profile
   */
  static async updateProfile(userId, updates) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[2]++;
    cov_sf9bx0en6().s[6]++;
    // TODO: Update in database
    // await prisma.serviceProviderProfile.update({
    //   where: { userId },
    //   data: { ...updates, updatedAt: new Date() }
    // });

    this.emitEvent('profile:updated', {
      userId,
      updates
    });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[7]++;
    return {};
  }

  /**
   * Add portfolio item
   */
  static async addPortfolioItem(userId, item) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[3]++;
    const portfolioItem =
    /* istanbul ignore next */
    (cov_sf9bx0en6().s[8]++, {
      ...item,
      id: `portfolio_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
    });

    // TODO: Save to database
    // await prisma.portfolioItem.create({
    //   data: { ...portfolioItem, userId }
    // });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[9]++;
    this.emitEvent('profile:portfolio_added', {
      userId,
      item: portfolioItem
    });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[10]++;
    return portfolioItem;
  }

  /**
   * Add service package
   */
  static async addServicePackage(userId, packageData) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[4]++;
    const servicePackage =
    /* istanbul ignore next */
    (cov_sf9bx0en6().s[11]++, {
      ...packageData,
      id: `package_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
    });

    // TODO: Save to database
    // await prisma.servicePackage.create({
    //   data: { ...servicePackage, userId }
    // });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[12]++;
    this.emitEvent('profile:package_added', {
      userId,
      package: servicePackage
    });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[13]++;
    return servicePackage;
  }

  /**
   * Update availability status
   */
  static async updateAvailability(userId, availability) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[5]++;
    cov_sf9bx0en6().s[14]++;
    // TODO: Update in database
    // await prisma.serviceProviderProfile.update({
    //   where: { userId },
    //   data: { availability }
    // });

    this.emitEvent('profile:availability_updated', {
      userId,
      availability
    });
  }

  /**
   * Update profile statistics after project completion
   */
  static async updateProfileStats(userId, projectData) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[6]++;
    cov_sf9bx0en6().s[15]++;
    // TODO: Update in database
    // const profile = await this.getProfile(userId);
    // const updatedStats = {
    //   totalProjects: profile.stats.totalProjects + 1,
    //   completedProjects: projectData.completed ? profile.stats.completedProjects + 1 : profile.stats.completedProjects,
    //   totalEarnings: profile.stats.totalEarnings + projectData.earnings,
    //   repeatClients: projectData.isRepeatClient ? profile.stats.repeatClients + 1 : profile.stats.repeatClients,
    //   // Calculate new average delivery time
    //   averageDeliveryTime: ((profile.stats.averageDeliveryTime * profile.stats.totalProjects) + projectData.deliveryTime) / (profile.stats.totalProjects + 1)
    // };

    // await prisma.serviceProviderProfile.update({
    //   where: { userId },
    //   data: { stats: updatedStats }
    // });

    this.emitEvent('profile:stats_updated', {
      userId
    });
  }

  /**
   * Award badge
   */
  static async awardBadge(userId, badgeName) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[7]++;
    cov_sf9bx0en6().s[16]++;
    // TODO: Add badge to profile
    // await prisma.serviceProviderProfile.update({
    //   where: { userId },
    //   data: { badges: { push: badgeName } }
    // });

    this.emitEvent('profile:badge_awarded', {
      userId,
      badge: badgeName
    });
  }

  /**
   * Unlock achievement
   */
  static async unlockAchievement(userId, achievement) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[8]++;
    const newAchievement =
    /* istanbul ignore next */
    (cov_sf9bx0en6().s[17]++, {
      ...achievement,
      id: `achievement_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      unlockedAt: new Date()
    });

    // TODO: Save to database
    // await prisma.achievement.create({
    //   data: { ...newAchievement, userId }
    // });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[18]++;
    this.emitEvent('profile:achievement_unlocked', {
      userId,
      achievement: newAchievement
    });
    /* istanbul ignore next */
    cov_sf9bx0en6().s[19]++;
    return newAchievement;
  }

  /**
   * Search profiles by skills, location, rating
   */
  static async searchProfiles(filters) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[9]++;
    cov_sf9bx0en6().s[20]++;
    // TODO: Search in database with filters
    // const query: any = {};

    // if (filters.skills) query.skills = { some: { skillName: { in: filters.skills } } };
    // if (filters.location) query.location = { contains: filters.location };
    // if (filters.minRating) query.ratingSummary = { averageRatings: { overall: { gte: filters.minRating } } };
    // if (filters.availability) query.availability = { status: filters.availability };

    // const profiles = await prisma.serviceProviderProfile.findMany({
    //   where: query,
    //   skip: ((filters.page || 1) - 1) * (filters.limit || 20),
    //   take: filters.limit || 20
    // });

    return {
      profiles: [],
      total: 0
    };
  }

  /**
   * Get top-rated profiles
   */
  static async getTopRatedProfiles(limit =
  /* istanbul ignore next */
  (cov_sf9bx0en6().b[0][0]++, 10)) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[10]++;
    cov_sf9bx0en6().s[21]++;
    // TODO: Fetch from database
    // return await prisma.serviceProviderProfile.findMany({
    //   where: { ratingSummary: { averageRatings: { overall: { gte: 4.5 } } } },
    //   orderBy: { ratingSummary: { averageRatings: { overall: 'desc' } } },
    //   take: limit
    // });
    return [];
  }

  /**
   * Update last active time
   */
  static async updateLastActive(userId) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[11]++;
  } // TODO: Update in database
  // await prisma.serviceProviderProfile.update({
  //   where: { userId },
  //   data: { lastActiveAt: new Date() }
  // });
  static emitEvent(event, data) {
    /* istanbul ignore next */
    cov_sf9bx0en6().f[12]++;
    cov_sf9bx0en6().s[22]++;
    console.log(`ðŸ”” Profile Event: ${event}`, data);
    // Emit to organism event bus
    // OrganismEventBus.emit(event, data);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3Zfc2Y5YngwZW42IiwiYWN0dWFsQ292ZXJhZ2UiLCJTa2lsbFZlcmlmaWNhdGlvblNlcnZpY2UiLCJSYXRpbmdTZXJ2aWNlIiwiUHJvZmlsZVNlcnZpY2UiLCJjcmVhdGVQcm9maWxlIiwiZGF0YSIsImYiLCJwcm9maWxlIiwicyIsImlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInRpbWV6b25lIiwic2tpbGxzIiwicG9ydGZvbGlvIiwicGFja2FnZXMiLCJhdmFpbGFiaWxpdHkiLCJzdGF0dXMiLCJob3Vyc1BlcldlZWsiLCJyZXNwb25zZVRpbWUiLCJzdGF0cyIsInRvdGFsUHJvamVjdHMiLCJjb21wbGV0ZWRQcm9qZWN0cyIsIm9uZ29pbmdQcm9qZWN0cyIsInRvdGFsRWFybmluZ3MiLCJyZXBlYXRDbGllbnRzIiwiYXZlcmFnZURlbGl2ZXJ5VGltZSIsImJhZGdlcyIsImFjaGlldmVtZW50cyIsInJhdGluZ1N1bW1hcnkiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJsYXN0QWN0aXZlQXQiLCJnZXRWZXJpZmllZFNraWxscyIsInVzZXJJZCIsImdldFNlbGxlclJhdGluZ1N1bW1hcnkiLCJlbWl0RXZlbnQiLCJnZXRQcm9maWxlIiwidXBkYXRlUHJvZmlsZSIsInVwZGF0ZXMiLCJhZGRQb3J0Zm9saW9JdGVtIiwiaXRlbSIsInBvcnRmb2xpb0l0ZW0iLCJhZGRTZXJ2aWNlUGFja2FnZSIsInBhY2thZ2VEYXRhIiwic2VydmljZVBhY2thZ2UiLCJwYWNrYWdlIiwidXBkYXRlQXZhaWxhYmlsaXR5IiwidXBkYXRlUHJvZmlsZVN0YXRzIiwicHJvamVjdERhdGEiLCJhd2FyZEJhZGdlIiwiYmFkZ2VOYW1lIiwiYmFkZ2UiLCJ1bmxvY2tBY2hpZXZlbWVudCIsImFjaGlldmVtZW50IiwibmV3QWNoaWV2ZW1lbnQiLCJ1bmxvY2tlZEF0Iiwic2VhcmNoUHJvZmlsZXMiLCJmaWx0ZXJzIiwicHJvZmlsZXMiLCJ0b3RhbCIsImdldFRvcFJhdGVkUHJvZmlsZXMiLCJsaW1pdCIsImIiLCJ1cGRhdGVMYXN0QWN0aXZlIiwiZXZlbnQiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZXMiOlsicHJvZmlsZVNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkFaT1JBIFBST1BSSUVUQVJZIExJQ0VOU0VcblxuQ29weXJpZ2h0IMKpIDIwMjUgQXpvcmEgRVMgKFB0eSkgTHRkLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuXG5TZWUgTElDRU5TRSBmaWxlIGZvciBkZXRhaWxzLlxuKi9cblxuaW1wb3J0IHsgU2tpbGxWZXJpZmljYXRpb25TZXJ2aWNlLCBTa2lsbEJhZGdlIH0gZnJvbSAnLi4vdmVyaWZpY2F0aW9uL3NraWxsVmVyaWZpY2F0aW9uU2VydmljZSc7XG5pbXBvcnQgeyBSYXRpbmdTZXJ2aWNlLCBTZWxsZXJSYXRpbmdTdW1tYXJ5IH0gZnJvbSAnLi4vcmF0aW5ncy9yYXRpbmdTZXJ2aWNlJztcblxuZXhwb3J0IGludGVyZmFjZSBTZXJ2aWNlUHJvdmlkZXJQcm9maWxlIHtcbiAgaWQ6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIGRpc3BsYXlOYW1lOiBzdHJpbmc7XG4gIGJpbzogc3RyaW5nO1xuICBhdmF0YXI/OiBzdHJpbmc7XG4gIGNvdmVySW1hZ2U/OiBzdHJpbmc7XG4gIGxvY2F0aW9uOiBzdHJpbmc7XG4gIGxhbmd1YWdlczogc3RyaW5nW107XG4gIHRpbWV6b25lOiBzdHJpbmc7XG4gIFxuICAvLyBTa2lsbHMgJiBWZXJpZmljYXRpb25cbiAgc2tpbGxzOiBTa2lsbEJhZGdlW107XG4gIGV4cGVydGlzZTogc3RyaW5nW107XG4gIHllYXJzT2ZFeHBlcmllbmNlOiBudW1iZXI7XG4gIFxuICAvLyBSYXRpbmdzICYgUmV2aWV3c1xuICByYXRpbmdTdW1tYXJ5OiBTZWxsZXJSYXRpbmdTdW1tYXJ5O1xuICBcbiAgLy8gUG9ydGZvbGlvXG4gIHBvcnRmb2xpbzogUG9ydGZvbGlvSXRlbVtdO1xuICBcbiAgLy8gU2VydmljZSBQYWNrYWdlc1xuICBwYWNrYWdlczogU2VydmljZVBhY2thZ2VbXTtcbiAgXG4gIC8vIEF2YWlsYWJpbGl0eVxuICBhdmFpbGFiaWxpdHk6IHtcbiAgICBzdGF0dXM6ICdhdmFpbGFibGUnIHwgJ2J1c3knIHwgJ3VuYXZhaWxhYmxlJztcbiAgICBob3Vyc1BlcldlZWs6IG51bWJlcjtcbiAgICByZXNwb25zZVRpbWU6IHN0cmluZzsgLy8gZS5nLiwgXCJ3aXRoaW4gMiBob3Vyc1wiXG4gIH07XG4gIFxuICAvLyBTdGF0aXN0aWNzXG4gIHN0YXRzOiB7XG4gICAgdG90YWxQcm9qZWN0czogbnVtYmVyO1xuICAgIGNvbXBsZXRlZFByb2plY3RzOiBudW1iZXI7XG4gICAgb25nb2luZ1Byb2plY3RzOiBudW1iZXI7XG4gICAgdG90YWxFYXJuaW5nczogbnVtYmVyO1xuICAgIHJlcGVhdENsaWVudHM6IG51bWJlcjtcbiAgICBhdmVyYWdlRGVsaXZlcnlUaW1lOiBudW1iZXI7IC8vIGluIGRheXNcbiAgfTtcbiAgXG4gIC8vIEJhZGdlcyAmIEFjaGlldmVtZW50c1xuICBiYWRnZXM6IHN0cmluZ1tdO1xuICBhY2hpZXZlbWVudHM6IEFjaGlldmVtZW50W107XG4gIFxuICAvLyBTb2NpYWwgJiBMaW5rc1xuICBzb2NpYWxMaW5rcz86IHtcbiAgICBsaW5rZWRpbj86IHN0cmluZztcbiAgICB0d2l0dGVyPzogc3RyaW5nO1xuICAgIGdpdGh1Yj86IHN0cmluZztcbiAgICBwb3J0Zm9saW8/OiBzdHJpbmc7XG4gIH07XG4gIFxuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHVwZGF0ZWRBdDogRGF0ZTtcbiAgbGFzdEFjdGl2ZUF0OiBEYXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvcnRmb2xpb0l0ZW0ge1xuICBpZDogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBpbWFnZXM6IHN0cmluZ1tdO1xuICB2aWRlb1VybD86IHN0cmluZztcbiAgdGFnczogc3RyaW5nW107XG4gIGNhdGVnb3J5OiBzdHJpbmc7XG4gIHByb2plY3REYXRlOiBEYXRlO1xuICBjbGllbnROYW1lPzogc3RyaW5nO1xuICB0ZXN0aW1vbmlhbD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXJ2aWNlUGFja2FnZSB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6ICdCYXNpYycgfCAnU3RhbmRhcmQnIHwgJ1ByZW1pdW0nIHwgJ0N1c3RvbSc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHByaWNlOiBudW1iZXI7XG4gIGN1cnJlbmN5OiBzdHJpbmc7XG4gIGRlbGl2ZXJ5VGltZTogbnVtYmVyOyAvLyBpbiBkYXlzXG4gIHJldmlzaW9uczogbnVtYmVyO1xuICBmZWF0dXJlczogc3RyaW5nW107XG4gIGFjdGl2ZTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY2hpZXZlbWVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgaWNvbjogc3RyaW5nO1xuICB1bmxvY2tlZEF0OiBEYXRlO1xufVxuXG4vKipcbiAqIPCfkaQgU0VSVklDRSBQUk9WSURFUiBQUk9GSUxFIFNFUlZJQ0VcbiAqIFxuICogQ29tcHJlaGVuc2l2ZSBwcm9maWxlcyBmb3Igc2VsbGVycyBzaG93Y2FzaW5nIHRoZWlyIHNraWxscyxcbiAqIHBvcnRmb2xpbywgYW5kIHJlcHV0YXRpb24uXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9maWxlU2VydmljZSB7XG4gIFxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IHNlcnZpY2UgcHJvdmlkZXIgcHJvZmlsZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNyZWF0ZVByb2ZpbGUoZGF0YToge1xuICAgIHVzZXJJZDogc3RyaW5nO1xuICAgIGRpc3BsYXlOYW1lOiBzdHJpbmc7XG4gICAgYmlvOiBzdHJpbmc7XG4gICAgbG9jYXRpb246IHN0cmluZztcbiAgICBsYW5ndWFnZXM6IHN0cmluZ1tdO1xuICAgIGV4cGVydGlzZTogc3RyaW5nW107XG4gICAgeWVhcnNPZkV4cGVyaWVuY2U6IG51bWJlcjtcbiAgfSk6IFByb21pc2U8U2VydmljZVByb3ZpZGVyUHJvZmlsZT4ge1xuICAgIGNvbnN0IHByb2ZpbGU6IFNlcnZpY2VQcm92aWRlclByb2ZpbGUgPSB7XG4gICAgICBpZDogYHByb2ZpbGVfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgLi4uZGF0YSxcbiAgICAgIHRpbWV6b25lOiAnQWZyaWNhL0pvaGFubmVzYnVyZycsXG4gICAgICBza2lsbHM6IFtdLFxuICAgICAgcG9ydGZvbGlvOiBbXSxcbiAgICAgIHBhY2thZ2VzOiBbXSxcbiAgICAgIGF2YWlsYWJpbGl0eToge1xuICAgICAgICBzdGF0dXM6ICdhdmFpbGFibGUnLFxuICAgICAgICBob3Vyc1BlcldlZWs6IDQwLFxuICAgICAgICByZXNwb25zZVRpbWU6ICd3aXRoaW4gMjQgaG91cnMnXG4gICAgICB9LFxuICAgICAgc3RhdHM6IHtcbiAgICAgICAgdG90YWxQcm9qZWN0czogMCxcbiAgICAgICAgY29tcGxldGVkUHJvamVjdHM6IDAsXG4gICAgICAgIG9uZ29pbmdQcm9qZWN0czogMCxcbiAgICAgICAgdG90YWxFYXJuaW5nczogMCxcbiAgICAgICAgcmVwZWF0Q2xpZW50czogMCxcbiAgICAgICAgYXZlcmFnZURlbGl2ZXJ5VGltZTogMFxuICAgICAgfSxcbiAgICAgIGJhZGdlczogW10sXG4gICAgICBhY2hpZXZlbWVudHM6IFtdLFxuICAgICAgcmF0aW5nU3VtbWFyeToge30gYXMgU2VsbGVyUmF0aW5nU3VtbWFyeSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIGxhc3RBY3RpdmVBdDogbmV3IERhdGUoKVxuICAgIH07XG5cbiAgICAvLyBMb2FkIHZlcmlmaWVkIHNraWxscyBmcm9tIEVkdWNhdGlvblxuICAgIHByb2ZpbGUuc2tpbGxzID0gYXdhaXQgU2tpbGxWZXJpZmljYXRpb25TZXJ2aWNlLmdldFZlcmlmaWVkU2tpbGxzKGRhdGEudXNlcklkKTtcblxuICAgIC8vIExvYWQgcmF0aW5nIHN1bW1hcnlcbiAgICBwcm9maWxlLnJhdGluZ1N1bW1hcnkgPSBhd2FpdCBSYXRpbmdTZXJ2aWNlLmdldFNlbGxlclJhdGluZ1N1bW1hcnkoZGF0YS51c2VySWQpO1xuXG4gICAgLy8gVE9ETzogU2F2ZSB0byBkYXRhYmFzZVxuICAgIC8vIGF3YWl0IHByaXNtYS5zZXJ2aWNlUHJvdmlkZXJQcm9maWxlLmNyZWF0ZSh7IGRhdGE6IHByb2ZpbGUgfSk7XG5cbiAgICB0aGlzLmVtaXRFdmVudCgncHJvZmlsZTpjcmVhdGVkJywgcHJvZmlsZSk7XG5cbiAgICByZXR1cm4gcHJvZmlsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcHJvZmlsZSBieSB1c2VyIElEXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0UHJvZmlsZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U2VydmljZVByb3ZpZGVyUHJvZmlsZSB8IG51bGw+IHtcbiAgICAvLyBUT0RPOiBGZXRjaCBmcm9tIGRhdGFiYXNlXG4gICAgLy8gcmV0dXJuIGF3YWl0IHByaXNtYS5zZXJ2aWNlUHJvdmlkZXJQcm9maWxlLmZpbmRVbmlxdWUoe1xuICAgIC8vICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgLy8gICBpbmNsdWRlOiB7IHBvcnRmb2xpbzogdHJ1ZSwgcGFja2FnZXM6IHRydWUsIHNraWxsczogdHJ1ZSB9XG4gICAgLy8gfSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVQcm9maWxlKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IFBhcnRpYWw8U2VydmljZVByb3ZpZGVyUHJvZmlsZT5cbiAgKTogUHJvbWlzZTxTZXJ2aWNlUHJvdmlkZXJQcm9maWxlPiB7XG4gICAgLy8gVE9ETzogVXBkYXRlIGluIGRhdGFiYXNlXG4gICAgLy8gYXdhaXQgcHJpc21hLnNlcnZpY2VQcm92aWRlclByb2ZpbGUudXBkYXRlKHtcbiAgICAvLyAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgIC8vICAgZGF0YTogeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfVxuICAgIC8vIH0pO1xuXG4gICAgdGhpcy5lbWl0RXZlbnQoJ3Byb2ZpbGU6dXBkYXRlZCcsIHsgdXNlcklkLCB1cGRhdGVzIH0pO1xuXG4gICAgcmV0dXJuIHt9IGFzIFNlcnZpY2VQcm92aWRlclByb2ZpbGU7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHBvcnRmb2xpbyBpdGVtXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYWRkUG9ydGZvbGlvSXRlbShcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBpdGVtOiBPbWl0PFBvcnRmb2xpb0l0ZW0sICdpZCc+XG4gICk6IFByb21pc2U8UG9ydGZvbGlvSXRlbT4ge1xuICAgIGNvbnN0IHBvcnRmb2xpb0l0ZW06IFBvcnRmb2xpb0l0ZW0gPSB7XG4gICAgICAuLi5pdGVtLFxuICAgICAgaWQ6IGBwb3J0Zm9saW9fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gXG4gICAgfTtcblxuICAgIC8vIFRPRE86IFNhdmUgdG8gZGF0YWJhc2VcbiAgICAvLyBhd2FpdCBwcmlzbWEucG9ydGZvbGlvSXRlbS5jcmVhdGUoe1xuICAgIC8vICAgZGF0YTogeyAuLi5wb3J0Zm9saW9JdGVtLCB1c2VySWQgfVxuICAgIC8vIH0pO1xuXG4gICAgdGhpcy5lbWl0RXZlbnQoJ3Byb2ZpbGU6cG9ydGZvbGlvX2FkZGVkJywgeyB1c2VySWQsIGl0ZW06IHBvcnRmb2xpb0l0ZW0gfSk7XG5cbiAgICByZXR1cm4gcG9ydGZvbGlvSXRlbTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc2VydmljZSBwYWNrYWdlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYWRkU2VydmljZVBhY2thZ2UoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgcGFja2FnZURhdGE6IE9taXQ8U2VydmljZVBhY2thZ2UsICdpZCc+XG4gICk6IFByb21pc2U8U2VydmljZVBhY2thZ2U+IHtcbiAgICBjb25zdCBzZXJ2aWNlUGFja2FnZTogU2VydmljZVBhY2thZ2UgPSB7XG4gICAgICAuLi5wYWNrYWdlRGF0YSxcbiAgICAgIGlkOiBgcGFja2FnZV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWBcbiAgICB9O1xuXG4gICAgLy8gVE9ETzogU2F2ZSB0byBkYXRhYmFzZVxuICAgIC8vIGF3YWl0IHByaXNtYS5zZXJ2aWNlUGFja2FnZS5jcmVhdGUoe1xuICAgIC8vICAgZGF0YTogeyAuLi5zZXJ2aWNlUGFja2FnZSwgdXNlcklkIH1cbiAgICAvLyB9KTtcblxuICAgIHRoaXMuZW1pdEV2ZW50KCdwcm9maWxlOnBhY2thZ2VfYWRkZWQnLCB7IHVzZXJJZCwgcGFja2FnZTogc2VydmljZVBhY2thZ2UgfSk7XG5cbiAgICByZXR1cm4gc2VydmljZVBhY2thZ2U7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGF2YWlsYWJpbGl0eSBzdGF0dXNcbiAgICovXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVBdmFpbGFiaWxpdHkoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgYXZhaWxhYmlsaXR5OiBTZXJ2aWNlUHJvdmlkZXJQcm9maWxlWydhdmFpbGFiaWxpdHknXVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBUT0RPOiBVcGRhdGUgaW4gZGF0YWJhc2VcbiAgICAvLyBhd2FpdCBwcmlzbWEuc2VydmljZVByb3ZpZGVyUHJvZmlsZS51cGRhdGUoe1xuICAgIC8vICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgLy8gICBkYXRhOiB7IGF2YWlsYWJpbGl0eSB9XG4gICAgLy8gfSk7XG5cbiAgICB0aGlzLmVtaXRFdmVudCgncHJvZmlsZTphdmFpbGFiaWxpdHlfdXBkYXRlZCcsIHsgdXNlcklkLCBhdmFpbGFiaWxpdHkgfSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHByb2ZpbGUgc3RhdGlzdGljcyBhZnRlciBwcm9qZWN0IGNvbXBsZXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVQcm9maWxlU3RhdHMoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgcHJvamVjdERhdGE6IHtcbiAgICAgIGNvbXBsZXRlZDogYm9vbGVhbjtcbiAgICAgIGVhcm5pbmdzOiBudW1iZXI7XG4gICAgICBkZWxpdmVyeVRpbWU6IG51bWJlcjtcbiAgICAgIGlzUmVwZWF0Q2xpZW50OiBib29sZWFuO1xuICAgIH1cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gVE9ETzogVXBkYXRlIGluIGRhdGFiYXNlXG4gICAgLy8gY29uc3QgcHJvZmlsZSA9IGF3YWl0IHRoaXMuZ2V0UHJvZmlsZSh1c2VySWQpO1xuICAgIC8vIGNvbnN0IHVwZGF0ZWRTdGF0cyA9IHtcbiAgICAvLyAgIHRvdGFsUHJvamVjdHM6IHByb2ZpbGUuc3RhdHMudG90YWxQcm9qZWN0cyArIDEsXG4gICAgLy8gICBjb21wbGV0ZWRQcm9qZWN0czogcHJvamVjdERhdGEuY29tcGxldGVkID8gcHJvZmlsZS5zdGF0cy5jb21wbGV0ZWRQcm9qZWN0cyArIDEgOiBwcm9maWxlLnN0YXRzLmNvbXBsZXRlZFByb2plY3RzLFxuICAgIC8vICAgdG90YWxFYXJuaW5nczogcHJvZmlsZS5zdGF0cy50b3RhbEVhcm5pbmdzICsgcHJvamVjdERhdGEuZWFybmluZ3MsXG4gICAgLy8gICByZXBlYXRDbGllbnRzOiBwcm9qZWN0RGF0YS5pc1JlcGVhdENsaWVudCA/IHByb2ZpbGUuc3RhdHMucmVwZWF0Q2xpZW50cyArIDEgOiBwcm9maWxlLnN0YXRzLnJlcGVhdENsaWVudHMsXG4gICAgLy8gICAvLyBDYWxjdWxhdGUgbmV3IGF2ZXJhZ2UgZGVsaXZlcnkgdGltZVxuICAgIC8vICAgYXZlcmFnZURlbGl2ZXJ5VGltZTogKChwcm9maWxlLnN0YXRzLmF2ZXJhZ2VEZWxpdmVyeVRpbWUgKiBwcm9maWxlLnN0YXRzLnRvdGFsUHJvamVjdHMpICsgcHJvamVjdERhdGEuZGVsaXZlcnlUaW1lKSAvIChwcm9maWxlLnN0YXRzLnRvdGFsUHJvamVjdHMgKyAxKVxuICAgIC8vIH07XG5cbiAgICAvLyBhd2FpdCBwcmlzbWEuc2VydmljZVByb3ZpZGVyUHJvZmlsZS51cGRhdGUoe1xuICAgIC8vICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgLy8gICBkYXRhOiB7IHN0YXRzOiB1cGRhdGVkU3RhdHMgfVxuICAgIC8vIH0pO1xuXG4gICAgdGhpcy5lbWl0RXZlbnQoJ3Byb2ZpbGU6c3RhdHNfdXBkYXRlZCcsIHsgdXNlcklkIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEF3YXJkIGJhZGdlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYXdhcmRCYWRnZSh1c2VySWQ6IHN0cmluZywgYmFkZ2VOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBUT0RPOiBBZGQgYmFkZ2UgdG8gcHJvZmlsZVxuICAgIC8vIGF3YWl0IHByaXNtYS5zZXJ2aWNlUHJvdmlkZXJQcm9maWxlLnVwZGF0ZSh7XG4gICAgLy8gICB3aGVyZTogeyB1c2VySWQgfSxcbiAgICAvLyAgIGRhdGE6IHsgYmFkZ2VzOiB7IHB1c2g6IGJhZGdlTmFtZSB9IH1cbiAgICAvLyB9KTtcblxuICAgIHRoaXMuZW1pdEV2ZW50KCdwcm9maWxlOmJhZGdlX2F3YXJkZWQnLCB7IHVzZXJJZCwgYmFkZ2U6IGJhZGdlTmFtZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVbmxvY2sgYWNoaWV2ZW1lbnRcbiAgICovXG4gIHN0YXRpYyBhc3luYyB1bmxvY2tBY2hpZXZlbWVudChcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBhY2hpZXZlbWVudDogT21pdDxBY2hpZXZlbWVudCwgJ2lkJyB8ICd1bmxvY2tlZEF0Jz5cbiAgKTogUHJvbWlzZTxBY2hpZXZlbWVudD4ge1xuICAgIGNvbnN0IG5ld0FjaGlldmVtZW50OiBBY2hpZXZlbWVudCA9IHtcbiAgICAgIC4uLmFjaGlldmVtZW50LFxuICAgICAgaWQ6IGBhY2hpZXZlbWVudF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICB1bmxvY2tlZEF0OiBuZXcgRGF0ZSgpXG4gICAgfTtcblxuICAgIC8vIFRPRE86IFNhdmUgdG8gZGF0YWJhc2VcbiAgICAvLyBhd2FpdCBwcmlzbWEuYWNoaWV2ZW1lbnQuY3JlYXRlKHtcbiAgICAvLyAgIGRhdGE6IHsgLi4ubmV3QWNoaWV2ZW1lbnQsIHVzZXJJZCB9XG4gICAgLy8gfSk7XG5cbiAgICB0aGlzLmVtaXRFdmVudCgncHJvZmlsZTphY2hpZXZlbWVudF91bmxvY2tlZCcsIHsgdXNlcklkLCBhY2hpZXZlbWVudDogbmV3QWNoaWV2ZW1lbnQgfSk7XG5cbiAgICByZXR1cm4gbmV3QWNoaWV2ZW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNoIHByb2ZpbGVzIGJ5IHNraWxscywgbG9jYXRpb24sIHJhdGluZ1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIHNlYXJjaFByb2ZpbGVzKGZpbHRlcnM6IHtcbiAgICBza2lsbHM/OiBzdHJpbmdbXTtcbiAgICBsb2NhdGlvbj86IHN0cmluZztcbiAgICBtaW5SYXRpbmc/OiBudW1iZXI7XG4gICAgYXZhaWxhYmlsaXR5PzogJ2F2YWlsYWJsZScgfCAnYnVzeScgfCAndW5hdmFpbGFibGUnO1xuICAgIG1heFByaWNlPzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gIH0pOiBQcm9taXNlPHsgcHJvZmlsZXM6IFNlcnZpY2VQcm92aWRlclByb2ZpbGVbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgLy8gVE9ETzogU2VhcmNoIGluIGRhdGFiYXNlIHdpdGggZmlsdGVyc1xuICAgIC8vIGNvbnN0IHF1ZXJ5OiBhbnkgPSB7fTtcbiAgICBcbiAgICAvLyBpZiAoZmlsdGVycy5za2lsbHMpIHF1ZXJ5LnNraWxscyA9IHsgc29tZTogeyBza2lsbE5hbWU6IHsgaW46IGZpbHRlcnMuc2tpbGxzIH0gfSB9O1xuICAgIC8vIGlmIChmaWx0ZXJzLmxvY2F0aW9uKSBxdWVyeS5sb2NhdGlvbiA9IHsgY29udGFpbnM6IGZpbHRlcnMubG9jYXRpb24gfTtcbiAgICAvLyBpZiAoZmlsdGVycy5taW5SYXRpbmcpIHF1ZXJ5LnJhdGluZ1N1bW1hcnkgPSB7IGF2ZXJhZ2VSYXRpbmdzOiB7IG92ZXJhbGw6IHsgZ3RlOiBmaWx0ZXJzLm1pblJhdGluZyB9IH0gfTtcbiAgICAvLyBpZiAoZmlsdGVycy5hdmFpbGFiaWxpdHkpIHF1ZXJ5LmF2YWlsYWJpbGl0eSA9IHsgc3RhdHVzOiBmaWx0ZXJzLmF2YWlsYWJpbGl0eSB9O1xuXG4gICAgLy8gY29uc3QgcHJvZmlsZXMgPSBhd2FpdCBwcmlzbWEuc2VydmljZVByb3ZpZGVyUHJvZmlsZS5maW5kTWFueSh7XG4gICAgLy8gICB3aGVyZTogcXVlcnksXG4gICAgLy8gICBza2lwOiAoKGZpbHRlcnMucGFnZSB8fCAxKSAtIDEpICogKGZpbHRlcnMubGltaXQgfHwgMjApLFxuICAgIC8vICAgdGFrZTogZmlsdGVycy5saW1pdCB8fCAyMFxuICAgIC8vIH0pO1xuXG4gICAgcmV0dXJuIHsgcHJvZmlsZXM6IFtdLCB0b3RhbDogMCB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0b3AtcmF0ZWQgcHJvZmlsZXNcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRUb3BSYXRlZFByb2ZpbGVzKGxpbWl0OiBudW1iZXIgPSAxMCk6IFByb21pc2U8U2VydmljZVByb3ZpZGVyUHJvZmlsZVtdPiB7XG4gICAgLy8gVE9ETzogRmV0Y2ggZnJvbSBkYXRhYmFzZVxuICAgIC8vIHJldHVybiBhd2FpdCBwcmlzbWEuc2VydmljZVByb3ZpZGVyUHJvZmlsZS5maW5kTWFueSh7XG4gICAgLy8gICB3aGVyZTogeyByYXRpbmdTdW1tYXJ5OiB7IGF2ZXJhZ2VSYXRpbmdzOiB7IG92ZXJhbGw6IHsgZ3RlOiA0LjUgfSB9IH0gfSxcbiAgICAvLyAgIG9yZGVyQnk6IHsgcmF0aW5nU3VtbWFyeTogeyBhdmVyYWdlUmF0aW5nczogeyBvdmVyYWxsOiAnZGVzYycgfSB9IH0sXG4gICAgLy8gICB0YWtlOiBsaW1pdFxuICAgIC8vIH0pO1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgbGFzdCBhY3RpdmUgdGltZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHVwZGF0ZUxhc3RBY3RpdmUodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBUT0RPOiBVcGRhdGUgaW4gZGF0YWJhc2VcbiAgICAvLyBhd2FpdCBwcmlzbWEuc2VydmljZVByb3ZpZGVyUHJvZmlsZS51cGRhdGUoe1xuICAgIC8vICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgLy8gICBkYXRhOiB7IGxhc3RBY3RpdmVBdDogbmV3IERhdGUoKSB9XG4gICAgLy8gfSk7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBlbWl0RXZlbnQoZXZlbnQ6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgY29uc29sZS5sb2coYPCflJQgUHJvZmlsZSBFdmVudDogJHtldmVudH1gLCBkYXRhKTtcbiAgICAvLyBFbWl0IHRvIG9yZ2FuaXNtIGV2ZW50IGJ1c1xuICAgIC8vIE9yZ2FuaXNtRXZlbnRCdXMuZW1pdChldmVudCwgZGF0YSk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFlWTtJQUFBQSxhQUFBLFlBQUFBLENBQUE7TUFBQSxPQUFBQyxjQUFBO0lBQUE7RUFBQTtFQUFBLE9BQUFBLGNBQUE7QUFBQTtBQUFBRCxhQUFBO0FBZlo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0Usd0JBQXdCLFFBQW9CLDBDQUEwQztBQUMvRixTQUFTQyxhQUFhLFFBQTZCLDBCQUEwQjtBQThGN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxNQUFNQyxjQUFjLENBQUM7RUFFMUI7QUFDRjtBQUNBO0VBQ0UsYUFBYUMsYUFBYUEsQ0FBQ0MsSUFRMUIsRUFBbUM7SUFBQTtJQUFBTixhQUFBLEdBQUFPLENBQUE7SUFDbEMsTUFBTUMsT0FBK0I7SUFBQTtJQUFBLENBQUFSLGFBQUEsR0FBQVMsQ0FBQSxPQUFHO01BQ3RDQyxFQUFFLEVBQUUsV0FBV0MsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxJQUFJQyxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUNDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtNQUN0RSxHQUFHVixJQUFJO01BQ1BXLFFBQVEsRUFBRSxxQkFBcUI7TUFDL0JDLE1BQU0sRUFBRSxFQUFFO01BQ1ZDLFNBQVMsRUFBRSxFQUFFO01BQ2JDLFFBQVEsRUFBRSxFQUFFO01BQ1pDLFlBQVksRUFBRTtRQUNaQyxNQUFNLEVBQUUsV0FBVztRQUNuQkMsWUFBWSxFQUFFLEVBQUU7UUFDaEJDLFlBQVksRUFBRTtNQUNoQixDQUFDO01BQ0RDLEtBQUssRUFBRTtRQUNMQyxhQUFhLEVBQUUsQ0FBQztRQUNoQkMsaUJBQWlCLEVBQUUsQ0FBQztRQUNwQkMsZUFBZSxFQUFFLENBQUM7UUFDbEJDLGFBQWEsRUFBRSxDQUFDO1FBQ2hCQyxhQUFhLEVBQUUsQ0FBQztRQUNoQkMsbUJBQW1CLEVBQUU7TUFDdkIsQ0FBQztNQUNEQyxNQUFNLEVBQUUsRUFBRTtNQUNWQyxZQUFZLEVBQUUsRUFBRTtNQUNoQkMsYUFBYSxFQUFFLENBQUMsQ0FBd0I7TUFDeENDLFNBQVMsRUFBRSxJQUFJeEIsSUFBSSxDQUFDLENBQUM7TUFDckJ5QixTQUFTLEVBQUUsSUFBSXpCLElBQUksQ0FBQyxDQUFDO01BQ3JCMEIsWUFBWSxFQUFFLElBQUkxQixJQUFJLENBQUM7SUFDekIsQ0FBQzs7SUFFRDtJQUFBO0lBQUFYLGFBQUEsR0FBQVMsQ0FBQTtJQUNBRCxPQUFPLENBQUNVLE1BQU0sR0FBRyxNQUFNaEIsd0JBQXdCLENBQUNvQyxpQkFBaUIsQ0FBQ2hDLElBQUksQ0FBQ2lDLE1BQU0sQ0FBQzs7SUFFOUU7SUFBQTtJQUFBdkMsYUFBQSxHQUFBUyxDQUFBO0lBQ0FELE9BQU8sQ0FBQzBCLGFBQWEsR0FBRyxNQUFNL0IsYUFBYSxDQUFDcUMsc0JBQXNCLENBQUNsQyxJQUFJLENBQUNpQyxNQUFNLENBQUM7O0lBRS9FO0lBQ0E7SUFBQTtJQUFBdkMsYUFBQSxHQUFBUyxDQUFBO0lBRUEsSUFBSSxDQUFDZ0MsU0FBUyxDQUFDLGlCQUFpQixFQUFFakMsT0FBTyxDQUFDO0lBQUM7SUFBQVIsYUFBQSxHQUFBUyxDQUFBO0lBRTNDLE9BQU9ELE9BQU87RUFDaEI7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsYUFBYWtDLFVBQVVBLENBQUNILE1BQWMsRUFBMEM7SUFBQTtJQUFBdkMsYUFBQSxHQUFBTyxDQUFBO0lBQUFQLGFBQUEsR0FBQVMsQ0FBQTtJQUM5RTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0EsT0FBTyxJQUFJO0VBQ2I7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsYUFBYWtDLGFBQWFBLENBQ3hCSixNQUFjLEVBQ2RLLE9BQXdDLEVBQ1A7SUFBQTtJQUFBNUMsYUFBQSxHQUFBTyxDQUFBO0lBQUFQLGFBQUEsR0FBQVMsQ0FBQTtJQUNqQztJQUNBO0lBQ0E7SUFDQTtJQUNBOztJQUVBLElBQUksQ0FBQ2dDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRTtNQUFFRixNQUFNO01BQUVLO0lBQVEsQ0FBQyxDQUFDO0lBQUM7SUFBQTVDLGFBQUEsR0FBQVMsQ0FBQTtJQUV2RCxPQUFPLENBQUMsQ0FBQztFQUNYOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLGFBQWFvQyxnQkFBZ0JBLENBQzNCTixNQUFjLEVBQ2RPLElBQStCLEVBQ1A7SUFBQTtJQUFBOUMsYUFBQSxHQUFBTyxDQUFBO0lBQ3hCLE1BQU13QyxhQUE0QjtJQUFBO0lBQUEsQ0FBQS9DLGFBQUEsR0FBQVMsQ0FBQSxPQUFHO01BQ25DLEdBQUdxQyxJQUFJO01BQ1BwQyxFQUFFLEVBQUUsYUFBYUMsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxJQUFJQyxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUNDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDeEUsQ0FBQzs7SUFFRDtJQUNBO0lBQ0E7SUFDQTtJQUFBO0lBQUFoQixhQUFBLEdBQUFTLENBQUE7SUFFQSxJQUFJLENBQUNnQyxTQUFTLENBQUMseUJBQXlCLEVBQUU7TUFBRUYsTUFBTTtNQUFFTyxJQUFJLEVBQUVDO0lBQWMsQ0FBQyxDQUFDO0lBQUM7SUFBQS9DLGFBQUEsR0FBQVMsQ0FBQTtJQUUzRSxPQUFPc0MsYUFBYTtFQUN0Qjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxhQUFhQyxpQkFBaUJBLENBQzVCVCxNQUFjLEVBQ2RVLFdBQXVDLEVBQ2Q7SUFBQTtJQUFBakQsYUFBQSxHQUFBTyxDQUFBO0lBQ3pCLE1BQU0yQyxjQUE4QjtJQUFBO0lBQUEsQ0FBQWxELGFBQUEsR0FBQVMsQ0FBQSxRQUFHO01BQ3JDLEdBQUd3QyxXQUFXO01BQ2R2QyxFQUFFLEVBQUUsV0FBV0MsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxJQUFJQyxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUNDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDdEUsQ0FBQzs7SUFFRDtJQUNBO0lBQ0E7SUFDQTtJQUFBO0lBQUFoQixhQUFBLEdBQUFTLENBQUE7SUFFQSxJQUFJLENBQUNnQyxTQUFTLENBQUMsdUJBQXVCLEVBQUU7TUFBRUYsTUFBTTtNQUFFWSxPQUFPLEVBQUVEO0lBQWUsQ0FBQyxDQUFDO0lBQUM7SUFBQWxELGFBQUEsR0FBQVMsQ0FBQTtJQUU3RSxPQUFPeUMsY0FBYztFQUN2Qjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxhQUFhRSxrQkFBa0JBLENBQzdCYixNQUFjLEVBQ2RsQixZQUFvRCxFQUNyQztJQUFBO0lBQUFyQixhQUFBLEdBQUFPLENBQUE7SUFBQVAsYUFBQSxHQUFBUyxDQUFBO0lBQ2Y7SUFDQTtJQUNBO0lBQ0E7SUFDQTs7SUFFQSxJQUFJLENBQUNnQyxTQUFTLENBQUMsOEJBQThCLEVBQUU7TUFBRUYsTUFBTTtNQUFFbEI7SUFBYSxDQUFDLENBQUM7RUFDMUU7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsYUFBYWdDLGtCQUFrQkEsQ0FDN0JkLE1BQWMsRUFDZGUsV0FLQyxFQUNjO0lBQUE7SUFBQXRELGFBQUEsR0FBQU8sQ0FBQTtJQUFBUCxhQUFBLEdBQUFTLENBQUE7SUFDZjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTs7SUFFQTtJQUNBO0lBQ0E7SUFDQTs7SUFFQSxJQUFJLENBQUNnQyxTQUFTLENBQUMsdUJBQXVCLEVBQUU7TUFBRUY7SUFBTyxDQUFDLENBQUM7RUFDckQ7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsYUFBYWdCLFVBQVVBLENBQUNoQixNQUFjLEVBQUVpQixTQUFpQixFQUFpQjtJQUFBO0lBQUF4RCxhQUFBLEdBQUFPLENBQUE7SUFBQVAsYUFBQSxHQUFBUyxDQUFBO0lBQ3hFO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7O0lBRUEsSUFBSSxDQUFDZ0MsU0FBUyxDQUFDLHVCQUF1QixFQUFFO01BQUVGLE1BQU07TUFBRWtCLEtBQUssRUFBRUQ7SUFBVSxDQUFDLENBQUM7RUFDdkU7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsYUFBYUUsaUJBQWlCQSxDQUM1Qm5CLE1BQWMsRUFDZG9CLFdBQW1ELEVBQzdCO0lBQUE7SUFBQTNELGFBQUEsR0FBQU8sQ0FBQTtJQUN0QixNQUFNcUQsY0FBMkI7SUFBQTtJQUFBLENBQUE1RCxhQUFBLEdBQUFTLENBQUEsUUFBRztNQUNsQyxHQUFHa0QsV0FBVztNQUNkakQsRUFBRSxFQUFFLGVBQWVDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsSUFBSUMsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUNDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7TUFDMUU2QyxVQUFVLEVBQUUsSUFBSWxELElBQUksQ0FBQztJQUN2QixDQUFDOztJQUVEO0lBQ0E7SUFDQTtJQUNBO0lBQUE7SUFBQVgsYUFBQSxHQUFBUyxDQUFBO0lBRUEsSUFBSSxDQUFDZ0MsU0FBUyxDQUFDLDhCQUE4QixFQUFFO01BQUVGLE1BQU07TUFBRW9CLFdBQVcsRUFBRUM7SUFBZSxDQUFDLENBQUM7SUFBQztJQUFBNUQsYUFBQSxHQUFBUyxDQUFBO0lBRXhGLE9BQU9tRCxjQUFjO0VBQ3ZCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLGFBQWFFLGNBQWNBLENBQUNDLE9BUTNCLEVBQWtFO0lBQUE7SUFBQS9ELGFBQUEsR0FBQU8sQ0FBQTtJQUFBUCxhQUFBLEdBQUFTLENBQUE7SUFDakU7SUFDQTs7SUFFQTtJQUNBO0lBQ0E7SUFDQTs7SUFFQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOztJQUVBLE9BQU87TUFBRXVELFFBQVEsRUFBRSxFQUFFO01BQUVDLEtBQUssRUFBRTtJQUFFLENBQUM7RUFDbkM7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsYUFBYUMsbUJBQW1CQSxDQUFDQyxLQUFhO0VBQUE7RUFBQSxDQUFBbkUsYUFBQSxHQUFBb0UsQ0FBQSxVQUFHLEVBQUUsR0FBcUM7SUFBQTtJQUFBcEUsYUFBQSxHQUFBTyxDQUFBO0lBQUFQLGFBQUEsR0FBQVMsQ0FBQTtJQUN0RjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQSxPQUFPLEVBQUU7RUFDWDs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxhQUFhNEQsZ0JBQWdCQSxDQUFDOUIsTUFBYyxFQUFpQjtJQUFBO0lBQUF2QyxhQUFBLEdBQUFPLENBQUE7RUFNN0QsQ0FBQyxDQUxDO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFHRixPQUFla0MsU0FBU0EsQ0FBQzZCLEtBQWEsRUFBRWhFLElBQVMsRUFBRTtJQUFBO0lBQUFOLGFBQUEsR0FBQU8sQ0FBQTtJQUFBUCxhQUFBLEdBQUFTLENBQUE7SUFDakQ4RCxPQUFPLENBQUNDLEdBQUcsQ0FBQyxxQkFBcUJGLEtBQUssRUFBRSxFQUFFaEUsSUFBSSxDQUFDO0lBQy9DO0lBQ0E7RUFDRjtBQUNGIiwiaWdub3JlTGlzdCI6W119