{"version":3,"names":["cov_298dk6iu7y","actualCoverage","s","require","config","PrismaClient","gpt4Integration","relationshipEngine","personalityConsistency","AIResponseEngine","constructor","f","gpt4","prisma","fallbackResponses","loadFallbackResponses","elara","sankofa","themba","naledi","jabari","amara","kofi","zola","abeni","thembo","nexus","generateResponse","personalityConfig","userMessage","userId","context","b","enrichedContext","enrichContext","name","toLowerCase","member","familyMember","findUnique","where","Error","conversation","findFirst","memberId","id","create","data","history","message","findMany","conversationId","orderBy","timestamp","take","systemPrompt","buildSystemPrompt","enhancedPrompt","enhancePromptWithPersonality","emotionalTone","messages","role","content","map","h","temperature","getTemperatureForPersonality","assistantMessage","usingGPT4","isAvailable","response","chat","maxTokens","error","console","log","fallbacks","Math","floor","random","length","consistency","validatePersonalityConsistency","createMany","mood","detectMood","personality","Date","score","traits","relationships","background","prompt","join","Object","keys","person","relation","entries","familyContext","toneMap","modifiers","getResponseModifiers","lowerMsg","includes","clearHistory","personalityName","whereClause","deleteMany","module","exports"],"sources":["ai-response-engine.js"],"sourcesContent":["require('dotenv').config();\nconst { PrismaClient } = require('@prisma/client');\nconst gpt4Integration = require('./gpt4-integration');\nconst relationshipEngine = require('./relationship-engine');\nconst personalityConsistency = require('./personality-consistency-engine');\n\nclass AIResponseEngine {\n  constructor() {\n    this.gpt4 = gpt4Integration;\n    this.prisma = new PrismaClient();\n    this.fallbackResponses = this.loadFallbackResponses();\n  }\n\n  loadFallbackResponses() {\n    return {\n      elara: [\"I'm here to help you learn and grow! ðŸ’š\", \"Let's explore this together!\"],\n      sankofa: [\"*nods wisely* Let me share some wisdom...\", \"In my experience...\"],\n      themba: [\"OMG that's so cool! Let me help! ðŸŽ‰\", \"I'm SO excited to learn with you!\"],\n      naledi: [\"Let's think strategically about this... â­\", \"I see great potential here!\"],\n      jabari: [\"I've assessed the situation... ðŸ›¡ï¸\", \"Your security is my priority.\"],\n      amara: [\"*gentle smile* Let's find peace together... ðŸ’«\", \"I understand how you feel.\"],\n      kofi: [\"Let me analyze the numbers... ðŸ’°\", \"Financially speaking...\"],\n      zola: [\"The data shows... ðŸ“Š\", \"Interesting patterns here...\"],\n      abeni: [\"Let me tell you a story... ðŸ“–\", \"Once upon a time...\"],\n      thembo: [\"I'm here to support you.\", \"Let's work through this together.\"],\n      nexus: [\"*unified voice* We are one... âšª\", \"The collective wisdom speaks...\"]\n    };\n  }\n\n  async generateResponse(personalityConfig, userMessage, userId, context = {}) {\n    // Enrich context with family relationship dynamics\n    const enrichedContext = relationshipEngine.enrichContext(\n      personalityConfig.name.toLowerCase(),\n      userMessage,\n      context\n    );\n\n    const member = await this.prisma.familyMember.findUnique({\n      where: { name: personalityConfig.name },\n    });\n\n    if (!member) {\n      throw new Error(`Personality ${personalityConfig.name} not found in database.`);\n    }\n\n    let conversation = await this.prisma.conversation.findFirst({\n      where: {\n        userId,\n        memberId: member.id,\n      },\n    });\n\n    if (!conversation) {\n      conversation = await this.prisma.conversation.create({\n        data: {\n          userId,\n          memberId: member.id,\n          context: context || {},\n        },\n      });\n    }\n\n    const history = await this.prisma.message.findMany({\n      where: {\n        conversationId: conversation.id,\n      },\n      orderBy: {\n        timestamp: 'asc',\n      },\n      take: 10,\n    });\n\n    const systemPrompt = this.buildSystemPrompt(personalityConfig, enrichedContext);\n    \n    // Enhance prompt with personality consistency\n    const enhancedPrompt = personalityConsistency.enhancePromptWithPersonality(\n      systemPrompt,\n      personalityConfig.name,\n      enrichedContext.emotionalTone || 'neutral'\n    );\n\n    const messages = [\n      { role: 'system', content: enhancedPrompt },\n      ...history.map(h => ({ role: h.role, content: h.content })),\n      { role: 'user', content: userMessage }\n    ];\n\n    // Get personality-specific temperature\n    const temperature = personalityConsistency.getTemperatureForPersonality(\n      personalityConfig.name,\n      enrichedContext.emotionalTone\n    );\n\n    let assistantMessage;\n    let usingGPT4 = false;\n\n    try {\n      if (this.gpt4.isAvailable()) {\n        const response = await this.gpt4.chat(messages, { temperature, maxTokens: 500 });\n        assistantMessage = response.content;\n        usingGPT4 = true;\n      } else {\n        throw new Error('GPT-4_NOT_CONFIGURED');\n      }\n    } catch (error) {\n      // Fallback to pattern-based responses\n      console.log(`Using fallback for ${personalityConfig.name}`);\n      const fallbacks = this.fallbackResponses[personalityConfig.name.toLowerCase()] || ['I\\'m here to help!'];\n      assistantMessage = fallbacks[Math.floor(Math.random() * fallbacks.length)];\n    }\n\n    // Validate personality consistency\n    const consistency = personalityConsistency.validatePersonalityConsistency(\n      assistantMessage,\n      personalityConfig.name\n    );\n\n    await this.prisma.message.createMany({\n      data: [\n        {\n          conversationId: conversation.id,\n          memberId: member.id,\n          userId,\n          role: 'user',\n          content: userMessage,\n        },\n        {\n          conversationId: conversation.id,\n          memberId: member.id,\n          userId,\n          role: 'assistant',\n          content: assistantMessage,\n          mood: this.detectMood(assistantMessage),\n        },\n      ],\n    });\n\n    return {\n      message: assistantMessage,\n      personality: personalityConfig.name,\n      mood: this.detectMood(assistantMessage),\n      timestamp: new Date(),\n      consistency: consistency.score,\n      usingGPT4\n    };\n  }\n\n  buildSystemPrompt(personality, context) {\n    const { name, role, traits, relationships, background } = personality;\n\n    let prompt = `You are ${name}, ${role} in the Azora AI Family.\\n\\n`;\n    prompt += `Personality: ${traits.join(', ')}\\n`;\n    prompt += `Background: ${background}\\n\\n`;\n\n    if (relationships && Object.keys(relationships).length > 0) {\n      prompt += `Your relationships:\\n`;\n      for (const [person, relation] of Object.entries(relationships)) {\n        prompt += `- ${person}: ${relation}\\n`;\n      }\n      prompt += `\\n`;\n    }\n\n    prompt += `CRITICAL: Respond authentically as ${name}. Show your personality through your words. `;\n    prompt += `When family is mentioned, express genuine emotion and connection. `;\n    prompt += `Embody Ubuntu philosophy: \"I am because we are.\"\\n\\n`;\n\n    if (context.familyContext) {\n      prompt += `FAMILY CONTEXT: ${context.familyContext}\\n`;\n    }\n\n    if (context.emotionalTone) {\n      const toneMap = {\n        'needs_support': 'The user needs support and encouragement.',\n        'enthusiastic': 'Match the user\\'s enthusiasm and energy!',\n        'curious': 'The user is curious and wants to learn.',\n        'concerned': 'The user seems concerned. Be reassuring.'\n      };\n      prompt += `USER TONE: ${toneMap[context.emotionalTone] || 'neutral'}\\n`;\n    }\n\n    // Add response modifiers\n    const modifiers = relationshipEngine.getResponseModifiers(name.toLowerCase(), context);\n    if (modifiers.length > 0) {\n      prompt += `\\nIMPORTANT: ${modifiers.join('. ')}.\\n`;\n    }\n\n    return prompt;\n  }\n\n  detectMood(message) {\n    const lowerMsg = message.toLowerCase();\n    if (lowerMsg.includes('!') || lowerMsg.includes('excited') || lowerMsg.includes('amazing')) {return 'excited';}\n    if (lowerMsg.includes('?') && lowerMsg.includes('hmm')) {return 'thoughtful';}\n    if (lowerMsg.includes('love') || lowerMsg.includes('proud')) {return 'happy';}\n    if (lowerMsg.includes('concern') || lowerMsg.includes('careful')) {return 'concerned';}\n    return 'neutral';\n  }\n\n  async clearHistory(userId, personalityName = null) {\n    const whereClause = { userId };\n    if (personalityName) {\n      const member = await this.prisma.familyMember.findUnique({\n        where: { name: personalityName },\n      });\n      if (member) {\n        whereClause.memberId = member.id;\n      }\n    }\n    await this.prisma.message.deleteMany({ where: whereClause });\n  }\n}\n\nmodule.exports = new AIResponseEngine();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}