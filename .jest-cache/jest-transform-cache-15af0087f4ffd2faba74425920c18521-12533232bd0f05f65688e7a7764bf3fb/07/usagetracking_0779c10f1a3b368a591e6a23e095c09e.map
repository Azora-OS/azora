{"version":3,"names":["cov_fc2pjv7zb","actualCoverage","PrismaClient","logger","ErrorHandler","prisma","s","UsageTrackingService","trackUsage","licenseId","metrics","f","info","license","enterpriseLicense","findUnique","where","id","b","Error","enterpriseUsageTracking","create","data","activeUsers","coursesCreated","apiCallsUsed","storageUsed","maxUsers","warn","limit","current","maxCourses","maxApiCalls","error","handle","getCurrentUsage","latestUsage","findFirst","orderBy","date","getUsageReport","startDate","endDate","usageRecords","findMany","gte","lte","map","record","percentageUsed","users","courses","apiCalls","getUsageStats","stats","aggregate","_avg","_max","_sum","_count","averageActiveUsers","Math","round","maxActiveUsers","totalCoursesCreated","totalApiCalls","totalStorageUsed","recordCount","checkLimits","currentUsage","usersExceeded","coursesExceeded","apiCallsExceeded","getUsageAlerts","thresholdPercent","alerts","userPercent","push","coursePercent","apiPercent"],"sources":["usage-tracking.ts"],"sourcesContent":["/**\n * Enterprise Usage Tracking Service\n * Tracks usage metrics for enterprise licenses\n */\n\nimport { PrismaClient } from '@prisma/client';\nimport { logger } from '../shared/logging';\nimport { ErrorHandler } from '../payment/error-handler';\n\nconst prisma = new PrismaClient();\n\nexport interface UsageMetrics {\n  activeUsers: number;\n  coursesCreated: number;\n  apiCallsUsed: number;\n  storageUsed: number; // in GB\n}\n\nexport interface UsageReport {\n  licenseId: string;\n  date: Date;\n  metrics: UsageMetrics;\n  percentageUsed: {\n    users: number;\n    courses: number;\n    apiCalls: number;\n  };\n}\n\nexport class UsageTrackingService {\n  /**\n   * Track usage for a license\n   */\n  async trackUsage(licenseId: string, metrics: UsageMetrics): Promise<void> {\n    try {\n      logger.info('Tracking usage', { licenseId, ...metrics });\n\n      const license = await prisma.enterpriseLicense.findUnique({\n        where: { id: licenseId },\n      });\n\n      if (!license) {\n        throw new Error(`License ${licenseId} not found`);\n      }\n\n      // Create usage record\n      await prisma.enterpriseUsageTracking.create({\n        data: {\n          licenseId,\n          activeUsers: metrics.activeUsers,\n          coursesCreated: metrics.coursesCreated,\n          apiCallsUsed: metrics.apiCallsUsed,\n          storageUsed: metrics.storageUsed,\n        },\n      });\n\n      // Check if usage exceeds limits\n      if (metrics.activeUsers > license.maxUsers) {\n        logger.warn('User limit exceeded', {\n          licenseId,\n          limit: license.maxUsers,\n          current: metrics.activeUsers,\n        });\n      }\n\n      if (license.maxCourses && metrics.coursesCreated > license.maxCourses) {\n        logger.warn('Course limit exceeded', {\n          licenseId,\n          limit: license.maxCourses,\n          current: metrics.coursesCreated,\n        });\n      }\n\n      if (license.maxApiCalls && metrics.apiCallsUsed > license.maxApiCalls) {\n        logger.warn('API call limit exceeded', {\n          licenseId,\n          limit: license.maxApiCalls,\n          current: metrics.apiCallsUsed,\n        });\n      }\n    } catch (error) {\n      logger.error('Failed to track usage', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get current usage for license\n   */\n  async getCurrentUsage(licenseId: string): Promise<UsageMetrics | null> {\n    try {\n      const latestUsage = await prisma.enterpriseUsageTracking.findFirst({\n        where: { licenseId },\n        orderBy: { date: 'desc' },\n      });\n\n      if (!latestUsage) {\n        return null;\n      }\n\n      return {\n        activeUsers: latestUsage.activeUsers,\n        coursesCreated: latestUsage.coursesCreated,\n        apiCallsUsed: latestUsage.apiCallsUsed,\n        storageUsed: latestUsage.storageUsed,\n      };\n    } catch (error) {\n      logger.error('Failed to get current usage', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get usage report for date range\n   */\n  async getUsageReport(\n    licenseId: string,\n    startDate: Date,\n    endDate: Date\n  ): Promise<UsageReport[]> {\n    try {\n      logger.info('Getting usage report', { licenseId, startDate, endDate });\n\n      const license = await prisma.enterpriseLicense.findUnique({\n        where: { id: licenseId },\n      });\n\n      if (!license) {\n        throw new Error(`License ${licenseId} not found`);\n      }\n\n      const usageRecords = await prisma.enterpriseUsageTracking.findMany({\n        where: {\n          licenseId,\n          date: {\n            gte: startDate,\n            lte: endDate,\n          },\n        },\n        orderBy: { date: 'asc' },\n      });\n\n      return usageRecords.map((record) => ({\n        licenseId: record.licenseId,\n        date: record.date,\n        metrics: {\n          activeUsers: record.activeUsers,\n          coursesCreated: record.coursesCreated,\n          apiCallsUsed: record.apiCallsUsed,\n          storageUsed: record.storageUsed,\n        },\n        percentageUsed: {\n          users: (record.activeUsers / license.maxUsers) * 100,\n          courses: license.maxCourses ? (record.coursesCreated / license.maxCourses) * 100 : 0,\n          apiCalls: license.maxApiCalls ? (record.apiCallsUsed / license.maxApiCalls) * 100 : 0,\n        },\n      }));\n    } catch (error) {\n      logger.error('Failed to get usage report', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get usage statistics\n   */\n  async getUsageStats(licenseId: string): Promise<{\n    averageActiveUsers: number;\n    maxActiveUsers: number;\n    totalCoursesCreated: number;\n    totalApiCalls: number;\n    totalStorageUsed: number;\n    recordCount: number;\n  }> {\n    try {\n      const stats = await prisma.enterpriseUsageTracking.aggregate({\n        where: { licenseId },\n        _avg: { activeUsers: true },\n        _max: { activeUsers: true },\n        _sum: {\n          coursesCreated: true,\n          apiCallsUsed: true,\n          storageUsed: true,\n        },\n        _count: true,\n      });\n\n      return {\n        averageActiveUsers: Math.round(stats._avg.activeUsers || 0),\n        maxActiveUsers: stats._max.activeUsers || 0,\n        totalCoursesCreated: stats._sum.coursesCreated || 0,\n        totalApiCalls: stats._sum.apiCallsUsed || 0,\n        totalStorageUsed: stats._sum.storageUsed || 0,\n        recordCount: stats._count,\n      };\n    } catch (error) {\n      logger.error('Failed to get usage stats', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Check if license has exceeded limits\n   */\n  async checkLimits(licenseId: string): Promise<{\n    usersExceeded: boolean;\n    coursesExceeded: boolean;\n    apiCallsExceeded: boolean;\n  }> {\n    try {\n      const license = await prisma.enterpriseLicense.findUnique({\n        where: { id: licenseId },\n      });\n\n      if (!license) {\n        throw new Error(`License ${licenseId} not found`);\n      }\n\n      const currentUsage = await this.getCurrentUsage(licenseId);\n\n      if (!currentUsage) {\n        return {\n          usersExceeded: false,\n          coursesExceeded: false,\n          apiCallsExceeded: false,\n        };\n      }\n\n      return {\n        usersExceeded: currentUsage.activeUsers > license.maxUsers,\n        coursesExceeded: license.maxCourses ? currentUsage.coursesCreated > license.maxCourses : false,\n        apiCallsExceeded: license.maxApiCalls ? currentUsage.apiCallsUsed > license.maxApiCalls : false,\n      };\n    } catch (error) {\n      logger.error('Failed to check limits', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get usage alerts\n   */\n  async getUsageAlerts(licenseId: string, thresholdPercent: number = 80): Promise<string[]> {\n    try {\n      const license = await prisma.enterpriseLicense.findUnique({\n        where: { id: licenseId },\n      });\n\n      if (!license) {\n        throw new Error(`License ${licenseId} not found`);\n      }\n\n      const currentUsage = await this.getCurrentUsage(licenseId);\n      const alerts: string[] = [];\n\n      if (!currentUsage) {\n        return alerts;\n      }\n\n      const userPercent = (currentUsage.activeUsers / license.maxUsers) * 100;\n      if (userPercent >= thresholdPercent) {\n        alerts.push(\n          `User limit approaching: ${currentUsage.activeUsers}/${license.maxUsers} (${Math.round(userPercent)}%)`\n        );\n      }\n\n      if (license.maxCourses) {\n        const coursePercent = (currentUsage.coursesCreated / license.maxCourses) * 100;\n        if (coursePercent >= thresholdPercent) {\n          alerts.push(\n            `Course limit approaching: ${currentUsage.coursesCreated}/${license.maxCourses} (${Math.round(coursePercent)}%)`\n          );\n        }\n      }\n\n      if (license.maxApiCalls) {\n        const apiPercent = (currentUsage.apiCallsUsed / license.maxApiCalls) * 100;\n        if (apiPercent >= thresholdPercent) {\n          alerts.push(\n            `API call limit approaching: ${currentUsage.apiCallsUsed}/${license.maxApiCalls} (${Math.round(apiPercent)}%)`\n          );\n        }\n      }\n\n      return alerts;\n    } catch (error) {\n      logger.error('Failed to get usage alerts', { error, licenseId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n}\n\nexport default new UsageTrackingService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}