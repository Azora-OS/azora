{"version":3,"names":["cov_2hdq9pxiod","actualCoverage","PIIType","PrivacyFilter","PrivacyFilterService","constructor","config","b","f","s","enabled","timeout","strictMode","piiTypesToDetect","Object","values","redactionPattern","preserveFormat","enableLogging","maxTextLength","privacyFilter","stats","totalFiltered","totalPIIDetected","piiByType","averageProcessingTime","lastProcessed","Date","forEach","type","filter","text","startTime","now","trim","length","hasPII","matches","filteredOutput","redactionCount","console","warn","substring","whitelistedMatches","applyWhitelist","result","filterPII","match","isWhitelisted","redactPII","customRedactionPatterns","applyCustomRedactions","updateStats","log","error","detect","detectPII","whitelistPatterns","whitelisted","pattern","lastIndex","exec","push","NAME","value","startIndex","index","endIndex","confidence","some","w","offset","customPattern","adjustedStart","adjustedEnd","currentRedaction","includes","processingTime","getStats","resetStats","updateConfig","getConfig","addCustomRedactionPattern","addWhitelistPattern","setPIITypeEnabled","t","isEnabled","setEnabled","createPrivacyFilterService","privacyFilterService"],"sources":["privacy-filter-service.ts"],"sourcesContent":["/**\n * Privacy Filter Service\n * Orchestrates PII detection and redaction with configurable patterns\n */\n\nimport {\n  FilterResult,\n  PIIMatch,\n  PIIType\n} from '../types';\nimport { PrivacyFilter } from '../validators/privacy-filter';\nimport { PrivacyFilterConfig } from '../types/validators';\n\n/**\n * Privacy filter service configuration\n */\nexport interface PrivacyFilterServiceConfig extends PrivacyFilterConfig {\n  // Custom redaction patterns per PII type\n  customRedactionPatterns?: Partial<Record<PIIType, string>>;\n  \n  // Whitelist patterns that should not be redacted\n  whitelistPatterns?: RegExp[];\n  \n  // Enable detailed logging\n  enableLogging?: boolean;\n  \n  // Maximum text length to process\n  maxTextLength?: number;\n}\n\n/**\n * Privacy filter statistics\n */\nexport interface PrivacyFilterStats {\n  totalFiltered: number;\n  totalPIIDetected: number;\n  piiByType: Record<PIIType, number>;\n  averageProcessingTime: number;\n  lastProcessed: Date;\n}\n\n/**\n * Privacy Filter Service\n * Provides orchestration and configuration management for privacy filtering\n */\nexport class PrivacyFilterService {\n  private privacyFilter: PrivacyFilter;\n  private config: PrivacyFilterServiceConfig;\n  private stats: PrivacyFilterStats;\n\n  constructor(config: Partial<PrivacyFilterServiceConfig> = {}) {\n    this.config = {\n      enabled: true,\n      timeout: 5000,\n      strictMode: true,\n      piiTypesToDetect: Object.values(PIIType),\n      redactionPattern: '[REDACTED]',\n      preserveFormat: false,\n      enableLogging: false,\n      maxTextLength: 100000,\n      ...config\n    };\n\n    this.privacyFilter = new PrivacyFilter(this.config);\n    \n    this.stats = {\n      totalFiltered: 0,\n      totalPIIDetected: 0,\n      piiByType: {} as Record<PIIType, number>,\n      averageProcessingTime: 0,\n      lastProcessed: new Date()\n    };\n\n    // Initialize stats for each PII type\n    Object.values(PIIType).forEach(type => {\n      this.stats.piiByType[type] = 0;\n    });\n  }\n\n  /**\n   * Filter text with PII detection and redaction\n   */\n  async filter(text: string): Promise<FilterResult> {\n    const startTime = Date.now();\n\n    try {\n      // Validate input\n      if (!text || text.trim().length === 0) {\n        return {\n          hasPII: false,\n          matches: [],\n          filteredOutput: text,\n          redactionCount: 0\n        };\n      }\n\n      // Check text length\n      if (text.length > this.config.maxTextLength!) {\n        if (this.config.enableLogging) {\n          console.warn(`Text length ${text.length} exceeds maximum ${this.config.maxTextLength}`);\n        }\n        text = text.substring(0, this.config.maxTextLength!);\n      }\n\n      // Apply whitelist filtering\n      const whitelistedMatches = this.applyWhitelist(text);\n\n      // Perform PII detection and redaction\n      const result = await this.privacyFilter.filterPII(text);\n\n      // Remove whitelisted matches\n      if (whitelistedMatches.length > 0) {\n        result.matches = result.matches.filter(\n          match => !this.isWhitelisted(match, whitelistedMatches)\n        );\n        \n        // Re-redact without whitelisted items\n        if (result.matches.length > 0) {\n          result.filteredOutput = await this.privacyFilter.redactPII(text, result.matches);\n        } else {\n          result.filteredOutput = text;\n        }\n        \n        result.hasPII = result.matches.length > 0;\n        result.redactionCount = result.matches.length;\n      }\n\n      // Apply custom redaction patterns if configured\n      if (this.config.customRedactionPatterns) {\n        result.filteredOutput = this.applyCustomRedactions(\n          result.filteredOutput,\n          result.matches\n        );\n      }\n\n      // Update statistics\n      this.updateStats(result, Date.now() - startTime);\n\n      // Log if enabled\n      if (this.config.enableLogging && result.hasPII) {\n        console.log(`Privacy filter detected ${result.redactionCount} PII instances`);\n      }\n\n      return result;\n    } catch (error) {\n      console.error('Privacy filter service error:', error);\n      \n      // Return original text in case of error\n      return {\n        hasPII: false,\n        matches: [],\n        filteredOutput: text,\n        redactionCount: 0\n      };\n    }\n  }\n\n  /**\n   * Detect PII without redaction\n   */\n  async detect(text: string): Promise<PIIMatch[]> {\n    try {\n      return await this.privacyFilter.detectPII(text);\n    } catch (error) {\n      console.error('PII detection error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Apply whitelist patterns\n   */\n  private applyWhitelist(text: string): PIIMatch[] {\n    if (!this.config.whitelistPatterns || this.config.whitelistPatterns.length === 0) {\n      return [];\n    }\n\n    const whitelisted: PIIMatch[] = [];\n\n    for (const pattern of this.config.whitelistPatterns) {\n      pattern.lastIndex = 0;\n      let match;\n      \n      while ((match = pattern.exec(text)) !== null) {\n        whitelisted.push({\n          type: PIIType.NAME, // Generic type for whitelisted items\n          value: match[0],\n          startIndex: match.index,\n          endIndex: match.index + match[0].length,\n          confidence: 1.0\n        });\n      }\n    }\n\n    return whitelisted;\n  }\n\n  /**\n   * Check if a match is whitelisted\n   */\n  private isWhitelisted(match: PIIMatch, whitelisted: PIIMatch[]): boolean {\n    return whitelisted.some(\n      w => w.startIndex <= match.startIndex && w.endIndex >= match.endIndex\n    );\n  }\n\n  /**\n   * Apply custom redaction patterns\n   */\n  private applyCustomRedactions(text: string, matches: PIIMatch[]): string {\n    if (!this.config.customRedactionPatterns) {\n      return text;\n    }\n\n    let result = text;\n    let offset = 0;\n\n    for (const match of matches) {\n      const customPattern = this.config.customRedactionPatterns[match.type];\n      if (!customPattern) {continue;}\n\n      const adjustedStart = match.startIndex + offset;\n      const adjustedEnd = match.endIndex + offset;\n\n      // Find the current redacted text\n      const currentRedaction = result.substring(adjustedStart, adjustedEnd);\n      \n      // Only replace if it's a standard redaction pattern\n      if (currentRedaction.includes('REDACTED') || currentRedaction.includes('XXX')) {\n        result =\n          result.substring(0, adjustedStart) +\n          customPattern +\n          result.substring(adjustedEnd);\n\n        offset += customPattern.length - (adjustedEnd - adjustedStart);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Update statistics\n   */\n  private updateStats(result: FilterResult, processingTime: number): void {\n    this.stats.totalFiltered++;\n    this.stats.totalPIIDetected += result.redactionCount;\n    this.stats.lastProcessed = new Date();\n\n    // Update PII type counts\n    result.matches.forEach(match => {\n      this.stats.piiByType[match.type]++;\n    });\n\n    // Update average processing time\n    this.stats.averageProcessingTime =\n      (this.stats.averageProcessingTime * (this.stats.totalFiltered - 1) + processingTime) /\n      this.stats.totalFiltered;\n  }\n\n  /**\n   * Get statistics\n   */\n  getStats(): PrivacyFilterStats {\n    return { ...this.stats };\n  }\n\n  /**\n   * Reset statistics\n   */\n  resetStats(): void {\n    this.stats = {\n      totalFiltered: 0,\n      totalPIIDetected: 0,\n      piiByType: {} as Record<PIIType, number>,\n      averageProcessingTime: 0,\n      lastProcessed: new Date()\n    };\n\n    Object.values(PIIType).forEach(type => {\n      this.stats.piiByType[type] = 0;\n    });\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(config: Partial<PrivacyFilterServiceConfig>): void {\n    this.config = { ...this.config, ...config };\n    this.privacyFilter.updateConfig(this.config);\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): PrivacyFilterServiceConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Add custom redaction pattern for a PII type\n   */\n  addCustomRedactionPattern(type: PIIType, pattern: string): void {\n    if (!this.config.customRedactionPatterns) {\n      this.config.customRedactionPatterns = {};\n    }\n    this.config.customRedactionPatterns[type] = pattern;\n  }\n\n  /**\n   * Add whitelist pattern\n   */\n  addWhitelistPattern(pattern: RegExp): void {\n    if (!this.config.whitelistPatterns) {\n      this.config.whitelistPatterns = [];\n    }\n    this.config.whitelistPatterns.push(pattern);\n  }\n\n  /**\n   * Enable/disable specific PII type detection\n   */\n  setPIITypeEnabled(type: PIIType, enabled: boolean): void {\n    if (enabled) {\n      if (!this.config.piiTypesToDetect.includes(type)) {\n        this.config.piiTypesToDetect.push(type);\n      }\n    } else {\n      this.config.piiTypesToDetect = this.config.piiTypesToDetect.filter(t => t !== type);\n    }\n    this.privacyFilter.updateConfig(this.config);\n  }\n\n  /**\n   * Check if service is enabled\n   */\n  isEnabled(): boolean {\n    return this.config.enabled;\n  }\n\n  /**\n   * Enable/disable service\n   */\n  setEnabled(enabled: boolean): void {\n    this.config.enabled = enabled;\n    this.privacyFilter.updateConfig(this.config);\n  }\n}\n\n/**\n * Create a privacy filter service instance\n */\nexport function createPrivacyFilterService(\n  config?: Partial<PrivacyFilterServiceConfig>\n): PrivacyFilterService {\n  return new PrivacyFilterService(config);\n}\n\n/**\n * Export singleton instance\n */\nexport const privacyFilterService = createPrivacyFilterService();\n\nexport default privacyFilterService;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}