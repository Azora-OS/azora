{"version":3,"names":["cov_5gjwug582","actualCoverage","ElevenLabsClient","fs","path","dotenv","s","config","ElaraAudioGenerator","client","constructor","f","b","process","env","ELEVENLABS_API_KEY","apiKey","audioDir","join","__dirname","existsSync","mkdirSync","recursive","generateAudio","params","console","log","lessonId","getMockAudio","voiceId","ELEVENLABS_VOICE_ID","audio","generate","voice","text","model_id","voice_settings","stability","similarity_boost","style","use_speaker_boost","filename","Date","now","filepath","chunks","chunk","push","buffer","Buffer","concat","writeFileSync","duration","calculateDuration","url","error","words","split","length","minutes","Math","ceil","generateAudioForLesson","lesson","script","title","toLowerCase","replace","generateAudioForCourse","lessons","lessonsWithAudio","lessonWithAudio","content"],"sources":["audio-generator.ts"],"sourcesContent":["import { ElevenLabsClient } from 'elevenlabs';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nexport class ElaraAudioGenerator {\n    private client: ElevenLabsClient | null = null;\n    private audioDir: string;\n\n    constructor() {\n        // Only initialize if API key is provided\n        if (process.env.ELEVENLABS_API_KEY && process.env.ELEVENLABS_API_KEY !== 'your-api-key-here') {\n            this.client = new ElevenLabsClient({\n                apiKey: process.env.ELEVENLABS_API_KEY\n            });\n        }\n\n        // Create audio directory if it doesn't exist\n        this.audioDir = path.join(__dirname, 'generated-audio');\n        if (!fs.existsSync(this.audioDir)) {\n            fs.mkdirSync(this.audioDir, { recursive: true });\n        }\n    }\n\n    async generateAudio(params: {\n        text: string;\n        lessonId: string;\n        voiceId?: string;\n    }): Promise<{ url: string; duration: number }> {\n        console.log(`Generating audio for lesson: ${params.lessonId}`);\n\n        // If no API key, return mock audio\n        if (!this.client) {\n            console.log('Using mock audio generation (No ElevenLabs API Key)');\n            return this.getMockAudio(params);\n        }\n\n        try {\n            const voiceId = params.voiceId || process.env.ELEVENLABS_VOICE_ID || 'EXAVITQu4vr4xnSDxMaL'; // Default: Bella\n\n            // Generate audio using ElevenLabs\n            const audio = await this.client.generate({\n                voice: voiceId,\n                text: params.text,\n                model_id: 'eleven_multilingual_v2',\n                voice_settings: {\n                    stability: 0.5,\n                    similarity_boost: 0.75,\n                    style: 0.5,\n                    use_speaker_boost: true\n                }\n            });\n\n            // Save audio to file\n            const filename = `${params.lessonId}-${Date.now()}.mp3`;\n            const filepath = path.join(this.audioDir, filename);\n\n            // Convert audio stream to buffer and save\n            const chunks: Buffer[] = [];\n            for await (const chunk of audio) {\n                chunks.push(chunk);\n            }\n            const buffer = Buffer.concat(chunks);\n            fs.writeFileSync(filepath, buffer);\n\n            // Calculate duration (approximate based on word count)\n            const duration = this.calculateDuration(params.text);\n\n            // In production, upload to S3/R2 and return URL\n            // For now, return local file path\n            const url = `/audio/${filename}`;\n\n            console.log(`Audio generated: ${url}`);\n            return { url, duration };\n\n        } catch (error) {\n            console.error('Error generating audio:', error);\n            // Fallback to mock on error\n            return this.getMockAudio(params);\n        }\n    }\n\n    private getMockAudio(params: { text: string; lessonId: string }): { url: string; duration: number } {\n        const duration = this.calculateDuration(params.text);\n        return {\n            url: `/audio/mock-${params.lessonId}.mp3`,\n            duration\n        };\n    }\n\n    private calculateDuration(text: string): number {\n        // Average speaking rate: 150 words per minute\n        const words = text.split(/\\s+/).length;\n        const minutes = words / 150;\n        return Math.ceil(minutes * 60); // Return seconds\n    }\n\n    async generateAudioForLesson(lesson: any): Promise<any> {\n        const audio = await this.generateAudio({\n            text: lesson.script,\n            lessonId: lesson.title.toLowerCase().replace(/\\s+/g, '-')\n        });\n\n        return {\n            ...lesson,\n            audio: {\n                url: audio.url,\n                duration: audio.duration\n            }\n        };\n    }\n\n    async generateAudioForCourse(lessons: any[]): Promise<any[]> {\n        const lessonsWithAudio = [];\n\n        for (const lesson of lessons) {\n            const lessonWithAudio = await this.generateAudioForLesson(lesson.content);\n            lessonsWithAudio.push({\n                ...lesson,\n                content: lessonWithAudio\n            });\n        }\n\n        return lessonsWithAudio;\n    }\n}\n"],"mappings":"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","ignoreList":[]}