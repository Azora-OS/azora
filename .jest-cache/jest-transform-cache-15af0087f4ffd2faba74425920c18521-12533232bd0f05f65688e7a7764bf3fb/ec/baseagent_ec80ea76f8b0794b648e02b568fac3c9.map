{"version":3,"names":["cov_1f5kvmgkoa","actualCoverage","OpenAI","DIVINE_LAW_PRINCIPLES","BaseAgent","model","s","constructor","name","role","apiKey","f","openai","b","process","env","OPENAI_API_KEY","dangerouslyAllowBrowser","recognizePatterns","context","reason","pattern","prompt","JSON","stringify","response","chat","completions","create","messages","content","response_format","type","parse","choices","message","validate","action","principles","map","p","description","join","temperature","act","console","log","payload","success","txHash","runAgenticLoop","sessionId","patterns","actionChain","id","crypto","randomUUID","actions","status","length","requiresDeepReasoning","primaryPattern","confidence","indicators","detectedAt","Date","now","severity","reasoning","proposedAction","finalDecision","ethicalReview","approved","push","executionResult","warn","concerns"],"sources":["base-agent.ts"],"sourcesContent":["import OpenAI from 'openai';\nimport { \n  AzoraAgent, \n  AgenticContext, \n  Pattern, \n  PatternDetector, \n  System2Reasoning, \n  ConstitutionalValidator,\n  ProposedAction,\n  ActionChain,\n  ReasoningChain,\n  EthicalAnalysis\n} from './agentic-core';\nimport { DIVINE_LAW_PRINCIPLES } from './constitutional-types';\n\n// ðŸ§  The Base Agent Class that all Family Members will inherit from\nexport class BaseAgent implements AzoraAgent {\n  name: string;\n  role: string;\n  private openai: OpenAI;\n  private model: string = \"gpt-4-turbo-preview\"; // System 2 capable model\n\n  constructor(name: string, role: string, apiKey?: string) {\n    this.name = name;\n    this.role = role;\n    this.openai = new OpenAI({\n      apiKey: apiKey || process.env.OPENAI_API_KEY,\n      dangerouslyAllowBrowser: true // For now, allowing in potential browser contexts\n    });\n  }\n\n  // 1. Active Pattern Recognition\n  async recognizePatterns(context: AgenticContext): Promise<Pattern[]> {\n    // TODO: Connect to real monitoring data\n    // This is where we would analyze user behavior, logs, etc.\n    return []; \n  }\n\n  // 2. System 2 Reasoning (The \"Deep Think\")\n  async reason(pattern: Pattern, context: AgenticContext): Promise<ReasoningChain> {\n    const prompt = `\n      You are ${this.name}, the ${this.role} of Azora OS.\n      \n      PATTERN DETECTED:\n      ${JSON.stringify(pattern, null, 2)}\n      \n      CONTEXT:\n      ${JSON.stringify(context, null, 2)}\n      \n      Perform a System 2 \"Chain of Thought\" analysis:\n      1. Deconstruct the problem.\n      2. Consider multiple approaches.\n      3. Evaluate against Ubuntu Philosophy (\"I am because we are\").\n      4. Propose the most optimal action.\n      \n      Return a JSON object matching the ReasoningChain interface.\n    `;\n\n    const response = await this.openai.chat.completions.create({\n      model: this.model,\n      messages: [{ role: 'system', content: prompt }],\n      response_format: { type: 'json_object' }\n    });\n\n    return JSON.parse(response.choices[0].message.content || '{}') as ReasoningChain;\n  }\n\n  // 3. Constitutional Validation\n  async validate(action: ProposedAction): Promise<EthicalAnalysis> {\n    const principles = DIVINE_LAW_PRINCIPLES.map(p => `- ${p.name}: ${p.description}`).join('\\n');\n    \n    const prompt = `\n      CONSTITUTIONAL COURT REVIEW\n      \n      PROPOSED ACTION:\n      ${JSON.stringify(action, null, 2)}\n      \n      PRINCIPLES:\n      ${principles}\n      \n      Analyze this action. Does it violate any principles?\n      If yes, REJECT it. If no, APPROVE it.\n      \n      Return a JSON object matching the EthicalAnalysis interface.\n    `;\n\n    const response = await this.openai.chat.completions.create({\n      model: this.model,\n      messages: [{ role: 'system', content: prompt }],\n      response_format: { type: 'json_object' },\n      temperature: 0.1 // Low temp for strict adherence\n    });\n\n    return JSON.parse(response.choices[0].message.content || '{}') as EthicalAnalysis;\n  }\n\n  // 4. Act (The Execution)\n  async act(action: ProposedAction): Promise<any> {\n    console.log(`[${this.name}] EXECUTING: ${action.type}`, action.payload);\n    // In a real system, this would dispatch to an Event Bus or API Gateway\n    return { success: true, txHash: 'mock_tx_hash' };\n  }\n\n  // ðŸŒŸ The \"Awake\" Loop\n  async runAgenticLoop(context: AgenticContext): Promise<ActionChain> {\n    console.log(`[${this.name}] waking up... context: ${context.sessionId}`);\n\n    // 1. Scan for patterns\n    const patterns = await this.recognizePatterns(context);\n    \n    const actionChain: ActionChain = {\n      id: crypto.randomUUID(),\n      actions: [],\n      status: 'pending'\n    };\n\n    // If no patterns, nothing to do (unless reactive)\n    if (patterns.length === 0 && !context.requiresDeepReasoning) {\n      return actionChain;\n    }\n\n    // 2. Reason about the most critical pattern\n    const primaryPattern = patterns[0] || { id: 'manual-trigger', type: 'opportunity', confidence: 1, indicators: ['user-request'], detectedAt: Date.now(), severity: 'medium' };\n    \n    const reasoning = await this.reason(primaryPattern, context);\n    const proposedAction = reasoning.finalDecision;\n\n    // 3. Validate Constitutionality\n    const ethicalReview = await this.validate(proposedAction);\n    actionChain.ethicalReview = ethicalReview;\n\n    if (ethicalReview.approved) {\n      // 4. Execute\n      actionChain.status = 'executed';\n      actionChain.actions.push(proposedAction);\n      actionChain.executionResult = await this.act(proposedAction);\n    } else {\n      // VETOED\n      actionChain.status = 'rejected';\n      console.warn(`[${this.name}] Action VETOED by Constitution:`, ethicalReview.concerns);\n    }\n\n    return actionChain;\n  }\n}\n"],"mappings":"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","ignoreList":[]}