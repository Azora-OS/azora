{"version":3,"names":["cov_2l6myu9rr3","actualCoverage","promClient","s","require","register","Registry","collectDefaultMetrics","httpRequestDuration","Histogram","name","help","labelNames","registers","httpRequestTotal","Counter","metricsMiddleware","req","res","next","f","start","Date","now","on","duration","labels","method","b","route","path","statusCode","observe","inc","metricsEndpoint","set","contentType","end","metrics","module","exports"],"sources":["prometheus.js"],"sourcesContent":["const promClient = require('prom-client');\n\nconst register = new promClient.Registry();\npromClient.collectDefaultMetrics({ register });\n\nconst httpRequestDuration = new promClient.Histogram({\n  name: 'http_request_duration_seconds',\n  help: 'Duration of HTTP requests in seconds',\n  labelNames: ['method', 'route', 'status_code'],\n  registers: [register]\n});\n\nconst httpRequestTotal = new promClient.Counter({\n  name: 'http_requests_total',\n  help: 'Total number of HTTP requests',\n  labelNames: ['method', 'route', 'status_code'],\n  registers: [register]\n});\n\nconst metricsMiddleware = (req, res, next) => {\n  const start = Date.now();\n  \n  res.on('finish', () => {\n    const duration = (Date.now() - start) / 1000;\n    httpRequestDuration.labels(req.method, req.route?.path || req.path, res.statusCode).observe(duration);\n    httpRequestTotal.labels(req.method, req.route?.path || req.path, res.statusCode).inc();\n  });\n  \n  next();\n};\n\nconst metricsEndpoint = async (req, res) => {\n  res.set('Content-Type', register.contentType);\n  res.end(await register.metrics());\n};\n\nmodule.exports = { metricsMiddleware, metricsEndpoint, register };\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ,MAAME,UAAU;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,aAAa,CAAC;AAEzC,MAAMC,QAAQ;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,OAAG,IAAID,UAAU,CAACI,QAAQ,CAAC,CAAC;AAAC;AAAAN,cAAA,GAAAG,CAAA;AAC3CD,UAAU,CAACK,qBAAqB,CAAC;EAAEF;AAAS,CAAC,CAAC;AAE9C,MAAMG,mBAAmB;AAAA;AAAA,CAAAR,cAAA,GAAAG,CAAA,OAAG,IAAID,UAAU,CAACO,SAAS,CAAC;EACnDC,IAAI,EAAE,+BAA+B;EACrCC,IAAI,EAAE,sCAAsC;EAC5CC,UAAU,EAAE,CAAC,QAAQ,EAAE,OAAO,EAAE,aAAa,CAAC;EAC9CC,SAAS,EAAE,CAACR,QAAQ;AACtB,CAAC,CAAC;AAEF,MAAMS,gBAAgB;AAAA;AAAA,CAAAd,cAAA,GAAAG,CAAA,OAAG,IAAID,UAAU,CAACa,OAAO,CAAC;EAC9CL,IAAI,EAAE,qBAAqB;EAC3BC,IAAI,EAAE,+BAA+B;EACrCC,UAAU,EAAE,CAAC,QAAQ,EAAE,OAAO,EAAE,aAAa,CAAC;EAC9CC,SAAS,EAAE,CAACR,QAAQ;AACtB,CAAC,CAAC;AAAC;AAAAL,cAAA,GAAAG,CAAA;AAEH,MAAMa,iBAAiB,GAAGA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAAA;EAAAnB,cAAA,GAAAoB,CAAA;EAC5C,MAAMC,KAAK;EAAA;EAAA,CAAArB,cAAA,GAAAG,CAAA,OAAGmB,IAAI,CAACC,GAAG,CAAC,CAAC;EAAC;EAAAvB,cAAA,GAAAG,CAAA;EAEzBe,GAAG,CAACM,EAAE,CAAC,QAAQ,EAAE,MAAM;IAAA;IAAAxB,cAAA,GAAAoB,CAAA;IACrB,MAAMK,QAAQ;IAAA;IAAA,CAAAzB,cAAA,GAAAG,CAAA,OAAG,CAACmB,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGF,KAAK,IAAI,IAAI;IAAC;IAAArB,cAAA,GAAAG,CAAA;IAC7CK,mBAAmB,CAACkB,MAAM,CAACT,GAAG,CAACU,MAAM;IAAE;IAAA,CAAA3B,cAAA,GAAA4B,CAAA,UAAAX,GAAG,CAACY,KAAK,EAAEC,IAAI;IAAA;IAAA,CAAA9B,cAAA,GAAA4B,CAAA,UAAIX,GAAG,CAACa,IAAI,GAAEZ,GAAG,CAACa,UAAU,CAAC,CAACC,OAAO,CAACP,QAAQ,CAAC;IAAC;IAAAzB,cAAA,GAAAG,CAAA;IACtGW,gBAAgB,CAACY,MAAM,CAACT,GAAG,CAACU,MAAM;IAAE;IAAA,CAAA3B,cAAA,GAAA4B,CAAA,UAAAX,GAAG,CAACY,KAAK,EAAEC,IAAI;IAAA;IAAA,CAAA9B,cAAA,GAAA4B,CAAA,UAAIX,GAAG,CAACa,IAAI,GAAEZ,GAAG,CAACa,UAAU,CAAC,CAACE,GAAG,CAAC,CAAC;EACxF,CAAC,CAAC;EAAC;EAAAjC,cAAA,GAAAG,CAAA;EAEHgB,IAAI,CAAC,CAAC;AACR,CAAC;AAAC;AAAAnB,cAAA,GAAAG,CAAA;AAEF,MAAM+B,eAAe,GAAG,MAAAA,CAAOjB,GAAG,EAAEC,GAAG,KAAK;EAAA;EAAAlB,cAAA,GAAAoB,CAAA;EAAApB,cAAA,GAAAG,CAAA;EAC1Ce,GAAG,CAACiB,GAAG,CAAC,cAAc,EAAE9B,QAAQ,CAAC+B,WAAW,CAAC;EAAC;EAAApC,cAAA,GAAAG,CAAA;EAC9Ce,GAAG,CAACmB,GAAG,CAAC,MAAMhC,QAAQ,CAACiC,OAAO,CAAC,CAAC,CAAC;AACnC,CAAC;AAAC;AAAAtC,cAAA,GAAAG,CAAA;AAEFoC,MAAM,CAACC,OAAO,GAAG;EAAExB,iBAAiB;EAAEkB,eAAe;EAAE7B;AAAS,CAAC","ignoreList":[]}