ac463817ae585102912d38a069456f4e
/* istanbul ignore next */
function cov_2l6myu9rr3() {
  var path = "/workspaces/azora/services/health-monitor/prometheus.js";
  var hash = "1e74289665553608b637e07e011d7f064c4a72e1";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/health-monitor/prometheus.js",
    statementMap: {
      "0": {
        start: {
          line: 1,
          column: 19
        },
        end: {
          line: 1,
          column: 41
        }
      },
      "1": {
        start: {
          line: 3,
          column: 17
        },
        end: {
          line: 3,
          column: 42
        }
      },
      "2": {
        start: {
          line: 4,
          column: 0
        },
        end: {
          line: 4,
          column: 47
        }
      },
      "3": {
        start: {
          line: 6,
          column: 28
        },
        end: {
          line: 11,
          column: 2
        }
      },
      "4": {
        start: {
          line: 13,
          column: 25
        },
        end: {
          line: 18,
          column: 2
        }
      },
      "5": {
        start: {
          line: 20,
          column: 26
        },
        end: {
          line: 30,
          column: 1
        }
      },
      "6": {
        start: {
          line: 21,
          column: 16
        },
        end: {
          line: 21,
          column: 26
        }
      },
      "7": {
        start: {
          line: 23,
          column: 2
        },
        end: {
          line: 27,
          column: 5
        }
      },
      "8": {
        start: {
          line: 24,
          column: 21
        },
        end: {
          line: 24,
          column: 48
        }
      },
      "9": {
        start: {
          line: 25,
          column: 4
        },
        end: {
          line: 25,
          column: 106
        }
      },
      "10": {
        start: {
          line: 26,
          column: 4
        },
        end: {
          line: 26,
          column: 91
        }
      },
      "11": {
        start: {
          line: 29,
          column: 2
        },
        end: {
          line: 29,
          column: 9
        }
      },
      "12": {
        start: {
          line: 32,
          column: 24
        },
        end: {
          line: 35,
          column: 1
        }
      },
      "13": {
        start: {
          line: 33,
          column: 2
        },
        end: {
          line: 33,
          column: 48
        }
      },
      "14": {
        start: {
          line: 34,
          column: 2
        },
        end: {
          line: 34,
          column: 36
        }
      },
      "15": {
        start: {
          line: 37,
          column: 0
        },
        end: {
          line: 37,
          column: 66
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 20,
            column: 26
          },
          end: {
            line: 20,
            column: 27
          }
        },
        loc: {
          start: {
            line: 20,
            column: 46
          },
          end: {
            line: 30,
            column: 1
          }
        },
        line: 20
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 23,
            column: 19
          },
          end: {
            line: 23,
            column: 20
          }
        },
        loc: {
          start: {
            line: 23,
            column: 25
          },
          end: {
            line: 27,
            column: 3
          }
        },
        line: 23
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 32,
            column: 24
          },
          end: {
            line: 32,
            column: 25
          }
        },
        loc: {
          start: {
            line: 32,
            column: 44
          },
          end: {
            line: 35,
            column: 1
          }
        },
        line: 32
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 25,
            column: 43
          },
          end: {
            line: 25,
            column: 70
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 25,
            column: 43
          },
          end: {
            line: 25,
            column: 58
          }
        }, {
          start: {
            line: 25,
            column: 62
          },
          end: {
            line: 25,
            column: 70
          }
        }],
        line: 25
      },
      "1": {
        loc: {
          start: {
            line: 26,
            column: 40
          },
          end: {
            line: 26,
            column: 67
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 26,
            column: 40
          },
          end: {
            line: 26,
            column: 55
          }
        }, {
          start: {
            line: 26,
            column: 59
          },
          end: {
            line: 26,
            column: 67
          }
        }],
        line: 26
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "1e74289665553608b637e07e011d7f064c4a72e1"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_2l6myu9rr3 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_2l6myu9rr3();
const promClient =
/* istanbul ignore next */
(cov_2l6myu9rr3().s[0]++, require('prom-client'));
const register =
/* istanbul ignore next */
(cov_2l6myu9rr3().s[1]++, new promClient.Registry());
/* istanbul ignore next */
cov_2l6myu9rr3().s[2]++;
promClient.collectDefaultMetrics({
  register
});
const httpRequestDuration =
/* istanbul ignore next */
(cov_2l6myu9rr3().s[3]++, new promClient.Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status_code'],
  registers: [register]
}));
const httpRequestTotal =
/* istanbul ignore next */
(cov_2l6myu9rr3().s[4]++, new promClient.Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status_code'],
  registers: [register]
}));
/* istanbul ignore next */
cov_2l6myu9rr3().s[5]++;
const metricsMiddleware = (req, res, next) => {
  /* istanbul ignore next */
  cov_2l6myu9rr3().f[0]++;
  const start =
  /* istanbul ignore next */
  (cov_2l6myu9rr3().s[6]++, Date.now());
  /* istanbul ignore next */
  cov_2l6myu9rr3().s[7]++;
  res.on('finish', () => {
    /* istanbul ignore next */
    cov_2l6myu9rr3().f[1]++;
    const duration =
    /* istanbul ignore next */
    (cov_2l6myu9rr3().s[8]++, (Date.now() - start) / 1000);
    /* istanbul ignore next */
    cov_2l6myu9rr3().s[9]++;
    httpRequestDuration.labels(req.method,
    /* istanbul ignore next */
    (cov_2l6myu9rr3().b[0][0]++, req.route?.path) ||
    /* istanbul ignore next */
    (cov_2l6myu9rr3().b[0][1]++, req.path), res.statusCode).observe(duration);
    /* istanbul ignore next */
    cov_2l6myu9rr3().s[10]++;
    httpRequestTotal.labels(req.method,
    /* istanbul ignore next */
    (cov_2l6myu9rr3().b[1][0]++, req.route?.path) ||
    /* istanbul ignore next */
    (cov_2l6myu9rr3().b[1][1]++, req.path), res.statusCode).inc();
  });
  /* istanbul ignore next */
  cov_2l6myu9rr3().s[11]++;
  next();
};
/* istanbul ignore next */
cov_2l6myu9rr3().s[12]++;
const metricsEndpoint = async (req, res) => {
  /* istanbul ignore next */
  cov_2l6myu9rr3().f[2]++;
  cov_2l6myu9rr3().s[13]++;
  res.set('Content-Type', register.contentType);
  /* istanbul ignore next */
  cov_2l6myu9rr3().s[14]++;
  res.end(await register.metrics());
};
/* istanbul ignore next */
cov_2l6myu9rr3().s[15]++;
module.exports = {
  metricsMiddleware,
  metricsEndpoint,
  register
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMmw2bXl1OXJyMyIsImFjdHVhbENvdmVyYWdlIiwicHJvbUNsaWVudCIsInMiLCJyZXF1aXJlIiwicmVnaXN0ZXIiLCJSZWdpc3RyeSIsImNvbGxlY3REZWZhdWx0TWV0cmljcyIsImh0dHBSZXF1ZXN0RHVyYXRpb24iLCJIaXN0b2dyYW0iLCJuYW1lIiwiaGVscCIsImxhYmVsTmFtZXMiLCJyZWdpc3RlcnMiLCJodHRwUmVxdWVzdFRvdGFsIiwiQ291bnRlciIsIm1ldHJpY3NNaWRkbGV3YXJlIiwicmVxIiwicmVzIiwibmV4dCIsImYiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJvbiIsImR1cmF0aW9uIiwibGFiZWxzIiwibWV0aG9kIiwiYiIsInJvdXRlIiwicGF0aCIsInN0YXR1c0NvZGUiLCJvYnNlcnZlIiwiaW5jIiwibWV0cmljc0VuZHBvaW50Iiwic2V0IiwiY29udGVudFR5cGUiLCJlbmQiLCJtZXRyaWNzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInByb21ldGhldXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcHJvbUNsaWVudCA9IHJlcXVpcmUoJ3Byb20tY2xpZW50Jyk7XG5cbmNvbnN0IHJlZ2lzdGVyID0gbmV3IHByb21DbGllbnQuUmVnaXN0cnkoKTtcbnByb21DbGllbnQuY29sbGVjdERlZmF1bHRNZXRyaWNzKHsgcmVnaXN0ZXIgfSk7XG5cbmNvbnN0IGh0dHBSZXF1ZXN0RHVyYXRpb24gPSBuZXcgcHJvbUNsaWVudC5IaXN0b2dyYW0oe1xuICBuYW1lOiAnaHR0cF9yZXF1ZXN0X2R1cmF0aW9uX3NlY29uZHMnLFxuICBoZWxwOiAnRHVyYXRpb24gb2YgSFRUUCByZXF1ZXN0cyBpbiBzZWNvbmRzJyxcbiAgbGFiZWxOYW1lczogWydtZXRob2QnLCAncm91dGUnLCAnc3RhdHVzX2NvZGUnXSxcbiAgcmVnaXN0ZXJzOiBbcmVnaXN0ZXJdXG59KTtcblxuY29uc3QgaHR0cFJlcXVlc3RUb3RhbCA9IG5ldyBwcm9tQ2xpZW50LkNvdW50ZXIoe1xuICBuYW1lOiAnaHR0cF9yZXF1ZXN0c190b3RhbCcsXG4gIGhlbHA6ICdUb3RhbCBudW1iZXIgb2YgSFRUUCByZXF1ZXN0cycsXG4gIGxhYmVsTmFtZXM6IFsnbWV0aG9kJywgJ3JvdXRlJywgJ3N0YXR1c19jb2RlJ10sXG4gIHJlZ2lzdGVyczogW3JlZ2lzdGVyXVxufSk7XG5cbmNvbnN0IG1ldHJpY3NNaWRkbGV3YXJlID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgXG4gIHJlcy5vbignZmluaXNoJywgKCkgPT4ge1xuICAgIGNvbnN0IGR1cmF0aW9uID0gKERhdGUubm93KCkgLSBzdGFydCkgLyAxMDAwO1xuICAgIGh0dHBSZXF1ZXN0RHVyYXRpb24ubGFiZWxzKHJlcS5tZXRob2QsIHJlcS5yb3V0ZT8ucGF0aCB8fCByZXEucGF0aCwgcmVzLnN0YXR1c0NvZGUpLm9ic2VydmUoZHVyYXRpb24pO1xuICAgIGh0dHBSZXF1ZXN0VG90YWwubGFiZWxzKHJlcS5tZXRob2QsIHJlcS5yb3V0ZT8ucGF0aCB8fCByZXEucGF0aCwgcmVzLnN0YXR1c0NvZGUpLmluYygpO1xuICB9KTtcbiAgXG4gIG5leHQoKTtcbn07XG5cbmNvbnN0IG1ldHJpY3NFbmRwb2ludCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICByZXMuc2V0KCdDb250ZW50LVR5cGUnLCByZWdpc3Rlci5jb250ZW50VHlwZSk7XG4gIHJlcy5lbmQoYXdhaXQgcmVnaXN0ZXIubWV0cmljcygpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0geyBtZXRyaWNzTWlkZGxld2FyZSwgbWV0cmljc0VuZHBvaW50LCByZWdpc3RlciB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFlWTtJQUFBQSxjQUFBLFlBQUFBLENBQUE7TUFBQSxPQUFBQyxjQUFBO0lBQUE7RUFBQTtFQUFBLE9BQUFBLGNBQUE7QUFBQTtBQUFBRCxjQUFBO0FBZlosTUFBTUUsVUFBVTtBQUFBO0FBQUEsQ0FBQUYsY0FBQSxHQUFBRyxDQUFBLE9BQUdDLE9BQU8sQ0FBQyxhQUFhLENBQUM7QUFFekMsTUFBTUMsUUFBUTtBQUFBO0FBQUEsQ0FBQUwsY0FBQSxHQUFBRyxDQUFBLE9BQUcsSUFBSUQsVUFBVSxDQUFDSSxRQUFRLENBQUMsQ0FBQztBQUFDO0FBQUFOLGNBQUEsR0FBQUcsQ0FBQTtBQUMzQ0QsVUFBVSxDQUFDSyxxQkFBcUIsQ0FBQztFQUFFRjtBQUFTLENBQUMsQ0FBQztBQUU5QyxNQUFNRyxtQkFBbUI7QUFBQTtBQUFBLENBQUFSLGNBQUEsR0FBQUcsQ0FBQSxPQUFHLElBQUlELFVBQVUsQ0FBQ08sU0FBUyxDQUFDO0VBQ25EQyxJQUFJLEVBQUUsK0JBQStCO0VBQ3JDQyxJQUFJLEVBQUUsc0NBQXNDO0VBQzVDQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLGFBQWEsQ0FBQztFQUM5Q0MsU0FBUyxFQUFFLENBQUNSLFFBQVE7QUFDdEIsQ0FBQyxDQUFDO0FBRUYsTUFBTVMsZ0JBQWdCO0FBQUE7QUFBQSxDQUFBZCxjQUFBLEdBQUFHLENBQUEsT0FBRyxJQUFJRCxVQUFVLENBQUNhLE9BQU8sQ0FBQztFQUM5Q0wsSUFBSSxFQUFFLHFCQUFxQjtFQUMzQkMsSUFBSSxFQUFFLCtCQUErQjtFQUNyQ0MsVUFBVSxFQUFFLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxhQUFhLENBQUM7RUFDOUNDLFNBQVMsRUFBRSxDQUFDUixRQUFRO0FBQ3RCLENBQUMsQ0FBQztBQUFDO0FBQUFMLGNBQUEsR0FBQUcsQ0FBQTtBQUVILE1BQU1hLGlCQUFpQixHQUFHQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQUE7RUFBQW5CLGNBQUEsR0FBQW9CLENBQUE7RUFDNUMsTUFBTUMsS0FBSztFQUFBO0VBQUEsQ0FBQXJCLGNBQUEsR0FBQUcsQ0FBQSxPQUFHbUIsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztFQUFDO0VBQUF2QixjQUFBLEdBQUFHLENBQUE7RUFFekJlLEdBQUcsQ0FBQ00sRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNO0lBQUE7SUFBQXhCLGNBQUEsR0FBQW9CLENBQUE7SUFDckIsTUFBTUssUUFBUTtJQUFBO0lBQUEsQ0FBQXpCLGNBQUEsR0FBQUcsQ0FBQSxPQUFHLENBQUNtQixJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUdGLEtBQUssSUFBSSxJQUFJO0lBQUM7SUFBQXJCLGNBQUEsR0FBQUcsQ0FBQTtJQUM3Q0ssbUJBQW1CLENBQUNrQixNQUFNLENBQUNULEdBQUcsQ0FBQ1UsTUFBTTtJQUFFO0lBQUEsQ0FBQTNCLGNBQUEsR0FBQTRCLENBQUEsVUFBQVgsR0FBRyxDQUFDWSxLQUFLLEVBQUVDLElBQUk7SUFBQTtJQUFBLENBQUE5QixjQUFBLEdBQUE0QixDQUFBLFVBQUlYLEdBQUcsQ0FBQ2EsSUFBSSxHQUFFWixHQUFHLENBQUNhLFVBQVUsQ0FBQyxDQUFDQyxPQUFPLENBQUNQLFFBQVEsQ0FBQztJQUFDO0lBQUF6QixjQUFBLEdBQUFHLENBQUE7SUFDdEdXLGdCQUFnQixDQUFDWSxNQUFNLENBQUNULEdBQUcsQ0FBQ1UsTUFBTTtJQUFFO0lBQUEsQ0FBQTNCLGNBQUEsR0FBQTRCLENBQUEsVUFBQVgsR0FBRyxDQUFDWSxLQUFLLEVBQUVDLElBQUk7SUFBQTtJQUFBLENBQUE5QixjQUFBLEdBQUE0QixDQUFBLFVBQUlYLEdBQUcsQ0FBQ2EsSUFBSSxHQUFFWixHQUFHLENBQUNhLFVBQVUsQ0FBQyxDQUFDRSxHQUFHLENBQUMsQ0FBQztFQUN4RixDQUFDLENBQUM7RUFBQztFQUFBakMsY0FBQSxHQUFBRyxDQUFBO0VBRUhnQixJQUFJLENBQUMsQ0FBQztBQUNSLENBQUM7QUFBQztBQUFBbkIsY0FBQSxHQUFBRyxDQUFBO0FBRUYsTUFBTStCLGVBQWUsR0FBRyxNQUFBQSxDQUFPakIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFBQTtFQUFBbEIsY0FBQSxHQUFBb0IsQ0FBQTtFQUFBcEIsY0FBQSxHQUFBRyxDQUFBO0VBQzFDZSxHQUFHLENBQUNpQixHQUFHLENBQUMsY0FBYyxFQUFFOUIsUUFBUSxDQUFDK0IsV0FBVyxDQUFDO0VBQUM7RUFBQXBDLGNBQUEsR0FBQUcsQ0FBQTtFQUM5Q2UsR0FBRyxDQUFDbUIsR0FBRyxDQUFDLE1BQU1oQyxRQUFRLENBQUNpQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFBQztBQUFBdEMsY0FBQSxHQUFBRyxDQUFBO0FBRUZvQyxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUFFeEIsaUJBQWlCO0VBQUVrQixlQUFlO0VBQUU3QjtBQUFTLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=