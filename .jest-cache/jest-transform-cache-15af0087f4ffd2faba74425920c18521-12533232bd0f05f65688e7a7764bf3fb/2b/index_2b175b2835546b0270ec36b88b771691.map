{"version":3,"names":["cov_2a5jcxxd2a","actualCoverage","express","Router","SessionManager","app","s","port","b","process","env","PORT","use","json","router","sessionManager","post","req","res","f","message","sessionId","agentPreference","body","status","error","session","getOrCreateSession","response","route","id","conversationHistory","history","addMessage","role","content","agent","tokens","console","setHeader","stream","routeStream","fullContent","chunk","write","JSON","stringify","token","end","get","getSession","params","createdAt","messageCount","length","delete","deleteSession","success","service","require","main","module","listen","log"],"sources":["index.ts"],"sourcesContent":["/**\n * Elara Orchestrator Service\n * Multi-agent LLM routing engine with constitutional validation\n * \n * Routes queries to optimal agent (Sankofa, Themba, Jabari, Nia, Imani)\n * Manages session state, tool use, and streaming responses\n */\n\nimport express from 'express';\nimport { Router } from './router';\nimport { SessionManager } from './session-manager';\n\nconst app = express();\nconst port = process.env.PORT || 3010;\n\napp.use(express.json());\n\nconst router = new Router();\nconst sessionManager = new SessionManager();\n\n/**\n * POST /agent/prompt\n * Route a user prompt through the agent network\n */\napp.post('/agent/prompt', async (req, res) => {\n  const { message, sessionId, agentPreference } = req.body;\n\n  if (!message) {\n    res.status(400).json({ error: 'message is required' });\n    return;\n  }\n\n  try {\n    // Get or create session\n    const session = sessionManager.getOrCreateSession(sessionId);\n\n    // Route to optimal agent\n    const response = await router.route({\n      message,\n      sessionId: session.id,\n      agentPreference,\n      conversationHistory: session.history\n    });\n\n    // Update session history\n    session.addMessage({ role: 'user', content: message });\n    session.addMessage({ role: 'assistant', content: response.content });\n\n    res.json({\n      sessionId: session.id,\n      message: response.content,\n      agent: response.agent,\n      tokens: response.tokens\n    });\n  } catch (error) {\n    console.error('Agent routing error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n});\n\n/**\n * POST /agent/stream\n * Stream responses from agent in real-time\n */\napp.post('/agent/stream', async (req, res) => {\n  const { message, sessionId, agentPreference } = req.body;\n\n  if (!message) {\n    res.status(400).json({ error: 'message is required' });\n    return;\n  }\n\n  try {\n    res.setHeader('Content-Type', 'text/event-stream');\n    res.setHeader('Cache-Control', 'no-cache');\n    res.setHeader('Connection', 'keep-alive');\n\n    const session = sessionManager.getOrCreateSession(sessionId);\n    session.addMessage({ role: 'user', content: message });\n\n    const stream = await router.routeStream({\n      message,\n      sessionId: session.id,\n      agentPreference,\n      conversationHistory: session.history\n    });\n\n    let fullContent = '';\n    for await (const chunk of stream) {\n      fullContent += chunk;\n      res.write(`data: ${JSON.stringify({ token: chunk })}\\n\\n`);\n    }\n\n    session.addMessage({ role: 'assistant', content: fullContent });\n    res.write('data: [DONE]\\n\\n');\n    res.end();\n  } catch (error) {\n    console.error('Stream error:', error);\n    res.status(500).json({ error: 'Streaming failed' });\n  }\n});\n\n/**\n * GET /session/:id\n * Get session details\n */\napp.get('/session/:id', (req, res) => {\n  const session = sessionManager.getSession(req.params.id);\n\n  if (!session) {\n    res.status(404).json({ error: 'Session not found' });\n    return;\n  }\n\n  res.json({\n    id: session.id,\n    createdAt: session.createdAt,\n    messageCount: session.history.length\n  });\n});\n\n/**\n * DELETE /session/:id\n * Close and clear session\n */\napp.delete('/session/:id', (req, res) => {\n  sessionManager.deleteSession(req.params.id);\n  res.json({ success: true });\n});\n\n/**\n * GET /health\n * Health check\n */\napp.get('/health', (req, res) => {\n  res.json({ status: 'ok', service: 'elara-orchestrator' });\n});\n\nif (require.main === module) {\n  app.listen(port, () => {\n    console.log(`ðŸ¤– Elara Orchestrator listening on port ${port}`);\n  });\n}\n\nexport default app;\n"],"mappings":"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","ignoreList":[]}