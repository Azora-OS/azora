{"version":3,"names":["cov_2jk96ckr3u","actualCoverage","RAPContextIntegration","constructor","contextInjector","retriever","ranker","f","s","buildAugmentedPrompt","userQuery","options","b","retrievalResult","retrieve","topK","enforceSeventyThirty","rankingResult","rank","documents","injectionResult","injectContext","contextStats","getContextStats","rankingStats","getStatistics","augmentedPrompt","prompt","tokensUsed","truncated","retrievalStats","totalDocuments","length","internalCount","externalCount","internalPercentage","externalPercentage","retrievalTime","totalRelevanceScore","buildAugmentedPromptWithFormat","format","maxTokens","result","includeMetadata","ContextInjectionPipeline","injectDocuments","userPrompt","stats","contextLength","formatDocuments","formatContext","truncateContext","context","truncateToTokenLimit","validateOptions"],"sources":["rap-integration.ts"],"sourcesContent":["/**\n * RAP Integration with Context Injector\n * Demonstrates how to integrate ContextInjector with RAP system\n */\n\nimport { ContextInjector } from './context-injector';\nimport { KnowledgeOceanRetriever } from './retriever';\nimport { ContextRanker } from './context-ranker';\nimport { Document, ContextInjectionOptions } from './types';\n\n/**\n * RAP Context Integration\n * Combines retrieval, ranking, and context injection for RAP system\n */\nexport class RAPContextIntegration {\n  private contextInjector: ContextInjector;\n  private retriever: KnowledgeOceanRetriever;\n  private ranker: ContextRanker;\n\n  constructor(\n    contextInjector: ContextInjector,\n    retriever: KnowledgeOceanRetriever,\n    ranker: ContextRanker\n  ) {\n    this.contextInjector = contextInjector;\n    this.retriever = retriever;\n    this.ranker = ranker;\n  }\n\n  /**\n   * Complete RAP pipeline: retrieve → rank → inject\n   */\n  async buildAugmentedPrompt(\n    userQuery: string,\n    options: ContextInjectionOptions = {}\n  ): Promise<{\n    augmentedPrompt: string;\n    contextStats: any;\n    retrievalStats: any;\n  }> {\n    // Step 1: Retrieve documents with 70/30 rule\n    const retrievalResult = await this.retriever.retrieve(userQuery, {\n      topK: 10,\n      enforceSeventyThirty: true\n    });\n\n    // Step 2: Rank documents by relevance, diversity, and recency\n    const rankingResult = this.ranker.rank(retrievalResult.documents);\n\n    // Step 3: Inject context into prompt\n    const injectionResult = this.contextInjector.injectContext(\n      userQuery,\n      rankingResult.documents,\n      options\n    );\n\n    // Get statistics\n    const contextStats = this.contextInjector.getContextStats(rankingResult.documents);\n    const rankingStats = this.ranker.getStatistics(rankingResult.documents);\n\n    return {\n      augmentedPrompt: injectionResult.prompt,\n      contextStats: {\n        ...contextStats,\n        ...rankingStats,\n        tokensUsed: injectionResult.tokensUsed,\n        truncated: injectionResult.truncated\n      },\n      retrievalStats: {\n        totalDocuments: retrievalResult.documents.length,\n        internalCount: retrievalResult.internalCount,\n        externalCount: retrievalResult.externalCount,\n        internalPercentage: (retrievalResult.internalCount / retrievalResult.documents.length) * 100,\n        externalPercentage: (retrievalResult.externalCount / retrievalResult.documents.length) * 100,\n        retrievalTime: retrievalResult.retrievalTime,\n        totalRelevanceScore: retrievalResult.totalRelevanceScore\n      }\n    };\n  }\n\n  /**\n   * Build augmented prompt with custom formatting\n   */\n  async buildAugmentedPromptWithFormat(\n    userQuery: string,\n    format: 'markdown' | 'json' | 'plain' = 'markdown',\n    maxTokens: number = 2000\n  ): Promise<string> {\n    const result = await this.buildAugmentedPrompt(userQuery, {\n      format,\n      maxTokens,\n      includeMetadata: true\n    });\n\n    return result.augmentedPrompt;\n  }\n}\n\n/**\n * Context Injection Pipeline\n * Standalone pipeline for context injection without retrieval\n */\nexport class ContextInjectionPipeline {\n  private contextInjector: ContextInjector;\n\n  constructor(contextInjector: ContextInjector) {\n    this.contextInjector = contextInjector;\n  }\n\n  /**\n   * Inject pre-retrieved documents into prompt\n   */\n  injectDocuments(\n    userPrompt: string,\n    documents: Document[],\n    options: ContextInjectionOptions = {}\n  ): {\n    prompt: string;\n    stats: any;\n  } {\n    const result = this.contextInjector.injectContext(userPrompt, documents, options);\n    const stats = this.contextInjector.getContextStats(documents);\n\n    return {\n      prompt: result.prompt,\n      stats: {\n        ...stats,\n        tokensUsed: result.tokensUsed,\n        truncated: result.truncated,\n        contextLength: result.contextLength\n      }\n    };\n  }\n\n  /**\n   * Format documents without injection\n   */\n  formatDocuments(\n    documents: Document[],\n    format: 'markdown' | 'json' | 'plain' = 'markdown',\n    includeMetadata: boolean = true\n  ): string {\n    return this.contextInjector.formatContext(documents, format, includeMetadata);\n  }\n\n  /**\n   * Truncate context to token limit\n   */\n  truncateContext(\n    context: string,\n    maxTokens: number\n  ): {\n    truncatedContext: string;\n    tokensUsed: number;\n    truncated: boolean;\n  } {\n    return this.contextInjector.truncateToTokenLimit(context, maxTokens);\n  }\n\n  /**\n   * Validate injection options\n   */\n  validateOptions(options: ContextInjectionOptions): {\n    valid: boolean;\n    errors: string[];\n  } {\n    return this.contextInjector.validateOptions(options);\n  }\n\n  /**\n   * Get context statistics\n   */\n  getContextStats(documents: Document[]): any {\n    return this.contextInjector.getContextStats(documents);\n  }\n}\n"],"mappings":"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","ignoreList":[]}