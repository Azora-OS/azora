{"version":3,"names":["cov_21tk59czte","actualCoverage","Router","alertsService","structuredLogger","router","s","get","_req","res","f","rules","getRules","json","success","data","count","length","timestamp","Date","toISOString","error","status","post","req","rule","body","b","id","name","metric","threshold","undefined","addRule","message","delete","ruleId","params","removeRule","alerts","getActiveAlerts","limit","parseInt","query","history","getAlertHistory","alertId","resolveAlert","stats","getAlertStatistics"],"sources":["alerts.routes.ts"],"sourcesContent":["/**\n * Alerts Routes\n * Endpoints for managing alerts and alert rules\n */\n\nimport { Router, Request, Response } from 'express';\nimport { alertsService, AlertRule } from '../services/alerts.service';\nimport { structuredLogger } from '../utils/structured-logger';\n\nconst router = Router();\n\n/**\n * GET /alerts/rules\n * Get all alert rules\n */\nrouter.get('/rules', (_req: Request, res: Response) => {\n  try {\n    const rules = alertsService.getRules();\n    res.json({\n      success: true,\n      data: rules,\n      count: rules.length,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to get alert rules', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to get alert rules',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * POST /alerts/rules\n * Create a new alert rule\n */\nrouter.post('/rules', (req: Request, res: Response) => {\n  try {\n    const rule: AlertRule = req.body;\n\n    // Validate rule\n    if (!rule.id || !rule.name || !rule.metric || rule.threshold === undefined) {\n      res.status(400).json({\n        success: false,\n        error: 'Missing required fields: id, name, metric, threshold',\n        timestamp: new Date().toISOString(),\n      });\n      return;\n    }\n\n    alertsService.addRule(rule);\n\n    res.status(201).json({\n      success: true,\n      data: rule,\n      message: 'Alert rule created',\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to create alert rule', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to create alert rule',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * DELETE /alerts/rules/:ruleId\n * Delete an alert rule\n */\nrouter.delete('/rules/:ruleId', (req: Request, res: Response) => {\n  try {\n    const { ruleId } = req.params;\n    alertsService.removeRule(ruleId);\n\n    res.json({\n      success: true,\n      message: `Alert rule ${ruleId} deleted`,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to delete alert rule', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to delete alert rule',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * GET /alerts/active\n * Get active alerts\n */\nrouter.get('/active', (_req: Request, res: Response) => {\n  try {\n    const alerts = alertsService.getActiveAlerts();\n    res.json({\n      success: true,\n      data: alerts,\n      count: alerts.length,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to get active alerts', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to get active alerts',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * GET /alerts/history\n * Get alert history\n */\nrouter.get('/history', (req: Request, res: Response) => {\n  try {\n    const limit = parseInt((req.query.limit as string) || '100');\n    const history = alertsService.getAlertHistory(limit);\n\n    res.json({\n      success: true,\n      data: history,\n      count: history.length,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to get alert history', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to get alert history',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * POST /alerts/:alertId/resolve\n * Resolve an alert\n */\nrouter.post('/:alertId/resolve', (req: Request, res: Response) => {\n  try {\n    const { alertId } = req.params;\n    alertsService.resolveAlert(alertId);\n\n    res.json({\n      success: true,\n      message: `Alert ${alertId} resolved`,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to resolve alert', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to resolve alert',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\n/**\n * GET /alerts/statistics\n * Get alert statistics\n */\nrouter.get('/statistics', (_req: Request, res: Response) => {\n  try {\n    const stats = alertsService.getAlertStatistics();\n    res.json({\n      success: true,\n      data: stats,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    structuredLogger.error('Failed to get alert statistics', error as Error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to get alert statistics',\n      timestamp: new Date().toISOString(),\n    });\n  }\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}