{"version":3,"names":["cov_25yexfsfie","actualCoverage","PrismaClient","Stripe","BusinessLogicTracing","BillingEngine","constructor","config","f","s","prisma","stripe","stripeSecretKey","apiVersion","createInvoice","userId","items","dueDate","traceOperation","itemCount","length","subtotal","reduce","sum","item","amount","quantity","tax","taxRate","total","invoice","create","data","status","map","description","unitPrice","include","id","createdAt","sendInvoice","invoiceId","findUnique","where","user","b","Error","update","console","log","email","processPayment","paymentMethodId","success","error","paymentIntent","paymentIntents","Math","round","currency","toLowerCase","payment_method","confirm","metadata","paidAt","Date","transactionId","message","generateBillingReport","startDate","endDate","invoices","findMany","gte","lte","paidInvoices","filter","inv","totalRevenue","outstandingAmount","period","toISOString","split","totalInvoices","averageInvoiceValue","getInvoice","undefined","getUserInvoices","orderBy","cancelInvoice","refundPayment","refund","refunds","payment_intent","disconnect","$disconnect"],"sources":["billing-engine.ts"],"sourcesContent":["/**\n * Billing Engine\n * Handles invoice generation, payment processing, and billing reports\n */\n\nimport { PrismaClient } from '@prisma/client';\nimport Stripe from 'stripe';\nimport { BusinessLogicTracing } from '../../shared/observability/distributed-tracing';\n\ninterface BillingConfig {\n  stripeSecretKey: string;\n  currency: string;\n  taxRate: number;\n}\n\ninterface InvoiceItem {\n  description: string;\n  amount: number;\n  quantity: number;\n  unitPrice: number;\n}\n\ninterface Invoice {\n  id: string;\n  userId: string;\n  items: InvoiceItem[];\n  subtotal: number;\n  tax: number;\n  total: number;\n  status: 'draft' | 'sent' | 'paid' | 'overdue' | 'cancelled';\n  dueDate: Date;\n  createdAt: Date;\n  paidAt?: Date;\n}\n\ninterface BillingReport {\n  period: string;\n  totalRevenue: number;\n  totalInvoices: number;\n  paidInvoices: number;\n  outstandingAmount: number;\n  averageInvoiceValue: number;\n}\n\n/**\n * Billing Engine Implementation\n */\nexport class BillingEngine {\n  private prisma: PrismaClient;\n  private stripe: Stripe;\n  private config: BillingConfig;\n\n  constructor(config: BillingConfig) {\n    this.config = config;\n    this.prisma = new PrismaClient();\n    this.stripe = new Stripe(config.stripeSecretKey, { apiVersion: '2023-10-16' });\n  }\n\n  /**\n   * Create invoice\n   */\n  async createInvoice(\n    userId: string,\n    items: InvoiceItem[],\n    dueDate: Date\n  ): Promise<Invoice> {\n    return BusinessLogicTracing.traceOperation(\n      'billing.create_invoice',\n      { userId, itemCount: items.length },\n      async () => {\n        // Calculate totals\n        const subtotal = items.reduce((sum, item) => sum + item.amount * item.quantity, 0);\n        const tax = subtotal * this.config.taxRate;\n        const total = subtotal + tax;\n\n        // Create invoice in database\n        const invoice = await this.prisma.invoice.create({\n          data: {\n            userId,\n            subtotal,\n            tax,\n            total,\n            status: 'draft',\n            dueDate,\n            items: {\n              create: items.map((item) => ({\n                description: item.description,\n                amount: item.amount,\n                quantity: item.quantity,\n                unitPrice: item.unitPrice,\n              })),\n            },\n          },\n          include: { items: true },\n        });\n\n        return {\n          id: invoice.id,\n          userId: invoice.userId,\n          items: invoice.items as InvoiceItem[],\n          subtotal: invoice.subtotal,\n          tax: invoice.tax,\n          total: invoice.total,\n          status: invoice.status as any,\n          dueDate: invoice.dueDate,\n          createdAt: invoice.createdAt,\n        };\n      }\n    );\n  }\n\n  /**\n   * Send invoice\n   */\n  async sendInvoice(invoiceId: string): Promise<void> {\n    return BusinessLogicTracing.traceOperation(\n      'billing.send_invoice',\n      { invoiceId },\n      async () => {\n        const invoice = await this.prisma.invoice.findUnique({\n          where: { id: invoiceId },\n          include: { user: true },\n        });\n\n        if (!invoice) {\n          throw new Error('Invoice not found');\n        }\n\n        // Update status\n        await this.prisma.invoice.update({\n          where: { id: invoiceId },\n          data: { status: 'sent' },\n        });\n\n        // Send email (implementation would use email service)\n        console.log(`Invoice ${invoiceId} sent to ${invoice.user.email}`);\n      }\n    );\n  }\n\n  /**\n   * Process payment\n   */\n  async processPayment(\n    invoiceId: string,\n    paymentMethodId: string\n  ): Promise<{ success: boolean; transactionId?: string; error?: string }> {\n    return BusinessLogicTracing.traceOperation(\n      'billing.process_payment',\n      { invoiceId, paymentMethodId },\n      async () => {\n        const invoice = await this.prisma.invoice.findUnique({\n          where: { id: invoiceId },\n          include: { user: true },\n        });\n\n        if (!invoice) {\n          return { success: false, error: 'Invoice not found' };\n        }\n\n        if (invoice.status === 'paid') {\n          return { success: false, error: 'Invoice already paid' };\n        }\n\n        try {\n          // Create payment intent with Stripe\n          const paymentIntent = await this.stripe.paymentIntents.create({\n            amount: Math.round(invoice.total * 100), // Convert to cents\n            currency: this.config.currency.toLowerCase(),\n            payment_method: paymentMethodId,\n            confirm: true,\n            metadata: {\n              invoiceId,\n              userId: invoice.userId,\n            },\n          });\n\n          if (paymentIntent.status === 'succeeded') {\n            // Update invoice status\n            await this.prisma.invoice.update({\n              where: { id: invoiceId },\n              data: {\n                status: 'paid',\n                paidAt: new Date(),\n                transactionId: paymentIntent.id,\n              },\n            });\n\n            return {\n              success: true,\n              transactionId: paymentIntent.id,\n            };\n          } else {\n            return {\n              success: false,\n              error: `Payment failed: ${paymentIntent.status}`,\n            };\n          }\n        } catch (error: any) {\n          return {\n            success: false,\n            error: error.message,\n          };\n        }\n      }\n    );\n  }\n\n  /**\n   * Generate billing report\n   */\n  async generateBillingReport(\n    startDate: Date,\n    endDate: Date\n  ): Promise<BillingReport> {\n    return BusinessLogicTracing.traceOperation(\n      'billing.generate_report',\n      { startDate, endDate },\n      async () => {\n        const invoices = await this.prisma.invoice.findMany({\n          where: {\n            createdAt: {\n              gte: startDate,\n              lte: endDate,\n            },\n          },\n        });\n\n        const paidInvoices = invoices.filter((inv) => inv.status === 'paid');\n        const totalRevenue = paidInvoices.reduce((sum, inv) => sum + inv.total, 0);\n        const outstandingAmount = invoices\n          .filter((inv) => inv.status !== 'paid' && inv.status !== 'cancelled')\n          .reduce((sum, inv) => sum + inv.total, 0);\n\n        return {\n          period: `${startDate.toISOString().split('T')[0]} to ${endDate.toISOString().split('T')[0]}`,\n          totalRevenue,\n          totalInvoices: invoices.length,\n          paidInvoices: paidInvoices.length,\n          outstandingAmount,\n          averageInvoiceValue: invoices.length > 0 ? totalRevenue / invoices.length : 0,\n        };\n      }\n    );\n  }\n\n  /**\n   * Get invoice\n   */\n  async getInvoice(invoiceId: string): Promise<Invoice | null> {\n    const invoice = await this.prisma.invoice.findUnique({\n      where: { id: invoiceId },\n      include: { items: true },\n    });\n\n    if (!invoice) {return null;}\n\n    return {\n      id: invoice.id,\n      userId: invoice.userId,\n      items: invoice.items as InvoiceItem[],\n      subtotal: invoice.subtotal,\n      tax: invoice.tax,\n      total: invoice.total,\n      status: invoice.status as any,\n      dueDate: invoice.dueDate,\n      createdAt: invoice.createdAt,\n      paidAt: invoice.paidAt || undefined,\n    };\n  }\n\n  /**\n   * Get user invoices\n   */\n  async getUserInvoices(userId: string): Promise<Invoice[]> {\n    const invoices = await this.prisma.invoice.findMany({\n      where: { userId },\n      include: { items: true },\n      orderBy: { createdAt: 'desc' },\n    });\n\n    return invoices.map((invoice) => ({\n      id: invoice.id,\n      userId: invoice.userId,\n      items: invoice.items as InvoiceItem[],\n      subtotal: invoice.subtotal,\n      tax: invoice.tax,\n      total: invoice.total,\n      status: invoice.status as any,\n      dueDate: invoice.dueDate,\n      createdAt: invoice.createdAt,\n      paidAt: invoice.paidAt || undefined,\n    }));\n  }\n\n  /**\n   * Cancel invoice\n   */\n  async cancelInvoice(invoiceId: string): Promise<void> {\n    await this.prisma.invoice.update({\n      where: { id: invoiceId },\n      data: { status: 'cancelled' },\n    });\n  }\n\n  /**\n   * Refund payment\n   */\n  async refundPayment(invoiceId: string): Promise<{ success: boolean; error?: string }> {\n    return BusinessLogicTracing.traceOperation(\n      'billing.refund_payment',\n      { invoiceId },\n      async () => {\n        const invoice = await this.prisma.invoice.findUnique({\n          where: { id: invoiceId },\n        });\n\n        if (!invoice) {\n          return { success: false, error: 'Invoice not found' };\n        }\n\n        if (invoice.status !== 'paid') {\n          return { success: false, error: 'Invoice is not paid' };\n        }\n\n        try {\n          // Refund with Stripe\n          const refund = await this.stripe.refunds.create({\n            payment_intent: invoice.transactionId,\n          });\n\n          if (refund.status === 'succeeded') {\n            // Update invoice status\n            await this.prisma.invoice.update({\n              where: { id: invoiceId },\n              data: { status: 'cancelled' },\n            });\n\n            return { success: true };\n          } else {\n            return { success: false, error: `Refund failed: ${refund.status}` };\n          }\n        } catch (error: any) {\n          return { success: false, error: error.message };\n        }\n      }\n    );\n  }\n\n  /**\n   * Cleanup\n   */\n  async disconnect() {\n    await this.prisma.$disconnect();\n  }\n}\n\nexport default BillingEngine;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}