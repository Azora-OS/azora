{"version":3,"names":["cov_2ij1xryd2h","actualCoverage","PrismaClient","logger","prisma","s","TeacherAnalyticsService","getCourseAnalytics","courseId","f","enrollments","enrollment","findMany","where","completedCount","filter","e","status","length","completionRate","b","outcomes","learningOutcome","avgScore","reduce","sum","o","assessmentScore","info","enrollmentCount","averageScore","error","getStudentAnalytics","include","student","studentData","map","studentId","studentName","firstName","lastName","progress","getRevenueReport","instructorId","courses","course","courseIds","c","id","payments","payment","in","totalRevenue","p","Number","amount","instructorShare","paymentCount","teacherAnalyticsService"],"sources":["teacher-analytics.service.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { logger } from '../utils/logger';\n\nconst prisma = new PrismaClient();\n\nexport class TeacherAnalyticsService {\n  async getCourseAnalytics(courseId: string) {\n    try {\n      const enrollments = await prisma.enrollment.findMany({ where: { courseId } });\n      const completedCount = enrollments.filter(e => e.status === 'completed').length;\n      const completionRate = enrollments.length > 0 ? (completedCount / enrollments.length) * 100 : 0;\n\n      const outcomes = await prisma.learningOutcome.findMany({\n        where: { courseId },\n      });\n\n      const avgScore = outcomes.length > 0 \n        ? outcomes.reduce((sum, o) => sum + o.assessmentScore, 0) / outcomes.length \n        : 0;\n\n      logger.info('Course analytics retrieved', { courseId });\n      return { courseId, enrollmentCount: enrollments.length, completionRate, averageScore: avgScore };\n    } catch (error) {\n      logger.error('Error getting course analytics', { error, courseId });\n      throw error;\n    }\n  }\n\n  async getStudentAnalytics(courseId: string) {\n    try {\n      const enrollments = await prisma.enrollment.findMany({\n        where: { courseId },\n        include: { student: true, outcomes: true },\n      });\n\n      const studentData = enrollments.map(e => ({\n        studentId: e.studentId,\n        studentName: e.student.firstName + ' ' + e.student.lastName,\n        progress: e.progress,\n        status: e.status,\n        averageScore: e.outcomes.length > 0 \n          ? e.outcomes.reduce((sum, o) => sum + o.assessmentScore, 0) / e.outcomes.length \n          : 0,\n      }));\n\n      logger.info('Student analytics retrieved', { courseId });\n      return studentData;\n    } catch (error) {\n      logger.error('Error getting student analytics', { error, courseId });\n      throw error;\n    }\n  }\n\n  async getRevenueReport(instructorId: string) {\n    try {\n      const courses = await prisma.course.findMany({ where: { instructorId } });\n      const courseIds = courses.map(c => c.id);\n\n      const payments = await prisma.payment.findMany({\n        where: { courseId: { in: courseIds } },\n      });\n\n      const totalRevenue = payments.reduce((sum, p) => sum + Number(p.amount), 0);\n      const instructorShare = totalRevenue * 0.7; // 70% to instructor\n\n      logger.info('Revenue report generated', { instructorId });\n      return { totalRevenue, instructorShare, paymentCount: payments.length };\n    } catch (error) {\n      logger.error('Error generating revenue report', { error, instructorId });\n      throw error;\n    }\n  }\n}\n\nexport const teacherAnalyticsService = new TeacherAnalyticsService();\n"],"mappings":"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","ignoreList":[]}