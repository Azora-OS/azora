{"version":3,"names":["cov_1sqeqibmu","actualCoverage","express","s","require","bcrypt","router","Router","generateAccessToken","generateRefreshToken","authenticateToken","ROLES","logAuthAttempt","post","req","res","f","email","password","body","ip","user","userId","name","role","STUDENT","accessToken","refreshToken","json","success","ubuntu","error","status","hashedPassword","hash","Date","now","b","get","module","exports"],"sources":["auth.js"],"sourcesContent":["const express = require('express');\nconst bcrypt = require('bcrypt');\nconst router = express.Router();\nconst { generateAccessToken, generateRefreshToken, authenticateToken } = require('../middleware/jwt');\nconst { ROLES } = require('../middleware/rbac');\nconst { logAuthAttempt } = require('../middleware/audit');\n\n// Login endpoint\nrouter.post('/login', async (req, res) => {\n  try {\n    const { email, password } = req.body;\n    \n    await logAuthAttempt(email, true, req.ip);\n    \n    // Mock user validation (replace with database)\n    const user = { \n      userId: 1, \n      email, \n      name: 'Ubuntu User',\n      role: ROLES.STUDENT\n    };\n    \n    const accessToken = generateAccessToken(user);\n    const refreshToken = generateRefreshToken({ userId: user.userId });\n    \n    res.json({\n      success: true,\n      accessToken,\n      refreshToken,\n      user,\n      ubuntu: 'Ubuntu authentication successful'\n    });\n  } catch (error) {\n    res.status(401).json({\n      error: 'Authentication failed',\n      ubuntu: 'Ubuntu security maintained'\n    });\n  }\n});\n\n// Register endpoint\nrouter.post('/register', async (req, res) => {\n  try {\n    const { email, password, name, role } = req.body;\n    \n    // Mock user creation (replace with database)\n    const hashedPassword = await bcrypt.hash(password, 10);\n    const user = { \n      userId: Date.now(), \n      email, \n      name,\n      role: role || ROLES.STUDENT\n    };\n    \n    const accessToken = generateAccessToken(user);\n    const refreshToken = generateRefreshToken({ userId: user.userId });\n    \n    res.status(201).json({\n      success: true,\n      accessToken,\n      refreshToken,\n      user,\n      ubuntu: 'Ubuntu registration successful'\n    });\n  } catch (error) {\n    res.status(400).json({\n      error: 'Registration failed',\n      ubuntu: 'Ubuntu security maintained'\n    });\n  }\n});\n\nrouter.get('/profile', authenticateToken, (req, res) => {\n  res.json({\n    user: req.user,\n    ubuntu: 'Ubuntu profile access granted'\n  });\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}