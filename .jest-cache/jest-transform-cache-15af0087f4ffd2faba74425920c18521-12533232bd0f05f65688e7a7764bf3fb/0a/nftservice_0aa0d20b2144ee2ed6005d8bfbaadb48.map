{"version":3,"names":["cov_1pqis8low8","actualCoverage","BlockchainService","config","IpfsService","NFT_ABI","s","NftService","constructor","f","blockchainService","ipfsService","contractAddress","contracts","nftCertificate","getContract","mintCertificate","recipient","studentName","courseName","grade","metadata","name","description","image","attributes","trait_type","value","Date","toISOString","console","log","ipfsResult","uploadJSON","b","success","url","Error","error","tokenURI","contract","tx","wait","transactionHash","hash","message","verifyCertificate","tokenId","owner","ownerOf","uri"],"sources":["nft-service.ts"],"sourcesContent":["import { ethers } from 'ethers';\nimport { BlockchainService } from './blockchain-service';\nimport { config } from './config';\nimport { IpfsService } from '../../azora-ipfs/src/ipfs-service';\n\n// Basic ABI for NFT interactions\nconst NFT_ABI = [\n    \"function mintCertificate(address to, string memory tokenURI) public returns (uint256)\",\n    \"function ownerOf(uint256 tokenId) public view returns (address)\",\n    \"function tokenURI(uint256 tokenId) public view returns (string)\"\n];\n\nexport class NftService {\n    private blockchainService: BlockchainService;\n    private contractAddress: string;\n    private ipfsService: IpfsService;\n\n    constructor() {\n        this.blockchainService = new BlockchainService();\n        this.ipfsService = new IpfsService();\n        this.contractAddress = config.contracts.nftCertificate;\n    }\n\n    private async getContract(): Promise<ethers.Contract> {\n        return this.blockchainService.getContract(this.contractAddress, NFT_ABI);\n    }\n\n    async mintCertificate(recipient: string, studentName: string, courseName: string, grade: string): Promise<any> {\n        try {\n            // 1. Create Metadata\n            const metadata = {\n                name: `Azora Certificate: ${courseName}`,\n                description: `Certificate of completion for ${studentName}`,\n                image: 'ipfs://QmPlaceholderImage', // In real app, generate and upload image first\n                attributes: [\n                    { trait_type: 'Student', value: studentName },\n                    { trait_type: 'Course', value: courseName },\n                    { trait_type: 'Grade', value: grade },\n                    { trait_type: 'Date', value: new Date().toISOString() }\n                ]\n            };\n\n            // 2. Upload Metadata to IPFS\n            console.log('Uploading metadata to IPFS...');\n            const ipfsResult = await this.ipfsService.uploadJSON(metadata);\n\n            if (!ipfsResult.success || !ipfsResult.url) {\n                throw new Error(`IPFS upload failed: ${ipfsResult.error}`);\n            }\n\n            const tokenURI = ipfsResult.url;\n            console.log(`Metadata uploaded: ${tokenURI}`);\n\n            // 3. Mint NFT with Token URI\n            const contract = await this.getContract();\n            const tx = await contract.mintCertificate(recipient, tokenURI);\n            await tx.wait();\n\n            return {\n                success: true,\n                transactionHash: tx.hash,\n                recipient,\n                tokenURI,\n                message: 'Certificate minted successfully'\n            };\n        } catch (error: any) {\n            console.error('Minting failed:', error);\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n    }\n\n    async verifyCertificate(tokenId: string): Promise<{ owner: string, uri: string }> {\n        const contract = await this.getContract();\n        const owner = await contract.ownerOf(tokenId);\n        const uri = await contract.tokenURI(tokenId);\n        return { owner, uri };\n    }\n}\n"],"mappings":"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","ignoreList":[]}