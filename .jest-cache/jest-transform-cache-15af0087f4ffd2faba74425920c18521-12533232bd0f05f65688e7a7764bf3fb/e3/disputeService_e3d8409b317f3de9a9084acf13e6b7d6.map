{"version":3,"names":["cov_fyhrhuh","actualCoverage","PrismaClient","prisma","s","DisputeService","createDispute","jobId","raisedBy","reason","f","job","update","where","id","data","status","escrow","createdAt","Date","resolveDispute","resolution","findUnique","b","Error","releasedAt","resolvedAt"],"sources":["disputeService.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport class DisputeService {\n  async createDispute(jobId: string, raisedBy: string, reason: string) {\n    await prisma.job.update({\n      where: { id: jobId },\n      data: { status: 'DISPUTED' }\n    });\n\n    await prisma.escrow.update({\n      where: { jobId },\n      data: { status: 'DISPUTED' }\n    });\n\n    return { jobId, status: 'DISPUTED', raisedBy, reason, createdAt: new Date() };\n  }\n\n  async resolveDispute(jobId: string, resolution: 'CLIENT' | 'FREELANCER') {\n    const escrow = await prisma.escrow.findUnique({ where: { jobId } });\n    if (!escrow) {throw new Error('Escrow not found');}\n\n    await prisma.escrow.update({\n      where: { jobId },\n      data: { status: resolution === 'FREELANCER' ? 'RELEASED' : 'REFUNDED', releasedAt: new Date() }\n    });\n\n    await prisma.job.update({\n      where: { id: jobId },\n      data: { status: resolution === 'FREELANCER' ? 'COMPLETED' : 'CANCELLED' }\n    });\n\n    return { jobId, resolution, resolvedAt: new Date() };\n  }\n}\n"],"mappings":"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","ignoreList":[]}