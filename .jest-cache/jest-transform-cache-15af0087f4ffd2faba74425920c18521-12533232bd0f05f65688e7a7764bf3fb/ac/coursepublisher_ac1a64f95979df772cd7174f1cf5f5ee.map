{"version":3,"names":["cov_18k00qetsd","actualCoverage","PrismaClient","CoursePublisher","constructor","f","s","prisma","publishCourse","generatedCourse","console","log","title","moduleData","groupLessonsByModule","lessons","length","course","create","data","description","price","level","category","duration","Math","round","totalDuration","instructorId","currency","published","modules","include","id","lessonCount","courseId","url","status","moduleCount","error","Map","lesson","has","moduleTitle","b","set","get","push","Array","from","entries","map","moduleLessons","index","order","content","JSON","stringify","l","videoUrl","video","audioUrl","audio","thumbnail","transcript","script","codeExamples","exercises","quiz","slides","updateCourseStatus","update","where","getCourseStats","findUnique","enrollments","_count","select","Error","revenue"],"sources":["course-publisher.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { GeneratedCourse, CompleteLesson } from './course-engine';\n\nexport interface PublishedCourse {\n    courseId: string;\n    title: string;\n    url: string;\n    status: 'pending_review' | 'published';\n    lessonCount: number;\n    moduleCount: number;\n}\n\nexport class CoursePublisher {\n    private prisma: PrismaClient;\n\n    constructor() {\n        this.prisma = new PrismaClient();\n    }\n\n    async publishCourse(generatedCourse: GeneratedCourse): Promise<PublishedCourse> {\n        console.log(`\\nüì§ PUBLISHING COURSE: ${generatedCourse.title}`);\n\n        try {\n            // Group lessons by module\n            const moduleData = this.groupLessonsByModule(generatedCourse.lessons);\n\n            console.log(`   Creating course with ${moduleData.length} modules...`);\n\n            // Create course in database\n            const course = await this.prisma.course.create({\n                data: {\n                    title: generatedCourse.title,\n                    description: generatedCourse.description,\n                    price: generatedCourse.price,\n                    level: generatedCourse.level as any, // Bypass enum type\n                    category: generatedCourse.category,\n                    duration: Math.round(generatedCourse.totalDuration / 60),\n                    instructorId: 'elara-ai',\n                    currency: 'ZAR',\n                    published: false,\n                    modules: {\n                        create: moduleData\n                    }\n                },\n                include: {\n                    modules: true\n                }\n            });\n\n            console.log(`   ‚úÖ Course created: ${course.id}`);\n            console.log(`   üìä Modules: ${course.modules.length}`);\n            console.log(`   üìö Lessons: ${generatedCourse.lessonCount}`);\n            console.log(`   ‚è±Ô∏è  Duration: ${course.duration} hours`);\n            console.log(`   üí∞ Price: R${course.price}`);\n            console.log(`   üîç Status: Pending Review\\n`);\n\n            return {\n                courseId: course.id,\n                title: course.title,\n                url: `/courses/${course.id}`,\n                status: 'pending_review',\n                lessonCount: generatedCourse.lessonCount,\n                moduleCount: course.modules.length\n            };\n        } catch (error) {\n            console.error('‚ùå Failed to publish course:', error);\n            throw error;\n        }\n    }\n\n    private groupLessonsByModule(lessons: CompleteLesson[]) {\n        const modules = new Map<string, CompleteLesson[]>();\n\n        for (const lesson of lessons) {\n            if (!modules.has(lesson.moduleTitle)) {\n                modules.set(lesson.moduleTitle, []);\n            }\n            modules.get(lesson.moduleTitle)!.push(lesson);\n        }\n\n        return Array.from(modules.entries()).map(([title, moduleLessons], index) => ({\n            title,\n            description: `Module ${index + 1} - ${title}`,\n            order: index + 1,\n            content: JSON.stringify({\n                lessons: moduleLessons.map(l => ({\n                    title: l.title,\n                    order: l.order,\n                    videoUrl: l.video.url,\n                    audioUrl: l.audio.url,\n                    thumbnail: l.video.thumbnail,\n                    duration: l.video.duration,\n                    transcript: l.script,\n                    codeExamples: l.codeExamples || [],\n                    exercises: l.exercises || [],\n                    quiz: l.quiz,\n                    slides: l.slides\n                }))\n            })\n        }));\n    }\n\n    async updateCourseStatus(courseId: string, published: boolean): Promise<void> {\n        await this.prisma.course.update({\n            where: { id: courseId },\n            data: { published }\n        });\n\n        console.log(`‚úÖ Course ${courseId} ${published ? 'published' : 'unpublished'}`);\n    }\n\n    async getCourseStats(courseId: string) {\n        const course = await this.prisma.course.findUnique({\n            where: { id: courseId },\n            include: {\n                modules: true,\n                enrollments: true,\n                _count: {\n                    select: {\n                        enrollments: true,\n                        modules: true\n                    }\n                }\n            }\n        });\n\n        if (!course) {\n            throw new Error('Course not found');\n        }\n\n        return {\n            id: course.id,\n            title: course.title,\n            published: course.published,\n            enrollments: course._count.enrollments,\n            modules: course._count.modules,\n            revenue: course._count.enrollments * course.price\n        };\n    }\n}\n"],"mappings":"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","ignoreList":[]}