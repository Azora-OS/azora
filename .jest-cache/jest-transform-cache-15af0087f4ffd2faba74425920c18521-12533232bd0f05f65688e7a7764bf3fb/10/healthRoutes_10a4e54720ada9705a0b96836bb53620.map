{"version":3,"names":["cov_22vujujdy9","actualCoverage","Router","logger","router","s","get","req","res","f","json","success","status","service","timestamp","Date","toISOString","uptime","process","database","error","Error","b","message","set","send","data","listings","total","active","categories","transactions","name","collections"],"sources":["healthRoutes.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nimport { Router, Request, Response } from 'express';\n// import mongoose from 'mongoose';\n// import { getMetrics } from '../middleware/metrics';\nimport logger from '../middleware/requestLogger';\n\nconst router = Router();\n\n/**\n * @swagger\n * /api/health:\n *   get:\n *     summary: Basic health check\n */\nrouter.get('/', (req: Request, res: Response) => {\n  res.json({\n    success: true,\n    status: 'healthy',\n    service: 'azora-forge',\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime()\n  });\n});\n\n/**\n * @swagger\n * /api/health/ready:\n *   get:\n *     summary: Readiness check (includes database connectivity)\n */\nrouter.get('/ready', async (req: Request, res: Response) => {\n  try {\n    // Check database connectivity\n    // const db = mongoose.connection.db;\n    // if (!db) {\n    //   throw new Error('Database not connected');\n    // }\n    // await db.admin().ping();\n\n    res.json({\n      success: true,\n      status: 'ready',\n      service: 'azora-forge',\n      database: 'mock-connected', // Mock for now\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    logger.error('Readiness check failed:', error);\n    res.status(503).json({\n      success: false,\n      status: 'not ready',\n      service: 'azora-forge',\n      database: 'disconnected',\n      error: error instanceof Error ? error.message : 'Unknown error',\n      timestamp: new Date().toISOString()\n    });\n  }\n});\n\n/**\n * @swagger\n * /api/health/live:\n *   get:\n *     summary: Liveness check\n */\nrouter.get('/live', (req: Request, res: Response) => {\n  res.json({\n    success: true,\n    status: 'alive',\n    service: 'azora-forge',\n    timestamp: new Date().toISOString()\n  });\n});\n\n/**\n * @swagger\n * /api/health/metrics:\n *   get:\n *     summary: Prometheus metrics\n */\nrouter.get('/metrics', async (req: Request, res: Response) => {\n  try {\n    // const metrics = await getMetrics();\n    res.set('Content-Type', 'text/plain; charset=utf-8');\n    res.send('# Mock metrics\\nup 1\\n');\n  } catch (error) {\n    logger.error('Error getting metrics:', error);\n    res.status(500).json({ success: false, error: 'Failed to get metrics' });\n  }\n});\n\n/**\n * @swagger\n * /api/health/stats:\n *   get:\n *     summary: Service statistics\n */\nrouter.get('/stats', async (req: Request, res: Response) => {\n  try {\n    // const db = mongoose.connection.db;\n    // if (!db) {\n    //   throw new Error('Database not connected');\n    // }\n\n    // const [\n    //   totalListings,\n    //   activeListings,\n    //   totalCategories,\n    //   totalTransactions\n    // ] = await Promise.all([\n    //   db.collection('listings').countDocuments(),\n    //   db.collection('listings').countDocuments({ status: 'active' }),\n    //   db.collection('categories').countDocuments({ isActive: true }),\n    //   db.collection('transactions').countDocuments()\n    // ]);\n\n    res.json({\n      success: true,\n      data: {\n        listings: {\n          total: 0, // Mock data\n          active: 0\n        },\n        categories: 0,\n        transactions: 0,\n        database: {\n          name: 'mock-db',\n          collections: 0\n        }\n      },\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    logger.error('Error getting stats:', error);\n    res.status(500).json({ success: false, error: 'Failed to get statistics' });\n  }\n});\n\nexport default router;"],"mappings":"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","ignoreList":[]}