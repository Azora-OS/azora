{"version":3,"names":["cov_ly4gz7lh8","actualCoverage","express","ConstitutionalValidator","app","s","port","b","process","env","PORT","use","json","validator","post","req","res","f","action","context","userId","body","status","error","result","validatePre","valid","violations","warnings","console","validation","validatePost","compliant","auditRecord","get","rules","getRules","service","require","main","module","listen","log"],"sources":["index.ts"],"sourcesContent":["/**\n * Constitutional Validator Service\n * Pre/post-execution validation against constitutional rules\n * \n * Rules defined in:\n * - /workspaces/azora/AZORA_CONSTITUTION.md\n * - /workspaces/azora/CONSTITUTION.md\n * - Individual room-specific policies\n */\n\nimport express from 'express';\nimport { ConstitutionalValidator } from './validator';\n\nconst app = express();\nconst port = process.env.PORT || 3011;\n\napp.use(express.json());\n\nconst validator = new ConstitutionalValidator();\n\n/**\n * POST /validate/pre\n * Pre-execution validation (before agent acts)\n */\napp.post('/validate/pre', async (req, res) => {\n  const { action, context, userId } = req.body;\n\n  if (!action) {\n    res.status(400).json({ error: 'action is required' });\n    return;\n  }\n\n  try {\n    const result = await validator.validatePre({\n      action,\n      context,\n      userId\n    });\n\n    res.json({\n      valid: result.valid,\n      violations: result.violations,\n      warnings: result.warnings\n    });\n  } catch (error) {\n    console.error('Pre-validation error:', error);\n    res.status(500).json({ error: 'Validation failed' });\n  }\n});\n\n/**\n * POST /validate/post\n * Post-execution validation (audit trail)\n */\napp.post('/validate/post', async (req, res) => {\n  const { action, result, userId } = req.body;\n\n  if (!action || !result) {\n    res.status(400).json({ error: 'action and result are required' });\n    return;\n  }\n\n  try {\n    const validation = await validator.validatePost({\n      action,\n      result,\n      userId\n    });\n\n    res.json({\n      compliant: validation.compliant,\n      violations: validation.violations,\n      auditRecord: validation.auditRecord\n    });\n  } catch (error) {\n    console.error('Post-validation error:', error);\n    res.status(500).json({ error: 'Validation failed' });\n  }\n});\n\n/**\n * GET /rules\n * List all active constitutional rules\n */\napp.get('/rules', (req, res) => {\n  const rules = validator.getRules();\n  res.json({ rules });\n});\n\n/**\n * GET /health\n * Health check\n */\napp.get('/health', (req, res) => {\n  res.json({ status: 'ok', service: 'constitutional-validator' });\n});\n\nif (require.main === module) {\n  app.listen(port, () => {\n    console.log(`⚖️  Constitutional Validator listening on port ${port}`);\n  });\n}\n\nexport default app;\n"],"mappings":"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","ignoreList":[]}