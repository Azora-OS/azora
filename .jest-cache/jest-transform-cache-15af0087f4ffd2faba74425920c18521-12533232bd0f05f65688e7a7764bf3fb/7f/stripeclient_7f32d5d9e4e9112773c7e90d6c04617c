1f606b396bdd62a5d9c4837984ba9352
/* istanbul ignore next */
function cov_289dhj249a() {
  var path = "/workspaces/azora/services/elara-incubator/src/utils/stripe-client.ts";
  var hash = "b53d7e24e10d1eec01827083ef6b3a5d58195d0e";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/elara-incubator/src/utils/stripe-client.ts",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 15
        },
        end: {
          line: 5,
          column: 2
        }
      },
      "1": {
        start: {
          line: 12,
          column: 4
        },
        end: {
          line: 21,
          column: 5
        }
      },
      "2": {
        start: {
          line: 13,
          column: 28
        },
        end: {
          line: 17,
          column: 8
        }
      },
      "3": {
        start: {
          line: 18,
          column: 6
        },
        end: {
          line: 18,
          column: 30
        }
      },
      "4": {
        start: {
          line: 20,
          column: 6
        },
        end: {
          line: 20,
          column: 67
        }
      },
      "5": {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 35,
          column: 5
        }
      },
      "6": {
        start: {
          line: 29,
          column: 28
        },
        end: {
          line: 31,
          column: 8
        }
      },
      "7": {
        start: {
          line: 32,
          column: 6
        },
        end: {
          line: 32,
          column: 50
        }
      },
      "8": {
        start: {
          line: 34,
          column: 6
        },
        end: {
          line: 34,
          column: 61
        }
      },
      "9": {
        start: {
          line: 42,
          column: 4
        },
        end: {
          line: 47,
          column: 5
        }
      },
      "10": {
        start: {
          line: 43,
          column: 28
        },
        end: {
          line: 43,
          column: 81
        }
      },
      "11": {
        start: {
          line: 44,
          column: 6
        },
        end: {
          line: 44,
          column: 34
        }
      },
      "12": {
        start: {
          line: 46,
          column: 6
        },
        end: {
          line: 46,
          column: 64
        }
      },
      "13": {
        start: {
          line: 54,
          column: 4
        },
        end: {
          line: 62,
          column: 5
        }
      },
      "14": {
        start: {
          line: 55,
          column: 21
        },
        end: {
          line: 58,
          column: 8
        }
      },
      "15": {
        start: {
          line: 59,
          column: 6
        },
        end: {
          line: 59,
          column: 23
        }
      },
      "16": {
        start: {
          line: 61,
          column: 6
        },
        end: {
          line: 61,
          column: 60
        }
      },
      "17": {
        start: {
          line: 69,
          column: 4
        },
        end: {
          line: 77,
          column: 5
        }
      },
      "18": {
        start: {
          line: 70,
          column: 23
        },
        end: {
          line: 73,
          column: 8
        }
      },
      "19": {
        start: {
          line: 74,
          column: 6
        },
        end: {
          line: 74,
          column: 25
        }
      },
      "20": {
        start: {
          line: 76,
          column: 6
        },
        end: {
          line: 76,
          column: 61
        }
      },
      "21": {
        start: {
          line: 84,
          column: 4
        },
        end: {
          line: 88,
          column: 5
        }
      },
      "22": {
        start: {
          line: 85,
          column: 6
        },
        end: {
          line: 85,
          column: 57
        }
      },
      "23": {
        start: {
          line: 87,
          column: 6
        },
        end: {
          line: 87,
          column: 58
        }
      },
      "24": {
        start: {
          line: 95,
          column: 4
        },
        end: {
          line: 103,
          column: 5
        }
      },
      "25": {
        start: {
          line: 96,
          column: 23
        },
        end: {
          line: 99,
          column: 8
        }
      },
      "26": {
        start: {
          line: 100,
          column: 6
        },
        end: {
          line: 100,
          column: 25
        }
      },
      "27": {
        start: {
          line: 102,
          column: 6
        },
        end: {
          line: 102,
          column: 69
        }
      },
      "28": {
        start: {
          line: 110,
          column: 4
        },
        end: {
          line: 114,
          column: 5
        }
      },
      "29": {
        start: {
          line: 111,
          column: 6
        },
        end: {
          line: 111,
          column: 69
        }
      },
      "30": {
        start: {
          line: 113,
          column: 6
        },
        end: {
          line: 113,
          column: 70
        }
      },
      "31": {
        start: {
          line: 118,
          column: 28
        },
        end: {
          line: 118,
          column: 46
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 11,
            column: 2
          },
          end: {
            line: 11,
            column: 3
          }
        },
        loc: {
          start: {
            line: 11,
            column: 87
          },
          end: {
            line: 22,
            column: 3
          }
        },
        line: 11
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 27,
            column: 2
          },
          end: {
            line: 27,
            column: 3
          }
        },
        loc: {
          start: {
            line: 27,
            column: 92
          },
          end: {
            line: 36,
            column: 3
          }
        },
        line: 27
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 41,
            column: 2
          },
          end: {
            line: 41,
            column: 3
          }
        },
        loc: {
          start: {
            line: 41,
            column: 67
          },
          end: {
            line: 48,
            column: 3
          }
        },
        line: 41
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 53,
            column: 2
          },
          end: {
            line: 53,
            column: 3
          }
        },
        loc: {
          start: {
            line: 53,
            column: 81
          },
          end: {
            line: 63,
            column: 3
          }
        },
        line: 53
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 68,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        },
        loc: {
          start: {
            line: 68,
            column: 70
          },
          end: {
            line: 78,
            column: 3
          }
        },
        line: 68
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 83,
            column: 2
          },
          end: {
            line: 83,
            column: 3
          }
        },
        loc: {
          start: {
            line: 83,
            column: 66
          },
          end: {
            line: 89,
            column: 3
          }
        },
        line: 83
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 94,
            column: 2
          },
          end: {
            line: 94,
            column: 3
          }
        },
        loc: {
          start: {
            line: 94,
            column: 78
          },
          end: {
            line: 104,
            column: 3
          }
        },
        line: 94
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 109,
            column: 2
          },
          end: {
            line: 109,
            column: 3
          }
        },
        loc: {
          start: {
            line: 109,
            column: 88
          },
          end: {
            line: 115,
            column: 3
          }
        },
        line: 109
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 3,
            column: 26
          },
          end: {
            line: 3,
            column: 61
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 3,
            column: 26
          },
          end: {
            line: 3,
            column: 55
          }
        }, {
          start: {
            line: 3,
            column: 59
          },
          end: {
            line: 3,
            column: 61
          }
        }],
        line: 3
      },
      "1": {
        loc: {
          start: {
            line: 11,
            column: 44
          },
          end: {
            line: 11,
            column: 68
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 11,
            column: 63
          },
          end: {
            line: 11,
            column: 68
          }
        }],
        line: 11
      },
      "2": {
        loc: {
          start: {
            line: 57,
            column: 16
          },
          end: {
            line: 57,
            column: 61
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 57,
            column: 25
          },
          end: {
            line: 57,
            column: 49
          }
        }, {
          start: {
            line: 57,
            column: 52
          },
          end: {
            line: 57,
            column: 61
          }
        }],
        line: 57
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0
    },
    b: {
      "0": [0, 0],
      "1": [0],
      "2": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "b53d7e24e10d1eec01827083ef6b3a5d58195d0e"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_289dhj249a = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_289dhj249a();
import Stripe from 'stripe';
const stripe =
/* istanbul ignore next */
(cov_289dhj249a().s[0]++, new Stripe(
/* istanbul ignore next */
(cov_289dhj249a().b[0][0]++, process.env.STRIPE_SECRET_KEY) ||
/* istanbul ignore next */
(cov_289dhj249a().b[0][1]++, ''), {
  apiVersion: '2023-10-16'
}));
export class StripeClient {
  /**
   * Create a payment intent
   */
  async createPaymentIntent(amount, currency =
  /* istanbul ignore next */
  (cov_289dhj249a().b[1][0]++, 'usd')) {
    /* istanbul ignore next */
    cov_289dhj249a().f[0]++;
    cov_289dhj249a().s[1]++;
    try {
      const paymentIntent =
      /* istanbul ignore next */
      (cov_289dhj249a().s[2]++, await stripe.paymentIntents.create({
        amount: Math.round(amount * 100),
        // Convert to cents
        currency,
        payment_method_types: ['card']
      }));
      /* istanbul ignore next */
      cov_289dhj249a().s[3]++;
      return paymentIntent.id;
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[4]++;
      throw new Error(`Failed to create payment intent: ${error}`);
    }
  }

  /**
   * Confirm a payment intent
   */
  async confirmPayment(paymentIntentId, paymentMethodId) {
    /* istanbul ignore next */
    cov_289dhj249a().f[1]++;
    cov_289dhj249a().s[5]++;
    try {
      const paymentIntent =
      /* istanbul ignore next */
      (cov_289dhj249a().s[6]++, await stripe.paymentIntents.confirm(paymentIntentId, {
        payment_method: paymentMethodId
      }));
      /* istanbul ignore next */
      cov_289dhj249a().s[7]++;
      return paymentIntent.status === 'succeeded';
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[8]++;
      throw new Error(`Failed to confirm payment: ${error}`);
    }
  }

  /**
   * Get payment intent status
   */
  async getPaymentStatus(paymentIntentId) {
    /* istanbul ignore next */
    cov_289dhj249a().f[2]++;
    cov_289dhj249a().s[9]++;
    try {
      const paymentIntent =
      /* istanbul ignore next */
      (cov_289dhj249a().s[10]++, await stripe.paymentIntents.retrieve(paymentIntentId));
      /* istanbul ignore next */
      cov_289dhj249a().s[11]++;
      return paymentIntent.status;
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[12]++;
      throw new Error(`Failed to get payment status: ${error}`);
    }
  }

  /**
   * Refund a payment
   */
  async refundPayment(paymentIntentId, amount) {
    /* istanbul ignore next */
    cov_289dhj249a().f[3]++;
    cov_289dhj249a().s[13]++;
    try {
      const refund =
      /* istanbul ignore next */
      (cov_289dhj249a().s[14]++, await stripe.refunds.create({
        payment_intent: paymentIntentId,
        amount: amount ?
        /* istanbul ignore next */
        (cov_289dhj249a().b[2][0]++, Math.round(amount * 100)) :
        /* istanbul ignore next */
        (cov_289dhj249a().b[2][1]++, undefined)
      }));
      /* istanbul ignore next */
      cov_289dhj249a().s[15]++;
      return refund.id;
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[16]++;
      throw new Error(`Failed to refund payment: ${error}`);
    }
  }

  /**
   * Create a customer
   */
  async createCustomer(email, name) {
    /* istanbul ignore next */
    cov_289dhj249a().f[4]++;
    cov_289dhj249a().s[17]++;
    try {
      const customer =
      /* istanbul ignore next */
      (cov_289dhj249a().s[18]++, await stripe.customers.create({
        email,
        name
      }));
      /* istanbul ignore next */
      cov_289dhj249a().s[19]++;
      return customer.id;
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[20]++;
      throw new Error(`Failed to create customer: ${error}`);
    }
  }

  /**
   * Get customer
   */
  async getCustomer(customerId) {
    /* istanbul ignore next */
    cov_289dhj249a().f[5]++;
    cov_289dhj249a().s[21]++;
    try {
      /* istanbul ignore next */
      cov_289dhj249a().s[22]++;
      return await stripe.customers.retrieve(customerId);
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[23]++;
      throw new Error(`Failed to get customer: ${error}`);
    }
  }

  /**
   * Create a webhook endpoint
   */
  async createWebhookEndpoint(url, events) {
    /* istanbul ignore next */
    cov_289dhj249a().f[6]++;
    cov_289dhj249a().s[24]++;
    try {
      const endpoint =
      /* istanbul ignore next */
      (cov_289dhj249a().s[25]++, await stripe.webhookEndpoints.create({
        url,
        enabled_events: events
      }));
      /* istanbul ignore next */
      cov_289dhj249a().s[26]++;
      return endpoint.id;
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[27]++;
      throw new Error(`Failed to create webhook endpoint: ${error}`);
    }
  }

  /**
   * Verify webhook signature
   */
  verifyWebhookSignature(body, signature, secret) {
    /* istanbul ignore next */
    cov_289dhj249a().f[7]++;
    cov_289dhj249a().s[28]++;
    try {
      /* istanbul ignore next */
      cov_289dhj249a().s[29]++;
      return stripe.webhooks.constructEvent(body, signature, secret);
    } catch (error) {
      /* istanbul ignore next */
      cov_289dhj249a().s[30]++;
      throw new Error(`Failed to verify webhook signature: ${error}`);
    }
  }
}
export const stripeClient =
/* istanbul ignore next */
(cov_289dhj249a().s[31]++, new StripeClient());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjg5ZGhqMjQ5YSIsImFjdHVhbENvdmVyYWdlIiwiU3RyaXBlIiwic3RyaXBlIiwicyIsImIiLCJwcm9jZXNzIiwiZW52IiwiU1RSSVBFX1NFQ1JFVF9LRVkiLCJhcGlWZXJzaW9uIiwiU3RyaXBlQ2xpZW50IiwiY3JlYXRlUGF5bWVudEludGVudCIsImFtb3VudCIsImN1cnJlbmN5IiwiZiIsInBheW1lbnRJbnRlbnQiLCJwYXltZW50SW50ZW50cyIsImNyZWF0ZSIsIk1hdGgiLCJyb3VuZCIsInBheW1lbnRfbWV0aG9kX3R5cGVzIiwiaWQiLCJlcnJvciIsIkVycm9yIiwiY29uZmlybVBheW1lbnQiLCJwYXltZW50SW50ZW50SWQiLCJwYXltZW50TWV0aG9kSWQiLCJjb25maXJtIiwicGF5bWVudF9tZXRob2QiLCJzdGF0dXMiLCJnZXRQYXltZW50U3RhdHVzIiwicmV0cmlldmUiLCJyZWZ1bmRQYXltZW50IiwicmVmdW5kIiwicmVmdW5kcyIsInBheW1lbnRfaW50ZW50IiwidW5kZWZpbmVkIiwiY3JlYXRlQ3VzdG9tZXIiLCJlbWFpbCIsIm5hbWUiLCJjdXN0b21lciIsImN1c3RvbWVycyIsImdldEN1c3RvbWVyIiwiY3VzdG9tZXJJZCIsImNyZWF0ZVdlYmhvb2tFbmRwb2ludCIsInVybCIsImV2ZW50cyIsImVuZHBvaW50Iiwid2ViaG9va0VuZHBvaW50cyIsImVuYWJsZWRfZXZlbnRzIiwidmVyaWZ5V2ViaG9va1NpZ25hdHVyZSIsImJvZHkiLCJzaWduYXR1cmUiLCJzZWNyZXQiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50Iiwic3RyaXBlQ2xpZW50Il0sInNvdXJjZXMiOlsic3RyaXBlLWNsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyaXBlIGZyb20gJ3N0cmlwZSc7XG5cbmNvbnN0IHN0cmlwZSA9IG5ldyBTdHJpcGUocHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVkgfHwgJycsIHtcbiAgYXBpVmVyc2lvbjogJzIwMjMtMTAtMTYnLFxufSk7XG5cbmV4cG9ydCBjbGFzcyBTdHJpcGVDbGllbnQge1xuICAvKipcbiAgICogQ3JlYXRlIGEgcGF5bWVudCBpbnRlbnRcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBheW1lbnRJbnRlbnQoYW1vdW50OiBudW1iZXIsIGN1cnJlbmN5OiBzdHJpbmcgPSAndXNkJyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBheW1lbnRJbnRlbnQgPSBhd2FpdCBzdHJpcGUucGF5bWVudEludGVudHMuY3JlYXRlKHtcbiAgICAgICAgYW1vdW50OiBNYXRoLnJvdW5kKGFtb3VudCAqIDEwMCksIC8vIENvbnZlcnQgdG8gY2VudHNcbiAgICAgICAgY3VycmVuY3ksXG4gICAgICAgIHBheW1lbnRfbWV0aG9kX3R5cGVzOiBbJ2NhcmQnXSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBheW1lbnRJbnRlbnQuaWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBwYXltZW50IGludGVudDogJHtlcnJvcn1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlybSBhIHBheW1lbnQgaW50ZW50XG4gICAqL1xuICBhc3luYyBjb25maXJtUGF5bWVudChwYXltZW50SW50ZW50SWQ6IHN0cmluZywgcGF5bWVudE1ldGhvZElkPzogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBheW1lbnRJbnRlbnQgPSBhd2FpdCBzdHJpcGUucGF5bWVudEludGVudHMuY29uZmlybShwYXltZW50SW50ZW50SWQsIHtcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2RJZCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBheW1lbnRJbnRlbnQuc3RhdHVzID09PSAnc3VjY2VlZGVkJztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY29uZmlybSBwYXltZW50OiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGF5bWVudCBpbnRlbnQgc3RhdHVzXG4gICAqL1xuICBhc3luYyBnZXRQYXltZW50U3RhdHVzKHBheW1lbnRJbnRlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGF5bWVudEludGVudCA9IGF3YWl0IHN0cmlwZS5wYXltZW50SW50ZW50cy5yZXRyaWV2ZShwYXltZW50SW50ZW50SWQpO1xuICAgICAgcmV0dXJuIHBheW1lbnRJbnRlbnQuc3RhdHVzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgcGF5bWVudCBzdGF0dXM6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZnVuZCBhIHBheW1lbnRcbiAgICovXG4gIGFzeW5jIHJlZnVuZFBheW1lbnQocGF5bWVudEludGVudElkOiBzdHJpbmcsIGFtb3VudD86IG51bWJlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlZnVuZCA9IGF3YWl0IHN0cmlwZS5yZWZ1bmRzLmNyZWF0ZSh7XG4gICAgICAgIHBheW1lbnRfaW50ZW50OiBwYXltZW50SW50ZW50SWQsXG4gICAgICAgIGFtb3VudDogYW1vdW50ID8gTWF0aC5yb3VuZChhbW91bnQgKiAxMDApIDogdW5kZWZpbmVkLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVmdW5kLmlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZWZ1bmQgcGF5bWVudDogJHtlcnJvcn1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgY3VzdG9tZXJcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUN1c3RvbWVyKGVtYWlsOiBzdHJpbmcsIG5hbWU/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXN0b21lciA9IGF3YWl0IHN0cmlwZS5jdXN0b21lcnMuY3JlYXRlKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWUsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjdXN0b21lci5pZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIGN1c3RvbWVyOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VzdG9tZXJcbiAgICovXG4gIGFzeW5jIGdldEN1c3RvbWVyKGN1c3RvbWVySWQ6IHN0cmluZyk6IFByb21pc2U8U3RyaXBlLkN1c3RvbWVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBzdHJpcGUuY3VzdG9tZXJzLnJldHJpZXZlKGN1c3RvbWVySWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgY3VzdG9tZXI6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHdlYmhvb2sgZW5kcG9pbnRcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVdlYmhvb2tFbmRwb2ludCh1cmw6IHN0cmluZywgZXZlbnRzOiBzdHJpbmdbXSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVuZHBvaW50ID0gYXdhaXQgc3RyaXBlLndlYmhvb2tFbmRwb2ludHMuY3JlYXRlKHtcbiAgICAgICAgdXJsLFxuICAgICAgICBlbmFibGVkX2V2ZW50czogZXZlbnRzLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZW5kcG9pbnQuaWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSB3ZWJob29rIGVuZHBvaW50OiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2ViaG9vayBzaWduYXR1cmVcbiAgICovXG4gIHZlcmlmeVdlYmhvb2tTaWduYXR1cmUoYm9keTogc3RyaW5nLCBzaWduYXR1cmU6IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpOiBTdHJpcGUuRXZlbnQge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gc3RyaXBlLndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KGJvZHksIHNpZ25hdHVyZSwgc2VjcmV0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdmVyaWZ5IHdlYmhvb2sgc2lnbmF0dXJlOiAke2Vycm9yfWApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY29uc3Qgc3RyaXBlQ2xpZW50ID0gbmV3IFN0cmlwZUNsaWVudCgpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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