{"version":3,"names":["cov_289dhj249a","actualCoverage","Stripe","stripe","s","b","process","env","STRIPE_SECRET_KEY","apiVersion","StripeClient","createPaymentIntent","amount","currency","f","paymentIntent","paymentIntents","create","Math","round","payment_method_types","id","error","Error","confirmPayment","paymentIntentId","paymentMethodId","confirm","payment_method","status","getPaymentStatus","retrieve","refundPayment","refund","refunds","payment_intent","undefined","createCustomer","email","name","customer","customers","getCustomer","customerId","createWebhookEndpoint","url","events","endpoint","webhookEndpoints","enabled_events","verifyWebhookSignature","body","signature","secret","webhooks","constructEvent","stripeClient"],"sources":["stripe-client.ts"],"sourcesContent":["import Stripe from 'stripe';\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY || '', {\n  apiVersion: '2023-10-16',\n});\n\nexport class StripeClient {\n  /**\n   * Create a payment intent\n   */\n  async createPaymentIntent(amount: number, currency: string = 'usd'): Promise<string> {\n    try {\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: Math.round(amount * 100), // Convert to cents\n        currency,\n        payment_method_types: ['card'],\n      });\n      return paymentIntent.id;\n    } catch (error) {\n      throw new Error(`Failed to create payment intent: ${error}`);\n    }\n  }\n\n  /**\n   * Confirm a payment intent\n   */\n  async confirmPayment(paymentIntentId: string, paymentMethodId?: string): Promise<boolean> {\n    try {\n      const paymentIntent = await stripe.paymentIntents.confirm(paymentIntentId, {\n        payment_method: paymentMethodId,\n      });\n      return paymentIntent.status === 'succeeded';\n    } catch (error) {\n      throw new Error(`Failed to confirm payment: ${error}`);\n    }\n  }\n\n  /**\n   * Get payment intent status\n   */\n  async getPaymentStatus(paymentIntentId: string): Promise<string> {\n    try {\n      const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\n      return paymentIntent.status;\n    } catch (error) {\n      throw new Error(`Failed to get payment status: ${error}`);\n    }\n  }\n\n  /**\n   * Refund a payment\n   */\n  async refundPayment(paymentIntentId: string, amount?: number): Promise<string> {\n    try {\n      const refund = await stripe.refunds.create({\n        payment_intent: paymentIntentId,\n        amount: amount ? Math.round(amount * 100) : undefined,\n      });\n      return refund.id;\n    } catch (error) {\n      throw new Error(`Failed to refund payment: ${error}`);\n    }\n  }\n\n  /**\n   * Create a customer\n   */\n  async createCustomer(email: string, name?: string): Promise<string> {\n    try {\n      const customer = await stripe.customers.create({\n        email,\n        name,\n      });\n      return customer.id;\n    } catch (error) {\n      throw new Error(`Failed to create customer: ${error}`);\n    }\n  }\n\n  /**\n   * Get customer\n   */\n  async getCustomer(customerId: string): Promise<Stripe.Customer> {\n    try {\n      return await stripe.customers.retrieve(customerId);\n    } catch (error) {\n      throw new Error(`Failed to get customer: ${error}`);\n    }\n  }\n\n  /**\n   * Create a webhook endpoint\n   */\n  async createWebhookEndpoint(url: string, events: string[]): Promise<string> {\n    try {\n      const endpoint = await stripe.webhookEndpoints.create({\n        url,\n        enabled_events: events,\n      });\n      return endpoint.id;\n    } catch (error) {\n      throw new Error(`Failed to create webhook endpoint: ${error}`);\n    }\n  }\n\n  /**\n   * Verify webhook signature\n   */\n  verifyWebhookSignature(body: string, signature: string, secret: string): Stripe.Event {\n    try {\n      return stripe.webhooks.constructEvent(body, signature, secret);\n    } catch (error) {\n      throw new Error(`Failed to verify webhook signature: ${error}`);\n    }\n  }\n}\n\nexport const stripeClient = new StripeClient();\n"],"mappings":"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","ignoreList":[]}