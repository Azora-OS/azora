{"version":3,"names":["cov_42idjlaib","actualCoverage","Stripe","PrismaClient","stripe","s","b","process","env","STRIPE_SECRET_KEY","apiVersion","typescript","prisma","StripeWebhookHandler","constructor","f","webhookSecret","STRIPE_WEBHOOK_SECRET","citadelPercentage","parseFloat","CITADEL_FUND_PERCENTAGE","console","warn","handleWebhook","req","res","sig","headers","status","send","event","webhooks","constructEvent","body","err","error","message","log","type","id","processEvent","json","received","processed","logFailedWebhook","handlePaymentSuccess","handlePaymentFailed","handleChargeSuccess","handleChargeRefunded","handleSubscriptionCreated","handleSubscriptionUpdated","handleSubscriptionDeleted","handleInvoicePaid","handleCustomerCreated","handleCustomerUpdated","handlePayoutPaid","handlePayoutFailed","paymentIntent","data","object","amount","transaction","create","stripePaymentIntentId","currency","metadata","userId","description","allocateToCitadelFund","enrollUserInCourse","courseId","activateSubscription","planId","failureReason","last_payment_error","sendPaymentFailedEmail","charge","upsert","where","stripeChargeId","update","paid","updatedAt","Date","paymentIntentId","payment_intent","customerId","customer","receiptUrl","receipt_url","amount_refunded","refund","reason","refunds","reverseCitadelFundAllocation","invoice","amount_paid","stripeInvoiceId","subscriptionId","subscription","paidAt","status_transitions","paid_at","hostedInvoiceUrl","hosted_invoice_url","invoicePdf","invoice_pdf","citadelAmount","recordCitadelAllocation","stripeSubscriptionId","priceId","items","price","currentPeriodStart","current_period_start","currentPeriodEnd","current_period_end","cancelAtPeriodEnd","cancel_at_period_end","canceledAt","canceled_at","transactionId","citadelFundAllocation","sourceAmount","percentage","category","allocatedAt","toFixed","chargeId","refundAmount","invoiceId","enrollment","enrolledAt","paidAmount","userSubscription","activatedAt","user","stripeCustomerId","payout","stripePayoutId","arrivalDate","arrival_date","failureCode","failure_code","failureMessage","failure_message","webhookLog","eventId","eventType","errorMessage","payload","attemptCount","retryFailedWebhooks","failedWebhooks","findMany","lt","take","webhook","increment","lastAttemptAt","stripeWebhookHandler"],"sources":["stripe-webhook-handler.ts"],"sourcesContent":["import Stripe from 'stripe';\nimport { PrismaClient } from '@prisma/client';\nimport { Request, Response } from 'express';\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY || '', {\n  apiVersion: '2024-11-20.acacia',\n  typescript: true,\n});\n\nconst prisma = new PrismaClient();\n\ninterface StripeWebhookEvent {\n  id: string;\n  type: string;\n  data: {\n    object: any;\n  };\n}\n\n/**\n * Stripe Webhook Handler - Production Ready\n * Handles all Stripe events with proper verification and database persistence\n */\nexport class StripeWebhookHandler {\n  private readonly webhookSecret: string;\n  private readonly citadelPercentage: number;\n\n  constructor() {\n    this.webhookSecret = process.env.STRIPE_WEBHOOK_SECRET || '';\n    this.citadelPercentage = parseFloat(process.env.CITADEL_FUND_PERCENTAGE || '10');\n\n    if (!this.webhookSecret) {\n      console.warn('‚ö†Ô∏è  STRIPE_WEBHOOK_SECRET not configured - webhook verification disabled');\n    }\n  }\n\n  /**\n   * Main webhook endpoint handler\n   */\n  async handleWebhook(req: Request, res: Response): Promise<void> {\n    const sig = req.headers['stripe-signature'] as string;\n    \n    if (!sig) {\n      res.status(400).send('Missing stripe-signature header');\n      return;\n    }\n\n    let event: StripeWebhookEvent;\n\n    try {\n      // Verify webhook signature\n      event = stripe.webhooks.constructEvent(\n        req.body,\n        sig,\n        this.webhookSecret\n      ) as StripeWebhookEvent;\n    } catch (err: any) {\n      console.error('‚ö†Ô∏è  Webhook signature verification failed:', err.message);\n      res.status(400).send(`Webhook Error: ${err.message}`);\n      return;\n    }\n\n    console.log(`‚úÖ Received webhook: ${event.type} (${event.id})`);\n\n    try {\n      // Route to appropriate handler\n      await this.processEvent(event);\n      res.json({ received: true, processed: true });\n    } catch (error: any) {\n      console.error(`‚ùå Error processing webhook ${event.type}:`, error);\n      \n      // Log to database for retry\n      await this.logFailedWebhook(event, error.message);\n      \n      // Return 500 so Stripe retries\n      res.status(500).json({ \n        received: true, \n        processed: false, \n        error: error.message \n      });\n    }\n  }\n\n  /**\n   * Process webhook event based on type\n   */\n  private async processEvent(event: StripeWebhookEvent): Promise<void> {\n    switch (event.type) {\n      // Payment Intents\n      case 'payment_intent.succeeded':\n        await this.handlePaymentSuccess(event);\n        break;\n      case 'payment_intent.payment_failed':\n        await this.handlePaymentFailed(event);\n        break;\n\n      // Charges\n      case 'charge.succeeded':\n        await this.handleChargeSuccess(event);\n        break;\n      case 'charge.refunded':\n        await this.handleChargeRefunded(event);\n        break;\n\n      // Subscriptions\n      case 'customer.subscription.created':\n        await this.handleSubscriptionCreated(event);\n        break;\n      case 'customer.subscription.updated':\n        await this.handleSubscriptionUpdated(event);\n        break;\n      case 'customer.subscription.deleted':\n        await this.handleSubscriptionDeleted(event);\n        break;\n\n      // Invoices\n      case 'invoice.paid':\n        await this.handleInvoicePaid(event);\n        break;\n      case 'invoice.payment_failed':\n        await this.handlePaymentFailed(event);\n        break;\n\n      // Customers\n      case 'customer.created':\n        await this.handleCustomerCreated(event);\n        break;\n      case 'customer.updated':\n        await this.handleCustomerUpdated(event);\n        break;\n\n      // Payouts\n      case 'payout.paid':\n        await this.handlePayoutPaid(event);\n        break;\n      case 'payout.failed':\n        await this.handlePayoutFailed(event);\n        break;\n\n      default:\n        console.log(`‚ÑπÔ∏è  Unhandled event type: ${event.type}`);\n    }\n  }\n\n  /**\n   * Handle successful payment intent\n   */\n  private async handlePaymentSuccess(event: StripeWebhookEvent): Promise<void> {\n    const paymentIntent = event.data.object as Stripe.PaymentIntent;\n    \n    console.log(`üí≥ Payment succeeded: ${paymentIntent.id} - $${paymentIntent.amount / 100}`);\n\n    // Create transaction record\n    const transaction = await prisma.transaction.create({\n      data: {\n        stripePaymentIntentId: paymentIntent.id,\n        amount: paymentIntent.amount / 100,\n        currency: paymentIntent.currency,\n        status: 'SUCCEEDED' as any,\n        type: 'PAYMENT' as any,\n        metadata: paymentIntent.metadata,\n        userId: paymentIntent.metadata.userId,\n        description: paymentIntent.description || 'Payment',\n      },\n    });\n\n    // Allocate to CitadelFund\n    await this.allocateToCitadelFund(transaction.id, transaction.amount);\n\n    // Update user balance or enrollment\n    if (paymentIntent.metadata.type === 'course_enrollment') {\n      await this.enrollUserInCourse(\n        paymentIntent.metadata.userId,\n        paymentIntent.metadata.courseId\n      );\n    } else if (paymentIntent.metadata.type === 'subscription') {\n      await this.activateSubscription(\n        paymentIntent.metadata.userId,\n        paymentIntent.metadata.planId\n      );\n    }\n\n    console.log(`‚úÖ Transaction recorded: ${transaction.id}`);\n  }\n\n  /**\n   * Handle failed payment\n   */\n  private async handlePaymentFailed(event: StripeWebhookEvent): Promise<void> {\n    const paymentIntent = event.data.object as Stripe.PaymentIntent;\n    \n    console.log(`‚ùå Payment failed: ${paymentIntent.id}`);\n\n    await prisma.transaction.create({\n      data: {\n        stripePaymentIntentId: paymentIntent.id,\n        amount: paymentIntent.amount / 100,\n        currency: paymentIntent.currency,\n        status: 'FAILED' as any,\n        type: 'PAYMENT' as any,\n        metadata: paymentIntent.metadata,\n        userId: paymentIntent.metadata.userId,\n        failureReason: paymentIntent.last_payment_error?.message,\n      },\n    });\n\n    // Notify user of failed payment\n    await this.sendPaymentFailedEmail(\n      paymentIntent.metadata.userId,\n      paymentIntent.last_payment_error?.message\n    );\n  }\n\n  /**\n   * Handle successful charge\n   */\n  private async handleChargeSuccess(event: StripeWebhookEvent): Promise<void> {\n    const charge = event.data.object as Stripe.Charge;\n    \n    console.log(`üí∞ Charge succeeded: ${charge.id} - $${charge.amount / 100}`);\n\n    await prisma.charge.upsert({\n      where: { stripeChargeId: charge.id },\n      update: {\n        status: 'SUCCEEDED' as any,\n        paid: true,\n        updatedAt: new Date(),\n      },\n      create: {\n        stripeChargeId: charge.id,\n        amount: charge.amount / 100,\n        currency: charge.currency,\n        status: 'SUCCEEDED' as any,\n        paid: true,\n        paymentIntentId: charge.payment_intent as string,\n        customerId: charge.customer as string,\n        receiptUrl: charge.receipt_url,\n      },\n    });\n  }\n\n  /**\n   * Handle charge refund\n   */\n  private async handleChargeRefunded(event: StripeWebhookEvent): Promise<void> {\n    const charge = event.data.object as Stripe.Charge;\n    \n    console.log(`üîÑ Charge refunded: ${charge.id} - $${charge.amount_refunded / 100}`);\n\n    await prisma.refund.create({\n      data: {\n        stripeChargeId: charge.id,\n        amount: charge.amount_refunded / 100,\n        currency: charge.currency,\n        reason: charge.refunds?.data[0]?.reason || 'requested_by_customer',\n        status: 'SUCCEEDED' as any,\n      },\n    });\n\n    // Reverse CitadelFund allocation\n    await this.reverseCitadelFundAllocation(charge.id, charge.amount_refunded / 100);\n  }\n\n  /**\n   * Handle invoice paid\n   */\n  private async handleInvoicePaid(event: StripeWebhookEvent): Promise<void> {\n    const invoice = event.data.object as Stripe.Invoice;\n    \n    console.log(`üìÑ Invoice paid: ${invoice.id} - $${invoice.amount_paid / 100}`);\n\n    await prisma.invoice.create({\n      data: {\n        stripeInvoiceId: invoice.id,\n        customerId: invoice.customer as string,\n        subscriptionId: invoice.subscription as string,\n        amount: invoice.amount_paid / 100,\n        currency: invoice.currency,\n        status: 'paid',\n        paidAt: new Date(invoice.status_transitions.paid_at! * 1000),\n        hostedInvoiceUrl: invoice.hosted_invoice_url,\n        invoicePdf: invoice.invoice_pdf,\n      },\n    });\n\n    // Allocate to CitadelFund\n    const citadelAmount = (invoice.amount_paid / 100) * (this.citadelPercentage / 100);\n    await this.recordCitadelAllocation(invoice.id, citadelAmount);\n  }\n\n  /**\n   * Handle subscription created\n   */\n  private async handleSubscriptionCreated(event: StripeWebhookEvent): Promise<void> {\n    const subscription = event.data.object as Stripe.Subscription;\n    \n    console.log(`üì± Subscription created: ${subscription.id}`);\n\n    await prisma.subscription.create({\n      data: {\n        stripeSubscriptionId: subscription.id,\n        userId: subscription.metadata.userId,\n        customerId: subscription.customer as string,\n        status: subscription.status,\n        priceId: subscription.items.data[0].price.id,\n        currentPeriodStart: new Date(subscription.current_period_start * 1000),\n        currentPeriodEnd: new Date(subscription.current_period_end * 1000),\n        cancelAtPeriodEnd: subscription.cancel_at_period_end,\n      },\n    });\n  }\n\n  /**\n   * Handle subscription updated\n   */\n  private async handleSubscriptionUpdated(event: StripeWebhookEvent): Promise<void> {\n    const subscription = event.data.object as Stripe.Subscription;\n    \n    console.log(`üîÑ Subscription updated: ${subscription.id} - ${subscription.status}`);\n\n    await prisma.subscription.update({\n      where: { stripeSubscriptionId: subscription.id },\n      data: {\n        status: subscription.status,\n        currentPeriodStart: new Date(subscription.current_period_start * 1000),\n        currentPeriodEnd: new Date(subscription.current_period_end * 1000),\n        cancelAtPeriodEnd: subscription.cancel_at_period_end,\n        canceledAt: subscription.canceled_at ? new Date(subscription.canceled_at * 1000) : null,\n        updatedAt: new Date(),\n      },\n    });\n  }\n\n  /**\n   * Handle subscription deleted/canceled\n   */\n  private async handleSubscriptionDeleted(event: StripeWebhookEvent): Promise<void> {\n    const subscription = event.data.object as Stripe.Subscription;\n    \n    console.log(`üö´ Subscription deleted: ${subscription.id}`);\n\n    await prisma.subscription.update({\n      where: { stripeSubscriptionId: subscription.id },\n      data: {\n        status: 'CANCELLED' as any,\n        canceledAt: new Date(),\n        updatedAt: new Date(),\n      },\n    });\n  }\n\n  /**\n   * Allocate payment to CitadelFund\n   */\n  private async allocateToCitadelFund(transactionId: string, amount: number): Promise<void> {\n    const citadelAmount = amount * (this.citadelPercentage / 100);\n\n    await prisma.citadelFundAllocation.create({\n      data: {\n        transactionId,\n        amount: citadelAmount,\n        sourceAmount: amount,\n        percentage: this.citadelPercentage,\n        category: 'general',\n        status: 'allocated',\n        allocatedAt: new Date(),\n      },\n    });\n\n    console.log(`üèõÔ∏è  Allocated $${citadelAmount.toFixed(2)} to CitadelFund (${this.citadelPercentage}%)`);\n  }\n\n  /**\n   * Reverse CitadelFund allocation on refund\n   */\n  private async reverseCitadelFundAllocation(chargeId: string, refundAmount: number): Promise<void> {\n    const citadelAmount = refundAmount * (this.citadelPercentage / 100);\n\n    await prisma.citadelFundAllocation.create({\n      data: {\n        chargeId,\n        amount: -citadelAmount,\n        sourceAmount: refundAmount,\n        percentage: this.citadelPercentage,\n        category: 'refund',\n        status: 'reversed',\n        allocatedAt: new Date(),\n      },\n    });\n\n    console.log(`‚Ü©Ô∏è  Reversed $${citadelAmount.toFixed(2)} from CitadelFund`);\n  }\n\n  /**\n   * Record CitadelFund allocation for invoice\n   */\n  private async recordCitadelAllocation(invoiceId: string, amount: number): Promise<void> {\n    await prisma.citadelFundAllocation.create({\n      data: {\n        invoiceId,\n        amount,\n        category: 'subscription',\n        status: 'allocated',\n        allocatedAt: new Date(),\n      },\n    });\n  }\n\n  /**\n   * Enroll user in course after payment\n   */\n  private async enrollUserInCourse(userId: string, courseId: string): Promise<void> {\n    await prisma.enrollment.create({\n      data: {\n        userId,\n        courseId,\n        status: 'ACTIVE' as any,\n        enrolledAt: new Date(),\n        paidAmount: 0, // Will be updated from transaction\n      },\n    });\n\n    console.log(`üéì User ${userId} enrolled in course ${courseId}`);\n  }\n\n  /**\n   * Activate subscription for user\n   */\n  private async activateSubscription(userId: string, planId: string): Promise<void> {\n    await prisma.userSubscription.update({\n      where: { userId },\n      data: {\n        planId,\n        status: 'ACTIVE' as any,\n        activatedAt: new Date(),\n      },\n    });\n\n    console.log(`‚úÖ Subscription activated for user ${userId}`);\n  }\n\n  /**\n   * Send payment failed notification\n   */\n  private async sendPaymentFailedEmail(userId: string, reason?: string): Promise<void> {\n    // TODO: Implement email service integration\n    console.log(`üìß Sending payment failed email to user ${userId}: ${reason}`);\n  }\n\n  /**\n   * Handle customer created\n   */\n  private async handleCustomerCreated(event: StripeWebhookEvent): Promise<void> {\n    const customer = event.data.object as Stripe.Customer;\n    \n    console.log(`üë§ Customer created: ${customer.id}`);\n\n    if (customer.metadata.userId) {\n      await prisma.user.update({\n        where: { id: customer.metadata.userId },\n        data: { stripeCustomerId: customer.id },\n      });\n    }\n  }\n\n  /**\n   * Handle customer updated\n   */\n  private async handleCustomerUpdated(event: StripeWebhookEvent): Promise<void> {\n    const customer = event.data.object as Stripe.Customer;\n    console.log(`üë§ Customer updated: ${customer.id}`);\n    // Additional logic as needed\n  }\n\n  /**\n   * Handle successful payout\n   */\n  private async handlePayoutPaid(event: StripeWebhookEvent): Promise<void> {\n    const payout = event.data.object as Stripe.Payout;\n    console.log(`üí∏ Payout succeeded: ${payout.id} - $${payout.amount / 100}`);\n    \n    await prisma.payout.create({\n      data: {\n        stripePayoutId: payout.id,\n        amount: payout.amount / 100,\n        currency: payout.currency,\n        status: 'paid',\n        arrivalDate: new Date(payout.arrival_date * 1000),\n      },\n    });\n  }\n\n  /**\n   * Handle failed payout\n   */\n  private async handlePayoutFailed(event: StripeWebhookEvent): Promise<void> {\n    const payout = event.data.object as Stripe.Payout;\n    console.log(`‚ùå Payout failed: ${payout.id}`);\n    \n    await prisma.payout.create({\n      data: {\n        stripePayoutId: payout.id,\n        amount: payout.amount / 100,\n        currency: payout.currency,\n        status: 'FAILED' as any,\n        failureCode: payout.failure_code,\n        failureMessage: payout.failure_message,\n      },\n    });\n  }\n\n  /**\n   * Log failed webhook for retry\n   */\n  private async logFailedWebhook(event: StripeWebhookEvent, error: string): Promise<void> {\n    await prisma.webhookLog.create({\n      data: {\n        eventId: event.id,\n        eventType: event.type,\n        status: 'FAILED' as any,\n        errorMessage: error,\n        payload: event as any,\n        attemptCount: 1,\n      },\n    });\n  }\n\n  /**\n   * Retry failed webhooks (run periodically via cron)\n   */\n  async retryFailedWebhooks(): Promise<void> {\n    const failedWebhooks = await prisma.webhookLog.findMany({\n      where: {\n        status: 'FAILED' as any,\n        attemptCount: { lt: 5 },\n      },\n      take: 100,\n    });\n\n    for (const webhook of failedWebhooks) {\n      try {\n        await this.processEvent(webhook.payload as StripeWebhookEvent);\n        \n        await prisma.webhookLog.update({\n          where: { id: webhook.id },\n          data: {\n            status: 'SUCCEEDED' as any,\n            attemptCount: { increment: 1 },\n            lastAttemptAt: new Date(),\n          },\n        });\n        \n        console.log(`‚úÖ Retried webhook ${webhook.eventId} successfully`);\n      } catch (error: any) {\n        await prisma.webhookLog.update({\n          where: { id: webhook.id },\n          data: {\n            attemptCount: { increment: 1 },\n            lastAttemptAt: new Date(),\n            errorMessage: error.message,\n          },\n        });\n        \n        console.error(`‚ùå Webhook retry failed: ${webhook.eventId}`);\n      }\n    }\n  }\n}\n\nexport const stripeWebhookHandler = new StripeWebhookHandler();\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}