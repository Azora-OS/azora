{"version":3,"names":["cov_2keta19bh0","actualCoverage","fs","s","require","promises","path","AUDIT_LOG_PATH","b","process","env","logAudit","event","f","entry","timestamp","Date","toISOString","appendFile","JSON","stringify","err","console","error","auditMiddleware","req","res","next","originalSend","send","data","type","method","userId","user","ip","statusCode","userAgent","get","call","logAuthAttempt","email","success","logDataAccess","resource","action","logDataModification","changes","module","exports"],"sources":["audit.js"],"sourcesContent":["const fs = require('fs').promises;\nconst path = require('path');\n\nconst AUDIT_LOG_PATH = process.env.AUDIT_LOG_PATH || './logs/audit.log';\n\nasync function logAudit(event) {\n  const entry = {\n    timestamp: new Date().toISOString(),\n    ...event\n  };\n  \n  try {\n    await fs.appendFile(AUDIT_LOG_PATH, JSON.stringify(entry) + '\\n');\n  } catch (err) {\n    console.error('Audit log failed:', err);\n  }\n}\n\nfunction auditMiddleware(req, res, next) {\n  const originalSend = res.send;\n  \n  res.send = function(data) {\n    logAudit({\n      type: 'api_request',\n      method: req.method,\n      path: req.path,\n      userId: req.user?.userId,\n      ip: req.ip,\n      statusCode: res.statusCode,\n      userAgent: req.get('user-agent')\n    });\n    \n    originalSend.call(this, data);\n  };\n  \n  next();\n}\n\nasync function logAuthAttempt(email, success, ip) {\n  await logAudit({\n    type: 'auth_attempt',\n    email,\n    success,\n    ip\n  });\n}\n\nasync function logDataAccess(userId, resource, action) {\n  await logAudit({\n    type: 'data_access',\n    userId,\n    resource,\n    action\n  });\n}\n\nasync function logDataModification(userId, resource, action, changes) {\n  await logAudit({\n    type: 'data_modification',\n    userId,\n    resource,\n    action,\n    changes\n  });\n}\n\nmodule.exports = {\n  auditMiddleware,\n  logAuthAttempt,\n  logDataAccess,\n  logDataModification\n};\n"],"mappings":"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","ignoreList":[]}