{"version":3,"names":["cov_gzmafbl4j","actualCoverage","axios","MarketDataSource","alphaVantageUrl","s","cryptoUrl","constructor","alphaVantageKey","cryptoApiKey","f","b","fetchStockData","symbol","response","get","params","function","apikey","quote","data","Error","price","parseFloat","change","changePercent","volume","parseInt","timestamp","Date","toISOString","error","console","fetchCryptoData","cryptoId","ids","vs_currencies","include_market_cap","include_24hr_vol","include_24hr_change","toUpperCase","usd","marketCap","usd_market_cap","volume24h","usd_24h_vol","change24h","usd_24h_change","convertStockToKnowledgeSource","stock","trend","type","source","url","title","content","metadata","date","category","verified","relevance","tags","toLowerCase","convertCryptoToKnowledgeSource","crypto","fetchAndConvertStock","fetchAndConvertCrypto"],"sources":["market.ts"],"sourcesContent":["import axios from 'axios';\nimport { KnowledgeSource } from '../knowledge-ocean';\n\nexport interface StockData {\n  symbol: string;\n  price: number;\n  change: number;\n  changePercent: number;\n  timestamp: string;\n  volume: number;\n}\n\nexport interface CryptoData {\n  symbol: string;\n  price: number;\n  marketCap: number;\n  volume24h: number;\n  change24h: number;\n  timestamp: string;\n}\n\nexport class MarketDataSource {\n  private alphaVantageKey: string;\n  private cryptoApiKey: string;\n  private alphaVantageUrl = 'https://www.alphavantage.co/query';\n  private cryptoUrl = 'https://api.coingecko.com/api/v3';\n\n  constructor(alphaVantageKey: string, cryptoApiKey?: string) {\n    this.alphaVantageKey = alphaVantageKey;\n    this.cryptoApiKey = cryptoApiKey || '';\n  }\n\n  /**\n   * Fetch stock data\n   */\n  async fetchStockData(symbol: string): Promise<StockData> {\n    try {\n      const response = await axios.get(this.alphaVantageUrl, {\n        params: {\n          function: 'GLOBAL_QUOTE',\n          symbol,\n          apikey: this.alphaVantageKey,\n        },\n      });\n\n      const quote = response.data['Global Quote'];\n      if (!quote || !quote.symbol) {\n        throw new Error(`No data found for symbol: ${symbol}`);\n      }\n\n      return {\n        symbol: quote.symbol,\n        price: parseFloat(quote['05. price']),\n        change: parseFloat(quote['09. change']),\n        changePercent: parseFloat(quote['10. change percent']),\n        volume: parseInt(quote['06. volume']),\n        timestamp: new Date().toISOString(),\n      };\n    } catch (error) {\n      console.error('Error fetching stock data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Fetch cryptocurrency data\n   */\n  async fetchCryptoData(cryptoId: string): Promise<CryptoData> {\n    try {\n      const response = await axios.get(`${this.cryptoUrl}/simple/price`, {\n        params: {\n          ids: cryptoId,\n          vs_currencies: 'usd',\n          include_market_cap: true,\n          include_24hr_vol: true,\n          include_24hr_change: true,\n        },\n      });\n\n      const data = response.data[cryptoId];\n      if (!data) {\n        throw new Error(`No data found for crypto: ${cryptoId}`);\n      }\n\n      return {\n        symbol: cryptoId.toUpperCase(),\n        price: data.usd,\n        marketCap: data.usd_market_cap || 0,\n        volume24h: data.usd_24h_vol || 0,\n        change24h: data.usd_24h_change || 0,\n        timestamp: new Date().toISOString(),\n      };\n    } catch (error) {\n      console.error('Error fetching crypto data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Convert stock data to KnowledgeSource\n   */\n  convertStockToKnowledgeSource(stock: StockData): Omit<\n    KnowledgeSource,\n    'id' | 'embedding' | 'createdAt' | 'updatedAt'\n  > {\n    const trend = stock.change >= 0 ? 'up' : 'down';\n    return {\n      type: 'market',\n      source: 'Alpha Vantage',\n      url: `https://www.alphavantage.co/query?symbol=${stock.symbol}`,\n      title: `${stock.symbol} Stock Update`,\n      content: `Stock Symbol: ${stock.symbol}\\nCurrent Price: $${stock.price}\\nChange: ${stock.change} (${stock.changePercent}%)\\nVolume: ${stock.volume}\\nTimestamp: ${stock.timestamp}`,\n      metadata: {\n        date: stock.timestamp,\n        category: 'market-data',\n        verified: true,\n        relevance: 0.9,\n        tags: ['stock', 'market', stock.symbol.toLowerCase(), trend],\n      },\n    };\n  }\n\n  /**\n   * Convert crypto data to KnowledgeSource\n   */\n  convertCryptoToKnowledgeSource(crypto: CryptoData): Omit<\n    KnowledgeSource,\n    'id' | 'embedding' | 'createdAt' | 'updatedAt'\n  > {\n    const trend = crypto.change24h >= 0 ? 'up' : 'down';\n    return {\n      type: 'market',\n      source: 'CoinGecko',\n      url: `https://www.coingecko.com/en/coins/${crypto.symbol.toLowerCase()}`,\n      title: `${crypto.symbol} Cryptocurrency Update`,\n      content: `Cryptocurrency: ${crypto.symbol}\\nPrice: $${crypto.price}\\n24h Change: ${crypto.change24h}%\\nMarket Cap: $${crypto.marketCap}\\n24h Volume: $${crypto.volume24h}\\nTimestamp: ${crypto.timestamp}`,\n      metadata: {\n        date: crypto.timestamp,\n        category: 'market-data',\n        verified: true,\n        relevance: 0.85,\n        tags: ['crypto', 'market', crypto.symbol.toLowerCase(), trend],\n      },\n    };\n  }\n\n  /**\n   * Fetch and convert stock data\n   */\n  async fetchAndConvertStock(symbol: string): Promise<Omit<\n    KnowledgeSource,\n    'id' | 'embedding' | 'createdAt' | 'updatedAt'\n  >> {\n    const stock = await this.fetchStockData(symbol);\n    return this.convertStockToKnowledgeSource(stock);\n  }\n\n  /**\n   * Fetch and convert crypto data\n   */\n  async fetchAndConvertCrypto(cryptoId: string): Promise<Omit<\n    KnowledgeSource,\n    'id' | 'embedding' | 'createdAt' | 'updatedAt'\n  >> {\n    const crypto = await this.fetchCryptoData(cryptoId);\n    return this.convertCryptoToKnowledgeSource(crypto);\n  }\n}\n\nexport default MarketDataSource;\n"],"mappings":"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","ignoreList":[]}