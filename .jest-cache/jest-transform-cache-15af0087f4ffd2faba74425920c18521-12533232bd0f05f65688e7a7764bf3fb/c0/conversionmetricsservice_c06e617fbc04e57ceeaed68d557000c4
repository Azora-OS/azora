26982f80edd5adb6d373c2c9dba4c8e1
/* istanbul ignore next */
function cov_pmtrkqcvi() {
  var path = "/workspaces/azora/services/education-revenue-engine/src/services/conversion-metrics.service.ts";
  var hash = "e6cb0f5bdd02b470b67415f19b378107e4f1a686";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/education-revenue-engine/src/services/conversion-metrics.service.ts",
    statementMap: {
      "0": {
        start: {
          line: 4,
          column: 15
        },
        end: {
          line: 4,
          column: 33
        }
      },
      "1": {
        start: {
          line: 24,
          column: 4
        },
        end: {
          line: 80,
          column: 5
        }
      },
      "2": {
        start: {
          line: 25,
          column: 35
        },
        end: {
          line: 25,
          column: 59
        }
      },
      "3": {
        start: {
          line: 28,
          column: 26
        },
        end: {
          line: 39,
          column: 8
        }
      },
      "4": {
        start: {
          line: 41,
          column: 25
        },
        end: {
          line: 45,
          column: 7
        }
      },
      "5": {
        start: {
          line: 47,
          column: 6
        },
        end: {
          line: 49,
          column: 9
        }
      },
      "6": {
        start: {
          line: 48,
          column: 8
        },
        end: {
          line: 48,
          column: 76
        }
      },
      "7": {
        start: {
          line: 52,
          column: 29
        },
        end: {
          line: 52,
          column: 69
        }
      },
      "8": {
        start: {
          line: 55,
          column: 24
        },
        end: {
          line: 55,
          column: 73
        }
      },
      "9": {
        start: {
          line: 58,
          column: 28
        },
        end: {
          line: 58,
          column: 63
        }
      },
      "10": {
        start: {
          line: 61,
          column: 38
        },
        end: {
          line: 61,
          column: 81
        }
      },
      "11": {
        start: {
          line: 64,
          column: 28
        },
        end: {
          line: 64,
          column: 95
        }
      },
      "12": {
        start: {
          line: 66,
          column: 6
        },
        end: {
          line: 76,
          column: 8
        }
      },
      "13": {
        start: {
          line: 78,
          column: 6
        },
        end: {
          line: 78,
          column: 78
        }
      },
      "14": {
        start: {
          line: 79,
          column: 6
        },
        end: {
          line: 79,
          column: 18
        }
      },
      "15": {
        start: {
          line: 88,
          column: 32
        },
        end: {
          line: 88,
          column: 68
        }
      },
      "16": {
        start: {
          line: 89,
          column: 4
        },
        end: {
          line: 89,
          column: 46
        }
      },
      "17": {
        start: {
          line: 89,
          column: 36
        },
        end: {
          line: 89,
          column: 45
        }
      },
      "18": {
        start: {
          line: 90,
          column: 4
        },
        end: {
          line: 90,
          column: 60
        }
      },
      "19": {
        start: {
          line: 98,
          column: 4
        },
        end: {
          line: 126,
          column: 5
        }
      },
      "20": {
        start: {
          line: 100,
          column: 29
        },
        end: {
          line: 107,
          column: 8
        }
      },
      "21": {
        start: {
          line: 109,
          column: 6
        },
        end: {
          line: 109,
          column: 43
        }
      },
      "22": {
        start: {
          line: 109,
          column: 33
        },
        end: {
          line: 109,
          column: 42
        }
      },
      "23": {
        start: {
          line: 112,
          column: 25
        },
        end: {
          line: 120,
          column: 8
        }
      },
      "24": {
        start: {
          line: 122,
          column: 6
        },
        end: {
          line: 122,
          column: 49
        }
      },
      "25": {
        start: {
          line: 124,
          column: 6
        },
        end: {
          line: 124,
          column: 62
        }
      },
      "26": {
        start: {
          line: 125,
          column: 6
        },
        end: {
          line: 125,
          column: 15
        }
      },
      "27": {
        start: {
          line: 134,
          column: 4
        },
        end: {
          line: 159,
          column: 5
        }
      },
      "28": {
        start: {
          line: 135,
          column: 21
        },
        end: {
          line: 145,
          column: 8
        }
      },
      "29": {
        start: {
          line: 147,
          column: 6
        },
        end: {
          line: 147,
          column: 66
        }
      },
      "30": {
        start: {
          line: 147,
          column: 56
        },
        end: {
          line: 147,
          column: 65
        }
      },
      "31": {
        start: {
          line: 150,
          column: 27
        },
        end: {
          line: 150,
          column: 50
        }
      },
      "32": {
        start: {
          line: 151,
          column: 25
        },
        end: {
          line: 151,
          column: 50
        }
      },
      "33": {
        start: {
          line: 153,
          column: 6
        },
        end: {
          line: 153,
          column: 39
        }
      },
      "34": {
        start: {
          line: 153,
          column: 29
        },
        end: {
          line: 153,
          column: 38
        }
      },
      "35": {
        start: {
          line: 155,
          column: 6
        },
        end: {
          line: 155,
          column: 47
        }
      },
      "36": {
        start: {
          line: 157,
          column: 6
        },
        end: {
          line: 157,
          column: 66
        }
      },
      "37": {
        start: {
          line: 158,
          column: 6
        },
        end: {
          line: 158,
          column: 15
        }
      },
      "38": {
        start: {
          line: 167,
          column: 4
        },
        end: {
          line: 189,
          column: 5
        }
      },
      "39": {
        start: {
          line: 170,
          column: 23
        },
        end: {
          line: 177,
          column: 8
        }
      },
      "40": {
        start: {
          line: 179,
          column: 6
        },
        end: {
          line: 179,
          column: 37
        }
      },
      "41": {
        start: {
          line: 179,
          column: 27
        },
        end: {
          line: 179,
          column: 36
        }
      },
      "42": {
        start: {
          line: 183,
          column: 38
        },
        end: {
          line: 183,
          column: 51
        }
      },
      "43": {
        start: {
          line: 185,
          column: 6
        },
        end: {
          line: 185,
          column: 48
        }
      },
      "44": {
        start: {
          line: 187,
          column: 6
        },
        end: {
          line: 187,
          column: 55
        }
      },
      "45": {
        start: {
          line: 188,
          column: 6
        },
        end: {
          line: 188,
          column: 15
        }
      },
      "46": {
        start: {
          line: 197,
          column: 4
        },
        end: {
          line: 197,
          column: 30
        }
      },
      "47": {
        start: {
          line: 197,
          column: 20
        },
        end: {
          line: 197,
          column: 29
        }
      },
      "48": {
        start: {
          line: 198,
          column: 4
        },
        end: {
          line: 198,
          column: 28
        }
      },
      "49": {
        start: {
          line: 205,
          column: 16
        },
        end: {
          line: 205,
          column: 26
        }
      },
      "50": {
        start: {
          line: 207,
          column: 4
        },
        end: {
          line: 227,
          column: 5
        }
      },
      "51": {
        start: {
          line: 209,
          column: 30
        },
        end: {
          line: 209,
          column: 48
        }
      },
      "52": {
        start: {
          line: 210,
          column: 16
        },
        end: {
          line: 210,
          column: 33
        }
      },
      "53": {
        start: {
          line: 211,
          column: 25
        },
        end: {
          line: 211,
          column: 36
        }
      },
      "54": {
        start: {
          line: 212,
          column: 24
        },
        end: {
          line: 212,
          column: 63
        }
      },
      "55": {
        start: {
          line: 213,
          column: 22
        },
        end: {
          line: 213,
          column: 77
        }
      },
      "56": {
        start: {
          line: 214,
          column: 6
        },
        end: {
          line: 214,
          column: 34
        }
      },
      "57": {
        start: {
          line: 215,
          column: 11
        },
        end: {
          line: 227,
          column: 5
        }
      },
      "58": {
        start: {
          line: 217,
          column: 28
        },
        end: {
          line: 217,
          column: 45
        }
      },
      "59": {
        start: {
          line: 218,
          column: 24
        },
        end: {
          line: 218,
          column: 72
        }
      },
      "60": {
        start: {
          line: 219,
          column: 22
        },
        end: {
          line: 219,
          column: 78
        }
      },
      "61": {
        start: {
          line: 220,
          column: 6
        },
        end: {
          line: 220,
          column: 34
        }
      },
      "62": {
        start: {
          line: 223,
          column: 19
        },
        end: {
          line: 223,
          column: 35
        }
      },
      "63": {
        start: {
          line: 224,
          column: 24
        },
        end: {
          line: 224,
          column: 44
        }
      },
      "64": {
        start: {
          line: 225,
          column: 22
        },
        end: {
          line: 225,
          column: 56
        }
      },
      "65": {
        start: {
          line: 226,
          column: 6
        },
        end: {
          line: 226,
          column: 34
        }
      },
      "66": {
        start: {
          line: 231,
          column: 40
        },
        end: {
          line: 231,
          column: 70
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 23,
            column: 2
          },
          end: {
            line: 23,
            column: 3
          }
        },
        loc: {
          start: {
            line: 23,
            column: 81
          },
          end: {
            line: 81,
            column: 3
          }
        },
        line: 23
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 47,
            column: 26
          },
          end: {
            line: 47,
            column: 27
          }
        },
        loc: {
          start: {
            line: 47,
            column: 42
          },
          end: {
            line: 49,
            column: 7
          }
        },
        line: 47
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 87,
            column: 2
          },
          end: {
            line: 87,
            column: 3
          }
        },
        loc: {
          start: {
            line: 87,
            column: 78
          },
          end: {
            line: 91,
            column: 3
          }
        },
        line: 87
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 97,
            column: 2
          },
          end: {
            line: 97,
            column: 3
          }
        },
        loc: {
          start: {
            line: 97,
            column: 84
          },
          end: {
            line: 127,
            column: 3
          }
        },
        line: 97
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 133,
            column: 2
          },
          end: {
            line: 133,
            column: 3
          }
        },
        loc: {
          start: {
            line: 133,
            column: 58
          },
          end: {
            line: 160,
            column: 3
          }
        },
        line: 133
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 166,
            column: 2
          },
          end: {
            line: 166,
            column: 3
          }
        },
        loc: {
          start: {
            line: 166,
            column: 78
          },
          end: {
            line: 190,
            column: 3
          }
        },
        line: 166
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 196,
            column: 2
          },
          end: {
            line: 196,
            column: 3
          }
        },
        loc: {
          start: {
            line: 196,
            column: 67
          },
          end: {
            line: 199,
            column: 3
          }
        },
        line: 196
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 204,
            column: 2
          },
          end: {
            line: 204,
            column: 3
          }
        },
        loc: {
          start: {
            line: 204,
            column: 52
          },
          end: {
            line: 228,
            column: 3
          }
        },
        line: 204
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 89,
            column: 4
          },
          end: {
            line: 89,
            column: 46
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 89,
            column: 4
          },
          end: {
            line: 89,
            column: 46
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 89
      },
      "1": {
        loc: {
          start: {
            line: 109,
            column: 6
          },
          end: {
            line: 109,
            column: 43
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 109,
            column: 6
          },
          end: {
            line: 109,
            column: 43
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 109
      },
      "2": {
        loc: {
          start: {
            line: 147,
            column: 6
          },
          end: {
            line: 147,
            column: 66
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 147,
            column: 6
          },
          end: {
            line: 147,
            column: 66
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 147
      },
      "3": {
        loc: {
          start: {
            line: 147,
            column: 10
          },
          end: {
            line: 147,
            column: 53
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 147,
            column: 10
          },
          end: {
            line: 147,
            column: 27
          }
        }, {
          start: {
            line: 147,
            column: 31
          },
          end: {
            line: 147,
            column: 53
          }
        }],
        line: 147
      },
      "4": {
        loc: {
          start: {
            line: 150,
            column: 27
          },
          end: {
            line: 150,
            column: 50
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 150,
            column: 27
          },
          end: {
            line: 150,
            column: 45
          }
        }, {
          start: {
            line: 150,
            column: 49
          },
          end: {
            line: 150,
            column: 50
          }
        }],
        line: 150
      },
      "5": {
        loc: {
          start: {
            line: 153,
            column: 6
          },
          end: {
            line: 153,
            column: 39
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 153,
            column: 6
          },
          end: {
            line: 153,
            column: 39
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 153
      },
      "6": {
        loc: {
          start: {
            line: 179,
            column: 6
          },
          end: {
            line: 179,
            column: 37
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 179,
            column: 6
          },
          end: {
            line: 179,
            column: 37
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 179
      },
      "7": {
        loc: {
          start: {
            line: 197,
            column: 4
          },
          end: {
            line: 197,
            column: 30
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 197,
            column: 4
          },
          end: {
            line: 197,
            column: 30
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 197
      },
      "8": {
        loc: {
          start: {
            line: 207,
            column: 4
          },
          end: {
            line: 227,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 207,
            column: 4
          },
          end: {
            line: 227,
            column: 5
          }
        }, {
          start: {
            line: 215,
            column: 11
          },
          end: {
            line: 227,
            column: 5
          }
        }],
        line: 207
      },
      "9": {
        loc: {
          start: {
            line: 215,
            column: 11
          },
          end: {
            line: 227,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 215,
            column: 11
          },
          end: {
            line: 227,
            column: 5
          }
        }, {
          start: {
            line: 221,
            column: 11
          },
          end: {
            line: 227,
            column: 5
          }
        }],
        line: 215
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "e6cb0f5bdd02b470b67415f19b378107e4f1a686"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_pmtrkqcvi = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_pmtrkqcvi();
import { PrismaClient } from '@prisma/client';
import { logger } from '../utils/logger';
const prisma =
/* istanbul ignore next */
(cov_pmtrkqcvi().s[0]++, new PrismaClient());
export class ConversionMetricsService {
  /**
   * Calculate conversion metrics for a given period
   * Requirements: 5.1, 5.2
   */
  async getConversionMetrics(period) {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[0]++;
    cov_pmtrkqcvi().s[1]++;
    try {
      const [startDate, endDate] =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[2]++, this.parsePeriod(period));

      // Get user counts by tier
      const usersByTier =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[3]++, await prisma.user.groupBy({
        by: ['tier'],
        _count: {
          id: true
        },
        where: {
          createdAt: {
            gte: startDate,
            lte: endDate
          }
        }
      }));
      const tierCounts =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[4]++, {
        free: 0,
        premium: 0,
        pro: 0
      });
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[5]++;
      usersByTier.forEach(group => {
        /* istanbul ignore next */
        cov_pmtrkqcvi().f[1]++;
        cov_pmtrkqcvi().s[6]++;
        tierCounts[group.tier] = group._count.id;
      });

      // Calculate conversion rate (free to premium)
      const conversionRate =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[7]++, this.calculateConversionRate(tierCounts));

      // Calculate churn rate
      const churnRate =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[8]++, await this.calculateChurnRate(startDate, endDate));

      // Calculate lifetime value
      const lifetimeValue =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[9]++, await this.calculateLifetimeValue());

      // Calculate customer acquisition cost
      const customerAcquisitionCost =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[10]++, await this.calculateCAC(startDate, endDate));

      // Calculate payback period
      const paybackPeriod =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[11]++, this.calculatePaybackPeriod(customerAcquisitionCost, lifetimeValue));
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[12]++;
      return {
        period,
        freeUsers: tierCounts.free,
        premiumUsers: tierCounts.premium,
        proUsers: tierCounts.pro,
        conversionRate,
        churnRate,
        lifetimeValue,
        customerAcquisitionCost,
        paybackPeriod
      };
    } catch (error) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[13]++;
      logger.error('Error calculating conversion metrics', {
        error,
        period
      });
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[14]++;
      throw error;
    }
  }

  /**
   * Calculate free to premium conversion rate
   * Requirements: 5.1, 5.2
   */
  calculateConversionRate(tierCounts) {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[2]++;
    const totalFreeAndPremium =
    /* istanbul ignore next */
    (cov_pmtrkqcvi().s[15]++, tierCounts.free + tierCounts.premium);
    /* istanbul ignore next */
    cov_pmtrkqcvi().s[16]++;
    if (totalFreeAndPremium === 0) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().b[0][0]++;
      cov_pmtrkqcvi().s[17]++;
      return 0;
    } else
    /* istanbul ignore next */
    {
      cov_pmtrkqcvi().b[0][1]++;
    }
    cov_pmtrkqcvi().s[18]++;
    return tierCounts.premium / totalFreeAndPremium * 100;
  }

  /**
   * Calculate churn rate (users who downgraded or became inactive)
   * Requirements: 5.1, 5.2
   */
  async calculateChurnRate(startDate, endDate) {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[3]++;
    cov_pmtrkqcvi().s[19]++;
    try {
      // Get users who were premium at start of period
      const premiumAtStart =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[20]++, await prisma.user.count({
        where: {
          tier: 'premium',
          createdAt: {
            lt: startDate
          }
        }
      }));
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[21]++;
      if (premiumAtStart === 0) {
        /* istanbul ignore next */
        cov_pmtrkqcvi().b[1][0]++;
        cov_pmtrkqcvi().s[22]++;
        return 0;
      } else
      /* istanbul ignore next */
      {
        cov_pmtrkqcvi().b[1][1]++;
      }

      // Get users who downgraded to free during period
      const downgraded =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[23]++, await prisma.user.count({
        where: {
          tier: 'free',
          updatedAt: {
            gte: startDate,
            lte: endDate
          }
        }
      }));
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[24]++;
      return downgraded / premiumAtStart * 100;
    } catch (error) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[25]++;
      logger.error('Error calculating churn rate', {
        error
      });
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[26]++;
      return 0;
    }
  }

  /**
   * Calculate average lifetime value per student
   * Requirements: 5.1, 5.2
   */
  async calculateLifetimeValue() {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[4]++;
    cov_pmtrkqcvi().s[27]++;
    try {
      const result =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[28]++, await prisma.payment.aggregate({
        _avg: {
          amount: true
        },
        _sum: {
          amount: true
        },
        _count: {
          id: true
        }
      }));
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[29]++;
      if (
      /* istanbul ignore next */
      (cov_pmtrkqcvi().b[3][0]++, !result._count.id) ||
      /* istanbul ignore next */
      (cov_pmtrkqcvi().b[3][1]++, result._count.id === 0)) {
        /* istanbul ignore next */
        cov_pmtrkqcvi().b[2][0]++;
        cov_pmtrkqcvi().s[30]++;
        return 0;
      } else
      /* istanbul ignore next */
      {
        cov_pmtrkqcvi().b[2][1]++;
      }

      // Calculate average revenue per user
      const totalRevenue =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[31]++,
      /* istanbul ignore next */
      (cov_pmtrkqcvi().b[4][0]++, result._sum.amount) ||
      /* istanbul ignore next */
      (cov_pmtrkqcvi().b[4][1]++, 0));
      const totalUsers =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[32]++, await prisma.user.count());
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[33]++;
      if (totalUsers === 0) {
        /* istanbul ignore next */
        cov_pmtrkqcvi().b[5][0]++;
        cov_pmtrkqcvi().s[34]++;
        return 0;
      } else
      /* istanbul ignore next */
      {
        cov_pmtrkqcvi().b[5][1]++;
      }
      cov_pmtrkqcvi().s[35]++;
      return Number(totalRevenue) / totalUsers;
    } catch (error) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[36]++;
      logger.error('Error calculating lifetime value', {
        error
      });
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[37]++;
      return 0;
    }
  }

  /**
   * Calculate customer acquisition cost
   * Requirements: 5.1, 5.2
   */
  async calculateCAC(startDate, endDate) {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[5]++;
    cov_pmtrkqcvi().s[38]++;
    try {
      // Estimate marketing spend (this would come from actual marketing data)
      // For now, we'll use a simplified calculation based on conversion events
      const newUsers =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[39]++, await prisma.user.count({
        where: {
          createdAt: {
            gte: startDate,
            lte: endDate
          }
        }
      }));
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[40]++;
      if (newUsers === 0) {
        /* istanbul ignore next */
        cov_pmtrkqcvi().b[6][0]++;
        cov_pmtrkqcvi().s[41]++;
        return 0;
      } else
      /* istanbul ignore next */
      {
        cov_pmtrkqcvi().b[6][1]++;
      }

      // Assume average marketing spend per user acquisition
      // This should be replaced with actual marketing spend data
      const estimatedMarketingSpend =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[42]++, newUsers * 10); // $10 per user estimate
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[43]++;
      return estimatedMarketingSpend / newUsers;
    } catch (error) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[44]++;
      logger.error('Error calculating CAC', {
        error
      });
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[45]++;
      return 0;
    }
  }

  /**
   * Calculate payback period in months
   * Requirements: 5.1, 5.2
   */
  calculatePaybackPeriod(cac, ltv) {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[6]++;
    cov_pmtrkqcvi().s[46]++;
    if (ltv === 0) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().b[7][0]++;
      cov_pmtrkqcvi().s[47]++;
      return 0;
    } else
    /* istanbul ignore next */
    {
      cov_pmtrkqcvi().b[7][1]++;
    }
    cov_pmtrkqcvi().s[48]++;
    return cac / (ltv / 12); // Convert annual LTV to monthly
  }

  /**
   * Parse period string (e.g., "2024-01" or "2024-Q1")
   */
  parsePeriod(period) {
    /* istanbul ignore next */
    cov_pmtrkqcvi().f[7]++;
    const now =
    /* istanbul ignore next */
    (cov_pmtrkqcvi().s[49]++, new Date());
    /* istanbul ignore next */
    cov_pmtrkqcvi().s[50]++;
    if (period.includes('-Q')) {
      /* istanbul ignore next */
      cov_pmtrkqcvi().b[8][0]++;
      // Quarter format: 2024-Q1
      const [year, quarter] =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[51]++, period.split('-Q'));
      const q =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[52]++, parseInt(quarter));
      const startMonth =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[53]++, (q - 1) * 3);
      const startDate =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[54]++, new Date(parseInt(year), startMonth, 1));
      const endDate =
      /* istanbul ignore next */
      (cov_pmtrkqcvi().s[55]++, new Date(parseInt(year), startMonth + 3, 0, 23, 59, 59));
      /* istanbul ignore next */
      cov_pmtrkqcvi().s[56]++;
      return [startDate, endDate];
    } else {
      /* istanbul ignore next */
      cov_pmtrkqcvi().b[8][1]++;
      cov_pmtrkqcvi().s[57]++;
      if (period.includes('-')) {
        /* istanbul ignore next */
        cov_pmtrkqcvi().b[9][0]++;
        // Month format: 2024-01
        const [year, month] =
        /* istanbul ignore next */
        (cov_pmtrkqcvi().s[58]++, period.split('-'));
        const startDate =
        /* istanbul ignore next */
        (cov_pmtrkqcvi().s[59]++, new Date(parseInt(year), parseInt(month) - 1, 1));
        const endDate =
        /* istanbul ignore next */
        (cov_pmtrkqcvi().s[60]++, new Date(parseInt(year), parseInt(month), 0, 23, 59, 59));
        /* istanbul ignore next */
        cov_pmtrkqcvi().s[61]++;
        return [startDate, endDate];
      } else {
        /* istanbul ignore next */
        cov_pmtrkqcvi().b[9][1]++;
        // Year format: 2024
        const year =
        /* istanbul ignore next */
        (cov_pmtrkqcvi().s[62]++, parseInt(period));
        const startDate =
        /* istanbul ignore next */
        (cov_pmtrkqcvi().s[63]++, new Date(year, 0, 1));
        const endDate =
        /* istanbul ignore next */
        (cov_pmtrkqcvi().s[64]++, new Date(year, 11, 31, 23, 59, 59));
        /* istanbul ignore next */
        cov_pmtrkqcvi().s[65]++;
        return [startDate, endDate];
      }
    }
  }
}
export const conversionMetricsService =
/* istanbul ignore next */
(cov_pmtrkqcvi().s[66]++, new ConversionMetricsService());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfcG10cmtxY3ZpIiwiYWN0dWFsQ292ZXJhZ2UiLCJQcmlzbWFDbGllbnQiLCJsb2dnZXIiLCJwcmlzbWEiLCJzIiwiQ29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlIiwiZ2V0Q29udmVyc2lvbk1ldHJpY3MiLCJwZXJpb2QiLCJmIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsInBhcnNlUGVyaW9kIiwidXNlcnNCeVRpZXIiLCJ1c2VyIiwiZ3JvdXBCeSIsImJ5IiwiX2NvdW50IiwiaWQiLCJ3aGVyZSIsImNyZWF0ZWRBdCIsImd0ZSIsImx0ZSIsInRpZXJDb3VudHMiLCJmcmVlIiwicHJlbWl1bSIsInBybyIsImZvckVhY2giLCJncm91cCIsInRpZXIiLCJjb252ZXJzaW9uUmF0ZSIsImNhbGN1bGF0ZUNvbnZlcnNpb25SYXRlIiwiY2h1cm5SYXRlIiwiY2FsY3VsYXRlQ2h1cm5SYXRlIiwibGlmZXRpbWVWYWx1ZSIsImNhbGN1bGF0ZUxpZmV0aW1lVmFsdWUiLCJjdXN0b21lckFjcXVpc2l0aW9uQ29zdCIsImNhbGN1bGF0ZUNBQyIsInBheWJhY2tQZXJpb2QiLCJjYWxjdWxhdGVQYXliYWNrUGVyaW9kIiwiZnJlZVVzZXJzIiwicHJlbWl1bVVzZXJzIiwicHJvVXNlcnMiLCJlcnJvciIsInRvdGFsRnJlZUFuZFByZW1pdW0iLCJiIiwicHJlbWl1bUF0U3RhcnQiLCJjb3VudCIsImx0IiwiZG93bmdyYWRlZCIsInVwZGF0ZWRBdCIsInJlc3VsdCIsInBheW1lbnQiLCJhZ2dyZWdhdGUiLCJfYXZnIiwiYW1vdW50IiwiX3N1bSIsInRvdGFsUmV2ZW51ZSIsInRvdGFsVXNlcnMiLCJOdW1iZXIiLCJuZXdVc2VycyIsImVzdGltYXRlZE1hcmtldGluZ1NwZW5kIiwiY2FjIiwibHR2Iiwibm93IiwiRGF0ZSIsImluY2x1ZGVzIiwieWVhciIsInF1YXJ0ZXIiLCJzcGxpdCIsInEiLCJwYXJzZUludCIsInN0YXJ0TW9udGgiLCJtb250aCIsImNvbnZlcnNpb25NZXRyaWNzU2VydmljZSJdLCJzb3VyY2VzIjpbImNvbnZlcnNpb24tbWV0cmljcy5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzaW9uTWV0cmljc1Jlc3BvbnNlIHtcbiAgcGVyaW9kOiBzdHJpbmc7XG4gIGZyZWVVc2VyczogbnVtYmVyO1xuICBwcmVtaXVtVXNlcnM6IG51bWJlcjtcbiAgcHJvVXNlcnM6IG51bWJlcjtcbiAgY29udmVyc2lvblJhdGU6IG51bWJlcjtcbiAgY2h1cm5SYXRlOiBudW1iZXI7XG4gIGxpZmV0aW1lVmFsdWU6IG51bWJlcjtcbiAgY3VzdG9tZXJBY3F1aXNpdGlvbkNvc3Q6IG51bWJlcjtcbiAgcGF5YmFja1BlcmlvZDogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQ29udmVyc2lvbk1ldHJpY3NTZXJ2aWNlIHtcbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBjb252ZXJzaW9uIG1ldHJpY3MgZm9yIGEgZ2l2ZW4gcGVyaW9kXG4gICAqIFJlcXVpcmVtZW50czogNS4xLCA1LjJcbiAgICovXG4gIGFzeW5jIGdldENvbnZlcnNpb25NZXRyaWNzKHBlcmlvZDogc3RyaW5nKTogUHJvbWlzZTxDb252ZXJzaW9uTWV0cmljc1Jlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IFtzdGFydERhdGUsIGVuZERhdGVdID0gdGhpcy5wYXJzZVBlcmlvZChwZXJpb2QpO1xuXG4gICAgICAvLyBHZXQgdXNlciBjb3VudHMgYnkgdGllclxuICAgICAgY29uc3QgdXNlcnNCeVRpZXIgPSBhd2FpdCBwcmlzbWEudXNlci5ncm91cEJ5KHtcbiAgICAgICAgYnk6IFsndGllciddLFxuICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgICAgICAgbHRlOiBlbmREYXRlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdGllckNvdW50cyA9IHtcbiAgICAgICAgZnJlZTogMCxcbiAgICAgICAgcHJlbWl1bTogMCxcbiAgICAgICAgcHJvOiAwLFxuICAgICAgfTtcblxuICAgICAgdXNlcnNCeVRpZXIuZm9yRWFjaCgoZ3JvdXA6IGFueSkgPT4ge1xuICAgICAgICB0aWVyQ291bnRzW2dyb3VwLnRpZXIgYXMga2V5b2YgdHlwZW9mIHRpZXJDb3VudHNdID0gZ3JvdXAuX2NvdW50LmlkO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBjb252ZXJzaW9uIHJhdGUgKGZyZWUgdG8gcHJlbWl1bSlcbiAgICAgIGNvbnN0IGNvbnZlcnNpb25SYXRlID0gdGhpcy5jYWxjdWxhdGVDb252ZXJzaW9uUmF0ZSh0aWVyQ291bnRzKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGNodXJuIHJhdGVcbiAgICAgIGNvbnN0IGNodXJuUmF0ZSA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlQ2h1cm5SYXRlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBsaWZldGltZSB2YWx1ZVxuICAgICAgY29uc3QgbGlmZXRpbWVWYWx1ZSA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlTGlmZXRpbWVWYWx1ZSgpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgY3VzdG9tZXIgYWNxdWlzaXRpb24gY29zdFxuICAgICAgY29uc3QgY3VzdG9tZXJBY3F1aXNpdGlvbkNvc3QgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZUNBQyhzdGFydERhdGUsIGVuZERhdGUpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgcGF5YmFjayBwZXJpb2RcbiAgICAgIGNvbnN0IHBheWJhY2tQZXJpb2QgPSB0aGlzLmNhbGN1bGF0ZVBheWJhY2tQZXJpb2QoY3VzdG9tZXJBY3F1aXNpdGlvbkNvc3QsIGxpZmV0aW1lVmFsdWUpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwZXJpb2QsXG4gICAgICAgIGZyZWVVc2VyczogdGllckNvdW50cy5mcmVlLFxuICAgICAgICBwcmVtaXVtVXNlcnM6IHRpZXJDb3VudHMucHJlbWl1bSxcbiAgICAgICAgcHJvVXNlcnM6IHRpZXJDb3VudHMucHJvLFxuICAgICAgICBjb252ZXJzaW9uUmF0ZSxcbiAgICAgICAgY2h1cm5SYXRlLFxuICAgICAgICBsaWZldGltZVZhbHVlLFxuICAgICAgICBjdXN0b21lckFjcXVpc2l0aW9uQ29zdCxcbiAgICAgICAgcGF5YmFja1BlcmlvZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgY2FsY3VsYXRpbmcgY29udmVyc2lvbiBtZXRyaWNzJywgeyBlcnJvciwgcGVyaW9kIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBmcmVlIHRvIHByZW1pdW0gY29udmVyc2lvbiByYXRlXG4gICAqIFJlcXVpcmVtZW50czogNS4xLCA1LjJcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29udmVyc2lvblJhdGUodGllckNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPik6IG51bWJlciB7XG4gICAgY29uc3QgdG90YWxGcmVlQW5kUHJlbWl1bSA9IHRpZXJDb3VudHMuZnJlZSArIHRpZXJDb3VudHMucHJlbWl1bTtcbiAgICBpZiAodG90YWxGcmVlQW5kUHJlbWl1bSA9PT0gMCkge3JldHVybiAwO31cbiAgICByZXR1cm4gKHRpZXJDb3VudHMucHJlbWl1bSAvIHRvdGFsRnJlZUFuZFByZW1pdW0pICogMTAwO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBjaHVybiByYXRlICh1c2VycyB3aG8gZG93bmdyYWRlZCBvciBiZWNhbWUgaW5hY3RpdmUpXG4gICAqIFJlcXVpcmVtZW50czogNS4xLCA1LjJcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlQ2h1cm5SYXRlKHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCB1c2VycyB3aG8gd2VyZSBwcmVtaXVtIGF0IHN0YXJ0IG9mIHBlcmlvZFxuICAgICAgY29uc3QgcHJlbWl1bUF0U3RhcnQgPSBhd2FpdCBwcmlzbWEudXNlci5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdGllcjogJ3ByZW1pdW0nLFxuICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgbHQ6IHN0YXJ0RGF0ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChwcmVtaXVtQXRTdGFydCA9PT0gMCkge3JldHVybiAwO31cblxuICAgICAgLy8gR2V0IHVzZXJzIHdobyBkb3duZ3JhZGVkIHRvIGZyZWUgZHVyaW5nIHBlcmlvZFxuICAgICAgY29uc3QgZG93bmdyYWRlZCA9IGF3YWl0IHByaXNtYS51c2VyLmNvdW50KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB0aWVyOiAnZnJlZScsXG4gICAgICAgICAgdXBkYXRlZEF0OiB7XG4gICAgICAgICAgICBndGU6IHN0YXJ0RGF0ZSxcbiAgICAgICAgICAgIGx0ZTogZW5kRGF0ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiAoZG93bmdyYWRlZCAvIHByZW1pdW1BdFN0YXJ0KSAqIDEwMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjYWxjdWxhdGluZyBjaHVybiByYXRlJywgeyBlcnJvciB9KTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgYXZlcmFnZSBsaWZldGltZSB2YWx1ZSBwZXIgc3R1ZGVudFxuICAgKiBSZXF1aXJlbWVudHM6IDUuMSwgNS4yXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZUxpZmV0aW1lVmFsdWUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJpc21hLnBheW1lbnQuYWdncmVnYXRlKHtcbiAgICAgICAgX2F2Zzoge1xuICAgICAgICAgIGFtb3VudDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgX3N1bToge1xuICAgICAgICAgIGFtb3VudDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXN1bHQuX2NvdW50LmlkIHx8IHJlc3VsdC5fY291bnQuaWQgPT09IDApIHtyZXR1cm4gMDt9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIHJldmVudWUgcGVyIHVzZXJcbiAgICAgIGNvbnN0IHRvdGFsUmV2ZW51ZSA9IHJlc3VsdC5fc3VtLmFtb3VudCB8fCAwO1xuICAgICAgY29uc3QgdG90YWxVc2VycyA9IGF3YWl0IHByaXNtYS51c2VyLmNvdW50KCk7XG5cbiAgICAgIGlmICh0b3RhbFVzZXJzID09PSAwKSB7cmV0dXJuIDA7fVxuXG4gICAgICByZXR1cm4gTnVtYmVyKHRvdGFsUmV2ZW51ZSkgLyB0b3RhbFVzZXJzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGNhbGN1bGF0aW5nIGxpZmV0aW1lIHZhbHVlJywgeyBlcnJvciB9KTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgY3VzdG9tZXIgYWNxdWlzaXRpb24gY29zdFxuICAgKiBSZXF1aXJlbWVudHM6IDUuMSwgNS4yXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZUNBQyhzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBFc3RpbWF0ZSBtYXJrZXRpbmcgc3BlbmQgKHRoaXMgd291bGQgY29tZSBmcm9tIGFjdHVhbCBtYXJrZXRpbmcgZGF0YSlcbiAgICAgIC8vIEZvciBub3csIHdlJ2xsIHVzZSBhIHNpbXBsaWZpZWQgY2FsY3VsYXRpb24gYmFzZWQgb24gY29udmVyc2lvbiBldmVudHNcbiAgICAgIGNvbnN0IG5ld1VzZXJzID0gYXdhaXQgcHJpc21hLnVzZXIuY291bnQoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgZ3RlOiBzdGFydERhdGUsXG4gICAgICAgICAgICBsdGU6IGVuZERhdGUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAobmV3VXNlcnMgPT09IDApIHtyZXR1cm4gMDt9XG5cbiAgICAgIC8vIEFzc3VtZSBhdmVyYWdlIG1hcmtldGluZyBzcGVuZCBwZXIgdXNlciBhY3F1aXNpdGlvblxuICAgICAgLy8gVGhpcyBzaG91bGQgYmUgcmVwbGFjZWQgd2l0aCBhY3R1YWwgbWFya2V0aW5nIHNwZW5kIGRhdGFcbiAgICAgIGNvbnN0IGVzdGltYXRlZE1hcmtldGluZ1NwZW5kID0gbmV3VXNlcnMgKiAxMDsgLy8gJDEwIHBlciB1c2VyIGVzdGltYXRlXG5cbiAgICAgIHJldHVybiBlc3RpbWF0ZWRNYXJrZXRpbmdTcGVuZCAvIG5ld1VzZXJzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGNhbGN1bGF0aW5nIENBQycsIHsgZXJyb3IgfSk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHBheWJhY2sgcGVyaW9kIGluIG1vbnRoc1xuICAgKiBSZXF1aXJlbWVudHM6IDUuMSwgNS4yXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVBheWJhY2tQZXJpb2QoY2FjOiBudW1iZXIsIGx0djogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAobHR2ID09PSAwKSB7cmV0dXJuIDA7fVxuICAgIHJldHVybiBjYWMgLyAobHR2IC8gMTIpOyAvLyBDb252ZXJ0IGFubnVhbCBMVFYgdG8gbW9udGhseVxuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHBlcmlvZCBzdHJpbmcgKGUuZy4sIFwiMjAyNC0wMVwiIG9yIFwiMjAyNC1RMVwiKVxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZVBlcmlvZChwZXJpb2Q6IHN0cmluZyk6IFtEYXRlLCBEYXRlXSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgIGlmIChwZXJpb2QuaW5jbHVkZXMoJy1RJykpIHtcbiAgICAgIC8vIFF1YXJ0ZXIgZm9ybWF0OiAyMDI0LVExXG4gICAgICBjb25zdCBbeWVhciwgcXVhcnRlcl0gPSBwZXJpb2Quc3BsaXQoJy1RJyk7XG4gICAgICBjb25zdCBxID0gcGFyc2VJbnQocXVhcnRlcik7XG4gICAgICBjb25zdCBzdGFydE1vbnRoID0gKHEgLSAxKSAqIDM7XG4gICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZShwYXJzZUludCh5ZWFyKSwgc3RhcnRNb250aCwgMSk7XG4gICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUocGFyc2VJbnQoeWVhciksIHN0YXJ0TW9udGggKyAzLCAwLCAyMywgNTksIDU5KTtcbiAgICAgIHJldHVybiBbc3RhcnREYXRlLCBlbmREYXRlXTtcbiAgICB9IGVsc2UgaWYgKHBlcmlvZC5pbmNsdWRlcygnLScpKSB7XG4gICAgICAvLyBNb250aCBmb3JtYXQ6IDIwMjQtMDFcbiAgICAgIGNvbnN0IFt5ZWFyLCBtb250aF0gPSBwZXJpb2Quc3BsaXQoJy0nKTtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHBhcnNlSW50KHllYXIpLCBwYXJzZUludChtb250aCkgLSAxLCAxKTtcbiAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShwYXJzZUludCh5ZWFyKSwgcGFyc2VJbnQobW9udGgpLCAwLCAyMywgNTksIDU5KTtcbiAgICAgIHJldHVybiBbc3RhcnREYXRlLCBlbmREYXRlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gWWVhciBmb3JtYXQ6IDIwMjRcbiAgICAgIGNvbnN0IHllYXIgPSBwYXJzZUludChwZXJpb2QpO1xuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoeWVhciwgMCwgMSk7XG4gICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoeWVhciwgMTEsIDMxLCAyMywgNTksIDU5KTtcbiAgICAgIHJldHVybiBbc3RhcnREYXRlLCBlbmREYXRlXTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNvbnZlcnNpb25NZXRyaWNzU2VydmljZSA9IG5ldyBDb252ZXJzaW9uTWV0cmljc1NlcnZpY2UoKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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