{"version":3,"names":["cov_1lahmzpc72","actualCoverage","logger","s","errorHandler","err","req","res","next","f","error","message","stack","url","method","ip","name","b","statusCode","code","Object","values","errors","map","val","join","status","json","success","process","env","NODE_ENV"],"sources":["errorHandler.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nimport { Request, Response, NextFunction } from 'express';\nimport logger from './requestLogger';\n\ninterface CustomError extends Error {\n  statusCode?: number;\n  isOperational?: boolean;\n}\n\nexport const errorHandler = (\n  err: CustomError,\n  req: Request,\n  res: Response,\n  next: NextFunction\n): void => {\n  let error = { ...err };\n  error.message = err.message;\n\n  // Log error\n  logger.error('Error occurred', {\n    error: err.message,\n    stack: err.stack,\n    url: req.url,\n    method: req.method,\n    ip: req.ip,\n  });\n\n  // Mongoose bad ObjectId\n  if (err.name === 'CastError') {\n    const message = 'Resource not found';\n    error = { ...error, message, statusCode: 404 };\n  }\n\n  // Mongoose duplicate key\n  if (err.name === 'MongoError' && (err as any).code === 11000) {\n    const message = 'Duplicate field value entered';\n    error = { ...error, message, statusCode: 400 };\n  }\n\n  // Mongoose validation error\n  if (err.name === 'ValidationError') {\n    const message = Object.values((err as any).errors).map((val: any) => val.message).join(', ');\n    error = { ...error, message, statusCode: 400 };\n  }\n\n  // JWT errors\n  if (err.name === 'JsonWebTokenError') {\n    const message = 'Invalid token';\n    error = { ...error, message, statusCode: 401 };\n  }\n\n  if (err.name === 'TokenExpiredError') {\n    const message = 'Token expired';\n    error = { ...error, message, statusCode: 401 };\n  }\n\n  res.status(error.statusCode || 500).json({\n    success: false,\n    error: error.message || 'Server Error',\n    ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),\n  });\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA,OAAOE,MAAM,MAAM,iBAAiB;AAAC;AAAAF,cAAA,GAAAG,CAAA;AAOrC,OAAO,MAAMC,YAAY,GAAGA,CAC1BC,GAAgB,EAChBC,GAAY,EACZC,GAAa,EACbC,IAAkB,KACT;EAAA;EAAAR,cAAA,GAAAS,CAAA;EACT,IAAIC,KAAK;EAAA;EAAA,CAAAV,cAAA,GAAAG,CAAA,OAAG;IAAE,GAAGE;EAAI,CAAC;EAAC;EAAAL,cAAA,GAAAG,CAAA;EACvBO,KAAK,CAACC,OAAO,GAAGN,GAAG,CAACM,OAAO;;EAE3B;EAAA;EAAAX,cAAA,GAAAG,CAAA;EACAD,MAAM,CAACQ,KAAK,CAAC,gBAAgB,EAAE;IAC7BA,KAAK,EAAEL,GAAG,CAACM,OAAO;IAClBC,KAAK,EAAEP,GAAG,CAACO,KAAK;IAChBC,GAAG,EAAEP,GAAG,CAACO,GAAG;IACZC,MAAM,EAAER,GAAG,CAACQ,MAAM;IAClBC,EAAE,EAAET,GAAG,CAACS;EACV,CAAC,CAAC;;EAEF;EAAA;EAAAf,cAAA,GAAAG,CAAA;EACA,IAAIE,GAAG,CAACW,IAAI,KAAK,WAAW,EAAE;IAAA;IAAAhB,cAAA,GAAAiB,CAAA;IAC5B,MAAMN,OAAO;IAAA;IAAA,CAAAX,cAAA,GAAAG,CAAA,OAAG,oBAAoB;IAAC;IAAAH,cAAA,GAAAG,CAAA;IACrCO,KAAK,GAAG;MAAE,GAAGA,KAAK;MAAEC,OAAO;MAAEO,UAAU,EAAE;IAAI,CAAC;EAChD,CAAC;EAAA;EAAA;IAAAlB,cAAA,GAAAiB,CAAA;EAAA;;EAED;EAAAjB,cAAA,GAAAG,CAAA;EACA;EAAI;EAAA,CAAAH,cAAA,GAAAiB,CAAA,UAAAZ,GAAG,CAACW,IAAI,KAAK,YAAY;EAAA;EAAA,CAAAhB,cAAA,GAAAiB,CAAA,UAAKZ,GAAG,CAASc,IAAI,KAAK,KAAK,GAAE;IAAA;IAAAnB,cAAA,GAAAiB,CAAA;IAC5D,MAAMN,OAAO;IAAA;IAAA,CAAAX,cAAA,GAAAG,CAAA,OAAG,+BAA+B;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAChDO,KAAK,GAAG;MAAE,GAAGA,KAAK;MAAEC,OAAO;MAAEO,UAAU,EAAE;IAAI,CAAC;EAChD,CAAC;EAAA;EAAA;IAAAlB,cAAA,GAAAiB,CAAA;EAAA;;EAED;EAAAjB,cAAA,GAAAG,CAAA;EACA,IAAIE,GAAG,CAACW,IAAI,KAAK,iBAAiB,EAAE;IAAA;IAAAhB,cAAA,GAAAiB,CAAA;IAClC,MAAMN,OAAO;IAAA;IAAA,CAAAX,cAAA,GAAAG,CAAA,QAAGiB,MAAM,CAACC,MAAM,CAAEhB,GAAG,CAASiB,MAAM,CAAC,CAACC,GAAG,CAAEC,GAAQ,IAAK;MAAA;MAAAxB,cAAA,GAAAS,CAAA;MAAAT,cAAA,GAAAG,CAAA;MAAA,OAAAqB,GAAG,CAACb,OAAO;IAAD,CAAC,CAAC,CAACc,IAAI,CAAC,IAAI,CAAC;IAAC;IAAAzB,cAAA,GAAAG,CAAA;IAC7FO,KAAK,GAAG;MAAE,GAAGA,KAAK;MAAEC,OAAO;MAAEO,UAAU,EAAE;IAAI,CAAC;EAChD,CAAC;EAAA;EAAA;IAAAlB,cAAA,GAAAiB,CAAA;EAAA;;EAED;EAAAjB,cAAA,GAAAG,CAAA;EACA,IAAIE,GAAG,CAACW,IAAI,KAAK,mBAAmB,EAAE;IAAA;IAAAhB,cAAA,GAAAiB,CAAA;IACpC,MAAMN,OAAO;IAAA;IAAA,CAAAX,cAAA,GAAAG,CAAA,QAAG,eAAe;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAChCO,KAAK,GAAG;MAAE,GAAGA,KAAK;MAAEC,OAAO;MAAEO,UAAU,EAAE;IAAI,CAAC;EAChD,CAAC;EAAA;EAAA;IAAAlB,cAAA,GAAAiB,CAAA;EAAA;EAAAjB,cAAA,GAAAG,CAAA;EAED,IAAIE,GAAG,CAACW,IAAI,KAAK,mBAAmB,EAAE;IAAA;IAAAhB,cAAA,GAAAiB,CAAA;IACpC,MAAMN,OAAO;IAAA;IAAA,CAAAX,cAAA,GAAAG,CAAA,QAAG,eAAe;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAChCO,KAAK,GAAG;MAAE,GAAGA,KAAK;MAAEC,OAAO;MAAEO,UAAU,EAAE;IAAI,CAAC;EAChD,CAAC;EAAA;EAAA;IAAAlB,cAAA,GAAAiB,CAAA;EAAA;EAAAjB,cAAA,GAAAG,CAAA;EAEDI,GAAG,CAACmB,MAAM;EAAC;EAAA,CAAA1B,cAAA,GAAAiB,CAAA,UAAAP,KAAK,CAACQ,UAAU;EAAA;EAAA,CAAAlB,cAAA,GAAAiB,CAAA,UAAI,GAAG,EAAC,CAACU,IAAI,CAAC;IACvCC,OAAO,EAAE,KAAK;IACdlB,KAAK;IAAE;IAAA,CAAAV,cAAA,GAAAiB,CAAA,UAAAP,KAAK,CAACC,OAAO;IAAA;IAAA,CAAAX,cAAA,GAAAiB,CAAA,UAAI,cAAc;IACtC;IAAI;IAAA,CAAAjB,cAAA,GAAAiB,CAAA,UAAAY,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;IAAA;IAAA,CAAA/B,cAAA,GAAAiB,CAAA,UAAI;MAAEL,KAAK,EAAEP,GAAG,CAACO;IAAM,CAAC;EACpE,CAAC,CAAC;AACJ,CAAC","ignoreList":[]}