{"version":3,"names":["cov_pmtrkqcvi","actualCoverage","PrismaClient","logger","prisma","s","ConversionMetricsService","getConversionMetrics","period","f","startDate","endDate","parsePeriod","usersByTier","user","groupBy","by","_count","id","where","createdAt","gte","lte","tierCounts","free","premium","pro","forEach","group","tier","conversionRate","calculateConversionRate","churnRate","calculateChurnRate","lifetimeValue","calculateLifetimeValue","customerAcquisitionCost","calculateCAC","paybackPeriod","calculatePaybackPeriod","freeUsers","premiumUsers","proUsers","error","totalFreeAndPremium","b","premiumAtStart","count","lt","downgraded","updatedAt","result","payment","aggregate","_avg","amount","_sum","totalRevenue","totalUsers","Number","newUsers","estimatedMarketingSpend","cac","ltv","now","Date","includes","year","quarter","split","q","parseInt","startMonth","month","conversionMetricsService"],"sources":["conversion-metrics.service.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\nimport { logger } from '../utils/logger';\n\nconst prisma = new PrismaClient();\n\nexport interface ConversionMetricsResponse {\n  period: string;\n  freeUsers: number;\n  premiumUsers: number;\n  proUsers: number;\n  conversionRate: number;\n  churnRate: number;\n  lifetimeValue: number;\n  customerAcquisitionCost: number;\n  paybackPeriod: number;\n}\n\nexport class ConversionMetricsService {\n  /**\n   * Calculate conversion metrics for a given period\n   * Requirements: 5.1, 5.2\n   */\n  async getConversionMetrics(period: string): Promise<ConversionMetricsResponse> {\n    try {\n      const [startDate, endDate] = this.parsePeriod(period);\n\n      // Get user counts by tier\n      const usersByTier = await prisma.user.groupBy({\n        by: ['tier'],\n        _count: {\n          id: true,\n        },\n        where: {\n          createdAt: {\n            gte: startDate,\n            lte: endDate,\n          },\n        },\n      });\n\n      const tierCounts = {\n        free: 0,\n        premium: 0,\n        pro: 0,\n      };\n\n      usersByTier.forEach((group: any) => {\n        tierCounts[group.tier as keyof typeof tierCounts] = group._count.id;\n      });\n\n      // Calculate conversion rate (free to premium)\n      const conversionRate = this.calculateConversionRate(tierCounts);\n\n      // Calculate churn rate\n      const churnRate = await this.calculateChurnRate(startDate, endDate);\n\n      // Calculate lifetime value\n      const lifetimeValue = await this.calculateLifetimeValue();\n\n      // Calculate customer acquisition cost\n      const customerAcquisitionCost = await this.calculateCAC(startDate, endDate);\n\n      // Calculate payback period\n      const paybackPeriod = this.calculatePaybackPeriod(customerAcquisitionCost, lifetimeValue);\n\n      return {\n        period,\n        freeUsers: tierCounts.free,\n        premiumUsers: tierCounts.premium,\n        proUsers: tierCounts.pro,\n        conversionRate,\n        churnRate,\n        lifetimeValue,\n        customerAcquisitionCost,\n        paybackPeriod,\n      };\n    } catch (error) {\n      logger.error('Error calculating conversion metrics', { error, period });\n      throw error;\n    }\n  }\n\n  /**\n   * Calculate free to premium conversion rate\n   * Requirements: 5.1, 5.2\n   */\n  private calculateConversionRate(tierCounts: Record<string, number>): number {\n    const totalFreeAndPremium = tierCounts.free + tierCounts.premium;\n    if (totalFreeAndPremium === 0) {return 0;}\n    return (tierCounts.premium / totalFreeAndPremium) * 100;\n  }\n\n  /**\n   * Calculate churn rate (users who downgraded or became inactive)\n   * Requirements: 5.1, 5.2\n   */\n  private async calculateChurnRate(startDate: Date, endDate: Date): Promise<number> {\n    try {\n      // Get users who were premium at start of period\n      const premiumAtStart = await prisma.user.count({\n        where: {\n          tier: 'premium',\n          createdAt: {\n            lt: startDate,\n          },\n        },\n      });\n\n      if (premiumAtStart === 0) {return 0;}\n\n      // Get users who downgraded to free during period\n      const downgraded = await prisma.user.count({\n        where: {\n          tier: 'free',\n          updatedAt: {\n            gte: startDate,\n            lte: endDate,\n          },\n        },\n      });\n\n      return (downgraded / premiumAtStart) * 100;\n    } catch (error) {\n      logger.error('Error calculating churn rate', { error });\n      return 0;\n    }\n  }\n\n  /**\n   * Calculate average lifetime value per student\n   * Requirements: 5.1, 5.2\n   */\n  private async calculateLifetimeValue(): Promise<number> {\n    try {\n      const result = await prisma.payment.aggregate({\n        _avg: {\n          amount: true,\n        },\n        _sum: {\n          amount: true,\n        },\n        _count: {\n          id: true,\n        },\n      });\n\n      if (!result._count.id || result._count.id === 0) {return 0;}\n\n      // Calculate average revenue per user\n      const totalRevenue = result._sum.amount || 0;\n      const totalUsers = await prisma.user.count();\n\n      if (totalUsers === 0) {return 0;}\n\n      return Number(totalRevenue) / totalUsers;\n    } catch (error) {\n      logger.error('Error calculating lifetime value', { error });\n      return 0;\n    }\n  }\n\n  /**\n   * Calculate customer acquisition cost\n   * Requirements: 5.1, 5.2\n   */\n  private async calculateCAC(startDate: Date, endDate: Date): Promise<number> {\n    try {\n      // Estimate marketing spend (this would come from actual marketing data)\n      // For now, we'll use a simplified calculation based on conversion events\n      const newUsers = await prisma.user.count({\n        where: {\n          createdAt: {\n            gte: startDate,\n            lte: endDate,\n          },\n        },\n      });\n\n      if (newUsers === 0) {return 0;}\n\n      // Assume average marketing spend per user acquisition\n      // This should be replaced with actual marketing spend data\n      const estimatedMarketingSpend = newUsers * 10; // $10 per user estimate\n\n      return estimatedMarketingSpend / newUsers;\n    } catch (error) {\n      logger.error('Error calculating CAC', { error });\n      return 0;\n    }\n  }\n\n  /**\n   * Calculate payback period in months\n   * Requirements: 5.1, 5.2\n   */\n  private calculatePaybackPeriod(cac: number, ltv: number): number {\n    if (ltv === 0) {return 0;}\n    return cac / (ltv / 12); // Convert annual LTV to monthly\n  }\n\n  /**\n   * Parse period string (e.g., \"2024-01\" or \"2024-Q1\")\n   */\n  private parsePeriod(period: string): [Date, Date] {\n    const now = new Date();\n\n    if (period.includes('-Q')) {\n      // Quarter format: 2024-Q1\n      const [year, quarter] = period.split('-Q');\n      const q = parseInt(quarter);\n      const startMonth = (q - 1) * 3;\n      const startDate = new Date(parseInt(year), startMonth, 1);\n      const endDate = new Date(parseInt(year), startMonth + 3, 0, 23, 59, 59);\n      return [startDate, endDate];\n    } else if (period.includes('-')) {\n      // Month format: 2024-01\n      const [year, month] = period.split('-');\n      const startDate = new Date(parseInt(year), parseInt(month) - 1, 1);\n      const endDate = new Date(parseInt(year), parseInt(month), 0, 23, 59, 59);\n      return [startDate, endDate];\n    } else {\n      // Year format: 2024\n      const year = parseInt(period);\n      const startDate = new Date(year, 0, 1);\n      const endDate = new Date(year, 11, 31, 23, 59, 59);\n      return [startDate, endDate];\n    }\n  }\n}\n\nexport const conversionMetricsService = new ConversionMetricsService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}