{"version":3,"names":["cov_1f57cesqds","actualCoverage","express","s","require","router","Router","auditService","post","req","res","f","userId","action","resource","details","body","b","status","json","error","auditEntry","logSecurityEvent","success","data","message","logUserAction","service","logSystemEvent","logDataAccess","get","filters","type","query","startDate","endDate","page","parseInt","limit","logs","getAuditLogs","stats","getSecurityStats","delete","retentionDays","days","removedCount","clearOldLogs","module","exports"],"sources":["routes.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst auditService = require('../index');\n\n// Log a security event\nrouter.post('/security', (req, res) => {\n  try {\n    const { userId, action, resource, details } = req.body;\n\n    if (!action || !resource) {\n      return res.status(400).json({\n        error: 'Action and resource are required'\n      });\n    }\n\n    const auditEntry = auditService.logSecurityEvent(userId, action, resource, details);\n\n    res.status(201).json({\n      success: true,\n      data: auditEntry\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Log a user action\nrouter.post('/user-action', (req, res) => {\n  try {\n    const { userId, action, resource, details } = req.body;\n\n    if (!userId || !action || !resource) {\n      return res.status(400).json({\n        error: 'User ID, action, and resource are required'\n      });\n    }\n\n    const auditEntry = auditService.logUserAction(userId, action, resource, details);\n\n    res.status(201).json({\n      success: true,\n      data: auditEntry\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Log a system event\nrouter.post('/system', (req, res) => {\n  try {\n    const { service, action, details } = req.body;\n\n    if (!service || !action) {\n      return res.status(400).json({\n        error: 'Service and action are required'\n      });\n    }\n\n    const auditEntry = auditService.logSystemEvent(service, action, details);\n\n    res.status(201).json({\n      success: true,\n      data: auditEntry\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Log data access\nrouter.post('/data-access', (req, res) => {\n  try {\n    const { userId, action, resource, details } = req.body;\n\n    if (!userId || !action || !resource) {\n      return res.status(400).json({\n        error: 'User ID, action, and resource are required'\n      });\n    }\n\n    const auditEntry = auditService.logDataAccess(userId, action, resource, details);\n\n    res.status(201).json({\n      success: true,\n      data: auditEntry\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Get audit logs with filtering\nrouter.get('/logs', (req, res) => {\n  try {\n    const filters = {\n      type: req.query.type,\n      userId: req.query.userId,\n      action: req.query.action,\n      resource: req.query.resource,\n      startDate: req.query.startDate,\n      endDate: req.query.endDate,\n      page: parseInt(req.query.page) || 1,\n      limit: parseInt(req.query.limit) || 50\n    };\n\n    const logs = auditService.getAuditLogs(filters);\n\n    res.json({\n      success: true,\n      data: logs\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Get security statistics\nrouter.get('/security/stats', (req, res) => {\n  try {\n    const stats = auditService.getSecurityStats();\n\n    res.json({\n      success: true,\n      data: stats\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Clear old logs\nrouter.delete('/logs/old', (req, res) => {\n  try {\n    const retentionDays = parseInt(req.query.days) || 90;\n    const removedCount = auditService.clearOldLogs(retentionDays);\n\n    res.json({\n      success: true,\n      message: `Removed ${removedCount} old audit logs`,\n      removedCount\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\nmodule.exports = router;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA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","ignoreList":[]}