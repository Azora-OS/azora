{"version":3,"names":["cov_24a3jyhquy","actualCoverage","jwt","JWT_SECRET","s","b","process","env","authMiddleware","req","res","next","f","authHeader","headers","authorization","startsWith","status","json","error","token","substring","decoded","verify","user","id","email","role","optionalAuth","generateToken","userId","sign","expiresIn"],"sources":["auth-middleware.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'azora-secret-key-change-in-production';\n\nexport interface AuthRequest extends Request {\n    user?: {\n        id: string;\n        email: string;\n        role: string;\n    };\n}\n\nexport const authMiddleware = (req: AuthRequest, res: Response, next: NextFunction) => {\n    try {\n        const authHeader = req.headers.authorization;\n\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\n            return res.status(401).json({ error: 'No token provided' });\n        }\n\n        const token = authHeader.substring(7);\n\n        const decoded = jwt.verify(token, JWT_SECRET) as any;\n        req.user = {\n            id: decoded.id,\n            email: decoded.email,\n            role: decoded.role || 'user'\n        };\n\n        next();\n    } catch (error) {\n        return res.status(401).json({ error: 'Invalid token' });\n    }\n};\n\nexport const optionalAuth = (req: AuthRequest, res: Response, next: NextFunction) => {\n    try {\n        const authHeader = req.headers.authorization;\n\n        if (authHeader && authHeader.startsWith('Bearer ')) {\n            const token = authHeader.substring(7);\n            const decoded = jwt.verify(token, JWT_SECRET) as any;\n            req.user = {\n                id: decoded.id,\n                email: decoded.email,\n                role: decoded.role || 'user'\n            };\n        }\n\n        next();\n    } catch (error) {\n        next();\n    }\n};\n\nexport const generateToken = (userId: string, email: string, role: string = 'user'): string => {\n    return jwt.sign({ id: userId, email, role }, JWT_SECRET, { expiresIn: '7d' });\n};\n"],"mappings":"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","ignoreList":[]}