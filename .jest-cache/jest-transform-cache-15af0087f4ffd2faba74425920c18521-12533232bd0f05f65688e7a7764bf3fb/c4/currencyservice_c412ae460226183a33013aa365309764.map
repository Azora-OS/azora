{"version":3,"names":["cov_24770iunk2","actualCoverage","prisma","logger","Joi","COUNTRY_CURRENCY_MAP","s","US","GB","CA","AU","IN","ZA","NG","KE","GH","EG","BR","MX","DE","FR","IT","ES","JP","CN","SG","MY","TH","PH","ID","VN","PK","BD","COUNTRY_PRICE_MULTIPLIERS","countryPricingSchema","object","pricingTierId","string","required","countryCode","length","uppercase","currency","monthlyPrice","number","min","studentDiscount","max","default","CurrencyService","getCurrencyForCountry","f","b","toUpperCase","calculateLocalizedPrice","basePrice","multiplier","Math","round","createCountryPricing","data","error","value","validate","Error","message","existingPricing","countryPricing","findUnique","where","pricingTierId_countryCode","pricing","create","info","Number","getCountryPricing","getAllCountryPricing","findMany","map","p","updateCountryPricing","updateSchema","update","undefined","initializeCountryPricing","countries","Object","keys","localizedPrice","getLocalizedPricing","tierName","pricingService","tier","getTierByName","id","originalPrice","studentPrice","calculateStudentPrice","savings","features","limits","discountAmount","currencyService"],"sources":["currency.service.ts"],"sourcesContent":["import { prisma } from '../index';\nimport { CountryPricing, LocalizedPricing } from '../types';\nimport { logger } from '../utils/logger';\nimport Joi from 'joi';\n\n// Country to currency mapping\nconst COUNTRY_CURRENCY_MAP: Record<string, string> = {\n  US: 'USD',\n  GB: 'GBP',\n  CA: 'CAD',\n  AU: 'AUD',\n  IN: 'INR',\n  ZA: 'ZAR',\n  NG: 'NGN',\n  KE: 'KES',\n  GH: 'GHS',\n  EG: 'EGP',\n  BR: 'BRL',\n  MX: 'MXN',\n  DE: 'EUR',\n  FR: 'EUR',\n  IT: 'EUR',\n  ES: 'EUR',\n  JP: 'JPY',\n  CN: 'CNY',\n  SG: 'SGD',\n  MY: 'MYR',\n  TH: 'THB',\n  PH: 'PHP',\n  ID: 'IDR',\n  VN: 'VND',\n  PK: 'PKR',\n  BD: 'BDT',\n};\n\n// Default pricing multipliers by country (relative to USD)\nconst COUNTRY_PRICE_MULTIPLIERS: Record<string, number> = {\n  US: 1.0,\n  GB: 0.85,\n  CA: 1.35,\n  AU: 1.55,\n  IN: 0.012, // INR to USD conversion\n  ZA: 0.053,\n  NG: 0.0013,\n  KE: 0.0077,\n  GH: 0.065,\n  EG: 0.032,\n  BR: 0.2,\n  MX: 0.058,\n  DE: 0.92,\n  FR: 0.92,\n  IT: 0.92,\n  ES: 0.92,\n  JP: 0.0067,\n  CN: 0.14,\n  SG: 0.74,\n  MY: 0.21,\n  TH: 0.028,\n  PH: 0.018,\n  ID: 0.000063,\n  VN: 0.000039,\n  PK: 0.0036,\n  BD: 0.0095,\n};\n\nconst countryPricingSchema = Joi.object({\n  pricingTierId: Joi.string().required(),\n  countryCode: Joi.string().length(2).uppercase().required(),\n  currency: Joi.string().length(3).uppercase().required(),\n  monthlyPrice: Joi.number().min(0).required(),\n  studentDiscount: Joi.number().min(0).max(100).default(0),\n});\n\nexport class CurrencyService {\n  /**\n   * Get currency for a country\n   */\n  getCurrencyForCountry(countryCode: string): string {\n    return COUNTRY_CURRENCY_MAP[countryCode.toUpperCase()] || 'USD';\n  }\n\n  /**\n   * Calculate localized price for a country\n   */\n  calculateLocalizedPrice(basePrice: number, countryCode: string): number {\n    const multiplier = COUNTRY_PRICE_MULTIPLIERS[countryCode.toUpperCase()] || 1.0;\n    return Math.round(basePrice * multiplier * 100) / 100;\n  }\n\n  /**\n   * Create country-specific pricing\n   */\n  async createCountryPricing(data: any): Promise<CountryPricing> {\n    try {\n      const { error, value } = countryPricingSchema.validate(data);\n      if (error) {\n        throw new Error(`Validation error: ${error.message}`);\n      }\n\n      // Check if pricing already exists for this country\n      const existingPricing = await prisma.countryPricing.findUnique({\n        where: {\n          pricingTierId_countryCode: {\n            pricingTierId: value.pricingTierId,\n            countryCode: value.countryCode,\n          },\n        },\n      });\n\n      if (existingPricing) {\n        throw new Error(\n          `Pricing already exists for tier ${value.pricingTierId} in country ${value.countryCode}`\n        );\n      }\n\n      const pricing = await prisma.countryPricing.create({\n        data: {\n          pricingTierId: value.pricingTierId,\n          countryCode: value.countryCode.toUpperCase(),\n          currency: value.currency.toUpperCase(),\n          monthlyPrice: value.monthlyPrice,\n          studentDiscount: value.studentDiscount,\n        },\n      });\n\n      logger.info(\n        `Country pricing created: ${value.countryCode} - ${value.currency} ${value.monthlyPrice}`\n      );\n      return {\n        ...pricing,\n        monthlyPrice: Number(pricing.monthlyPrice),\n      } as CountryPricing;\n    } catch (error) {\n      logger.error('Error creating country pricing:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get pricing for a specific country and tier\n   */\n  async getCountryPricing(\n    pricingTierId: string,\n    countryCode: string\n  ): Promise<CountryPricing | null> {\n    try {\n      const pricing = await prisma.countryPricing.findUnique({\n        where: {\n          pricingTierId_countryCode: {\n            pricingTierId,\n            countryCode: countryCode.toUpperCase(),\n          },\n        },\n      });\n\n      return pricing\n        ? ({\n            ...pricing,\n            monthlyPrice: Number(pricing.monthlyPrice),\n          } as CountryPricing)\n        : null;\n    } catch (error) {\n      logger.error(`Error getting country pricing for ${countryCode}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get all country pricing for a tier\n   */\n  async getAllCountryPricing(pricingTierId: string): Promise<CountryPricing[]> {\n    try {\n      const pricing = await prisma.countryPricing.findMany({\n        where: { pricingTierId },\n      });\n\n      return pricing.map((p: any) => ({\n        ...p,\n        monthlyPrice: Number(p.monthlyPrice),\n      })) as CountryPricing[];\n    } catch (error) {\n      logger.error(`Error getting all country pricing for tier ${pricingTierId}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Update country pricing\n   */\n  async updateCountryPricing(\n    pricingTierId: string,\n    countryCode: string,\n    data: any\n  ): Promise<CountryPricing> {\n    try {\n      const updateSchema = Joi.object({\n        monthlyPrice: Joi.number().min(0),\n        studentDiscount: Joi.number().min(0).max(100),\n        currency: Joi.string().length(3).uppercase(),\n      });\n\n      const { error, value } = updateSchema.validate(data);\n      if (error) {\n        throw new Error(`Validation error: ${error.message}`);\n      }\n\n      const pricing = await prisma.countryPricing.update({\n        where: {\n          pricingTierId_countryCode: {\n            pricingTierId,\n            countryCode: countryCode.toUpperCase(),\n          },\n        },\n        data: {\n          ...(value.monthlyPrice !== undefined && { monthlyPrice: value.monthlyPrice }),\n          ...(value.studentDiscount !== undefined && { studentDiscount: value.studentDiscount }),\n          ...(value.currency && { currency: value.currency.toUpperCase() }),\n        },\n      });\n\n      logger.info(`Country pricing updated: ${countryCode}`);\n      return {\n        ...pricing,\n        monthlyPrice: Number(pricing.monthlyPrice),\n      } as CountryPricing;\n    } catch (error) {\n      logger.error(`Error updating country pricing for ${countryCode}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Initialize country pricing for all tiers\n   */\n  async initializeCountryPricing(pricingTierId: string, basePrice: number): Promise<void> {\n    try {\n      const countries = Object.keys(COUNTRY_CURRENCY_MAP);\n\n      for (const countryCode of countries) {\n        const existingPricing = await prisma.countryPricing.findUnique({\n          where: {\n            pricingTierId_countryCode: {\n              pricingTierId,\n              countryCode,\n            },\n          },\n        });\n\n        if (!existingPricing) {\n          const localizedPrice = this.calculateLocalizedPrice(basePrice, countryCode);\n          const currency = this.getCurrencyForCountry(countryCode);\n\n          await prisma.countryPricing.create({\n            data: {\n              pricingTierId,\n              countryCode,\n              currency,\n              monthlyPrice: localizedPrice,\n              studentDiscount: 0,\n            },\n          });\n        }\n      }\n\n      logger.info(`Country pricing initialized for tier ${pricingTierId}`);\n    } catch (error) {\n      logger.error('Error initializing country pricing:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get localized pricing for a student\n   */\n  async getLocalizedPricing(\n    tierName: string,\n    countryCode: string,\n    pricingService: any\n  ): Promise<LocalizedPricing | null> {\n    try {\n      const tier = await pricingService.getTierByName(tierName);\n      if (!tier) {\n        return null;\n      }\n\n      const countryPricing = await this.getCountryPricing(tier.id, countryCode);\n\n      if (!countryPricing) {\n        // Fallback to calculated pricing if not explicitly set\n        const localizedPrice = this.calculateLocalizedPrice(tier.monthlyPrice, countryCode);\n        const currency = this.getCurrencyForCountry(countryCode);\n\n        return {\n          tier: tierName,\n          countryCode: countryCode.toUpperCase(),\n          currency,\n          originalPrice: localizedPrice,\n          studentDiscount: tier.studentDiscount,\n          studentPrice: this.calculateStudentPrice(localizedPrice, tier.studentDiscount),\n          savings: localizedPrice - this.calculateStudentPrice(localizedPrice, tier.studentDiscount),\n          features: tier.features,\n          limits: tier.limits,\n        };\n      }\n\n      return {\n        tier: tierName,\n        countryCode: countryPricing.countryCode,\n        currency: countryPricing.currency,\n        originalPrice: Number(countryPricing.monthlyPrice),\n        studentDiscount: countryPricing.studentDiscount,\n        studentPrice: this.calculateStudentPrice(\n          Number(countryPricing.monthlyPrice),\n          countryPricing.studentDiscount\n        ),\n        savings:\n          Number(countryPricing.monthlyPrice) -\n          this.calculateStudentPrice(\n            Number(countryPricing.monthlyPrice),\n            countryPricing.studentDiscount\n          ),\n        features: tier.features,\n        limits: tier.limits,\n      };\n    } catch (error) {\n      logger.error(`Error getting localized pricing for ${countryCode}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Calculate student price with discount\n   */\n  private calculateStudentPrice(monthlyPrice: number, studentDiscount: number): number {\n    const discountAmount = (monthlyPrice * studentDiscount) / 100;\n    return Math.round((monthlyPrice - discountAmount) * 100) / 100;\n  }\n}\n\nexport const currencyService = new CurrencyService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}