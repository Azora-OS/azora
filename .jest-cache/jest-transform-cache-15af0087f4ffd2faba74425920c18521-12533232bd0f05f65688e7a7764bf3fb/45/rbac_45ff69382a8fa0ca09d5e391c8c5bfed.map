{"version":3,"names":["cov_1k1q4z9y6m","actualCoverage","ROLES","s","ADMIN","INSTRUCTOR","STUDENT","GUEST","PERMISSIONS","hasPermission","role","permission","f","allowedRoles","b","includes","requireRole","req","res","next","user","status","json","error","required","current","requirePermission","module","exports"],"sources":["rbac.js"],"sourcesContent":["const ROLES = {\n  ADMIN: 'admin',\n  INSTRUCTOR: 'instructor',\n  STUDENT: 'student',\n  GUEST: 'guest'\n};\n\nconst PERMISSIONS = {\n  // User management\n  'users:read': [ROLES.ADMIN, ROLES.INSTRUCTOR],\n  'users:write': [ROLES.ADMIN],\n  'users:delete': [ROLES.ADMIN],\n  \n  // Course management\n  'courses:read': [ROLES.ADMIN, ROLES.INSTRUCTOR, ROLES.STUDENT],\n  'courses:write': [ROLES.ADMIN, ROLES.INSTRUCTOR],\n  'courses:delete': [ROLES.ADMIN],\n  \n  // Content management\n  'content:read': [ROLES.ADMIN, ROLES.INSTRUCTOR, ROLES.STUDENT],\n  'content:write': [ROLES.ADMIN, ROLES.INSTRUCTOR],\n  'content:delete': [ROLES.ADMIN, ROLES.INSTRUCTOR],\n  \n  // Assessment management\n  'assessments:read': [ROLES.ADMIN, ROLES.INSTRUCTOR, ROLES.STUDENT],\n  'assessments:write': [ROLES.ADMIN, ROLES.INSTRUCTOR],\n  'assessments:grade': [ROLES.ADMIN, ROLES.INSTRUCTOR],\n  \n  // Financial operations\n  'payments:read': [ROLES.ADMIN, ROLES.STUDENT],\n  'payments:write': [ROLES.ADMIN],\n  'payments:refund': [ROLES.ADMIN],\n  \n  // System administration\n  'system:read': [ROLES.ADMIN],\n  'system:write': [ROLES.ADMIN],\n  'system:configure': [ROLES.ADMIN]\n};\n\nfunction hasPermission(role, permission) {\n  const allowedRoles = PERMISSIONS[permission];\n  return allowedRoles && allowedRoles.includes(role);\n}\n\nfunction requireRole(...allowedRoles) {\n  return (req, res, next) => {\n    if (!req.user || !req.user.role) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    if (!allowedRoles.includes(req.user.role)) {\n      return res.status(403).json({ \n        error: 'Insufficient permissions',\n        required: allowedRoles,\n        current: req.user.role\n      });\n    }\n\n    next();\n  };\n}\n\nfunction requirePermission(permission) {\n  return (req, res, next) => {\n    if (!req.user || !req.user.role) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    if (!hasPermission(req.user.role, permission)) {\n      return res.status(403).json({ \n        error: 'Insufficient permissions',\n        required: permission,\n        role: req.user.role\n      });\n    }\n\n    next();\n  };\n}\n\nmodule.exports = {\n  ROLES,\n  PERMISSIONS,\n  hasPermission,\n  requireRole,\n  requirePermission\n};\n"],"mappings":"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","ignoreList":[]}