{"version":3,"names":["cov_2352z61wah","actualCoverage","express","s","require","router","Router","generateAccessToken","verifyToken","revokeToken","post","req","res","f","refreshToken","body","b","status","json","error","decoded","newAccessToken","userId","email","role","success","accessToken","err","authHeader","headers","token","split","message","module","exports"],"sources":["token.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst { generateAccessToken, verifyToken, revokeToken } = require('../middleware/jwt');\n\n// Token refresh endpoint\nrouter.post('/refresh', async (req, res) => {\n  const { refreshToken } = req.body;\n\n  if (!refreshToken) {\n    return res.status(400).json({ error: 'Refresh token required' });\n  }\n\n  try {\n    const decoded = verifyToken(refreshToken);\n    \n    const newAccessToken = generateAccessToken({\n      userId: decoded.userId,\n      email: decoded.email,\n      role: decoded.role\n    });\n\n    res.json({\n      success: true,\n      accessToken: newAccessToken\n    });\n  } catch (err) {\n    res.status(403).json({ error: 'Invalid refresh token' });\n  }\n});\n\n// Token revocation endpoint\nrouter.post('/revoke', async (req, res) => {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    return res.status(400).json({ error: 'Token required' });\n  }\n\n  try {\n    revokeToken(token);\n    res.json({ success: true, message: 'Token revoked successfully' });\n  } catch (err) {\n    res.status(500).json({ error: 'Token revocation failed' });\n  }\n});\n\n// Logout endpoint (revokes both access and refresh tokens)\nrouter.post('/logout', async (req, res) => {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n  const { refreshToken } = req.body;\n\n  try {\n    if (token) revokeToken(token);\n    if (refreshToken) revokeToken(refreshToken);\n    \n    res.json({ success: true, message: 'Logged out successfully' });\n  } catch (err) {\n    res.status(500).json({ error: 'Logout failed' });\n  }\n});\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}