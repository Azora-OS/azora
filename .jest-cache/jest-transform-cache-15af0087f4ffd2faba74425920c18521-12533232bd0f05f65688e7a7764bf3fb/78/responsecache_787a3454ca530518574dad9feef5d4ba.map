{"version":3,"names":["cov_77x6e8ig2","actualCoverage","getRedisConnectionManager","ResponseCache","constructor","config","b","f","manager","s","redis","getInstance","keyPrefix","defaultTTL","maxCacheSize","getCacheKey","queryHash","getStatsKey","get","key","data","hincrby","entry","JSON","parse","hitCount","ttl","expire","error","console","set","currentSize","getCacheSize","evictOldest","stringify","delete","deleted","del","clear","pattern","keys","length","invalidate","fullPattern","getStats","redisStats","hgetall","hits","parseInt","misses","size","totalResponseTime","requestCount","total","hitRate","averageResponseTime","getCacheHitRate","stats","oldestKey","minTTL","slice","cleanup","cleaned","exportMetrics","timestamp","Date","toISOString","cache","toFixed","cacheService","getResponseCache"],"sources":["response-cache.ts"],"sourcesContent":["/**\n * Response Cache Service for AI Routing\n * Implements get/set operations, TTL management, and cache invalidation\n */\n\nimport { Redis } from 'ioredis';\nimport { CacheEntry, RoutingTier } from './types';\nimport { getRedisConnectionManager } from './redis-connection';\n\nexport interface CacheServiceConfig {\n  keyPrefix: string;\n  defaultTTL: number;\n  maxCacheSize: number;\n}\n\nexport interface CacheStats {\n  hits: number;\n  misses: number;\n  size: number;\n  hitRate: number;\n  averageResponseTime: number;\n}\n\nexport class ResponseCache {\n  private redis: Redis;\n  private config: CacheServiceConfig;\n\n  constructor(config: Partial<CacheServiceConfig> = {}) {\n    const manager = getRedisConnectionManager();\n    this.redis = manager.getInstance();\n\n    this.config = {\n      keyPrefix: 'ai-routing:cache:',\n      defaultTTL: 3600,\n      maxCacheSize: 100000,\n      ...config\n    };\n  }\n\n  /**\n   * Generate cache key\n   */\n  private getCacheKey(queryHash: string): string {\n    return `${this.config.keyPrefix}${queryHash}`;\n  }\n\n  /**\n   * Get stats key\n   */\n  private getStatsKey(): string {\n    return `${this.config.keyPrefix}stats`;\n  }\n\n  /**\n   * Get cache entry by query hash\n   */\n  async get(queryHash: string): Promise<CacheEntry | null> {\n    try {\n      const key = this.getCacheKey(queryHash);\n      const data = await this.redis.get(key);\n\n      if (!data) {\n        await this.redis.hincrby(this.getStatsKey(), 'misses', 1);\n        return null;\n      }\n\n      await this.redis.hincrby(this.getStatsKey(), 'hits', 1);\n      const entry = JSON.parse(data) as CacheEntry;\n\n      entry.hitCount += 1;\n      const ttl = entry.ttl || this.config.defaultTTL;\n      await this.redis.expire(key, ttl);\n\n      return entry;\n    } catch (error) {\n      console.error('Error retrieving from cache:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Store cache entry\n   */\n  async set(entry: CacheEntry): Promise<void> {\n    try {\n      const currentSize = await this.getCacheSize();\n      if (currentSize >= this.config.maxCacheSize) {\n        await this.evictOldest();\n      }\n\n      const key = this.getCacheKey(entry.queryHash);\n      const ttl = entry.ttl || this.config.defaultTTL;\n\n      await this.redis.set(\n        key,\n        JSON.stringify(entry),\n        'EX',\n        ttl\n      );\n\n      await this.redis.hincrby(this.getStatsKey(), 'size', 1);\n    } catch (error) {\n      console.error('Error storing in cache:', error);\n    }\n  }\n\n  /**\n   * Delete cache entry\n   */\n  async delete(queryHash: string): Promise<boolean> {\n    try {\n      const key = this.getCacheKey(queryHash);\n      const deleted = await this.redis.del(key);\n\n      if (deleted > 0) {\n        await this.redis.hincrby(this.getStatsKey(), 'size', -1);\n        return true;\n      }\n\n      return false;\n    } catch (error) {\n      console.error('Error deleting from cache:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Clear all cache entries\n   */\n  async clear(): Promise<number> {\n    try {\n      const pattern = `${this.config.keyPrefix}*`;\n      const keys = await this.redis.keys(pattern);\n\n      if (keys.length > 0) {\n        await this.redis.del(...keys);\n      }\n\n      await this.redis.del(this.getStatsKey());\n      return keys.length;\n    } catch (error) {\n      console.error('Error clearing cache:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Invalidate cache by pattern\n   */\n  async invalidate(pattern: string): Promise<number> {\n    try {\n      const fullPattern = `${this.config.keyPrefix}${pattern}`;\n      const keys = await this.redis.keys(fullPattern);\n\n      if (keys.length > 0) {\n        await this.redis.del(...keys);\n        await this.redis.hincrby(this.getStatsKey(), 'size', -keys.length);\n      }\n\n      return keys.length;\n    } catch (error) {\n      console.error('Error invalidating cache:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  async getStats(): Promise<CacheStats> {\n    try {\n      const redisStats = await this.redis.hgetall(this.getStatsKey());\n      const hits = parseInt(redisStats.hits || '0', 10);\n      const misses = parseInt(redisStats.misses || '0', 10);\n      const size = parseInt(redisStats.size || '0', 10);\n      const totalResponseTime = parseInt(redisStats.totalResponseTime || '0', 10);\n      const requestCount = parseInt(redisStats.requestCount || '0', 10);\n\n      const total = hits + misses;\n      const hitRate = total > 0 ? (hits / total) * 100 : 0;\n      const averageResponseTime = requestCount > 0 ? totalResponseTime / requestCount : 0;\n\n      return {\n        hits,\n        misses,\n        size,\n        hitRate,\n        averageResponseTime\n      };\n    } catch (error) {\n      console.error('Error getting cache stats:', error);\n      return {\n        hits: 0,\n        misses: 0,\n        size: 0,\n        hitRate: 0,\n        averageResponseTime: 0\n      };\n    }\n  }\n\n  /**\n   * Get cache hit rate\n   */\n  async getCacheHitRate(): Promise<number> {\n    const stats = await this.getStats();\n    return stats.hitRate;\n  }\n\n  /**\n   * Get current cache size\n   */\n  async getCacheSize(): Promise<number> {\n    try {\n      const pattern = `${this.config.keyPrefix}*`;\n      const keys = await this.redis.keys(pattern);\n      return keys.length;\n    } catch (error) {\n      console.error('Error getting cache size:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Evict oldest entries when cache is full\n   */\n  private async evictOldest(): Promise<void> {\n    try {\n      const pattern = `${this.config.keyPrefix}*`;\n      const keys = await this.redis.keys(pattern);\n\n      if (keys.length === 0) {return;}\n\n      let oldestKey = keys[0];\n      let minTTL = await this.redis.ttl(oldestKey);\n\n      for (const key of keys.slice(1)) {\n        const ttl = await this.redis.ttl(key);\n        if (ttl < minTTL) {\n          minTTL = ttl;\n          oldestKey = key;\n        }\n      }\n\n      await this.redis.del(oldestKey);\n      await this.redis.hincrby(this.getStatsKey(), 'size', -1);\n    } catch (error) {\n      console.error('Error evicting oldest cache entry:', error);\n    }\n  }\n\n  /**\n   * Cleanup expired entries\n   */\n  async cleanup(): Promise<number> {\n    try {\n      const pattern = `${this.config.keyPrefix}*`;\n      const keys = await this.redis.keys(pattern);\n      let cleaned = 0;\n\n      for (const key of keys) {\n        const ttl = await this.redis.ttl(key);\n        if (ttl === -1) {\n          await this.redis.del(key);\n          cleaned++;\n        }\n      }\n\n      if (cleaned > 0) {\n        await this.redis.hincrby(this.getStatsKey(), 'size', -cleaned);\n      }\n\n      return cleaned;\n    } catch (error) {\n      console.error('Error during cache cleanup:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Export cache metrics\n   */\n  async exportMetrics(): Promise<Record<string, any>> {\n    const stats = await this.getStats();\n    const size = await this.getCacheSize();\n\n    return {\n      timestamp: new Date().toISOString(),\n      cache: {\n        hits: stats.hits,\n        misses: stats.misses,\n        hitRate: stats.hitRate.toFixed(2) + '%',\n        size,\n        averageResponseTime: stats.averageResponseTime.toFixed(2) + 'ms'\n      }\n    };\n  }\n}\n\nlet cacheService: ResponseCache | null = null;\n\n/**\n * Get or create response cache service\n */\nexport function getResponseCache(config?: Partial<CacheServiceConfig>): ResponseCache {\n  if (!cacheService) {\n    cacheService = new ResponseCache(config);\n  }\n  return cacheService;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAfZ;AACA;AACA;AACA;;AAIA,SAASE,yBAAyB,QAAQ,oBAAoB;AAgB9D,OAAO,MAAMC,aAAa,CAAC;EAIzBC,WAAWA,CAACC,MAAmC;EAAA;EAAA,CAAAL,aAAA,GAAAM,CAAA,UAAG,CAAC,CAAC,GAAE;IAAA;IAAAN,aAAA,GAAAO,CAAA;IACpD,MAAMC,OAAO;IAAA;IAAA,CAAAR,aAAA,GAAAS,CAAA,OAAGP,yBAAyB,CAAC,CAAC;IAAC;IAAAF,aAAA,GAAAS,CAAA;IAC5C,IAAI,CAACC,KAAK,GAAGF,OAAO,CAACG,WAAW,CAAC,CAAC;IAAC;IAAAX,aAAA,GAAAS,CAAA;IAEnC,IAAI,CAACJ,MAAM,GAAG;MACZO,SAAS,EAAE,mBAAmB;MAC9BC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,MAAM;MACpB,GAAGT;IACL,CAAC;EACH;;EAEA;AACF;AACA;EACUU,WAAWA,CAACC,SAAiB,EAAU;IAAA;IAAAhB,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IAC7C,OAAO,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,GAAGI,SAAS,EAAE;EAC/C;;EAEA;AACF;AACA;EACUC,WAAWA,CAAA,EAAW;IAAA;IAAAjB,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IAC5B,OAAO,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,OAAO;EACxC;;EAEA;AACF;AACA;EACE,MAAMM,GAAGA,CAACF,SAAiB,EAA8B;IAAA;IAAAhB,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IACvD,IAAI;MACF,MAAMU,GAAG;MAAA;MAAA,CAAAnB,aAAA,GAAAS,CAAA,OAAG,IAAI,CAACM,WAAW,CAACC,SAAS,CAAC;MACvC,MAAMI,IAAI;MAAA;MAAA,CAAApB,aAAA,GAAAS,CAAA,OAAG,MAAM,IAAI,CAACC,KAAK,CAACQ,GAAG,CAACC,GAAG,CAAC;MAAC;MAAAnB,aAAA,GAAAS,CAAA;MAEvC,IAAI,CAACW,IAAI,EAAE;QAAA;QAAApB,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QACT,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;QAAC;QAAAjB,aAAA,GAAAS,CAAA;QAC1D,OAAO,IAAI;MACb,CAAC;MAAA;MAAA;QAAAT,aAAA,GAAAM,CAAA;MAAA;MAAAN,aAAA,GAAAS,CAAA;MAED,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;MACvD,MAAMK,KAAK;MAAA;MAAA,CAAAtB,aAAA,GAAAS,CAAA,QAAGc,IAAI,CAACC,KAAK,CAACJ,IAAI,CAAC,CAAc;MAAC;MAAApB,aAAA,GAAAS,CAAA;MAE7Ca,KAAK,CAACG,QAAQ,IAAI,CAAC;MACnB,MAAMC,GAAG;MAAA;MAAA,CAAA1B,aAAA,GAAAS,CAAA;MAAG;MAAA,CAAAT,aAAA,GAAAM,CAAA,UAAAgB,KAAK,CAACI,GAAG;MAAA;MAAA,CAAA1B,aAAA,GAAAM,CAAA,UAAI,IAAI,CAACD,MAAM,CAACQ,UAAU;MAAC;MAAAb,aAAA,GAAAS,CAAA;MAChD,MAAM,IAAI,CAACC,KAAK,CAACiB,MAAM,CAACR,GAAG,EAAEO,GAAG,CAAC;MAAC;MAAA1B,aAAA,GAAAS,CAAA;MAElC,OAAOa,KAAK;IACd,CAAC,CAAC,OAAOM,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MACrD,OAAO,IAAI;IACb;EACF;;EAEA;AACF;AACA;EACE,MAAMqB,GAAGA,CAACR,KAAiB,EAAiB;IAAA;IAAAtB,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IAC1C,IAAI;MACF,MAAMsB,WAAW;MAAA;MAAA,CAAA/B,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACuB,YAAY,CAAC,CAAC;MAAC;MAAAhC,aAAA,GAAAS,CAAA;MAC9C,IAAIsB,WAAW,IAAI,IAAI,CAAC1B,MAAM,CAACS,YAAY,EAAE;QAAA;QAAAd,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QAC3C,MAAM,IAAI,CAACwB,WAAW,CAAC,CAAC;MAC1B,CAAC;MAAA;MAAA;QAAAjC,aAAA,GAAAM,CAAA;MAAA;MAED,MAAMa,GAAG;MAAA;MAAA,CAAAnB,aAAA,GAAAS,CAAA,QAAG,IAAI,CAACM,WAAW,CAACO,KAAK,CAACN,SAAS,CAAC;MAC7C,MAAMU,GAAG;MAAA;MAAA,CAAA1B,aAAA,GAAAS,CAAA;MAAG;MAAA,CAAAT,aAAA,GAAAM,CAAA,UAAAgB,KAAK,CAACI,GAAG;MAAA;MAAA,CAAA1B,aAAA,GAAAM,CAAA,UAAI,IAAI,CAACD,MAAM,CAACQ,UAAU;MAAC;MAAAb,aAAA,GAAAS,CAAA;MAEhD,MAAM,IAAI,CAACC,KAAK,CAACoB,GAAG,CAClBX,GAAG,EACHI,IAAI,CAACW,SAAS,CAACZ,KAAK,CAAC,EACrB,IAAI,EACJI,GACF,CAAC;MAAC;MAAA1B,aAAA,GAAAS,CAAA;MAEF,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;IACzD,CAAC,CAAC,OAAOW,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IACjD;EACF;;EAEA;AACF;AACA;EACE,MAAMO,MAAMA,CAACnB,SAAiB,EAAoB;IAAA;IAAAhB,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IAChD,IAAI;MACF,MAAMU,GAAG;MAAA;MAAA,CAAAnB,aAAA,GAAAS,CAAA,QAAG,IAAI,CAACM,WAAW,CAACC,SAAS,CAAC;MACvC,MAAMoB,OAAO;MAAA;MAAA,CAAApC,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAAC2B,GAAG,CAAClB,GAAG,CAAC;MAAC;MAAAnB,aAAA,GAAAS,CAAA;MAE1C,IAAI2B,OAAO,GAAG,CAAC,EAAE;QAAA;QAAApC,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QACf,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;QAAC;QAAAjB,aAAA,GAAAS,CAAA;QACzD,OAAO,IAAI;MACb,CAAC;MAAA;MAAA;QAAAT,aAAA,GAAAM,CAAA;MAAA;MAAAN,aAAA,GAAAS,CAAA;MAED,OAAO,KAAK;IACd,CAAC,CAAC,OAAOmB,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MACnD,OAAO,KAAK;IACd;EACF;;EAEA;AACF;AACA;EACE,MAAM6B,KAAKA,CAAA,EAAoB;IAAA;IAAAtC,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IAC7B,IAAI;MACF,MAAM8B,OAAO;MAAA;MAAA,CAAAvC,aAAA,GAAAS,CAAA,QAAG,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,GAAG;MAC3C,MAAM4B,IAAI;MAAA;MAAA,CAAAxC,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAAC8B,IAAI,CAACD,OAAO,CAAC;MAAC;MAAAvC,aAAA,GAAAS,CAAA;MAE5C,IAAI+B,IAAI,CAACC,MAAM,GAAG,CAAC,EAAE;QAAA;QAAAzC,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QACnB,MAAM,IAAI,CAACC,KAAK,CAAC2B,GAAG,CAAC,GAAGG,IAAI,CAAC;MAC/B,CAAC;MAAA;MAAA;QAAAxC,aAAA,GAAAM,CAAA;MAAA;MAAAN,aAAA,GAAAS,CAAA;MAED,MAAM,IAAI,CAACC,KAAK,CAAC2B,GAAG,CAAC,IAAI,CAACpB,WAAW,CAAC,CAAC,CAAC;MAAC;MAAAjB,aAAA,GAAAS,CAAA;MACzC,OAAO+B,IAAI,CAACC,MAAM;IACpB,CAAC,CAAC,OAAOb,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MAC9C,OAAO,CAAC;IACV;EACF;;EAEA;AACF;AACA;EACE,MAAMiC,UAAUA,CAACH,OAAe,EAAmB;IAAA;IAAAvC,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IACjD,IAAI;MACF,MAAMkC,WAAW;MAAA;MAAA,CAAA3C,aAAA,GAAAS,CAAA,QAAG,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,GAAG2B,OAAO,EAAE;MACxD,MAAMC,IAAI;MAAA;MAAA,CAAAxC,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAAC8B,IAAI,CAACG,WAAW,CAAC;MAAC;MAAA3C,aAAA,GAAAS,CAAA;MAEhD,IAAI+B,IAAI,CAACC,MAAM,GAAG,CAAC,EAAE;QAAA;QAAAzC,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QACnB,MAAM,IAAI,CAACC,KAAK,CAAC2B,GAAG,CAAC,GAAGG,IAAI,CAAC;QAAC;QAAAxC,aAAA,GAAAS,CAAA;QAC9B,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,MAAM,EAAE,CAACuB,IAAI,CAACC,MAAM,CAAC;MACpE,CAAC;MAAA;MAAA;QAAAzC,aAAA,GAAAM,CAAA;MAAA;MAAAN,aAAA,GAAAS,CAAA;MAED,OAAO+B,IAAI,CAACC,MAAM;IACpB,CAAC,CAAC,OAAOb,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MAClD,OAAO,CAAC;IACV;EACF;;EAEA;AACF;AACA;EACE,MAAMmC,QAAQA,CAAA,EAAwB;IAAA;IAAA5C,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IACpC,IAAI;MACF,MAAMoC,UAAU;MAAA;MAAA,CAAA7C,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAACoC,OAAO,CAAC,IAAI,CAAC7B,WAAW,CAAC,CAAC,CAAC;MAC/D,MAAM8B,IAAI;MAAA;MAAA,CAAA/C,aAAA,GAAAS,CAAA,QAAGuC,QAAQ;MAAC;MAAA,CAAAhD,aAAA,GAAAM,CAAA,UAAAuC,UAAU,CAACE,IAAI;MAAA;MAAA,CAAA/C,aAAA,GAAAM,CAAA,UAAI,GAAG,GAAE,EAAE,CAAC;MACjD,MAAM2C,MAAM;MAAA;MAAA,CAAAjD,aAAA,GAAAS,CAAA,QAAGuC,QAAQ;MAAC;MAAA,CAAAhD,aAAA,GAAAM,CAAA,UAAAuC,UAAU,CAACI,MAAM;MAAA;MAAA,CAAAjD,aAAA,GAAAM,CAAA,UAAI,GAAG,GAAE,EAAE,CAAC;MACrD,MAAM4C,IAAI;MAAA;MAAA,CAAAlD,aAAA,GAAAS,CAAA,QAAGuC,QAAQ;MAAC;MAAA,CAAAhD,aAAA,GAAAM,CAAA,WAAAuC,UAAU,CAACK,IAAI;MAAA;MAAA,CAAAlD,aAAA,GAAAM,CAAA,WAAI,GAAG,GAAE,EAAE,CAAC;MACjD,MAAM6C,iBAAiB;MAAA;MAAA,CAAAnD,aAAA,GAAAS,CAAA,QAAGuC,QAAQ;MAAC;MAAA,CAAAhD,aAAA,GAAAM,CAAA,WAAAuC,UAAU,CAACM,iBAAiB;MAAA;MAAA,CAAAnD,aAAA,GAAAM,CAAA,WAAI,GAAG,GAAE,EAAE,CAAC;MAC3E,MAAM8C,YAAY;MAAA;MAAA,CAAApD,aAAA,GAAAS,CAAA,QAAGuC,QAAQ;MAAC;MAAA,CAAAhD,aAAA,GAAAM,CAAA,WAAAuC,UAAU,CAACO,YAAY;MAAA;MAAA,CAAApD,aAAA,GAAAM,CAAA,WAAI,GAAG,GAAE,EAAE,CAAC;MAEjE,MAAM+C,KAAK;MAAA;MAAA,CAAArD,aAAA,GAAAS,CAAA,QAAGsC,IAAI,GAAGE,MAAM;MAC3B,MAAMK,OAAO;MAAA;MAAA,CAAAtD,aAAA,GAAAS,CAAA,QAAG4C,KAAK,GAAG,CAAC;MAAA;MAAA,CAAArD,aAAA,GAAAM,CAAA,WAAIyC,IAAI,GAAGM,KAAK,GAAI,GAAG;MAAA;MAAA,CAAArD,aAAA,GAAAM,CAAA,WAAG,CAAC;MACpD,MAAMiD,mBAAmB;MAAA;MAAA,CAAAvD,aAAA,GAAAS,CAAA,QAAG2C,YAAY,GAAG,CAAC;MAAA;MAAA,CAAApD,aAAA,GAAAM,CAAA,WAAG6C,iBAAiB,GAAGC,YAAY;MAAA;MAAA,CAAApD,aAAA,GAAAM,CAAA,WAAG,CAAC;MAAC;MAAAN,aAAA,GAAAS,CAAA;MAEpF,OAAO;QACLsC,IAAI;QACJE,MAAM;QACNC,IAAI;QACJI,OAAO;QACPC;MACF,CAAC;IACH,CAAC,CAAC,OAAO3B,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MACnD,OAAO;QACLsC,IAAI,EAAE,CAAC;QACPE,MAAM,EAAE,CAAC;QACTC,IAAI,EAAE,CAAC;QACPI,OAAO,EAAE,CAAC;QACVC,mBAAmB,EAAE;MACvB,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE,MAAMC,eAAeA,CAAA,EAAoB;IAAA;IAAAxD,aAAA,GAAAO,CAAA;IACvC,MAAMkD,KAAK;IAAA;IAAA,CAAAzD,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACmC,QAAQ,CAAC,CAAC;IAAC;IAAA5C,aAAA,GAAAS,CAAA;IACpC,OAAOgD,KAAK,CAACH,OAAO;EACtB;;EAEA;AACF;AACA;EACE,MAAMtB,YAAYA,CAAA,EAAoB;IAAA;IAAAhC,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IACpC,IAAI;MACF,MAAM8B,OAAO;MAAA;MAAA,CAAAvC,aAAA,GAAAS,CAAA,QAAG,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,GAAG;MAC3C,MAAM4B,IAAI;MAAA;MAAA,CAAAxC,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAAC8B,IAAI,CAACD,OAAO,CAAC;MAAC;MAAAvC,aAAA,GAAAS,CAAA;MAC5C,OAAO+B,IAAI,CAACC,MAAM;IACpB,CAAC,CAAC,OAAOb,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MAClD,OAAO,CAAC;IACV;EACF;;EAEA;AACF;AACA;EACE,MAAcwB,WAAWA,CAAA,EAAkB;IAAA;IAAAjC,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IACzC,IAAI;MACF,MAAM8B,OAAO;MAAA;MAAA,CAAAvC,aAAA,GAAAS,CAAA,QAAG,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,GAAG;MAC3C,MAAM4B,IAAI;MAAA;MAAA,CAAAxC,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAAC8B,IAAI,CAACD,OAAO,CAAC;MAAC;MAAAvC,aAAA,GAAAS,CAAA;MAE5C,IAAI+B,IAAI,CAACC,MAAM,KAAK,CAAC,EAAE;QAAA;QAAAzC,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QAAC;MAAO,CAAC;MAAA;MAAA;QAAAT,aAAA,GAAAM,CAAA;MAAA;MAEhC,IAAIoD,SAAS;MAAA;MAAA,CAAA1D,aAAA,GAAAS,CAAA,QAAG+B,IAAI,CAAC,CAAC,CAAC;MACvB,IAAImB,MAAM;MAAA;MAAA,CAAA3D,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAACgB,GAAG,CAACgC,SAAS,CAAC;MAAC;MAAA1D,aAAA,GAAAS,CAAA;MAE7C,KAAK,MAAMU,GAAG,IAAIqB,IAAI,CAACoB,KAAK,CAAC,CAAC,CAAC,EAAE;QAC/B,MAAMlC,GAAG;QAAA;QAAA,CAAA1B,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAACgB,GAAG,CAACP,GAAG,CAAC;QAAC;QAAAnB,aAAA,GAAAS,CAAA;QACtC,IAAIiB,GAAG,GAAGiC,MAAM,EAAE;UAAA;UAAA3D,aAAA,GAAAM,CAAA;UAAAN,aAAA,GAAAS,CAAA;UAChBkD,MAAM,GAAGjC,GAAG;UAAC;UAAA1B,aAAA,GAAAS,CAAA;UACbiD,SAAS,GAAGvC,GAAG;QACjB,CAAC;QAAA;QAAA;UAAAnB,aAAA,GAAAM,CAAA;QAAA;MACH;MAAC;MAAAN,aAAA,GAAAS,CAAA;MAED,MAAM,IAAI,CAACC,KAAK,CAAC2B,GAAG,CAACqB,SAAS,CAAC;MAAC;MAAA1D,aAAA,GAAAS,CAAA;MAChC,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;IAC1D,CAAC,CAAC,OAAOW,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC5D;EACF;;EAEA;AACF;AACA;EACE,MAAMiC,OAAOA,CAAA,EAAoB;IAAA;IAAA7D,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAS,CAAA;IAC/B,IAAI;MACF,MAAM8B,OAAO;MAAA;MAAA,CAAAvC,aAAA,GAAAS,CAAA,QAAG,GAAG,IAAI,CAACJ,MAAM,CAACO,SAAS,GAAG;MAC3C,MAAM4B,IAAI;MAAA;MAAA,CAAAxC,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAAC8B,IAAI,CAACD,OAAO,CAAC;MAC3C,IAAIuB,OAAO;MAAA;MAAA,CAAA9D,aAAA,GAAAS,CAAA,QAAG,CAAC;MAAC;MAAAT,aAAA,GAAAS,CAAA;MAEhB,KAAK,MAAMU,GAAG,IAAIqB,IAAI,EAAE;QACtB,MAAMd,GAAG;QAAA;QAAA,CAAA1B,aAAA,GAAAS,CAAA,QAAG,MAAM,IAAI,CAACC,KAAK,CAACgB,GAAG,CAACP,GAAG,CAAC;QAAC;QAAAnB,aAAA,GAAAS,CAAA;QACtC,IAAIiB,GAAG,KAAK,CAAC,CAAC,EAAE;UAAA;UAAA1B,aAAA,GAAAM,CAAA;UAAAN,aAAA,GAAAS,CAAA;UACd,MAAM,IAAI,CAACC,KAAK,CAAC2B,GAAG,CAAClB,GAAG,CAAC;UAAC;UAAAnB,aAAA,GAAAS,CAAA;UAC1BqD,OAAO,EAAE;QACX,CAAC;QAAA;QAAA;UAAA9D,aAAA,GAAAM,CAAA;QAAA;MACH;MAAC;MAAAN,aAAA,GAAAS,CAAA;MAED,IAAIqD,OAAO,GAAG,CAAC,EAAE;QAAA;QAAA9D,aAAA,GAAAM,CAAA;QAAAN,aAAA,GAAAS,CAAA;QACf,MAAM,IAAI,CAACC,KAAK,CAACW,OAAO,CAAC,IAAI,CAACJ,WAAW,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC6C,OAAO,CAAC;MAChE,CAAC;MAAA;MAAA;QAAA9D,aAAA,GAAAM,CAAA;MAAA;MAAAN,aAAA,GAAAS,CAAA;MAED,OAAOqD,OAAO;IAChB,CAAC,CAAC,OAAOlC,KAAK,EAAE;MAAA;MAAA5B,aAAA,GAAAS,CAAA;MACdoB,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MAAC;MAAA5B,aAAA,GAAAS,CAAA;MACpD,OAAO,CAAC;IACV;EACF;;EAEA;AACF;AACA;EACE,MAAMsD,aAAaA,CAAA,EAAiC;IAAA;IAAA/D,aAAA,GAAAO,CAAA;IAClD,MAAMkD,KAAK;IAAA;IAAA,CAAAzD,aAAA,GAAAS,CAAA,SAAG,MAAM,IAAI,CAACmC,QAAQ,CAAC,CAAC;IACnC,MAAMM,IAAI;IAAA;IAAA,CAAAlD,aAAA,GAAAS,CAAA,SAAG,MAAM,IAAI,CAACuB,YAAY,CAAC,CAAC;IAAC;IAAAhC,aAAA,GAAAS,CAAA;IAEvC,OAAO;MACLuD,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACnCC,KAAK,EAAE;QACLpB,IAAI,EAAEU,KAAK,CAACV,IAAI;QAChBE,MAAM,EAAEQ,KAAK,CAACR,MAAM;QACpBK,OAAO,EAAEG,KAAK,CAACH,OAAO,CAACc,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG;QACvClB,IAAI;QACJK,mBAAmB,EAAEE,KAAK,CAACF,mBAAmB,CAACa,OAAO,CAAC,CAAC,CAAC,GAAG;MAC9D;IACF,CAAC;EACH;AACF;AAEA,IAAIC,YAAkC;AAAA;AAAA,CAAArE,aAAA,GAAAS,CAAA,SAAG,IAAI;;AAE7C;AACA;AACA;AACA,OAAO,SAAS6D,gBAAgBA,CAACjE,MAAoC,EAAiB;EAAA;EAAAL,aAAA,GAAAO,CAAA;EAAAP,aAAA,GAAAS,CAAA;EACpF,IAAI,CAAC4D,YAAY,EAAE;IAAA;IAAArE,aAAA,GAAAM,CAAA;IAAAN,aAAA,GAAAS,CAAA;IACjB4D,YAAY,GAAG,IAAIlE,aAAa,CAACE,MAAM,CAAC;EAC1C,CAAC;EAAA;EAAA;IAAAL,aAAA,GAAAM,CAAA;EAAA;EAAAN,aAAA,GAAAS,CAAA;EACD,OAAO4D,YAAY;AACrB","ignoreList":[]}