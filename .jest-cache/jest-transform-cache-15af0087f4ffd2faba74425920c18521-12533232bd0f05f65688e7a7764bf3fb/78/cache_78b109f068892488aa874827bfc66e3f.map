{"version":3,"names":["cov_16006dzva6","actualCoverage","redis","s","require","client","createClient","url","b","process","env","REDIS_URL","on","err","f","console","error","connect","catch","DEFAULT_TTL","get","key","value","JSON","parse","set","ttl","setEx","stringify","del","cacheMiddleware","req","res","next","method","path","query","cached","json","originalJson","bind","data","module","exports"],"sources":["cache.js"],"sourcesContent":["const redis = require('redis');\n\nconst client = redis.createClient({\n  url: process.env.REDIS_URL || 'redis://localhost:6379'\n});\n\nclient.on('error', (err) => console.error('Redis error:', err));\nclient.connect().catch(console.error);\n\nconst DEFAULT_TTL = 3600; // 1 hour\n\nasync function get(key) {\n  try {\n    const value = await client.get(key);\n    return value ? JSON.parse(value) : null;\n  } catch (err) {\n    console.error('Cache get error:', err);\n    return null;\n  }\n}\n\nasync function set(key, value, ttl = DEFAULT_TTL) {\n  try {\n    await client.setEx(key, ttl, JSON.stringify(value));\n  } catch (err) {\n    console.error('Cache set error:', err);\n  }\n}\n\nasync function del(key) {\n  try {\n    await client.del(key);\n  } catch (err) {\n    console.error('Cache delete error:', err);\n  }\n}\n\nfunction cacheMiddleware(ttl = DEFAULT_TTL) {\n  return async (req, res, next) => {\n    if (req.method !== 'GET') return next();\n    \n    const key = `cache:${req.path}:${JSON.stringify(req.query)}`;\n    const cached = await get(key);\n    \n    if (cached) {\n      return res.json(cached);\n    }\n    \n    const originalJson = res.json.bind(res);\n    res.json = (data) => {\n      set(key, data, ttl);\n      return originalJson(data);\n    };\n    \n    next();\n  };\n}\n\nmodule.exports = { get, set, del, cacheMiddleware };\n"],"mappings":"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","ignoreList":[]}