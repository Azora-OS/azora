{"version":3,"names":["cov_12yj34b0ew","actualCoverage","RoutingTier","CostOptimizer","tierCosts","s","Map","costMetrics","userSpending","constructor","prisma","f","initializeTierCosts","initializeCostMetrics","set","LOCAL_LLM","baseCost","costPerToken","costPerInputToken","minCost","maxCost","RAP_SYSTEM","EXTERNAL_LLM","tiers","tier","totalCost","totalQueries","averageCostPerQuery","Infinity","lastUpdated","Date","calculateCost","inputTokens","b","outputTokens","config","get","Error","cost","Math","max","min","round","trackSpending","userId","userMetrics","totalSpent","spentByTier","queriesByTier","tierMetrics","persistUserSpending","metrics","console","log","error","getUserSpending","getSpendingMetrics","result","entries","shouldRejectQuery","userBudget","undefined","getCheapestTier","costs","compareCosts","cheapestTier","lowestCost","Object","getTierSpending","getAverageCostPerQuery","getTotalCost","getTotalQueries","getTotalSpending","total","values","resetTierMetrics"],"sources":["cost-optimizer.ts"],"sourcesContent":["/**\n * Cost Optimizer\n * Manages cost calculation, tracking, and optimization for AI routing tiers\n * Implements cost-aware routing decisions and budget constraints\n */\n\nimport { PrismaClient } from '@prisma/client';\nimport { RoutingTier, ICostOptimizer } from './types';\n\n/**\n * Cost configuration per tier\n */\nexport interface TierCostConfig {\n  baseCost: number; // Base cost per query\n  costPerToken: number; // Cost per output token\n  costPerInputToken: number; // Cost per input token\n  minCost: number; // Minimum cost per query\n  maxCost: number; // Maximum cost per query\n}\n\n/**\n * Cost metrics for tracking\n */\nexport interface CostMetrics {\n  tier: RoutingTier;\n  totalCost: number;\n  totalQueries: number;\n  averageCostPerQuery: number;\n  minCost: number;\n  maxCost: number;\n  lastUpdated: Date;\n}\n\n/**\n * User spending metrics\n */\nexport interface UserSpendingMetrics {\n  userId: string;\n  totalSpent: number;\n  spentByTier: Record<RoutingTier, number>;\n  queriesByTier: Record<RoutingTier, number>;\n  monthlyBudget?: number;\n  remainingBudget?: number;\n  lastUpdated: Date;\n}\n\n/**\n * Cost Optimizer Implementation\n */\nexport class CostOptimizer implements ICostOptimizer {\n  private prisma: PrismaClient;\n  private tierCosts: Map<RoutingTier, TierCostConfig> = new Map();\n  private costMetrics: Map<RoutingTier, CostMetrics> = new Map();\n  private userSpending: Map<string, UserSpendingMetrics> = new Map();\n\n  constructor(prisma: PrismaClient) {\n    this.prisma = prisma;\n    this.initializeTierCosts();\n    this.initializeCostMetrics();\n  }\n\n  /**\n   * Initialize cost configuration for each tier\n   * Based on typical API pricing models\n   */\n  private initializeTierCosts(): void {\n    // Local LLM: No API cost, only infrastructure\n    this.tierCosts.set(RoutingTier.LOCAL_LLM, {\n      baseCost: 0,\n      costPerToken: 0,\n      costPerInputToken: 0,\n      minCost: 0,\n      maxCost: 0\n    });\n\n    // RAP System: Moderate cost (embedding + retrieval + external LLM)\n    // Typical: $0.0001 per input token, $0.0003 per output token\n    this.tierCosts.set(RoutingTier.RAP_SYSTEM, {\n      baseCost: 0.001, // $0.001 base for retrieval\n      costPerToken: 0.0003,\n      costPerInputToken: 0.0001,\n      minCost: 0.001,\n      maxCost: 0.05\n    });\n\n    // External LLM: Higher cost (GPT-4 or similar)\n    // Typical: $0.0003 per input token, $0.0006 per output token\n    this.tierCosts.set(RoutingTier.EXTERNAL_LLM, {\n      baseCost: 0.002,\n      costPerToken: 0.0006,\n      costPerInputToken: 0.0003,\n      minCost: 0.002,\n      maxCost: 0.10\n    });\n  }\n\n  /**\n   * Initialize cost metrics for each tier\n   */\n  private initializeCostMetrics(): void {\n    const tiers: RoutingTier[] = [\n      RoutingTier.LOCAL_LLM,\n      RoutingTier.RAP_SYSTEM,\n      RoutingTier.EXTERNAL_LLM\n    ];\n\n    for (const tier of tiers) {\n      this.costMetrics.set(tier, {\n        tier,\n        totalCost: 0,\n        totalQueries: 0,\n        averageCostPerQuery: 0,\n        minCost: Infinity,\n        maxCost: 0,\n        lastUpdated: new Date()\n      });\n    }\n  }\n\n  /**\n   * Calculate cost for a query based on tier and token counts\n   * @param tier - Routing tier\n   * @param inputTokens - Number of input tokens\n   * @param outputTokens - Number of output tokens\n   * @returns Calculated cost in dollars\n   */\n  async calculateCost(\n    tier: RoutingTier,\n    inputTokens: number = 0,\n    outputTokens: number = 0\n  ): Promise<number> {\n    const config = this.tierCosts.get(tier);\n    if (!config) {\n      throw new Error(`Unknown routing tier: ${tier}`);\n    }\n\n    // Calculate cost based on tokens\n    let cost = config.baseCost;\n    cost += inputTokens * config.costPerInputToken;\n    cost += outputTokens * config.costPerToken;\n\n    // Apply min/max constraints\n    cost = Math.max(config.minCost, Math.min(cost, config.maxCost));\n\n    return Math.round(cost * 10000) / 10000; // Round to 4 decimal places\n  }\n\n  /**\n   * Track spending for a user\n   * @param userId - User ID\n   * @param tier - Routing tier used\n   * @param cost - Cost of the query\n   */\n  async trackSpending(\n    userId: string,\n    tier: RoutingTier,\n    cost: number\n  ): Promise<void> {\n    // Update in-memory metrics\n    let userMetrics = this.userSpending.get(userId);\n    if (!userMetrics) {\n      userMetrics = {\n        userId,\n        totalSpent: 0,\n        spentByTier: {\n          [RoutingTier.LOCAL_LLM]: 0,\n          [RoutingTier.RAP_SYSTEM]: 0,\n          [RoutingTier.EXTERNAL_LLM]: 0\n        },\n        queriesByTier: {\n          [RoutingTier.LOCAL_LLM]: 0,\n          [RoutingTier.RAP_SYSTEM]: 0,\n          [RoutingTier.EXTERNAL_LLM]: 0\n        },\n        lastUpdated: new Date()\n      };\n      this.userSpending.set(userId, userMetrics);\n    }\n\n    userMetrics.totalSpent += cost;\n    userMetrics.spentByTier[tier] += cost;\n    userMetrics.queriesByTier[tier] += 1;\n    userMetrics.lastUpdated = new Date();\n\n    // Update tier metrics\n    const tierMetrics = this.costMetrics.get(tier);\n    if (tierMetrics) {\n      tierMetrics.totalCost += cost;\n      tierMetrics.totalQueries += 1;\n      tierMetrics.averageCostPerQuery = tierMetrics.totalCost / tierMetrics.totalQueries;\n      tierMetrics.minCost = Math.min(tierMetrics.minCost, cost);\n      tierMetrics.maxCost = Math.max(tierMetrics.maxCost, cost);\n      tierMetrics.lastUpdated = new Date();\n    }\n\n    // Persist to database periodically (every 50 queries)\n    if (userMetrics.queriesByTier[tier] % 50 === 0) {\n      await this.persistUserSpending(userId, userMetrics);\n    }\n  }\n\n  /**\n   * Persist user spending to database\n   */\n  private async persistUserSpending(\n    userId: string,\n    metrics: UserSpendingMetrics\n  ): Promise<void> {\n    try {\n      // Mock implementation - replace with actual Prisma model when available\n      console.log(`Persisting spending for user ${userId}:`, metrics.totalSpent);\n    } catch (error) {\n      console.error(`Error persisting spending for user ${userId}:`, error);\n    }\n  }\n\n  /**\n   * Get spending metrics for a user\n   * @param userId - User ID\n   * @returns User spending metrics\n   */\n  async getUserSpending(userId: string): Promise<UserSpendingMetrics | null> {\n    return this.userSpending.get(userId) || null;\n  }\n\n  /**\n   * Get spending metrics for all tiers\n   * @returns Record of tier spending metrics\n   */\n  async getSpendingMetrics(): Promise<Record<RoutingTier, number>> {\n    const result: Record<RoutingTier, number> = {} as any;\n\n    for (const [tier, metrics] of this.costMetrics.entries()) {\n      result[tier] = metrics.totalCost;\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if a query should be rejected based on cost\n   * @param tier - Routing tier\n   * @param cost - Estimated cost\n   * @param userBudget - User's remaining budget\n   * @returns True if query should be rejected\n   */\n  async shouldRejectQuery(\n    tier: RoutingTier,\n    cost: number,\n    userBudget?: number\n  ): Promise<boolean> {\n    // Check tier max cost\n    const config = this.tierCosts.get(tier);\n    if (!config) {return true;}\n\n    if (cost > config.maxCost) {\n      return true;\n    }\n\n    // Check user budget\n    if (userBudget !== undefined && cost > userBudget) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Get cheapest tier for a query\n   * @param inputTokens - Input tokens\n   * @param outputTokens - Output tokens\n   * @returns Cheapest tier\n   */\n  async getCheapestTier(\n    inputTokens: number = 100,\n    outputTokens: number = 200\n  ): Promise<RoutingTier> {\n    const costs = await this.compareCosts(inputTokens, outputTokens);\n    let cheapestTier = RoutingTier.LOCAL_LLM;\n    let lowestCost = Infinity;\n\n    for (const [tier, cost] of Object.entries(costs)) {\n      if (cost < lowestCost) {\n        lowestCost = cost;\n        cheapestTier = tier as RoutingTier;\n      }\n    }\n\n    return cheapestTier;\n  }\n\n  /**\n   * Get cost comparison across tiers\n   * @param inputTokens - Input tokens\n   * @param outputTokens - Output tokens\n   * @returns Cost for each tier\n   */\n  async compareCosts(\n    inputTokens: number = 100,\n    outputTokens: number = 200\n  ): Promise<Record<RoutingTier, number>> {\n    const result: Record<RoutingTier, number> = {} as any;\n\n    for (const tier of [\n      RoutingTier.LOCAL_LLM,\n      RoutingTier.RAP_SYSTEM,\n      RoutingTier.EXTERNAL_LLM\n    ]) {\n      result[tier] = await this.calculateCost(tier, inputTokens, outputTokens);\n    }\n\n    return result;\n  }\n\n  /**\n   * Get spending metrics for a specific tier\n   * @param tier - Routing tier\n   * @returns Cost metrics for the tier\n   */\n  async getTierSpending(tier: RoutingTier): Promise<CostMetrics | null> {\n    return this.costMetrics.get(tier) || null;\n  }\n\n  /**\n   * Get average cost per query for a tier\n   * @param tier - Routing tier\n   * @returns Average cost per query\n   */\n  async getAverageCostPerQuery(tier: RoutingTier): Promise<number> {\n    const metrics = this.costMetrics.get(tier);\n    return metrics?.averageCostPerQuery || 0;\n  }\n\n  /**\n   * Get total cost for a tier\n   * @param tier - Routing tier\n   * @returns Total cost for the tier\n   */\n  async getTotalCost(tier: RoutingTier): Promise<number> {\n    const metrics = this.costMetrics.get(tier);\n    return metrics?.totalCost || 0;\n  }\n\n  /**\n   * Get total queries for a tier\n   * @param tier - Routing tier\n   * @returns Total queries for the tier\n   */\n  async getTotalQueries(tier: RoutingTier): Promise<number> {\n    const metrics = this.costMetrics.get(tier);\n    return metrics?.totalQueries || 0;\n  }\n\n  /**\n   * Get total spending across all tiers\n   * @returns Total spending amount\n   */\n  async getTotalSpending(): Promise<number> {\n    let total = 0;\n    for (const metrics of this.costMetrics.values()) {\n      total += metrics.totalCost;\n    }\n    return total;\n  }\n\n  /**\n   * Reset spending metrics for a tier\n   * @param tier - Routing tier to reset\n   */\n  async resetTierMetrics(tier: RoutingTier): Promise<void> {\n    const metrics = this.costMetrics.get(tier);\n    if (metrics) {\n      metrics.totalCost = 0;\n      metrics.totalQueries = 0;\n      metrics.averageCostPerQuery = 0;\n      metrics.minCost = Infinity;\n      metrics.maxCost = 0;\n      metrics.lastUpdated = new Date();\n    }\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ;AACA;AACA;AACA;AACA;;AAGA,SAASE,WAAW,QAAwB,SAAS;;AAErD;AACA;AACA;;AASA;AACA;AACA;;AAWA;AACA;AACA;;AAWA;AACA;AACA;AACA,OAAO,MAAMC,aAAa,CAA2B;EAE3CC,SAAS;EAAA;EAAA,CAAAJ,cAAA,GAAAK,CAAA,OAAqC,IAAIC,GAAG,CAAC,CAAC;EACvDC,WAAW;EAAA;EAAA,CAAAP,cAAA,GAAAK,CAAA,OAAkC,IAAIC,GAAG,CAAC,CAAC;EACtDE,YAAY;EAAA;EAAA,CAAAR,cAAA,GAAAK,CAAA,OAAqC,IAAIC,GAAG,CAAC,CAAC;EAElEG,WAAWA,CAACC,MAAoB,EAAE;IAAA;IAAAV,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAK,CAAA;IAChC,IAAI,CAACK,MAAM,GAAGA,MAAM;IAAC;IAAAV,cAAA,GAAAK,CAAA;IACrB,IAAI,CAACO,mBAAmB,CAAC,CAAC;IAAC;IAAAZ,cAAA,GAAAK,CAAA;IAC3B,IAAI,CAACQ,qBAAqB,CAAC,CAAC;EAC9B;;EAEA;AACF;AACA;AACA;EACUD,mBAAmBA,CAAA,EAAS;IAAA;IAAAZ,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAK,CAAA;IAClC;IACA,IAAI,CAACD,SAAS,CAACU,GAAG,CAACZ,WAAW,CAACa,SAAS,EAAE;MACxCC,QAAQ,EAAE,CAAC;MACXC,YAAY,EAAE,CAAC;MACfC,iBAAiB,EAAE,CAAC;MACpBC,OAAO,EAAE,CAAC;MACVC,OAAO,EAAE;IACX,CAAC,CAAC;;IAEF;IACA;IAAA;IAAApB,cAAA,GAAAK,CAAA;IACA,IAAI,CAACD,SAAS,CAACU,GAAG,CAACZ,WAAW,CAACmB,UAAU,EAAE;MACzCL,QAAQ,EAAE,KAAK;MAAE;MACjBC,YAAY,EAAE,MAAM;MACpBC,iBAAiB,EAAE,MAAM;MACzBC,OAAO,EAAE,KAAK;MACdC,OAAO,EAAE;IACX,CAAC,CAAC;;IAEF;IACA;IAAA;IAAApB,cAAA,GAAAK,CAAA;IACA,IAAI,CAACD,SAAS,CAACU,GAAG,CAACZ,WAAW,CAACoB,YAAY,EAAE;MAC3CN,QAAQ,EAAE,KAAK;MACfC,YAAY,EAAE,MAAM;MACpBC,iBAAiB,EAAE,MAAM;MACzBC,OAAO,EAAE,KAAK;MACdC,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;EACUP,qBAAqBA,CAAA,EAAS;IAAA;IAAAb,cAAA,GAAAW,CAAA;IACpC,MAAMY,KAAoB;IAAA;IAAA,CAAAvB,cAAA,GAAAK,CAAA,OAAG,CAC3BH,WAAW,CAACa,SAAS,EACrBb,WAAW,CAACmB,UAAU,EACtBnB,WAAW,CAACoB,YAAY,CACzB;IAAC;IAAAtB,cAAA,GAAAK,CAAA;IAEF,KAAK,MAAMmB,IAAI,IAAID,KAAK,EAAE;MAAA;MAAAvB,cAAA,GAAAK,CAAA;MACxB,IAAI,CAACE,WAAW,CAACO,GAAG,CAACU,IAAI,EAAE;QACzBA,IAAI;QACJC,SAAS,EAAE,CAAC;QACZC,YAAY,EAAE,CAAC;QACfC,mBAAmB,EAAE,CAAC;QACtBR,OAAO,EAAES,QAAQ;QACjBR,OAAO,EAAE,CAAC;QACVS,WAAW,EAAE,IAAIC,IAAI,CAAC;MACxB,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,MAAMC,aAAaA,CACjBP,IAAiB,EACjBQ,WAAmB;EAAA;EAAA,CAAAhC,cAAA,GAAAiC,CAAA,UAAG,CAAC,GACvBC,YAAoB;EAAA;EAAA,CAAAlC,cAAA,GAAAiC,CAAA,UAAG,CAAC,GACP;IAAA;IAAAjC,cAAA,GAAAW,CAAA;IACjB,MAAMwB,MAAM;IAAA;IAAA,CAAAnC,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACD,SAAS,CAACgC,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IACxC,IAAI,CAAC8B,MAAM,EAAE;MAAA;MAAAnC,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MACX,MAAM,IAAIgC,KAAK,CAAC,yBAAyBb,IAAI,EAAE,CAAC;IAClD,CAAC;IAAA;IAAA;MAAAxB,cAAA,GAAAiC,CAAA;IAAA;;IAED;IACA,IAAIK,IAAI;IAAA;IAAA,CAAAtC,cAAA,GAAAK,CAAA,QAAG8B,MAAM,CAACnB,QAAQ;IAAC;IAAAhB,cAAA,GAAAK,CAAA;IAC3BiC,IAAI,IAAIN,WAAW,GAAGG,MAAM,CAACjB,iBAAiB;IAAC;IAAAlB,cAAA,GAAAK,CAAA;IAC/CiC,IAAI,IAAIJ,YAAY,GAAGC,MAAM,CAAClB,YAAY;;IAE1C;IAAA;IAAAjB,cAAA,GAAAK,CAAA;IACAiC,IAAI,GAAGC,IAAI,CAACC,GAAG,CAACL,MAAM,CAAChB,OAAO,EAAEoB,IAAI,CAACE,GAAG,CAACH,IAAI,EAAEH,MAAM,CAACf,OAAO,CAAC,CAAC;IAAC;IAAApB,cAAA,GAAAK,CAAA;IAEhE,OAAOkC,IAAI,CAACG,KAAK,CAACJ,IAAI,GAAG,KAAK,CAAC,GAAG,KAAK,CAAC,CAAC;EAC3C;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE,MAAMK,aAAaA,CACjBC,MAAc,EACdpB,IAAiB,EACjBc,IAAY,EACG;IAAA;IAAAtC,cAAA,GAAAW,CAAA;IACf;IACA,IAAIkC,WAAW;IAAA;IAAA,CAAA7C,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACG,YAAY,CAAC4B,GAAG,CAACQ,MAAM,CAAC;IAAC;IAAA5C,cAAA,GAAAK,CAAA;IAChD,IAAI,CAACwC,WAAW,EAAE;MAAA;MAAA7C,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MAChBwC,WAAW,GAAG;QACZD,MAAM;QACNE,UAAU,EAAE,CAAC;QACbC,WAAW,EAAE;UACX,CAAC7C,WAAW,CAACa,SAAS,GAAG,CAAC;UAC1B,CAACb,WAAW,CAACmB,UAAU,GAAG,CAAC;UAC3B,CAACnB,WAAW,CAACoB,YAAY,GAAG;QAC9B,CAAC;QACD0B,aAAa,EAAE;UACb,CAAC9C,WAAW,CAACa,SAAS,GAAG,CAAC;UAC1B,CAACb,WAAW,CAACmB,UAAU,GAAG,CAAC;UAC3B,CAACnB,WAAW,CAACoB,YAAY,GAAG;QAC9B,CAAC;QACDO,WAAW,EAAE,IAAIC,IAAI,CAAC;MACxB,CAAC;MAAC;MAAA9B,cAAA,GAAAK,CAAA;MACF,IAAI,CAACG,YAAY,CAACM,GAAG,CAAC8B,MAAM,EAAEC,WAAW,CAAC;IAC5C,CAAC;IAAA;IAAA;MAAA7C,cAAA,GAAAiC,CAAA;IAAA;IAAAjC,cAAA,GAAAK,CAAA;IAEDwC,WAAW,CAACC,UAAU,IAAIR,IAAI;IAAC;IAAAtC,cAAA,GAAAK,CAAA;IAC/BwC,WAAW,CAACE,WAAW,CAACvB,IAAI,CAAC,IAAIc,IAAI;IAAC;IAAAtC,cAAA,GAAAK,CAAA;IACtCwC,WAAW,CAACG,aAAa,CAACxB,IAAI,CAAC,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IACrCwC,WAAW,CAAChB,WAAW,GAAG,IAAIC,IAAI,CAAC,CAAC;;IAEpC;IACA,MAAMmB,WAAW;IAAA;IAAA,CAAAjD,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACE,WAAW,CAAC6B,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IAC/C,IAAI4C,WAAW,EAAE;MAAA;MAAAjD,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MACf4C,WAAW,CAACxB,SAAS,IAAIa,IAAI;MAAC;MAAAtC,cAAA,GAAAK,CAAA;MAC9B4C,WAAW,CAACvB,YAAY,IAAI,CAAC;MAAC;MAAA1B,cAAA,GAAAK,CAAA;MAC9B4C,WAAW,CAACtB,mBAAmB,GAAGsB,WAAW,CAACxB,SAAS,GAAGwB,WAAW,CAACvB,YAAY;MAAC;MAAA1B,cAAA,GAAAK,CAAA;MACnF4C,WAAW,CAAC9B,OAAO,GAAGoB,IAAI,CAACE,GAAG,CAACQ,WAAW,CAAC9B,OAAO,EAAEmB,IAAI,CAAC;MAAC;MAAAtC,cAAA,GAAAK,CAAA;MAC1D4C,WAAW,CAAC7B,OAAO,GAAGmB,IAAI,CAACC,GAAG,CAACS,WAAW,CAAC7B,OAAO,EAAEkB,IAAI,CAAC;MAAC;MAAAtC,cAAA,GAAAK,CAAA;MAC1D4C,WAAW,CAACpB,WAAW,GAAG,IAAIC,IAAI,CAAC,CAAC;IACtC,CAAC;IAAA;IAAA;MAAA9B,cAAA,GAAAiC,CAAA;IAAA;;IAED;IAAAjC,cAAA,GAAAK,CAAA;IACA,IAAIwC,WAAW,CAACG,aAAa,CAACxB,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE;MAAA;MAAAxB,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MAC9C,MAAM,IAAI,CAAC6C,mBAAmB,CAACN,MAAM,EAAEC,WAAW,CAAC;IACrD,CAAC;IAAA;IAAA;MAAA7C,cAAA,GAAAiC,CAAA;IAAA;EACH;;EAEA;AACF;AACA;EACE,MAAciB,mBAAmBA,CAC/BN,MAAc,EACdO,OAA4B,EACb;IAAA;IAAAnD,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAK,CAAA;IACf,IAAI;MAAA;MAAAL,cAAA,GAAAK,CAAA;MACF;MACA+C,OAAO,CAACC,GAAG,CAAC,gCAAgCT,MAAM,GAAG,EAAEO,OAAO,CAACL,UAAU,CAAC;IAC5E,CAAC,CAAC,OAAOQ,KAAK,EAAE;MAAA;MAAAtD,cAAA,GAAAK,CAAA;MACd+C,OAAO,CAACE,KAAK,CAAC,sCAAsCV,MAAM,GAAG,EAAEU,KAAK,CAAC;IACvE;EACF;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMC,eAAeA,CAACX,MAAc,EAAuC;IAAA;IAAA5C,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAK,CAAA;IACzE,OAAO,2BAAAL,cAAA,GAAAiC,CAAA,cAAI,CAACzB,YAAY,CAAC4B,GAAG,CAACQ,MAAM,CAAC;IAAA;IAAA,CAAA5C,cAAA,GAAAiC,CAAA,UAAI,IAAI;EAC9C;;EAEA;AACF;AACA;AACA;EACE,MAAMuB,kBAAkBA,CAAA,EAAyC;IAAA;IAAAxD,cAAA,GAAAW,CAAA;IAC/D,MAAM8C,MAAmC;IAAA;IAAA,CAAAzD,cAAA,GAAAK,CAAA,QAAG,CAAC,CAAC,CAAO;IAAC;IAAAL,cAAA,GAAAK,CAAA;IAEtD,KAAK,MAAM,CAACmB,IAAI,EAAE2B,OAAO,CAAC,IAAI,IAAI,CAAC5C,WAAW,CAACmD,OAAO,CAAC,CAAC,EAAE;MAAA;MAAA1D,cAAA,GAAAK,CAAA;MACxDoD,MAAM,CAACjC,IAAI,CAAC,GAAG2B,OAAO,CAAC1B,SAAS;IAClC;IAAC;IAAAzB,cAAA,GAAAK,CAAA;IAED,OAAOoD,MAAM;EACf;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,MAAME,iBAAiBA,CACrBnC,IAAiB,EACjBc,IAAY,EACZsB,UAAmB,EACD;IAAA;IAAA5D,cAAA,GAAAW,CAAA;IAClB;IACA,MAAMwB,MAAM;IAAA;IAAA,CAAAnC,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACD,SAAS,CAACgC,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IACxC,IAAI,CAAC8B,MAAM,EAAE;MAAA;MAAAnC,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MAAC,OAAO,IAAI;IAAC,CAAC;IAAA;IAAA;MAAAL,cAAA,GAAAiC,CAAA;IAAA;IAAAjC,cAAA,GAAAK,CAAA;IAE3B,IAAIiC,IAAI,GAAGH,MAAM,CAACf,OAAO,EAAE;MAAA;MAAApB,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MACzB,OAAO,IAAI;IACb,CAAC;IAAA;IAAA;MAAAL,cAAA,GAAAiC,CAAA;IAAA;;IAED;IAAAjC,cAAA,GAAAK,CAAA;IACA;IAAI;IAAA,CAAAL,cAAA,GAAAiC,CAAA,WAAA2B,UAAU,KAAKC,SAAS;IAAA;IAAA,CAAA7D,cAAA,GAAAiC,CAAA,WAAIK,IAAI,GAAGsB,UAAU,GAAE;MAAA;MAAA5D,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MACjD,OAAO,IAAI;IACb,CAAC;IAAA;IAAA;MAAAL,cAAA,GAAAiC,CAAA;IAAA;IAAAjC,cAAA,GAAAK,CAAA;IAED,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE,MAAMyD,eAAeA,CACnB9B,WAAmB;EAAA;EAAA,CAAAhC,cAAA,GAAAiC,CAAA,WAAG,GAAG,GACzBC,YAAoB;EAAA;EAAA,CAAAlC,cAAA,GAAAiC,CAAA,WAAG,GAAG,GACJ;IAAA;IAAAjC,cAAA,GAAAW,CAAA;IACtB,MAAMoD,KAAK;IAAA;IAAA,CAAA/D,cAAA,GAAAK,CAAA,QAAG,MAAM,IAAI,CAAC2D,YAAY,CAAChC,WAAW,EAAEE,YAAY,CAAC;IAChE,IAAI+B,YAAY;IAAA;IAAA,CAAAjE,cAAA,GAAAK,CAAA,QAAGH,WAAW,CAACa,SAAS;IACxC,IAAImD,UAAU;IAAA;IAAA,CAAAlE,cAAA,GAAAK,CAAA,QAAGuB,QAAQ;IAAC;IAAA5B,cAAA,GAAAK,CAAA;IAE1B,KAAK,MAAM,CAACmB,IAAI,EAAEc,IAAI,CAAC,IAAI6B,MAAM,CAACT,OAAO,CAACK,KAAK,CAAC,EAAE;MAAA;MAAA/D,cAAA,GAAAK,CAAA;MAChD,IAAIiC,IAAI,GAAG4B,UAAU,EAAE;QAAA;QAAAlE,cAAA,GAAAiC,CAAA;QAAAjC,cAAA,GAAAK,CAAA;QACrB6D,UAAU,GAAG5B,IAAI;QAAC;QAAAtC,cAAA,GAAAK,CAAA;QAClB4D,YAAY,GAAGzC,IAAmB;MACpC,CAAC;MAAA;MAAA;QAAAxB,cAAA,GAAAiC,CAAA;MAAA;IACH;IAAC;IAAAjC,cAAA,GAAAK,CAAA;IAED,OAAO4D,YAAY;EACrB;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE,MAAMD,YAAYA,CAChBhC,WAAmB;EAAA;EAAA,CAAAhC,cAAA,GAAAiC,CAAA,WAAG,GAAG,GACzBC,YAAoB;EAAA;EAAA,CAAAlC,cAAA,GAAAiC,CAAA,WAAG,GAAG,GACY;IAAA;IAAAjC,cAAA,GAAAW,CAAA;IACtC,MAAM8C,MAAmC;IAAA;IAAA,CAAAzD,cAAA,GAAAK,CAAA,QAAG,CAAC,CAAC,CAAO;IAAC;IAAAL,cAAA,GAAAK,CAAA;IAEtD,KAAK,MAAMmB,IAAI,IAAI,CACjBtB,WAAW,CAACa,SAAS,EACrBb,WAAW,CAACmB,UAAU,EACtBnB,WAAW,CAACoB,YAAY,CACzB,EAAE;MAAA;MAAAtB,cAAA,GAAAK,CAAA;MACDoD,MAAM,CAACjC,IAAI,CAAC,GAAG,MAAM,IAAI,CAACO,aAAa,CAACP,IAAI,EAAEQ,WAAW,EAAEE,YAAY,CAAC;IAC1E;IAAC;IAAAlC,cAAA,GAAAK,CAAA;IAED,OAAOoD,MAAM;EACf;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMW,eAAeA,CAAC5C,IAAiB,EAA+B;IAAA;IAAAxB,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAK,CAAA;IACpE,OAAO,2BAAAL,cAAA,GAAAiC,CAAA,eAAI,CAAC1B,WAAW,CAAC6B,GAAG,CAACZ,IAAI,CAAC;IAAA;IAAA,CAAAxB,cAAA,GAAAiC,CAAA,WAAI,IAAI;EAC3C;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMoC,sBAAsBA,CAAC7C,IAAiB,EAAmB;IAAA;IAAAxB,cAAA,GAAAW,CAAA;IAC/D,MAAMwC,OAAO;IAAA;IAAA,CAAAnD,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACE,WAAW,CAAC6B,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IAC3C,OAAO,2BAAAL,cAAA,GAAAiC,CAAA,WAAAkB,OAAO,EAAExB,mBAAmB;IAAA;IAAA,CAAA3B,cAAA,GAAAiC,CAAA,WAAI,CAAC;EAC1C;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMqC,YAAYA,CAAC9C,IAAiB,EAAmB;IAAA;IAAAxB,cAAA,GAAAW,CAAA;IACrD,MAAMwC,OAAO;IAAA;IAAA,CAAAnD,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACE,WAAW,CAAC6B,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IAC3C,OAAO,2BAAAL,cAAA,GAAAiC,CAAA,WAAAkB,OAAO,EAAE1B,SAAS;IAAA;IAAA,CAAAzB,cAAA,GAAAiC,CAAA,WAAI,CAAC;EAChC;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMsC,eAAeA,CAAC/C,IAAiB,EAAmB;IAAA;IAAAxB,cAAA,GAAAW,CAAA;IACxD,MAAMwC,OAAO;IAAA;IAAA,CAAAnD,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACE,WAAW,CAAC6B,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IAC3C,OAAO,2BAAAL,cAAA,GAAAiC,CAAA,WAAAkB,OAAO,EAAEzB,YAAY;IAAA;IAAA,CAAA1B,cAAA,GAAAiC,CAAA,WAAI,CAAC;EACnC;;EAEA;AACF;AACA;AACA;EACE,MAAMuC,gBAAgBA,CAAA,EAAoB;IAAA;IAAAxE,cAAA,GAAAW,CAAA;IACxC,IAAI8D,KAAK;IAAA;IAAA,CAAAzE,cAAA,GAAAK,CAAA,QAAG,CAAC;IAAC;IAAAL,cAAA,GAAAK,CAAA;IACd,KAAK,MAAM8C,OAAO,IAAI,IAAI,CAAC5C,WAAW,CAACmE,MAAM,CAAC,CAAC,EAAE;MAAA;MAAA1E,cAAA,GAAAK,CAAA;MAC/CoE,KAAK,IAAItB,OAAO,CAAC1B,SAAS;IAC5B;IAAC;IAAAzB,cAAA,GAAAK,CAAA;IACD,OAAOoE,KAAK;EACd;;EAEA;AACF;AACA;AACA;EACE,MAAME,gBAAgBA,CAACnD,IAAiB,EAAiB;IAAA;IAAAxB,cAAA,GAAAW,CAAA;IACvD,MAAMwC,OAAO;IAAA;IAAA,CAAAnD,cAAA,GAAAK,CAAA,QAAG,IAAI,CAACE,WAAW,CAAC6B,GAAG,CAACZ,IAAI,CAAC;IAAC;IAAAxB,cAAA,GAAAK,CAAA;IAC3C,IAAI8C,OAAO,EAAE;MAAA;MAAAnD,cAAA,GAAAiC,CAAA;MAAAjC,cAAA,GAAAK,CAAA;MACX8C,OAAO,CAAC1B,SAAS,GAAG,CAAC;MAAC;MAAAzB,cAAA,GAAAK,CAAA;MACtB8C,OAAO,CAACzB,YAAY,GAAG,CAAC;MAAC;MAAA1B,cAAA,GAAAK,CAAA;MACzB8C,OAAO,CAACxB,mBAAmB,GAAG,CAAC;MAAC;MAAA3B,cAAA,GAAAK,CAAA;MAChC8C,OAAO,CAAChC,OAAO,GAAGS,QAAQ;MAAC;MAAA5B,cAAA,GAAAK,CAAA;MAC3B8C,OAAO,CAAC/B,OAAO,GAAG,CAAC;MAAC;MAAApB,cAAA,GAAAK,CAAA;MACpB8C,OAAO,CAACtB,WAAW,GAAG,IAAIC,IAAI,CAAC,CAAC;IAClC,CAAC;IAAA;IAAA;MAAA9B,cAAA,GAAAiC,CAAA;IAAA;EACH;AACF","ignoreList":[]}