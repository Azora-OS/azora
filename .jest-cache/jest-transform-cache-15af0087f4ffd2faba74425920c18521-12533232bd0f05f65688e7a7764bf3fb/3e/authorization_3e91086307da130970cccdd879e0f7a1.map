{"version":3,"names":["cov_1a1iiig5pq","actualCoverage","s","requireRole","allowedRoles","f","req","res","next","user","b","status","json","success","error","userRole","role","includes","requireBusinessOwnership","businessId","userId"],"sources":["authorization.ts"],"sourcesContent":["import { Response, NextFunction } from 'express';\nimport { AuthRequest } from './auth.js';\n\nexport type UserRole = 'admin' | 'manager' | 'incubatee' | 'viewer';\n\nexport interface AuthorizedRequest extends AuthRequest {\n  role?: UserRole;\n}\n\nexport const requireRole = (allowedRoles: UserRole[]) => {\n  return (req: AuthorizedRequest, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ success: false, error: 'Authentication required' });\n    }\n\n    const userRole = req.user.role as UserRole;\n    if (!allowedRoles.includes(userRole)) {\n      return res.status(403).json({ success: false, error: 'Insufficient permissions' });\n    }\n\n    req.role = userRole;\n    next();\n  };\n};\n\nexport const requireBusinessOwnership = (req: AuthorizedRequest, res: Response, businessId: string) => {\n  if (!req.userId) {\n    return false;\n  }\n  // This will be validated in the service layer with database query\n  return true;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAAAA,cAAA,GAAAE,CAAA;AANZ,OAAO,MAAMC,WAAW,GAAIC,YAAwB,IAAK;EAAA;EAAAJ,cAAA,GAAAK,CAAA;EAAAL,cAAA,GAAAE,CAAA;EACvD,OAAO,CAACI,GAAsB,EAAEC,GAAa,EAAEC,IAAkB,KAAK;IAAA;IAAAR,cAAA,GAAAK,CAAA;IAAAL,cAAA,GAAAE,CAAA;IACpE,IAAI,CAACI,GAAG,CAACG,IAAI,EAAE;MAAA;MAAAT,cAAA,GAAAU,CAAA;MAAAV,cAAA,GAAAE,CAAA;MACb,OAAOK,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE,KAAK;QAAEC,KAAK,EAAE;MAA0B,CAAC,CAAC;IACnF,CAAC;IAAA;IAAA;MAAAd,cAAA,GAAAU,CAAA;IAAA;IAED,MAAMK,QAAQ;IAAA;IAAA,CAAAf,cAAA,GAAAE,CAAA,OAAGI,GAAG,CAACG,IAAI,CAACO,IAAI,CAAY;IAAC;IAAAhB,cAAA,GAAAE,CAAA;IAC3C,IAAI,CAACE,YAAY,CAACa,QAAQ,CAACF,QAAQ,CAAC,EAAE;MAAA;MAAAf,cAAA,GAAAU,CAAA;MAAAV,cAAA,GAAAE,CAAA;MACpC,OAAOK,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE,KAAK;QAAEC,KAAK,EAAE;MAA2B,CAAC,CAAC;IACpF,CAAC;IAAA;IAAA;MAAAd,cAAA,GAAAU,CAAA;IAAA;IAAAV,cAAA,GAAAE,CAAA;IAEDI,GAAG,CAACU,IAAI,GAAGD,QAAQ;IAAC;IAAAf,cAAA,GAAAE,CAAA;IACpBM,IAAI,CAAC,CAAC;EACR,CAAC;AACH,CAAC;AAAC;AAAAR,cAAA,GAAAE,CAAA;AAEF,OAAO,MAAMgB,wBAAwB,GAAGA,CAACZ,GAAsB,EAAEC,GAAa,EAAEY,UAAkB,KAAK;EAAA;EAAAnB,cAAA,GAAAK,CAAA;EAAAL,cAAA,GAAAE,CAAA;EACrG,IAAI,CAACI,GAAG,CAACc,MAAM,EAAE;IAAA;IAAApB,cAAA,GAAAU,CAAA;IAAAV,cAAA,GAAAE,CAAA;IACf,OAAO,KAAK;EACd,CAAC;EAAA;EAAA;IAAAF,cAAA,GAAAU,CAAA;EAAA;EACD;EAAAV,cAAA,GAAAE,CAAA;EACA,OAAO,IAAI;AACb,CAAC","ignoreList":[]}