{"version":3,"names":["cov_rdy900is4","actualCoverage","NodeTracerProvider","getNodeAutoInstrumentations","registerInstrumentations","JaegerExporter","BatchSpanProcessor","Resource","SemanticResourceAttributes","trace","context","SpanStatusCode","initializeTracing","serviceName","f","jaegerExporter","s","endpoint","b","process","env","JAEGER_ENDPOINT","tracerProvider","resource","default","merge","SERVICE_NAME","SERVICE_VERSION","addSpanProcessor","register","instrumentations","getTracer","name","tracingMiddleware","req","res","next","tracer","span","startSpan","method","path","setAttributes","url","hostname","protocol","ip","traceId","spanContext","spanId","originalSend","send","data","statusCode","setStatus","code","ERROR","end","call","with","setSpan","active","createDatabaseSpan","operation","query","createServiceSpan","recordError","error","getActiveSpan","recordException"],"sources":["index.ts"],"sourcesContent":["/**\n * OpenTelemetry Distributed Tracing Setup\n * Provides centralized tracing configuration for all Azora services\n */\n\nimport { NodeTracerProvider } from '@opentelemetry/node';\nimport { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';\nimport { registerInstrumentations } from '@opentelemetry/instrumentation';\nimport { JaegerExporter } from '@opentelemetry/exporter-jaeger-http';\nimport { BatchSpanProcessor } from '@opentelemetry/sdk-trace-node';\nimport { Resource } from '@opentelemetry/resources';\nimport { SemanticResourceAttributes } from '@opentelemetry/semantic-conventions';\nimport { W3CTraceContextPropagator } from '@opentelemetry/core';\nimport { CompositePropagator, HttpTraceContextPropagator } from '@opentelemetry/core';\nimport { trace, context, SpanStatusCode } from '@opentelemetry/api';\n\n/**\n * Initialize OpenTelemetry tracing for a service\n */\nexport function initializeTracing(serviceName: string) {\n  const jaegerExporter = new JaegerExporter({\n    endpoint: process.env.JAEGER_ENDPOINT || 'http://localhost:14268/api/traces',\n  });\n\n  const tracerProvider = new NodeTracerProvider({\n    resource: Resource.default().merge(\n      new Resource({\n        [SemanticResourceAttributes.SERVICE_NAME]: serviceName,\n        [SemanticResourceAttributes.SERVICE_VERSION]: process.env.SERVICE_VERSION || '1.0.0',\n      }),\n    ),\n  });\n\n  tracerProvider.addSpanProcessor(new BatchSpanProcessor(jaegerExporter));\n  tracerProvider.register();\n\n  // Register auto-instrumentations\n  registerInstrumentations({\n    instrumentations: [getNodeAutoInstrumentations()],\n  });\n\n  return tracerProvider;\n}\n\n/**\n * Get the global tracer instance\n */\nexport function getTracer(name: string) {\n  return trace.getTracer(name);\n}\n\n/**\n * Express middleware for automatic request tracing\n */\nexport function tracingMiddleware() {\n  return (req: any, res: any, next: any) => {\n    const tracer = getTracer('express');\n    const span = tracer.startSpan(`${req.method} ${req.path}`);\n\n    // Set span attributes\n    span.setAttributes({\n      'http.method': req.method,\n      'http.url': req.url,\n      'http.target': req.path,\n      'http.host': req.hostname,\n      'http.scheme': req.protocol,\n      'http.client_ip': req.ip,\n    });\n\n    // Add trace ID to request for logging\n    req.traceId = span.spanContext().traceId;\n    req.spanId = span.spanContext().spanId;\n\n    // Wrap response to capture status\n    const originalSend = res.send;\n    res.send = function (data: any) {\n      span.setAttributes({\n        'http.status_code': res.statusCode,\n      });\n\n      if (res.statusCode >= 400) {\n        span.setStatus({ code: SpanStatusCode.ERROR });\n      }\n\n      span.end();\n      return originalSend.call(this, data);\n    };\n\n    // Run handler in span context\n    context.with(trace.setSpan(context.active(), span), () => {\n      next();\n    });\n  };\n}\n\n/**\n * Create a child span for database operations\n */\nexport function createDatabaseSpan(operation: string, query: string) {\n  const tracer = getTracer('database');\n  const span = tracer.startSpan(`db.${operation}`);\n\n  span.setAttributes({\n    'db.operation': operation,\n    'db.statement': query,\n  });\n\n  return span;\n}\n\n/**\n * Create a child span for external service calls\n */\nexport function createServiceSpan(serviceName: string, method: string, path: string) {\n  const tracer = getTracer('http-client');\n  const span = tracer.startSpan(`${serviceName}.${method}`);\n\n  span.setAttributes({\n    'http.method': method,\n    'http.url': path,\n    'peer.service': serviceName,\n  });\n\n  return span;\n}\n\n/**\n * Record an error in the current span\n */\nexport function recordError(error: Error) {\n  const span = trace.getActiveSpan();\n  if (span) {\n    span.recordException(error);\n    span.setStatus({ code: SpanStatusCode.ERROR });\n  }\n}\n\nexport default {\n  initializeTracing,\n  getTracer,\n  tracingMiddleware,\n  createDatabaseSpan,\n  createServiceSpan,\n  recordError,\n};\n"],"mappings":"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","ignoreList":[]}