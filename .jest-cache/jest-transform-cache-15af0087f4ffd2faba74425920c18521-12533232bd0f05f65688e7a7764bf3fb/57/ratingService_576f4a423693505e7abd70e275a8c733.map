{"version":3,"names":["cov_1htaj9rx5o","actualCoverage","RatingService","createRating","data","f","projectId","sellerId","buyerId","ratings","review","images","s","allRatings","Object","values","some","r","b","Error","rating","id","Date","now","Math","random","toString","substr","helpful","verified","createdAt","updatedAt","updateSellerRatingSummary","emitEvent","addResponse","ratingId","responseText","markHelpful","userId","getSellerRatings","page","limit","total","getSellerRatingSummary","badges","calculateBadges","totalRatings","averageOverall","averageRatings","overall","quality","communication","delivery","value","ratingDistribution","summary","push","getProjectRating","flagRating","reason","event","console","log"],"sources":["ratingService.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright ¬© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nexport interface Rating {\n  id: string;\n  projectId: string;\n  sellerId: string;\n  buyerId: string;\n  ratings: {\n    overall: number; // 1-5\n    quality: number; // 1-5\n    communication: number; // 1-5\n    delivery: number; // 1-5\n    value: number; // 1-5\n  };\n  review?: string;\n  images?: string[];\n  response?: {\n    text: string;\n    createdAt: Date;\n  };\n  helpful: number; // How many found this helpful\n  verified: boolean; // Verified purchase\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport interface SellerRatingSummary {\n  sellerId: string;\n  totalRatings: number;\n  averageRatings: {\n    overall: number;\n    quality: number;\n    communication: number;\n    delivery: number;\n    value: number;\n  };\n  ratingDistribution: {\n    5: number;\n    4: number;\n    3: number;\n    2: number;\n    1: number;\n  };\n  badges: string[]; // e.g., \"Top Rated\", \"Fast Responder\", \"Quality Assured\"\n}\n\n/**\n * ‚≠ê RATING & REVIEW SERVICE\n * \n * Builds trust through transparent ratings and reviews.\n * Buyers rate sellers, sellers can respond.\n */\nexport class RatingService {\n  \n  /**\n   * Create a rating/review after project completion\n   */\n  static async createRating(data: {\n    projectId: string;\n    sellerId: string;\n    buyerId: string;\n    ratings: Rating['ratings'];\n    review?: string;\n    images?: string[];\n  }): Promise<Rating> {\n    const { projectId, sellerId, buyerId, ratings, review, images } = data;\n\n    // Validate ratings are 1-5\n    const allRatings = Object.values(ratings);\n    if (allRatings.some(r => r < 1 || r > 5)) {\n      throw new Error('All ratings must be between 1 and 5');\n    }\n\n    // Check if buyer already rated this project\n    // const existing = await prisma.rating.findFirst({\n    //   where: { projectId, buyerId }\n    // });\n    // if (existing) throw new Error('You have already rated this project');\n\n    // Verify project is completed\n    // const project = await ProjectService.getProject(projectId);\n    // if (project.status !== 'completed') {\n    //   throw new Error('Can only rate completed projects');\n    // }\n\n    const rating: Rating = {\n      id: `rating_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      projectId,\n      sellerId,\n      buyerId,\n      ratings,\n      review,\n      images,\n      helpful: 0,\n      verified: true,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n\n    // TODO: Save to database\n    // await prisma.rating.create({ data: rating });\n\n    // Update seller's rating summary\n    await this.updateSellerRatingSummary(sellerId);\n\n    // Emit event\n    this.emitEvent('rating:created', rating);\n\n    return rating;\n  }\n\n  /**\n   * Add seller response to a rating\n   */\n  static async addResponse(\n    ratingId: string,\n    sellerId: string,\n    responseText: string\n  ): Promise<Rating> {\n    // TODO: Fetch rating\n    // const rating = await prisma.rating.findUnique({ where: { id: ratingId } });\n\n    // Validate seller owns this rating\n    // if (rating.sellerId !== sellerId) {\n    //   throw new Error('Only the seller can respond to this rating');\n    // }\n\n    // Update rating with response\n    // await prisma.rating.update({\n    //   where: { id: ratingId },\n    //   data: {\n    //     response: {\n    //       text: responseText,\n    //       createdAt: new Date()\n    //     }\n    //   }\n    // });\n\n    this.emitEvent('rating:response_added', { ratingId, sellerId });\n\n    return {} as Rating;\n  }\n\n  /**\n   * Mark rating as helpful\n   */\n  static async markHelpful(ratingId: string, userId: string): Promise<void> {\n    // TODO: Increment helpful count\n    // await prisma.rating.update({\n    //   where: { id: ratingId },\n    //   data: { helpful: { increment: 1 } }\n    // });\n\n    this.emitEvent('rating:marked_helpful', { ratingId, userId });\n  }\n\n  /**\n   * Get all ratings for a seller\n   */\n  static async getSellerRatings(\n    sellerId: string,\n    page: number = 1,\n    limit: number = 20\n  ): Promise<{ ratings: Rating[]; total: number }> {\n    // TODO: Fetch from database\n    // const ratings = await prisma.rating.findMany({\n    //   where: { sellerId },\n    //   orderBy: { createdAt: 'desc' },\n    //   skip: (page - 1) * limit,\n    //   take: limit\n    // });\n\n    // const total = await prisma.rating.count({ where: { sellerId } });\n\n    return { ratings: [], total: 0 };\n  }\n\n  /**\n   * Get rating summary for a seller\n   */\n  static async getSellerRatingSummary(sellerId: string): Promise<SellerRatingSummary> {\n    // TODO: Aggregate from database\n    // const ratings = await prisma.rating.findMany({\n    //   where: { sellerId },\n    //   select: { ratings: true }\n    // });\n\n    // if (ratings.length === 0) {\n    //   return {\n    //     sellerId,\n    //     totalRatings: 0,\n    //     averageRatings: { overall: 0, quality: 0, communication: 0, delivery: 0, value: 0 },\n    //     ratingDistribution: { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 },\n    //     badges: []\n    //   };\n    // }\n\n    // Calculate averages\n    // const avgOverall = ratings.reduce((sum, r) => sum + r.ratings.overall, 0) / ratings.length;\n    // ...\n\n    // Calculate distribution\n    // const distribution = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 };\n    // ratings.forEach(r => {\n    //   const overall = Math.round(r.ratings.overall);\n    //   distribution[overall]++;\n    // });\n\n    // Determine badges\n    const badges = this.calculateBadges({\n      totalRatings: 0,\n      averageOverall: 0\n    });\n\n    return {\n      sellerId,\n      totalRatings: 0,\n      averageRatings: { overall: 0, quality: 0, communication: 0, delivery: 0, value: 0 },\n      ratingDistribution: { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 },\n      badges\n    };\n  }\n\n  /**\n   * Update seller's rating summary (called after new rating)\n   */\n  private static async updateSellerRatingSummary(sellerId: string): Promise<void> {\n    const summary = await this.getSellerRatingSummary(sellerId);\n    // TODO: Cache summary in database for fast access\n    // await prisma.sellerProfile.update({\n    //   where: { id: sellerId },\n    //   data: { ratingSummary: summary }\n    // });\n  }\n\n  /**\n   * Calculate badges based on performance\n   */\n  private static calculateBadges(data: {\n    totalRatings: number;\n    averageOverall: number;\n  }): string[] {\n    const badges: string[] = [];\n\n    // Top Rated Badge\n    if (data.totalRatings >= 50 && data.averageOverall >= 4.8) {\n      badges.push('Top Rated');\n    } else if (data.totalRatings >= 20 && data.averageOverall >= 4.5) {\n      badges.push('Rising Star');\n    }\n\n    // Volume badges\n    if (data.totalRatings >= 100) {badges.push('100+ Reviews');}\n    else if (data.totalRatings >= 50) {badges.push('50+ Reviews');}\n\n    return badges;\n  }\n\n  /**\n   * Get rating for a specific project\n   */\n  static async getProjectRating(projectId: string): Promise<Rating | null> {\n    // TODO: Fetch from database\n    // return await prisma.rating.findFirst({ where: { projectId } });\n    return null;\n  }\n\n  /**\n   * Flag inappropriate rating for review\n   */\n  static async flagRating(\n    ratingId: string,\n    userId: string,\n    reason: string\n  ): Promise<void> {\n    // TODO: Create moderation ticket\n    // await prisma.moderationTicket.create({\n    //   data: {\n    //     type: 'rating',\n    //     itemId: ratingId,\n    //     reportedBy: userId,\n    //     reason,\n    //     status: 'pending'\n    //   }\n    // });\n\n    this.emitEvent('rating:flagged', { ratingId, userId, reason });\n  }\n\n  private static emitEvent(event: string, data: any) {\n    console.log(`üîî Rating Event: ${event}`, data);\n    // Emit to organism event bus\n    // OrganismEventBus.emit(event, data);\n  }\n}\n"],"mappings":"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","ignoreList":[]}