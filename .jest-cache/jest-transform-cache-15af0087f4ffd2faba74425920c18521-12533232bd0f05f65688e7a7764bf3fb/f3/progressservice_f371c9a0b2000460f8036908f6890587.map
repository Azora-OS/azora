{"version":3,"names":["cov_vnpyqvh8r","actualCoverage","prisma","logger","ProgressService","recordOutcome","data","f","s","outcome","learningOutcome","create","enrollmentId","courseId","moduleId","assessmentScore","timeSpent","conceptMastery","Math","min","info","id","error","getEnrollmentProgress","enrollment","findUnique","where","include","course","modules","b","Error","outcomes","findMany","totalModules","length","completedModules","Set","map","o","size","completionRate","averageScore","reduce","sum","getStudentProgress","studentId","enrollments","completedCourses","filter","e","status","allOutcomes","flatMap","totalTimeSpent","totalCourses","identifyStruggling","threshold","strugglingConcepts","isStruggling","progressService"],"sources":["progress.service.ts"],"sourcesContent":["import { prisma } from '../index';\nimport { LearningOutcome } from '../types';\nimport { logger } from '../utils/logger';\n\nexport class ProgressService {\n  async recordOutcome(data: {\n    enrollmentId: string;\n    courseId: string;\n    moduleId: string;\n    assessmentScore: number;\n    timeSpent: number;\n  }): Promise<LearningOutcome> {\n    try {\n      const outcome = await prisma.learningOutcome.create({\n        data: {\n          enrollmentId: data.enrollmentId,\n          courseId: data.courseId,\n          moduleId: data.moduleId,\n          assessmentScore: data.assessmentScore,\n          timeSpent: data.timeSpent,\n          conceptMastery: Math.min(data.assessmentScore, 100),\n        },\n      });\n\n      logger.info(`Learning outcome recorded: ${outcome.id}`);\n      return outcome as LearningOutcome;\n    } catch (error) {\n      logger.error('Error recording learning outcome:', error);\n      throw error;\n    }\n  }\n\n  async getEnrollmentProgress(enrollmentId: string): Promise<{\n    enrollment: any;\n    outcomes: LearningOutcome[];\n    completionRate: number;\n    averageScore: number;\n    timeSpent: number;\n  }> {\n    try {\n      const enrollment = await prisma.enrollment.findUnique({\n        where: { id: enrollmentId },\n        include: {\n          course: {\n            include: {\n              modules: true,\n            },\n          },\n        },\n      });\n\n      if (!enrollment) {\n        throw new Error('Enrollment not found');\n      }\n\n      const outcomes = await prisma.learningOutcome.findMany({\n        where: { enrollmentId },\n      });\n\n      const totalModules = enrollment.course.modules.length;\n      const completedModules = new Set(outcomes.map(o => o.moduleId)).size;\n      const completionRate = totalModules > 0 ? (completedModules / totalModules) * 100 : 0;\n      const averageScore = outcomes.length > 0\n        ? outcomes.reduce((sum, o) => sum + o.assessmentScore, 0) / outcomes.length\n        : 0;\n      const timeSpent = outcomes.reduce((sum, o) => sum + o.timeSpent, 0);\n\n      return {\n        enrollment,\n        outcomes: outcomes as LearningOutcome[],\n        completionRate,\n        averageScore,\n        timeSpent,\n      };\n    } catch (error) {\n      logger.error('Error getting enrollment progress:', error);\n      throw error;\n    }\n  }\n\n  async getStudentProgress(studentId: string): Promise<{\n    enrollments: any[];\n    totalCourses: number;\n    completedCourses: number;\n    averageScore: number;\n    totalTimeSpent: number;\n  }> {\n    try {\n      const enrollments = await prisma.enrollment.findMany({\n        where: { studentId },\n        include: {\n          course: true,\n          outcomes: true,\n        },\n      });\n\n      const completedCourses = enrollments.filter(e => e.status === 'completed').length;\n      const allOutcomes = enrollments.flatMap(e => e.outcomes);\n      const averageScore = allOutcomes.length > 0\n        ? allOutcomes.reduce((sum, o) => sum + o.assessmentScore, 0) / allOutcomes.length\n        : 0;\n      const totalTimeSpent = allOutcomes.reduce((sum, o) => sum + o.timeSpent, 0);\n\n      return {\n        enrollments,\n        totalCourses: enrollments.length,\n        completedCourses,\n        averageScore,\n        totalTimeSpent,\n      };\n    } catch (error) {\n      logger.error('Error getting student progress:', error);\n      throw error;\n    }\n  }\n\n  async identifyStruggling(enrollmentId: string, threshold: number = 50): Promise<{\n    isStruggling: boolean;\n    averageScore: number;\n    strugglingConcepts: string[];\n  }> {\n    try {\n      const outcomes = await prisma.learningOutcome.findMany({\n        where: { enrollmentId },\n      });\n\n      const averageScore = outcomes.length > 0\n        ? outcomes.reduce((sum, o) => sum + o.assessmentScore, 0) / outcomes.length\n        : 0;\n\n      const strugglingConcepts = outcomes\n        .filter(o => o.assessmentScore < threshold)\n        .map(o => `Module ${o.moduleId}`);\n\n      return {\n        isStruggling: averageScore < threshold,\n        averageScore,\n        strugglingConcepts,\n      };\n    } catch (error) {\n      logger.error('Error identifying struggling student:', error);\n      throw error;\n    }\n  }\n}\n\nexport const progressService = new ProgressService();\n"],"mappings":"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","ignoreList":[]}