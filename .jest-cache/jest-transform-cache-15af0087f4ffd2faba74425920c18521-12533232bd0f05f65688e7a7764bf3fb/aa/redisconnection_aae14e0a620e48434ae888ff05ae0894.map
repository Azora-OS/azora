{"version":3,"names":["cov_17qxkf8lz5","actualCoverage","createRedisCluster","createRedisInstance","applyPersistenceConfig","getRedisConnectionString","RedisConnectionManager","redis","s","isConnected","healthCheckInterval","constructor","options","b","f","useCluster","process","env","REDIS_CLUSTER","maxRetries","retryDelay","connect","console","log","waitForReady","startHealthCheck","error","Promise","resolve","reject","Error","timeout","setTimeout","on","clearTimeout","err","setInterval","healthCheck","pong","ping","getInstance","isReady","getConnectionInfo","connected","type","connectionString","executeWithRetry","command","lastError","attempt","warn","message","delay","Math","pow","ms","getStats","info","dbSize","dbsize","memory","flushAll","flushall","disconnect","clearInterval","quit","connectionManager","getRedisConnectionManager","initializeRedis","manager"],"sources":["redis-connection.ts"],"sourcesContent":["/**\n * Redis Connection Manager\n * Handles connection pooling, health checks, and failover\n */\n\nimport Redis from 'ioredis';\nimport {\n  createRedisCluster,\n  createRedisInstance,\n  applyPersistenceConfig,\n  getRedisConnectionString\n} from './redis-cluster-config';\n\nexport interface RedisConnectionOptions {\n  useCluster: boolean;\n  maxRetries: number;\n  retryDelay: number;\n  healthCheckInterval: number;\n}\n\nexport class RedisConnectionManager {\n  private redis: Redis | Redis.Cluster | null = null;\n  private isConnected: boolean = false;\n  private healthCheckInterval: NodeJS.Timeout | null = null;\n  private options: RedisConnectionOptions;\n\n  constructor(options: Partial<RedisConnectionOptions> = {}) {\n    this.options = {\n      useCluster: process.env.REDIS_CLUSTER === 'true',\n      maxRetries: 5,\n      retryDelay: 1000,\n      healthCheckInterval: 30000, // 30 seconds\n      ...options\n    };\n  }\n\n  /**\n   * Initialize Redis connection\n   */\n  async connect(): Promise<void> {\n    try {\n      if (this.options.useCluster) {\n        console.log('Connecting to Redis Cluster...');\n        this.redis = createRedisCluster();\n      } else {\n        console.log('Connecting to Redis instance...');\n        this.redis = createRedisInstance();\n      }\n\n      // Wait for connection to be ready\n      await this.waitForReady();\n\n      // Apply persistence configuration\n      await applyPersistenceConfig(this.redis);\n\n      this.isConnected = true;\n      console.log('Redis connection established');\n\n      // Start health checks\n      this.startHealthCheck();\n    } catch (error) {\n      console.error('Failed to connect to Redis:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Wait for Redis to be ready\n   */\n  private waitForReady(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!this.redis) {\n        reject(new Error('Redis instance not initialized'));\n        return;\n      }\n\n      const timeout = setTimeout(() => {\n        reject(new Error('Redis connection timeout'));\n      }, 10000);\n\n      this.redis.on('ready', () => {\n        clearTimeout(timeout);\n        resolve();\n      });\n\n      this.redis.on('error', (err) => {\n        clearTimeout(timeout);\n        reject(err);\n      });\n    });\n  }\n\n  /**\n   * Start periodic health checks\n   */\n  private startHealthCheck(): void {\n    this.healthCheckInterval = setInterval(async () => {\n      try {\n        await this.healthCheck();\n      } catch (error) {\n        console.error('Health check failed:', error);\n      }\n    }, this.options.healthCheckInterval);\n  }\n\n  /**\n   * Perform health check\n   */\n  async healthCheck(): Promise<boolean> {\n    try {\n      if (!this.redis) {\n        return false;\n      }\n\n      const pong = await this.redis.ping();\n      return pong === 'PONG';\n    } catch (error) {\n      console.error('Redis health check failed:', error);\n      this.isConnected = false;\n      return false;\n    }\n  }\n\n  /**\n   * Get Redis instance\n   */\n  getInstance(): Redis | Redis.Cluster {\n    if (!this.redis) {\n      throw new Error('Redis not connected. Call connect() first.');\n    }\n    return this.redis;\n  }\n\n  /**\n   * Check if connected\n   */\n  isReady(): boolean {\n    return this.isConnected && this.redis !== null;\n  }\n\n  /**\n   * Get connection info\n   */\n  getConnectionInfo(): Record<string, any> {\n    return {\n      connected: this.isConnected,\n      type: this.options.useCluster ? 'cluster' : 'standalone',\n      connectionString: getRedisConnectionString()\n    };\n  }\n\n  /**\n   * Execute command with retry logic\n   */\n  async executeWithRetry<T>(\n    command: () => Promise<T>,\n    maxRetries: number = this.options.maxRetries\n  ): Promise<T> {\n    let lastError: Error | null = null;\n\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\n      try {\n        return await command();\n      } catch (error) {\n        lastError = error as Error;\n        console.warn(`Command failed (attempt ${attempt + 1}/${maxRetries + 1}):`, lastError.message);\n\n        if (attempt < maxRetries) {\n          await this.delay(this.options.retryDelay * Math.pow(2, attempt));\n        }\n      }\n    }\n\n    throw lastError || new Error('Command failed after retries');\n  }\n\n  /**\n   * Delay helper\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Get Redis statistics\n   */\n  async getStats(): Promise<Record<string, any>> {\n    if (!this.redis) {\n      throw new Error('Redis not connected');\n    }\n\n    try {\n      const info = await this.redis.info();\n      const dbSize = await this.redis.dbsize();\n      const memory = await this.redis.info('memory');\n\n      return {\n        info,\n        dbSize,\n        memory,\n        connected: this.isConnected\n      };\n    } catch (error) {\n      console.error('Error getting stats:', error);\n      return { error: (error as Error).message };\n    }\n  }\n\n  /**\n   * Flush all data (use with caution)\n   */\n  async flushAll(): Promise<void> {\n    if (!this.redis) {\n      throw new Error('Redis not connected');\n    }\n\n    try {\n      await this.redis.flushall();\n      console.log('Redis flushed');\n    } catch (error) {\n      console.error('Error flushing Redis:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Close connection\n   */\n  async disconnect(): Promise<void> {\n    if (this.healthCheckInterval) {\n      clearInterval(this.healthCheckInterval);\n    }\n\n    if (this.redis) {\n      try {\n        await this.redis.quit();\n        this.isConnected = false;\n        console.log('Redis connection closed');\n      } catch (error) {\n        console.error('Error closing Redis connection:', error);\n      }\n    }\n  }\n}\n\n// Singleton instance\nlet connectionManager: RedisConnectionManager | null = null;\n\n/**\n * Get or create Redis connection manager\n */\nexport function getRedisConnectionManager(\n  options?: Partial<RedisConnectionOptions>\n): RedisConnectionManager {\n  if (!connectionManager) {\n    connectionManager = new RedisConnectionManager(options);\n  }\n  return connectionManager;\n}\n\n/**\n * Initialize Redis connection globally\n */\nexport async function initializeRedis(\n  options?: Partial<RedisConnectionOptions>\n): Promise<RedisConnectionManager> {\n  const manager = getRedisConnectionManager(options);\n  await manager.connect();\n  return manager;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}