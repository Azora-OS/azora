{"version":3,"names":["cov_hqsdt9r72","actualCoverage","Pool","createClient","pool","s","redisClient","getDatabasePool","connectionString","f","b","ssl","process","env","NODE_ENV","rejectUnauthorized","undefined","on","err","console","error","exit","getRedisCache","url","connect","catch","getSupabaseClient","key","from","table","select","cols","limit","n","Promise","resolve"],"sources":["azora-database-layer.ts"],"sourcesContent":["import { Pool } from 'pg';\nimport { createClient } from 'redis';\n\n// Singleton instances\nlet pool: Pool | null = null;\nlet redisClient: any | null = null;\n\nexport const getDatabasePool = (connectionString: string) => {\n    if (!pool) {\n        pool = new Pool({\n            connectionString,\n            ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : undefined\n        });\n\n        pool.on('error', (err) => {\n            console.error('Unexpected error on idle client', err);\n            process.exit(-1);\n        });\n    }\n    return pool;\n};\n\nexport const getRedisCache = (url: string) => {\n    if (!redisClient) {\n        redisClient = createClient({ url });\n        redisClient.on('error', (err: any) => console.error('Redis Client Error', err));\n        redisClient.connect().catch(console.error);\n    }\n    return redisClient;\n};\n\nexport const getSupabaseClient = (url?: string, key?: string) => {\n    if (!url || !key) return null;\n    // Mock or implement if @supabase/supabase-js is added\n    // For now returning a mock that satisfies the basic usage in server.ts\n    return {\n        from: (table: string) => ({\n            select: (cols: string) => ({\n                limit: (n: number) => Promise.resolve([])\n            })\n        })\n    };\n};\n"],"mappings":"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","ignoreList":[]}