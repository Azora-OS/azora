48b08af3220ce01376fa3dc4512f343f
/* istanbul ignore next */
function cov_rf87ke4hw() {
  var path = "/workspaces/azora/services/azora-cloud/azora-mint/engines/wallet-manager.js";
  var hash = "0ddc0c117b44345a055f71cf573ab3d80011b267";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/azora-cloud/azora-mint/engines/wallet-manager.js",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 4
        },
        end: {
          line: 3,
          column: 29
        }
      },
      "1": {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 9,
          column: 5
        }
      },
      "2": {
        start: {
          line: 8,
          column: 6
        },
        end: {
          line: 8,
          column: 65
        }
      },
      "3": {
        start: {
          line: 11,
          column: 19
        },
        end: {
          line: 17,
          column: 5
        }
      },
      "4": {
        start: {
          line: 19,
          column: 4
        },
        end: {
          line: 19,
          column: 37
        }
      },
      "5": {
        start: {
          line: 20,
          column: 4
        },
        end: {
          line: 20,
          column: 37
        }
      },
      "6": {
        start: {
          line: 24,
          column: 17
        },
        end: {
          line: 24,
          column: 41
        }
      },
      "7": {
        start: {
          line: 25,
          column: 4
        },
        end: {
          line: 28,
          column: 5
        }
      },
      "8": {
        start: {
          line: 26,
          column: 21
        },
        end: {
          line: 26,
          column: 46
        }
      },
      "9": {
        start: {
          line: 27,
          column: 6
        },
        end: {
          line: 27,
          column: 29
        }
      },
      "10": {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 18
        }
      },
      "11": {
        start: {
          line: 33,
          column: 19
        },
        end: {
          line: 33,
          column: 41
        }
      },
      "12": {
        start: {
          line: 35,
          column: 4
        },
        end: {
          line: 37,
          column: 5
        }
      },
      "13": {
        start: {
          line: 36,
          column: 6
        },
        end: {
          line: 36,
          column: 36
        }
      },
      "14": {
        start: {
          line: 39,
          column: 4
        },
        end: {
          line: 39,
          column: 40
        }
      },
      "15": {
        start: {
          line: 41,
          column: 24
        },
        end: {
          line: 48,
          column: 5
        }
      },
      "16": {
        start: {
          line: 50,
          column: 4
        },
        end: {
          line: 50,
          column: 42
        }
      },
      "17": {
        start: {
          line: 51,
          column: 4
        },
        end: {
          line: 51,
          column: 81
        }
      },
      "18": {
        start: {
          line: 55,
          column: 23
        },
        end: {
          line: 55,
          column: 49
        }
      },
      "19": {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 59,
          column: 5
        }
      },
      "20": {
        start: {
          line: 58,
          column: 6
        },
        end: {
          line: 58,
          column: 64
        }
      },
      "21": {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 61,
          column: 54
        }
      },
      "22": {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 62,
          column: 51
        }
      },
      "23": {
        start: {
          line: 64,
          column: 4
        },
        end: {
          line: 71,
          column: 6
        }
      },
      "24": {
        start: {
          line: 75,
          column: 19
        },
        end: {
          line: 75,
          column: 41
        }
      },
      "25": {
        start: {
          line: 76,
          column: 4
        },
        end: {
          line: 76,
          column: 66
        }
      },
      "26": {
        start: {
          line: 80,
          column: 19
        },
        end: {
          line: 80,
          column: 41
        }
      },
      "27": {
        start: {
          line: 81,
          column: 4
        },
        end: {
          line: 81,
          column: 55
        }
      },
      "28": {
        start: {
          line: 85,
          column: 19
        },
        end: {
          line: 85,
          column: 36
        }
      },
      "29": {
        start: {
          line: 86,
          column: 4
        },
        end: {
          line: 89,
          column: 24
        }
      },
      "30": {
        start: {
          line: 93,
          column: 19
        },
        end: {
          line: 93,
          column: 36
        }
      },
      "31": {
        start: {
          line: 94,
          column: 4
        },
        end: {
          line: 94,
          column: 50
        }
      },
      "32": {
        start: {
          line: 98,
          column: 0
        },
        end: {
          line: 98,
          column: 37
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 2,
            column: 2
          },
          end: {
            line: 2,
            column: 3
          }
        },
        loc: {
          start: {
            line: 2,
            column: 16
          },
          end: {
            line: 4,
            column: 3
          }
        },
        line: 2
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 6,
            column: 2
          },
          end: {
            line: 6,
            column: 3
          }
        },
        loc: {
          start: {
            line: 6,
            column: 23
          },
          end: {
            line: 21,
            column: 3
          }
        },
        line: 6
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 23,
            column: 2
          },
          end: {
            line: 23,
            column: 3
          }
        },
        loc: {
          start: {
            line: 23,
            column: 20
          },
          end: {
            line: 30,
            column: 3
          }
        },
        line: 23
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 32,
            column: 2
          },
          end: {
            line: 32,
            column: 3
          }
        },
        loc: {
          start: {
            line: 32,
            column: 42
          },
          end: {
            line: 52,
            column: 3
          }
        },
        line: 32
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 54,
            column: 3
          }
        },
        loc: {
          start: {
            line: 54,
            column: 51
          },
          end: {
            line: 72,
            column: 3
          }
        },
        line: 54
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 74,
            column: 2
          },
          end: {
            line: 74,
            column: 3
          }
        },
        loc: {
          start: {
            line: 74,
            column: 38
          },
          end: {
            line: 77,
            column: 3
          }
        },
        line: 74
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 79,
            column: 2
          },
          end: {
            line: 79,
            column: 3
          }
        },
        loc: {
          start: {
            line: 79,
            column: 44
          },
          end: {
            line: 82,
            column: 3
          }
        },
        line: 79
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 84,
            column: 2
          },
          end: {
            line: 84,
            column: 3
          }
        },
        loc: {
          start: {
            line: 84,
            column: 26
          },
          end: {
            line: 90,
            column: 3
          }
        },
        line: 84
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 92,
            column: 2
          },
          end: {
            line: 92,
            column: 3
          }
        },
        loc: {
          start: {
            line: 92,
            column: 17
          },
          end: {
            line: 95,
            column: 3
          }
        },
        line: 92
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 7,
            column: 4
          },
          end: {
            line: 9,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 7,
            column: 4
          },
          end: {
            line: 9,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 7
      },
      "1": {
        loc: {
          start: {
            line: 25,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 25,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 25
      },
      "2": {
        loc: {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 35
      },
      "3": {
        loc: {
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 45,
            column: 43
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 45,
            column: 25
          },
          end: {
            line: 45,
            column: 33
          }
        }, {
          start: {
            line: 45,
            column: 36
          },
          end: {
            line: 45,
            column: 43
          }
        }],
        line: 45
      },
      "4": {
        loc: {
          start: {
            line: 57,
            column: 4
          },
          end: {
            line: 59,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 57,
            column: 4
          },
          end: {
            line: 59,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 57
      },
      "5": {
        loc: {
          start: {
            line: 57,
            column: 8
          },
          end: {
            line: 57,
            column: 80
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 57,
            column: 8
          },
          end: {
            line: 57,
            column: 38
          }
        }, {
          start: {
            line: 57,
            column: 42
          },
          end: {
            line: 57,
            column: 80
          }
        }],
        line: 57
      },
      "6": {
        loc: {
          start: {
            line: 74,
            column: 21
          },
          end: {
            line: 74,
            column: 36
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 74,
            column: 32
          },
          end: {
            line: 74,
            column: 36
          }
        }],
        line: 74
      },
      "7": {
        loc: {
          start: {
            line: 76,
            column: 11
          },
          end: {
            line: 76,
            column: 65
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 76,
            column: 22
          },
          end: {
            line: 76,
            column: 47
          }
        }, {
          start: {
            line: 76,
            column: 50
          },
          end: {
            line: 76,
            column: 65
          }
        }],
        line: 76
      },
      "8": {
        loc: {
          start: {
            line: 79,
            column: 32
          },
          end: {
            line: 79,
            column: 42
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 79,
            column: 40
          },
          end: {
            line: 79,
            column: 42
          }
        }],
        line: 79
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0],
      "7": [0, 0],
      "8": [0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "0ddc0c117b44345a055f71cf573ab3d80011b267"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_rf87ke4hw = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_rf87ke4hw();
class WalletManager {
  constructor() {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[0]++;
    cov_rf87ke4hw().s[0]++;
    this.wallets = new Map();
  }
  createWallet(userId) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[1]++;
    cov_rf87ke4hw().s[1]++;
    if (this.wallets.has(userId)) {
      /* istanbul ignore next */
      cov_rf87ke4hw().b[0][0]++;
      cov_rf87ke4hw().s[2]++;
      return {
        success: false,
        reason: 'Wallet already exists'
      };
    } else
    /* istanbul ignore next */
    {
      cov_rf87ke4hw().b[0][1]++;
    }
    const wallet =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[3]++, {
      userId,
      balances: {
        AZR: 0,
        BTC: 0,
        ETH: 0,
        USD: 0
      },
      transactions: [],
      createdAt: new Date(),
      address: this.generateAddress(userId)
    });
    /* istanbul ignore next */
    cov_rf87ke4hw().s[4]++;
    this.wallets.set(userId, wallet);
    /* istanbul ignore next */
    cov_rf87ke4hw().s[5]++;
    return {
      success: true,
      wallet
    };
  }
  getWallet(userId) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[2]++;
    let wallet =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[6]++, this.wallets.get(userId));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[7]++;
    if (!wallet) {
      /* istanbul ignore next */
      cov_rf87ke4hw().b[1][0]++;
      const result =
      /* istanbul ignore next */
      (cov_rf87ke4hw().s[8]++, this.createWallet(userId));
      /* istanbul ignore next */
      cov_rf87ke4hw().s[9]++;
      wallet = result.wallet;
    } else
    /* istanbul ignore next */
    {
      cov_rf87ke4hw().b[1][1]++;
    }
    cov_rf87ke4hw().s[10]++;
    return wallet;
  }
  updateBalance(userId, currency, amount) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[3]++;
    const wallet =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[11]++, this.getWallet(userId));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[12]++;
    if (!wallet.balances.hasOwnProperty(currency)) {
      /* istanbul ignore next */
      cov_rf87ke4hw().b[2][0]++;
      cov_rf87ke4hw().s[13]++;
      wallet.balances[currency] = 0;
    } else
    /* istanbul ignore next */
    {
      cov_rf87ke4hw().b[2][1]++;
    }
    cov_rf87ke4hw().s[14]++;
    wallet.balances[currency] += amount;
    const transaction =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[15]++, {
      txId: this.generateTxId(),
      currency,
      amount,
      type: amount > 0 ?
      /* istanbul ignore next */
      (cov_rf87ke4hw().b[3][0]++, 'credit') :
      /* istanbul ignore next */
      (cov_rf87ke4hw().b[3][1]++, 'debit'),
      balance: wallet.balances[currency],
      timestamp: new Date()
    });
    /* istanbul ignore next */
    cov_rf87ke4hw().s[16]++;
    wallet.transactions.push(transaction);
    /* istanbul ignore next */
    cov_rf87ke4hw().s[17]++;
    return {
      success: true,
      transaction,
      newBalance: wallet.balances[currency]
    };
  }
  transfer(fromUserId, toUserId, currency, amount) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[4]++;
    const fromWallet =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[18]++, this.getWallet(fromUserId));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[19]++;
    if (
    /* istanbul ignore next */
    (cov_rf87ke4hw().b[5][0]++, !fromWallet.balances[currency]) ||
    /* istanbul ignore next */
    (cov_rf87ke4hw().b[5][1]++, fromWallet.balances[currency] < amount)) {
      /* istanbul ignore next */
      cov_rf87ke4hw().b[4][0]++;
      cov_rf87ke4hw().s[20]++;
      return {
        success: false,
        reason: 'Insufficient balance'
      };
    } else
    /* istanbul ignore next */
    {
      cov_rf87ke4hw().b[4][1]++;
    }
    cov_rf87ke4hw().s[21]++;
    this.updateBalance(fromUserId, currency, -amount);
    /* istanbul ignore next */
    cov_rf87ke4hw().s[22]++;
    this.updateBalance(toUserId, currency, amount);
    /* istanbul ignore next */
    cov_rf87ke4hw().s[23]++;
    return {
      success: true,
      from: fromUserId,
      to: toUserId,
      amount,
      currency,
      timestamp: new Date()
    };
  }
  getBalance(userId, currency =
  /* istanbul ignore next */
  (cov_rf87ke4hw().b[6][0]++, null)) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[5]++;
    const wallet =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[24]++, this.getWallet(userId));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[25]++;
    return currency ?
    /* istanbul ignore next */
    (cov_rf87ke4hw().b[7][0]++, wallet.balances[currency]) :
    /* istanbul ignore next */
    (cov_rf87ke4hw().b[7][1]++, wallet.balances);
  }
  getTransactionHistory(userId, limit =
  /* istanbul ignore next */
  (cov_rf87ke4hw().b[8][0]++, 50)) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[6]++;
    const wallet =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[26]++, this.getWallet(userId));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[27]++;
    return wallet.transactions.slice(-limit).reverse();
  }
  generateAddress(userId) {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[7]++;
    const crypto =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[28]++, require('crypto'));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[29]++;
    return 'AZR' + crypto.createHash('sha256').update(userId + Date.now().toString()).digest('hex').substring(0, 40);
  }
  generateTxId() {
    /* istanbul ignore next */
    cov_rf87ke4hw().f[8]++;
    const crypto =
    /* istanbul ignore next */
    (cov_rf87ke4hw().s[30]++, require('crypto'));
    /* istanbul ignore next */
    cov_rf87ke4hw().s[31]++;
    return crypto.randomBytes(16).toString('hex');
  }
}
/* istanbul ignore next */
cov_rf87ke4hw().s[32]++;
module.exports = new WalletManager();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfcmY4N2tlNGh3IiwiYWN0dWFsQ292ZXJhZ2UiLCJXYWxsZXRNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJmIiwicyIsIndhbGxldHMiLCJNYXAiLCJjcmVhdGVXYWxsZXQiLCJ1c2VySWQiLCJoYXMiLCJiIiwic3VjY2VzcyIsInJlYXNvbiIsIndhbGxldCIsImJhbGFuY2VzIiwiQVpSIiwiQlRDIiwiRVRIIiwiVVNEIiwidHJhbnNhY3Rpb25zIiwiY3JlYXRlZEF0IiwiRGF0ZSIsImFkZHJlc3MiLCJnZW5lcmF0ZUFkZHJlc3MiLCJzZXQiLCJnZXRXYWxsZXQiLCJnZXQiLCJyZXN1bHQiLCJ1cGRhdGVCYWxhbmNlIiwiY3VycmVuY3kiLCJhbW91bnQiLCJoYXNPd25Qcm9wZXJ0eSIsInRyYW5zYWN0aW9uIiwidHhJZCIsImdlbmVyYXRlVHhJZCIsInR5cGUiLCJiYWxhbmNlIiwidGltZXN0YW1wIiwicHVzaCIsIm5ld0JhbGFuY2UiLCJ0cmFuc2ZlciIsImZyb21Vc2VySWQiLCJ0b1VzZXJJZCIsImZyb21XYWxsZXQiLCJmcm9tIiwidG8iLCJnZXRCYWxhbmNlIiwiZ2V0VHJhbnNhY3Rpb25IaXN0b3J5IiwibGltaXQiLCJzbGljZSIsInJldmVyc2UiLCJjcnlwdG8iLCJyZXF1aXJlIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwiZGlnZXN0Iiwic3Vic3RyaW5nIiwicmFuZG9tQnl0ZXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsid2FsbGV0LW1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgV2FsbGV0TWFuYWdlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMud2FsbGV0cyA9IG5ldyBNYXAoKTtcbiAgfVxuXG4gIGNyZWF0ZVdhbGxldCh1c2VySWQpIHtcbiAgICBpZiAodGhpcy53YWxsZXRzLmhhcyh1c2VySWQpKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgcmVhc29uOiAnV2FsbGV0IGFscmVhZHkgZXhpc3RzJyB9O1xuICAgIH1cblxuICAgIGNvbnN0IHdhbGxldCA9IHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJhbGFuY2VzOiB7IEFaUjogMCwgQlRDOiAwLCBFVEg6IDAsIFVTRDogMCB9LFxuICAgICAgdHJhbnNhY3Rpb25zOiBbXSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIGFkZHJlc3M6IHRoaXMuZ2VuZXJhdGVBZGRyZXNzKHVzZXJJZClcbiAgICB9O1xuXG4gICAgdGhpcy53YWxsZXRzLnNldCh1c2VySWQsIHdhbGxldCk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgd2FsbGV0IH07XG4gIH1cblxuICBnZXRXYWxsZXQodXNlcklkKSB7XG4gICAgbGV0IHdhbGxldCA9IHRoaXMud2FsbGV0cy5nZXQodXNlcklkKTtcbiAgICBpZiAoIXdhbGxldCkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5jcmVhdGVXYWxsZXQodXNlcklkKTtcbiAgICAgIHdhbGxldCA9IHJlc3VsdC53YWxsZXQ7XG4gICAgfVxuICAgIHJldHVybiB3YWxsZXQ7XG4gIH1cblxuICB1cGRhdGVCYWxhbmNlKHVzZXJJZCwgY3VycmVuY3ksIGFtb3VudCkge1xuICAgIGNvbnN0IHdhbGxldCA9IHRoaXMuZ2V0V2FsbGV0KHVzZXJJZCk7XG4gICAgXG4gICAgaWYgKCF3YWxsZXQuYmFsYW5jZXMuaGFzT3duUHJvcGVydHkoY3VycmVuY3kpKSB7XG4gICAgICB3YWxsZXQuYmFsYW5jZXNbY3VycmVuY3ldID0gMDtcbiAgICB9XG5cbiAgICB3YWxsZXQuYmFsYW5jZXNbY3VycmVuY3ldICs9IGFtb3VudDtcblxuICAgIGNvbnN0IHRyYW5zYWN0aW9uID0ge1xuICAgICAgdHhJZDogdGhpcy5nZW5lcmF0ZVR4SWQoKSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgYW1vdW50LFxuICAgICAgdHlwZTogYW1vdW50ID4gMCA/ICdjcmVkaXQnIDogJ2RlYml0JyxcbiAgICAgIGJhbGFuY2U6IHdhbGxldC5iYWxhbmNlc1tjdXJyZW5jeV0sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICB9O1xuXG4gICAgd2FsbGV0LnRyYW5zYWN0aW9ucy5wdXNoKHRyYW5zYWN0aW9uKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0cmFuc2FjdGlvbiwgbmV3QmFsYW5jZTogd2FsbGV0LmJhbGFuY2VzW2N1cnJlbmN5XSB9O1xuICB9XG5cbiAgdHJhbnNmZXIoZnJvbVVzZXJJZCwgdG9Vc2VySWQsIGN1cnJlbmN5LCBhbW91bnQpIHtcbiAgICBjb25zdCBmcm9tV2FsbGV0ID0gdGhpcy5nZXRXYWxsZXQoZnJvbVVzZXJJZCk7XG4gICAgXG4gICAgaWYgKCFmcm9tV2FsbGV0LmJhbGFuY2VzW2N1cnJlbmN5XSB8fCBmcm9tV2FsbGV0LmJhbGFuY2VzW2N1cnJlbmN5XSA8IGFtb3VudCkge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHJlYXNvbjogJ0luc3VmZmljaWVudCBiYWxhbmNlJyB9O1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlQmFsYW5jZShmcm9tVXNlcklkLCBjdXJyZW5jeSwgLWFtb3VudCk7XG4gICAgdGhpcy51cGRhdGVCYWxhbmNlKHRvVXNlcklkLCBjdXJyZW5jeSwgYW1vdW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZnJvbTogZnJvbVVzZXJJZCxcbiAgICAgIHRvOiB0b1VzZXJJZCxcbiAgICAgIGFtb3VudCxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfTtcbiAgfVxuXG4gIGdldEJhbGFuY2UodXNlcklkLCBjdXJyZW5jeSA9IG51bGwpIHtcbiAgICBjb25zdCB3YWxsZXQgPSB0aGlzLmdldFdhbGxldCh1c2VySWQpO1xuICAgIHJldHVybiBjdXJyZW5jeSA/IHdhbGxldC5iYWxhbmNlc1tjdXJyZW5jeV0gOiB3YWxsZXQuYmFsYW5jZXM7XG4gIH1cblxuICBnZXRUcmFuc2FjdGlvbkhpc3RvcnkodXNlcklkLCBsaW1pdCA9IDUwKSB7XG4gICAgY29uc3Qgd2FsbGV0ID0gdGhpcy5nZXRXYWxsZXQodXNlcklkKTtcbiAgICByZXR1cm4gd2FsbGV0LnRyYW5zYWN0aW9ucy5zbGljZSgtbGltaXQpLnJldmVyc2UoKTtcbiAgfVxuXG4gIGdlbmVyYXRlQWRkcmVzcyh1c2VySWQpIHtcbiAgICBjb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbiAgICByZXR1cm4gJ0FaUicgKyBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JylcbiAgICAgIC51cGRhdGUodXNlcklkICsgRGF0ZS5ub3coKS50b1N0cmluZygpKVxuICAgICAgLmRpZ2VzdCgnaGV4JylcbiAgICAgIC5zdWJzdHJpbmcoMCwgNDApO1xuICB9XG5cbiAgZ2VuZXJhdGVUeElkKCkge1xuICAgIGNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xuICAgIHJldHVybiBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBXYWxsZXRNYW5hZ2VyKCk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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