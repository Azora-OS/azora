{"version":3,"names":["cov_1tu6wa5hv9","actualCoverage","PrismaClient","EventEmitter","prisma","s","EscrowService","createEscrowAccount","data","f","projectId","sellerId","buyerId","amount","currency","b","autoReleaseDays","milestones","Error","length","totalPercentage","reduce","sum","m","percentage","Math","abs","autoReleaseDate","Date","setDate","getDate","escrow","id","now","random","toString","substr","status","createdAt","map","escrowId","forEach","emitEvent","fundEscrow","transactionHash","fundedAt","releaseFunds","release","userId","type","milestoneId","refundEscrow","reason","disputeEscrow","disputeReason","autoReleaseFunds","getEscrow","getUserEscrows","getEscrowStats","total","totalValue","byStatus","event","console","log"],"sources":["escrowService.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright ¬© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nimport { PrismaClient } from '@prisma/client';\nimport { EventEmitter } from 'events';\n\nconst prisma = new PrismaClient();\n\nexport interface EscrowAccount {\n  id: string;\n  projectId: string;\n  sellerId: string;\n  buyerId: string;\n  amount: number;\n  currency: string;\n  status: 'pending' | 'funded' | 'released' | 'disputed' | 'refunded' | 'cancelled';\n  milestones?: EscrowMilestone[];\n  createdAt: Date;\n  fundedAt?: Date;\n  releasedAt?: Date;\n  autoReleaseDate?: Date;\n  transactionHash?: string;\n  notes?: string;\n}\n\nexport interface EscrowMilestone {\n  id: string;\n  escrowId: string;\n  name: string;\n  description: string;\n  amount: number;\n  percentage: number;\n  status: 'pending' | 'completed' | 'approved' | 'released';\n  dueDate?: Date;\n  completedAt?: Date;\n  approvedAt?: Date;\n  releasedAt?: Date;\n}\n\nexport interface EscrowRelease {\n  type: 'full' | 'partial' | 'milestone';\n  amount: number;\n  milestoneId?: string;\n  reason?: string;\n  approvedBy: 'buyer' | 'auto' | 'admin' | 'dispute_resolution';\n}\n\n/**\n * üîí ESCROW SERVICE - The Trust Engine of Azora Forge\n * \n * Holds funds safely until work is completed and approved.\n * Protects both buyers (money held safely) and sellers (guaranteed payment).\n */\nexport class EscrowService extends EventEmitter {\n  \n  /**\n   * Create an escrow account for a project\n   * Money is not held yet - this just creates the account\n   */\n  static async createEscrowAccount(data: {\n    projectId: string;\n    sellerId: string;\n    buyerId: string;\n    amount: number;\n    currency?: string;\n    autoReleaseDays?: number;\n    milestones?: Omit<EscrowMilestone, 'id' | 'escrowId' | 'status'>[];\n  }): Promise<EscrowAccount> {\n    const {\n      projectId,\n      sellerId,\n      buyerId,\n      amount,\n      currency = 'AZR',\n      autoReleaseDays = 7,\n      milestones\n    } = data;\n\n    // Validate amount\n    if (amount <= 0) {\n      throw new Error('Escrow amount must be greater than 0');\n    }\n\n    // If milestones provided, validate they add up to 100%\n    if (milestones && milestones.length > 0) {\n      const totalPercentage = milestones.reduce((sum, m) => sum + m.percentage, 0);\n      if (Math.abs(totalPercentage - 100) > 0.01) {\n        throw new Error('Milestone percentages must add up to 100%');\n      }\n    }\n\n    const autoReleaseDate = new Date();\n    autoReleaseDate.setDate(autoReleaseDate.getDate() + autoReleaseDays);\n\n    const escrow: EscrowAccount = {\n      id: `escrow_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      projectId,\n      sellerId,\n      buyerId,\n      amount,\n      currency,\n      status: 'pending',\n      createdAt: new Date(),\n      autoReleaseDate,\n      milestones: milestones?.map(m => ({\n        ...m,\n        id: `milestone_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        escrowId: '', // Will be set below\n        status: 'pending' as const\n      }))\n    };\n\n    // Set escrowId for milestones\n    if (escrow.milestones) {\n      escrow.milestones.forEach(m => m.escrowId = escrow.id);\n    }\n\n    // TODO: Save to database\n    // await prisma.escrowAccount.create({ data: escrow });\n\n    this.emitEvent('escrow:created', escrow);\n\n    return escrow;\n  }\n\n  /**\n   * Fund the escrow account\n   * This is when buyer actually puts money in\n   */\n  static async fundEscrow(escrowId: string, transactionHash: string): Promise<EscrowAccount> {\n    // TODO: Fetch from database\n    // const escrow = await prisma.escrowAccount.findUnique({ where: { id: escrowId } });\n\n    // Validate escrow exists and is in pending state\n    // if (!escrow || escrow.status !== 'pending') {\n    //   throw new Error('Escrow not found or not in pending state');\n    // }\n\n    // Call Mint API to verify transaction and hold funds\n    // await MintService.holdFunds({\n    //   amount: escrow.amount,\n    //   currency: escrow.currency,\n    //   fromUserId: escrow.buyerId,\n    //   escrowId: escrow.id,\n    //   transactionHash\n    // });\n\n    // Update escrow status\n    // await prisma.escrowAccount.update({\n    //   where: { id: escrowId },\n    //   data: {\n    //     status: 'funded',\n    //     fundedAt: new Date(),\n    //     transactionHash\n    //   }\n    // });\n\n    const escrow = {\n      id: escrowId,\n      status: 'funded' as const,\n      fundedAt: new Date(),\n      transactionHash\n    };\n\n    this.emitEvent('escrow:funded', escrow);\n\n    return escrow as EscrowAccount;\n  }\n\n  /**\n   * Release funds to seller\n   * Can be full release or partial/milestone release\n   */\n  static async releaseFunds(\n    escrowId: string,\n    release: EscrowRelease,\n    userId: string\n  ): Promise<EscrowAccount> {\n    // TODO: Fetch from database\n    // const escrow = await prisma.escrowAccount.findUnique({\n    //   where: { id: escrowId },\n    //   include: { milestones: true }\n    // });\n\n    // Validate escrow is funded\n    // if (!escrow || escrow.status !== 'funded') {\n    //   throw new Error('Escrow not found or not funded');\n    // }\n\n    // Validate user is authorized (buyer, admin, or auto-release)\n    // if (release.approvedBy === 'buyer' && userId !== escrow.buyerId) {\n    //   throw new Error('Only buyer can approve release');\n    // }\n\n    // Process release based on type\n    if (release.type === 'full') {\n      // Release all funds\n      // await MintService.releaseFunds({\n      //   escrowId,\n      //   amount: escrow.amount,\n      //   toUserId: escrow.sellerId,\n      //   reason: release.reason\n      // });\n\n      // Update escrow\n      // await prisma.escrowAccount.update({\n      //   where: { id: escrowId },\n      //   data: {\n      //     status: 'released',\n      //     releasedAt: new Date()\n      //   }\n      // });\n\n      this.emitEvent('escrow:released:full', { escrowId, amount: release.amount });\n\n    } else if (release.type === 'milestone' && release.milestoneId) {\n      // Release milestone funds\n      // const milestone = escrow.milestones.find(m => m.id === release.milestoneId);\n      // if (!milestone) throw new Error('Milestone not found');\n\n      // await MintService.releaseFunds({\n      //   escrowId,\n      //   amount: milestone.amount,\n      //   toUserId: escrow.sellerId,\n      //   reason: `Milestone: ${milestone.name}`\n      // });\n\n      // await prisma.escrowMilestone.update({\n      //   where: { id: milestone.id },\n      //   data: {\n      //     status: 'released',\n      //     releasedAt: new Date()\n      //   }\n      // });\n\n      this.emitEvent('escrow:released:milestone', { escrowId, milestoneId: release.milestoneId });\n\n    } else if (release.type === 'partial') {\n      // Release partial funds\n      // await MintService.releaseFunds({\n      //   escrowId,\n      //   amount: release.amount,\n      //   toUserId: escrow.sellerId,\n      //   reason: release.reason\n      // });\n\n      this.emitEvent('escrow:released:partial', { escrowId, amount: release.amount });\n    }\n\n    return { id: escrowId } as EscrowAccount;\n  }\n\n  /**\n   * Refund funds to buyer\n   * Used when project is cancelled or dispute resolved in buyer's favor\n   */\n  static async refundEscrow(\n    escrowId: string,\n    reason: string,\n    userId: string\n  ): Promise<EscrowAccount> {\n    // TODO: Fetch from database\n    // const escrow = await prisma.escrowAccount.findUnique({ where: { id: escrowId } });\n\n    // Validate escrow is funded or disputed\n    // if (!escrow || !['funded', 'disputed'].includes(escrow.status)) {\n    //   throw new Error('Escrow not found or cannot be refunded');\n    // }\n\n    // Release funds back to buyer via Mint\n    // await MintService.releaseFunds({\n    //   escrowId,\n    //   amount: escrow.amount,\n    //   toUserId: escrow.buyerId,\n    //   reason: `Refund: ${reason}`\n    // });\n\n    // Update escrow\n    // await prisma.escrowAccount.update({\n    //   where: { id: escrowId },\n    //   data: {\n    //     status: 'refunded',\n    //     notes: reason\n    //   }\n    // });\n\n    this.emitEvent('escrow:refunded', { escrowId, reason });\n\n    return { id: escrowId, status: 'refunded' } as EscrowAccount;\n  }\n\n  /**\n   * Dispute an escrow\n   * Freezes funds until dispute is resolved\n   */\n  static async disputeEscrow(\n    escrowId: string,\n    disputeReason: string,\n    userId: string\n  ): Promise<void> {\n    // TODO: Fetch from database\n    // const escrow = await prisma.escrowAccount.findUnique({ where: { id: escrowId } });\n\n    // Validate user is buyer or seller\n    // if (userId !== escrow.buyerId && userId !== escrow.sellerId) {\n    //   throw new Error('Only buyer or seller can open dispute');\n    // }\n\n    // Update escrow status\n    // await prisma.escrowAccount.update({\n    //   where: { id: escrowId },\n    //   data: {\n    //     status: 'disputed',\n    //     notes: disputeReason\n    //   }\n    // });\n\n    // Create dispute in dispute system\n    // await DisputeService.createDispute({\n    //   escrowId,\n    //   reason: disputeReason,\n    //   initiatedBy: userId\n    // });\n\n    this.emitEvent('escrow:disputed', { escrowId, reason: disputeReason, userId });\n  }\n\n  /**\n   * Auto-release funds after deadline\n   * Runs as a cron job - checks for escrows past auto-release date\n   */\n  static async autoReleaseFunds(): Promise<void> {\n    // TODO: Find escrows past auto-release date\n    // const escrows = await prisma.escrowAccount.findMany({\n    //   where: {\n    //     status: 'funded',\n    //     autoReleaseDate: { lte: new Date() }\n    //   }\n    // });\n\n    // for (const escrow of escrows) {\n    //   try {\n    //     await this.releaseFunds(\n    //       escrow.id,\n    //       { type: 'full', amount: escrow.amount, approvedBy: 'auto' },\n    //       'system'\n    //     );\n    //     console.log(`‚úÖ Auto-released escrow ${escrow.id}`);\n    //   } catch (error) {\n    //     console.error(`‚ùå Failed to auto-release escrow ${escrow.id}:`, error);\n    //   }\n    // }\n\n    this.emitEvent('escrow:auto_release:complete', {});\n  }\n\n  /**\n   * Get escrow details\n   */\n  static async getEscrow(escrowId: string): Promise<EscrowAccount | null> {\n    // TODO: Fetch from database\n    // return await prisma.escrowAccount.findUnique({\n    //   where: { id: escrowId },\n    //   include: { milestones: true }\n    // });\n    return null;\n  }\n\n  /**\n   * Get all escrows for a user (buyer or seller)\n   */\n  static async getUserEscrows(userId: string): Promise<EscrowAccount[]> {\n    // TODO: Fetch from database\n    // return await prisma.escrowAccount.findMany({\n    //   where: {\n    //     OR: [\n    //       { buyerId: userId },\n    //       { sellerId: userId }\n    //     ]\n    //   },\n    //   include: { milestones: true },\n    //   orderBy: { createdAt: 'desc' }\n    // });\n    return [];\n  }\n\n  /**\n   * Get escrow statistics\n   */\n  static async getEscrowStats(): Promise<{\n    total: number;\n    totalValue: number;\n    byStatus: Record<string, number>;\n  }> {\n    // TODO: Aggregate from database\n    // const stats = await prisma.escrowAccount.aggregate({\n    //   _count: true,\n    //   _sum: { amount: true }\n    // });\n\n    // const byStatus = await prisma.escrowAccount.groupBy({\n    //   by: ['status'],\n    //   _count: true\n    // });\n\n    return {\n      total: 0,\n      totalValue: 0,\n      byStatus: {}\n    };\n  }\n\n  private static emitEvent(event: string, data: any) {\n    console.log(`üîî Escrow Event: ${event}`, data);\n    // Emit to organism event bus\n    // OrganismEventBus.emit(event, data);\n  }\n}\n"],"mappings":"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","ignoreList":[]}