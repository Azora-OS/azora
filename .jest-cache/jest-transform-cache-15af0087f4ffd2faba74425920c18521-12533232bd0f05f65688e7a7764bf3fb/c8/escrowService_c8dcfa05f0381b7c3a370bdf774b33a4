aeaf8fd0849dbe44c235428de7393838
/* istanbul ignore next */
function cov_1tu6wa5hv9() {
  var path = "/workspaces/azora/services/azora-forge/src/escrow/escrowService.ts";
  var hash = "10c686c28aa4df6bf0713e910d4e9447ee7b1eba";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/azora-forge/src/escrow/escrowService.ts",
    statementMap: {
      "0": {
        start: {
          line: 12,
          column: 15
        },
        end: {
          line: 12,
          column: 33
        }
      },
      "1": {
        start: {
          line: 82,
          column: 8
        },
        end: {
          line: 82,
          column: 12
        }
      },
      "2": {
        start: {
          line: 85,
          column: 4
        },
        end: {
          line: 87,
          column: 5
        }
      },
      "3": {
        start: {
          line: 86,
          column: 6
        },
        end: {
          line: 86,
          column: 62
        }
      },
      "4": {
        start: {
          line: 90,
          column: 4
        },
        end: {
          line: 95,
          column: 5
        }
      },
      "5": {
        start: {
          line: 91,
          column: 30
        },
        end: {
          line: 91,
          column: 82
        }
      },
      "6": {
        start: {
          line: 91,
          column: 60
        },
        end: {
          line: 91,
          column: 78
        }
      },
      "7": {
        start: {
          line: 92,
          column: 6
        },
        end: {
          line: 94,
          column: 7
        }
      },
      "8": {
        start: {
          line: 93,
          column: 8
        },
        end: {
          line: 93,
          column: 69
        }
      },
      "9": {
        start: {
          line: 97,
          column: 28
        },
        end: {
          line: 97,
          column: 38
        }
      },
      "10": {
        start: {
          line: 98,
          column: 4
        },
        end: {
          line: 98,
          column: 73
        }
      },
      "11": {
        start: {
          line: 100,
          column: 34
        },
        end: {
          line: 116,
          column: 5
        }
      },
      "12": {
        start: {
          line: 110,
          column: 40
        },
        end: {
          line: 115,
          column: 7
        }
      },
      "13": {
        start: {
          line: 119,
          column: 4
        },
        end: {
          line: 121,
          column: 5
        }
      },
      "14": {
        start: {
          line: 120,
          column: 6
        },
        end: {
          line: 120,
          column: 61
        }
      },
      "15": {
        start: {
          line: 120,
          column: 37
        },
        end: {
          line: 120,
          column: 59
        }
      },
      "16": {
        start: {
          line: 126,
          column: 4
        },
        end: {
          line: 126,
          column: 45
        }
      },
      "17": {
        start: {
          line: 128,
          column: 4
        },
        end: {
          line: 128,
          column: 18
        }
      },
      "18": {
        start: {
          line: 163,
          column: 19
        },
        end: {
          line: 168,
          column: 5
        }
      },
      "19": {
        start: {
          line: 170,
          column: 4
        },
        end: {
          line: 170,
          column: 44
        }
      },
      "20": {
        start: {
          line: 172,
          column: 4
        },
        end: {
          line: 172,
          column: 35
        }
      },
      "21": {
        start: {
          line: 201,
          column: 4
        },
        end: {
          line: 253,
          column: 5
        }
      },
      "22": {
        start: {
          line: 219,
          column: 6
        },
        end: {
          line: 219,
          column: 83
        }
      },
      "23": {
        start: {
          line: 221,
          column: 11
        },
        end: {
          line: 253,
          column: 5
        }
      },
      "24": {
        start: {
          line: 241,
          column: 6
        },
        end: {
          line: 241,
          column: 98
        }
      },
      "25": {
        start: {
          line: 243,
          column: 11
        },
        end: {
          line: 253,
          column: 5
        }
      },
      "26": {
        start: {
          line: 252,
          column: 6
        },
        end: {
          line: 252,
          column: 86
        }
      },
      "27": {
        start: {
          line: 255,
          column: 4
        },
        end: {
          line: 255,
          column: 45
        }
      },
      "28": {
        start: {
          line: 292,
          column: 4
        },
        end: {
          line: 292,
          column: 60
        }
      },
      "29": {
        start: {
          line: 294,
          column: 4
        },
        end: {
          line: 294,
          column: 65
        }
      },
      "30": {
        start: {
          line: 330,
          column: 4
        },
        end: {
          line: 330,
          column: 83
        }
      },
      "31": {
        start: {
          line: 359,
          column: 4
        },
        end: {
          line: 359,
          column: 55
        }
      },
      "32": {
        start: {
          line: 371,
          column: 4
        },
        end: {
          line: 371,
          column: 16
        }
      },
      "33": {
        start: {
          line: 389,
          column: 4
        },
        end: {
          line: 389,
          column: 14
        }
      },
      "34": {
        start: {
          line: 411,
          column: 4
        },
        end: {
          line: 415,
          column: 6
        }
      },
      "35": {
        start: {
          line: 419,
          column: 4
        },
        end: {
          line: 419,
          column: 51
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 65,
            column: 2
          },
          end: {
            line: 65,
            column: 3
          }
        },
        loc: {
          start: {
            line: 73,
            column: 29
          },
          end: {
            line: 129,
            column: 3
          }
        },
        line: 73
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 91,
            column: 48
          },
          end: {
            line: 91,
            column: 49
          }
        },
        loc: {
          start: {
            line: 91,
            column: 60
          },
          end: {
            line: 91,
            column: 78
          }
        },
        line: 91
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 110,
            column: 34
          },
          end: {
            line: 110,
            column: 35
          }
        },
        loc: {
          start: {
            line: 110,
            column: 40
          },
          end: {
            line: 115,
            column: 7
          }
        },
        line: 110
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 120,
            column: 32
          },
          end: {
            line: 120,
            column: 33
          }
        },
        loc: {
          start: {
            line: 120,
            column: 37
          },
          end: {
            line: 120,
            column: 59
          }
        },
        line: 120
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 135,
            column: 2
          },
          end: {
            line: 135,
            column: 3
          }
        },
        loc: {
          start: {
            line: 135,
            column: 93
          },
          end: {
            line: 173,
            column: 3
          }
        },
        line: 135
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 179,
            column: 2
          },
          end: {
            line: 179,
            column: 3
          }
        },
        loc: {
          start: {
            line: 183,
            column: 28
          },
          end: {
            line: 256,
            column: 3
          }
        },
        line: 183
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 262,
            column: 2
          },
          end: {
            line: 262,
            column: 3
          }
        },
        loc: {
          start: {
            line: 266,
            column: 28
          },
          end: {
            line: 295,
            column: 3
          }
        },
        line: 266
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 301,
            column: 2
          },
          end: {
            line: 301,
            column: 3
          }
        },
        loc: {
          start: {
            line: 305,
            column: 19
          },
          end: {
            line: 331,
            column: 3
          }
        },
        line: 305
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 337,
            column: 2
          },
          end: {
            line: 337,
            column: 3
          }
        },
        loc: {
          start: {
            line: 337,
            column: 49
          },
          end: {
            line: 360,
            column: 3
          }
        },
        line: 337
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 365,
            column: 2
          },
          end: {
            line: 365,
            column: 3
          }
        },
        loc: {
          start: {
            line: 365,
            column: 74
          },
          end: {
            line: 372,
            column: 3
          }
        },
        line: 365
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 377,
            column: 2
          },
          end: {
            line: 377,
            column: 3
          }
        },
        loc: {
          start: {
            line: 377,
            column: 72
          },
          end: {
            line: 390,
            column: 3
          }
        },
        line: 377
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 395,
            column: 2
          },
          end: {
            line: 395,
            column: 3
          }
        },
        loc: {
          start: {
            line: 399,
            column: 5
          },
          end: {
            line: 416,
            column: 3
          }
        },
        line: 399
      },
      "12": {
        name: "(anonymous_12)",
        decl: {
          start: {
            line: 418,
            column: 2
          },
          end: {
            line: 418,
            column: 3
          }
        },
        loc: {
          start: {
            line: 418,
            column: 53
          },
          end: {
            line: 422,
            column: 3
          }
        },
        line: 418
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 79,
            column: 6
          },
          end: {
            line: 79,
            column: 22
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 79,
            column: 17
          },
          end: {
            line: 79,
            column: 22
          }
        }],
        line: 79
      },
      "1": {
        loc: {
          start: {
            line: 80,
            column: 6
          },
          end: {
            line: 80,
            column: 25
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 80,
            column: 24
          },
          end: {
            line: 80,
            column: 25
          }
        }],
        line: 80
      },
      "2": {
        loc: {
          start: {
            line: 85,
            column: 4
          },
          end: {
            line: 87,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 85,
            column: 4
          },
          end: {
            line: 87,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 85
      },
      "3": {
        loc: {
          start: {
            line: 90,
            column: 4
          },
          end: {
            line: 95,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 90,
            column: 4
          },
          end: {
            line: 95,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 90
      },
      "4": {
        loc: {
          start: {
            line: 90,
            column: 8
          },
          end: {
            line: 90,
            column: 43
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 90,
            column: 8
          },
          end: {
            line: 90,
            column: 18
          }
        }, {
          start: {
            line: 90,
            column: 22
          },
          end: {
            line: 90,
            column: 43
          }
        }],
        line: 90
      },
      "5": {
        loc: {
          start: {
            line: 92,
            column: 6
          },
          end: {
            line: 94,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 92,
            column: 6
          },
          end: {
            line: 94,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 92
      },
      "6": {
        loc: {
          start: {
            line: 119,
            column: 4
          },
          end: {
            line: 121,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 119,
            column: 4
          },
          end: {
            line: 121,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 119
      },
      "7": {
        loc: {
          start: {
            line: 201,
            column: 4
          },
          end: {
            line: 253,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 201,
            column: 4
          },
          end: {
            line: 253,
            column: 5
          }
        }, {
          start: {
            line: 221,
            column: 11
          },
          end: {
            line: 253,
            column: 5
          }
        }],
        line: 201
      },
      "8": {
        loc: {
          start: {
            line: 221,
            column: 11
          },
          end: {
            line: 253,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 221,
            column: 11
          },
          end: {
            line: 253,
            column: 5
          }
        }, {
          start: {
            line: 243,
            column: 11
          },
          end: {
            line: 253,
            column: 5
          }
        }],
        line: 221
      },
      "9": {
        loc: {
          start: {
            line: 221,
            column: 15
          },
          end: {
            line: 221,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 221,
            column: 15
          },
          end: {
            line: 221,
            column: 43
          }
        }, {
          start: {
            line: 221,
            column: 47
          },
          end: {
            line: 221,
            column: 66
          }
        }],
        line: 221
      },
      "10": {
        loc: {
          start: {
            line: 243,
            column: 11
          },
          end: {
            line: 253,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 243,
            column: 11
          },
          end: {
            line: 253,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 243
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0
    },
    b: {
      "0": [0],
      "1": [0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "10c686c28aa4df6bf0713e910d4e9447ee7b1eba"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1tu6wa5hv9 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1tu6wa5hv9();
/*
AZORA PROPRIETARY LICENSE

Copyright ¬© 2025 Azora ES (Pty) Ltd. All Rights Reserved.

See LICENSE file for details.
*/

import { PrismaClient } from '@prisma/client';
import { EventEmitter } from 'events';
const prisma =
/* istanbul ignore next */
(cov_1tu6wa5hv9().s[0]++, new PrismaClient());
/**
 * üîí ESCROW SERVICE - The Trust Engine of Azora Forge
 * 
 * Holds funds safely until work is completed and approved.
 * Protects both buyers (money held safely) and sellers (guaranteed payment).
 */
export class EscrowService extends EventEmitter {
  /**
   * Create an escrow account for a project
   * Money is not held yet - this just creates the account
   */
  static async createEscrowAccount(data) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[0]++;
    const {
      projectId,
      sellerId,
      buyerId,
      amount,
      currency =
      /* istanbul ignore next */
      (cov_1tu6wa5hv9().b[0][0]++, 'AZR'),
      autoReleaseDays =
      /* istanbul ignore next */
      (cov_1tu6wa5hv9().b[1][0]++, 7),
      milestones
    } =
    /* istanbul ignore next */
    (cov_1tu6wa5hv9().s[1]++, data);

    // Validate amount
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[2]++;
    if (amount <= 0) {
      /* istanbul ignore next */
      cov_1tu6wa5hv9().b[2][0]++;
      cov_1tu6wa5hv9().s[3]++;
      throw new Error('Escrow amount must be greater than 0');
    } else
    /* istanbul ignore next */
    {
      cov_1tu6wa5hv9().b[2][1]++;
    }

    // If milestones provided, validate they add up to 100%
    cov_1tu6wa5hv9().s[4]++;
    if (
    /* istanbul ignore next */
    (cov_1tu6wa5hv9().b[4][0]++, milestones) &&
    /* istanbul ignore next */
    (cov_1tu6wa5hv9().b[4][1]++, milestones.length > 0)) {
      /* istanbul ignore next */
      cov_1tu6wa5hv9().b[3][0]++;
      const totalPercentage =
      /* istanbul ignore next */
      (cov_1tu6wa5hv9().s[5]++, milestones.reduce((sum, m) => {
        /* istanbul ignore next */
        cov_1tu6wa5hv9().f[1]++;
        cov_1tu6wa5hv9().s[6]++;
        return sum + m.percentage;
      }, 0));
      /* istanbul ignore next */
      cov_1tu6wa5hv9().s[7]++;
      if (Math.abs(totalPercentage - 100) > 0.01) {
        /* istanbul ignore next */
        cov_1tu6wa5hv9().b[5][0]++;
        cov_1tu6wa5hv9().s[8]++;
        throw new Error('Milestone percentages must add up to 100%');
      } else
      /* istanbul ignore next */
      {
        cov_1tu6wa5hv9().b[5][1]++;
      }
    } else
    /* istanbul ignore next */
    {
      cov_1tu6wa5hv9().b[3][1]++;
    }
    const autoReleaseDate =
    /* istanbul ignore next */
    (cov_1tu6wa5hv9().s[9]++, new Date());
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[10]++;
    autoReleaseDate.setDate(autoReleaseDate.getDate() + autoReleaseDays);
    const escrow =
    /* istanbul ignore next */
    (cov_1tu6wa5hv9().s[11]++, {
      id: `escrow_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      projectId,
      sellerId,
      buyerId,
      amount,
      currency,
      status: 'pending',
      createdAt: new Date(),
      autoReleaseDate,
      milestones: milestones?.map(m => {
        /* istanbul ignore next */
        cov_1tu6wa5hv9().f[2]++;
        cov_1tu6wa5hv9().s[12]++;
        return {
          ...m,
          id: `milestone_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          escrowId: '',
          // Will be set below
          status: 'pending'
        };
      })
    });

    // Set escrowId for milestones
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[13]++;
    if (escrow.milestones) {
      /* istanbul ignore next */
      cov_1tu6wa5hv9().b[6][0]++;
      cov_1tu6wa5hv9().s[14]++;
      escrow.milestones.forEach(m => {
        /* istanbul ignore next */
        cov_1tu6wa5hv9().f[3]++;
        cov_1tu6wa5hv9().s[15]++;
        return m.escrowId = escrow.id;
      });
    } else
    /* istanbul ignore next */
    {
      cov_1tu6wa5hv9().b[6][1]++;
    }

    // TODO: Save to database
    // await prisma.escrowAccount.create({ data: escrow });
    cov_1tu6wa5hv9().s[16]++;
    this.emitEvent('escrow:created', escrow);
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[17]++;
    return escrow;
  }

  /**
   * Fund the escrow account
   * This is when buyer actually puts money in
   */
  static async fundEscrow(escrowId, transactionHash) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[4]++;
    // TODO: Fetch from database
    // const escrow = await prisma.escrowAccount.findUnique({ where: { id: escrowId } });

    // Validate escrow exists and is in pending state
    // if (!escrow || escrow.status !== 'pending') {
    //   throw new Error('Escrow not found or not in pending state');
    // }

    // Call Mint API to verify transaction and hold funds
    // await MintService.holdFunds({
    //   amount: escrow.amount,
    //   currency: escrow.currency,
    //   fromUserId: escrow.buyerId,
    //   escrowId: escrow.id,
    //   transactionHash
    // });

    // Update escrow status
    // await prisma.escrowAccount.update({
    //   where: { id: escrowId },
    //   data: {
    //     status: 'funded',
    //     fundedAt: new Date(),
    //     transactionHash
    //   }
    // });

    const escrow =
    /* istanbul ignore next */
    (cov_1tu6wa5hv9().s[18]++, {
      id: escrowId,
      status: 'funded',
      fundedAt: new Date(),
      transactionHash
    });
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[19]++;
    this.emitEvent('escrow:funded', escrow);
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[20]++;
    return escrow;
  }

  /**
   * Release funds to seller
   * Can be full release or partial/milestone release
   */
  static async releaseFunds(escrowId, release, userId) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[5]++;
    cov_1tu6wa5hv9().s[21]++;
    // TODO: Fetch from database
    // const escrow = await prisma.escrowAccount.findUnique({
    //   where: { id: escrowId },
    //   include: { milestones: true }
    // });

    // Validate escrow is funded
    // if (!escrow || escrow.status !== 'funded') {
    //   throw new Error('Escrow not found or not funded');
    // }

    // Validate user is authorized (buyer, admin, or auto-release)
    // if (release.approvedBy === 'buyer' && userId !== escrow.buyerId) {
    //   throw new Error('Only buyer can approve release');
    // }

    // Process release based on type
    if (release.type === 'full') {
      /* istanbul ignore next */
      cov_1tu6wa5hv9().b[7][0]++;
      cov_1tu6wa5hv9().s[22]++;
      // Release all funds
      // await MintService.releaseFunds({
      //   escrowId,
      //   amount: escrow.amount,
      //   toUserId: escrow.sellerId,
      //   reason: release.reason
      // });

      // Update escrow
      // await prisma.escrowAccount.update({
      //   where: { id: escrowId },
      //   data: {
      //     status: 'released',
      //     releasedAt: new Date()
      //   }
      // });

      this.emitEvent('escrow:released:full', {
        escrowId,
        amount: release.amount
      });
    } else {
      /* istanbul ignore next */
      cov_1tu6wa5hv9().b[7][1]++;
      cov_1tu6wa5hv9().s[23]++;
      if (
      /* istanbul ignore next */
      (cov_1tu6wa5hv9().b[9][0]++, release.type === 'milestone') &&
      /* istanbul ignore next */
      (cov_1tu6wa5hv9().b[9][1]++, release.milestoneId)) {
        /* istanbul ignore next */
        cov_1tu6wa5hv9().b[8][0]++;
        cov_1tu6wa5hv9().s[24]++;
        // Release milestone funds
        // const milestone = escrow.milestones.find(m => m.id === release.milestoneId);
        // if (!milestone) throw new Error('Milestone not found');

        // await MintService.releaseFunds({
        //   escrowId,
        //   amount: milestone.amount,
        //   toUserId: escrow.sellerId,
        //   reason: `Milestone: ${milestone.name}`
        // });

        // await prisma.escrowMilestone.update({
        //   where: { id: milestone.id },
        //   data: {
        //     status: 'released',
        //     releasedAt: new Date()
        //   }
        // });

        this.emitEvent('escrow:released:milestone', {
          escrowId,
          milestoneId: release.milestoneId
        });
      } else {
        /* istanbul ignore next */
        cov_1tu6wa5hv9().b[8][1]++;
        cov_1tu6wa5hv9().s[25]++;
        if (release.type === 'partial') {
          /* istanbul ignore next */
          cov_1tu6wa5hv9().b[10][0]++;
          cov_1tu6wa5hv9().s[26]++;
          // Release partial funds
          // await MintService.releaseFunds({
          //   escrowId,
          //   amount: release.amount,
          //   toUserId: escrow.sellerId,
          //   reason: release.reason
          // });

          this.emitEvent('escrow:released:partial', {
            escrowId,
            amount: release.amount
          });
        } else
        /* istanbul ignore next */
        {
          cov_1tu6wa5hv9().b[10][1]++;
        }
      }
    }
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[27]++;
    return {
      id: escrowId
    };
  }

  /**
   * Refund funds to buyer
   * Used when project is cancelled or dispute resolved in buyer's favor
   */
  static async refundEscrow(escrowId, reason, userId) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[6]++;
    cov_1tu6wa5hv9().s[28]++;
    // TODO: Fetch from database
    // const escrow = await prisma.escrowAccount.findUnique({ where: { id: escrowId } });

    // Validate escrow is funded or disputed
    // if (!escrow || !['funded', 'disputed'].includes(escrow.status)) {
    //   throw new Error('Escrow not found or cannot be refunded');
    // }

    // Release funds back to buyer via Mint
    // await MintService.releaseFunds({
    //   escrowId,
    //   amount: escrow.amount,
    //   toUserId: escrow.buyerId,
    //   reason: `Refund: ${reason}`
    // });

    // Update escrow
    // await prisma.escrowAccount.update({
    //   where: { id: escrowId },
    //   data: {
    //     status: 'refunded',
    //     notes: reason
    //   }
    // });

    this.emitEvent('escrow:refunded', {
      escrowId,
      reason
    });
    /* istanbul ignore next */
    cov_1tu6wa5hv9().s[29]++;
    return {
      id: escrowId,
      status: 'refunded'
    };
  }

  /**
   * Dispute an escrow
   * Freezes funds until dispute is resolved
   */
  static async disputeEscrow(escrowId, disputeReason, userId) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[7]++;
    cov_1tu6wa5hv9().s[30]++;
    // TODO: Fetch from database
    // const escrow = await prisma.escrowAccount.findUnique({ where: { id: escrowId } });

    // Validate user is buyer or seller
    // if (userId !== escrow.buyerId && userId !== escrow.sellerId) {
    //   throw new Error('Only buyer or seller can open dispute');
    // }

    // Update escrow status
    // await prisma.escrowAccount.update({
    //   where: { id: escrowId },
    //   data: {
    //     status: 'disputed',
    //     notes: disputeReason
    //   }
    // });

    // Create dispute in dispute system
    // await DisputeService.createDispute({
    //   escrowId,
    //   reason: disputeReason,
    //   initiatedBy: userId
    // });

    this.emitEvent('escrow:disputed', {
      escrowId,
      reason: disputeReason,
      userId
    });
  }

  /**
   * Auto-release funds after deadline
   * Runs as a cron job - checks for escrows past auto-release date
   */
  static async autoReleaseFunds() {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[8]++;
    cov_1tu6wa5hv9().s[31]++;
    // TODO: Find escrows past auto-release date
    // const escrows = await prisma.escrowAccount.findMany({
    //   where: {
    //     status: 'funded',
    //     autoReleaseDate: { lte: new Date() }
    //   }
    // });

    // for (const escrow of escrows) {
    //   try {
    //     await this.releaseFunds(
    //       escrow.id,
    //       { type: 'full', amount: escrow.amount, approvedBy: 'auto' },
    //       'system'
    //     );
    //     console.log(`‚úÖ Auto-released escrow ${escrow.id}`);
    //   } catch (error) {
    //     console.error(`‚ùå Failed to auto-release escrow ${escrow.id}:`, error);
    //   }
    // }

    this.emitEvent('escrow:auto_release:complete', {});
  }

  /**
   * Get escrow details
   */
  static async getEscrow(escrowId) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[9]++;
    cov_1tu6wa5hv9().s[32]++;
    // TODO: Fetch from database
    // return await prisma.escrowAccount.findUnique({
    //   where: { id: escrowId },
    //   include: { milestones: true }
    // });
    return null;
  }

  /**
   * Get all escrows for a user (buyer or seller)
   */
  static async getUserEscrows(userId) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[10]++;
    cov_1tu6wa5hv9().s[33]++;
    // TODO: Fetch from database
    // return await prisma.escrowAccount.findMany({
    //   where: {
    //     OR: [
    //       { buyerId: userId },
    //       { sellerId: userId }
    //     ]
    //   },
    //   include: { milestones: true },
    //   orderBy: { createdAt: 'desc' }
    // });
    return [];
  }

  /**
   * Get escrow statistics
   */
  static async getEscrowStats() {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[11]++;
    cov_1tu6wa5hv9().s[34]++;
    // TODO: Aggregate from database
    // const stats = await prisma.escrowAccount.aggregate({
    //   _count: true,
    //   _sum: { amount: true }
    // });

    // const byStatus = await prisma.escrowAccount.groupBy({
    //   by: ['status'],
    //   _count: true
    // });

    return {
      total: 0,
      totalValue: 0,
      byStatus: {}
    };
  }
  static emitEvent(event, data) {
    /* istanbul ignore next */
    cov_1tu6wa5hv9().f[12]++;
    cov_1tu6wa5hv9().s[35]++;
    console.log(`üîî Escrow Event: ${event}`, data);
    // Emit to organism event bus
    // OrganismEventBus.emit(event, data);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMXR1NndhNWh2OSIsImFjdHVhbENvdmVyYWdlIiwiUHJpc21hQ2xpZW50IiwiRXZlbnRFbWl0dGVyIiwicHJpc21hIiwicyIsIkVzY3Jvd1NlcnZpY2UiLCJjcmVhdGVFc2Nyb3dBY2NvdW50IiwiZGF0YSIsImYiLCJwcm9qZWN0SWQiLCJzZWxsZXJJZCIsImJ1eWVySWQiLCJhbW91bnQiLCJjdXJyZW5jeSIsImIiLCJhdXRvUmVsZWFzZURheXMiLCJtaWxlc3RvbmVzIiwiRXJyb3IiLCJsZW5ndGgiLCJ0b3RhbFBlcmNlbnRhZ2UiLCJyZWR1Y2UiLCJzdW0iLCJtIiwicGVyY2VudGFnZSIsIk1hdGgiLCJhYnMiLCJhdXRvUmVsZWFzZURhdGUiLCJEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJlc2Nyb3ciLCJpZCIsIm5vdyIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwic3RhdHVzIiwiY3JlYXRlZEF0IiwibWFwIiwiZXNjcm93SWQiLCJmb3JFYWNoIiwiZW1pdEV2ZW50IiwiZnVuZEVzY3JvdyIsInRyYW5zYWN0aW9uSGFzaCIsImZ1bmRlZEF0IiwicmVsZWFzZUZ1bmRzIiwicmVsZWFzZSIsInVzZXJJZCIsInR5cGUiLCJtaWxlc3RvbmVJZCIsInJlZnVuZEVzY3JvdyIsInJlYXNvbiIsImRpc3B1dGVFc2Nyb3ciLCJkaXNwdXRlUmVhc29uIiwiYXV0b1JlbGVhc2VGdW5kcyIsImdldEVzY3JvdyIsImdldFVzZXJFc2Nyb3dzIiwiZ2V0RXNjcm93U3RhdHMiLCJ0b3RhbCIsInRvdGFsVmFsdWUiLCJieVN0YXR1cyIsImV2ZW50IiwiY29uc29sZSIsImxvZyJdLCJzb3VyY2VzIjpbImVzY3Jvd1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkFaT1JBIFBST1BSSUVUQVJZIExJQ0VOU0VcblxuQ29weXJpZ2h0IMKpIDIwMjUgQXpvcmEgRVMgKFB0eSkgTHRkLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuXG5TZWUgTElDRU5TRSBmaWxlIGZvciBkZXRhaWxzLlxuKi9cblxuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5leHBvcnQgaW50ZXJmYWNlIEVzY3Jvd0FjY291bnQge1xuICBpZDogc3RyaW5nO1xuICBwcm9qZWN0SWQ6IHN0cmluZztcbiAgc2VsbGVySWQ6IHN0cmluZztcbiAgYnV5ZXJJZDogc3RyaW5nO1xuICBhbW91bnQ6IG51bWJlcjtcbiAgY3VycmVuY3k6IHN0cmluZztcbiAgc3RhdHVzOiAncGVuZGluZycgfCAnZnVuZGVkJyB8ICdyZWxlYXNlZCcgfCAnZGlzcHV0ZWQnIHwgJ3JlZnVuZGVkJyB8ICdjYW5jZWxsZWQnO1xuICBtaWxlc3RvbmVzPzogRXNjcm93TWlsZXN0b25lW107XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbiAgZnVuZGVkQXQ/OiBEYXRlO1xuICByZWxlYXNlZEF0PzogRGF0ZTtcbiAgYXV0b1JlbGVhc2VEYXRlPzogRGF0ZTtcbiAgdHJhbnNhY3Rpb25IYXNoPzogc3RyaW5nO1xuICBub3Rlcz86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFc2Nyb3dNaWxlc3RvbmUge1xuICBpZDogc3RyaW5nO1xuICBlc2Nyb3dJZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGFtb3VudDogbnVtYmVyO1xuICBwZXJjZW50YWdlOiBudW1iZXI7XG4gIHN0YXR1czogJ3BlbmRpbmcnIHwgJ2NvbXBsZXRlZCcgfCAnYXBwcm92ZWQnIHwgJ3JlbGVhc2VkJztcbiAgZHVlRGF0ZT86IERhdGU7XG4gIGNvbXBsZXRlZEF0PzogRGF0ZTtcbiAgYXBwcm92ZWRBdD86IERhdGU7XG4gIHJlbGVhc2VkQXQ/OiBEYXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVzY3Jvd1JlbGVhc2Uge1xuICB0eXBlOiAnZnVsbCcgfCAncGFydGlhbCcgfCAnbWlsZXN0b25lJztcbiAgYW1vdW50OiBudW1iZXI7XG4gIG1pbGVzdG9uZUlkPzogc3RyaW5nO1xuICByZWFzb24/OiBzdHJpbmc7XG4gIGFwcHJvdmVkQnk6ICdidXllcicgfCAnYXV0bycgfCAnYWRtaW4nIHwgJ2Rpc3B1dGVfcmVzb2x1dGlvbic7XG59XG5cbi8qKlxuICog8J+UkiBFU0NST1cgU0VSVklDRSAtIFRoZSBUcnVzdCBFbmdpbmUgb2YgQXpvcmEgRm9yZ2VcbiAqIFxuICogSG9sZHMgZnVuZHMgc2FmZWx5IHVudGlsIHdvcmsgaXMgY29tcGxldGVkIGFuZCBhcHByb3ZlZC5cbiAqIFByb3RlY3RzIGJvdGggYnV5ZXJzIChtb25leSBoZWxkIHNhZmVseSkgYW5kIHNlbGxlcnMgKGd1YXJhbnRlZWQgcGF5bWVudCkuXG4gKi9cbmV4cG9ydCBjbGFzcyBFc2Nyb3dTZXJ2aWNlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gZXNjcm93IGFjY291bnQgZm9yIGEgcHJvamVjdFxuICAgKiBNb25leSBpcyBub3QgaGVsZCB5ZXQgLSB0aGlzIGp1c3QgY3JlYXRlcyB0aGUgYWNjb3VudFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNyZWF0ZUVzY3Jvd0FjY291bnQoZGF0YToge1xuICAgIHByb2plY3RJZDogc3RyaW5nO1xuICAgIHNlbGxlcklkOiBzdHJpbmc7XG4gICAgYnV5ZXJJZDogc3RyaW5nO1xuICAgIGFtb3VudDogbnVtYmVyO1xuICAgIGN1cnJlbmN5Pzogc3RyaW5nO1xuICAgIGF1dG9SZWxlYXNlRGF5cz86IG51bWJlcjtcbiAgICBtaWxlc3RvbmVzPzogT21pdDxFc2Nyb3dNaWxlc3RvbmUsICdpZCcgfCAnZXNjcm93SWQnIHwgJ3N0YXR1cyc+W107XG4gIH0pOiBQcm9taXNlPEVzY3Jvd0FjY291bnQ+IHtcbiAgICBjb25zdCB7XG4gICAgICBwcm9qZWN0SWQsXG4gICAgICBzZWxsZXJJZCxcbiAgICAgIGJ1eWVySWQsXG4gICAgICBhbW91bnQsXG4gICAgICBjdXJyZW5jeSA9ICdBWlInLFxuICAgICAgYXV0b1JlbGVhc2VEYXlzID0gNyxcbiAgICAgIG1pbGVzdG9uZXNcbiAgICB9ID0gZGF0YTtcblxuICAgIC8vIFZhbGlkYXRlIGFtb3VudFxuICAgIGlmIChhbW91bnQgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFc2Nyb3cgYW1vdW50IG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICB9XG5cbiAgICAvLyBJZiBtaWxlc3RvbmVzIHByb3ZpZGVkLCB2YWxpZGF0ZSB0aGV5IGFkZCB1cCB0byAxMDAlXG4gICAgaWYgKG1pbGVzdG9uZXMgJiYgbWlsZXN0b25lcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCB0b3RhbFBlcmNlbnRhZ2UgPSBtaWxlc3RvbmVzLnJlZHVjZSgoc3VtLCBtKSA9PiBzdW0gKyBtLnBlcmNlbnRhZ2UsIDApO1xuICAgICAgaWYgKE1hdGguYWJzKHRvdGFsUGVyY2VudGFnZSAtIDEwMCkgPiAwLjAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWlsZXN0b25lIHBlcmNlbnRhZ2VzIG11c3QgYWRkIHVwIHRvIDEwMCUnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBhdXRvUmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGF1dG9SZWxlYXNlRGF0ZS5zZXREYXRlKGF1dG9SZWxlYXNlRGF0ZS5nZXREYXRlKCkgKyBhdXRvUmVsZWFzZURheXMpO1xuXG4gICAgY29uc3QgZXNjcm93OiBFc2Nyb3dBY2NvdW50ID0ge1xuICAgICAgaWQ6IGBlc2Nyb3dfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgcHJvamVjdElkLFxuICAgICAgc2VsbGVySWQsXG4gICAgICBidXllcklkLFxuICAgICAgYW1vdW50LFxuICAgICAgY3VycmVuY3ksXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIGF1dG9SZWxlYXNlRGF0ZSxcbiAgICAgIG1pbGVzdG9uZXM6IG1pbGVzdG9uZXM/Lm1hcChtID0+ICh7XG4gICAgICAgIC4uLm0sXG4gICAgICAgIGlkOiBgbWlsZXN0b25lXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgZXNjcm93SWQ6ICcnLCAvLyBXaWxsIGJlIHNldCBiZWxvd1xuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyBhcyBjb25zdFxuICAgICAgfSkpXG4gICAgfTtcblxuICAgIC8vIFNldCBlc2Nyb3dJZCBmb3IgbWlsZXN0b25lc1xuICAgIGlmIChlc2Nyb3cubWlsZXN0b25lcykge1xuICAgICAgZXNjcm93Lm1pbGVzdG9uZXMuZm9yRWFjaChtID0+IG0uZXNjcm93SWQgPSBlc2Nyb3cuaWQpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IFNhdmUgdG8gZGF0YWJhc2VcbiAgICAvLyBhd2FpdCBwcmlzbWEuZXNjcm93QWNjb3VudC5jcmVhdGUoeyBkYXRhOiBlc2Nyb3cgfSk7XG5cbiAgICB0aGlzLmVtaXRFdmVudCgnZXNjcm93OmNyZWF0ZWQnLCBlc2Nyb3cpO1xuXG4gICAgcmV0dXJuIGVzY3JvdztcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5kIHRoZSBlc2Nyb3cgYWNjb3VudFxuICAgKiBUaGlzIGlzIHdoZW4gYnV5ZXIgYWN0dWFsbHkgcHV0cyBtb25leSBpblxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGZ1bmRFc2Nyb3coZXNjcm93SWQ6IHN0cmluZywgdHJhbnNhY3Rpb25IYXNoOiBzdHJpbmcpOiBQcm9taXNlPEVzY3Jvd0FjY291bnQ+IHtcbiAgICAvLyBUT0RPOiBGZXRjaCBmcm9tIGRhdGFiYXNlXG4gICAgLy8gY29uc3QgZXNjcm93ID0gYXdhaXQgcHJpc21hLmVzY3Jvd0FjY291bnQuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkOiBlc2Nyb3dJZCB9IH0pO1xuXG4gICAgLy8gVmFsaWRhdGUgZXNjcm93IGV4aXN0cyBhbmQgaXMgaW4gcGVuZGluZyBzdGF0ZVxuICAgIC8vIGlmICghZXNjcm93IHx8IGVzY3Jvdy5zdGF0dXMgIT09ICdwZW5kaW5nJykge1xuICAgIC8vICAgdGhyb3cgbmV3IEVycm9yKCdFc2Nyb3cgbm90IGZvdW5kIG9yIG5vdCBpbiBwZW5kaW5nIHN0YXRlJyk7XG4gICAgLy8gfVxuXG4gICAgLy8gQ2FsbCBNaW50IEFQSSB0byB2ZXJpZnkgdHJhbnNhY3Rpb24gYW5kIGhvbGQgZnVuZHNcbiAgICAvLyBhd2FpdCBNaW50U2VydmljZS5ob2xkRnVuZHMoe1xuICAgIC8vICAgYW1vdW50OiBlc2Nyb3cuYW1vdW50LFxuICAgIC8vICAgY3VycmVuY3k6IGVzY3Jvdy5jdXJyZW5jeSxcbiAgICAvLyAgIGZyb21Vc2VySWQ6IGVzY3Jvdy5idXllcklkLFxuICAgIC8vICAgZXNjcm93SWQ6IGVzY3Jvdy5pZCxcbiAgICAvLyAgIHRyYW5zYWN0aW9uSGFzaFxuICAgIC8vIH0pO1xuXG4gICAgLy8gVXBkYXRlIGVzY3JvdyBzdGF0dXNcbiAgICAvLyBhd2FpdCBwcmlzbWEuZXNjcm93QWNjb3VudC51cGRhdGUoe1xuICAgIC8vICAgd2hlcmU6IHsgaWQ6IGVzY3Jvd0lkIH0sXG4gICAgLy8gICBkYXRhOiB7XG4gICAgLy8gICAgIHN0YXR1czogJ2Z1bmRlZCcsXG4gICAgLy8gICAgIGZ1bmRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIC8vICAgICB0cmFuc2FjdGlvbkhhc2hcbiAgICAvLyAgIH1cbiAgICAvLyB9KTtcblxuICAgIGNvbnN0IGVzY3JvdyA9IHtcbiAgICAgIGlkOiBlc2Nyb3dJZCxcbiAgICAgIHN0YXR1czogJ2Z1bmRlZCcgYXMgY29uc3QsXG4gICAgICBmdW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHRyYW5zYWN0aW9uSGFzaFxuICAgIH07XG5cbiAgICB0aGlzLmVtaXRFdmVudCgnZXNjcm93OmZ1bmRlZCcsIGVzY3Jvdyk7XG5cbiAgICByZXR1cm4gZXNjcm93IGFzIEVzY3Jvd0FjY291bnQ7XG4gIH1cblxuICAvKipcbiAgICogUmVsZWFzZSBmdW5kcyB0byBzZWxsZXJcbiAgICogQ2FuIGJlIGZ1bGwgcmVsZWFzZSBvciBwYXJ0aWFsL21pbGVzdG9uZSByZWxlYXNlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgcmVsZWFzZUZ1bmRzKFxuICAgIGVzY3Jvd0lkOiBzdHJpbmcsXG4gICAgcmVsZWFzZTogRXNjcm93UmVsZWFzZSxcbiAgICB1c2VySWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPEVzY3Jvd0FjY291bnQ+IHtcbiAgICAvLyBUT0RPOiBGZXRjaCBmcm9tIGRhdGFiYXNlXG4gICAgLy8gY29uc3QgZXNjcm93ID0gYXdhaXQgcHJpc21hLmVzY3Jvd0FjY291bnQuZmluZFVuaXF1ZSh7XG4gICAgLy8gICB3aGVyZTogeyBpZDogZXNjcm93SWQgfSxcbiAgICAvLyAgIGluY2x1ZGU6IHsgbWlsZXN0b25lczogdHJ1ZSB9XG4gICAgLy8gfSk7XG5cbiAgICAvLyBWYWxpZGF0ZSBlc2Nyb3cgaXMgZnVuZGVkXG4gICAgLy8gaWYgKCFlc2Nyb3cgfHwgZXNjcm93LnN0YXR1cyAhPT0gJ2Z1bmRlZCcpIHtcbiAgICAvLyAgIHRocm93IG5ldyBFcnJvcignRXNjcm93IG5vdCBmb3VuZCBvciBub3QgZnVuZGVkJyk7XG4gICAgLy8gfVxuXG4gICAgLy8gVmFsaWRhdGUgdXNlciBpcyBhdXRob3JpemVkIChidXllciwgYWRtaW4sIG9yIGF1dG8tcmVsZWFzZSlcbiAgICAvLyBpZiAocmVsZWFzZS5hcHByb3ZlZEJ5ID09PSAnYnV5ZXInICYmIHVzZXJJZCAhPT0gZXNjcm93LmJ1eWVySWQpIHtcbiAgICAvLyAgIHRocm93IG5ldyBFcnJvcignT25seSBidXllciBjYW4gYXBwcm92ZSByZWxlYXNlJyk7XG4gICAgLy8gfVxuXG4gICAgLy8gUHJvY2VzcyByZWxlYXNlIGJhc2VkIG9uIHR5cGVcbiAgICBpZiAocmVsZWFzZS50eXBlID09PSAnZnVsbCcpIHtcbiAgICAgIC8vIFJlbGVhc2UgYWxsIGZ1bmRzXG4gICAgICAvLyBhd2FpdCBNaW50U2VydmljZS5yZWxlYXNlRnVuZHMoe1xuICAgICAgLy8gICBlc2Nyb3dJZCxcbiAgICAgIC8vICAgYW1vdW50OiBlc2Nyb3cuYW1vdW50LFxuICAgICAgLy8gICB0b1VzZXJJZDogZXNjcm93LnNlbGxlcklkLFxuICAgICAgLy8gICByZWFzb246IHJlbGVhc2UucmVhc29uXG4gICAgICAvLyB9KTtcblxuICAgICAgLy8gVXBkYXRlIGVzY3Jvd1xuICAgICAgLy8gYXdhaXQgcHJpc21hLmVzY3Jvd0FjY291bnQudXBkYXRlKHtcbiAgICAgIC8vICAgd2hlcmU6IHsgaWQ6IGVzY3Jvd0lkIH0sXG4gICAgICAvLyAgIGRhdGE6IHtcbiAgICAgIC8vICAgICBzdGF0dXM6ICdyZWxlYXNlZCcsXG4gICAgICAvLyAgICAgcmVsZWFzZWRBdDogbmV3IERhdGUoKVxuICAgICAgLy8gICB9XG4gICAgICAvLyB9KTtcblxuICAgICAgdGhpcy5lbWl0RXZlbnQoJ2VzY3JvdzpyZWxlYXNlZDpmdWxsJywgeyBlc2Nyb3dJZCwgYW1vdW50OiByZWxlYXNlLmFtb3VudCB9KTtcblxuICAgIH0gZWxzZSBpZiAocmVsZWFzZS50eXBlID09PSAnbWlsZXN0b25lJyAmJiByZWxlYXNlLm1pbGVzdG9uZUlkKSB7XG4gICAgICAvLyBSZWxlYXNlIG1pbGVzdG9uZSBmdW5kc1xuICAgICAgLy8gY29uc3QgbWlsZXN0b25lID0gZXNjcm93Lm1pbGVzdG9uZXMuZmluZChtID0+IG0uaWQgPT09IHJlbGVhc2UubWlsZXN0b25lSWQpO1xuICAgICAgLy8gaWYgKCFtaWxlc3RvbmUpIHRocm93IG5ldyBFcnJvcignTWlsZXN0b25lIG5vdCBmb3VuZCcpO1xuXG4gICAgICAvLyBhd2FpdCBNaW50U2VydmljZS5yZWxlYXNlRnVuZHMoe1xuICAgICAgLy8gICBlc2Nyb3dJZCxcbiAgICAgIC8vICAgYW1vdW50OiBtaWxlc3RvbmUuYW1vdW50LFxuICAgICAgLy8gICB0b1VzZXJJZDogZXNjcm93LnNlbGxlcklkLFxuICAgICAgLy8gICByZWFzb246IGBNaWxlc3RvbmU6ICR7bWlsZXN0b25lLm5hbWV9YFxuICAgICAgLy8gfSk7XG5cbiAgICAgIC8vIGF3YWl0IHByaXNtYS5lc2Nyb3dNaWxlc3RvbmUudXBkYXRlKHtcbiAgICAgIC8vICAgd2hlcmU6IHsgaWQ6IG1pbGVzdG9uZS5pZCB9LFxuICAgICAgLy8gICBkYXRhOiB7XG4gICAgICAvLyAgICAgc3RhdHVzOiAncmVsZWFzZWQnLFxuICAgICAgLy8gICAgIHJlbGVhc2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgIC8vICAgfVxuICAgICAgLy8gfSk7XG5cbiAgICAgIHRoaXMuZW1pdEV2ZW50KCdlc2Nyb3c6cmVsZWFzZWQ6bWlsZXN0b25lJywgeyBlc2Nyb3dJZCwgbWlsZXN0b25lSWQ6IHJlbGVhc2UubWlsZXN0b25lSWQgfSk7XG5cbiAgICB9IGVsc2UgaWYgKHJlbGVhc2UudHlwZSA9PT0gJ3BhcnRpYWwnKSB7XG4gICAgICAvLyBSZWxlYXNlIHBhcnRpYWwgZnVuZHNcbiAgICAgIC8vIGF3YWl0IE1pbnRTZXJ2aWNlLnJlbGVhc2VGdW5kcyh7XG4gICAgICAvLyAgIGVzY3Jvd0lkLFxuICAgICAgLy8gICBhbW91bnQ6IHJlbGVhc2UuYW1vdW50LFxuICAgICAgLy8gICB0b1VzZXJJZDogZXNjcm93LnNlbGxlcklkLFxuICAgICAgLy8gICByZWFzb246IHJlbGVhc2UucmVhc29uXG4gICAgICAvLyB9KTtcblxuICAgICAgdGhpcy5lbWl0RXZlbnQoJ2VzY3JvdzpyZWxlYXNlZDpwYXJ0aWFsJywgeyBlc2Nyb3dJZCwgYW1vdW50OiByZWxlYXNlLmFtb3VudCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBpZDogZXNjcm93SWQgfSBhcyBFc2Nyb3dBY2NvdW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZnVuZCBmdW5kcyB0byBidXllclxuICAgKiBVc2VkIHdoZW4gcHJvamVjdCBpcyBjYW5jZWxsZWQgb3IgZGlzcHV0ZSByZXNvbHZlZCBpbiBidXllcidzIGZhdm9yXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgcmVmdW5kRXNjcm93KFxuICAgIGVzY3Jvd0lkOiBzdHJpbmcsXG4gICAgcmVhc29uOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxFc2Nyb3dBY2NvdW50PiB7XG4gICAgLy8gVE9ETzogRmV0Y2ggZnJvbSBkYXRhYmFzZVxuICAgIC8vIGNvbnN0IGVzY3JvdyA9IGF3YWl0IHByaXNtYS5lc2Nyb3dBY2NvdW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogZXNjcm93SWQgfSB9KTtcblxuICAgIC8vIFZhbGlkYXRlIGVzY3JvdyBpcyBmdW5kZWQgb3IgZGlzcHV0ZWRcbiAgICAvLyBpZiAoIWVzY3JvdyB8fCAhWydmdW5kZWQnLCAnZGlzcHV0ZWQnXS5pbmNsdWRlcyhlc2Nyb3cuc3RhdHVzKSkge1xuICAgIC8vICAgdGhyb3cgbmV3IEVycm9yKCdFc2Nyb3cgbm90IGZvdW5kIG9yIGNhbm5vdCBiZSByZWZ1bmRlZCcpO1xuICAgIC8vIH1cblxuICAgIC8vIFJlbGVhc2UgZnVuZHMgYmFjayB0byBidXllciB2aWEgTWludFxuICAgIC8vIGF3YWl0IE1pbnRTZXJ2aWNlLnJlbGVhc2VGdW5kcyh7XG4gICAgLy8gICBlc2Nyb3dJZCxcbiAgICAvLyAgIGFtb3VudDogZXNjcm93LmFtb3VudCxcbiAgICAvLyAgIHRvVXNlcklkOiBlc2Nyb3cuYnV5ZXJJZCxcbiAgICAvLyAgIHJlYXNvbjogYFJlZnVuZDogJHtyZWFzb259YFxuICAgIC8vIH0pO1xuXG4gICAgLy8gVXBkYXRlIGVzY3Jvd1xuICAgIC8vIGF3YWl0IHByaXNtYS5lc2Nyb3dBY2NvdW50LnVwZGF0ZSh7XG4gICAgLy8gICB3aGVyZTogeyBpZDogZXNjcm93SWQgfSxcbiAgICAvLyAgIGRhdGE6IHtcbiAgICAvLyAgICAgc3RhdHVzOiAncmVmdW5kZWQnLFxuICAgIC8vICAgICBub3RlczogcmVhc29uXG4gICAgLy8gICB9XG4gICAgLy8gfSk7XG5cbiAgICB0aGlzLmVtaXRFdmVudCgnZXNjcm93OnJlZnVuZGVkJywgeyBlc2Nyb3dJZCwgcmVhc29uIH0pO1xuXG4gICAgcmV0dXJuIHsgaWQ6IGVzY3Jvd0lkLCBzdGF0dXM6ICdyZWZ1bmRlZCcgfSBhcyBFc2Nyb3dBY2NvdW50O1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3B1dGUgYW4gZXNjcm93XG4gICAqIEZyZWV6ZXMgZnVuZHMgdW50aWwgZGlzcHV0ZSBpcyByZXNvbHZlZFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGRpc3B1dGVFc2Nyb3coXG4gICAgZXNjcm93SWQ6IHN0cmluZyxcbiAgICBkaXNwdXRlUmVhc29uOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gVE9ETzogRmV0Y2ggZnJvbSBkYXRhYmFzZVxuICAgIC8vIGNvbnN0IGVzY3JvdyA9IGF3YWl0IHByaXNtYS5lc2Nyb3dBY2NvdW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogZXNjcm93SWQgfSB9KTtcblxuICAgIC8vIFZhbGlkYXRlIHVzZXIgaXMgYnV5ZXIgb3Igc2VsbGVyXG4gICAgLy8gaWYgKHVzZXJJZCAhPT0gZXNjcm93LmJ1eWVySWQgJiYgdXNlcklkICE9PSBlc2Nyb3cuc2VsbGVySWQpIHtcbiAgICAvLyAgIHRocm93IG5ldyBFcnJvcignT25seSBidXllciBvciBzZWxsZXIgY2FuIG9wZW4gZGlzcHV0ZScpO1xuICAgIC8vIH1cblxuICAgIC8vIFVwZGF0ZSBlc2Nyb3cgc3RhdHVzXG4gICAgLy8gYXdhaXQgcHJpc21hLmVzY3Jvd0FjY291bnQudXBkYXRlKHtcbiAgICAvLyAgIHdoZXJlOiB7IGlkOiBlc2Nyb3dJZCB9LFxuICAgIC8vICAgZGF0YToge1xuICAgIC8vICAgICBzdGF0dXM6ICdkaXNwdXRlZCcsXG4gICAgLy8gICAgIG5vdGVzOiBkaXNwdXRlUmVhc29uXG4gICAgLy8gICB9XG4gICAgLy8gfSk7XG5cbiAgICAvLyBDcmVhdGUgZGlzcHV0ZSBpbiBkaXNwdXRlIHN5c3RlbVxuICAgIC8vIGF3YWl0IERpc3B1dGVTZXJ2aWNlLmNyZWF0ZURpc3B1dGUoe1xuICAgIC8vICAgZXNjcm93SWQsXG4gICAgLy8gICByZWFzb246IGRpc3B1dGVSZWFzb24sXG4gICAgLy8gICBpbml0aWF0ZWRCeTogdXNlcklkXG4gICAgLy8gfSk7XG5cbiAgICB0aGlzLmVtaXRFdmVudCgnZXNjcm93OmRpc3B1dGVkJywgeyBlc2Nyb3dJZCwgcmVhc29uOiBkaXNwdXRlUmVhc29uLCB1c2VySWQgfSk7XG4gIH1cblxuICAvKipcbiAgICogQXV0by1yZWxlYXNlIGZ1bmRzIGFmdGVyIGRlYWRsaW5lXG4gICAqIFJ1bnMgYXMgYSBjcm9uIGpvYiAtIGNoZWNrcyBmb3IgZXNjcm93cyBwYXN0IGF1dG8tcmVsZWFzZSBkYXRlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYXV0b1JlbGVhc2VGdW5kcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBUT0RPOiBGaW5kIGVzY3Jvd3MgcGFzdCBhdXRvLXJlbGVhc2UgZGF0ZVxuICAgIC8vIGNvbnN0IGVzY3Jvd3MgPSBhd2FpdCBwcmlzbWEuZXNjcm93QWNjb3VudC5maW5kTWFueSh7XG4gICAgLy8gICB3aGVyZToge1xuICAgIC8vICAgICBzdGF0dXM6ICdmdW5kZWQnLFxuICAgIC8vICAgICBhdXRvUmVsZWFzZURhdGU6IHsgbHRlOiBuZXcgRGF0ZSgpIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9KTtcblxuICAgIC8vIGZvciAoY29uc3QgZXNjcm93IG9mIGVzY3Jvd3MpIHtcbiAgICAvLyAgIHRyeSB7XG4gICAgLy8gICAgIGF3YWl0IHRoaXMucmVsZWFzZUZ1bmRzKFxuICAgIC8vICAgICAgIGVzY3Jvdy5pZCxcbiAgICAvLyAgICAgICB7IHR5cGU6ICdmdWxsJywgYW1vdW50OiBlc2Nyb3cuYW1vdW50LCBhcHByb3ZlZEJ5OiAnYXV0bycgfSxcbiAgICAvLyAgICAgICAnc3lzdGVtJ1xuICAgIC8vICAgICApO1xuICAgIC8vICAgICBjb25zb2xlLmxvZyhg4pyFIEF1dG8tcmVsZWFzZWQgZXNjcm93ICR7ZXNjcm93LmlkfWApO1xuICAgIC8vICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byBhdXRvLXJlbGVhc2UgZXNjcm93ICR7ZXNjcm93LmlkfTpgLCBlcnJvcik7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG4gICAgdGhpcy5lbWl0RXZlbnQoJ2VzY3JvdzphdXRvX3JlbGVhc2U6Y29tcGxldGUnLCB7fSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVzY3JvdyBkZXRhaWxzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0RXNjcm93KGVzY3Jvd0lkOiBzdHJpbmcpOiBQcm9taXNlPEVzY3Jvd0FjY291bnQgfCBudWxsPiB7XG4gICAgLy8gVE9ETzogRmV0Y2ggZnJvbSBkYXRhYmFzZVxuICAgIC8vIHJldHVybiBhd2FpdCBwcmlzbWEuZXNjcm93QWNjb3VudC5maW5kVW5pcXVlKHtcbiAgICAvLyAgIHdoZXJlOiB7IGlkOiBlc2Nyb3dJZCB9LFxuICAgIC8vICAgaW5jbHVkZTogeyBtaWxlc3RvbmVzOiB0cnVlIH1cbiAgICAvLyB9KTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGVzY3Jvd3MgZm9yIGEgdXNlciAoYnV5ZXIgb3Igc2VsbGVyKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFVzZXJFc2Nyb3dzKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxFc2Nyb3dBY2NvdW50W10+IHtcbiAgICAvLyBUT0RPOiBGZXRjaCBmcm9tIGRhdGFiYXNlXG4gICAgLy8gcmV0dXJuIGF3YWl0IHByaXNtYS5lc2Nyb3dBY2NvdW50LmZpbmRNYW55KHtcbiAgICAvLyAgIHdoZXJlOiB7XG4gICAgLy8gICAgIE9SOiBbXG4gICAgLy8gICAgICAgeyBidXllcklkOiB1c2VySWQgfSxcbiAgICAvLyAgICAgICB7IHNlbGxlcklkOiB1c2VySWQgfVxuICAgIC8vICAgICBdXG4gICAgLy8gICB9LFxuICAgIC8vICAgaW5jbHVkZTogeyBtaWxlc3RvbmVzOiB0cnVlIH0sXG4gICAgLy8gICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1cbiAgICAvLyB9KTtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVzY3JvdyBzdGF0aXN0aWNzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0RXNjcm93U3RhdHMoKTogUHJvbWlzZTx7XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICB0b3RhbFZhbHVlOiBudW1iZXI7XG4gICAgYnlTdGF0dXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIH0+IHtcbiAgICAvLyBUT0RPOiBBZ2dyZWdhdGUgZnJvbSBkYXRhYmFzZVxuICAgIC8vIGNvbnN0IHN0YXRzID0gYXdhaXQgcHJpc21hLmVzY3Jvd0FjY291bnQuYWdncmVnYXRlKHtcbiAgICAvLyAgIF9jb3VudDogdHJ1ZSxcbiAgICAvLyAgIF9zdW06IHsgYW1vdW50OiB0cnVlIH1cbiAgICAvLyB9KTtcblxuICAgIC8vIGNvbnN0IGJ5U3RhdHVzID0gYXdhaXQgcHJpc21hLmVzY3Jvd0FjY291bnQuZ3JvdXBCeSh7XG4gICAgLy8gICBieTogWydzdGF0dXMnXSxcbiAgICAvLyAgIF9jb3VudDogdHJ1ZVxuICAgIC8vIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsOiAwLFxuICAgICAgdG90YWxWYWx1ZTogMCxcbiAgICAgIGJ5U3RhdHVzOiB7fVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBlbWl0RXZlbnQoZXZlbnQ6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgY29uc29sZS5sb2coYPCflJQgRXNjcm93IEV2ZW50OiAke2V2ZW50fWAsIGRhdGEpO1xuICAgIC8vIEVtaXQgdG8gb3JnYW5pc20gZXZlbnQgYnVzXG4gICAgLy8gT3JnYW5pc21FdmVudEJ1cy5lbWl0KGV2ZW50LCBkYXRhKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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