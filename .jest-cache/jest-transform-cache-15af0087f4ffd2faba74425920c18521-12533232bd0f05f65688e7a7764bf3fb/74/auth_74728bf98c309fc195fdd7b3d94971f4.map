{"version":3,"names":["cov_2fhegxgi0s","actualCoverage","jwt","s","require","JWT_SECRET","b","process","env","generateToken","learner","f","sign","id","email","level","ubuntu","expiresIn","verifyToken","req","res","next","token","header","replace","status","json","error","decoded","verify","requirePremium","premium","upgrade","rateLimiter","Map","rateLimit","maxRequests","windowMs","key","ip","connection","remoteAddress","now","Date","has","set","count","resetTime","limit","get","retryAfter","Math","ceil","module","exports"],"sources":["auth.js"],"sourcesContent":["// ðŸ” Authentication & Authorization Middleware\n\nconst jwt = require('jsonwebtoken');\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'azora-education-secret';\n\nconst generateToken = (learner) => {\n  return jwt.sign(\n    { \n      id: learner.id, \n      email: learner.email,\n      level: learner.level,\n      ubuntu: true \n    },\n    JWT_SECRET,\n    { expiresIn: '7d' }\n  );\n};\n\nconst verifyToken = (req, res, next) => {\n  const token = req.header('Authorization')?.replace('Bearer ', '');\n  \n  if (!token) {\n    return res.status(401).json({ error: 'Access denied. No token provided.' });\n  }\n\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET);\n    req.learner = decoded;\n    next();\n  } catch (error) {\n    res.status(400).json({ error: 'Invalid token.' });\n  }\n};\n\nconst requirePremium = (req, res, next) => {\n  if (!req.learner.premium) {\n    return res.status(403).json({ \n      error: 'Premium access required',\n      upgrade: 'Visit /premium to upgrade your account'\n    });\n  }\n  next();\n};\n\nconst rateLimiter = new Map();\n\nconst rateLimit = (maxRequests = 100, windowMs = 15 * 60 * 1000) => {\n  return (req, res, next) => {\n    const key = req.ip || req.connection.remoteAddress;\n    const now = Date.now();\n    \n    if (!rateLimiter.has(key)) {\n      rateLimiter.set(key, { count: 1, resetTime: now + windowMs });\n      return next();\n    }\n    \n    const limit = rateLimiter.get(key);\n    \n    if (now > limit.resetTime) {\n      limit.count = 1;\n      limit.resetTime = now + windowMs;\n      return next();\n    }\n    \n    if (limit.count >= maxRequests) {\n      return res.status(429).json({\n        error: 'Too many requests',\n        retryAfter: Math.ceil((limit.resetTime - now) / 1000)\n      });\n    }\n    \n    limit.count++;\n    next();\n  };\n};\n\nmodule.exports = {\n  generateToken,\n  verifyToken,\n  requirePremium,\n  rateLimit\n};"],"mappings":"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","ignoreList":[]}