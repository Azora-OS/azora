{"version":3,"names":["cov_1obopfk4n4","actualCoverage","helmet","rateLimit","mongoSanitize","hpp","configureSecurityHeaders","app","f","s","use","contentSecurityPolicy","directives","defaultSrc","scriptSrc","styleSrc","imgSrc","fontSrc","connectSrc","frameSrc","objectSrc","frameguard","action","noSniff","xssFilter","referrerPolicy","policy","permittedCrossDomainPolicies","permittedPolicies","configureRateLimiting","apiLimiter","windowMs","max","message","standardHeaders","legacyHeaders","authLimiter","skipSuccessfulRequests","configureSanitization","configureCORS","cors","require","corsOptions","origin","b","process","env","CORS_ORIGIN","credentials","methods","allowedHeaders","maxAge","securityHeadersMiddleware","req","res","next","setHeader","NODE_ENV","removeSensitiveHeaders","removeHeader","setupSecurityMiddleware"],"sources":["security-headers.ts"],"sourcesContent":["/**\n * Security Headers Middleware\n * Implements OWASP security best practices\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport helmet from 'helmet';\nimport rateLimit from 'express-rate-limit';\nimport mongoSanitize from 'express-mongo-sanitize';\nimport hpp from 'hpp';\n\n/**\n * Configure security headers\n */\nexport function configureSecurityHeaders(app: any) {\n  // Helmet for security headers\n  app.use(helmet());\n\n  // Content Security Policy\n  app.use(\n    helmet.contentSecurityPolicy({\n      directives: {\n        defaultSrc: [\"'self'\"],\n        scriptSrc: [\"'self'\", \"'unsafe-inline'\"],\n        styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n        imgSrc: [\"'self'\", 'data:', 'https:'],\n        fontSrc: [\"'self'\"],\n        connectSrc: [\"'self'\"],\n        frameSrc: [\"'none'\"],\n        objectSrc: [\"'none'\"],\n      },\n    })\n  );\n\n  // X-Frame-Options\n  app.use(helmet.frameguard({ action: 'deny' }));\n\n  // X-Content-Type-Options\n  app.use(helmet.noSniff());\n\n  // X-XSS-Protection\n  app.use(helmet.xssFilter());\n\n  // Referrer-Policy\n  app.use(helmet.referrerPolicy({ policy: 'strict-origin-when-cross-origin' }));\n\n  // Permissions-Policy\n  app.use(\n    helmet.permittedCrossDomainPolicies({\n      permittedPolicies: 'none',\n    })\n  );\n}\n\n/**\n * Configure rate limiting\n */\nexport function configureRateLimiting(app: any) {\n  // General API rate limiter\n  const apiLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 100, // limit each IP to 100 requests per windowMs\n    message: 'Too many requests from this IP, please try again later.',\n    standardHeaders: true, // Return rate limit info in the `RateLimit-*` headers\n    legacyHeaders: false, // Disable the `X-RateLimit-*` headers\n  });\n\n  // Strict rate limiter for auth endpoints\n  const authLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 5, // limit each IP to 5 requests per windowMs\n    message: 'Too many login attempts, please try again later.',\n    skipSuccessfulRequests: true, // Don't count successful requests\n  });\n\n  // Apply rate limiters\n  app.use('/api/', apiLimiter);\n  app.use('/api/auth/login', authLimiter);\n  app.use('/api/auth/register', authLimiter);\n  app.use('/api/auth/forgot-password', authLimiter);\n}\n\n/**\n * Configure data sanitization\n */\nexport function configureSanitization(app: any) {\n  // Data sanitization against NoSQL injection\n  app.use(mongoSanitize());\n\n  // Prevent HTTP Parameter Pollution attacks\n  app.use(hpp());\n}\n\n/**\n * Configure CORS\n */\nexport function configureCORS(app: any) {\n  const cors = require('cors');\n\n  const corsOptions = {\n    origin: process.env.CORS_ORIGIN || 'http://localhost:3000',\n    credentials: true,\n    methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],\n    allowedHeaders: ['Content-Type', 'Authorization'],\n    maxAge: 86400, // 24 hours\n  };\n\n  app.use(cors(corsOptions));\n}\n\n/**\n * Security headers middleware\n */\nexport function securityHeadersMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  // Prevent MIME type sniffing\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n\n  // Enable XSS protection\n  res.setHeader('X-XSS-Protection', '1; mode=block');\n\n  // Prevent clickjacking\n  res.setHeader('X-Frame-Options', 'DENY');\n\n  // Referrer Policy\n  res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin');\n\n  // Feature Policy / Permissions Policy\n  res.setHeader(\n    'Permissions-Policy',\n    'geolocation=(), microphone=(), camera=()'\n  );\n\n  // Strict Transport Security (HSTS)\n  if (process.env.NODE_ENV === 'production') {\n    res.setHeader(\n      'Strict-Transport-Security',\n      'max-age=31536000; includeSubDomains; preload'\n    );\n  }\n\n  next();\n}\n\n/**\n * Remove sensitive headers\n */\nexport function removeSensitiveHeaders(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  // Remove server information\n  res.removeHeader('X-Powered-By');\n  res.removeHeader('Server');\n\n  next();\n}\n\n/**\n * Setup all security middleware\n */\nexport function setupSecurityMiddleware(app: any) {\n  // Configure security headers\n  configureSecurityHeaders(app);\n\n  // Configure rate limiting\n  configureRateLimiting(app);\n\n  // Configure data sanitization\n  configureSanitization(app);\n\n  // Configure CORS\n  configureCORS(app);\n\n  // Apply custom security headers\n  app.use(securityHeadersMiddleware);\n\n  // Remove sensitive headers\n  app.use(removeSensitiveHeaders);\n}\n\nexport default setupSecurityMiddleware;\n"],"mappings":"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","ignoreList":[]}