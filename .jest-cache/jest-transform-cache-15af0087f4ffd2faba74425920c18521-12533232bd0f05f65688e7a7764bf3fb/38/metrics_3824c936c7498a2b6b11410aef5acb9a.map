{"version":3,"names":["cov_1gcg92rk8b","actualCoverage","promClient","s","require","register","Registry","collectDefaultMetrics","httpDuration","Histogram","name","help","labelNames","buckets","httpTotal","Counter","registerMetric","middleware","req","res","next","f","start","Date","now","on","duration","route","b","path","observe","method","status","statusCode","inc","module","exports","endpoint","set","contentType","metrics","then","data","send"],"sources":["metrics.js"],"sourcesContent":["const promClient = require('prom-client');\n\nconst register = new promClient.Registry();\npromClient.collectDefaultMetrics({ register });\n\nconst httpDuration = new promClient.Histogram({\n  name: 'http_request_duration_seconds',\n  help: 'HTTP request duration',\n  labelNames: ['method', 'route', 'status'],\n  buckets: [0.1, 0.5, 1, 2, 5]\n});\n\nconst httpTotal = new promClient.Counter({\n  name: 'http_requests_total',\n  help: 'Total HTTP requests',\n  labelNames: ['method', 'route', 'status']\n});\n\nregister.registerMetric(httpDuration);\nregister.registerMetric(httpTotal);\n\nfunction middleware(req, res, next) {\n  const start = Date.now();\n  res.on('finish', () => {\n    const duration = (Date.now() - start) / 1000;\n    const route = req.route?.path || req.path;\n    httpDuration.observe({ method: req.method, route, status: res.statusCode }, duration);\n    httpTotal.inc({ method: req.method, route, status: res.statusCode });\n  });\n  next();\n}\n\nmodule.exports = {\n  register,\n  middleware,\n  endpoint: (req, res) => {\n    res.set('Content-Type', register.contentType);\n    register.metrics().then(data => res.send(data));\n  }\n};\n"],"mappings":"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","ignoreList":[]}