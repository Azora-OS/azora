{"version":3,"names":["cov_1dmesn30ad","actualCoverage","express","s","require","cors","helmet","compression","helmetConfig","contentSecurityPolicy","directives","defaultSrc","styleSrc","scriptSrc","imgSrc","corsConfig","origin","b","process","env","ALLOWED_ORIGINS","split","credentials","createRateLimiter","maxRequests","f","requests","Map","req","res","next","ip","connection","remoteAddress","now","Date","windowMs","has","set","userRequests","get","filter","time","length","status","json","error","push","authenticate","errorHandler","err","console","message","NODE_ENV","stack","rateLimiters","financial","api","auth","commonMiddleware","setupMiddleware","app","use","urlencoded","extended","timestamp","toISOString","module","exports"],"sources":["index.js"],"sourcesContent":["const express = require('express');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst compression = require('compression');\n\n// Helmet configuration\nconst helmetConfig = helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      scriptSrc: [\"'self'\"],\n      imgSrc: [\"'self'\", \"data:\", \"https:\"],\n    },\n  },\n});\n\n// CORS configuration\nconst corsConfig = cors({\n  origin: process.env.ALLOWED_ORIGINS?.split(',') || '*',\n  credentials: true,\n});\n\n// Rate limiter factory\nconst createRateLimiter = (maxRequests = 100) => {\n  const requests = new Map();\n\n  return (req, res, next) => {\n    const ip = req.ip || req.connection.remoteAddress;\n    const now = Date.now();\n    const windowMs = 15 * 60 * 1000; // 15 minutes\n\n    if (!requests.has(ip)) {\n      requests.set(ip, []);\n    }\n\n    const userRequests = requests.get(ip).filter(time => now - time < windowMs);\n\n    if (userRequests.length >= maxRequests) {\n      return res.status(429).json({ error: 'Too many requests' });\n    }\n\n    userRequests.push(now);\n    requests.set(ip, userRequests);\n    next();\n  };\n};\n\n// Authentication middleware (placeholder)\nconst authenticate = (req, res, next) => {\n  // TODO: Implement proper JWT authentication\n  next();\n};\n\n// Error handler\nconst errorHandler = (err, req, res, next) => {\n  console.error('Error:', err);\n  res.status(err.status || 500).json({\n    error: err.message || 'Internal server error',\n    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })\n  });\n};\n\n// Specific rate limiters\nconst rateLimiters = {\n  financial: createRateLimiter(10),\n  api: createRateLimiter(100),\n  auth: createRateLimiter(5),\n};\n\n// Common middleware setup\nconst commonMiddleware = () => {\n  return (req, res, next) => {\n    next();\n  };\n};\n\nconst setupMiddleware = (app) => {\n  app.use(helmetConfig);\n  app.use(corsConfig);\n  app.use(compression());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Health check endpoint\n  app.get('/health', (req, res) => {\n    res.json({ status: 'healthy', timestamp: new Date().toISOString() });\n  });\n};\n\nmodule.exports = {\n  commonMiddleware,\n  setupMiddleware,\n  helmetConfig,\n  corsConfig,\n  createRateLimiter,\n  errorHandler,\n  authenticate,\n  rateLimiters,\n};"],"mappings":"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","ignoreList":[]}