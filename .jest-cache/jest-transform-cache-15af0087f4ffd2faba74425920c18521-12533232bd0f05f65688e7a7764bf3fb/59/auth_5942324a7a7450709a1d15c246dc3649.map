{"version":3,"names":["cov_1xz67g0ekl","actualCoverage","jwt","authenticateToken","req","res","next","f","authHeader","s","headers","token","b","split","user","email","process","env","DEV_DEFAULT_USER","decoded","verify","JWT_SECRET","err","console","warn"],"sources":["auth.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\n\nexport function authenticateToken(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    // In dev, allow optional user\n    (req as any).user = { email: process.env.DEV_DEFAULT_USER || 'guest@example.com' };\n    return next();\n  }\n\n  try {\n    const decoded = jwt.verify(token, process.env.JWT_SECRET || 'dev-secret');\n    (req as any).user = decoded;\n    return next();\n  } catch (err) {\n    console.warn('[Auth] Invalid token, falling back to guest', err);\n    (req as any).user = { email: 'guest@example.com' };\n    return next();\n  }\n}\n\nexport default authenticateToken;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAdZ,OAAOE,GAAG,MAAM,cAAc;AAE9B,OAAO,SAASC,iBAAiBA,CAACC,GAAY,EAAEC,GAAa,EAAEC,IAAkB,EAAE;EAAA;EAAAN,cAAA,GAAAO,CAAA;EACjF,MAAMC,UAAU;EAAA;EAAA,CAAAR,cAAA,GAAAS,CAAA,OAAGL,GAAG,CAACM,OAAO,CAAC,eAAe,CAAC;EAC/C,MAAMC,KAAK;EAAA;EAAA,CAAAX,cAAA,GAAAS,CAAA;EAAG;EAAA,CAAAT,cAAA,GAAAY,CAAA,UAAAJ,UAAU;EAAA;EAAA,CAAAR,cAAA,GAAAY,CAAA,UAAIJ,UAAU,CAACK,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EAAC;EAAAb,cAAA,GAAAS,CAAA;EAErD,IAAI,CAACE,KAAK,EAAE;IAAA;IAAAX,cAAA,GAAAY,CAAA;IAAAZ,cAAA,GAAAS,CAAA;IACV;IACCL,GAAG,CAASU,IAAI,GAAG;MAAEC,KAAK;MAAE;MAAA,CAAAf,cAAA,GAAAY,CAAA,UAAAI,OAAO,CAACC,GAAG,CAACC,gBAAgB;MAAA;MAAA,CAAAlB,cAAA,GAAAY,CAAA,UAAI,mBAAmB;IAAC,CAAC;IAAC;IAAAZ,cAAA,GAAAS,CAAA;IACnF,OAAOH,IAAI,CAAC,CAAC;EACf,CAAC;EAAA;EAAA;IAAAN,cAAA,GAAAY,CAAA;EAAA;EAAAZ,cAAA,GAAAS,CAAA;EAED,IAAI;IACF,MAAMU,OAAO;IAAA;IAAA,CAAAnB,cAAA,GAAAS,CAAA,OAAGP,GAAG,CAACkB,MAAM,CAACT,KAAK;IAAE;IAAA,CAAAX,cAAA,GAAAY,CAAA,UAAAI,OAAO,CAACC,GAAG,CAACI,UAAU;IAAA;IAAA,CAAArB,cAAA,GAAAY,CAAA,UAAI,YAAY,EAAC;IAAC;IAAAZ,cAAA,GAAAS,CAAA;IACzEL,GAAG,CAASU,IAAI,GAAGK,OAAO;IAAC;IAAAnB,cAAA,GAAAS,CAAA;IAC5B,OAAOH,IAAI,CAAC,CAAC;EACf,CAAC,CAAC,OAAOgB,GAAG,EAAE;IAAA;IAAAtB,cAAA,GAAAS,CAAA;IACZc,OAAO,CAACC,IAAI,CAAC,6CAA6C,EAAEF,GAAG,CAAC;IAAC;IAAAtB,cAAA,GAAAS,CAAA;IAChEL,GAAG,CAASU,IAAI,GAAG;MAAEC,KAAK,EAAE;IAAoB,CAAC;IAAC;IAAAf,cAAA,GAAAS,CAAA;IACnD,OAAOH,IAAI,CAAC,CAAC;EACf;AACF;AAEA,eAAeH,iBAAiB","ignoreList":[]}