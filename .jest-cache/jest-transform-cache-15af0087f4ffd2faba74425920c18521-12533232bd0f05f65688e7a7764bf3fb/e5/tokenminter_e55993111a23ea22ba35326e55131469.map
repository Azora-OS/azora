{"version":3,"names":["cov_q9orqzdjk","actualCoverage","crypto","TokenMinter","constructor","economicPolicy","f","s","policy","wallets","Map","transactions","blocks","createWallet","userId","address","randomBytes","toString","wallet","balance","staked","earned","created","Date","now","set","getWallet","get","mintReward","amount","reason","result","mintTokens","success","b","message","push","id","type","to","timestamp","minted","transfer","fromAddress","toAddress","from","validation","validateTransaction","valid","stake","unstake","getBalance"],"sources":["token-minter.ts"],"sourcesContent":["import * as crypto from 'crypto';\nimport { EconomicPolicyEngine } from './economic-policy';\n\ninterface Wallet {\n  userId: string;\n  address: string;\n  balance: number;\n  staked: number;\n  earned: number;\n  created: number;\n}\n\ninterface Transaction {\n  id: string;\n  type: 'mint' | 'transfer';\n  to?: string;\n  from?: string;\n  amount: number;\n  reason?: string;\n  timestamp: number;\n}\n\nexport class TokenMinter {\n  policy: EconomicPolicyEngine;\n  wallets: Map<string, Wallet>;\n  transactions: Transaction[];\n  blocks: any[]; // Define a proper type for blocks later\n\n  constructor(economicPolicy: EconomicPolicyEngine) {\n    this.policy = economicPolicy;\n    this.wallets = new Map();\n    this.transactions = [];\n    this.blocks = [];\n  }\n\n  createWallet(userId: string): Wallet {\n    const address = crypto.randomBytes(20).toString('hex');\n    const wallet: Wallet = {\n      userId,\n      address,\n      balance: 0,\n      staked: 0,\n      earned: 0,\n      created: Date.now()\n    };\n    this.wallets.set(address, wallet);\n    return wallet;\n  }\n\n  getWallet(address: string): Wallet | undefined {\n    return this.wallets.get(address);\n  }\n\n  mintReward(address: string, amount: number, reason: string): { success: boolean; message?: string; balance?: number; minted?: number } {\n    const result = this.policy.mintTokens(amount, reason);\n    if (!result.success) {return result;}\n\n    const wallet = this.wallets.get(address);\n    if (!wallet) {return { success: false, message: 'Wallet not found' };}\n\n    wallet.balance += amount;\n    wallet.earned += amount;\n\n    this.transactions.push({\n      id: crypto.randomBytes(16).toString('hex'),\n      type: 'mint',\n      to: address,\n      amount,\n      reason,\n      timestamp: Date.now()\n    });\n\n    return { success: true, balance: wallet.balance, minted: amount };\n  }\n\n  transfer(fromAddress: string, toAddress: string, amount: number): { success: boolean; message?: string; from?: number; to?: number } {\n    const from = this.wallets.get(fromAddress);\n    const to = this.wallets.get(toAddress);\n\n    if (!from || !to) {return { success: false, message: 'Wallet not found' };}\n\n    const validation = this.policy.validateTransaction(amount, from.balance);\n    if (!validation.valid) {return { success: false, message: validation.message };}\n\n    from.balance -= amount;\n    to.balance += amount;\n\n    this.transactions.push({\n      id: crypto.randomBytes(16).toString('hex'),\n      type: 'transfer',\n      from: fromAddress,\n      to: toAddress,\n      amount,\n      timestamp: Date.now()\n    });\n\n    return { success: true, from: from.balance, to: to.balance };\n  }\n\n  stake(address: string, amount: number): { success: boolean; message?: string; staked?: number; balance?: number } {\n    const wallet = this.wallets.get(address);\n    if (!wallet) {return { success: false, message: 'Wallet not found' };}\n\n    const validation = this.policy.validateTransaction(amount, wallet.balance);\n    if (!validation.valid) {return { success: false, message: validation.message };}\n\n    wallet.balance -= amount;\n    wallet.staked += amount;\n\n    return { success: true, staked: wallet.staked, balance: wallet.balance };\n  }\n\n  unstake(address: string, amount: number): { success: boolean; message?: string; staked?: number; balance?: number } {\n    const wallet = this.wallets.get(address);\n    if (!wallet || amount > wallet.staked) {\n      return { success: false, message: 'Invalid unstake' };\n    }\n\n    wallet.staked -= amount;\n    wallet.balance += amount;\n\n    return { success: true, staked: wallet.staked, balance: wallet.balance };\n  }\n\n  getBalance(address: string): { balance: number; staked: number; earned: number } | null {\n    const wallet = this.wallets.get(address);\n    return wallet ? { balance: wallet.balance, staked: wallet.staked, earned: wallet.earned } : null;\n  }\n}\n"],"mappings":"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","ignoreList":[]}