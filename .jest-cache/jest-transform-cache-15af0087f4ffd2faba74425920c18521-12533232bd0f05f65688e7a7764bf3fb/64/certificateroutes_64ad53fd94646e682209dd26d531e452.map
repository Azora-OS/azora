{"version":3,"names":["cov_136kd1yvmt","actualCoverage","Router","certificateService","logger","router","s","post","req","res","f","enrollmentId","body","b","status","json","success","error","certificate","generateCertificate","data","Error","message","get","id","params","getCertificateById","studentId","certificates","getCertificatesByStudentId","count","length","verificationUrl","fullUrl","process","env","CERTIFICATE_BASE_URL","verifyCertificate","verified","language","test","generateCertificateInLanguage"],"sources":["certificate.routes.ts"],"sourcesContent":["import { Router, Request, Response } from 'express';\nimport { certificateService } from '../services/certificate.service';\nimport { logger } from '../utils/logger';\n\nconst router = Router();\n\n/**\n * POST /certificates/generate\n * Generate a digital certificate upon course completion\n * Requirements: 1.1, 1.2\n */\nrouter.post('/certificates/generate', async (req: Request, res: Response) => {\n  try {\n    const { enrollmentId } = req.body;\n\n    if (!enrollmentId) {\n      return res.status(400).json({\n        success: false,\n        error: 'enrollmentId is required',\n      });\n    }\n\n    const certificate = await certificateService.generateCertificate(enrollmentId);\n\n    res.status(201).json({\n      success: true,\n      data: certificate,\n    });\n  } catch (error) {\n    logger.error('Error generating certificate', { error });\n    res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to generate certificate',\n    });\n  }\n});\n\n/**\n * GET /certificates/:id\n * Get certificate by ID\n * Requirements: 1.1, 1.2\n */\nrouter.get('/certificates/:id', async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n\n    const certificate = await certificateService.getCertificateById(id);\n\n    if (!certificate) {\n      return res.status(404).json({\n        success: false,\n        error: 'Certificate not found',\n      });\n    }\n\n    res.json({\n      success: true,\n      data: certificate,\n    });\n  } catch (error) {\n    logger.error('Error fetching certificate', { error });\n    res.status(500).json({\n      success: false,\n      error: 'Failed to fetch certificate',\n    });\n  }\n});\n\n/**\n * GET /certificates/:studentId\n * Get all certificates for a student\n * Requirements: 1.1, 1.2\n */\nrouter.get('/certificates/student/:studentId', async (req: Request, res: Response) => {\n  try {\n    const { studentId } = req.params;\n\n    const certificates = await certificateService.getCertificatesByStudentId(studentId);\n\n    res.json({\n      success: true,\n      data: certificates,\n      count: certificates.length,\n    });\n  } catch (error) {\n    logger.error('Error fetching student certificates', { error });\n    res.status(500).json({\n      success: false,\n      error: 'Failed to fetch certificates',\n    });\n  }\n});\n\n/**\n * GET /verify/:verificationUrl\n * Verify certificate by verification URL\n * Requirements: 1.1, 1.2\n */\nrouter.get('/verify/:verificationUrl', async (req: Request, res: Response) => {\n  try {\n    const { verificationUrl } = req.params;\n    const fullUrl = `${process.env.CERTIFICATE_BASE_URL || 'https://azora.edu'}/verify/${verificationUrl}`;\n\n    const certificate = await certificateService.verifyCertificate(fullUrl);\n\n    if (!certificate) {\n      return res.status(404).json({\n        success: false,\n        error: 'Certificate not found or invalid verification URL',\n      });\n    }\n\n    res.json({\n      success: true,\n      data: certificate,\n      verified: true,\n    });\n  } catch (error) {\n    logger.error('Error verifying certificate', { error });\n    res.status(500).json({\n      success: false,\n      error: 'Failed to verify certificate',\n    });\n  }\n});\n\n/**\n * POST /certificates/generate/:enrollmentId/:language\n * Generate certificate in a specific language\n * Requirements: 1.1, 1.2\n */\nrouter.post('/certificates/generate/:enrollmentId/:language', async (req: Request, res: Response) => {\n  try {\n    const { enrollmentId, language } = req.params;\n\n    // Validate language code\n    if (!/^[a-z]{2}(-[A-Z]{2})?$/.test(language)) {\n      return res.status(400).json({\n        success: false,\n        error: 'Invalid language code format',\n      });\n    }\n\n    const certificate = await certificateService.generateCertificateInLanguage(\n      enrollmentId,\n      language\n    );\n\n    res.status(201).json({\n      success: true,\n      data: certificate,\n      language,\n    });\n  } catch (error) {\n    logger.error('Error generating certificate in language', { error });\n    res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to generate certificate',\n    });\n  }\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}