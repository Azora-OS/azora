{"version":3,"names":["cov_1kwm06l260","actualCoverage","PrismaClient","s","require","ContextManager","constructor","f","prisma","maxHistory","getConversationHistory","userId","memberId","conversation","findFirst","where","include","messages","orderBy","timestamp","take","b","saveMessage","conversationId","role","content","mood","message","create","data","createConversation","context","module","exports"],"sources":["context-manager.js"],"sourcesContent":["const { PrismaClient } = require('@prisma/client');\n\nclass ContextManager {\n  constructor() {\n    this.prisma = new PrismaClient();\n    this.maxHistory = 10;\n  }\n\n  async getConversationHistory(userId, memberId) {\n    const conversation = await this.prisma.conversation.findFirst({\n      where: { userId, memberId },\n      include: {\n        messages: {\n          orderBy: { timestamp: 'asc' },\n          take: this.maxHistory\n        }\n      }\n    });\n    \n    return conversation?.messages || [];\n  }\n\n  async saveMessage(conversationId, memberId, userId, role, content, mood = 'neutral') {\n    return await this.prisma.message.create({\n      data: {\n        conversationId,\n        memberId,\n        userId,\n        role,\n        content,\n        mood\n      }\n    });\n  }\n\n  async createConversation(userId, memberId, context = {}) {\n    return await this.prisma.conversation.create({\n      data: { userId, memberId, context }\n    });\n  }\n}\n\nmodule.exports = new ContextManager();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ,MAAM;EAAEE;AAAa,CAAC;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,OAAGC,OAAO,CAAC,gBAAgB,CAAC;AAElD,MAAMC,cAAc,CAAC;EACnBC,WAAWA,CAAA,EAAG;IAAA;IAAAN,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAG,CAAA;IACZ,IAAI,CAACK,MAAM,GAAG,IAAIN,YAAY,CAAC,CAAC;IAAC;IAAAF,cAAA,GAAAG,CAAA;IACjC,IAAI,CAACM,UAAU,GAAG,EAAE;EACtB;EAEA,MAAMC,sBAAsBA,CAACC,MAAM,EAAEC,QAAQ,EAAE;IAAA;IAAAZ,cAAA,GAAAO,CAAA;IAC7C,MAAMM,YAAY;IAAA;IAAA,CAAAb,cAAA,GAAAG,CAAA,OAAG,MAAM,IAAI,CAACK,MAAM,CAACK,YAAY,CAACC,SAAS,CAAC;MAC5DC,KAAK,EAAE;QAAEJ,MAAM;QAAEC;MAAS,CAAC;MAC3BI,OAAO,EAAE;QACPC,QAAQ,EAAE;UACRC,OAAO,EAAE;YAAEC,SAAS,EAAE;UAAM,CAAC;UAC7BC,IAAI,EAAE,IAAI,CAACX;QACb;MACF;IACF,CAAC,CAAC;IAAC;IAAAT,cAAA,GAAAG,CAAA;IAEH,OAAO,2BAAAH,cAAA,GAAAqB,CAAA,UAAAR,YAAY,EAAEI,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAqB,CAAA,UAAI,EAAE;EACrC;EAEA,MAAMC,WAAWA,CAACC,cAAc,EAAEX,QAAQ,EAAED,MAAM,EAAEa,IAAI,EAAEC,OAAO,EAAEC,IAAI;EAAA;EAAA,CAAA1B,cAAA,GAAAqB,CAAA,UAAG,SAAS,GAAE;IAAA;IAAArB,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAG,CAAA;IACnF,OAAO,MAAM,IAAI,CAACK,MAAM,CAACmB,OAAO,CAACC,MAAM,CAAC;MACtCC,IAAI,EAAE;QACJN,cAAc;QACdX,QAAQ;QACRD,MAAM;QACNa,IAAI;QACJC,OAAO;QACPC;MACF;IACF,CAAC,CAAC;EACJ;EAEA,MAAMI,kBAAkBA,CAACnB,MAAM,EAAEC,QAAQ,EAAEmB,OAAO;EAAA;EAAA,CAAA/B,cAAA,GAAAqB,CAAA,UAAG,CAAC,CAAC,GAAE;IAAA;IAAArB,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAG,CAAA;IACvD,OAAO,MAAM,IAAI,CAACK,MAAM,CAACK,YAAY,CAACe,MAAM,CAAC;MAC3CC,IAAI,EAAE;QAAElB,MAAM;QAAEC,QAAQ;QAAEmB;MAAQ;IACpC,CAAC,CAAC;EACJ;AACF;AAAC;AAAA/B,cAAA,GAAAG,CAAA;AAED6B,MAAM,CAACC,OAAO,GAAG,IAAI5B,cAAc,CAAC,CAAC","ignoreList":[]}