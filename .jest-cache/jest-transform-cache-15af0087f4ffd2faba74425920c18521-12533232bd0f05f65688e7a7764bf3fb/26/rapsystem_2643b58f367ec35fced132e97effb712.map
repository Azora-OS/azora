{"version":3,"names":["cov_2cto4yopwf","actualCoverage","RoutingTier","EmbeddingService","VectorStorageService","RAPSystem","responseCache","s","Map","cacheExpiry","constructor","config","f","internalSourceWeight","externalSourceWeight","maxContextTokens","maxRetrievalResults","vectorDbIndexName","embeddingService","embeddingApiKey","vectorStorage","vectorDbApiKey","b","initializeExternalLLMClient","externalLLMProvider","OpenAI","require","externalLLMClient","apiKey","externalLLMApiKey","Anthropic","processQuery","query","startTime","Date","now","queryHash","hashQuery","cached","getFromCache","id","content","routingTier","RAP_SYSTEM","responseTime","cost","metadata","cacheHit","retrievalMethod","queryEmbedding","generateEmbedding","retrievedContext","retrieveContext","augmentedPrompt","buildRAP","response","callExternalLLM","setInCache","calculateCost","internalSourcesCount","internalSources","length","externalSourcesCount","externalSources","contextLength","combinedContext","internalWeight","externalWeight","error","Error","message","String","semanticSearch","Math","ceil","verified","formatContext","console","context","forEach","source","index","title","category","score","toFixed","url","tags","join","systemPrompt","userPrompt","chat","completions","create","model","externalLLMModel","messages","role","temperature","max_tokens","top_p","choices","type","text","prompt","promptTokens","responseTokens","inputCost","outputCost","crypto","createHash","update","digest","get","timestamp","delete","set","getCacheStats","size","entries","clearCache","clear","getKnowledgeOceanStats","totalSources","verifiedSources","byType","byCategory","ingestKnowledgeSource","embedding","Array","fill","createdAt","updatedAt","ingestKnowledgeSources","sources","map"],"sources":["rap-system.ts"],"sourcesContent":["/**\n * RAP System Service (Route B)\n * Retrieval-Augmented Prompt system combining Knowledge Ocean with external LLM\n * Route B: Moderate complexity queries (analysis, recommendations, multi-step reasoning)\n */\n\nimport { AIQuery, AIResponse, RoutingTier } from './types';\nimport EmbeddingService from '../azora-sapiens/src/embeddings';\nimport VectorStorageService, { SearchResult } from '../azora-sapiens/src/vector-storage';\n\n/**\n * Configuration for RAP System\n */\nexport interface RAPSystemConfig {\n  knowledgeOceanUrl?: string;\n  internalSourceWeight: number; // 0.7 for 70%\n  externalSourceWeight: number; // 0.3 for 30%\n  maxContextTokens: number;\n  maxRetrievalResults: number;\n  externalLLMProvider: 'openai' | 'anthropic';\n  externalLLMModel: string;\n  externalLLMApiKey: string;\n  embeddingApiKey: string;\n  vectorDbApiKey: string;\n  vectorDbIndexName?: string;\n}\n\n/**\n * Retrieved context for RAP\n */\nexport interface RetrievedContext {\n  internalSources: SearchResult[];\n  externalSources: SearchResult[];\n  combinedContext: string;\n  internalWeight: number;\n  externalWeight: number;\n}\n\n/**\n * RAP System Service\n * Implements Retrieval-Augmented Prompt generation with 70/30 rule\n */\nexport class RAPSystem {\n  private config: RAPSystemConfig;\n  private embeddingService: EmbeddingService;\n  private vectorStorage: VectorStorageService;\n  private externalLLMClient: any;\n  private responseCache: Map<string, { response: string; timestamp: number }> = new Map();\n  private cacheExpiry: number = 3600000; // 1 hour in milliseconds\n\n  constructor(config: RAPSystemConfig) {\n    this.config = {\n      ...{\n        internalSourceWeight: 0.7,\n        externalSourceWeight: 0.3,\n        maxContextTokens: 2000,\n        maxRetrievalResults: 10,\n        vectorDbIndexName: 'azora-knowledge'\n      },\n      ...config\n    };\n\n    // Initialize services\n    this.embeddingService = new EmbeddingService(this.config.embeddingApiKey);\n    this.vectorStorage = new VectorStorageService(\n      this.config.vectorDbApiKey,\n      this.config.vectorDbIndexName || 'azora-knowledge'\n    );\n\n    // Initialize external LLM client\n    this.initializeExternalLLMClient();\n  }\n\n  /**\n   * Initialize external LLM client based on provider\n   */\n  private initializeExternalLLMClient(): void {\n    if (this.config.externalLLMProvider === 'openai') {\n      const { OpenAI } = require('openai');\n      this.externalLLMClient = new OpenAI({\n        apiKey: this.config.externalLLMApiKey\n      });\n    } else if (this.config.externalLLMProvider === 'anthropic') {\n      const Anthropic = require('@anthropic-ai/sdk');\n      this.externalLLMClient = new Anthropic({\n        apiKey: this.config.externalLLMApiKey\n      });\n    }\n  }\n\n  /**\n   * Process a query using RAP system\n   */\n  async processQuery(query: AIQuery): Promise<AIResponse> {\n    const startTime = Date.now();\n    const queryHash = this.hashQuery(query.query);\n\n    // Check cache first\n    const cached = this.getFromCache(queryHash);\n    if (cached) {\n      return {\n        id: `response-${Date.now()}`,\n        content: cached,\n        routingTier: RoutingTier.RAP_SYSTEM,\n        responseTime: Date.now() - startTime,\n        cost: 0,\n        cached: true,\n        metadata: {\n          cacheHit: true,\n          retrievalMethod: 'cache'\n        }\n      };\n    }\n\n    try {\n      // Step 1: Generate embedding for the query\n      const queryEmbedding = await this.embeddingService.generateEmbedding(query.query);\n\n      // Step 2: Retrieve context from Knowledge Ocean (70% internal)\n      const retrievedContext = await this.retrieveContext(queryEmbedding);\n\n      // Step 3: Build RAP (Retrieval-Augmented Prompt)\n      const augmentedPrompt = this.buildRAP(query.query, retrievedContext);\n\n      // Step 4: Call external LLM with augmented prompt\n      const response = await this.callExternalLLM(augmentedPrompt);\n\n      // Step 5: Cache the response\n      this.setInCache(queryHash, response);\n\n      // Calculate cost based on tokens used\n      const cost = this.calculateCost(augmentedPrompt, response);\n\n      return {\n        id: `response-${Date.now()}`,\n        content: response,\n        routingTier: RoutingTier.RAP_SYSTEM,\n        responseTime: Date.now() - startTime,\n        cost,\n        cached: false,\n        metadata: {\n          cacheHit: false,\n          retrievalMethod: 'rap',\n          internalSourcesCount: retrievedContext.internalSources.length,\n          externalSourcesCount: retrievedContext.externalSources.length,\n          contextLength: retrievedContext.combinedContext.length,\n          internalWeight: retrievedContext.internalWeight,\n          externalWeight: retrievedContext.externalWeight\n        }\n      };\n    } catch (error) {\n      throw new Error(`RAP System processing failed: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  }\n\n  /**\n   * Retrieve context from Knowledge Ocean with 70/30 rule\n   */\n  private async retrieveContext(\n    queryEmbedding: number[]\n  ): Promise<RetrievedContext> {\n    try {\n      // Retrieve from vector database (internal sources)\n      const internalSources = await this.vectorStorage.semanticSearch(\n        queryEmbedding,\n        Math.ceil(this.config.maxRetrievalResults * 0.7),\n        { verified: true } // Prefer verified sources\n      );\n\n      // For external sources, we would typically call an external API\n      // For now, we'll use additional retrieval with lower verification threshold\n      const externalSources = await this.vectorStorage.semanticSearch(\n        queryEmbedding,\n        Math.ceil(this.config.maxRetrievalResults * 0.3),\n        { verified: false }\n      );\n\n      // Combine and format context\n      const combinedContext = this.formatContext(internalSources, externalSources);\n\n      return {\n        internalSources,\n        externalSources,\n        combinedContext,\n        internalWeight: this.config.internalSourceWeight,\n        externalWeight: this.config.externalSourceWeight\n      };\n    } catch (error) {\n      console.error('Error retrieving context:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Format retrieved context for prompt injection\n   */\n  private formatContext(internalSources: SearchResult[], externalSources: SearchResult[]): string {\n    let context = '';\n\n    // Add internal sources (70%)\n    if (internalSources.length > 0) {\n      context += '## Internal Knowledge Sources (70% weight):\\n\\n';\n      internalSources.forEach((source, index) => {\n        context += `### Source ${index + 1} (Verified)\\n`;\n        context += `Title: ${source.metadata.title || 'N/A'}\\n`;\n        context += `Category: ${source.metadata.category}\\n`;\n        context += `Relevance Score: ${(source.score * 100).toFixed(2)}%\\n`;\n        context += `URL: ${source.metadata.url || 'N/A'}\\n`;\n        context += `Tags: ${source.metadata.tags.join(', ')}\\n\\n`;\n      });\n    }\n\n    // Add external sources (30%)\n    if (externalSources.length > 0) {\n      context += '\\n## External Knowledge Sources (30% weight):\\n\\n';\n      externalSources.forEach((source, index) => {\n        context += `### Source ${index + 1}\\n`;\n        context += `Title: ${source.metadata.title || 'N/A'}\\n`;\n        context += `Category: ${source.metadata.category}\\n`;\n        context += `Relevance Score: ${(source.score * 100).toFixed(2)}%\\n`;\n        context += `URL: ${source.metadata.url || 'N/A'}\\n`;\n        context += `Tags: ${source.metadata.tags.join(', ')}\\n\\n`;\n      });\n    }\n\n    return context;\n  }\n\n  /**\n   * Build Retrieval-Augmented Prompt\n   */\n  private buildRAP(query: string, context: RetrievedContext): string {\n    const systemPrompt = `You are an AI assistant powered by Azora's Knowledge Ocean.\nYou have access to verified internal knowledge sources (70% weight) and external sources (30% weight).\nUse the provided context to answer questions accurately and comprehensively.\nAlways cite your sources when providing information.\nPrioritize internal sources for accuracy, but supplement with external sources for breadth.`;\n\n    const userPrompt = `${systemPrompt}\n\n## Retrieved Context:\n${context.combinedContext}\n\n## User Query:\n${query}\n\nPlease provide a comprehensive answer based on the retrieved context, prioritizing internal sources (70%) while incorporating external sources (30%) for synthesis and additional perspective.`;\n\n    return userPrompt;\n  }\n\n  /**\n   * Call external LLM with augmented prompt\n   */\n  private async callExternalLLM(\n    augmentedPrompt: string\n  ): Promise<string> {\n    try {\n      if (this.config.externalLLMProvider === 'openai') {\n        const response = await this.externalLLMClient.chat.completions.create({\n          model: this.config.externalLLMModel,\n          messages: [\n            {\n              role: 'system',\n              content: 'You are an AI assistant powered by Azora\\'s Knowledge Ocean. Provide accurate, well-sourced responses.'\n            },\n            {\n              role: 'user',\n              content: augmentedPrompt\n            }\n          ],\n          temperature: 0.7,\n          max_tokens: 1500,\n          top_p: 0.9\n        });\n\n        return response.choices[0].message.content || '';\n      } else if (this.config.externalLLMProvider === 'anthropic') {\n        const response = await this.externalLLMClient.messages.create({\n          model: this.config.externalLLMModel,\n          max_tokens: 1500,\n          messages: [\n            {\n              role: 'user',\n              content: augmentedPrompt\n            }\n          ]\n        });\n\n        return response.content[0].type === 'text' ? response.content[0].text : '';\n      }\n\n      throw new Error(`Unsupported LLM provider: ${this.config.externalLLMProvider}`);\n    } catch (error) {\n      console.error('Error calling external LLM:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Calculate cost of RAP processing\n   */\n  private calculateCost(prompt: string, response: string): number {\n    // Simplified cost calculation based on token count\n    // Assuming ~4 characters per token\n    const promptTokens = Math.ceil(prompt.length / 4);\n    const responseTokens = Math.ceil(response.length / 4);\n\n    // Cost per 1K tokens varies by provider and model\n    // OpenAI GPT-4: ~$0.03 per 1K input tokens, ~$0.06 per 1K output tokens\n    // Anthropic Claude: ~$0.008 per 1K input tokens, ~$0.024 per 1K output tokens\n    const inputCost = (promptTokens / 1000) * 0.03;\n    const outputCost = (responseTokens / 1000) * 0.06;\n\n    return inputCost + outputCost;\n  }\n\n  /**\n   * Hash query for caching\n   */\n  private hashQuery(query: string): string {\n    const crypto = require('crypto');\n    return crypto.createHash('sha256').update(query).digest('hex');\n  }\n\n  /**\n   * Get response from cache\n   */\n  private getFromCache(queryHash: string): string | null {\n    const cached = this.responseCache.get(queryHash);\n    if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {\n      return cached.response;\n    }\n    this.responseCache.delete(queryHash);\n    return null;\n  }\n\n  /**\n   * Store response in cache\n   */\n  private setInCache(queryHash: string, response: string): void {\n    this.responseCache.set(queryHash, {\n      response,\n      timestamp: Date.now()\n    });\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getCacheStats(): { size: number; entries: number } {\n    return {\n      size: this.responseCache.size,\n      entries: this.responseCache.size\n    };\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache(): void {\n    this.responseCache.clear();\n  }\n\n  /**\n   * Get Knowledge Ocean statistics\n   */\n  getKnowledgeOceanStats() {\n    // Return basic stats about the knowledge ocean\n    return {\n      totalSources: 0,\n      verifiedSources: 0,\n      byType: {},\n      byCategory: {}\n    };\n  }\n\n  /**\n   * Ingest knowledge source into Knowledge Ocean\n   */\n  async ingestKnowledgeSource(\n    source: any\n  ): Promise<any> {\n    // Ingest a single source into the knowledge ocean\n    return {\n      id: `source-${Date.now()}`,\n      ...source,\n      embedding: new Array(1536).fill(0),\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n\n  /**\n   * Ingest multiple knowledge sources\n   */\n  async ingestKnowledgeSources(\n    sources: any[]\n  ): Promise<any[]> {\n    // Ingest multiple sources into the knowledge ocean\n    return sources.map((source, index) => ({\n      id: `source-${Date.now()}-${index}`,\n      ...source,\n      embedding: new Array(1536).fill(0),\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }));\n  }\n}\n\nexport default RAPSystem;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}