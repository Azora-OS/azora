{"version":3,"names":["cov_2nzeb6094k","actualCoverage","ContextRanker","constructor","options","b","f","s","relevanceWeight","diversityWeight","recencyWeight","categoryDiversity","deduplicateThreshold","rank","documents","length","totalScore","averageRankScore","deduplicatedCount","deduplicatedDocs","deduplicateSimilar","rankedDocs","map","doc","index","relevanceScore","calculateRelevanceScore","diversityScore","calculateDiversityScore","recencyScore","calculateRecencyScore","rankScore","sort","a","reduce","sum","score","Math","min","max","allDocs","sameCategory","slice","filter","d","metadata","category","prevDoc","source","now","Date","docTime","timestamp","getTime","ageMs","ageDays","exp","deduplicated","seen","Set","i","has","push","add","j","otherDoc","similarity","calculateContentSimilarity","doc1","doc2","embedding","cosineSimilarity","textSimilarity","content","vec1","vec2","dotProduct","norm1","norm2","denominator","sqrt","text1","text2","words1","toLowerCase","split","words2","intersection","w","union","size","rerank","previousWeights","undefined","result","getStatistics","averageRelevance","averageDiversity","averageRecency","topScore","bottomScore"],"sources":["context-ranker.ts"],"sourcesContent":["/**\n * Context Ranker\n * Implements ranking algorithm with diversity scoring and deduplication\n */\n\nimport { Document } from './types';\n\nexport interface RankingOptions {\n  relevanceWeight?: number;\n  diversityWeight?: number;\n  recencyWeight?: number;\n  categoryDiversity?: boolean;\n  deduplicateThreshold?: number;\n}\n\nexport interface RankedDocument extends Document {\n  rankScore: number;\n  relevanceScore: number;\n  diversityScore: number;\n  recencyScore: number;\n}\n\nexport interface RankingResult {\n  documents: RankedDocument[];\n  totalScore: number;\n  averageRankScore: number;\n  deduplicatedCount: number;\n}\n\n/**\n * Context Ranker\n * Ranks documents by relevance, diversity, and recency\n */\nexport class ContextRanker {\n  private relevanceWeight: number;\n  private diversityWeight: number;\n  private recencyWeight: number;\n  private categoryDiversity: boolean;\n  private deduplicateThreshold: number;\n\n  constructor(options: RankingOptions = {}) {\n    this.relevanceWeight = options.relevanceWeight || 0.6;\n    this.diversityWeight = options.diversityWeight || 0.2;\n    this.recencyWeight = options.recencyWeight || 0.2;\n    this.categoryDiversity = options.categoryDiversity !== false;\n    this.deduplicateThreshold = options.deduplicateThreshold || 0.95;\n  }\n\n  /**\n   * Rank documents by multiple criteria\n   */\n  public rank(documents: Document[]): RankingResult {\n    if (documents.length === 0) {\n      return {\n        documents: [],\n        totalScore: 0,\n        averageRankScore: 0,\n        deduplicatedCount: 0\n      };\n    }\n\n    // Deduplicate similar documents\n    const deduplicatedDocs = this.deduplicateSimilar(documents);\n    const deduplicatedCount = documents.length - deduplicatedDocs.length;\n\n    // Calculate individual scores\n    const rankedDocs = deduplicatedDocs.map((doc, index) => {\n      const relevanceScore = this.calculateRelevanceScore(doc);\n      const diversityScore = this.calculateDiversityScore(doc, deduplicatedDocs, index);\n      const recencyScore = this.calculateRecencyScore(doc);\n\n      const rankScore =\n        relevanceScore * this.relevanceWeight +\n        diversityScore * this.diversityWeight +\n        recencyScore * this.recencyWeight;\n\n      return {\n        ...doc,\n        rankScore,\n        relevanceScore,\n        diversityScore,\n        recencyScore\n      };\n    });\n\n    // Sort by rank score descending\n    rankedDocs.sort((a, b) => b.rankScore - a.rankScore);\n\n    const totalScore = rankedDocs.reduce((sum, doc) => sum + doc.rankScore, 0);\n    const averageRankScore = totalScore / rankedDocs.length;\n\n    return {\n      documents: rankedDocs,\n      totalScore,\n      averageRankScore,\n      deduplicatedCount\n    };\n  }\n\n  /**\n   * Calculate relevance score based on vector similarity\n   */\n  private calculateRelevanceScore(doc: Document): number {\n    // Normalize score from 0-1 range\n    const score = doc.score || 0;\n    return Math.min(Math.max(score, 0), 1);\n  }\n\n  /**\n   * Calculate diversity score to promote varied results\n   */\n  private calculateDiversityScore(\n    doc: Document,\n    allDocs: Document[],\n    index: number\n  ): number {\n    let diversityScore = 1.0;\n\n    // Penalize documents with same category\n    if (this.categoryDiversity) {\n      const sameCategory = allDocs\n        .slice(0, index)\n        .filter(d => d.metadata.category === doc.metadata.category).length;\n\n      if (sameCategory > 0) {\n        diversityScore = Math.max(0.3, 1.0 - sameCategory * 0.15);\n      }\n    }\n\n    // Penalize documents with same source appearing consecutively\n    if (index > 0) {\n      const prevDoc = allDocs[index - 1];\n      if (prevDoc && prevDoc.metadata.source === doc.metadata.source) {\n        diversityScore *= 0.85;\n      }\n    }\n\n    return diversityScore;\n  }\n\n  /**\n   * Calculate recency score based on document timestamp\n   */\n  private calculateRecencyScore(doc: Document): number {\n    const now = Date.now();\n    const docTime = doc.metadata.timestamp.getTime();\n    const ageMs = now - docTime;\n\n    // Convert to days\n    const ageDays = ageMs / (1000 * 60 * 60 * 24);\n\n    // Exponential decay: newer documents score higher\n    // After 30 days, score is ~0.37\n    // After 90 days, score is ~0.05\n    const recencyScore = Math.exp(-ageDays / 30);\n\n    return Math.max(0, Math.min(recencyScore, 1));\n  }\n\n  /**\n   * Deduplicate similar documents based on content similarity\n   */\n  private deduplicateSimilar(documents: Document[]): Document[] {\n    const deduplicated: Document[] = [];\n    const seen = new Set<number>();\n\n    for (let i = 0; i < documents.length; i++) {\n      if (seen.has(i)) {continue;}\n\n      const doc = documents[i];\n      if (!doc) {continue;}\n\n      deduplicated.push(doc);\n      seen.add(i);\n\n      // Mark similar documents as seen\n      for (let j = i + 1; j < documents.length; j++) {\n        if (seen.has(j)) {continue;}\n\n        const otherDoc = documents[j];\n        if (!otherDoc) {continue;}\n\n        const similarity = this.calculateContentSimilarity(doc, otherDoc);\n        if (similarity >= this.deduplicateThreshold) {\n          seen.add(j);\n        }\n      }\n    }\n\n    return deduplicated;\n  }\n\n  /**\n   * Calculate content similarity between two documents\n   */\n  private calculateContentSimilarity(doc1: Document, doc2: Document): number {\n    // If both have embeddings, use cosine similarity\n    if (doc1.embedding && doc2.embedding) {\n      return this.cosineSimilarity(doc1.embedding, doc2.embedding);\n    }\n\n    // Fallback to text-based similarity\n    return this.textSimilarity(doc1.content, doc2.content);\n  }\n\n  /**\n   * Calculate cosine similarity between two vectors\n   */\n  private cosineSimilarity(vec1: number[], vec2: number[]): number {\n    if (vec1.length !== vec2.length) {\n      return 0;\n    }\n\n    let dotProduct = 0;\n    let norm1 = 0;\n    let norm2 = 0;\n\n    for (let i = 0; i < vec1.length; i++) {\n      dotProduct += vec1[i] * vec2[i];\n      norm1 += vec1[i] * vec1[i];\n      norm2 += vec2[i] * vec2[i];\n    }\n\n    const denominator = Math.sqrt(norm1) * Math.sqrt(norm2);\n    if (denominator === 0) {\n      return 0;\n    }\n\n    return dotProduct / denominator;\n  }\n\n  /**\n   * Calculate text similarity using Jaccard index\n   */\n  private textSimilarity(text1: string, text2: string): number {\n    const words1 = new Set(text1.toLowerCase().split(/\\s+/));\n    const words2 = new Set(text2.toLowerCase().split(/\\s+/));\n\n    const intersection = new Set([...words1].filter(w => words2.has(w)));\n    const union = new Set([...words1, ...words2]);\n\n    if (union.size === 0) {\n      return 0;\n    }\n\n    return intersection.size / union.size;\n  }\n\n  /**\n   * Rerank documents with custom weights\n   */\n  public rerank(\n    documents: Document[],\n    options: RankingOptions\n  ): RankingResult {\n    const previousWeights = {\n      relevanceWeight: this.relevanceWeight,\n      diversityWeight: this.diversityWeight,\n      recencyWeight: this.recencyWeight\n    };\n\n    // Apply new weights\n    if (options.relevanceWeight !== undefined) {\n      this.relevanceWeight = options.relevanceWeight;\n    }\n    if (options.diversityWeight !== undefined) {\n      this.diversityWeight = options.diversityWeight;\n    }\n    if (options.recencyWeight !== undefined) {\n      this.recencyWeight = options.recencyWeight;\n    }\n\n    const result = this.rank(documents);\n\n    // Restore previous weights\n    this.relevanceWeight = previousWeights.relevanceWeight;\n    this.diversityWeight = previousWeights.diversityWeight;\n    this.recencyWeight = previousWeights.recencyWeight;\n\n    return result;\n  }\n\n  /**\n   * Get ranking statistics\n   */\n  public getStatistics(rankedDocs: RankedDocument[]): {\n    averageRelevance: number;\n    averageDiversity: number;\n    averageRecency: number;\n    topScore: number;\n    bottomScore: number;\n  } {\n    if (rankedDocs.length === 0) {\n      return {\n        averageRelevance: 0,\n        averageDiversity: 0,\n        averageRecency: 0,\n        topScore: 0,\n        bottomScore: 0\n      };\n    }\n\n    const averageRelevance =\n      rankedDocs.reduce((sum, doc) => sum + doc.relevanceScore, 0) / rankedDocs.length;\n    const averageDiversity =\n      rankedDocs.reduce((sum, doc) => sum + doc.diversityScore, 0) / rankedDocs.length;\n    const averageRecency =\n      rankedDocs.reduce((sum, doc) => sum + doc.recencyScore, 0) / rankedDocs.length;\n\n    return {\n      averageRelevance,\n      averageDiversity,\n      averageRecency,\n      topScore: rankedDocs[0]?.rankScore || 0,\n      bottomScore: rankedDocs[rankedDocs.length - 1]?.rankScore || 0\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}