{"version":3,"names":["cov_1c7g0ieai1","actualCoverage","Redis","getRedisClusterConfig","f","nodes","s","b","process","env","REDIS_CLUSTER_NODES","split","map","node","host","port","trim","parseInt","options","enableReadyCheck","enableOfflineQueue","maxRedirections","retryDelayOnFailover","retryDelayOnClusterDown","slotsRefreshTimeout","dnsLookup","clusterRetryStrategy","times","delay","Math","min","pow","getRedisPersistenceConfig","rdb","enabled","saveInterval","minChanges","aof","fsync","rewriteMinSize","rewritePercentage","getRedisReplicationConfig","role","REDIS_ROLE","masterHost","REDIS_MASTER_HOST","masterPort","REDIS_MASTER_PORT","undefined","replicaReadOnly","replicaServeStaleData","replicaPriority","REDIS_REPLICA_PRIORITY","generateRedisConfigCommands","persistence","commands","push","replication","REDIS_MAX_MEMORY","REDIS_EVICTION_POLICY","REDIS_TIMEOUT","REDIS_TCP_KEEPALIVE","createRedisCluster","config","cluster","Cluster","redisOptions","password","REDIS_PASSWORD","db","on","console","log","err","error","createRedisInstance","redis","REDIS_HOST","REDIS_PORT","retryStrategy","maxRetriesPerRequest","applyPersistenceConfig","command","call","slice","getRedisConnectionString","REDIS_DB","validateRedisClusterHealth","info","slots","getRedisClusterStats","dbSize","dbsize","memory"],"sources":["redis-cluster-config.ts"],"sourcesContent":["/**\n * Redis Cluster Configuration for Production\n * Handles cluster setup, persistence, and replication\n */\n\nimport Redis from 'ioredis';\n\nexport interface RedisClusterConfig {\n  nodes: Array<{\n    host: string;\n    port: number;\n  }>;\n  options: {\n    enableReadyCheck: boolean;\n    enableOfflineQueue: boolean;\n    maxRedirections: number;\n    retryDelayOnFailover: number;\n    retryDelayOnClusterDown: number;\n    slotsRefreshTimeout: number;\n    dnsLookup: string;\n    clusterRetryStrategy: (times: number) => number;\n  };\n}\n\nexport interface RedisPersistenceConfig {\n  // RDB (Snapshot) Configuration\n  rdb: {\n    enabled: boolean;\n    saveInterval: number; // seconds\n    minChanges: number; // minimum changes to trigger save\n  };\n  // AOF (Append-Only File) Configuration\n  aof: {\n    enabled: boolean;\n    fsync: 'always' | 'everysec' | 'no';\n    rewriteMinSize: string; // e.g., \"64mb\"\n    rewritePercentage: number;\n  };\n}\n\nexport interface RedisReplicationConfig {\n  role: 'master' | 'slave';\n  masterHost?: string;\n  masterPort?: number;\n  replicaReadOnly: boolean;\n  replicaServeStaleData: boolean;\n  replicaPriority: number;\n}\n\n/**\n * Get Redis cluster configuration for production\n */\nexport function getRedisClusterConfig(): RedisClusterConfig {\n  const nodes = (process.env.REDIS_CLUSTER_NODES || 'localhost:6379').split(',').map(node => {\n    const [host, port] = node.trim().split(':');\n    return {\n      host,\n      port: parseInt(port, 10) || 6379\n    };\n  });\n\n  return {\n    nodes,\n    options: {\n      enableReadyCheck: true,\n      enableOfflineQueue: true,\n      maxRedirections: 16,\n      retryDelayOnFailover: 100,\n      retryDelayOnClusterDown: 300,\n      slotsRefreshTimeout: 2000,\n      dnsLookup: 'auto',\n      clusterRetryStrategy: (times: number) => {\n        const delay = Math.min(100 * Math.pow(2, times), 2000);\n        return delay;\n      }\n    }\n  };\n}\n\n/**\n * Get Redis persistence configuration\n */\nexport function getRedisPersistenceConfig(): RedisPersistenceConfig {\n  return {\n    rdb: {\n      enabled: true,\n      saveInterval: 900, // 15 minutes\n      minChanges: 1 // save if at least 1 key changed\n    },\n    aof: {\n      enabled: true,\n      fsync: 'everysec', // fsync every second\n      rewriteMinSize: '64mb',\n      rewritePercentage: 100\n    }\n  };\n}\n\n/**\n * Get Redis replication configuration\n */\nexport function getRedisReplicationConfig(): RedisReplicationConfig {\n  const role = (process.env.REDIS_ROLE || 'master') as 'master' | 'slave';\n\n  return {\n    role,\n    masterHost: process.env.REDIS_MASTER_HOST,\n    masterPort: process.env.REDIS_MASTER_PORT ? parseInt(process.env.REDIS_MASTER_PORT, 10) : undefined,\n    replicaReadOnly: true,\n    replicaServeStaleData: true,\n    replicaPriority: parseInt(process.env.REDIS_REPLICA_PRIORITY || '100', 10)\n  };\n}\n\n/**\n * Generate Redis configuration commands for cluster setup\n */\nexport function generateRedisConfigCommands(): string[] {\n  const persistence = getRedisPersistenceConfig();\n  const commands: string[] = [];\n\n  // RDB configuration\n  if (persistence.rdb.enabled) {\n    commands.push(`SAVE ${persistence.rdb.saveInterval} ${persistence.rdb.minChanges}`);\n  }\n\n  // AOF configuration\n  if (persistence.aof.enabled) {\n    commands.push(`CONFIG SET appendonly yes`);\n    commands.push(`CONFIG SET appendfsync ${persistence.aof.fsync}`);\n    commands.push(`CONFIG SET auto-aof-rewrite-min-size ${persistence.aof.rewriteMinSize}`);\n    commands.push(`CONFIG SET auto-aof-rewrite-percentage ${persistence.aof.rewritePercentage}`);\n  }\n\n  // Replication configuration\n  const replication = getRedisReplicationConfig();\n  if (replication.role === 'slave' && replication.masterHost) {\n    commands.push(`SLAVEOF ${replication.masterHost} ${replication.masterPort || 6379}`);\n    commands.push(`CONFIG SET slave-read-only ${replication.replicaReadOnly ? 'yes' : 'no'}`);\n    commands.push(`CONFIG SET slave-serve-stale-data ${replication.replicaServeStaleData ? 'yes' : 'no'}`);\n  }\n\n  // General configuration\n  commands.push(`CONFIG SET maxmemory ${process.env.REDIS_MAX_MEMORY || '2gb'}`);\n  commands.push(`CONFIG SET maxmemory-policy ${process.env.REDIS_EVICTION_POLICY || 'allkeys-lru'}`);\n  commands.push(`CONFIG SET timeout ${process.env.REDIS_TIMEOUT || '0'}`);\n  commands.push(`CONFIG SET tcp-keepalive ${process.env.REDIS_TCP_KEEPALIVE || '300'}`);\n\n  return commands;\n}\n\n/**\n * Create Redis cluster instance\n */\nexport function createRedisCluster(): Redis.Cluster {\n  const config = getRedisClusterConfig();\n\n  const cluster = new Redis.Cluster(config.nodes, {\n    redisOptions: {\n      password: process.env.REDIS_PASSWORD,\n      db: 0\n    },\n    ...config.options\n  });\n\n  // Handle cluster events\n  cluster.on('connect', () => {\n    console.log('Redis Cluster connected');\n  });\n\n  cluster.on('ready', () => {\n    console.log('Redis Cluster ready');\n  });\n\n  cluster.on('error', (err) => {\n    console.error('Redis Cluster error:', err);\n  });\n\n  cluster.on('node error', (err, node) => {\n    console.error(`Redis Cluster node error on ${node}:`, err);\n  });\n\n  return cluster;\n}\n\n/**\n * Create standalone Redis instance (for development)\n */\nexport function createRedisInstance(): Redis {\n  const redis = new Redis({\n    host: process.env.REDIS_HOST || 'localhost',\n    port: parseInt(process.env.REDIS_PORT || '6379', 10),\n    password: process.env.REDIS_PASSWORD,\n    db: 0,\n    retryStrategy: (times: number) => {\n      const delay = Math.min(100 * Math.pow(2, times), 3000);\n      return delay;\n    },\n    enableReadyCheck: true,\n    enableOfflineQueue: true,\n    maxRetriesPerRequest: null\n  });\n\n  redis.on('connect', () => {\n    console.log('Redis connected');\n  });\n\n  redis.on('ready', () => {\n    console.log('Redis ready');\n  });\n\n  redis.on('error', (err) => {\n    console.error('Redis error:', err);\n  });\n\n  return redis;\n}\n\n/**\n * Apply persistence configuration to Redis instance\n */\nexport async function applyPersistenceConfig(redis: Redis | Redis.Cluster): Promise<void> {\n  const persistence = getRedisPersistenceConfig();\n  const commands = generateRedisConfigCommands();\n\n  try {\n    for (const command of commands) {\n      await redis.call('CONFIG', 'SET', ...command.split(' ').slice(2));\n    }\n    console.log('Redis persistence configuration applied');\n  } catch (error) {\n    console.error('Error applying persistence configuration:', error);\n  }\n}\n\n/**\n * Get Redis connection string\n */\nexport function getRedisConnectionString(): string {\n  const host = process.env.REDIS_HOST || 'localhost';\n  const port = process.env.REDIS_PORT || '6379';\n  const password = process.env.REDIS_PASSWORD ? `${process.env.REDIS_PASSWORD}@` : '';\n  const db = process.env.REDIS_DB || '0';\n\n  return `redis://${password}${host}:${port}/${db}`;\n}\n\n/**\n * Validate Redis cluster health\n */\nexport async function validateRedisClusterHealth(redis: Redis.Cluster): Promise<boolean> {\n  try {\n    const info = await redis.call('CLUSTER', 'INFO');\n    const slots = await redis.call('CLUSTER', 'SLOTS');\n\n    console.log('Cluster info:', info);\n    console.log('Cluster slots:', slots);\n\n    return true;\n  } catch (error) {\n    console.error('Redis cluster health check failed:', error);\n    return false;\n  }\n}\n\n/**\n * Get Redis cluster statistics\n */\nexport async function getRedisClusterStats(redis: Redis.Cluster): Promise<Record<string, any>> {\n  try {\n    const info = await redis.info();\n    const dbSize = await redis.dbsize();\n    const memory = await redis.info('memory');\n\n    return {\n      info,\n      dbSize,\n      memory\n    };\n  } catch (error) {\n    console.error('Error getting cluster stats:', error);\n    return {};\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ;AACA;AACA;AACA;;AAEA,OAAOE,KAAK,MAAM,SAAS;AA4C3B;AACA;AACA;AACA,OAAO,SAASC,qBAAqBA,CAAA,EAAuB;EAAA;EAAAH,cAAA,GAAAI,CAAA;EAC1D,MAAMC,KAAK;EAAA;EAAA,CAAAL,cAAA,GAAAM,CAAA,OAAG;EAAC;EAAA,CAAAN,cAAA,GAAAO,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACC,mBAAmB;EAAA;EAAA,CAAAV,cAAA,GAAAO,CAAA,UAAI,gBAAgB,GAAEI,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAACC,IAAI,IAAI;IAAA;IAAAb,cAAA,GAAAI,CAAA;IACzF,MAAM,CAACU,IAAI,EAAEC,IAAI,CAAC;IAAA;IAAA,CAAAf,cAAA,GAAAM,CAAA,OAAGO,IAAI,CAACG,IAAI,CAAC,CAAC,CAACL,KAAK,CAAC,GAAG,CAAC;IAAC;IAAAX,cAAA,GAAAM,CAAA;IAC5C,OAAO;MACLQ,IAAI;MACJC,IAAI;MAAE;MAAA,CAAAf,cAAA,GAAAO,CAAA,UAAAU,QAAQ,CAACF,IAAI,EAAE,EAAE,CAAC;MAAA;MAAA,CAAAf,cAAA,GAAAO,CAAA,UAAI,IAAI;IAClC,CAAC;EACH,CAAC,CAAC;EAAC;EAAAP,cAAA,GAAAM,CAAA;EAEH,OAAO;IACLD,KAAK;IACLa,OAAO,EAAE;MACPC,gBAAgB,EAAE,IAAI;MACtBC,kBAAkB,EAAE,IAAI;MACxBC,eAAe,EAAE,EAAE;MACnBC,oBAAoB,EAAE,GAAG;MACzBC,uBAAuB,EAAE,GAAG;MAC5BC,mBAAmB,EAAE,IAAI;MACzBC,SAAS,EAAE,MAAM;MACjBC,oBAAoB,EAAGC,KAAa,IAAK;QAAA;QAAA3B,cAAA,GAAAI,CAAA;QACvC,MAAMwB,KAAK;QAAA;QAAA,CAAA5B,cAAA,GAAAM,CAAA,OAAGuB,IAAI,CAACC,GAAG,CAAC,GAAG,GAAGD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEJ,KAAK,CAAC,EAAE,IAAI,CAAC;QAAC;QAAA3B,cAAA,GAAAM,CAAA;QACvD,OAAOsB,KAAK;MACd;IACF;EACF,CAAC;AACH;;AAEA;AACA;AACA;AACA,OAAO,SAASI,yBAAyBA,CAAA,EAA2B;EAAA;EAAAhC,cAAA,GAAAI,CAAA;EAAAJ,cAAA,GAAAM,CAAA;EAClE,OAAO;IACL2B,GAAG,EAAE;MACHC,OAAO,EAAE,IAAI;MACbC,YAAY,EAAE,GAAG;MAAE;MACnBC,UAAU,EAAE,CAAC,CAAC;IAChB,CAAC;IACDC,GAAG,EAAE;MACHH,OAAO,EAAE,IAAI;MACbI,KAAK,EAAE,UAAU;MAAE;MACnBC,cAAc,EAAE,MAAM;MACtBC,iBAAiB,EAAE;IACrB;EACF,CAAC;AACH;;AAEA;AACA;AACA;AACA,OAAO,SAASC,yBAAyBA,CAAA,EAA2B;EAAA;EAAAzC,cAAA,GAAAI,CAAA;EAClE,MAAMsC,IAAI;EAAA;EAAA,CAAA1C,cAAA,GAAAM,CAAA;EAAI;EAAA,CAAAN,cAAA,GAAAO,CAAA,UAAAC,OAAO,CAACC,GAAG,CAACkC,UAAU;EAAA;EAAA,CAAA3C,cAAA,GAAAO,CAAA,UAAI,QAAQ,EAAuB;EAAC;EAAAP,cAAA,GAAAM,CAAA;EAExE,OAAO;IACLoC,IAAI;IACJE,UAAU,EAAEpC,OAAO,CAACC,GAAG,CAACoC,iBAAiB;IACzCC,UAAU,EAAEtC,OAAO,CAACC,GAAG,CAACsC,iBAAiB;IAAA;IAAA,CAAA/C,cAAA,GAAAO,CAAA,UAAGU,QAAQ,CAACT,OAAO,CAACC,GAAG,CAACsC,iBAAiB,EAAE,EAAE,CAAC;IAAA;IAAA,CAAA/C,cAAA,GAAAO,CAAA,UAAGyC,SAAS;IACnGC,eAAe,EAAE,IAAI;IACrBC,qBAAqB,EAAE,IAAI;IAC3BC,eAAe,EAAElC,QAAQ;IAAC;IAAA,CAAAjB,cAAA,GAAAO,CAAA,UAAAC,OAAO,CAACC,GAAG,CAAC2C,sBAAsB;IAAA;IAAA,CAAApD,cAAA,GAAAO,CAAA,UAAI,KAAK,GAAE,EAAE;EAC3E,CAAC;AACH;;AAEA;AACA;AACA;AACA,OAAO,SAAS8C,2BAA2BA,CAAA,EAAa;EAAA;EAAArD,cAAA,GAAAI,CAAA;EACtD,MAAMkD,WAAW;EAAA;EAAA,CAAAtD,cAAA,GAAAM,CAAA,OAAG0B,yBAAyB,CAAC,CAAC;EAC/C,MAAMuB,QAAkB;EAAA;EAAA,CAAAvD,cAAA,GAAAM,CAAA,QAAG,EAAE;;EAE7B;EAAA;EAAAN,cAAA,GAAAM,CAAA;EACA,IAAIgD,WAAW,CAACrB,GAAG,CAACC,OAAO,EAAE;IAAA;IAAAlC,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAM,CAAA;IAC3BiD,QAAQ,CAACC,IAAI,CAAC,QAAQF,WAAW,CAACrB,GAAG,CAACE,YAAY,IAAImB,WAAW,CAACrB,GAAG,CAACG,UAAU,EAAE,CAAC;EACrF,CAAC;EAAA;EAAA;IAAApC,cAAA,GAAAO,CAAA;EAAA;;EAED;EAAAP,cAAA,GAAAM,CAAA;EACA,IAAIgD,WAAW,CAACjB,GAAG,CAACH,OAAO,EAAE;IAAA;IAAAlC,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAM,CAAA;IAC3BiD,QAAQ,CAACC,IAAI,CAAC,2BAA2B,CAAC;IAAC;IAAAxD,cAAA,GAAAM,CAAA;IAC3CiD,QAAQ,CAACC,IAAI,CAAC,0BAA0BF,WAAW,CAACjB,GAAG,CAACC,KAAK,EAAE,CAAC;IAAC;IAAAtC,cAAA,GAAAM,CAAA;IACjEiD,QAAQ,CAACC,IAAI,CAAC,wCAAwCF,WAAW,CAACjB,GAAG,CAACE,cAAc,EAAE,CAAC;IAAC;IAAAvC,cAAA,GAAAM,CAAA;IACxFiD,QAAQ,CAACC,IAAI,CAAC,0CAA0CF,WAAW,CAACjB,GAAG,CAACG,iBAAiB,EAAE,CAAC;EAC9F,CAAC;EAAA;EAAA;IAAAxC,cAAA,GAAAO,CAAA;EAAA;;EAED;EACA,MAAMkD,WAAW;EAAA;EAAA,CAAAzD,cAAA,GAAAM,CAAA,QAAGmC,yBAAyB,CAAC,CAAC;EAAC;EAAAzC,cAAA,GAAAM,CAAA;EAChD;EAAI;EAAA,CAAAN,cAAA,GAAAO,CAAA,UAAAkD,WAAW,CAACf,IAAI,KAAK,OAAO;EAAA;EAAA,CAAA1C,cAAA,GAAAO,CAAA,UAAIkD,WAAW,CAACb,UAAU,GAAE;IAAA;IAAA5C,cAAA,GAAAO,CAAA;IAAAP,cAAA,GAAAM,CAAA;IAC1DiD,QAAQ,CAACC,IAAI,CAAC,WAAWC,WAAW,CAACb,UAAU;IAAI;IAAA,CAAA5C,cAAA,GAAAO,CAAA,UAAAkD,WAAW,CAACX,UAAU;IAAA;IAAA,CAAA9C,cAAA,GAAAO,CAAA,UAAI,IAAI,GAAE,CAAC;IAAC;IAAAP,cAAA,GAAAM,CAAA;IACrFiD,QAAQ,CAACC,IAAI,CAAC,8BAA8BC,WAAW,CAACR,eAAe;IAAA;IAAA,CAAAjD,cAAA,GAAAO,CAAA,WAAG,KAAK;IAAA;IAAA,CAAAP,cAAA,GAAAO,CAAA,WAAG,IAAI,GAAE,CAAC;IAAC;IAAAP,cAAA,GAAAM,CAAA;IAC1FiD,QAAQ,CAACC,IAAI,CAAC,qCAAqCC,WAAW,CAACP,qBAAqB;IAAA;IAAA,CAAAlD,cAAA,GAAAO,CAAA,WAAG,KAAK;IAAA;IAAA,CAAAP,cAAA,GAAAO,CAAA,WAAG,IAAI,GAAE,CAAC;EACxG,CAAC;EAAA;EAAA;IAAAP,cAAA,GAAAO,CAAA;EAAA;;EAED;EAAAP,cAAA,GAAAM,CAAA;EACAiD,QAAQ,CAACC,IAAI,CAAC;EAAwB;EAAA,CAAAxD,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACiD,gBAAgB;EAAA;EAAA,CAAA1D,cAAA,GAAAO,CAAA,WAAI,KAAK,GAAE,CAAC;EAAC;EAAAP,cAAA,GAAAM,CAAA;EAC/EiD,QAAQ,CAACC,IAAI,CAAC;EAA+B;EAAA,CAAAxD,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACkD,qBAAqB;EAAA;EAAA,CAAA3D,cAAA,GAAAO,CAAA,WAAI,aAAa,GAAE,CAAC;EAAC;EAAAP,cAAA,GAAAM,CAAA;EACnGiD,QAAQ,CAACC,IAAI,CAAC;EAAsB;EAAA,CAAAxD,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACmD,aAAa;EAAA;EAAA,CAAA5D,cAAA,GAAAO,CAAA,WAAI,GAAG,GAAE,CAAC;EAAC;EAAAP,cAAA,GAAAM,CAAA;EACxEiD,QAAQ,CAACC,IAAI,CAAC;EAA4B;EAAA,CAAAxD,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACoD,mBAAmB;EAAA;EAAA,CAAA7D,cAAA,GAAAO,CAAA,WAAI,KAAK,GAAE,CAAC;EAAC;EAAAP,cAAA,GAAAM,CAAA;EAEtF,OAAOiD,QAAQ;AACjB;;AAEA;AACA;AACA;AACA,OAAO,SAASO,kBAAkBA,CAAA,EAAkB;EAAA;EAAA9D,cAAA,GAAAI,CAAA;EAClD,MAAM2D,MAAM;EAAA;EAAA,CAAA/D,cAAA,GAAAM,CAAA,QAAGH,qBAAqB,CAAC,CAAC;EAEtC,MAAM6D,OAAO;EAAA;EAAA,CAAAhE,cAAA,GAAAM,CAAA,QAAG,IAAIJ,KAAK,CAAC+D,OAAO,CAACF,MAAM,CAAC1D,KAAK,EAAE;IAC9C6D,YAAY,EAAE;MACZC,QAAQ,EAAE3D,OAAO,CAACC,GAAG,CAAC2D,cAAc;MACpCC,EAAE,EAAE;IACN,CAAC;IACD,GAAGN,MAAM,CAAC7C;EACZ,CAAC,CAAC;;EAEF;EAAA;EAAAlB,cAAA,GAAAM,CAAA;EACA0D,OAAO,CAACM,EAAE,CAAC,SAAS,EAAE,MAAM;IAAA;IAAAtE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IAC1BiE,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC;EACxC,CAAC,CAAC;EAAC;EAAAxE,cAAA,GAAAM,CAAA;EAEH0D,OAAO,CAACM,EAAE,CAAC,OAAO,EAAE,MAAM;IAAA;IAAAtE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IACxBiE,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;EACpC,CAAC,CAAC;EAAC;EAAAxE,cAAA,GAAAM,CAAA;EAEH0D,OAAO,CAACM,EAAE,CAAC,OAAO,EAAGG,GAAG,IAAK;IAAA;IAAAzE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IAC3BiE,OAAO,CAACG,KAAK,CAAC,sBAAsB,EAAED,GAAG,CAAC;EAC5C,CAAC,CAAC;EAAC;EAAAzE,cAAA,GAAAM,CAAA;EAEH0D,OAAO,CAACM,EAAE,CAAC,YAAY,EAAE,CAACG,GAAG,EAAE5D,IAAI,KAAK;IAAA;IAAAb,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IACtCiE,OAAO,CAACG,KAAK,CAAC,+BAA+B7D,IAAI,GAAG,EAAE4D,GAAG,CAAC;EAC5D,CAAC,CAAC;EAAC;EAAAzE,cAAA,GAAAM,CAAA;EAEH,OAAO0D,OAAO;AAChB;;AAEA;AACA;AACA;AACA,OAAO,SAASW,mBAAmBA,CAAA,EAAU;EAAA;EAAA3E,cAAA,GAAAI,CAAA;EAC3C,MAAMwE,KAAK;EAAA;EAAA,CAAA5E,cAAA,GAAAM,CAAA,QAAG,IAAIJ,KAAK,CAAC;IACtBY,IAAI;IAAE;IAAA,CAAAd,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACoE,UAAU;IAAA;IAAA,CAAA7E,cAAA,GAAAO,CAAA,WAAI,WAAW;IAC3CQ,IAAI,EAAEE,QAAQ;IAAC;IAAA,CAAAjB,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACqE,UAAU;IAAA;IAAA,CAAA9E,cAAA,GAAAO,CAAA,WAAI,MAAM,GAAE,EAAE,CAAC;IACpD4D,QAAQ,EAAE3D,OAAO,CAACC,GAAG,CAAC2D,cAAc;IACpCC,EAAE,EAAE,CAAC;IACLU,aAAa,EAAGpD,KAAa,IAAK;MAAA;MAAA3B,cAAA,GAAAI,CAAA;MAChC,MAAMwB,KAAK;MAAA;MAAA,CAAA5B,cAAA,GAAAM,CAAA,QAAGuB,IAAI,CAACC,GAAG,CAAC,GAAG,GAAGD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEJ,KAAK,CAAC,EAAE,IAAI,CAAC;MAAC;MAAA3B,cAAA,GAAAM,CAAA;MACvD,OAAOsB,KAAK;IACd,CAAC;IACDT,gBAAgB,EAAE,IAAI;IACtBC,kBAAkB,EAAE,IAAI;IACxB4D,oBAAoB,EAAE;EACxB,CAAC,CAAC;EAAC;EAAAhF,cAAA,GAAAM,CAAA;EAEHsE,KAAK,CAACN,EAAE,CAAC,SAAS,EAAE,MAAM;IAAA;IAAAtE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IACxBiE,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;EAChC,CAAC,CAAC;EAAC;EAAAxE,cAAA,GAAAM,CAAA;EAEHsE,KAAK,CAACN,EAAE,CAAC,OAAO,EAAE,MAAM;IAAA;IAAAtE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IACtBiE,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC;EAC5B,CAAC,CAAC;EAAC;EAAAxE,cAAA,GAAAM,CAAA;EAEHsE,KAAK,CAACN,EAAE,CAAC,OAAO,EAAGG,GAAG,IAAK;IAAA;IAAAzE,cAAA,GAAAI,CAAA;IAAAJ,cAAA,GAAAM,CAAA;IACzBiE,OAAO,CAACG,KAAK,CAAC,cAAc,EAAED,GAAG,CAAC;EACpC,CAAC,CAAC;EAAC;EAAAzE,cAAA,GAAAM,CAAA;EAEH,OAAOsE,KAAK;AACd;;AAEA;AACA;AACA;AACA,OAAO,eAAeK,sBAAsBA,CAACL,KAA4B,EAAiB;EAAA;EAAA5E,cAAA,GAAAI,CAAA;EACxF,MAAMkD,WAAW;EAAA;EAAA,CAAAtD,cAAA,GAAAM,CAAA,QAAG0B,yBAAyB,CAAC,CAAC;EAC/C,MAAMuB,QAAQ;EAAA;EAAA,CAAAvD,cAAA,GAAAM,CAAA,QAAG+C,2BAA2B,CAAC,CAAC;EAAC;EAAArD,cAAA,GAAAM,CAAA;EAE/C,IAAI;IAAA;IAAAN,cAAA,GAAAM,CAAA;IACF,KAAK,MAAM4E,OAAO,IAAI3B,QAAQ,EAAE;MAAA;MAAAvD,cAAA,GAAAM,CAAA;MAC9B,MAAMsE,KAAK,CAACO,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE,GAAGD,OAAO,CAACvE,KAAK,CAAC,GAAG,CAAC,CAACyE,KAAK,CAAC,CAAC,CAAC,CAAC;IACnE;IAAC;IAAApF,cAAA,GAAAM,CAAA;IACDiE,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;EACxD,CAAC,CAAC,OAAOE,KAAK,EAAE;IAAA;IAAA1E,cAAA,GAAAM,CAAA;IACdiE,OAAO,CAACG,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;EACnE;AACF;;AAEA;AACA;AACA;AACA,OAAO,SAASW,wBAAwBA,CAAA,EAAW;EAAA;EAAArF,cAAA,GAAAI,CAAA;EACjD,MAAMU,IAAI;EAAA;EAAA,CAAAd,cAAA,GAAAM,CAAA;EAAG;EAAA,CAAAN,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACoE,UAAU;EAAA;EAAA,CAAA7E,cAAA,GAAAO,CAAA,WAAI,WAAW;EAClD,MAAMQ,IAAI;EAAA;EAAA,CAAAf,cAAA,GAAAM,CAAA;EAAG;EAAA,CAAAN,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAACqE,UAAU;EAAA;EAAA,CAAA9E,cAAA,GAAAO,CAAA,WAAI,MAAM;EAC7C,MAAM4D,QAAQ;EAAA;EAAA,CAAAnE,cAAA,GAAAM,CAAA,QAAGE,OAAO,CAACC,GAAG,CAAC2D,cAAc;EAAA;EAAA,CAAApE,cAAA,GAAAO,CAAA,WAAG,GAAGC,OAAO,CAACC,GAAG,CAAC2D,cAAc,GAAG;EAAA;EAAA,CAAApE,cAAA,GAAAO,CAAA,WAAG,EAAE;EACnF,MAAM8D,EAAE;EAAA;EAAA,CAAArE,cAAA,GAAAM,CAAA;EAAG;EAAA,CAAAN,cAAA,GAAAO,CAAA,WAAAC,OAAO,CAACC,GAAG,CAAC6E,QAAQ;EAAA;EAAA,CAAAtF,cAAA,GAAAO,CAAA,WAAI,GAAG;EAAC;EAAAP,cAAA,GAAAM,CAAA;EAEvC,OAAO,WAAW6D,QAAQ,GAAGrD,IAAI,IAAIC,IAAI,IAAIsD,EAAE,EAAE;AACnD;;AAEA;AACA;AACA;AACA,OAAO,eAAekB,0BAA0BA,CAACX,KAAoB,EAAoB;EAAA;EAAA5E,cAAA,GAAAI,CAAA;EAAAJ,cAAA,GAAAM,CAAA;EACvF,IAAI;IACF,MAAMkF,IAAI;IAAA;IAAA,CAAAxF,cAAA,GAAAM,CAAA,QAAG,MAAMsE,KAAK,CAACO,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC;IAChD,MAAMM,KAAK;IAAA;IAAA,CAAAzF,cAAA,GAAAM,CAAA,QAAG,MAAMsE,KAAK,CAACO,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;IAAC;IAAAnF,cAAA,GAAAM,CAAA;IAEnDiE,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEgB,IAAI,CAAC;IAAC;IAAAxF,cAAA,GAAAM,CAAA;IACnCiE,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEiB,KAAK,CAAC;IAAC;IAAAzF,cAAA,GAAAM,CAAA;IAErC,OAAO,IAAI;EACb,CAAC,CAAC,OAAOoE,KAAK,EAAE;IAAA;IAAA1E,cAAA,GAAAM,CAAA;IACdiE,OAAO,CAACG,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAAC;IAAA1E,cAAA,GAAAM,CAAA;IAC3D,OAAO,KAAK;EACd;AACF;;AAEA;AACA;AACA;AACA,OAAO,eAAeoF,oBAAoBA,CAACd,KAAoB,EAAgC;EAAA;EAAA5E,cAAA,GAAAI,CAAA;EAAAJ,cAAA,GAAAM,CAAA;EAC7F,IAAI;IACF,MAAMkF,IAAI;IAAA;IAAA,CAAAxF,cAAA,GAAAM,CAAA,QAAG,MAAMsE,KAAK,CAACY,IAAI,CAAC,CAAC;IAC/B,MAAMG,MAAM;IAAA;IAAA,CAAA3F,cAAA,GAAAM,CAAA,QAAG,MAAMsE,KAAK,CAACgB,MAAM,CAAC,CAAC;IACnC,MAAMC,MAAM;IAAA;IAAA,CAAA7F,cAAA,GAAAM,CAAA,QAAG,MAAMsE,KAAK,CAACY,IAAI,CAAC,QAAQ,CAAC;IAAC;IAAAxF,cAAA,GAAAM,CAAA;IAE1C,OAAO;MACLkF,IAAI;MACJG,MAAM;MACNE;IACF,CAAC;EACH,CAAC,CAAC,OAAOnB,KAAK,EAAE;IAAA;IAAA1E,cAAA,GAAAM,CAAA;IACdiE,OAAO,CAACG,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;IAAC;IAAA1E,cAAA,GAAAM,CAAA;IACrD,OAAO,CAAC,CAAC;EACX;AACF","ignoreList":[]}