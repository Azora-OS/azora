{"version":3,"names":["cov_ljaf46j9i","actualCoverage","express","IssueParser","RewardDistributor","app","s","port","b","process","env","PORT","use","json","issueParser","rewardDistributor","post","req","res","f","action","issue","pull_request","body","status","error","parsed","parse","console","log","id","title","agent","suggestedAgent","priority","reward","calculateReward","amount","recipient","success","userId","taskId","params","claimedBy","evidenceUrl","rewardDistributed","get","service","require","main","module","listen"],"sources":["index.ts"],"sourcesContent":["/**\n * GitHub Automation Service\n * Integrates with GitHub API to:\n * - Parse issues and route to appropriate agents\n * - Execute agent actions (comments, PRs, labels)\n * - Distribute rewards (AZR tokens) for completed tasks\n */\n\nimport express from 'express';\nimport { Probot } from 'probot';\nimport { IssueParser } from './issue-parser';\nimport { RewardDistributor } from './reward-distributor';\n\nconst app = express();\nconst port = process.env.PORT || 3012;\n\napp.use(express.json());\n\nconst issueParser = new IssueParser();\nconst rewardDistributor = new RewardDistributor();\n\n/**\n * POST /webhook/github\n * GitHub webhook handler (routed through Probot)\n */\napp.post('/webhook/github', async (req, res) => {\n  const { action, issue, pull_request } = req.body;\n\n  if (!issue && !pull_request) {\n    res.status(400).json({ error: 'No issue or PR data' });\n    return;\n  }\n\n  try {\n    const parsed = issueParser.parse(issue || pull_request);\n\n    console.log(`Parsed issue: ${parsed.id}`, {\n      title: parsed.title,\n      agent: parsed.suggestedAgent,\n      priority: parsed.priority\n    });\n\n    // Route to agent (via Elara orchestrator)\n    // TODO: Make HTTP call to elara-orchestrator service\n    // const agentResponse = await routeToAgent(parsed);\n\n    // If issue completed, distribute rewards\n    if (action === 'closed') {\n      const reward = rewardDistributor.calculateReward(parsed);\n      console.log(`Issue resolved - distributing ${reward.amount} AZR to ${reward.recipient}`);\n      // TODO: Execute token distribution\n    }\n\n    res.json({ success: true, parsed });\n  } catch (error) {\n    console.error('Webhook processing error:', error);\n    res.status(500).json({ error: 'Processing failed' });\n  }\n});\n\n/**\n * POST /task/:id/claim\n * Claim a task (issue) for solving\n */\napp.post('/task/:id/claim', async (req, res) => {\n  const { userId } = req.body;\n\n  if (!userId) {\n    res.status(400).json({ error: 'userId is required' });\n    return;\n  }\n\n  try {\n    // TODO: Get task from GitHub by ID\n    // TODO: Assign to user\n    // TODO: Update UI with claim status\n\n    res.json({ success: true, taskId: req.params.id, claimedBy: userId });\n  } catch (error) {\n    console.error('Claim error:', error);\n    res.status(500).json({ error: 'Claim failed' });\n  }\n});\n\n/**\n * POST /task/:id/complete\n * Mark task as complete and distribute rewards\n */\napp.post('/task/:id/complete', async (req, res) => {\n  const { userId, evidenceUrl } = req.body;\n\n  if (!userId || !evidenceUrl) {\n    res.status(400).json({ error: 'userId and evidenceUrl are required' });\n    return;\n  }\n\n  try {\n    // TODO: Get task from GitHub\n    // TODO: Verify evidence (PR merged, test passing, etc.)\n    // TODO: Calculate and distribute rewards\n\n    res.json({\n      success: true,\n      taskId: req.params.id,\n      rewardDistributed: true\n    });\n  } catch (error) {\n    console.error('Completion error:', error);\n    res.status(500).json({ error: 'Completion failed' });\n  }\n});\n\n/**\n * GET /health\n * Health check\n */\napp.get('/health', (req, res) => {\n  res.json({ status: 'ok', service: 'github-automation' });\n});\n\nif (require.main === module) {\n  app.listen(port, () => {\n    console.log(`ðŸ¤– GitHub Automation listening on port ${port}`);\n  });\n}\n\nexport default app;\n"],"mappings":"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","ignoreList":[]}