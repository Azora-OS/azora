{"version":3,"names":["cov_2aoxttbtxc","actualCoverage","Router","UserTypeDetectionService","ElaraLogger","router","s","service","logger","post","req","res","f","profile","body","b","firstName","lastName","email","status","json","error","result","detectUserType","success","data","message","Error","userType","verifyUserType","detection","verification","requiresVerification","get","_req","timestamp","Date"],"sources":["user-type-detection.routes.ts"],"sourcesContent":["/**\n * User Type Detection Routes\n * \n * API endpoints for user type detection and verification\n */\n\nimport { Router, Request, Response } from 'express';\nimport { UserTypeDetectionService, UserProfile, DetectionResult, VerificationResult } from '../services/user-type-detection.service';\nimport { ElaraLogger } from '../utils/logger';\n\nconst router = Router();\nconst service = new UserTypeDetectionService();\nconst logger = new ElaraLogger('UserTypeDetectionRoutes');\n\n/**\n * POST /detect\n * Detect user type from profile information\n */\nrouter.post('/detect', async (req: Request, res: Response): Promise<void> => {\n  try {\n    const profile: UserProfile = req.body;\n\n    // Validate required fields\n    if (!profile.firstName || !profile.lastName || !profile.email) {\n      res.status(400).json({\n        error: 'Missing required fields: firstName, lastName, email',\n      });\n      return;\n    }\n\n    const result: DetectionResult = await service.detectUserType(profile);\n\n    res.json({\n      success: true,\n      data: result,\n    });\n  } catch (error) {\n    logger.error('Error detecting user type:', error);\n    res.status(500).json({\n      error: 'Failed to detect user type',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\n/**\n * POST /verify\n * Verify user type with external services\n */\nrouter.post('/verify', async (req: Request, res: Response): Promise<void> => {\n  try {\n    const { userType, profile } = req.body;\n\n    // Validate required fields\n    if (!userType || !profile) {\n      res.status(400).json({\n        error: 'Missing required fields: userType, profile',\n      });\n      return;\n    }\n\n    const result: VerificationResult = await service.verifyUserType(userType, profile);\n\n    res.json({\n      success: true,\n      data: result,\n    });\n  } catch (error) {\n    logger.error('Error verifying user type:', error);\n    res.status(500).json({\n      error: 'Failed to verify user type',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\n/**\n * POST /detect-and-verify\n * Detect and verify user type in one call\n */\nrouter.post('/detect-and-verify', async (req: Request, res: Response): Promise<void> => {\n  try {\n    const profile: UserProfile = req.body;\n\n    // Validate required fields\n    if (!profile.firstName || !profile.lastName || !profile.email) {\n      res.status(400).json({\n        error: 'Missing required fields: firstName, lastName, email',\n      });\n      return;\n    }\n\n    // Detect user type\n    const detection: DetectionResult = await service.detectUserType(profile);\n\n    // Verify if required\n    let verification: VerificationResult | null = null;\n    if (detection.requiresVerification) {\n      verification = await service.verifyUserType(detection.userType, profile);\n    }\n\n    res.json({\n      success: true,\n      data: {\n        detection,\n        verification,\n      },\n    });\n  } catch (error) {\n    logger.error('Error detecting and verifying user type:', error);\n    res.status(500).json({\n      error: 'Failed to detect and verify user type',\n      message: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\n/**\n * GET /health\n * Health check endpoint\n */\nrouter.get('/health', (_req: Request, res: Response): void => {\n  res.json({\n    status: 'healthy',\n    service: 'user-type-detection',\n    timestamp: new Date(),\n  });\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}