{"version":3,"names":["cov_k3w9bz70j","actualCoverage","RedisMock","store","s","Map","expirations","get","key","f","isExpired","b","delete","set","value","mode","duration","Date","now","del","keys","deleted","forEach","pattern","regex","RegExp","replace","Array","from","filter","test","flushall","clear","expiration","createRedisMock"],"sources":["redis.mock.ts"],"sourcesContent":["export class RedisMock {\n  private store: Map<string, string> = new Map();\n  private expirations: Map<string, number> = new Map();\n\n  async get(key: string): Promise<string | null> {\n    if (this.isExpired(key)) {\n      this.store.delete(key);\n      this.expirations.delete(key);\n      return null;\n    }\n    return this.store.get(key) || null;\n  }\n\n  async set(key: string, value: string, mode?: string, duration?: number): Promise<'OK'> {\n    this.store.set(key, value);\n    if (mode === 'EX' && duration) {\n      this.expirations.set(key, Date.now() + duration * 1000);\n    }\n    return 'OK';\n  }\n\n  async del(...keys: string[]): Promise<number> {\n    let deleted = 0;\n    keys.forEach(key => {\n      if (this.store.delete(key)) {deleted++;}\n      this.expirations.delete(key);\n    });\n    return deleted;\n  }\n\n  async keys(pattern: string): Promise<string[]> {\n    const regex = new RegExp(pattern.replace('*', '.*'));\n    return Array.from(this.store.keys()).filter(key => regex.test(key));\n  }\n\n  async flushall(): Promise<'OK'> {\n    this.store.clear();\n    this.expirations.clear();\n    return 'OK';\n  }\n\n  private isExpired(key: string): boolean {\n    const expiration = this.expirations.get(key);\n    return expiration ? Date.now() > expiration : false;\n  }\n}\n\nexport const createRedisMock = (): RedisMock => new RedisMock();\n"],"mappings":"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","ignoreList":[]}