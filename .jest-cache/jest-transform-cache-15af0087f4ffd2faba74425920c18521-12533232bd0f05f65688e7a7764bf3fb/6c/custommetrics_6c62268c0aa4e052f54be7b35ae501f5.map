{"version":3,"names":["cov_18s7v3seoy","actualCoverage","CustomMetrics","constructor","f","s","metrics","Map","counters","gauges","histograms","recordUserRegistration","userId","source","b","incrementCounter","setGauge","getActiveUsersCount","recordCourseEnrollment","courseId","price","course_id","recordHistogram","getTotalRevenue","recordPaymentTransaction","amount","currency","status","recordAPICall","endpoint","method","duration","name","labels","key","getMetricKey","current","get","set","updateMetric","value","has","push","timestamp","Date","now","labelStr","Object","entries","sort","a","localeCompare","map","k","v","join","type","metric","getMetrics","fromEntries","total","values","includes","reduce","sum","entry","exportPrometheus","output","module","exports"],"sources":["custom-metrics.js"],"sourcesContent":["// Task 12: Custom Metrics Implementation\nclass CustomMetrics {\n  constructor() {\n    this.metrics = new Map();\n    this.counters = new Map();\n    this.gauges = new Map();\n    this.histograms = new Map();\n  }\n\n  // Business metrics\n  recordUserRegistration(userId, source = 'web') {\n    this.incrementCounter('user_registrations_total', { source });\n    this.setGauge('active_users_count', this.getActiveUsersCount());\n  }\n\n  recordCourseEnrollment(courseId, userId, price = 0) {\n    this.incrementCounter('course_enrollments_total', { course_id: courseId });\n    this.recordHistogram('enrollment_price', price);\n    this.setGauge('total_revenue', this.getTotalRevenue() + price);\n  }\n\n  recordPaymentTransaction(amount, currency, status) {\n    this.incrementCounter('payment_transactions_total', { currency, status });\n    if (status === 'success') {\n      this.recordHistogram('payment_amount', amount);\n    }\n  }\n\n  recordAPICall(endpoint, method, duration, status) {\n    this.incrementCounter('api_requests_total', { endpoint, method, status });\n    this.recordHistogram('api_request_duration', duration, { endpoint, method });\n  }\n\n  // Core metric operations\n  incrementCounter(name, labels = {}) {\n    const key = this.getMetricKey(name, labels);\n    const current = this.counters.get(key) || 0;\n    this.counters.set(key, current + 1);\n    \n    this.updateMetric(name, 'counter', current + 1, labels);\n  }\n\n  setGauge(name, value, labels = {}) {\n    const key = this.getMetricKey(name, labels);\n    this.gauges.set(key, value);\n    \n    this.updateMetric(name, 'gauge', value, labels);\n  }\n\n  recordHistogram(name, value, labels = {}) {\n    const key = this.getMetricKey(name, labels);\n    if (!this.histograms.has(key)) {\n      this.histograms.set(key, []);\n    }\n    \n    this.histograms.get(key).push({\n      value,\n      timestamp: Date.now()\n    });\n    \n    this.updateMetric(name, 'histogram', value, labels);\n  }\n\n  getMetricKey(name, labels) {\n    const labelStr = Object.entries(labels)\n      .sort(([a], [b]) => a.localeCompare(b))\n      .map(([k, v]) => `${k}=\"${v}\"`)\n      .join(',');\n    return `${name}{${labelStr}}`;\n  }\n\n  updateMetric(name, type, value, labels) {\n    const metric = {\n      name,\n      type,\n      value,\n      labels,\n      timestamp: Date.now()\n    };\n    \n    this.metrics.set(`${name}_${Date.now()}`, metric);\n  }\n\n  getMetrics() {\n    return {\n      counters: Object.fromEntries(this.counters),\n      gauges: Object.fromEntries(this.gauges),\n      histograms: Object.fromEntries(this.histograms)\n    };\n  }\n\n  // Business logic helpers\n  getActiveUsersCount() {\n    // Placeholder - would query actual user data\n    return this.counters.get('user_registrations_total{}') || 0;\n  }\n\n  getTotalRevenue() {\n    // Placeholder - would calculate from payment data\n    let total = 0;\n    for (const [key, values] of this.histograms) {\n      if (key.includes('payment_amount')) {\n        total += values.reduce((sum, entry) => sum + entry.value, 0);\n      }\n    }\n    return total;\n  }\n\n  // Prometheus format export\n  exportPrometheus() {\n    let output = '';\n    \n    // Export counters\n    for (const [key, value] of this.counters) {\n      output += `${key} ${value}\\n`;\n    }\n    \n    // Export gauges\n    for (const [key, value] of this.gauges) {\n      output += `${key} ${value}\\n`;\n    }\n    \n    return output;\n  }\n}\n\nmodule.exports = CustomMetrics;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}