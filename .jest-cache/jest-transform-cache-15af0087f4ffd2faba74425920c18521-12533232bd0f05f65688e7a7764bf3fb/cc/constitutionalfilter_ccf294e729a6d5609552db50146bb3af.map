{"version":3,"names":["cov_lc0kr18z2","actualCoverage","ConstitutionalAI","UBUNTU_PRINCIPLES","s","validateSpec","spec","f","checks","checkProSocial","checkEthical","checkEducational","scores","Promise","all","avgScore","reduce","a","b","length","isValid","reason","undefined","ubuntuScore","validateOutput","output","isHarmful","detectHarm","isExploitative","detectExploitation","requirements","includes","harmfulPatterns","text","JSON","stringify","toLowerCase","some","pattern"],"sources":["constitutional-filter.ts"],"sourcesContent":["/**\n * Constitutional AI Filter\n * Ensures all agent actions comply with Ubuntu principles\n */\n\nimport { Spec } from '../orchestrator/orchestrator-agent';\n\nexport interface ValidationResult {\n  isValid: boolean;\n  reason?: string;\n  ubuntuScore: number;\n}\n\nexport class ConstitutionalAI {\n  private readonly UBUNTU_PRINCIPLES = [\n    'pro-social',\n    'ethical',\n    'educational',\n    'collective-benefit',\n    'sovereignty-respecting'\n  ];\n\n  async validateSpec(spec: Spec): Promise<ValidationResult> {\n    const checks = [\n      this.checkProSocial(spec),\n      this.checkEthical(spec),\n      this.checkEducational(spec)\n    ];\n    \n    const scores = await Promise.all(checks);\n    const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;\n    \n    return {\n      isValid: avgScore >= 0.7,\n      reason: avgScore < 0.7 ? 'Ubuntu principles not met' : undefined,\n      ubuntuScore: avgScore\n    };\n  }\n\n  async validateOutput(output: any): Promise<ValidationResult> {\n    const isHarmful = this.detectHarm(output);\n    const isExploitative = this.detectExploitation(output);\n    \n    if (isHarmful || isExploitative) {\n      return {\n        isValid: false,\n        reason: 'Output violates Ubuntu principles',\n        ubuntuScore: 0\n      };\n    }\n    \n    return { isValid: true, ubuntuScore: 1.0 };\n  }\n\n  private async checkProSocial(spec: Spec): Promise<number> {\n    return spec.requirements.includes('collective') ? 1.0 : 0.5;\n  }\n\n  private async checkEthical(spec: Spec): Promise<number> {\n    return !spec.requirements.includes('exploit') ? 1.0 : 0.0;\n  }\n\n  private async checkEducational(spec: Spec): Promise<number> {\n    return spec.requirements.includes('learn') ? 1.0 : 0.7;\n  }\n\n  private detectHarm(output: any): boolean {\n    const harmfulPatterns = ['exploit', 'harm', 'deceive', 'manipulate'];\n    const text = JSON.stringify(output).toLowerCase();\n    return harmfulPatterns.some(pattern => text.includes(pattern));\n  }\n\n  private detectExploitation(output: any): boolean {\n    return false; // Implement exploitation detection\n  }\n}\n"],"mappings":"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","ignoreList":[]}