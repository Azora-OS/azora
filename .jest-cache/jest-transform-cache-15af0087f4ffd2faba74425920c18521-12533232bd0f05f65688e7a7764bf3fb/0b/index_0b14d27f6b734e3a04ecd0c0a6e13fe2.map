{"version":3,"names":["cov_louoaalf3","actualCoverage","express","CardGenerator","LeaderboardService","TokenService","app","s","port","b","process","env","PORT","use","json","cardGen","leaderboard","tokens","post","req","res","f","userId","title","description","rarity","imageUrl","body","status","error","card","generateCard","success","id","dataUrl","metadata","console","get","period","limit","query","standings","getStandings","parseInt","stats","getUserStats","params","recipient","amount","reason","result","mint","transaction","service","require","main","module","listen","log"],"sources":["index.ts"],"sourcesContent":["/**\n * Community Engine Service\n * Manages:\n * - Token economy (AZR minting, transfers)\n * - Leaderboards and reputation\n * - OctoCanvas NFT card generation\n * - Gamification (achievements, badges)\n */\n\nimport express from 'express';\nimport { CardGenerator } from './card-generator';\nimport { LeaderboardService } from './leaderboard-service';\nimport { TokenService } from './token-service';\n\nconst app = express();\nconst port = process.env.PORT || 3013;\n\napp.use(express.json());\n\nconst cardGen = new CardGenerator();\nconst leaderboard = new LeaderboardService();\nconst tokens = new TokenService();\n\n/**\n * POST /card/generate\n * Generate OctoCanvas NFT card for user achievement\n */\napp.post('/card/generate', async (req, res) => {\n  const { userId, title, description, rarity, imageUrl } = req.body;\n\n  if (!userId || !title) {\n    res.status(400).json({ error: 'userId and title are required' });\n    return;\n  }\n\n  try {\n    const card = await cardGen.generateCard({\n      userId,\n      title,\n      description,\n      rarity: rarity || 'common',\n      imageUrl\n    });\n\n    res.json({\n      success: true,\n      card: {\n        id: card.id,\n        dataUrl: card.dataUrl,\n        metadata: card.metadata\n      }\n    });\n  } catch (error) {\n    console.error('Card generation error:', error);\n    res.status(500).json({ error: 'Card generation failed' });\n  }\n});\n\n/**\n * GET /leaderboard\n * Get current leaderboard standings\n */\napp.get('/leaderboard', async (req, res) => {\n  const { period = 'all', limit = 100 } = req.query;\n\n  try {\n    const standings = await leaderboard.getStandings(\n      (period as string) || 'all',\n      parseInt((limit as string) || '100')\n    );\n\n    res.json({ standings });\n  } catch (error) {\n    console.error('Leaderboard error:', error);\n    res.status(500).json({ error: 'Failed to fetch leaderboard' });\n  }\n});\n\n/**\n * GET /user/:id/stats\n * Get user reputation and stats\n */\napp.get('/user/:id/stats', async (req, res) => {\n  try {\n    const stats = await leaderboard.getUserStats(req.params.id);\n\n    res.json({\n      userId: req.params.id,\n      stats\n    });\n  } catch (error) {\n    console.error('Stats error:', error);\n    res.status(500).json({ error: 'Failed to fetch user stats' });\n  }\n});\n\n/**\n * POST /token/mint\n * Mint AZR tokens (admin only)\n */\napp.post('/token/mint', async (req, res) => {\n  const { recipient, amount, reason } = req.body;\n\n  if (!recipient || !amount || !reason) {\n    res.status(400).json({ error: 'recipient, amount, and reason are required' });\n    return;\n  }\n\n  // TODO: Verify admin permission\n\n  try {\n    const result = await tokens.mint({\n      recipient,\n      amount,\n      reason\n    });\n\n    res.json({\n      success: true,\n      transaction: result\n    });\n  } catch (error) {\n    console.error('Mint error:', error);\n    res.status(500).json({ error: 'Minting failed' });\n  }\n});\n\n/**\n * GET /health\n * Health check\n */\napp.get('/health', (req, res) => {\n  res.json({ status: 'ok', service: 'community-engine' });\n});\n\nif (require.main === module) {\n  app.listen(port, () => {\n    console.log(`ðŸŽ® Community Engine listening on port ${port}`);\n  });\n}\n\nexport default app;\n"],"mappings":"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","ignoreList":[]}