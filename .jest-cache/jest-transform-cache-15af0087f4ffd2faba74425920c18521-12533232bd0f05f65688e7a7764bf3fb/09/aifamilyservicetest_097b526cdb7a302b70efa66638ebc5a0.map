{"version":3,"names":["aiFamilyService","require","describe","beforeEach","activeConversations","clear","familyInteractions","test","expect","family","toBeDefined","Object","keys","toHaveLength","expectedMembers","member","elara","getFamilyMember","themba","name","toBe","unknown","financeMember","determineAppropriateMember","dataMember","careerMember","safetyMember","emergency","learningMember","defaultManager","userId","familyMember","message","updateConversationContext","has","conversation","get","messages","i","defaultGreeting","getPersonalizedGreeting","toContain","thembaGreeting","topic","consultation","consultFamily","insights","coordinatedResponse","naledi","financeConsultants","determineConsultants","dataConsultants","careerConsultants","synthesized","synthesizeFamilyResponse","config","getFamilyConfig","role","response","push","timestamp","Date","stats","getInteractionStats","totalInteractions","familyMemberUsage","recentInteractions","jest","spyOn","mockResolvedValue","result","routeMessage","from"],"sources":["ai-family-service.test.js"],"sourcesContent":["const aiFamilyService = require('../index');\n\ndescribe('AI Family Service', () => {\n  beforeEach(() => {\n    // Clear conversation history before each test\n    aiFamilyService.activeConversations.clear();\n    aiFamilyService.familyInteractions = [];\n  });\n\n  test('should initialize all family members', () => {\n    expect(aiFamilyService.family).toBeDefined();\n    expect(Object.keys(aiFamilyService.family)).toHaveLength(11);\n\n    // Check that all expected family members are present\n    const expectedMembers = ['elara', 'themba', 'naledi', 'jabari', 'amara',\n                            'sankofa', 'kofi', 'zola', 'abeni', 'thembo', 'nexus'];\n\n    for (const member of expectedMembers) {\n      expect(aiFamilyService.family[member]).toBeDefined();\n    }\n  });\n\n  test('should get specific family member', () => {\n    const elara = aiFamilyService.getFamilyMember('elara');\n    const themba = aiFamilyService.getFamilyMember('themba');\n\n    expect(elara.name).toBe('Elara');\n    expect(themba.name).toBe('Themba');\n\n    // Test default fallback\n    const unknown = aiFamilyService.getFamilyMember('unknown');\n    expect(unknown.name).toBe('Elara'); // Should default to Elara\n  });\n\n  test('should route message to appropriate family member based on content', () => {\n    // Test finance-related routing\n    const financeMember = aiFamilyService.determineAppropriateMember('I need help with my budget', {});\n    expect(financeMember).toBe('kofi');\n\n    // Test data-related routing\n    const dataMember = aiFamilyService.determineAppropriateMember('Can you analyze this data?', {});\n    expect(dataMember).toBe('zola');\n\n    // Test career-related routing\n    const careerMember = aiFamilyService.determineAppropriateMember('I need career advice', {});\n    expect(careerMember).toBe('naledi');\n\n    // Test safety-related routing\n    const safetyMember = aiFamilyService.determineAppropriateMember('I feel unsafe', { emergency: true });\n    expect(safetyMember).toBe('jabari');\n\n    // Test learning-related routing\n    const learningMember = aiFamilyService.determineAppropriateMember('I want to learn something new', {});\n    expect(learningMember).toBe('themba');\n\n    // Test default routing\n    const defaultManager = aiFamilyService.determineAppropriateMember('Hello there', {});\n    expect(defaultManager).toBe('elara');\n  });\n\n  test('should update conversation context', () => {\n    const userId = 'test-user-123';\n    const familyMember = 'elara';\n    const message = 'Hello Elara!';\n\n    aiFamilyService.updateConversationContext(userId, familyMember, message);\n\n    expect(aiFamilyService.activeConversations.has(userId)).toBe(true);\n\n    const conversation = aiFamilyService.activeConversations.get(userId);\n    expect(conversation.familyMember).toBe(familyMember);\n    expect(conversation.messages).toHaveLength(1);\n    expect(conversation.messages[0].message).toBe(message);\n  });\n\n  test('should maintain conversation history limit', () => {\n    const userId = 'test-user-123';\n\n    // Add more than 10 messages\n    for (let i = 0; i < 15; i++) {\n      aiFamilyService.updateConversationContext(userId, 'elara', `Message ${i}`);\n    }\n\n    const conversation = aiFamilyService.activeConversations.get(userId);\n    expect(conversation.messages).toHaveLength(10); // Should only keep last 10\n  });\n\n  test('should get personalized greeting', async () => {\n    const userId = 'test-user-123';\n\n    // Test default greeting\n    const defaultGreeting = await aiFamilyService.getPersonalizedGreeting(userId);\n    expect(defaultGreeting).toContain('Elara');\n\n    // Test specific family member greeting\n    const thembaGreeting = await aiFamilyService.getPersonalizedGreeting(userId, 'themba');\n    expect(thembaGreeting).toContain('Themba');\n  });\n\n  test('should coordinate family consultation', async () => {\n    const userId = 'test-user-123';\n    const topic = 'career advice';\n\n    const consultation = await aiFamilyService.consultFamily(userId, topic);\n\n    expect(consultation.topic).toBe(topic);\n    expect(consultation.insights).toBeDefined();\n    expect(consultation.coordinatedResponse).toBeDefined();\n\n    // Should include Elara by default\n    expect(consultation.insights.elara).toBeDefined();\n\n    // Should include relevant consultants\n    expect(consultation.insights.naledi).toBeDefined(); // Career expert\n  });\n\n  test('should determine consultants for topics', () => {\n    // Test finance topic\n    const financeConsultants = aiFamilyService.determineConsultants('financial planning');\n    expect(financeConsultants).toContain('kofi');\n    expect(financeConsultants).toContain('elara'); // Always included\n\n    // Test data topic\n    const dataConsultants = aiFamilyService.determineConsultants('data analysis');\n    expect(dataConsultants).toContain('zola');\n    expect(dataConsultants).toContain('elara');\n\n    // Test career topic\n    const careerConsultants = aiFamilyService.determineConsultants('career development');\n    expect(careerConsultants).toContain('naledi');\n    expect(careerConsultants).toContain('elara');\n  });\n\n  test('should synthesize family responses', () => {\n    const insights = {\n      elara: 'As your mother and teacher, I believe in your potential.',\n      naledi: 'Strategically, I recommend focusing on your strengths.',\n      themba: 'You can do this! I believe in you!'\n    };\n\n    const synthesized = aiFamilyService.synthesizeFamilyResponse(insights, 'learning');\n\n    expect(synthesized).toContain('As a family');\n    expect(synthesized).toContain('Elara');\n    expect(synthesized).toContain('Naledi');\n    expect(synthesized).toContain('Themba');\n  });\n\n  test('should get family configuration', () => {\n    const config = aiFamilyService.getFamilyConfig();\n\n    expect(config).toBeDefined();\n    expect(config.elara).toBeDefined();\n    expect(config.themba).toBeDefined();\n\n    // Check that config contains expected properties\n    expect(config.elara.name).toBe('Elara');\n    expect(config.elara.role).toBe('Mother & Teacher');\n  });\n\n  test('should track family interactions', async () => {\n    const userId = 'test-user-123';\n    const message = 'Hello family!';\n    const response = 'Hello there!';\n\n    // Simulate a family interaction\n    aiFamilyService.familyInteractions.push({\n      userId,\n      familyMember: 'elara',\n      message,\n      response,\n      timestamp: new Date()\n    });\n\n    const stats = aiFamilyService.getInteractionStats();\n\n    expect(stats.totalInteractions).toBe(1);\n    expect(stats.familyMemberUsage.elara).toBe(1);\n    expect(stats.recentInteractions).toHaveLength(1);\n  });\n\n  test('should route message and track interaction', async () => {\n    const userId = 'test-user-123';\n    const message = 'Tell me about Ubuntu philosophy';\n\n    // Mock the response to avoid external dependencies\n    jest.spyOn(aiFamilyService.family.elara, 'respondToUser').mockResolvedValue('Ubuntu means \"I am because we are\"');\n\n    const result = await aiFamilyService.routeMessage(userId, message, {});\n\n    expect(result.from).toBe('elara');\n    expect(result.response).toBe('Ubuntu means \"I am because we are\"');\n\n    // Check that interaction was tracked\n    expect(aiFamilyService.familyInteractions).toHaveLength(1);\n    expect(aiFamilyService.familyInteractions[0].userId).toBe(userId);\n    expect(aiFamilyService.familyInteractions[0].message).toBe(message);\n  });\n});\n"],"mappings":";;AAAA,MAAMA,eAAe,GAAGC,OAAO,CAAC,UAAU,CAAC;AAE3CC,QAAQ,CAAC,mBAAmB,EAAE,MAAM;EAClCC,UAAU,CAAC,MAAM;IACf;IACAH,eAAe,CAACI,mBAAmB,CAACC,KAAK,CAAC,CAAC;IAC3CL,eAAe,CAACM,kBAAkB,GAAG,EAAE;EACzC,CAAC,CAAC;EAEFC,IAAI,CAAC,sCAAsC,EAAE,MAAM;IACjDC,MAAM,CAACR,eAAe,CAACS,MAAM,CAAC,CAACC,WAAW,CAAC,CAAC;IAC5CF,MAAM,CAACG,MAAM,CAACC,IAAI,CAACZ,eAAe,CAACS,MAAM,CAAC,CAAC,CAACI,YAAY,CAAC,EAAE,CAAC;;IAE5D;IACA,MAAMC,eAAe,GAAG,CAAC,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAC/C,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,OAAO,CAAC;IAE9E,KAAK,MAAMC,MAAM,IAAID,eAAe,EAAE;MACpCN,MAAM,CAACR,eAAe,CAACS,MAAM,CAACM,MAAM,CAAC,CAAC,CAACL,WAAW,CAAC,CAAC;IACtD;EACF,CAAC,CAAC;EAEFH,IAAI,CAAC,mCAAmC,EAAE,MAAM;IAC9C,MAAMS,KAAK,GAAGhB,eAAe,CAACiB,eAAe,CAAC,OAAO,CAAC;IACtD,MAAMC,MAAM,GAAGlB,eAAe,CAACiB,eAAe,CAAC,QAAQ,CAAC;IAExDT,MAAM,CAACQ,KAAK,CAACG,IAAI,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC;IAChCZ,MAAM,CAACU,MAAM,CAACC,IAAI,CAAC,CAACC,IAAI,CAAC,QAAQ,CAAC;;IAElC;IACA,MAAMC,OAAO,GAAGrB,eAAe,CAACiB,eAAe,CAAC,SAAS,CAAC;IAC1DT,MAAM,CAACa,OAAO,CAACF,IAAI,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;EACtC,CAAC,CAAC;EAEFb,IAAI,CAAC,oEAAoE,EAAE,MAAM;IAC/E;IACA,MAAMe,aAAa,GAAGtB,eAAe,CAACuB,0BAA0B,CAAC,4BAA4B,EAAE,CAAC,CAAC,CAAC;IAClGf,MAAM,CAACc,aAAa,CAAC,CAACF,IAAI,CAAC,MAAM,CAAC;;IAElC;IACA,MAAMI,UAAU,GAAGxB,eAAe,CAACuB,0BAA0B,CAAC,4BAA4B,EAAE,CAAC,CAAC,CAAC;IAC/Ff,MAAM,CAACgB,UAAU,CAAC,CAACJ,IAAI,CAAC,MAAM,CAAC;;IAE/B;IACA,MAAMK,YAAY,GAAGzB,eAAe,CAACuB,0BAA0B,CAAC,sBAAsB,EAAE,CAAC,CAAC,CAAC;IAC3Ff,MAAM,CAACiB,YAAY,CAAC,CAACL,IAAI,CAAC,QAAQ,CAAC;;IAEnC;IACA,MAAMM,YAAY,GAAG1B,eAAe,CAACuB,0BAA0B,CAAC,eAAe,EAAE;MAAEI,SAAS,EAAE;IAAK,CAAC,CAAC;IACrGnB,MAAM,CAACkB,YAAY,CAAC,CAACN,IAAI,CAAC,QAAQ,CAAC;;IAEnC;IACA,MAAMQ,cAAc,GAAG5B,eAAe,CAACuB,0BAA0B,CAAC,+BAA+B,EAAE,CAAC,CAAC,CAAC;IACtGf,MAAM,CAACoB,cAAc,CAAC,CAACR,IAAI,CAAC,QAAQ,CAAC;;IAErC;IACA,MAAMS,cAAc,GAAG7B,eAAe,CAACuB,0BAA0B,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;IACpFf,MAAM,CAACqB,cAAc,CAAC,CAACT,IAAI,CAAC,OAAO,CAAC;EACtC,CAAC,CAAC;EAEFb,IAAI,CAAC,oCAAoC,EAAE,MAAM;IAC/C,MAAMuB,MAAM,GAAG,eAAe;IAC9B,MAAMC,YAAY,GAAG,OAAO;IAC5B,MAAMC,OAAO,GAAG,cAAc;IAE9BhC,eAAe,CAACiC,yBAAyB,CAACH,MAAM,EAAEC,YAAY,EAAEC,OAAO,CAAC;IAExExB,MAAM,CAACR,eAAe,CAACI,mBAAmB,CAAC8B,GAAG,CAACJ,MAAM,CAAC,CAAC,CAACV,IAAI,CAAC,IAAI,CAAC;IAElE,MAAMe,YAAY,GAAGnC,eAAe,CAACI,mBAAmB,CAACgC,GAAG,CAACN,MAAM,CAAC;IACpEtB,MAAM,CAAC2B,YAAY,CAACJ,YAAY,CAAC,CAACX,IAAI,CAACW,YAAY,CAAC;IACpDvB,MAAM,CAAC2B,YAAY,CAACE,QAAQ,CAAC,CAACxB,YAAY,CAAC,CAAC,CAAC;IAC7CL,MAAM,CAAC2B,YAAY,CAACE,QAAQ,CAAC,CAAC,CAAC,CAACL,OAAO,CAAC,CAACZ,IAAI,CAACY,OAAO,CAAC;EACxD,CAAC,CAAC;EAEFzB,IAAI,CAAC,4CAA4C,EAAE,MAAM;IACvD,MAAMuB,MAAM,GAAG,eAAe;;IAE9B;IACA,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;MAC3BtC,eAAe,CAACiC,yBAAyB,CAACH,MAAM,EAAE,OAAO,EAAE,WAAWQ,CAAC,EAAE,CAAC;IAC5E;IAEA,MAAMH,YAAY,GAAGnC,eAAe,CAACI,mBAAmB,CAACgC,GAAG,CAACN,MAAM,CAAC;IACpEtB,MAAM,CAAC2B,YAAY,CAACE,QAAQ,CAAC,CAACxB,YAAY,CAAC,EAAE,CAAC,CAAC,CAAC;EAClD,CAAC,CAAC;EAEFN,IAAI,CAAC,kCAAkC,EAAE,YAAY;IACnD,MAAMuB,MAAM,GAAG,eAAe;;IAE9B;IACA,MAAMS,eAAe,GAAG,MAAMvC,eAAe,CAACwC,uBAAuB,CAACV,MAAM,CAAC;IAC7EtB,MAAM,CAAC+B,eAAe,CAAC,CAACE,SAAS,CAAC,OAAO,CAAC;;IAE1C;IACA,MAAMC,cAAc,GAAG,MAAM1C,eAAe,CAACwC,uBAAuB,CAACV,MAAM,EAAE,QAAQ,CAAC;IACtFtB,MAAM,CAACkC,cAAc,CAAC,CAACD,SAAS,CAAC,QAAQ,CAAC;EAC5C,CAAC,CAAC;EAEFlC,IAAI,CAAC,uCAAuC,EAAE,YAAY;IACxD,MAAMuB,MAAM,GAAG,eAAe;IAC9B,MAAMa,KAAK,GAAG,eAAe;IAE7B,MAAMC,YAAY,GAAG,MAAM5C,eAAe,CAAC6C,aAAa,CAACf,MAAM,EAAEa,KAAK,CAAC;IAEvEnC,MAAM,CAACoC,YAAY,CAACD,KAAK,CAAC,CAACvB,IAAI,CAACuB,KAAK,CAAC;IACtCnC,MAAM,CAACoC,YAAY,CAACE,QAAQ,CAAC,CAACpC,WAAW,CAAC,CAAC;IAC3CF,MAAM,CAACoC,YAAY,CAACG,mBAAmB,CAAC,CAACrC,WAAW,CAAC,CAAC;;IAEtD;IACAF,MAAM,CAACoC,YAAY,CAACE,QAAQ,CAAC9B,KAAK,CAAC,CAACN,WAAW,CAAC,CAAC;;IAEjD;IACAF,MAAM,CAACoC,YAAY,CAACE,QAAQ,CAACE,MAAM,CAAC,CAACtC,WAAW,CAAC,CAAC,CAAC,CAAC;EACtD,CAAC,CAAC;EAEFH,IAAI,CAAC,yCAAyC,EAAE,MAAM;IACpD;IACA,MAAM0C,kBAAkB,GAAGjD,eAAe,CAACkD,oBAAoB,CAAC,oBAAoB,CAAC;IACrF1C,MAAM,CAACyC,kBAAkB,CAAC,CAACR,SAAS,CAAC,MAAM,CAAC;IAC5CjC,MAAM,CAACyC,kBAAkB,CAAC,CAACR,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;;IAE/C;IACA,MAAMU,eAAe,GAAGnD,eAAe,CAACkD,oBAAoB,CAAC,eAAe,CAAC;IAC7E1C,MAAM,CAAC2C,eAAe,CAAC,CAACV,SAAS,CAAC,MAAM,CAAC;IACzCjC,MAAM,CAAC2C,eAAe,CAAC,CAACV,SAAS,CAAC,OAAO,CAAC;;IAE1C;IACA,MAAMW,iBAAiB,GAAGpD,eAAe,CAACkD,oBAAoB,CAAC,oBAAoB,CAAC;IACpF1C,MAAM,CAAC4C,iBAAiB,CAAC,CAACX,SAAS,CAAC,QAAQ,CAAC;IAC7CjC,MAAM,CAAC4C,iBAAiB,CAAC,CAACX,SAAS,CAAC,OAAO,CAAC;EAC9C,CAAC,CAAC;EAEFlC,IAAI,CAAC,oCAAoC,EAAE,MAAM;IAC/C,MAAMuC,QAAQ,GAAG;MACf9B,KAAK,EAAE,0DAA0D;MACjEgC,MAAM,EAAE,wDAAwD;MAChE9B,MAAM,EAAE;IACV,CAAC;IAED,MAAMmC,WAAW,GAAGrD,eAAe,CAACsD,wBAAwB,CAACR,QAAQ,EAAE,UAAU,CAAC;IAElFtC,MAAM,CAAC6C,WAAW,CAAC,CAACZ,SAAS,CAAC,aAAa,CAAC;IAC5CjC,MAAM,CAAC6C,WAAW,CAAC,CAACZ,SAAS,CAAC,OAAO,CAAC;IACtCjC,MAAM,CAAC6C,WAAW,CAAC,CAACZ,SAAS,CAAC,QAAQ,CAAC;IACvCjC,MAAM,CAAC6C,WAAW,CAAC,CAACZ,SAAS,CAAC,QAAQ,CAAC;EACzC,CAAC,CAAC;EAEFlC,IAAI,CAAC,iCAAiC,EAAE,MAAM;IAC5C,MAAMgD,MAAM,GAAGvD,eAAe,CAACwD,eAAe,CAAC,CAAC;IAEhDhD,MAAM,CAAC+C,MAAM,CAAC,CAAC7C,WAAW,CAAC,CAAC;IAC5BF,MAAM,CAAC+C,MAAM,CAACvC,KAAK,CAAC,CAACN,WAAW,CAAC,CAAC;IAClCF,MAAM,CAAC+C,MAAM,CAACrC,MAAM,CAAC,CAACR,WAAW,CAAC,CAAC;;IAEnC;IACAF,MAAM,CAAC+C,MAAM,CAACvC,KAAK,CAACG,IAAI,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC;IACvCZ,MAAM,CAAC+C,MAAM,CAACvC,KAAK,CAACyC,IAAI,CAAC,CAACrC,IAAI,CAAC,kBAAkB,CAAC;EACpD,CAAC,CAAC;EAEFb,IAAI,CAAC,kCAAkC,EAAE,YAAY;IACnD,MAAMuB,MAAM,GAAG,eAAe;IAC9B,MAAME,OAAO,GAAG,eAAe;IAC/B,MAAM0B,QAAQ,GAAG,cAAc;;IAE/B;IACA1D,eAAe,CAACM,kBAAkB,CAACqD,IAAI,CAAC;MACtC7B,MAAM;MACNC,YAAY,EAAE,OAAO;MACrBC,OAAO;MACP0B,QAAQ;MACRE,SAAS,EAAE,IAAIC,IAAI,CAAC;IACtB,CAAC,CAAC;IAEF,MAAMC,KAAK,GAAG9D,eAAe,CAAC+D,mBAAmB,CAAC,CAAC;IAEnDvD,MAAM,CAACsD,KAAK,CAACE,iBAAiB,CAAC,CAAC5C,IAAI,CAAC,CAAC,CAAC;IACvCZ,MAAM,CAACsD,KAAK,CAACG,iBAAiB,CAACjD,KAAK,CAAC,CAACI,IAAI,CAAC,CAAC,CAAC;IAC7CZ,MAAM,CAACsD,KAAK,CAACI,kBAAkB,CAAC,CAACrD,YAAY,CAAC,CAAC,CAAC;EAClD,CAAC,CAAC;EAEFN,IAAI,CAAC,4CAA4C,EAAE,YAAY;IAC7D,MAAMuB,MAAM,GAAG,eAAe;IAC9B,MAAME,OAAO,GAAG,iCAAiC;;IAEjD;IACAmC,IAAI,CAACC,KAAK,CAACpE,eAAe,CAACS,MAAM,CAACO,KAAK,EAAE,eAAe,CAAC,CAACqD,iBAAiB,CAAC,oCAAoC,CAAC;IAEjH,MAAMC,MAAM,GAAG,MAAMtE,eAAe,CAACuE,YAAY,CAACzC,MAAM,EAAEE,OAAO,EAAE,CAAC,CAAC,CAAC;IAEtExB,MAAM,CAAC8D,MAAM,CAACE,IAAI,CAAC,CAACpD,IAAI,CAAC,OAAO,CAAC;IACjCZ,MAAM,CAAC8D,MAAM,CAACZ,QAAQ,CAAC,CAACtC,IAAI,CAAC,oCAAoC,CAAC;;IAElE;IACAZ,MAAM,CAACR,eAAe,CAACM,kBAAkB,CAAC,CAACO,YAAY,CAAC,CAAC,CAAC;IAC1DL,MAAM,CAACR,eAAe,CAACM,kBAAkB,CAAC,CAAC,CAAC,CAACwB,MAAM,CAAC,CAACV,IAAI,CAACU,MAAM,CAAC;IACjEtB,MAAM,CAACR,eAAe,CAACM,kBAAkB,CAAC,CAAC,CAAC,CAAC0B,OAAO,CAAC,CAACZ,IAAI,CAACY,OAAO,CAAC;EACrE,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}