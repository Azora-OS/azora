{"version":3,"names":["cov_1dyc8tl2ag","actualCoverage","TransferValidator","constructor","attributionTracker","f","s","validateTransfer","from","to","amount","attribution","b","valid","error","originalCreator","valueChain","length","royalties","calculateRoyaltyDistribution","processAttributedTransfer","validation","Error","Map","royaltyTotal","Array","values","reduce","sum","val","netAmount","console","log","recipient","royaltyAmount","entries","transferRoyalty","executeTransfer","success","fetch","method","headers","body","JSON","stringify","currency","type","data","royalty"],"sources":["transfer-validator.ts"],"sourcesContent":["import { AttributionTracker, Attribution } from './attribution-tracker';\n\nexport class TransferValidator {\n    private attributionTracker: AttributionTracker;\n\n    constructor(attributionTracker: AttributionTracker) {\n        this.attributionTracker = attributionTracker;\n    }\n\n    /**\n     * Validate transfer includes proper attribution\n     */\n    validateTransfer(\n        from: string,\n        to: string,\n        amount: number,\n        attribution?: Attribution\n    ): { valid: boolean; error?: string; royalties?: Map<string, number> } {\n        // Check if attribution is required\n        if (amount > 0 && !attribution) {\n            return {\n                valid: false,\n                error: 'Attribution required for all value transfers'\n            };\n        }\n\n        if (!attribution) {\n            return { valid: true }; // Zero-value transfers don't need attribution\n        }\n\n        // Validate attribution structure\n        if (!attribution.originalCreator) {\n            return {\n                valid: false,\n                error: 'Original creator must be specified'\n            };\n        }\n\n        if (!attribution.valueChain || attribution.valueChain.length === 0) {\n            return {\n                valid: false,\n                error: 'Value chain must be specified'\n            };\n        }\n\n        // Calculate royalty distribution\n        const royalties = this.attributionTracker.calculateRoyaltyDistribution(\n            attribution,\n            amount\n        );\n\n        return {\n            valid: true,\n            royalties\n        };\n    }\n\n    /**\n     * Process transfer with attribution\n     */\n    async processAttributedTransfer(\n        from: string,\n        to: string,\n        amount: number,\n        attribution: Attribution\n    ): Promise<{ success: boolean; royalties: Map<string, number> }> {\n        // Validate transfer\n        const validation = this.validateTransfer(from, to, amount, attribution);\n\n        if (!validation.valid) {\n            throw new Error(validation.error);\n        }\n\n        // Calculate royalties\n        const royalties = validation.royalties || new Map();\n        const royaltyTotal = Array.from(royalties.values()).reduce((sum, val) => sum + val, 0);\n        const netAmount = amount - royaltyTotal;\n\n        console.log(`ðŸ”— Processing attributed transfer:`);\n        console.log(`   From: ${from} â†’ To: ${to}`);\n        console.log(`   Amount: ${amount} AZR`);\n        console.log(`   Net: ${netAmount} AZR`);\n        console.log(`   Royalties: ${royaltyTotal} AZR`);\n\n        // Distribute royalties\n        for (const [recipient, royaltyAmount] of royalties.entries()) {\n            await this.transferRoyalty(from, recipient, royaltyAmount, attribution);\n        }\n\n        // Transfer net amount\n        await this.executeTransfer(from, to, netAmount);\n\n        return {\n            success: true,\n            royalties\n        };\n    }\n\n    /**\n     * Transfer royalty to creator\n     */\n    private async transferRoyalty(\n        from: string,\n        to: string,\n        amount: number,\n        attribution: Attribution\n    ): Promise<void> {\n        try {\n            await fetch('http://localhost:3011/api/blockchain/transaction', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    from,\n                    to,\n                    amount,\n                    currency: 'AZR',\n                    type: 'Transfer',\n                    data: {\n                        royalty: true,\n                        attribution\n                    }\n                })\n            });\n            console.log(`   ðŸ’° Royalty: ${amount} AZR â†’ ${to}`);\n        } catch (error) {\n            console.error('Royalty transfer failed:', error);\n        }\n    }\n\n    /**\n     * Execute main transfer\n     */\n    private async executeTransfer(from: string, to: string, amount: number): Promise<void> {\n        try {\n            await fetch('http://localhost:3011/api/blockchain/transaction', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    from,\n                    to,\n                    amount,\n                    currency: 'AZR',\n                    type: 'Transfer'\n                })\n            });\n        } catch (error) {\n            console.error('Transfer failed:', error);\n            throw error;\n        }\n    }\n}\n\nexport default TransferValidator;\n"],"mappings":"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","ignoreList":[]}