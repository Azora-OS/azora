{"version":3,"names":["cov_jdecpxwza","actualCoverage","express","s","require","router","Router","generateAccessToken","generateRefreshToken","OAUTH_PROVIDERS","google","clientId","process","env","GOOGLE_CLIENT_ID","clientSecret","GOOGLE_CLIENT_SECRET","redirectUri","b","GOOGLE_REDIRECT_URI","authUrl","tokenUrl","userInfoUrl","github","GITHUB_CLIENT_ID","GITHUB_CLIENT_SECRET","GITHUB_REDIRECT_URI","get","req","res","f","config","params","URLSearchParams","client_id","redirect_uri","response_type","scope","access_type","prompt","redirect","code","error","query","status","json","details","tokenResponse","fetch","method","headers","body","client_secret","grant_type","tokens","userResponse","Authorization","access_token","userInfo","user","id","email","name","picture","provider","role","accessToken","refreshToken","userId","success","err","message","JSON","stringify","login","avatar_url","module","exports"],"sources":["oauth.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst { generateAccessToken, generateRefreshToken } = require('../middleware/jwt');\n\n// OAuth Configuration\nconst OAUTH_PROVIDERS = {\n  google: {\n    clientId: process.env.GOOGLE_CLIENT_ID,\n    clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n    redirectUri: process.env.GOOGLE_REDIRECT_URI || 'http://localhost:4004/api/oauth/google/callback',\n    authUrl: 'https://accounts.google.com/o/oauth2/v2/auth',\n    tokenUrl: 'https://oauth2.googleapis.com/token',\n    userInfoUrl: 'https://www.googleapis.com/oauth2/v2/userinfo'\n  },\n  github: {\n    clientId: process.env.GITHUB_CLIENT_ID,\n    clientSecret: process.env.GITHUB_CLIENT_SECRET,\n    redirectUri: process.env.GITHUB_REDIRECT_URI || 'http://localhost:4004/api/oauth/github/callback',\n    authUrl: 'https://github.com/login/oauth/authorize',\n    tokenUrl: 'https://github.com/login/oauth/access_token',\n    userInfoUrl: 'https://api.github.com/user'\n  }\n};\n\n// Google OAuth\nrouter.get('/google', (req, res) => {\n  const config = OAUTH_PROVIDERS.google;\n  const params = new URLSearchParams({\n    client_id: config.clientId,\n    redirect_uri: config.redirectUri,\n    response_type: 'code',\n    scope: 'openid email profile',\n    access_type: 'offline',\n    prompt: 'consent'\n  });\n  res.redirect(`${config.authUrl}?${params}`);\n});\n\nrouter.get('/google/callback', async (req, res) => {\n  const { code, error } = req.query;\n  \n  if (error) {\n    return res.status(400).json({ error: 'OAuth authorization failed', details: error });\n  }\n\n  try {\n    const config = OAUTH_PROVIDERS.google;\n    const tokenResponse = await fetch(config.tokenUrl, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n      body: new URLSearchParams({\n        code,\n        client_id: config.clientId,\n        client_secret: config.clientSecret,\n        redirect_uri: config.redirectUri,\n        grant_type: 'authorization_code'\n      })\n    });\n\n    const tokens = await tokenResponse.json();\n    \n    const userResponse = await fetch(config.userInfoUrl, {\n      headers: { Authorization: `Bearer ${tokens.access_token}` }\n    });\n    \n    const userInfo = await userResponse.json();\n    \n    const user = {\n      id: userInfo.id,\n      email: userInfo.email,\n      name: userInfo.name,\n      picture: userInfo.picture,\n      provider: 'google',\n      role: 'student'\n    };\n\n    const accessToken = generateAccessToken(user);\n    const refreshToken = generateRefreshToken({ userId: user.id });\n\n    res.json({\n      success: true,\n      accessToken,\n      refreshToken,\n      user\n    });\n  } catch (err) {\n    res.status(500).json({ error: 'OAuth authentication failed', details: err.message });\n  }\n});\n\n// GitHub OAuth\nrouter.get('/github', (req, res) => {\n  const config = OAUTH_PROVIDERS.github;\n  const params = new URLSearchParams({\n    client_id: config.clientId,\n    redirect_uri: config.redirectUri,\n    scope: 'user:email'\n  });\n  res.redirect(`${config.authUrl}?${params}`);\n});\n\nrouter.get('/github/callback', async (req, res) => {\n  const { code, error } = req.query;\n  \n  if (error) {\n    return res.status(400).json({ error: 'OAuth authorization failed', details: error });\n  }\n\n  try {\n    const config = OAUTH_PROVIDERS.github;\n    const tokenResponse = await fetch(config.tokenUrl, {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify({\n        code,\n        client_id: config.clientId,\n        client_secret: config.clientSecret,\n        redirect_uri: config.redirectUri\n      })\n    });\n\n    const tokens = await tokenResponse.json();\n    \n    const userResponse = await fetch(config.userInfoUrl, {\n      headers: { \n        Authorization: `Bearer ${tokens.access_token}`,\n        'User-Agent': 'Azora-Auth'\n      }\n    });\n    \n    const userInfo = await userResponse.json();\n    \n    const user = {\n      id: userInfo.id,\n      email: userInfo.email,\n      name: userInfo.name || userInfo.login,\n      picture: userInfo.avatar_url,\n      provider: 'github',\n      role: 'student'\n    };\n\n    const accessToken = generateAccessToken(user);\n    const refreshToken = generateRefreshToken({ userId: user.id });\n\n    res.json({\n      success: true,\n      accessToken,\n      refreshToken,\n      user\n    });\n  } catch (err) {\n    res.status(500).json({ error: 'OAuth authentication failed', details: err.message });\n  }\n});\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}