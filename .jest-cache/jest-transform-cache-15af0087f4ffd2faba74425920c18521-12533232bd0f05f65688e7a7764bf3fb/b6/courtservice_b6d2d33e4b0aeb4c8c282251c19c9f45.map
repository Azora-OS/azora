{"version":3,"names":["cov_2kn818hc2q","actualCoverage","v4","uuidv4","ConstitutionalEngine","CourtService","cases","s","Map","constructor","f","engine","fileDispute","claimantId","reason","newCase","id","status","createdAt","Date","set","console","log","issueRuling","caseId","disputeCase","get","b","Error","mockAction","type","actorId","payload","context","validation","validateAction","ruling","isAllowed","critique","getCase"],"sources":["court-service.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport { ConstitutionalEngine, Action } from '../../constitutional-ai/src/constitutional-engine';\n\nexport interface Case {\n    id: string;\n    claimantId: string;\n    reason: string;\n    status: 'OPEN' | 'UNDER_REVIEW' | 'RULING_ISSUED' | 'CLOSED';\n    ruling?: string;\n    createdAt: Date;\n}\n\nexport class CourtService {\n    private cases: Map<string, Case> = new Map();\n    private engine: ConstitutionalEngine;\n\n    constructor() {\n        this.engine = new ConstitutionalEngine();\n    }\n\n    /**\n     * Files a new dispute case.\n     * @param claimantId ID of the user filing the dispute.\n     * @param reason Reason for the dispute.\n     * @returns The created Case object.\n     */\n    fileDispute(claimantId: string, reason: string): Case {\n        const newCase: Case = {\n            id: uuidv4(),\n            claimantId,\n            reason,\n            status: 'OPEN',\n            createdAt: new Date()\n        };\n        this.cases.set(newCase.id, newCase);\n        console.log(`[CourtService] Case filed: ${newCase.id} by ${claimantId}`);\n        return newCase;\n    }\n\n    /**\n     * Issues a ruling for a specific case using the Constitutional Engine.\n     * @param caseId The ID of the case.\n     * @returns The updated Case with the ruling.\n     */\n    issueRuling(caseId: string): Case {\n        const disputeCase = this.cases.get(caseId);\n        if (!disputeCase) {\n            throw new Error(`Case not found: ${caseId}`);\n        }\n\n        disputeCase.status = 'UNDER_REVIEW';\n        console.log(`[CourtService] Reviewing case: ${caseId}`);\n\n        // Simulate analyzing the reason against the constitution\n        // In a real system, we would construct an Action representing the disputed event\n        const mockAction: Action = {\n            type: 'dispute_review',\n            actorId: disputeCase.claimantId,\n            payload: { reason: disputeCase.reason },\n            context: 'constitutional_court'\n        };\n\n        const validation = this.engine.validateAction(mockAction);\n\n        disputeCase.ruling = validation.isAllowed\n            ? `Ruling: Dispute Valid. ${validation.critique}`\n            : `Ruling: Dispute Dismissed. ${validation.critique}`;\n\n        disputeCase.status = 'RULING_ISSUED';\n        console.log(`[CourtService] Ruling issued for ${caseId}: ${disputeCase.ruling}`);\n\n        return disputeCase;\n    }\n\n    getCase(caseId: string): Case | undefined {\n        return this.cases.get(caseId);\n    }\n}\n"],"mappings":"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","ignoreList":[]}