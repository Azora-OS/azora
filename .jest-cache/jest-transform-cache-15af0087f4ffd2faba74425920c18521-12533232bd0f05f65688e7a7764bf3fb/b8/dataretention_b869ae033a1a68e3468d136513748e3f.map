{"version":3,"names":["cov_1qtktxslh5","actualCoverage","createLogger","logInfo","logError","logWarn","logger","s","RETENTION_POLICIES","dataType","retentionDays","autoDelete","DataRetentionManager","cleanupExpiredData","f","policy","b","deleteExpiredData","error","cutoffDate","Date","setDate","getDate","deletedCount","getRetentionPolicy","find","p","getAllRetentionPolicies","scheduleCleanup","cronExpression","dataRetentionManager"],"sources":["data-retention.ts"],"sourcesContent":["import { createLogger, logInfo, logError, logWarn } from '../logging';\n\nconst logger = createLogger('data-retention');\n\nexport interface RetentionPolicy {\n  dataType: string;\n  retentionDays: number;\n  autoDelete: boolean;\n}\n\nconst RETENTION_POLICIES: RetentionPolicy[] = [\n  { dataType: 'user_activity_logs', retentionDays: 90, autoDelete: true },\n  { dataType: 'transaction_records', retentionDays: 2555, autoDelete: false }, // 7 years\n  { dataType: 'course_progress', retentionDays: 1825, autoDelete: false }, // 5 years\n  { dataType: 'session_data', retentionDays: 30, autoDelete: true },\n  { dataType: 'audit_logs', retentionDays: 2555, autoDelete: false },\n  { dataType: 'error_logs', retentionDays: 90, autoDelete: true },\n  { dataType: 'performance_metrics', retentionDays: 30, autoDelete: true }\n];\n\nexport class DataRetentionManager {\n  async cleanupExpiredData(): Promise<void> {\n    try {\n      logInfo(logger, '[GDPR] Starting data retention cleanup');\n      \n      for (const policy of RETENTION_POLICIES) {\n        if (policy.autoDelete) {\n          await this.deleteExpiredData(policy);\n        }\n      }\n      \n      logInfo(logger, '[GDPR] Data retention cleanup completed');\n    } catch (error) {\n      logError(logger, '[GDPR] Data retention cleanup failed', error as Error);\n      throw error;\n    }\n  }\n\n  private async deleteExpiredData(policy: RetentionPolicy): Promise<void> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - policy.retentionDays);\n\n    try {\n      const deletedCount = 0;\n\n      switch (policy.dataType) {\n        case 'user_activity_logs':\n          // Delete old activity logs (if stored in database)\n          // This is a placeholder - actual implementation depends on logging system\n          logInfo(logger, `[GDPR] Cleanup: ${policy.dataType} older than ${cutoffDate}`);\n          break;\n\n        case 'session_data':\n          // Delete expired sessions\n          logInfo(logger, `[GDPR] Cleanup: ${policy.dataType} older than ${cutoffDate}`);\n          break;\n\n        case 'error_logs':\n          // Delete old error logs\n          logInfo(logger, `[GDPR] Cleanup: ${policy.dataType} older than ${cutoffDate}`);\n          break;\n\n        case 'performance_metrics':\n          // Delete old performance metrics\n          logInfo(logger, `[GDPR] Cleanup: ${policy.dataType} older than ${cutoffDate}`);\n          break;\n\n        default:\n          logWarn(logger, `[GDPR] Unknown data type for cleanup: ${policy.dataType}`);\n      }\n\n      logInfo(logger, `[GDPR] Deleted ${deletedCount} records of type ${policy.dataType}`);\n    } catch (error) {\n      logError(logger, `[GDPR] Failed to delete ${policy.dataType}`, error as Error);\n      throw error;\n    }\n  }\n\n  getRetentionPolicy(dataType: string): RetentionPolicy | undefined {\n    return RETENTION_POLICIES.find(p => p.dataType === dataType);\n  }\n\n  getAllRetentionPolicies(): RetentionPolicy[] {\n    return RETENTION_POLICIES;\n  }\n\n  async scheduleCleanup(cronExpression: string = '0 2 * * *'): Promise<void> {\n    // This would be implemented with a job scheduler like node-cron\n    logInfo(logger, '[GDPR] Data retention cleanup scheduled', { cronExpression });\n  }\n}\n\nexport const dataRetentionManager = new DataRetentionManager();\n"],"mappings":"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","ignoreList":[]}