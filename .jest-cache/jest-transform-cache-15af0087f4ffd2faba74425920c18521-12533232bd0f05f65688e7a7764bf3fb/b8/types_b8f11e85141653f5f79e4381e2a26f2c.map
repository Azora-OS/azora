{"version":3,"names":["cov_grvvsg96i","actualCoverage","QueryComplexity","RoutingTier"],"sources":["types.ts"],"sourcesContent":["/**\n * AI Routing System - Type Definitions\n * Interfaces for query classification, routing decisions, and metrics\n */\n\n/**\n * Query complexity levels for routing decisions\n */\nexport enum QueryComplexity {\n  SIMPLE = 'SIMPLE',\n  MODERATE = 'MODERATE',\n  COMPLEX = 'COMPLEX'\n}\n\n/**\n * Routing tiers for different processing strategies\n */\nexport enum RoutingTier {\n  LOCAL_LLM = 'LOCAL_LLM',      // Quantized Llama/Phi on-device\n  RAP_SYSTEM = 'RAP_SYSTEM',    // Retrieval-Augmented Prompt with Knowledge Ocean\n  EXTERNAL_LLM = 'EXTERNAL_LLM' // OpenAI GPT-4 or similar\n}\n\n/**\n * Incoming query from user\n */\nexport interface AIQuery {\n  id?: string;\n  query: string;\n  userId?: string;\n  context?: Record<string, any>;\n  metadata?: Record<string, any>;\n}\n\n/**\n * Query classification result\n */\nexport interface QueryClassificationResult {\n  id: string;\n  query: string;\n  classifiedAs: QueryComplexity;\n  confidence: number; // 0.0 to 1.0\n  routedTo: RoutingTier;\n  reasoning?: string;\n  metadata?: Record<string, any>;\n}\n\n/**\n * Routing decision with metrics\n */\nexport interface RoutingDecision {\n  tier: RoutingTier;\n  confidence: number;\n  estimatedCost: number;\n  estimatedLatency: number;\n  fallbackTier?: RoutingTier;\n  routingTier: RoutingTier;\n  totalRequests: number;\n  successfulRequests: number;\n  failedRequests: number;\n  averageResponseTime: number; // milliseconds\n  averageCost: number;\n  cacheHits: number;\n  cacheMisses: number;\n  cacheHitRate: number; // percentage\n  successRate: number; // percentage\n  lastUpdated: Date;\n}\n\n/**\n * Cache entry for routing decisions and responses\n */\nexport interface CacheEntry {\n  id: string;\n  queryHash: string;\n  query: string;\n  response: string;\n  routingTier: RoutingTier;\n  cost: number;\n  ttl: number; // seconds\n  expiresAt: Date;\n  hitCount: number;\n}\n\n/**\n * Query classifier interface\n */\nexport interface IQueryClassifier {\n  classify(query: AIQuery): Promise<QueryClassificationResult>;\n  getClassificationMetrics(): Promise<Record<QueryComplexity, number>>;\n}\n\n/**\n * Routing decision maker interface\n */\nexport interface IRoutingDecisionMaker {\n  makeDecision(classification: QueryClassificationResult): Promise<RoutingDecision>;\n  updateMetrics(tier: RoutingTier, success: boolean, responseTime: number, cost: number): Promise<void>;\n  getMetrics(tier: RoutingTier): Promise<RoutingMetricsData>;\n}\n\n/**\n * Cache manager interface\n */\nexport interface ICacheManager {\n  get(queryHash: string): Promise<CacheEntry | null>;\n  set(entry: CacheEntry): Promise<void>;\n  delete(queryHash: string): Promise<void>;\n  clear(): Promise<void>;\n  getStats(): Promise<{ hits: number; misses: number; size: number }>;\n}\n\n/**\n * Cost optimizer interface\n */\nexport interface ICostOptimizer {\n  calculateCost(tier: RoutingTier, inputTokens?: number, outputTokens?: number): Promise<number>;\n  trackSpending(userId: string, tier: RoutingTier, cost: number): Promise<void>;\n  getSpendingMetrics(): Promise<Record<RoutingTier, number>>;\n  shouldRejectQuery(tier: RoutingTier, cost: number, userBudget?: number): Promise<boolean>;\n  getCheapestTier(inputTokens?: number, outputTokens?: number): Promise<RoutingTier>;\n  getUserSpending(userId: string): Promise<any>;\n  compareCosts(inputTokens?: number, outputTokens?: number): Promise<Record<RoutingTier, number>>;\n  getTierSpending(tier: RoutingTier): Promise<any>;\n  getAverageCostPerQuery(tier: RoutingTier): Promise<number>;\n  getTotalCost(tier: RoutingTier): Promise<number>;\n  getTotalQueries(tier: RoutingTier): Promise<number>;\n  getTotalSpending(): Promise<number>;\n  resetTierMetrics(tier: RoutingTier): Promise<void>;\n}\n\n/**\n * Hierarchical router interface\n */\nexport interface IHierarchicalRouter {\n  route(query: AIQuery): Promise<AIResponse>;\n  classify(query: AIQuery): Promise<QueryClassificationResult>;\n  getMetrics(): Promise<Record<RoutingTier, RoutingMetricsData>>;\n}\n\n/**\n * Configuration for AI routing system\n */\nexport interface AIRoutingConfig {\n  // Local LLM settings\n  localLLMEnabled: boolean;\n  localLLMModel: string; // 'llama' or 'phi'\n  localLLMQuantization: string; // 'q4', 'q5', 'q8'\n\n  // RAP system settings\n  rapEnabled: boolean;\n  knowledgeOceanUrl: string;\n  internalSourceWeight: number; // 0.7 for 70%\n  externalSourceWeight: number; // 0.3 for 30%\n\n  // External LLM settings\n  externalLLMEnabled: boolean;\n  externalLLMProvider: string; // 'openai', 'anthropic'\n  externalLLMModel: string;\n\n  // Cache settings\n  cacheEnabled: boolean;\n  cacheTTL: number; // seconds\n  cacheMaxSize: number; // entries\n\n  // Cost settings\n  costTrackingEnabled: boolean;\n  costThreshold: number; // maximum cost per query\n\n  // Latency settings\n  latencyThreshold: number; // milliseconds\n  fallbackOnLatency: boolean;\n\n  // Redis settings\n  redisUrl: string;\n  redisKeyPrefix: string;\n}\n\n/**\n * Classification confidence thresholds\n */\nexport interface ClassificationThresholds {\n  simpleThreshold: number;      // queries below this are SIMPLE\n  moderateThreshold: number;    // queries below this are MODERATE\n  complexThreshold: number;     // queries at or above this are COMPLEX\n  minConfidence: number;        // minimum confidence to accept classification\n}\n\n/**\n * Fallback strategy configuration\n */\nexport interface FallbackStrategy {\n  tier: RoutingTier;\n  condition: 'latency' | 'cost' | 'failure' | 'all';\n  threshold: number;\n  nextTier: RoutingTier;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAfZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAAA;AAAA,IAAYE,eAAe,0BAAfA,eAAe;EAAfA,eAAe;EAAfA,eAAe;EAAfA,eAAe;EAAA,OAAfA,eAAe;AAAA;;AAM3B;AACA;AACA;AACA;AAAA;AAAA,IAAYC,WAAW,0BAAXA,WAAW;EAAXA,WAAW;EACS;EADpBA,WAAW;EAES;EAFpBA,WAAW,mCAGS;EAAA,OAHpBA,WAAW;AAAA;;AAMvB;AACA;AACA;;AASA;AACA;AACA;;AAWA;AACA;AACA;;AAoBA;AACA;AACA;;AAaA;AACA;AACA;;AAMA;AACA;AACA;;AAOA;AACA;AACA;;AASA;AACA;AACA;;AAiBA;AACA;AACA;;AAOA;AACA;AACA;;AAoCA;AACA;AACA;;AAQA;AACA;AACA","ignoreList":[]}