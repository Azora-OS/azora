{"version":3,"names":["cov_2qe9cl92uc","actualCoverage","generateUUID","AppError","stripeClient","payments","s","Map","PaymentService","createPayment","businessId","userId","data","f","amount","b","paymentId","now","Date","paymentIntentId","createPaymentIntent","payment","id","type","status","paymentMethod","transactionId","createdAt","updatedAt","set","getPaymentById","get","getBusinessPayments","page","pageSize","businessPayments","Array","from","values","filter","p","total","length","totalPages","Math","ceil","start","end","slice","confirmPayment","confirmed","completedAt","updatePaymentStatus","refundPayment","refundAmount","refundId","retryPayment","newPaymentIntentId","getPaymentHistory","statusBreakdown","pending","processing","completed","failed","totalAmount","forEach","averageAmount","totalCount","getPaymentStats","startDate","endDate","allPayments","payDate","completedPayments","failedPayments","pendingPayments","reduce","sum","successRate","failureRate","totalPayments","pendingCount","validatePayment","errors","push","validTypes","includes","join","valid","paymentService"],"sources":["payment.service.ts"],"sourcesContent":["import { generateUUID } from '../utils/uuid.js';\nimport { Payment, PaymentRequest, PaymentHistory } from '../types/index.js';\nimport { AppError } from '../middleware/errorHandler.js';\nimport { stripeClient } from '../utils/stripe-client.js';\n\n// Mock database - replace with actual database calls\nconst payments: Map<string, Payment> = new Map();\n\nexport class PaymentService {\n  /**\n   * Create payment\n   * Requirements: 4.2, 4.3\n   */\n  async createPayment(\n    businessId: string,\n    userId: string,\n    data: PaymentRequest\n  ): Promise<Payment> {\n    if (data.amount <= 0) {\n      throw new AppError(400, 'Payment amount must be positive');\n    }\n\n    const paymentId = generateUUID();\n    const now = new Date();\n\n    // Create payment intent with Stripe\n    const paymentIntentId = await stripeClient.createPaymentIntent(data.amount, 'usd');\n\n    const payment: Payment = {\n      id: paymentId,\n      businessId,\n      userId,\n      amount: data.amount,\n      type: data.type,\n      status: 'pending',\n      paymentMethod: data.paymentMethod,\n      transactionId: paymentIntentId,\n      createdAt: now,\n      updatedAt: now,\n    };\n\n    payments.set(paymentId, payment);\n\n    return payment;\n  }\n\n  /**\n   * Get payment by ID\n   * Requirements: 4.2, 4.3\n   */\n  async getPaymentById(paymentId: string, userId: string): Promise<Payment> {\n    const payment = payments.get(paymentId);\n\n    if (!payment) {\n      throw new AppError(404, 'Payment not found');\n    }\n\n    if (payment.userId !== userId) {\n      throw new AppError(403, 'Unauthorized access to this payment');\n    }\n\n    return payment;\n  }\n\n  /**\n   * Get payments for a business\n   * Requirements: 4.2, 4.3\n   */\n  async getBusinessPayments(\n    businessId: string,\n    page: number = 1,\n    pageSize: number = 10\n  ): Promise<{\n    payments: Payment[];\n    total: number;\n    page: number;\n    pageSize: number;\n    totalPages: number;\n  }> {\n    const businessPayments = Array.from(payments.values()).filter(\n      (p) => p.businessId === businessId\n    );\n\n    const total = businessPayments.length;\n    const totalPages = Math.ceil(total / pageSize);\n    const start = (page - 1) * pageSize;\n    const end = start + pageSize;\n\n    return {\n      payments: businessPayments.slice(start, end),\n      total,\n      page,\n      pageSize,\n      totalPages,\n    };\n  }\n\n  /**\n   * Confirm payment\n   * Requirements: 4.2, 4.3\n   */\n  async confirmPayment(paymentId: string, userId: string): Promise<Payment> {\n    const payment = await this.getPaymentById(paymentId, userId);\n\n    if (payment.status !== 'pending') {\n      throw new AppError(400, 'Only pending payments can be confirmed');\n    }\n\n    if (!payment.transactionId) {\n      throw new AppError(400, 'Payment transaction ID is missing');\n    }\n\n    // Confirm with Stripe\n    const confirmed = await stripeClient.confirmPayment(payment.transactionId);\n\n    if (!confirmed) {\n      payment.status = 'failed';\n      payment.updatedAt = new Date();\n      payments.set(paymentId, payment);\n      throw new AppError(400, 'Payment confirmation failed');\n    }\n\n    payment.status = 'completed';\n    payment.completedAt = new Date();\n    payment.updatedAt = new Date();\n\n    payments.set(paymentId, payment);\n\n    return payment;\n  }\n\n  /**\n   * Update payment status\n   * Requirements: 4.2, 4.3\n   */\n  async updatePaymentStatus(\n    paymentId: string,\n    status: 'pending' | 'processing' | 'completed' | 'failed'\n  ): Promise<Payment> {\n    const payment = payments.get(paymentId);\n\n    if (!payment) {\n      throw new AppError(404, 'Payment not found');\n    }\n\n    payment.status = status;\n    payment.updatedAt = new Date();\n\n    if (status === 'completed') {\n      payment.completedAt = new Date();\n    }\n\n    payments.set(paymentId, payment);\n\n    return payment;\n  }\n\n  /**\n   * Refund payment\n   * Requirements: 4.2, 4.3\n   */\n  async refundPayment(paymentId: string, amount?: number): Promise<Payment> {\n    const payment = payments.get(paymentId);\n\n    if (!payment) {\n      throw new AppError(404, 'Payment not found');\n    }\n\n    if (payment.status !== 'completed') {\n      throw new AppError(400, 'Only completed payments can be refunded');\n    }\n\n    if (!payment.transactionId) {\n      throw new AppError(400, 'Payment transaction ID is missing');\n    }\n\n    const refundAmount = amount || payment.amount;\n\n    if (refundAmount > payment.amount) {\n      throw new AppError(400, 'Refund amount cannot exceed payment amount');\n    }\n\n    // Refund with Stripe\n    const refundId = await stripeClient.refundPayment(payment.transactionId, refundAmount);\n\n    payment.status = 'failed'; // Mark as refunded\n    payment.updatedAt = new Date();\n    payments.set(paymentId, payment);\n\n    return payment;\n  }\n\n  /**\n   * Retry failed payment\n   * Requirements: 4.2, 4.3\n   */\n  async retryPayment(paymentId: string, userId: string): Promise<Payment> {\n    const payment = await this.getPaymentById(paymentId, userId);\n\n    if (payment.status !== 'failed') {\n      throw new AppError(400, 'Only failed payments can be retried');\n    }\n\n    // Create new payment intent\n    const newPaymentIntentId = await stripeClient.createPaymentIntent(payment.amount, 'usd');\n\n    payment.transactionId = newPaymentIntentId;\n    payment.status = 'pending';\n    payment.updatedAt = new Date();\n\n    payments.set(paymentId, payment);\n\n    return payment;\n  }\n\n  /**\n   * Get payment history for a business\n   * Requirements: 4.2, 4.3\n   */\n  async getPaymentHistory(businessId: string): Promise<PaymentHistory> {\n    const businessPayments = Array.from(payments.values()).filter(\n      (p) => p.businessId === businessId\n    );\n\n    const statusBreakdown = {\n      pending: 0,\n      processing: 0,\n      completed: 0,\n      failed: 0,\n    };\n\n    let totalAmount = 0;\n\n    businessPayments.forEach((p) => {\n      statusBreakdown[p.status as keyof typeof statusBreakdown]++;\n      if (p.status === 'completed') {\n        totalAmount += p.amount;\n      }\n    });\n\n    const averageAmount = businessPayments.length > 0 ? totalAmount / businessPayments.length : 0;\n\n    return {\n      payments: businessPayments,\n      totalAmount,\n      totalCount: businessPayments.length,\n      averageAmount,\n      statusBreakdown,\n    };\n  }\n\n  /**\n   * Get payment statistics\n   * Requirements: 4.2, 4.3\n   */\n  async getPaymentStats(startDate?: Date, endDate?: Date): Promise<{\n    totalPayments: number;\n    totalAmount: number;\n    averageAmount: number;\n    successRate: number;\n    failureRate: number;\n    pendingCount: number;\n  }> {\n    let allPayments = Array.from(payments.values());\n\n    if (startDate || endDate) {\n      const start = startDate || new Date(0);\n      const end = endDate || new Date();\n\n      allPayments = allPayments.filter((p) => {\n        const payDate = new Date(p.createdAt);\n        return payDate >= start && payDate <= end;\n      });\n    }\n\n    const completedPayments = allPayments.filter((p) => p.status === 'completed');\n    const failedPayments = allPayments.filter((p) => p.status === 'failed');\n    const pendingPayments = allPayments.filter((p) => p.status === 'pending');\n\n    const totalAmount = completedPayments.reduce((sum, p) => sum + p.amount, 0);\n    const averageAmount = allPayments.length > 0 ? totalAmount / allPayments.length : 0;\n    const successRate = allPayments.length > 0 ? (completedPayments.length / allPayments.length) * 100 : 0;\n    const failureRate = allPayments.length > 0 ? (failedPayments.length / allPayments.length) * 100 : 0;\n\n    return {\n      totalPayments: allPayments.length,\n      totalAmount,\n      averageAmount,\n      successRate,\n      failureRate,\n      pendingCount: pendingPayments.length,\n    };\n  }\n\n  /**\n   * Validate payment\n   * Requirements: 4.2, 4.3\n   */\n  validatePayment(data: PaymentRequest): {\n    valid: boolean;\n    errors: string[];\n  } {\n    const errors: string[] = [];\n\n    if (data.amount <= 0) {\n      errors.push('Payment amount must be positive');\n    }\n\n    const validTypes = ['revenue', 'refund', 'fund_distribution'];\n    if (!validTypes.includes(data.type)) {\n      errors.push(`Invalid payment type. Must be one of: ${validTypes.join(', ')}`);\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  }\n}\n\nexport const paymentService = new PaymentService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}