{"version":3,"names":["cov_q22yoc2sl","actualCoverage","SubscriptionTier","PrismaClient","logger","ErrorHandler","prisma","s","FEATURE_MATRIX","FREE","PRO","ENTERPRISE","FEATURE_LIMITS","feature","limit","CACHE_TTL","featureAccessCache","Map","FeatureAccessService","checkFeatureAccess","userId","f","tier","getUserTier","hasAccess","includes","debug","error","handle","checkMultipleFeatures","features","result","getFeaturesByTier","getFeatureLimit","limits","find","l","b","getFeatureLimitsByTier","cached","get","Date","now","timestamp","subscription","findUnique","where","set","invalidateCache","delete","clearCache","clear","getFeatureComparison","isFeatureAvailable","Object","values","some","getMinimumTierForFeature","tiers","validateFeatureUsage","currentUsage","allowed","remaining","Math","max","getFeatureMatrixForUI","allFeatures","Set","forEach","add","Array","from","matrix"],"sources":["feature-access.ts"],"sourcesContent":["/**\n * Feature Access Control\n * Manages feature permissions based on subscription tier\n */\n\nimport { SubscriptionTier } from '@prisma/client';\nimport { PrismaClient } from '@prisma/client';\nimport { logger } from '../shared/logging';\nimport { ErrorHandler } from '../payment/error-handler';\n\nconst prisma = new PrismaClient();\n\nexport type Feature =\n  | 'view_courses'\n  | 'upload_courses'\n  | 'sell_courses'\n  | 'offline_access'\n  | 'certificates'\n  | 'advanced_progress_tracking'\n  | 'global_leaderboard'\n  | 'friend_leaderboard'\n  | 'class_leaderboard'\n  | 'token_rewards'\n  | 'priority_support'\n  | 'live_chat'\n  | 'phone_support'\n  | 'user_management'\n  | 'custom_branding'\n  | 'white_label'\n  | 'sso_integration'\n  | 'api_access'\n  | 'audit_logs'\n  | 'dedicated_support';\n\nexport interface FeatureMatrix {\n  [key in SubscriptionTier]: Feature[];\n}\n\nexport interface FeatureLimit {\n  feature: Feature;\n  limit: number | null; // null = unlimited\n}\n\nexport interface FeatureLimitMatrix {\n  [key in SubscriptionTier]: FeatureLimit[];\n}\n\n// Feature matrix defining which features are available for each tier\nconst FEATURE_MATRIX: FeatureMatrix = {\n  FREE: [\n    'view_courses',\n    'global_leaderboard',\n    'token_rewards',\n  ],\n  PRO: [\n    'view_courses',\n    'upload_courses',\n    'sell_courses',\n    'offline_access',\n    'certificates',\n    'advanced_progress_tracking',\n    'global_leaderboard',\n    'friend_leaderboard',\n    'token_rewards',\n    'priority_support',\n    'live_chat',\n  ],\n  ENTERPRISE: [\n    'view_courses',\n    'upload_courses',\n    'sell_courses',\n    'offline_access',\n    'certificates',\n    'advanced_progress_tracking',\n    'global_leaderboard',\n    'friend_leaderboard',\n    'class_leaderboard',\n    'token_rewards',\n    'priority_support',\n    'live_chat',\n    'phone_support',\n    'user_management',\n    'custom_branding',\n    'white_label',\n    'sso_integration',\n    'api_access',\n    'audit_logs',\n    'dedicated_support',\n  ],\n};\n\n// Feature limits for each tier\nconst FEATURE_LIMITS: FeatureLimitMatrix = {\n  FREE: [\n    { feature: 'view_courses', limit: 5 },\n    { feature: 'token_rewards', limit: 50 }, // per month\n  ],\n  PRO: [\n    { feature: 'view_courses', limit: null }, // unlimited\n    { feature: 'upload_courses', limit: 5 }, // per month\n    { feature: 'token_rewards', limit: 500 }, // per month\n  ],\n  ENTERPRISE: [\n    { feature: 'view_courses', limit: null },\n    { feature: 'upload_courses', limit: null },\n    { feature: 'token_rewards', limit: 5000 }, // per month\n  ],\n};\n\n// Cache for feature access (TTL: 5 minutes)\nconst CACHE_TTL = 5 * 60 * 1000;\nconst featureAccessCache = new Map<string, { tier: SubscriptionTier; timestamp: number }>();\n\nexport class FeatureAccessService {\n  /**\n   * Check if user has access to a feature\n   */\n  async checkFeatureAccess(userId: string, feature: Feature): Promise<boolean> {\n    try {\n      const tier = await this.getUserTier(userId);\n      const hasAccess = FEATURE_MATRIX[tier].includes(feature);\n\n      logger.debug('Feature access check', { userId, feature, tier, hasAccess });\n      return hasAccess;\n    } catch (error) {\n      logger.error('Failed to check feature access', { error, userId, feature });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Check if user has access to multiple features\n   */\n  async checkMultipleFeatures(userId: string, features: Feature[]): Promise<Record<Feature, boolean>> {\n    try {\n      const tier = await this.getUserTier(userId);\n      const result: Record<Feature, boolean> = {} as Record<Feature, boolean>;\n\n      for (const feature of features) {\n        result[feature] = FEATURE_MATRIX[tier].includes(feature);\n      }\n\n      return result;\n    } catch (error) {\n      logger.error('Failed to check multiple features', { error, userId });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get all features available for a tier\n   */\n  getFeaturesByTier(tier: SubscriptionTier): Feature[] {\n    return FEATURE_MATRIX[tier];\n  }\n\n  /**\n   * Get feature limit for a tier\n   */\n  getFeatureLimit(tier: SubscriptionTier, feature: Feature): number | null {\n    const limits = FEATURE_LIMITS[tier];\n    const limit = limits.find((l) => l.feature === feature);\n    return limit?.limit ?? null;\n  }\n\n  /**\n   * Get all feature limits for a tier\n   */\n  getFeatureLimitsByTier(tier: SubscriptionTier): FeatureLimit[] {\n    return FEATURE_LIMITS[tier];\n  }\n\n  /**\n   * Get user's subscription tier\n   */\n  async getUserTier(userId: string): Promise<SubscriptionTier> {\n    try {\n      // Check cache first\n      const cached = featureAccessCache.get(userId);\n      if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n        return cached.tier;\n      }\n\n      // Get from database\n      const subscription = await prisma.subscription.findUnique({\n        where: { userId },\n      });\n\n      const tier = subscription?.tier ?? 'FREE';\n\n      // Update cache\n      featureAccessCache.set(userId, { tier, timestamp: Date.now() });\n\n      return tier;\n    } catch (error) {\n      logger.error('Failed to get user tier', { error, userId });\n      // Default to FREE tier on error\n      return 'FREE';\n    }\n  }\n\n  /**\n   * Invalidate cache for a user\n   */\n  invalidateCache(userId: string): void {\n    featureAccessCache.delete(userId);\n  }\n\n  /**\n   * Clear all cache\n   */\n  clearCache(): void {\n    featureAccessCache.clear();\n  }\n\n  /**\n   * Get feature comparison between tiers\n   */\n  getFeatureComparison(): Record<SubscriptionTier, Feature[]> {\n    return FEATURE_MATRIX;\n  }\n\n  /**\n   * Check if feature is available in any tier\n   */\n  isFeatureAvailable(feature: Feature): boolean {\n    return Object.values(FEATURE_MATRIX).some((features) => features.includes(feature));\n  }\n\n  /**\n   * Get minimum tier required for a feature\n   */\n  getMinimumTierForFeature(feature: Feature): SubscriptionTier | null {\n    const tiers: SubscriptionTier[] = ['FREE', 'PRO', 'ENTERPRISE'];\n    for (const tier of tiers) {\n      if (FEATURE_MATRIX[tier].includes(feature)) {\n        return tier;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Validate feature access with limit checking\n   */\n  async validateFeatureUsage(\n    userId: string,\n    feature: Feature,\n    currentUsage: number\n  ): Promise<{ allowed: boolean; remaining: number | null }> {\n    try {\n      const tier = await this.getUserTier(userId);\n      const hasAccess = FEATURE_MATRIX[tier].includes(feature);\n\n      if (!hasAccess) {\n        return { allowed: false, remaining: null };\n      }\n\n      const limit = this.getFeatureLimit(tier, feature);\n      if (limit === null) {\n        // Unlimited\n        return { allowed: true, remaining: null };\n      }\n\n      const remaining = Math.max(0, limit - currentUsage);\n      return { allowed: remaining > 0, remaining };\n    } catch (error) {\n      logger.error('Failed to validate feature usage', { error, userId, feature });\n      throw ErrorHandler.handle(error);\n    }\n  }\n\n  /**\n   * Get feature matrix for UI display\n   */\n  getFeatureMatrixForUI(): {\n    features: Feature[];\n    tiers: SubscriptionTier[];\n    matrix: Record<Feature, Record<SubscriptionTier, boolean>>;\n  } {\n    const allFeatures = new Set<Feature>();\n    Object.values(FEATURE_MATRIX).forEach((features) => {\n      features.forEach((f) => allFeatures.add(f));\n    });\n\n    const features = Array.from(allFeatures);\n    const tiers: SubscriptionTier[] = ['FREE', 'PRO', 'ENTERPRISE'];\n    const matrix: Record<Feature, Record<SubscriptionTier, boolean>> = {} as any;\n\n    for (const feature of features) {\n      matrix[feature] = {\n        FREE: FEATURE_MATRIX.FREE.includes(feature),\n        PRO: FEATURE_MATRIX.PRO.includes(feature),\n        ENTERPRISE: FEATURE_MATRIX.ENTERPRISE.includes(feature),\n      };\n    }\n\n    return { features, tiers, matrix };\n  }\n}\n\nexport default new FeatureAccessService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}