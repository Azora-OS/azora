c755d1583a994ea87b656b00e6c6e91d
/* istanbul ignore next */
function cov_q22yoc2sl() {
  var path = "/workspaces/azora/services/subscription/feature-access.ts";
  var hash = "a35115eb8a38fb09ad91efb92bf6e3173baa14b5";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/subscription/feature-access.ts",
    statementMap: {
      "0": {
        start: {
          line: 11,
          column: 15
        },
        end: {
          line: 11,
          column: 33
        }
      },
      "1": {
        start: {
          line: 49,
          column: 38
        },
        end: {
          line: 90,
          column: 1
        }
      },
      "2": {
        start: {
          line: 93,
          column: 43
        },
        end: {
          line: 108,
          column: 1
        }
      },
      "3": {
        start: {
          line: 111,
          column: 18
        },
        end: {
          line: 111,
          column: 31
        }
      },
      "4": {
        start: {
          line: 112,
          column: 27
        },
        end: {
          line: 112,
          column: 91
        }
      },
      "5": {
        start: {
          line: 119,
          column: 4
        },
        end: {
          line: 128,
          column: 5
        }
      },
      "6": {
        start: {
          line: 120,
          column: 19
        },
        end: {
          line: 120,
          column: 49
        }
      },
      "7": {
        start: {
          line: 121,
          column: 24
        },
        end: {
          line: 121,
          column: 62
        }
      },
      "8": {
        start: {
          line: 123,
          column: 6
        },
        end: {
          line: 123,
          column: 81
        }
      },
      "9": {
        start: {
          line: 124,
          column: 6
        },
        end: {
          line: 124,
          column: 23
        }
      },
      "10": {
        start: {
          line: 126,
          column: 6
        },
        end: {
          line: 126,
          column: 81
        }
      },
      "11": {
        start: {
          line: 127,
          column: 6
        },
        end: {
          line: 127,
          column: 39
        }
      },
      "12": {
        start: {
          line: 135,
          column: 4
        },
        end: {
          line: 147,
          column: 5
        }
      },
      "13": {
        start: {
          line: 136,
          column: 19
        },
        end: {
          line: 136,
          column: 49
        }
      },
      "14": {
        start: {
          line: 137,
          column: 47
        },
        end: {
          line: 137,
          column: 77
        }
      },
      "15": {
        start: {
          line: 139,
          column: 6
        },
        end: {
          line: 141,
          column: 7
        }
      },
      "16": {
        start: {
          line: 140,
          column: 8
        },
        end: {
          line: 140,
          column: 65
        }
      },
      "17": {
        start: {
          line: 143,
          column: 6
        },
        end: {
          line: 143,
          column: 20
        }
      },
      "18": {
        start: {
          line: 145,
          column: 6
        },
        end: {
          line: 145,
          column: 75
        }
      },
      "19": {
        start: {
          line: 146,
          column: 6
        },
        end: {
          line: 146,
          column: 39
        }
      },
      "20": {
        start: {
          line: 154,
          column: 4
        },
        end: {
          line: 154,
          column: 32
        }
      },
      "21": {
        start: {
          line: 161,
          column: 19
        },
        end: {
          line: 161,
          column: 39
        }
      },
      "22": {
        start: {
          line: 162,
          column: 18
        },
        end: {
          line: 162,
          column: 59
        }
      },
      "23": {
        start: {
          line: 162,
          column: 37
        },
        end: {
          line: 162,
          column: 58
        }
      },
      "24": {
        start: {
          line: 163,
          column: 4
        },
        end: {
          line: 163,
          column: 32
        }
      },
      "25": {
        start: {
          line: 170,
          column: 4
        },
        end: {
          line: 170,
          column: 32
        }
      },
      "26": {
        start: {
          line: 177,
          column: 4
        },
        end: {
          line: 199,
          column: 5
        }
      },
      "27": {
        start: {
          line: 179,
          column: 21
        },
        end: {
          line: 179,
          column: 51
        }
      },
      "28": {
        start: {
          line: 180,
          column: 6
        },
        end: {
          line: 182,
          column: 7
        }
      },
      "29": {
        start: {
          line: 181,
          column: 8
        },
        end: {
          line: 181,
          column: 27
        }
      },
      "30": {
        start: {
          line: 185,
          column: 27
        },
        end: {
          line: 187,
          column: 8
        }
      },
      "31": {
        start: {
          line: 189,
          column: 19
        },
        end: {
          line: 189,
          column: 47
        }
      },
      "32": {
        start: {
          line: 192,
          column: 6
        },
        end: {
          line: 192,
          column: 70
        }
      },
      "33": {
        start: {
          line: 194,
          column: 6
        },
        end: {
          line: 194,
          column: 18
        }
      },
      "34": {
        start: {
          line: 196,
          column: 6
        },
        end: {
          line: 196,
          column: 65
        }
      },
      "35": {
        start: {
          line: 198,
          column: 6
        },
        end: {
          line: 198,
          column: 20
        }
      },
      "36": {
        start: {
          line: 206,
          column: 4
        },
        end: {
          line: 206,
          column: 38
        }
      },
      "37": {
        start: {
          line: 213,
          column: 4
        },
        end: {
          line: 213,
          column: 31
        }
      },
      "38": {
        start: {
          line: 220,
          column: 4
        },
        end: {
          line: 220,
          column: 26
        }
      },
      "39": {
        start: {
          line: 227,
          column: 4
        },
        end: {
          line: 227,
          column: 88
        }
      },
      "40": {
        start: {
          line: 227,
          column: 60
        },
        end: {
          line: 227,
          column: 86
        }
      },
      "41": {
        start: {
          line: 234,
          column: 38
        },
        end: {
          line: 234,
          column: 67
        }
      },
      "42": {
        start: {
          line: 235,
          column: 4
        },
        end: {
          line: 239,
          column: 5
        }
      },
      "43": {
        start: {
          line: 236,
          column: 6
        },
        end: {
          line: 238,
          column: 7
        }
      },
      "44": {
        start: {
          line: 237,
          column: 8
        },
        end: {
          line: 237,
          column: 20
        }
      },
      "45": {
        start: {
          line: 240,
          column: 4
        },
        end: {
          line: 240,
          column: 16
        }
      },
      "46": {
        start: {
          line: 251,
          column: 4
        },
        end: {
          line: 270,
          column: 5
        }
      },
      "47": {
        start: {
          line: 252,
          column: 19
        },
        end: {
          line: 252,
          column: 49
        }
      },
      "48": {
        start: {
          line: 253,
          column: 24
        },
        end: {
          line: 253,
          column: 62
        }
      },
      "49": {
        start: {
          line: 255,
          column: 6
        },
        end: {
          line: 257,
          column: 7
        }
      },
      "50": {
        start: {
          line: 256,
          column: 8
        },
        end: {
          line: 256,
          column: 51
        }
      },
      "51": {
        start: {
          line: 259,
          column: 20
        },
        end: {
          line: 259,
          column: 55
        }
      },
      "52": {
        start: {
          line: 260,
          column: 6
        },
        end: {
          line: 263,
          column: 7
        }
      },
      "53": {
        start: {
          line: 262,
          column: 8
        },
        end: {
          line: 262,
          column: 50
        }
      },
      "54": {
        start: {
          line: 265,
          column: 24
        },
        end: {
          line: 265,
          column: 57
        }
      },
      "55": {
        start: {
          line: 266,
          column: 6
        },
        end: {
          line: 266,
          column: 51
        }
      },
      "56": {
        start: {
          line: 268,
          column: 6
        },
        end: {
          line: 268,
          column: 83
        }
      },
      "57": {
        start: {
          line: 269,
          column: 6
        },
        end: {
          line: 269,
          column: 39
        }
      },
      "58": {
        start: {
          line: 281,
          column: 24
        },
        end: {
          line: 281,
          column: 42
        }
      },
      "59": {
        start: {
          line: 282,
          column: 4
        },
        end: {
          line: 284,
          column: 7
        }
      },
      "60": {
        start: {
          line: 283,
          column: 6
        },
        end: {
          line: 283,
          column: 50
        }
      },
      "61": {
        start: {
          line: 283,
          column: 30
        },
        end: {
          line: 283,
          column: 48
        }
      },
      "62": {
        start: {
          line: 286,
          column: 21
        },
        end: {
          line: 286,
          column: 44
        }
      },
      "63": {
        start: {
          line: 287,
          column: 38
        },
        end: {
          line: 287,
          column: 67
        }
      },
      "64": {
        start: {
          line: 288,
          column: 71
        },
        end: {
          line: 288,
          column: 80
        }
      },
      "65": {
        start: {
          line: 290,
          column: 4
        },
        end: {
          line: 296,
          column: 5
        }
      },
      "66": {
        start: {
          line: 291,
          column: 6
        },
        end: {
          line: 295,
          column: 8
        }
      },
      "67": {
        start: {
          line: 298,
          column: 4
        },
        end: {
          line: 298,
          column: 39
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 118,
            column: 2
          },
          end: {
            line: 118,
            column: 3
          }
        },
        loc: {
          start: {
            line: 118,
            column: 79
          },
          end: {
            line: 129,
            column: 3
          }
        },
        line: 118
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 134,
            column: 2
          },
          end: {
            line: 134,
            column: 3
          }
        },
        loc: {
          start: {
            line: 134,
            column: 102
          },
          end: {
            line: 148,
            column: 3
          }
        },
        line: 134
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 153,
            column: 2
          },
          end: {
            line: 153,
            column: 3
          }
        },
        loc: {
          start: {
            line: 153,
            column: 55
          },
          end: {
            line: 155,
            column: 3
          }
        },
        line: 153
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 160,
            column: 2
          },
          end: {
            line: 160,
            column: 3
          }
        },
        loc: {
          start: {
            line: 160,
            column: 75
          },
          end: {
            line: 164,
            column: 3
          }
        },
        line: 160
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 162,
            column: 30
          },
          end: {
            line: 162,
            column: 31
          }
        },
        loc: {
          start: {
            line: 162,
            column: 37
          },
          end: {
            line: 162,
            column: 58
          }
        },
        line: 162
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 169,
            column: 2
          },
          end: {
            line: 169,
            column: 3
          }
        },
        loc: {
          start: {
            line: 169,
            column: 65
          },
          end: {
            line: 171,
            column: 3
          }
        },
        line: 169
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 176,
            column: 2
          },
          end: {
            line: 176,
            column: 3
          }
        },
        loc: {
          start: {
            line: 176,
            column: 63
          },
          end: {
            line: 200,
            column: 3
          }
        },
        line: 176
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 205,
            column: 2
          },
          end: {
            line: 205,
            column: 3
          }
        },
        loc: {
          start: {
            line: 205,
            column: 40
          },
          end: {
            line: 207,
            column: 3
          }
        },
        line: 205
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 212,
            column: 2
          },
          end: {
            line: 212,
            column: 3
          }
        },
        loc: {
          start: {
            line: 212,
            column: 21
          },
          end: {
            line: 214,
            column: 3
          }
        },
        line: 212
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 219,
            column: 2
          },
          end: {
            line: 219,
            column: 3
          }
        },
        loc: {
          start: {
            line: 219,
            column: 62
          },
          end: {
            line: 221,
            column: 3
          }
        },
        line: 219
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 226,
            column: 2
          },
          end: {
            line: 226,
            column: 3
          }
        },
        loc: {
          start: {
            line: 226,
            column: 48
          },
          end: {
            line: 228,
            column: 3
          }
        },
        line: 226
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 227,
            column: 46
          },
          end: {
            line: 227,
            column: 47
          }
        },
        loc: {
          start: {
            line: 227,
            column: 60
          },
          end: {
            line: 227,
            column: 86
          }
        },
        line: 227
      },
      "12": {
        name: "(anonymous_12)",
        decl: {
          start: {
            line: 233,
            column: 2
          },
          end: {
            line: 233,
            column: 3
          }
        },
        loc: {
          start: {
            line: 233,
            column: 70
          },
          end: {
            line: 241,
            column: 3
          }
        },
        line: 233
      },
      "13": {
        name: "(anonymous_13)",
        decl: {
          start: {
            line: 246,
            column: 2
          },
          end: {
            line: 246,
            column: 3
          }
        },
        loc: {
          start: {
            line: 250,
            column: 61
          },
          end: {
            line: 271,
            column: 3
          }
        },
        line: 250
      },
      "14": {
        name: "(anonymous_14)",
        decl: {
          start: {
            line: 276,
            column: 2
          },
          end: {
            line: 276,
            column: 3
          }
        },
        loc: {
          start: {
            line: 280,
            column: 4
          },
          end: {
            line: 299,
            column: 3
          }
        },
        line: 280
      },
      "15": {
        name: "(anonymous_15)",
        decl: {
          start: {
            line: 282,
            column: 42
          },
          end: {
            line: 282,
            column: 43
          }
        },
        loc: {
          start: {
            line: 282,
            column: 56
          },
          end: {
            line: 284,
            column: 5
          }
        },
        line: 282
      },
      "16": {
        name: "(anonymous_16)",
        decl: {
          start: {
            line: 283,
            column: 23
          },
          end: {
            line: 283,
            column: 24
          }
        },
        loc: {
          start: {
            line: 283,
            column: 30
          },
          end: {
            line: 283,
            column: 48
          }
        },
        line: 283
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 163,
            column: 11
          },
          end: {
            line: 163,
            column: 31
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 163,
            column: 11
          },
          end: {
            line: 163,
            column: 23
          }
        }, {
          start: {
            line: 163,
            column: 27
          },
          end: {
            line: 163,
            column: 31
          }
        }],
        line: 163
      },
      "1": {
        loc: {
          start: {
            line: 180,
            column: 6
          },
          end: {
            line: 182,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 180,
            column: 6
          },
          end: {
            line: 182,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 180
      },
      "2": {
        loc: {
          start: {
            line: 180,
            column: 10
          },
          end: {
            line: 180,
            column: 61
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 180,
            column: 10
          },
          end: {
            line: 180,
            column: 16
          }
        }, {
          start: {
            line: 180,
            column: 20
          },
          end: {
            line: 180,
            column: 61
          }
        }],
        line: 180
      },
      "3": {
        loc: {
          start: {
            line: 189,
            column: 19
          },
          end: {
            line: 189,
            column: 47
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 189,
            column: 19
          },
          end: {
            line: 189,
            column: 37
          }
        }, {
          start: {
            line: 189,
            column: 41
          },
          end: {
            line: 189,
            column: 47
          }
        }],
        line: 189
      },
      "4": {
        loc: {
          start: {
            line: 236,
            column: 6
          },
          end: {
            line: 238,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 236,
            column: 6
          },
          end: {
            line: 238,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 236
      },
      "5": {
        loc: {
          start: {
            line: 255,
            column: 6
          },
          end: {
            line: 257,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 255,
            column: 6
          },
          end: {
            line: 257,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 255
      },
      "6": {
        loc: {
          start: {
            line: 260,
            column: 6
          },
          end: {
            line: 263,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 260,
            column: 6
          },
          end: {
            line: 263,
            column: 7
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 260
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "a35115eb8a38fb09ad91efb92bf6e3173baa14b5"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_q22yoc2sl = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_q22yoc2sl();
/**
 * Feature Access Control
 * Manages feature permissions based on subscription tier
 */

import { SubscriptionTier } from '@prisma/client';
import { PrismaClient } from '@prisma/client';
import { logger } from '../shared/logging';
import { ErrorHandler } from '../payment/error-handler';
const prisma =
/* istanbul ignore next */
(cov_q22yoc2sl().s[0]++, new PrismaClient());
// Feature matrix defining which features are available for each tier
const FEATURE_MATRIX =
/* istanbul ignore next */
(cov_q22yoc2sl().s[1]++, {
  FREE: ['view_courses', 'global_leaderboard', 'token_rewards'],
  PRO: ['view_courses', 'upload_courses', 'sell_courses', 'offline_access', 'certificates', 'advanced_progress_tracking', 'global_leaderboard', 'friend_leaderboard', 'token_rewards', 'priority_support', 'live_chat'],
  ENTERPRISE: ['view_courses', 'upload_courses', 'sell_courses', 'offline_access', 'certificates', 'advanced_progress_tracking', 'global_leaderboard', 'friend_leaderboard', 'class_leaderboard', 'token_rewards', 'priority_support', 'live_chat', 'phone_support', 'user_management', 'custom_branding', 'white_label', 'sso_integration', 'api_access', 'audit_logs', 'dedicated_support']
});

// Feature limits for each tier
const FEATURE_LIMITS =
/* istanbul ignore next */
(cov_q22yoc2sl().s[2]++, {
  FREE: [{
    feature: 'view_courses',
    limit: 5
  }, {
    feature: 'token_rewards',
    limit: 50
  } // per month
  ],
  PRO: [{
    feature: 'view_courses',
    limit: null
  },
  // unlimited
  {
    feature: 'upload_courses',
    limit: 5
  },
  // per month
  {
    feature: 'token_rewards',
    limit: 500
  } // per month
  ],
  ENTERPRISE: [{
    feature: 'view_courses',
    limit: null
  }, {
    feature: 'upload_courses',
    limit: null
  }, {
    feature: 'token_rewards',
    limit: 5000
  } // per month
  ]
});

// Cache for feature access (TTL: 5 minutes)
const CACHE_TTL =
/* istanbul ignore next */
(cov_q22yoc2sl().s[3]++, 5 * 60 * 1000);
const featureAccessCache =
/* istanbul ignore next */
(cov_q22yoc2sl().s[4]++, new Map());
export class FeatureAccessService {
  /**
   * Check if user has access to a feature
   */
  async checkFeatureAccess(userId, feature) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[0]++;
    cov_q22yoc2sl().s[5]++;
    try {
      const tier =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[6]++, await this.getUserTier(userId));
      const hasAccess =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[7]++, FEATURE_MATRIX[tier].includes(feature));
      /* istanbul ignore next */
      cov_q22yoc2sl().s[8]++;
      logger.debug('Feature access check', {
        userId,
        feature,
        tier,
        hasAccess
      });
      /* istanbul ignore next */
      cov_q22yoc2sl().s[9]++;
      return hasAccess;
    } catch (error) {
      /* istanbul ignore next */
      cov_q22yoc2sl().s[10]++;
      logger.error('Failed to check feature access', {
        error,
        userId,
        feature
      });
      /* istanbul ignore next */
      cov_q22yoc2sl().s[11]++;
      throw ErrorHandler.handle(error);
    }
  }

  /**
   * Check if user has access to multiple features
   */
  async checkMultipleFeatures(userId, features) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[1]++;
    cov_q22yoc2sl().s[12]++;
    try {
      const tier =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[13]++, await this.getUserTier(userId));
      const result =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[14]++, {});
      /* istanbul ignore next */
      cov_q22yoc2sl().s[15]++;
      for (const feature of features) {
        /* istanbul ignore next */
        cov_q22yoc2sl().s[16]++;
        result[feature] = FEATURE_MATRIX[tier].includes(feature);
      }
      /* istanbul ignore next */
      cov_q22yoc2sl().s[17]++;
      return result;
    } catch (error) {
      /* istanbul ignore next */
      cov_q22yoc2sl().s[18]++;
      logger.error('Failed to check multiple features', {
        error,
        userId
      });
      /* istanbul ignore next */
      cov_q22yoc2sl().s[19]++;
      throw ErrorHandler.handle(error);
    }
  }

  /**
   * Get all features available for a tier
   */
  getFeaturesByTier(tier) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[2]++;
    cov_q22yoc2sl().s[20]++;
    return FEATURE_MATRIX[tier];
  }

  /**
   * Get feature limit for a tier
   */
  getFeatureLimit(tier, feature) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[3]++;
    const limits =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[21]++, FEATURE_LIMITS[tier]);
    const limit =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[22]++, limits.find(l => {
      /* istanbul ignore next */
      cov_q22yoc2sl().f[4]++;
      cov_q22yoc2sl().s[23]++;
      return l.feature === feature;
    }));
    /* istanbul ignore next */
    cov_q22yoc2sl().s[24]++;
    return /* istanbul ignore next */(cov_q22yoc2sl().b[0][0]++, limit?.limit) ??
    /* istanbul ignore next */
    (cov_q22yoc2sl().b[0][1]++, null);
  }

  /**
   * Get all feature limits for a tier
   */
  getFeatureLimitsByTier(tier) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[5]++;
    cov_q22yoc2sl().s[25]++;
    return FEATURE_LIMITS[tier];
  }

  /**
   * Get user's subscription tier
   */
  async getUserTier(userId) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[6]++;
    cov_q22yoc2sl().s[26]++;
    try {
      // Check cache first
      const cached =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[27]++, featureAccessCache.get(userId));
      /* istanbul ignore next */
      cov_q22yoc2sl().s[28]++;
      if (
      /* istanbul ignore next */
      (cov_q22yoc2sl().b[2][0]++, cached) &&
      /* istanbul ignore next */
      (cov_q22yoc2sl().b[2][1]++, Date.now() - cached.timestamp < CACHE_TTL)) {
        /* istanbul ignore next */
        cov_q22yoc2sl().b[1][0]++;
        cov_q22yoc2sl().s[29]++;
        return cached.tier;
      } else
      /* istanbul ignore next */
      {
        cov_q22yoc2sl().b[1][1]++;
      }

      // Get from database
      const subscription =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[30]++, await prisma.subscription.findUnique({
        where: {
          userId
        }
      }));
      const tier =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[31]++,
      /* istanbul ignore next */
      (cov_q22yoc2sl().b[3][0]++, subscription?.tier) ??
      /* istanbul ignore next */
      (cov_q22yoc2sl().b[3][1]++, 'FREE'));

      // Update cache
      /* istanbul ignore next */
      cov_q22yoc2sl().s[32]++;
      featureAccessCache.set(userId, {
        tier,
        timestamp: Date.now()
      });
      /* istanbul ignore next */
      cov_q22yoc2sl().s[33]++;
      return tier;
    } catch (error) {
      /* istanbul ignore next */
      cov_q22yoc2sl().s[34]++;
      logger.error('Failed to get user tier', {
        error,
        userId
      });
      // Default to FREE tier on error
      /* istanbul ignore next */
      cov_q22yoc2sl().s[35]++;
      return 'FREE';
    }
  }

  /**
   * Invalidate cache for a user
   */
  invalidateCache(userId) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[7]++;
    cov_q22yoc2sl().s[36]++;
    featureAccessCache.delete(userId);
  }

  /**
   * Clear all cache
   */
  clearCache() {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[8]++;
    cov_q22yoc2sl().s[37]++;
    featureAccessCache.clear();
  }

  /**
   * Get feature comparison between tiers
   */
  getFeatureComparison() {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[9]++;
    cov_q22yoc2sl().s[38]++;
    return FEATURE_MATRIX;
  }

  /**
   * Check if feature is available in any tier
   */
  isFeatureAvailable(feature) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[10]++;
    cov_q22yoc2sl().s[39]++;
    return Object.values(FEATURE_MATRIX).some(features => {
      /* istanbul ignore next */
      cov_q22yoc2sl().f[11]++;
      cov_q22yoc2sl().s[40]++;
      return features.includes(feature);
    });
  }

  /**
   * Get minimum tier required for a feature
   */
  getMinimumTierForFeature(feature) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[12]++;
    const tiers =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[41]++, ['FREE', 'PRO', 'ENTERPRISE']);
    /* istanbul ignore next */
    cov_q22yoc2sl().s[42]++;
    for (const tier of tiers) {
      /* istanbul ignore next */
      cov_q22yoc2sl().s[43]++;
      if (FEATURE_MATRIX[tier].includes(feature)) {
        /* istanbul ignore next */
        cov_q22yoc2sl().b[4][0]++;
        cov_q22yoc2sl().s[44]++;
        return tier;
      } else
      /* istanbul ignore next */
      {
        cov_q22yoc2sl().b[4][1]++;
      }
    }
    /* istanbul ignore next */
    cov_q22yoc2sl().s[45]++;
    return null;
  }

  /**
   * Validate feature access with limit checking
   */
  async validateFeatureUsage(userId, feature, currentUsage) {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[13]++;
    cov_q22yoc2sl().s[46]++;
    try {
      const tier =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[47]++, await this.getUserTier(userId));
      const hasAccess =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[48]++, FEATURE_MATRIX[tier].includes(feature));
      /* istanbul ignore next */
      cov_q22yoc2sl().s[49]++;
      if (!hasAccess) {
        /* istanbul ignore next */
        cov_q22yoc2sl().b[5][0]++;
        cov_q22yoc2sl().s[50]++;
        return {
          allowed: false,
          remaining: null
        };
      } else
      /* istanbul ignore next */
      {
        cov_q22yoc2sl().b[5][1]++;
      }
      const limit =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[51]++, this.getFeatureLimit(tier, feature));
      /* istanbul ignore next */
      cov_q22yoc2sl().s[52]++;
      if (limit === null) {
        /* istanbul ignore next */
        cov_q22yoc2sl().b[6][0]++;
        cov_q22yoc2sl().s[53]++;
        // Unlimited
        return {
          allowed: true,
          remaining: null
        };
      } else
      /* istanbul ignore next */
      {
        cov_q22yoc2sl().b[6][1]++;
      }
      const remaining =
      /* istanbul ignore next */
      (cov_q22yoc2sl().s[54]++, Math.max(0, limit - currentUsage));
      /* istanbul ignore next */
      cov_q22yoc2sl().s[55]++;
      return {
        allowed: remaining > 0,
        remaining
      };
    } catch (error) {
      /* istanbul ignore next */
      cov_q22yoc2sl().s[56]++;
      logger.error('Failed to validate feature usage', {
        error,
        userId,
        feature
      });
      /* istanbul ignore next */
      cov_q22yoc2sl().s[57]++;
      throw ErrorHandler.handle(error);
    }
  }

  /**
   * Get feature matrix for UI display
   */
  getFeatureMatrixForUI() {
    /* istanbul ignore next */
    cov_q22yoc2sl().f[14]++;
    const allFeatures =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[58]++, new Set());
    /* istanbul ignore next */
    cov_q22yoc2sl().s[59]++;
    Object.values(FEATURE_MATRIX).forEach(features => {
      /* istanbul ignore next */
      cov_q22yoc2sl().f[15]++;
      cov_q22yoc2sl().s[60]++;
      features.forEach(f => {
        /* istanbul ignore next */
        cov_q22yoc2sl().f[16]++;
        cov_q22yoc2sl().s[61]++;
        return allFeatures.add(f);
      });
    });
    const features =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[62]++, Array.from(allFeatures));
    const tiers =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[63]++, ['FREE', 'PRO', 'ENTERPRISE']);
    const matrix =
    /* istanbul ignore next */
    (cov_q22yoc2sl().s[64]++, {});
    /* istanbul ignore next */
    cov_q22yoc2sl().s[65]++;
    for (const feature of features) {
      /* istanbul ignore next */
      cov_q22yoc2sl().s[66]++;
      matrix[feature] = {
        FREE: FEATURE_MATRIX.FREE.includes(feature),
        PRO: FEATURE_MATRIX.PRO.includes(feature),
        ENTERPRISE: FEATURE_MATRIX.ENTERPRISE.includes(feature)
      };
    }
    /* istanbul ignore next */
    cov_q22yoc2sl().s[67]++;
    return {
      features,
      tiers,
      matrix
    };
  }
}
export default new FeatureAccessService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfcTIyeW9jMnNsIiwiYWN0dWFsQ292ZXJhZ2UiLCJTdWJzY3JpcHRpb25UaWVyIiwiUHJpc21hQ2xpZW50IiwibG9nZ2VyIiwiRXJyb3JIYW5kbGVyIiwicHJpc21hIiwicyIsIkZFQVRVUkVfTUFUUklYIiwiRlJFRSIsIlBSTyIsIkVOVEVSUFJJU0UiLCJGRUFUVVJFX0xJTUlUUyIsImZlYXR1cmUiLCJsaW1pdCIsIkNBQ0hFX1RUTCIsImZlYXR1cmVBY2Nlc3NDYWNoZSIsIk1hcCIsIkZlYXR1cmVBY2Nlc3NTZXJ2aWNlIiwiY2hlY2tGZWF0dXJlQWNjZXNzIiwidXNlcklkIiwiZiIsInRpZXIiLCJnZXRVc2VyVGllciIsImhhc0FjY2VzcyIsImluY2x1ZGVzIiwiZGVidWciLCJlcnJvciIsImhhbmRsZSIsImNoZWNrTXVsdGlwbGVGZWF0dXJlcyIsImZlYXR1cmVzIiwicmVzdWx0IiwiZ2V0RmVhdHVyZXNCeVRpZXIiLCJnZXRGZWF0dXJlTGltaXQiLCJsaW1pdHMiLCJmaW5kIiwibCIsImIiLCJnZXRGZWF0dXJlTGltaXRzQnlUaWVyIiwiY2FjaGVkIiwiZ2V0IiwiRGF0ZSIsIm5vdyIsInRpbWVzdGFtcCIsInN1YnNjcmlwdGlvbiIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsInNldCIsImludmFsaWRhdGVDYWNoZSIsImRlbGV0ZSIsImNsZWFyQ2FjaGUiLCJjbGVhciIsImdldEZlYXR1cmVDb21wYXJpc29uIiwiaXNGZWF0dXJlQXZhaWxhYmxlIiwiT2JqZWN0IiwidmFsdWVzIiwic29tZSIsImdldE1pbmltdW1UaWVyRm9yRmVhdHVyZSIsInRpZXJzIiwidmFsaWRhdGVGZWF0dXJlVXNhZ2UiLCJjdXJyZW50VXNhZ2UiLCJhbGxvd2VkIiwicmVtYWluaW5nIiwiTWF0aCIsIm1heCIsImdldEZlYXR1cmVNYXRyaXhGb3JVSSIsImFsbEZlYXR1cmVzIiwiU2V0IiwiZm9yRWFjaCIsImFkZCIsIkFycmF5IiwiZnJvbSIsIm1hdHJpeCJdLCJzb3VyY2VzIjpbImZlYXR1cmUtYWNjZXNzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRmVhdHVyZSBBY2Nlc3MgQ29udHJvbFxuICogTWFuYWdlcyBmZWF0dXJlIHBlcm1pc3Npb25zIGJhc2VkIG9uIHN1YnNjcmlwdGlvbiB0aWVyXG4gKi9cblxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uVGllciB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3NoYXJlZC9sb2dnaW5nJztcbmltcG9ydCB7IEVycm9ySGFuZGxlciB9IGZyb20gJy4uL3BheW1lbnQvZXJyb3ItaGFuZGxlcic7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZXhwb3J0IHR5cGUgRmVhdHVyZSA9XG4gIHwgJ3ZpZXdfY291cnNlcydcbiAgfCAndXBsb2FkX2NvdXJzZXMnXG4gIHwgJ3NlbGxfY291cnNlcydcbiAgfCAnb2ZmbGluZV9hY2Nlc3MnXG4gIHwgJ2NlcnRpZmljYXRlcydcbiAgfCAnYWR2YW5jZWRfcHJvZ3Jlc3NfdHJhY2tpbmcnXG4gIHwgJ2dsb2JhbF9sZWFkZXJib2FyZCdcbiAgfCAnZnJpZW5kX2xlYWRlcmJvYXJkJ1xuICB8ICdjbGFzc19sZWFkZXJib2FyZCdcbiAgfCAndG9rZW5fcmV3YXJkcydcbiAgfCAncHJpb3JpdHlfc3VwcG9ydCdcbiAgfCAnbGl2ZV9jaGF0J1xuICB8ICdwaG9uZV9zdXBwb3J0J1xuICB8ICd1c2VyX21hbmFnZW1lbnQnXG4gIHwgJ2N1c3RvbV9icmFuZGluZydcbiAgfCAnd2hpdGVfbGFiZWwnXG4gIHwgJ3Nzb19pbnRlZ3JhdGlvbidcbiAgfCAnYXBpX2FjY2VzcydcbiAgfCAnYXVkaXRfbG9ncydcbiAgfCAnZGVkaWNhdGVkX3N1cHBvcnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZlYXR1cmVNYXRyaXgge1xuICBba2V5IGluIFN1YnNjcmlwdGlvblRpZXJdOiBGZWF0dXJlW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVhdHVyZUxpbWl0IHtcbiAgZmVhdHVyZTogRmVhdHVyZTtcbiAgbGltaXQ6IG51bWJlciB8IG51bGw7IC8vIG51bGwgPSB1bmxpbWl0ZWRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGZWF0dXJlTGltaXRNYXRyaXgge1xuICBba2V5IGluIFN1YnNjcmlwdGlvblRpZXJdOiBGZWF0dXJlTGltaXRbXTtcbn1cblxuLy8gRmVhdHVyZSBtYXRyaXggZGVmaW5pbmcgd2hpY2ggZmVhdHVyZXMgYXJlIGF2YWlsYWJsZSBmb3IgZWFjaCB0aWVyXG5jb25zdCBGRUFUVVJFX01BVFJJWDogRmVhdHVyZU1hdHJpeCA9IHtcbiAgRlJFRTogW1xuICAgICd2aWV3X2NvdXJzZXMnLFxuICAgICdnbG9iYWxfbGVhZGVyYm9hcmQnLFxuICAgICd0b2tlbl9yZXdhcmRzJyxcbiAgXSxcbiAgUFJPOiBbXG4gICAgJ3ZpZXdfY291cnNlcycsXG4gICAgJ3VwbG9hZF9jb3Vyc2VzJyxcbiAgICAnc2VsbF9jb3Vyc2VzJyxcbiAgICAnb2ZmbGluZV9hY2Nlc3MnLFxuICAgICdjZXJ0aWZpY2F0ZXMnLFxuICAgICdhZHZhbmNlZF9wcm9ncmVzc190cmFja2luZycsXG4gICAgJ2dsb2JhbF9sZWFkZXJib2FyZCcsXG4gICAgJ2ZyaWVuZF9sZWFkZXJib2FyZCcsXG4gICAgJ3Rva2VuX3Jld2FyZHMnLFxuICAgICdwcmlvcml0eV9zdXBwb3J0JyxcbiAgICAnbGl2ZV9jaGF0JyxcbiAgXSxcbiAgRU5URVJQUklTRTogW1xuICAgICd2aWV3X2NvdXJzZXMnLFxuICAgICd1cGxvYWRfY291cnNlcycsXG4gICAgJ3NlbGxfY291cnNlcycsXG4gICAgJ29mZmxpbmVfYWNjZXNzJyxcbiAgICAnY2VydGlmaWNhdGVzJyxcbiAgICAnYWR2YW5jZWRfcHJvZ3Jlc3NfdHJhY2tpbmcnLFxuICAgICdnbG9iYWxfbGVhZGVyYm9hcmQnLFxuICAgICdmcmllbmRfbGVhZGVyYm9hcmQnLFxuICAgICdjbGFzc19sZWFkZXJib2FyZCcsXG4gICAgJ3Rva2VuX3Jld2FyZHMnLFxuICAgICdwcmlvcml0eV9zdXBwb3J0JyxcbiAgICAnbGl2ZV9jaGF0JyxcbiAgICAncGhvbmVfc3VwcG9ydCcsXG4gICAgJ3VzZXJfbWFuYWdlbWVudCcsXG4gICAgJ2N1c3RvbV9icmFuZGluZycsXG4gICAgJ3doaXRlX2xhYmVsJyxcbiAgICAnc3NvX2ludGVncmF0aW9uJyxcbiAgICAnYXBpX2FjY2VzcycsXG4gICAgJ2F1ZGl0X2xvZ3MnLFxuICAgICdkZWRpY2F0ZWRfc3VwcG9ydCcsXG4gIF0sXG59O1xuXG4vLyBGZWF0dXJlIGxpbWl0cyBmb3IgZWFjaCB0aWVyXG5jb25zdCBGRUFUVVJFX0xJTUlUUzogRmVhdHVyZUxpbWl0TWF0cml4ID0ge1xuICBGUkVFOiBbXG4gICAgeyBmZWF0dXJlOiAndmlld19jb3Vyc2VzJywgbGltaXQ6IDUgfSxcbiAgICB7IGZlYXR1cmU6ICd0b2tlbl9yZXdhcmRzJywgbGltaXQ6IDUwIH0sIC8vIHBlciBtb250aFxuICBdLFxuICBQUk86IFtcbiAgICB7IGZlYXR1cmU6ICd2aWV3X2NvdXJzZXMnLCBsaW1pdDogbnVsbCB9LCAvLyB1bmxpbWl0ZWRcbiAgICB7IGZlYXR1cmU6ICd1cGxvYWRfY291cnNlcycsIGxpbWl0OiA1IH0sIC8vIHBlciBtb250aFxuICAgIHsgZmVhdHVyZTogJ3Rva2VuX3Jld2FyZHMnLCBsaW1pdDogNTAwIH0sIC8vIHBlciBtb250aFxuICBdLFxuICBFTlRFUlBSSVNFOiBbXG4gICAgeyBmZWF0dXJlOiAndmlld19jb3Vyc2VzJywgbGltaXQ6IG51bGwgfSxcbiAgICB7IGZlYXR1cmU6ICd1cGxvYWRfY291cnNlcycsIGxpbWl0OiBudWxsIH0sXG4gICAgeyBmZWF0dXJlOiAndG9rZW5fcmV3YXJkcycsIGxpbWl0OiA1MDAwIH0sIC8vIHBlciBtb250aFxuICBdLFxufTtcblxuLy8gQ2FjaGUgZm9yIGZlYXR1cmUgYWNjZXNzIChUVEw6IDUgbWludXRlcylcbmNvbnN0IENBQ0hFX1RUTCA9IDUgKiA2MCAqIDEwMDA7XG5jb25zdCBmZWF0dXJlQWNjZXNzQ2FjaGUgPSBuZXcgTWFwPHN0cmluZywgeyB0aWVyOiBTdWJzY3JpcHRpb25UaWVyOyB0aW1lc3RhbXA6IG51bWJlciB9PigpO1xuXG5leHBvcnQgY2xhc3MgRmVhdHVyZUFjY2Vzc1NlcnZpY2Uge1xuICAvKipcbiAgICogQ2hlY2sgaWYgdXNlciBoYXMgYWNjZXNzIHRvIGEgZmVhdHVyZVxuICAgKi9cbiAgYXN5bmMgY2hlY2tGZWF0dXJlQWNjZXNzKHVzZXJJZDogc3RyaW5nLCBmZWF0dXJlOiBGZWF0dXJlKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRpZXIgPSBhd2FpdCB0aGlzLmdldFVzZXJUaWVyKHVzZXJJZCk7XG4gICAgICBjb25zdCBoYXNBY2Nlc3MgPSBGRUFUVVJFX01BVFJJWFt0aWVyXS5pbmNsdWRlcyhmZWF0dXJlKTtcblxuICAgICAgbG9nZ2VyLmRlYnVnKCdGZWF0dXJlIGFjY2VzcyBjaGVjaycsIHsgdXNlcklkLCBmZWF0dXJlLCB0aWVyLCBoYXNBY2Nlc3MgfSk7XG4gICAgICByZXR1cm4gaGFzQWNjZXNzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjaGVjayBmZWF0dXJlIGFjY2VzcycsIHsgZXJyb3IsIHVzZXJJZCwgZmVhdHVyZSB9KTtcbiAgICAgIHRocm93IEVycm9ySGFuZGxlci5oYW5kbGUoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gbXVsdGlwbGUgZmVhdHVyZXNcbiAgICovXG4gIGFzeW5jIGNoZWNrTXVsdGlwbGVGZWF0dXJlcyh1c2VySWQ6IHN0cmluZywgZmVhdHVyZXM6IEZlYXR1cmVbXSk6IFByb21pc2U8UmVjb3JkPEZlYXR1cmUsIGJvb2xlYW4+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRpZXIgPSBhd2FpdCB0aGlzLmdldFVzZXJUaWVyKHVzZXJJZCk7XG4gICAgICBjb25zdCByZXN1bHQ6IFJlY29yZDxGZWF0dXJlLCBib29sZWFuPiA9IHt9IGFzIFJlY29yZDxGZWF0dXJlLCBib29sZWFuPjtcblxuICAgICAgZm9yIChjb25zdCBmZWF0dXJlIG9mIGZlYXR1cmVzKSB7XG4gICAgICAgIHJlc3VsdFtmZWF0dXJlXSA9IEZFQVRVUkVfTUFUUklYW3RpZXJdLmluY2x1ZGVzKGZlYXR1cmUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjaGVjayBtdWx0aXBsZSBmZWF0dXJlcycsIHsgZXJyb3IsIHVzZXJJZCB9KTtcbiAgICAgIHRocm93IEVycm9ySGFuZGxlci5oYW5kbGUoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGZlYXR1cmVzIGF2YWlsYWJsZSBmb3IgYSB0aWVyXG4gICAqL1xuICBnZXRGZWF0dXJlc0J5VGllcih0aWVyOiBTdWJzY3JpcHRpb25UaWVyKTogRmVhdHVyZVtdIHtcbiAgICByZXR1cm4gRkVBVFVSRV9NQVRSSVhbdGllcl07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZlYXR1cmUgbGltaXQgZm9yIGEgdGllclxuICAgKi9cbiAgZ2V0RmVhdHVyZUxpbWl0KHRpZXI6IFN1YnNjcmlwdGlvblRpZXIsIGZlYXR1cmU6IEZlYXR1cmUpOiBudW1iZXIgfCBudWxsIHtcbiAgICBjb25zdCBsaW1pdHMgPSBGRUFUVVJFX0xJTUlUU1t0aWVyXTtcbiAgICBjb25zdCBsaW1pdCA9IGxpbWl0cy5maW5kKChsKSA9PiBsLmZlYXR1cmUgPT09IGZlYXR1cmUpO1xuICAgIHJldHVybiBsaW1pdD8ubGltaXQgPz8gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGZlYXR1cmUgbGltaXRzIGZvciBhIHRpZXJcbiAgICovXG4gIGdldEZlYXR1cmVMaW1pdHNCeVRpZXIodGllcjogU3Vic2NyaXB0aW9uVGllcik6IEZlYXR1cmVMaW1pdFtdIHtcbiAgICByZXR1cm4gRkVBVFVSRV9MSU1JVFNbdGllcl07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHVzZXIncyBzdWJzY3JpcHRpb24gdGllclxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlclRpZXIodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFN1YnNjcmlwdGlvblRpZXI+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICAgIGNvbnN0IGNhY2hlZCA9IGZlYXR1cmVBY2Nlc3NDYWNoZS5nZXQodXNlcklkKTtcbiAgICAgIGlmIChjYWNoZWQgJiYgRGF0ZS5ub3coKSAtIGNhY2hlZC50aW1lc3RhbXAgPCBDQUNIRV9UVEwpIHtcbiAgICAgICAgcmV0dXJuIGNhY2hlZC50aWVyO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgZnJvbSBkYXRhYmFzZVxuICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdGllciA9IHN1YnNjcmlwdGlvbj8udGllciA/PyAnRlJFRSc7XG5cbiAgICAgIC8vIFVwZGF0ZSBjYWNoZVxuICAgICAgZmVhdHVyZUFjY2Vzc0NhY2hlLnNldCh1c2VySWQsIHsgdGllciwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuXG4gICAgICByZXR1cm4gdGllcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHVzZXIgdGllcicsIHsgZXJyb3IsIHVzZXJJZCB9KTtcbiAgICAgIC8vIERlZmF1bHQgdG8gRlJFRSB0aWVyIG9uIGVycm9yXG4gICAgICByZXR1cm4gJ0ZSRUUnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnZhbGlkYXRlIGNhY2hlIGZvciBhIHVzZXJcbiAgICovXG4gIGludmFsaWRhdGVDYWNoZSh1c2VySWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGZlYXR1cmVBY2Nlc3NDYWNoZS5kZWxldGUodXNlcklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhciBhbGwgY2FjaGVcbiAgICovXG4gIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgZmVhdHVyZUFjY2Vzc0NhY2hlLmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZlYXR1cmUgY29tcGFyaXNvbiBiZXR3ZWVuIHRpZXJzXG4gICAqL1xuICBnZXRGZWF0dXJlQ29tcGFyaXNvbigpOiBSZWNvcmQ8U3Vic2NyaXB0aW9uVGllciwgRmVhdHVyZVtdPiB7XG4gICAgcmV0dXJuIEZFQVRVUkVfTUFUUklYO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGZlYXR1cmUgaXMgYXZhaWxhYmxlIGluIGFueSB0aWVyXG4gICAqL1xuICBpc0ZlYXR1cmVBdmFpbGFibGUoZmVhdHVyZTogRmVhdHVyZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBPYmplY3QudmFsdWVzKEZFQVRVUkVfTUFUUklYKS5zb21lKChmZWF0dXJlcykgPT4gZmVhdHVyZXMuaW5jbHVkZXMoZmVhdHVyZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtaW5pbXVtIHRpZXIgcmVxdWlyZWQgZm9yIGEgZmVhdHVyZVxuICAgKi9cbiAgZ2V0TWluaW11bVRpZXJGb3JGZWF0dXJlKGZlYXR1cmU6IEZlYXR1cmUpOiBTdWJzY3JpcHRpb25UaWVyIHwgbnVsbCB7XG4gICAgY29uc3QgdGllcnM6IFN1YnNjcmlwdGlvblRpZXJbXSA9IFsnRlJFRScsICdQUk8nLCAnRU5URVJQUklTRSddO1xuICAgIGZvciAoY29uc3QgdGllciBvZiB0aWVycykge1xuICAgICAgaWYgKEZFQVRVUkVfTUFUUklYW3RpZXJdLmluY2x1ZGVzKGZlYXR1cmUpKSB7XG4gICAgICAgIHJldHVybiB0aWVyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBmZWF0dXJlIGFjY2VzcyB3aXRoIGxpbWl0IGNoZWNraW5nXG4gICAqL1xuICBhc3luYyB2YWxpZGF0ZUZlYXR1cmVVc2FnZShcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBmZWF0dXJlOiBGZWF0dXJlLFxuICAgIGN1cnJlbnRVc2FnZTogbnVtYmVyXG4gICk6IFByb21pc2U8eyBhbGxvd2VkOiBib29sZWFuOyByZW1haW5pbmc6IG51bWJlciB8IG51bGwgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0aWVyID0gYXdhaXQgdGhpcy5nZXRVc2VyVGllcih1c2VySWQpO1xuICAgICAgY29uc3QgaGFzQWNjZXNzID0gRkVBVFVSRV9NQVRSSVhbdGllcl0uaW5jbHVkZXMoZmVhdHVyZSk7XG5cbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIHJldHVybiB7IGFsbG93ZWQ6IGZhbHNlLCByZW1haW5pbmc6IG51bGwgfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGltaXQgPSB0aGlzLmdldEZlYXR1cmVMaW1pdCh0aWVyLCBmZWF0dXJlKTtcbiAgICAgIGlmIChsaW1pdCA9PT0gbnVsbCkge1xuICAgICAgICAvLyBVbmxpbWl0ZWRcbiAgICAgICAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSwgcmVtYWluaW5nOiBudWxsIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlbWFpbmluZyA9IE1hdGgubWF4KDAsIGxpbWl0IC0gY3VycmVudFVzYWdlKTtcbiAgICAgIHJldHVybiB7IGFsbG93ZWQ6IHJlbWFpbmluZyA+IDAsIHJlbWFpbmluZyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB2YWxpZGF0ZSBmZWF0dXJlIHVzYWdlJywgeyBlcnJvciwgdXNlcklkLCBmZWF0dXJlIH0pO1xuICAgICAgdGhyb3cgRXJyb3JIYW5kbGVyLmhhbmRsZShlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBmZWF0dXJlIG1hdHJpeCBmb3IgVUkgZGlzcGxheVxuICAgKi9cbiAgZ2V0RmVhdHVyZU1hdHJpeEZvclVJKCk6IHtcbiAgICBmZWF0dXJlczogRmVhdHVyZVtdO1xuICAgIHRpZXJzOiBTdWJzY3JpcHRpb25UaWVyW107XG4gICAgbWF0cml4OiBSZWNvcmQ8RmVhdHVyZSwgUmVjb3JkPFN1YnNjcmlwdGlvblRpZXIsIGJvb2xlYW4+PjtcbiAgfSB7XG4gICAgY29uc3QgYWxsRmVhdHVyZXMgPSBuZXcgU2V0PEZlYXR1cmU+KCk7XG4gICAgT2JqZWN0LnZhbHVlcyhGRUFUVVJFX01BVFJJWCkuZm9yRWFjaCgoZmVhdHVyZXMpID0+IHtcbiAgICAgIGZlYXR1cmVzLmZvckVhY2goKGYpID0+IGFsbEZlYXR1cmVzLmFkZChmKSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBmZWF0dXJlcyA9IEFycmF5LmZyb20oYWxsRmVhdHVyZXMpO1xuICAgIGNvbnN0IHRpZXJzOiBTdWJzY3JpcHRpb25UaWVyW10gPSBbJ0ZSRUUnLCAnUFJPJywgJ0VOVEVSUFJJU0UnXTtcbiAgICBjb25zdCBtYXRyaXg6IFJlY29yZDxGZWF0dXJlLCBSZWNvcmQ8U3Vic2NyaXB0aW9uVGllciwgYm9vbGVhbj4+ID0ge30gYXMgYW55O1xuXG4gICAgZm9yIChjb25zdCBmZWF0dXJlIG9mIGZlYXR1cmVzKSB7XG4gICAgICBtYXRyaXhbZmVhdHVyZV0gPSB7XG4gICAgICAgIEZSRUU6IEZFQVRVUkVfTUFUUklYLkZSRUUuaW5jbHVkZXMoZmVhdHVyZSksXG4gICAgICAgIFBSTzogRkVBVFVSRV9NQVRSSVguUFJPLmluY2x1ZGVzKGZlYXR1cmUpLFxuICAgICAgICBFTlRFUlBSSVNFOiBGRUFUVVJFX01BVFJJWC5FTlRFUlBSSVNFLmluY2x1ZGVzKGZlYXR1cmUpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBmZWF0dXJlcywgdGllcnMsIG1hdHJpeCB9O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBGZWF0dXJlQWNjZXNzU2VydmljZSgpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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