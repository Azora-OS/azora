{"version":3,"names":["cov_w3hm223zv","actualCoverage","winston","createLogger","serviceName","f","logger","s","defaultMeta","service","format","combine","timestamp","errors","stack","json","printf","level","message","meta","JSON","stringify","transports","Console","colorize","metaStr","Object","keys","length","b","File","filename","maxsize","maxFiles","requestLoggingMiddleware","req","res","next","start","Date","now","originalSend","send","data","duration","info","method","path","status","statusCode","ip","userAgent","get","traceId","spanId","call","logInfo","logWarn","warn","logError","error","logDebug","debug","logDatabaseOperation","operation","table","success","log","logAuthEvent","event","userId","logBusinessEvent","logPaymentEvent","transactionId","amount","currency","logErrorWithContext","context"],"sources":["index.ts"],"sourcesContent":["/**\n * Winston Structured Logging Setup\n * Provides centralized logging for all Azora services\n */\n\nimport winston from 'winston';\nimport { Request, Response, NextFunction } from 'express';\n\n/**\n * Create a logger instance for a service\n */\nexport function createLogger(serviceName: string) {\n  const logger = winston.createLogger({\n    defaultMeta: { service: serviceName },\n    format: winston.format.combine(\n      winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),\n      winston.format.errors({ stack: true }),\n      winston.format.json(),\n      winston.format.printf(({ timestamp, level, message, service, ...meta }) => {\n        return JSON.stringify({\n          timestamp,\n          level,\n          service,\n          message,\n          ...meta,\n        });\n      })\n    ),\n    transports: [\n      // Console output\n      new winston.transports.Console({\n        format: winston.format.combine(\n          winston.format.colorize(),\n          winston.format.printf(({ timestamp, level, message, service, ...meta }) => {\n            const metaStr = Object.keys(meta).length ? JSON.stringify(meta) : '';\n            return `${timestamp} [${service}] ${level}: ${message} ${metaStr}`;\n          })\n        ),\n      }),\n\n      // File output - all logs\n      new winston.transports.File({\n        filename: `logs/${serviceName}-all.log`,\n        maxsize: 10485760, // 10MB\n        maxFiles: 5,\n      }),\n\n      // File output - errors only\n      new winston.transports.File({\n        filename: `logs/${serviceName}-error.log`,\n        level: 'error',\n        maxsize: 10485760,\n        maxFiles: 5,\n      }),\n    ],\n  });\n\n  return logger;\n}\n\n/**\n * Express middleware for request logging\n */\nexport function requestLoggingMiddleware(logger: winston.Logger) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const start = Date.now();\n\n    // Capture response\n    const originalSend = res.send;\n    res.send = function (data: any) {\n      const duration = Date.now() - start;\n\n      logger.info('HTTP Request', {\n        method: req.method,\n        path: req.path,\n        status: res.statusCode,\n        duration: `${duration}ms`,\n        ip: req.ip,\n        userAgent: req.get('user-agent'),\n        traceId: (req as any).traceId,\n        spanId: (req as any).spanId,\n      });\n\n      return originalSend.call(this, data);\n    };\n\n    next();\n  };\n}\n\n/**\n * Log info message\n */\nexport function logInfo(logger: winston.Logger, message: string, meta?: Record<string, any>) {\n  logger.info(message, meta);\n}\n\n/**\n * Log warning message\n */\nexport function logWarn(logger: winston.Logger, message: string, meta?: Record<string, any>) {\n  logger.warn(message, meta);\n}\n\n/**\n * Log error message\n */\nexport function logError(logger: winston.Logger, message: string, error?: Error, meta?: Record<string, any>) {\n  logger.error(message, {\n    error: error?.message,\n    stack: error?.stack,\n    ...meta,\n  });\n}\n\n/**\n * Log debug message\n */\nexport function logDebug(logger: winston.Logger, message: string, meta?: Record<string, any>) {\n  logger.debug(message, meta);\n}\n\n/**\n * Log database operation\n */\nexport function logDatabaseOperation(\n  logger: winston.Logger,\n  operation: string,\n  table: string,\n  duration: number,\n  success: boolean,\n  error?: Error\n) {\n  const level = success ? 'info' : 'error';\n  const message = `Database ${operation} on ${table}`;\n\n  logger.log(level, message, {\n    operation,\n    table,\n    duration: `${duration}ms`,\n    success,\n    error: error?.message,\n  });\n}\n\n/**\n * Log authentication event\n */\nexport function logAuthEvent(\n  logger: winston.Logger,\n  event: 'login' | 'logout' | 'failed_login' | 'mfa_enabled' | 'password_reset',\n  userId?: string,\n  meta?: Record<string, any>\n) {\n  logger.info(`Auth: ${event}`, {\n    event,\n    userId,\n    ...meta,\n  });\n}\n\n/**\n * Log business event\n */\nexport function logBusinessEvent(\n  logger: winston.Logger,\n  event: string,\n  userId: string,\n  meta?: Record<string, any>\n) {\n  logger.info(`Business: ${event}`, {\n    event,\n    userId,\n    ...meta,\n  });\n}\n\n/**\n * Log payment event\n */\nexport function logPaymentEvent(\n  logger: winston.Logger,\n  event: 'payment_initiated' | 'payment_completed' | 'payment_failed' | 'refund_issued',\n  transactionId: string,\n  amount: number,\n  currency: string,\n  meta?: Record<string, any>\n) {\n  logger.info(`Payment: ${event}`, {\n    event,\n    transactionId,\n    amount,\n    currency,\n    ...meta,\n  });\n}\n\n/**\n * Log error with context\n */\nexport function logErrorWithContext(\n  logger: winston.Logger,\n  error: Error,\n  context: string,\n  meta?: Record<string, any>\n) {\n  logger.error(`Error in ${context}`, {\n    error: error.message,\n    stack: error.stack,\n    context,\n    ...meta,\n  });\n}\n\nexport default {\n  createLogger,\n  requestLoggingMiddleware,\n  logInfo,\n  logWarn,\n  logError,\n  logDebug,\n  logDatabaseOperation,\n  logAuthEvent,\n  logBusinessEvent,\n  logPaymentEvent,\n  logErrorWithContext,\n};\n"],"mappings":"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","ignoreList":[]}