{"version":3,"names":["cov_2cerrryg3a","actualCoverage","jwt","s","require","crypto","JWT_ALGORITHM","TOKEN_EXPIRY","REFRESH_TOKEN_EXPIRY","revokedTokens","Set","publicKey","privateKey","generateKeyPairSync","modulusLength","publicKeyEncoding","type","format","privateKeyEncoding","generateAccessToken","payload","f","sign","algorithm","expiresIn","generateRefreshToken","verifyToken","token","has","b","Error","verify","algorithms","revokeToken","add","setTimeout","delete","authenticateToken","req","res","next","authHeader","headers","split","status","json","error","user","err","module","exports"],"sources":["jwt.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst crypto = require('crypto');\n\nconst JWT_ALGORITHM = 'RS256';\nconst TOKEN_EXPIRY = '1h';\nconst REFRESH_TOKEN_EXPIRY = '7d';\n\nconst revokedTokens = new Set();\n\nconst { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {\n  modulusLength: 2048,\n  publicKeyEncoding: { type: 'spki', format: 'pem' },\n  privateKeyEncoding: { type: 'pkcs8', format: 'pem' }\n});\n\nfunction generateAccessToken(payload) {\n  return jwt.sign(payload, privateKey, {\n    algorithm: JWT_ALGORITHM,\n    expiresIn: TOKEN_EXPIRY\n  });\n}\n\nfunction generateRefreshToken(payload) {\n  return jwt.sign(payload, privateKey, {\n    algorithm: JWT_ALGORITHM,\n    expiresIn: REFRESH_TOKEN_EXPIRY\n  });\n}\n\nfunction verifyToken(token) {\n  if (revokedTokens.has(token)) {\n    throw new Error('Token has been revoked');\n  }\n  return jwt.verify(token, publicKey, { algorithms: [JWT_ALGORITHM] });\n}\n\nfunction revokeToken(token) {\n  revokedTokens.add(token);\n  setTimeout(() => revokedTokens.delete(token), 3600000);\n}\n\nfunction authenticateToken(req, res, next) {\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    return res.status(401).json({ error: 'Access token required' });\n  }\n\n  try {\n    const user = verifyToken(token);\n    req.user = user;\n    req.token = token;\n    next();\n  } catch (err) {\n    return res.status(403).json({ error: 'Invalid or expired token' });\n  }\n}\n\nmodule.exports = {\n  generateAccessToken,\n  generateRefreshToken,\n  verifyToken,\n  revokeToken,\n  authenticateToken,\n  publicKey,\n  privateKey\n};\n"],"mappings":"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","ignoreList":[]}