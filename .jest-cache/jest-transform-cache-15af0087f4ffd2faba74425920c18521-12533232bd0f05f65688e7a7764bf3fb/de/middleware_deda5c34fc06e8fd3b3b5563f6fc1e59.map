{"version":3,"names":["cov_2hvs3nk7vu","actualCoverage","httpRequestDuration","httpRequestTotal","activeConnections","logger","s","performanceMiddleware","req","res","next","f","start","Date","now","inc","on","duration","route","b","path","observe","method","status_code","statusCode","dec","info","status"],"sources":["middleware.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport { httpRequestDuration, httpRequestTotal, activeConnections } from './metrics';\nimport { logger } from './logger';\n\nexport const performanceMiddleware = (req: Request, res: Response, next: NextFunction) => {\n  const start = Date.now();\n  activeConnections.inc();\n\n  res.on('finish', () => {\n    const duration = (Date.now() - start) / 1000;\n    const route = req.route?.path || req.path;\n    \n    httpRequestDuration.observe(\n      { method: req.method, route, status_code: res.statusCode },\n      duration\n    );\n    \n    httpRequestTotal.inc({ method: req.method, route, status_code: res.statusCode });\n    activeConnections.dec();\n    \n    logger.info('HTTP Request', {\n      method: req.method,\n      route,\n      status: res.statusCode,\n      duration: `${duration}s`\n    });\n  });\n\n  next();\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAdZ,SAASE,mBAAmB,EAAEC,gBAAgB,EAAEC,iBAAiB,QAAQ,WAAW;AACpF,SAASC,MAAM,QAAQ,UAAU;AAAC;AAAAL,cAAA,GAAAM,CAAA;AAElC,OAAO,MAAMC,qBAAqB,GAAGA,CAACC,GAAY,EAAEC,GAAa,EAAEC,IAAkB,KAAK;EAAA;EAAAV,cAAA,GAAAW,CAAA;EACxF,MAAMC,KAAK;EAAA;EAAA,CAAAZ,cAAA,GAAAM,CAAA,OAAGO,IAAI,CAACC,GAAG,CAAC,CAAC;EAAC;EAAAd,cAAA,GAAAM,CAAA;EACzBF,iBAAiB,CAACW,GAAG,CAAC,CAAC;EAAC;EAAAf,cAAA,GAAAM,CAAA;EAExBG,GAAG,CAACO,EAAE,CAAC,QAAQ,EAAE,MAAM;IAAA;IAAAhB,cAAA,GAAAW,CAAA;IACrB,MAAMM,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAM,CAAA,OAAG,CAACO,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGF,KAAK,IAAI,IAAI;IAC5C,MAAMM,KAAK;IAAA;IAAA,CAAAlB,cAAA,GAAAM,CAAA;IAAG;IAAA,CAAAN,cAAA,GAAAmB,CAAA,UAAAX,GAAG,CAACU,KAAK,EAAEE,IAAI;IAAA;IAAA,CAAApB,cAAA,GAAAmB,CAAA,UAAIX,GAAG,CAACY,IAAI;IAAC;IAAApB,cAAA,GAAAM,CAAA;IAE1CJ,mBAAmB,CAACmB,OAAO,CACzB;MAAEC,MAAM,EAAEd,GAAG,CAACc,MAAM;MAAEJ,KAAK;MAAEK,WAAW,EAAEd,GAAG,CAACe;IAAW,CAAC,EAC1DP,QACF,CAAC;IAAC;IAAAjB,cAAA,GAAAM,CAAA;IAEFH,gBAAgB,CAACY,GAAG,CAAC;MAAEO,MAAM,EAAEd,GAAG,CAACc,MAAM;MAAEJ,KAAK;MAAEK,WAAW,EAAEd,GAAG,CAACe;IAAW,CAAC,CAAC;IAAC;IAAAxB,cAAA,GAAAM,CAAA;IACjFF,iBAAiB,CAACqB,GAAG,CAAC,CAAC;IAAC;IAAAzB,cAAA,GAAAM,CAAA;IAExBD,MAAM,CAACqB,IAAI,CAAC,cAAc,EAAE;MAC1BJ,MAAM,EAAEd,GAAG,CAACc,MAAM;MAClBJ,KAAK;MACLS,MAAM,EAAElB,GAAG,CAACe,UAAU;MACtBP,QAAQ,EAAE,GAAGA,QAAQ;IACvB,CAAC,CAAC;EACJ,CAAC,CAAC;EAAC;EAAAjB,cAAA,GAAAM,CAAA;EAEHI,IAAI,CAAC,CAAC;AACR,CAAC","ignoreList":[]}