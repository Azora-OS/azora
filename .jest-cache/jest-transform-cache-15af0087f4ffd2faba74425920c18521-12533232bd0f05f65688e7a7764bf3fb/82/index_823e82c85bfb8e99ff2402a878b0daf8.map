{"version":3,"names":["cov_wbzpwtjn","actualCoverage","express","bodyParser","AgentRuntime","HealthService","getTask","logger","app","s","use","json","static","path","resolve","process","cwd","runtime","health","registerHealthCheck","f","serviceId","status","lastCheckedAt","Date","toISOString","post","req","res","payload","body","result","executeTask","err","error","message","get","id","params","task","tasks","store","require","inMemoryTaskStore","t","values","push","cancelTask","success","pauseTask","resumeTask","port","b","env","PORT","listen","info","checks","runChecks","unhealthy","filter","c","length","ids","getActiveExecutions","active","getAgentStatus"],"sources":["index.ts"],"sourcesContent":["import express from 'express';\nimport bodyParser from 'body-parser';\nimport { AgentRuntime } from './runtime';\nimport { HealthService } from '../../packages/shared/health/src/index';\nimport { getTask } from './persistence';\nimport { logger } from './logger';\n\nconst app = express();\napp.use(bodyParser.json());\napp.use('/ui', express.static(path.resolve(process.cwd(), 'static')));\n\nconst runtime = new AgentRuntime();\nconst health = new HealthService();\n\nhealth.registerHealthCheck('agent-execution', async () => ({\n  serviceId: 'agent-execution',\n  status: 'healthy',\n  lastCheckedAt: new Date().toISOString()\n}));\n\napp.post('/execute', async (req, res) => {\n  try {\n    const payload = req.body;\n    const result = await runtime.executeTask(payload);\n    res.json(result);\n  } catch (err: any) {\n    logger.error({ err }, 'Execute error');\n    res.status(500).json({ error: err.message });\n  }\n});\n\napp.get('/task/:id', async (req, res) => {\n  const id = req.params.id;\n  const task = await getTask(id);\n  res.json(task);\n});\n\napp.get('/tasks', async (req, res) => {\n  try {\n    // For demo: expose in-memory tasks\n    const tasks = [] as any[];\n    const store = (require('./persistence') as any).inMemoryTaskStore;\n    for (const t of store.values()) tasks.push(t);\n    res.json({ tasks });\n  } catch (err: any) {\n    res.status(500).json({ error: err.message });\n  }\n});\n\napp.post('/task/:id/cancel', async (req, res) => {\n  const id = req.params.id;\n  try {\n    await runtime.cancelTask(id);\n    res.json({ success: true });\n  } catch (err: any) {\n    res.status(500).json({ error: err.message });\n  }\n});\n\napp.post('/task/:id/pause', async (req, res) => {\n  const id = req.params.id;\n  try {\n    await runtime.pauseTask(id);\n    res.json({ success: true });\n  } catch (err: any) {\n    res.status(500).json({ error: err.message });\n  }\n});\n\napp.post('/task/:id/resume', async (req, res) => {\n  const id = req.params.id;\n  try {\n    await runtime.resumeTask(id);\n    res.json({ success: true });\n  } catch (err: any) {\n    res.status(500).json({ error: err.message });\n  }\n});\n\nconst port = process.env.PORT ?? 4002;\napp.listen(port, () => {\n  logger.info({ port }, 'Agent Execution service started');\n});\n\napp.get('/health', async (req, res) => {\n  const checks = await health.runChecks();\n  const unhealthy = checks.filter(c => c.status !== 'healthy');\n  res.status(unhealthy.length ? 503 : 200).json({ checks });\n});\n\napp.get('/executions', async (req, res) => {\n  try {\n    const ids = runtime.getActiveExecutions();\n    res.json({ active: ids });\n  } catch (err: any) {\n    res.status(500).json({ error: err.message });\n  }\n});\n\napp.get('/agents/:id/status', async (req, res) => {\n  const id = req.params.id;\n  try {\n    const status = await runtime.getAgentStatus(id);\n    res.json(status);\n  } catch (err: any) {\n    res.status(500).json({ error: err.message });\n  }\n});\n"],"mappings":"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","ignoreList":[]}