{"version":3,"names":["cov_21p6hh5znp","actualCoverage","WorldModel","history","s","maxHistorySize","vae","rnn","controller","constructor","f","currentState","initializeState","timestamp","Date","now","entities","relationships","dynamics","entropy","growth","health","constitutional_alignment","uncertainty","observe","observations","push","length","b","shift","updateLatentRepresentation","updateDynamicsModel","Math","max","predict","timeHorizon","futureDynamics","predictDynamics","futureState","decodeFutureState","alternatives","generateAlternativeFutures","confidence","state","plan","desiredState","console","log","current","trajectory","predictTrajectory","actions","generateActions","validatedActions","validateActions","encode","z","Array","fill","map","random","mu","logvar","decode","latent","forward","a","recentHistory","slice","entropyTrend","calculateTrend","growthTrend","healthTrend","constitutionalTrend","min","values","n","sumX","sumY","reduce","sumXY","sum","y","x","sumX2","slope","i","altDynamics","altState","desired","steps","alpha","interpolated","interpolateStates","from","to","action","generateAction","next","type","description","target","parameters","constitutional","validated","warn","getCurrentState","getHistory","limit"],"sources":["world-model.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\nCopyright (c) 2025 Azora ES (Pty) Ltd. All Rights Reserved.\nSee LICENSE file for details.\n*/\n/**\n * WORLD MODEL\n *\n * Inspired by Ha & Schmidhuber's \"World Models\" (2018)\n * Build internal representation of reality\n *\n * \"For we walk by faith, not by sight.\" - 2 Corinthians 5:7\n */\n\n// World state representation\nexport interface WorldState {\n  timestamp: number;\n  entities: Entity[];\n  relationships: Relationship[];\n  dynamics: Dynamics;\n  uncertainty: number; // 0-1, how confident in this state\n}\n\n// Entity in the world\nexport interface Entity {\n  id: string;\n  type: 'human' | 'ai' | 'system' | 'data' | 'unknown';\n  properties: Record<string, any>;\n  position: Vector3D;\n  velocity: Vector3D;\n  status: 'active' | 'inactive' | 'unknown';\n}\n\n// Relationship between entities\nexport interface Relationship {\n  from: string; // entity id\n  to: string; // entity id\n  type: 'serves' | 'depends_on' | 'conflicts' | 'collaborates' | 'unknown';\n  strength: number; // 0-1\n  constitutional: boolean; // Does this relationship align with Ten Commandments?\n}\n\n// World dynamics (how world changes)\nexport interface Dynamics {\n  entropy: number; // Disorder in the system\n  growth: number; // System growth rate\n  health: number; // Overall system health\n  constitutional_alignment: number; // Alignment with Ten Commandments\n}\n\n// Vector in 3D space\nexport interface Vector3D {\n  x: number;\n  y: number;\n  z: number;\n}\n\n// Prediction of future state\nexport interface Prediction {\n  state: WorldState;\n  confidence: number;\n  timeHorizon: number; // How far into future (seconds)\n  alternatives: WorldState[]; // Alternative futures\n}\n\n/**\n * World Model for AGI\n */\nexport class WorldModel {\n  private currentState: WorldState;\n  private history: WorldState[] = [];\n  private maxHistorySize: number = 10000;\n  private vae: any = null; // Variational Autoencoder (latent representation)\n  private rnn: any = null; // Recurrent Neural Network (dynamics)\n  private controller: any = null; // Controller (decision-making)\n\n  constructor() {\n    this.currentState = this.initializeState();\n  }\n\n  /**\n   * Initialize world state\n   */\n  private initializeState(): WorldState {\n    return {\n      timestamp: Date.now(),\n      entities: [],\n      relationships: [],\n      dynamics: {\n        entropy: 0.5,\n        growth: 0.0,\n        health: 1.0,\n        constitutional_alignment: 1.0, // Perfect alignment initially\n      },\n      uncertainty: 0.5,\n    };\n  }\n\n  /**\n   * Observe the world (update internal representation)\n   */\n  async observe(observations: Partial<WorldState>): Promise<void> {\n    // Update current state with new observations\n    this.currentState = {\n      ...this.currentState,\n      ...observations,\n      timestamp: Date.now(),\n    };\n\n    // Add to history\n    this.history.push(this.currentState);\n    if (this.history.length > this.maxHistorySize) {\n      this.history.shift(); // Remove oldest\n    }\n\n    // Update latent representation (VAE)\n    await this.updateLatentRepresentation();\n\n    // Update dynamics model (RNN)\n    await this.updateDynamicsModel();\n\n    // Reduce uncertainty as we observe more\n    this.currentState.uncertainty = Math.max(\n      0.1,\n      this.currentState.uncertainty * 0.99\n    );\n  }\n\n  /**\n   * Predict future state\n   */\n  async predict(timeHorizon: number = 60): Promise<Prediction> {\n    // Use RNN to predict future dynamics\n    const futureDynamics = await this.predictDynamics(timeHorizon);\n\n    // Use VAE to decode latent representation into future state\n    const futureState = await this.decodeFutureState(futureDynamics);\n\n    // Generate alternative futures (different actions)\n    const alternatives = await this.generateAlternativeFutures(timeHorizon);\n\n    // Calculate confidence based on uncertainty and history\n    const confidence = 1.0 - this.currentState.uncertainty;\n\n    return {\n      state: futureState,\n      confidence,\n      timeHorizon,\n      alternatives,\n    };\n  }\n\n  /**\n   * Plan action to reach desired future state\n   */\n  async plan(desiredState: Partial<WorldState>): Promise<Action[]> {\n    console.log('[World Model] Planning actions to reach desired state...');\n\n    // Get current state\n    const current = this.currentState;\n\n    // Predict trajectory to desired state\n    const trajectory = await this.predictTrajectory(current, desiredState);\n\n    // Use controller to generate action sequence\n    const actions = await this.generateActions(trajectory);\n\n    // Validate actions against Constitution\n    const validatedActions = await this.validateActions(actions);\n\n    return validatedActions;\n  }\n\n  /**\n   * Update latent representation using VAE\n   */\n  private async updateLatentRepresentation(): Promise<void> {\n    // VAE encodes high-dimensional state into low-dimensional latent vector\n    // This makes it tractable for RNN to learn dynamics\n\n    if (!this.vae) {\n      // Initialize VAE (in production, load trained model)\n      this.vae = {\n        encode: async (state: WorldState) => {\n          // Encode state into latent vector (z)\n          return {\n            z: new Array(32).fill(0).map(() => Math.random()),\n            mu: new Array(32).fill(0).map(() => Math.random()),\n            logvar: new Array(32).fill(0).map(() => Math.random()),\n          };\n        },\n        decode: async (z: number[]) => {\n          // Decode latent vector back to state\n          return this.currentState;\n        },\n      };\n    }\n\n    // Encode current state\n    const latent = await this.vae.encode(this.currentState);\n    console.log('[World Model] Latent representation updated');\n  }\n\n  /**\n   * Update dynamics model using RNN\n   */\n  private async updateDynamicsModel(): Promise<void> {\n    // RNN learns: z(t+1) = f(z(t), a(t))\n    // Where z is latent state, a is action\n\n    if (!this.rnn) {\n      // Initialize RNN (in production, load trained model)\n      this.rnn = {\n        forward: async (z: number[], a: any) => {\n          // Predict next latent state\n          return new Array(32).fill(0).map(() => Math.random());\n        },\n      };\n    }\n\n    console.log('[World Model] Dynamics model updated');\n  }\n\n  /**\n   * Predict future dynamics\n   */\n  private async predictDynamics(timeHorizon: number): Promise<Dynamics> {\n    // Use history to extrapolate future dynamics\n    const recentHistory = this.history.slice(-10);\n\n    if (recentHistory.length === 0) {\n      return this.currentState.dynamics;\n    }\n\n    // Calculate trends\n    const entropyTrend = this.calculateTrend(\n      recentHistory.map(s => s.dynamics.entropy)\n    );\n    const growthTrend = this.calculateTrend(\n      recentHistory.map(s => s.dynamics.growth)\n    );\n    const healthTrend = this.calculateTrend(\n      recentHistory.map(s => s.dynamics.health)\n    );\n    const constitutionalTrend = this.calculateTrend(\n      recentHistory.map(s => s.dynamics.constitutional_alignment)\n    );\n\n    // Extrapolate\n    const current = this.currentState.dynamics;\n    return {\n      entropy: Math.max(\n        0,\n        Math.min(1, current.entropy + entropyTrend * timeHorizon)\n      ),\n      growth: current.growth + growthTrend * timeHorizon,\n      health: Math.max(\n        0,\n        Math.min(1, current.health + healthTrend * timeHorizon)\n      ),\n      constitutional_alignment: Math.max(\n        0,\n        Math.min(\n          1,\n          current.constitutional_alignment + constitutionalTrend * timeHorizon\n        )\n      ),\n    };\n  }\n\n  /**\n   * Calculate trend from time series\n   */\n  private calculateTrend(values: number[]): number {\n    if (values.length < 2) {return 0;}\n\n    // Simple linear regression\n    const n = values.length;\n    const sumX = (n * (n - 1)) / 2;\n    const sumY = values.reduce((a, b) => a + b, 0);\n    const sumXY = values.reduce((sum, y, x) => sum + x * y, 0);\n    const sumX2 = (n * (n - 1) * (2 * n - 1)) / 6;\n\n    const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);\n    return slope;\n  }\n\n  /**\n   * Decode future state from predicted dynamics\n   */\n  private async decodeFutureState(dynamics: Dynamics): Promise<WorldState> {\n    // Use VAE to decode latent representation into full state\n    return {\n      ...this.currentState,\n      timestamp: Date.now() + 60000, // 60 seconds in future\n      dynamics,\n      uncertainty: this.currentState.uncertainty * 1.2, // Increase uncertainty for future\n    };\n  }\n\n  /**\n   * Generate alternative future scenarios\n   */\n  private async generateAlternativeFutures(\n    timeHorizon: number\n  ): Promise<WorldState[]> {\n    // Generate multiple possible futures based on different actions\n    const alternatives: WorldState[] = [];\n\n    for (let i = 0; i < 3; i++) {\n      const altDynamics = await this.predictDynamics(\n        timeHorizon * (1 + i * 0.5)\n      );\n      const altState = await this.decodeFutureState(altDynamics);\n      alternatives.push(altState);\n    }\n\n    return alternatives;\n  }\n\n  /**\n   * Predict trajectory from current to desired state\n   */\n  private async predictTrajectory(\n    current: WorldState,\n    desired: Partial<WorldState>\n  ): Promise<WorldState[]> {\n    // Generate intermediate states\n    const steps = 10;\n    const trajectory: WorldState[] = [];\n\n    for (let i = 0; i <= steps; i++) {\n      const alpha = i / steps;\n      const interpolated = this.interpolateStates(current, desired, alpha);\n      trajectory.push(interpolated);\n    }\n\n    return trajectory;\n  }\n\n  /**\n   * Interpolate between two states\n   */\n  private interpolateStates(\n    from: WorldState,\n    to: Partial<WorldState>,\n    alpha: number\n  ): WorldState {\n    // Simple linear interpolation\n    return {\n      ...from,\n      timestamp: from.timestamp + alpha * 60000,\n      uncertainty:\n        from.uncertainty * (1 - alpha) +\n        (to.uncertainty || from.uncertainty) * alpha,\n    };\n  }\n\n  /**\n   * Generate actions to follow trajectory\n   */\n  private async generateActions(trajectory: WorldState[]): Promise<Action[]> {\n    // Use controller to generate action sequence\n    const actions: Action[] = [];\n\n    for (let i = 0; i < trajectory.length - 1; i++) {\n      const action = await this.generateAction(\n        trajectory[i],\n        trajectory[i + 1]\n      );\n      actions.push(action);\n    }\n\n    return actions;\n  }\n\n  /**\n   * Generate single action\n   */\n  private async generateAction(\n    current: WorldState,\n    next: WorldState\n  ): Promise<Action> {\n    // Controller determines action to transition from current to next state\n    return {\n      type: 'system-action',\n      description: 'Transition to next state',\n      target: 'world',\n      parameters: {},\n      constitutional: true,\n    };\n  }\n\n  /**\n   * Validate actions against Constitution\n   */\n  private async validateActions(actions: Action[]): Promise<Action[]> {\n    const validated: Action[] = [];\n\n    for (const action of actions) {\n      // Check if action is constitutional\n      if (action.constitutional) {\n        validated.push(action);\n      } else {\n        console.warn(\n          '[World Model] Skipping non-constitutional action:',\n          action\n        );\n      }\n    }\n\n    return validated;\n  }\n\n  /**\n   * Get current world state\n   */\n  getCurrentState(): WorldState {\n    return this.currentState;\n  }\n\n  /**\n   * Get world history\n   */\n  getHistory(limit: number = 100): WorldState[] {\n    return this.history.slice(-limit);\n  }\n}\n\n// Action interface\nexport interface Action {\n  type: string;\n  description: string;\n  target: string;\n  parameters: Record<string, any>;\n  constitutional: boolean;\n}\n\nexport default {\n  WorldModel,\n};\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}