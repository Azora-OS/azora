{"version":3,"names":["cov_1n68aqc3bb","actualCoverage","Router","conversionMetricsService","logger","router","s","get","req","res","f","now","Date","period","getFullYear","String","getMonth","padStart","metrics","getConversionMetrics","json","success","data","error","status","params","isValidPeriod","b","test","year","month","split","m","parseInt"],"sources":["conversion-metrics.routes.ts"],"sourcesContent":["import { Router, Request, Response } from 'express';\nimport { conversionMetricsService } from '../services/conversion-metrics.service';\nimport { logger } from '../utils/logger';\n\nconst router = Router();\n\n/**\n * GET /analytics/conversion/metrics\n * Get conversion metrics for current month\n * Requirements: 5.1, 5.2\n */\nrouter.get('/analytics/conversion/metrics', async (req: Request, res: Response) => {\n  try {\n    const now = new Date();\n    const period = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n\n    const metrics = await conversionMetricsService.getConversionMetrics(period);\n\n    res.json({\n      success: true,\n      data: metrics,\n    });\n  } catch (error) {\n    logger.error('Error fetching conversion metrics', { error });\n    res.status(500).json({\n      success: false,\n      error: 'Failed to fetch conversion metrics',\n    });\n  }\n});\n\n/**\n * GET /analytics/conversion/metrics/:period\n * Get conversion metrics for a specific period\n * Period format: YYYY-MM, YYYY-Q1, or YYYY\n * Requirements: 5.1, 5.2\n */\nrouter.get('/analytics/conversion/metrics/:period', async (req: Request, res: Response) => {\n  try {\n    const { period } = req.params;\n\n    // Validate period format\n    if (!isValidPeriod(period)) {\n      return res.status(400).json({\n        success: false,\n        error: 'Invalid period format. Use YYYY-MM, YYYY-Q1, or YYYY',\n      });\n    }\n\n    const metrics = await conversionMetricsService.getConversionMetrics(period);\n\n    res.json({\n      success: true,\n      data: metrics,\n    });\n  } catch (error) {\n    logger.error('Error fetching conversion metrics for period', { error, period: req.params.period });\n    res.status(500).json({\n      success: false,\n      error: 'Failed to fetch conversion metrics',\n    });\n  }\n});\n\n/**\n * Validate period format\n */\nfunction isValidPeriod(period: string): boolean {\n  // YYYY-MM format\n  if (/^\\d{4}-\\d{2}$/.test(period)) {\n    const [year, month] = period.split('-');\n    const m = parseInt(month);\n    return m >= 1 && m <= 12;\n  }\n\n  // YYYY-Q1 format\n  if (/^\\d{4}-Q[1-4]$/.test(period)) {\n    return true;\n  }\n\n  // YYYY format\n  if (/^\\d{4}$/.test(period)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}