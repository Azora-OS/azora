{"version":3,"names":["cov_17ofn9kgcz","actualCoverage","express","s","require","router","Router","shieldService","post","req","res","f","mockReq","ip","b","body","method","url","query","headers","get","header","toLowerCase","analysis","analyzeRequest","json","success","data","error","status","message","filters","minRiskScore","parseInt","threatType","startDate","endDate","page","limit","events","getSecurityEvents","blockIP","unblockIP","params","isBlocked","isIPBlocked","stats","getThreatStats","delete","retentionDays","days","removedCount","clearOldEvents","module","exports"],"sources":["routes.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst shieldService = require('../index');\n\n// Analyze a request (for testing purposes)\nrouter.post('/analyze', (req, res) => {\n  try {\n    // Create a mock request object for analysis\n    const mockReq = {\n      ip: req.body.ip || req.ip || '127.0.0.1',\n      method: req.body.method || 'GET',\n      url: req.body.url || '/',\n      query: req.body.query || {},\n      body: req.body.body || {},\n      headers: req.body.headers || {},\n      get: (header) => req.body.headers?.[header.toLowerCase()] || null\n    };\n\n    const analysis = shieldService.analyzeRequest(mockReq);\n\n    res.json({\n      success: true,\n      data: analysis\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Get security events with filtering\nrouter.get('/events', (req, res) => {\n  try {\n    const filters = {\n      ip: req.query.ip,\n      minRiskScore: req.query.minRiskScore ? parseInt(req.query.minRiskScore) : null,\n      threatType: req.query.threatType,\n      startDate: req.query.startDate,\n      endDate: req.query.endDate,\n      page: parseInt(req.query.page) || 1,\n      limit: parseInt(req.query.limit) || 50\n    };\n\n    const events = shieldService.getSecurityEvents(filters);\n\n    res.json({\n      success: true,\n      data: events\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Block an IP address\nrouter.post('/block-ip', (req, res) => {\n  try {\n    const { ip } = req.body;\n\n    if (!ip) {\n      return res.status(400).json({\n        error: 'IP address is required'\n      });\n    }\n\n    shieldService.blockIP(ip);\n\n    res.json({\n      success: true,\n      message: `IP address ${ip} blocked successfully`\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Unblock an IP address\nrouter.post('/unblock-ip', (req, res) => {\n  try {\n    const { ip } = req.body;\n\n    if (!ip) {\n      return res.status(400).json({\n        error: 'IP address is required'\n      });\n    }\n\n    shieldService.unblockIP(ip);\n\n    res.json({\n      success: true,\n      message: `IP address ${ip} unblocked successfully`\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Check if IP is blocked\nrouter.get('/ip-status/:ip', (req, res) => {\n  try {\n    const { ip } = req.params;\n    const isBlocked = shieldService.isIPBlocked(ip);\n\n    res.json({\n      success: true,\n      data: {\n        ip,\n        isBlocked\n      }\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Get threat statistics\nrouter.get('/stats', (req, res) => {\n  try {\n    const stats = shieldService.getThreatStats();\n\n    res.json({\n      success: true,\n      data: stats\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\n// Clear old events\nrouter.delete('/events/old', (req, res) => {\n  try {\n    const retentionDays = parseInt(req.query.days) || 30;\n    const removedCount = shieldService.clearOldEvents(retentionDays);\n\n    res.json({\n      success: true,\n      message: `Removed ${removedCount} old security events`,\n      removedCount\n    });\n  } catch (error) {\n    res.status(500).json({\n      error: error.message\n    });\n  }\n});\n\nmodule.exports = router;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}