{"version":3,"names":["cov_qbecguabx","actualCoverage","axios","prisma","logger","Joi","contentValidationSchema","s","object","courseId","string","required","contentType","valid","content","min","title","optional","language","default","ContentValidationService","constructor","f","constitutionalAIUrl","b","process","env","CONSTITUTIONAL_AI_URL","constitutionalAIClient","create","baseURL","timeout","validationCache","Map","cacheExpiry","validateCourseContent","data","error","value","validate","Error","message","cacheKey","generateCacheKey","cached","get","info","course","findUnique","where","id","response","post","context","courseTitle","tier","result","contentId","Date","now","isValid","complianceScore","violations","recommendations","validatedAt","set","setTimeout","delete","validateAssessmentQuestions","assessmentId","assessment","include","questionsContent","questions","join","assessmentTitle","passingScore","validateTeacherFeedback","enrollmentId","feedback","enrollment","student","studentName","firstName","checkForBias","hasBias","biasTypes","severity","checkForAccuracy","isAccurate","issues","confidence","suggestions","checkForClarity","readabilityScore","isClarity","checkForSafety","isSafe","harmTypes","hash","substring","replace","toLowerCase","clearCache","clear","contentValidationService"],"sources":["constitutional-ai-integration.ts"],"sourcesContent":["import axios, { AxiosInstance } from 'axios';\nimport { prisma } from '../index';\nimport { logger } from '../utils/logger';\nimport Joi from 'joi';\n\nconst contentValidationSchema = Joi.object({\n  courseId: Joi.string().required(),\n  contentType: Joi.string().valid('course', 'assessment', 'feedback').required(),\n  content: Joi.string().required().min(10),\n  title: Joi.string().optional(),\n  language: Joi.string().optional().default('en'),\n});\n\ninterface ValidationViolation {\n  type: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  message: string;\n  location?: string;\n}\n\ninterface ContentValidationResult {\n  contentId: string;\n  contentType: string;\n  isValid: boolean;\n  complianceScore: number;\n  violations: ValidationViolation[];\n  recommendations: string[];\n  validatedAt: Date;\n}\n\nexport class ContentValidationService {\n  private constitutionalAIClient: AxiosInstance;\n  private constitutionalAIUrl: string;\n  private validationCache: Map<string, ContentValidationResult>;\n  private cacheExpiry: number;\n\n  constructor() {\n    this.constitutionalAIUrl = process.env.CONSTITUTIONAL_AI_URL || 'http://localhost:3001';\n    this.constitutionalAIClient = axios.create({\n      baseURL: this.constitutionalAIUrl,\n      timeout: 10000,\n    });\n    this.validationCache = new Map();\n    this.cacheExpiry = 3600000; // 1 hour\n  }\n\n  /**\n   * Validate course content\n   */\n  async validateCourseContent(data: any): Promise<ContentValidationResult> {\n    try {\n      const { error, value } = contentValidationSchema.validate(data);\n      if (error) {\n        throw new Error(`Validation error: ${error.message}`);\n      }\n\n      // Check cache first\n      const cacheKey = this.generateCacheKey(value.courseId, value.content);\n      const cached = this.validationCache.get(cacheKey);\n      if (cached) {\n        logger.info(`Cache hit for content validation: ${value.courseId}`);\n        return cached;\n      }\n\n      // Get course context\n      const course = await prisma.course.findUnique({\n        where: { id: value.courseId },\n      });\n\n      if (!course) {\n        throw new Error('Course not found');\n      }\n\n      // Call Constitutional AI for validation\n      const response = await this.constitutionalAIClient.post('/api/constitutional-ai/validate', {\n        content: value.content,\n        title: value.title || course.title,\n        contentType: value.contentType,\n        language: value.language,\n        context: {\n          courseTitle: course.title,\n          tier: course.tier,\n        },\n      });\n\n      const result: ContentValidationResult = {\n        contentId: `validation-${Date.now()}`,\n        contentType: value.contentType,\n        isValid: response.data.isValid,\n        complianceScore: response.data.complianceScore || 0,\n        violations: response.data.violations || [],\n        recommendations: response.data.recommendations || [],\n        validatedAt: new Date(),\n      };\n\n      // Cache the result\n      this.validationCache.set(cacheKey, result);\n      setTimeout(() => this.validationCache.delete(cacheKey), this.cacheExpiry);\n\n      logger.info(\n        `Content validated for course ${value.courseId}: Score ${result.complianceScore}, Valid: ${result.isValid}`\n      );\n\n      return result;\n    } catch (error) {\n      logger.error('Error validating course content:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Validate assessment questions\n   */\n  async validateAssessmentQuestions(assessmentId: string): Promise<ContentValidationResult> {\n    try {\n      // Get assessment\n      const assessment = await prisma.assessment.findUnique({\n        where: { id: assessmentId },\n        include: { course: true },\n      });\n\n      if (!assessment) {\n        throw new Error('Assessment not found');\n      }\n\n      // Combine all questions into one content block\n      const questionsContent = assessment.questions.join('\\n');\n\n      // Validate questions\n      const response = await this.constitutionalAIClient.post(\n        '/api/constitutional-ai/validate',\n        {\n          content: questionsContent,\n          title: assessment.title,\n          contentType: 'assessment',\n          context: {\n            courseTitle: assessment.course.title,\n            assessmentTitle: assessment.title,\n            passingScore: assessment.passingScore,\n          },\n        }\n      );\n\n      const result: ContentValidationResult = {\n        contentId: assessmentId,\n        contentType: 'assessment',\n        isValid: response.data.isValid,\n        complianceScore: response.data.complianceScore || 0,\n        violations: response.data.violations || [],\n        recommendations: response.data.recommendations || [],\n        validatedAt: new Date(),\n      };\n\n      logger.info(\n        `Assessment questions validated: ${assessmentId}, Score: ${result.complianceScore}`\n      );\n\n      return result;\n    } catch (error) {\n      logger.error('Error validating assessment questions:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Validate teacher feedback\n   */\n  async validateTeacherFeedback(\n    enrollmentId: string,\n    feedback: string\n  ): Promise<ContentValidationResult> {\n    try {\n      // Get enrollment context\n      const enrollment = await prisma.enrollment.findUnique({\n        where: { id: enrollmentId },\n        include: { course: true, student: true },\n      });\n\n      if (!enrollment) {\n        throw new Error('Enrollment not found');\n      }\n\n      // Validate feedback\n      const response = await this.constitutionalAIClient.post(\n        '/api/constitutional-ai/validate',\n        {\n          content: feedback,\n          contentType: 'feedback',\n          context: {\n            courseTitle: enrollment.course.title,\n            studentName: enrollment.student.firstName,\n            enrollmentId,\n          },\n        }\n      );\n\n      const result: ContentValidationResult = {\n        contentId: `feedback-${enrollmentId}`,\n        contentType: 'feedback',\n        isValid: response.data.isValid,\n        complianceScore: response.data.complianceScore || 0,\n        violations: response.data.violations || [],\n        recommendations: response.data.recommendations || [],\n        validatedAt: new Date(),\n      };\n\n      logger.info(\n        `Teacher feedback validated for enrollment ${enrollmentId}, Score: ${result.complianceScore}`\n      );\n\n      return result;\n    } catch (error) {\n      logger.error('Error validating teacher feedback:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check for bias in content\n   */\n  async checkForBias(content: string): Promise<{\n    hasBias: boolean;\n    biasTypes: string[];\n    severity: string;\n    recommendations: string[];\n  }> {\n    try {\n      const response = await this.constitutionalAIClient.post(\n        '/api/constitutional-ai/check-bias',\n        {\n          content,\n        }\n      );\n\n      logger.info(`Bias check completed: ${response.data.hasBias ? 'Bias detected' : 'No bias'}`);\n\n      return {\n        hasBias: response.data.hasBias || false,\n        biasTypes: response.data.biasTypes || [],\n        severity: response.data.severity || 'none',\n        recommendations: response.data.recommendations || [],\n      };\n    } catch (error) {\n      logger.error('Error checking for bias:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check for accuracy issues\n   */\n  async checkForAccuracy(content: string, context?: any): Promise<{\n    isAccurate: boolean;\n    issues: string[];\n    confidence: number;\n    suggestions: string[];\n  }> {\n    try {\n      const response = await this.constitutionalAIClient.post(\n        '/api/constitutional-ai/check-accuracy',\n        {\n          content,\n          context,\n        }\n      );\n\n      logger.info(\n        `Accuracy check completed: ${response.data.isAccurate ? 'Accurate' : 'Issues found'}`\n      );\n\n      return {\n        isAccurate: response.data.isAccurate || false,\n        issues: response.data.issues || [],\n        confidence: response.data.confidence || 0,\n        suggestions: response.data.suggestions || [],\n      };\n    } catch (error) {\n      logger.error('Error checking for accuracy:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check for clarity issues\n   */\n  async checkForClarity(content: string): Promise<{\n    isClarity: boolean;\n    readabilityScore: number;\n    issues: string[];\n    suggestions: string[];\n  }> {\n    try {\n      const response = await this.constitutionalAIClient.post(\n        '/api/constitutional-ai/check-clarity',\n        {\n          content,\n        }\n      );\n\n      logger.info(`Clarity check completed: Readability score ${response.data.readabilityScore}`);\n\n      return {\n        isClarity: response.data.isClarity || true,\n        readabilityScore: response.data.readabilityScore || 0,\n        issues: response.data.issues || [],\n        suggestions: response.data.suggestions || [],\n      };\n    } catch (error) {\n      logger.error('Error checking for clarity:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check for safety issues\n   */\n  async checkForSafety(content: string): Promise<{\n    isSafe: boolean;\n    harmTypes: string[];\n    severity: string;\n    recommendations: string[];\n  }> {\n    try {\n      const response = await this.constitutionalAIClient.post(\n        '/api/constitutional-ai/check-safety',\n        {\n          content,\n        }\n      );\n\n      logger.info(`Safety check completed: ${response.data.isSafe ? 'Safe' : 'Unsafe content'}`);\n\n      return {\n        isSafe: response.data.isSafe || true,\n        harmTypes: response.data.harmTypes || [],\n        severity: response.data.severity || 'none',\n        recommendations: response.data.recommendations || [],\n      };\n    } catch (error) {\n      logger.error('Error checking for safety:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Generate cache key\n   */\n  private generateCacheKey(courseId: string, content: string): string {\n    const hash = content.substring(0, 50).replace(/\\s+/g, '-').toLowerCase();\n    return `validation-${courseId}-${hash}`;\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache(): void {\n    this.validationCache.clear();\n    logger.info('Content validation cache cleared');\n  }\n}\n\nexport const contentValidationService = new ContentValidationService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}