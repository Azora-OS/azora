{"version":3,"names":["cov_26j64d4f1h","actualCoverage","OpenAIClient","PersonalityEngine","constructor","client","f","s","b","generateResponse","persona","message","context","system","buildSystemPrompt","messages","role","content","chat","temperature","maxTokens","updateMood","interaction","next","intensity","sentiment","mood","consultFamily","topic","userId","personas","id","name","style","perspectives","p","summary","JSON","stringify","user","filter","Boolean","join"],"sources":["personality-engine.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\nCopyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nAI Family Service - Personality Engine\nGenerates personality-based responses using the shared OpenAI client.\n*/\n\nimport { OpenAIClient, ChatMessage } from '@azora/shared-ai';\n\nexport type Persona = {\n  id: string;\n  name: string;\n  role: 'mentor' | 'critic' | 'supporter' | 'strategist' | 'researcher';\n  style?: string; // extra stylistic guidance\n  mood?: 'calm' | 'enthusiastic' | 'curious' | 'serious' | 'empathetic';\n};\n\nexport class PersonalityEngine {\n  private client: OpenAIClient;\n\n  constructor(client?: OpenAIClient) {\n    this.client = client ?? new OpenAIClient();\n  }\n\n  async generateResponse(persona: Persona, message: string, context?: Record<string, any>): Promise<string> {\n    const system = this.buildSystemPrompt(persona, context);\n    const messages: ChatMessage[] = [\n      { role: 'system', content: system },\n      { role: 'user', content: message },\n    ];\n    return this.client.chat(messages, { temperature: 0.7, maxTokens: 700 });\n  }\n\n  async updateMood(persona: Persona, interaction: { sentiment?: 'positive' | 'neutral' | 'negative'; intensity?: number }): Promise<Persona> {\n    const next = { ...persona };\n    const intensity = interaction.intensity ?? 1;\n    if (interaction.sentiment === 'positive') {\n      next.mood = intensity > 1 ? 'enthusiastic' : 'calm';\n    } else if (interaction.sentiment === 'negative') {\n      next.mood = 'serious';\n    } else {\n      next.mood = next.mood || 'curious';\n    }\n    return next;\n  }\n\n  async consultFamily(topic: string, userId?: string): Promise<{ summary: string; perspectives: Record<string, string> }>{\n    // Minimal set of default personas for consultation\n    const personas: Persona[] = [\n      { id: 'mentor', name: 'Mentor', role: 'mentor', mood: 'empathetic', style: 'practical, kind' },\n      { id: 'critic', name: 'Critic', role: 'critic', mood: 'serious', style: 'risk-aware, precise' },\n      { id: 'strategist', name: 'Strategist', role: 'strategist', mood: 'calm', style: 'goal-oriented' },\n    ];\n\n    const perspectives: Record<string, string> = {};\n    for (const p of personas) {\n      perspectives[p.id] = await this.generateResponse(p, `Provide your perspective on: ${topic}`, { userId });\n    }\n\n    const summary = await this.client.chat([\n      { role: 'system', content: 'You synthesize multiple perspectives into a brief, actionable plan. Return a concise summary with 3-5 bullet points.' },\n      { role: 'user', content: JSON.stringify({ topic, perspectives }) },\n    ], { temperature: 0.4, maxTokens: 500 });\n\n    return { summary, perspectives };\n  }\n\n  private buildSystemPrompt(persona: Persona, context?: Record<string, any>): string {\n    const mood = persona.mood ? `Current mood: ${persona.mood}.` : '';\n    const style = persona.style ? `Style: ${persona.style}.` : '';\n    const user = context?.userId ? `Respond with respect for user ${context.userId}.` : '';\n    return [\n      `You are ${persona.name}, a ${persona.role} in the Azora AI Family.`,\n      'Stay consistent with your role and mood while being helpful and safe.',\n      mood,\n      style,\n      user,\n    ].filter(Boolean).join(' ');\n  }\n}\n\nexport default PersonalityEngine;\n"],"mappings":"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","ignoreList":[]}