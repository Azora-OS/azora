d740b22b2aea15f6b0a2f6973df8e65a
/* istanbul ignore next */
function cov_26j64d4f1h() {
  var path = "/workspaces/azora/services/ai-family-service/personality-engine.ts";
  var hash = "1426ae693a0f90f9ec7d7a0e19c2eafaa2e3cac7";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/ai-family-service/personality-engine.ts",
    statementMap: {
      "0": {
        start: {
          line: 23,
          column: 4
        },
        end: {
          line: 23,
          column: 47
        }
      },
      "1": {
        start: {
          line: 27,
          column: 19
        },
        end: {
          line: 27,
          column: 59
        }
      },
      "2": {
        start: {
          line: 28,
          column: 36
        },
        end: {
          line: 31,
          column: 5
        }
      },
      "3": {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 32,
          column: 76
        }
      },
      "4": {
        start: {
          line: 36,
          column: 17
        },
        end: {
          line: 36,
          column: 31
        }
      },
      "5": {
        start: {
          line: 37,
          column: 22
        },
        end: {
          line: 37,
          column: 48
        }
      },
      "6": {
        start: {
          line: 38,
          column: 4
        },
        end: {
          line: 44,
          column: 5
        }
      },
      "7": {
        start: {
          line: 39,
          column: 6
        },
        end: {
          line: 39,
          column: 58
        }
      },
      "8": {
        start: {
          line: 40,
          column: 11
        },
        end: {
          line: 44,
          column: 5
        }
      },
      "9": {
        start: {
          line: 41,
          column: 6
        },
        end: {
          line: 41,
          column: 28
        }
      },
      "10": {
        start: {
          line: 43,
          column: 6
        },
        end: {
          line: 43,
          column: 41
        }
      },
      "11": {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 45,
          column: 16
        }
      },
      "12": {
        start: {
          line: 50,
          column: 32
        },
        end: {
          line: 54,
          column: 5
        }
      },
      "13": {
        start: {
          line: 56,
          column: 49
        },
        end: {
          line: 56,
          column: 51
        }
      },
      "14": {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 59,
          column: 5
        }
      },
      "15": {
        start: {
          line: 58,
          column: 6
        },
        end: {
          line: 58,
          column: 111
        }
      },
      "16": {
        start: {
          line: 61,
          column: 20
        },
        end: {
          line: 64,
          column: 44
        }
      },
      "17": {
        start: {
          line: 66,
          column: 4
        },
        end: {
          line: 66,
          column: 37
        }
      },
      "18": {
        start: {
          line: 70,
          column: 17
        },
        end: {
          line: 70,
          column: 69
        }
      },
      "19": {
        start: {
          line: 71,
          column: 18
        },
        end: {
          line: 71,
          column: 65
        }
      },
      "20": {
        start: {
          line: 72,
          column: 17
        },
        end: {
          line: 72,
          column: 90
        }
      },
      "21": {
        start: {
          line: 73,
          column: 4
        },
        end: {
          line: 79,
          column: 32
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 22,
            column: 2
          },
          end: {
            line: 22,
            column: 3
          }
        },
        loc: {
          start: {
            line: 22,
            column: 37
          },
          end: {
            line: 24,
            column: 3
          }
        },
        line: 22
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 26,
            column: 2
          },
          end: {
            line: 26,
            column: 3
          }
        },
        loc: {
          start: {
            line: 26,
            column: 108
          },
          end: {
            line: 33,
            column: 3
          }
        },
        line: 26
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 35,
            column: 2
          },
          end: {
            line: 35,
            column: 3
          }
        },
        loc: {
          start: {
            line: 35,
            column: 141
          },
          end: {
            line: 46,
            column: 3
          }
        },
        line: 35
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 48,
            column: 2
          },
          end: {
            line: 48,
            column: 3
          }
        },
        loc: {
          start: {
            line: 48,
            column: 121
          },
          end: {
            line: 67,
            column: 3
          }
        },
        line: 48
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 69,
            column: 2
          },
          end: {
            line: 69,
            column: 3
          }
        },
        loc: {
          start: {
            line: 69,
            column: 85
          },
          end: {
            line: 80,
            column: 3
          }
        },
        line: 69
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 23,
            column: 18
          },
          end: {
            line: 23,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 23,
            column: 18
          },
          end: {
            line: 23,
            column: 24
          }
        }, {
          start: {
            line: 23,
            column: 28
          },
          end: {
            line: 23,
            column: 46
          }
        }],
        line: 23
      },
      "1": {
        loc: {
          start: {
            line: 37,
            column: 22
          },
          end: {
            line: 37,
            column: 48
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 37,
            column: 22
          },
          end: {
            line: 37,
            column: 43
          }
        }, {
          start: {
            line: 37,
            column: 47
          },
          end: {
            line: 37,
            column: 48
          }
        }],
        line: 37
      },
      "2": {
        loc: {
          start: {
            line: 38,
            column: 4
          },
          end: {
            line: 44,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 38,
            column: 4
          },
          end: {
            line: 44,
            column: 5
          }
        }, {
          start: {
            line: 40,
            column: 11
          },
          end: {
            line: 44,
            column: 5
          }
        }],
        line: 38
      },
      "3": {
        loc: {
          start: {
            line: 39,
            column: 18
          },
          end: {
            line: 39,
            column: 57
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 39,
            column: 34
          },
          end: {
            line: 39,
            column: 48
          }
        }, {
          start: {
            line: 39,
            column: 51
          },
          end: {
            line: 39,
            column: 57
          }
        }],
        line: 39
      },
      "4": {
        loc: {
          start: {
            line: 40,
            column: 11
          },
          end: {
            line: 44,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 40,
            column: 11
          },
          end: {
            line: 44,
            column: 5
          }
        }, {
          start: {
            line: 42,
            column: 11
          },
          end: {
            line: 44,
            column: 5
          }
        }],
        line: 40
      },
      "5": {
        loc: {
          start: {
            line: 43,
            column: 18
          },
          end: {
            line: 43,
            column: 40
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 43,
            column: 18
          },
          end: {
            line: 43,
            column: 27
          }
        }, {
          start: {
            line: 43,
            column: 31
          },
          end: {
            line: 43,
            column: 40
          }
        }],
        line: 43
      },
      "6": {
        loc: {
          start: {
            line: 70,
            column: 17
          },
          end: {
            line: 70,
            column: 69
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 70,
            column: 32
          },
          end: {
            line: 70,
            column: 64
          }
        }, {
          start: {
            line: 70,
            column: 67
          },
          end: {
            line: 70,
            column: 69
          }
        }],
        line: 70
      },
      "7": {
        loc: {
          start: {
            line: 71,
            column: 18
          },
          end: {
            line: 71,
            column: 65
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 71,
            column: 34
          },
          end: {
            line: 71,
            column: 60
          }
        }, {
          start: {
            line: 71,
            column: 63
          },
          end: {
            line: 71,
            column: 65
          }
        }],
        line: 71
      },
      "8": {
        loc: {
          start: {
            line: 72,
            column: 17
          },
          end: {
            line: 72,
            column: 90
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 72,
            column: 35
          },
          end: {
            line: 72,
            column: 85
          }
        }, {
          start: {
            line: 72,
            column: 88
          },
          end: {
            line: 72,
            column: 90
          }
        }],
        line: 72
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "1426ae693a0f90f9ec7d7a0e19c2eafaa2e3cac7"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_26j64d4f1h = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_26j64d4f1h();
/*
AZORA PROPRIETARY LICENSE
Copyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.

AI Family Service - Personality Engine
Generates personality-based responses using the shared OpenAI client.
*/

import { OpenAIClient } from '@azora/shared-ai';
export class PersonalityEngine {
  constructor(client) {
    /* istanbul ignore next */
    cov_26j64d4f1h().f[0]++;
    cov_26j64d4f1h().s[0]++;
    this.client =
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[0][0]++, client) ??
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[0][1]++, new OpenAIClient());
  }
  async generateResponse(persona, message, context) {
    /* istanbul ignore next */
    cov_26j64d4f1h().f[1]++;
    const system =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[1]++, this.buildSystemPrompt(persona, context));
    const messages =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[2]++, [{
      role: 'system',
      content: system
    }, {
      role: 'user',
      content: message
    }]);
    /* istanbul ignore next */
    cov_26j64d4f1h().s[3]++;
    return this.client.chat(messages, {
      temperature: 0.7,
      maxTokens: 700
    });
  }
  async updateMood(persona, interaction) {
    /* istanbul ignore next */
    cov_26j64d4f1h().f[2]++;
    const next =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[4]++, {
      ...persona
    });
    const intensity =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[5]++,
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[1][0]++, interaction.intensity) ??
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[1][1]++, 1));
    /* istanbul ignore next */
    cov_26j64d4f1h().s[6]++;
    if (interaction.sentiment === 'positive') {
      /* istanbul ignore next */
      cov_26j64d4f1h().b[2][0]++;
      cov_26j64d4f1h().s[7]++;
      next.mood = intensity > 1 ?
      /* istanbul ignore next */
      (cov_26j64d4f1h().b[3][0]++, 'enthusiastic') :
      /* istanbul ignore next */
      (cov_26j64d4f1h().b[3][1]++, 'calm');
    } else {
      /* istanbul ignore next */
      cov_26j64d4f1h().b[2][1]++;
      cov_26j64d4f1h().s[8]++;
      if (interaction.sentiment === 'negative') {
        /* istanbul ignore next */
        cov_26j64d4f1h().b[4][0]++;
        cov_26j64d4f1h().s[9]++;
        next.mood = 'serious';
      } else {
        /* istanbul ignore next */
        cov_26j64d4f1h().b[4][1]++;
        cov_26j64d4f1h().s[10]++;
        next.mood =
        /* istanbul ignore next */
        (cov_26j64d4f1h().b[5][0]++, next.mood) ||
        /* istanbul ignore next */
        (cov_26j64d4f1h().b[5][1]++, 'curious');
      }
    }
    /* istanbul ignore next */
    cov_26j64d4f1h().s[11]++;
    return next;
  }
  async consultFamily(topic, userId) {
    /* istanbul ignore next */
    cov_26j64d4f1h().f[3]++;
    // Minimal set of default personas for consultation
    const personas =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[12]++, [{
      id: 'mentor',
      name: 'Mentor',
      role: 'mentor',
      mood: 'empathetic',
      style: 'practical, kind'
    }, {
      id: 'critic',
      name: 'Critic',
      role: 'critic',
      mood: 'serious',
      style: 'risk-aware, precise'
    }, {
      id: 'strategist',
      name: 'Strategist',
      role: 'strategist',
      mood: 'calm',
      style: 'goal-oriented'
    }]);
    const perspectives =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[13]++, {});
    /* istanbul ignore next */
    cov_26j64d4f1h().s[14]++;
    for (const p of personas) {
      /* istanbul ignore next */
      cov_26j64d4f1h().s[15]++;
      perspectives[p.id] = await this.generateResponse(p, `Provide your perspective on: ${topic}`, {
        userId
      });
    }
    const summary =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[16]++, await this.client.chat([{
      role: 'system',
      content: 'You synthesize multiple perspectives into a brief, actionable plan. Return a concise summary with 3-5 bullet points.'
    }, {
      role: 'user',
      content: JSON.stringify({
        topic,
        perspectives
      })
    }], {
      temperature: 0.4,
      maxTokens: 500
    }));
    /* istanbul ignore next */
    cov_26j64d4f1h().s[17]++;
    return {
      summary,
      perspectives
    };
  }
  buildSystemPrompt(persona, context) {
    /* istanbul ignore next */
    cov_26j64d4f1h().f[4]++;
    const mood =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[18]++, persona.mood ?
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[6][0]++, `Current mood: ${persona.mood}.`) :
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[6][1]++, ''));
    const style =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[19]++, persona.style ?
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[7][0]++, `Style: ${persona.style}.`) :
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[7][1]++, ''));
    const user =
    /* istanbul ignore next */
    (cov_26j64d4f1h().s[20]++, context?.userId ?
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[8][0]++, `Respond with respect for user ${context.userId}.`) :
    /* istanbul ignore next */
    (cov_26j64d4f1h().b[8][1]++, ''));
    /* istanbul ignore next */
    cov_26j64d4f1h().s[21]++;
    return [`You are ${persona.name}, a ${persona.role} in the Azora AI Family.`, 'Stay consistent with your role and mood while being helpful and safe.', mood, style, user].filter(Boolean).join(' ');
  }
}
export default PersonalityEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjZqNjRkNGYxaCIsImFjdHVhbENvdmVyYWdlIiwiT3BlbkFJQ2xpZW50IiwiUGVyc29uYWxpdHlFbmdpbmUiLCJjb25zdHJ1Y3RvciIsImNsaWVudCIsImYiLCJzIiwiYiIsImdlbmVyYXRlUmVzcG9uc2UiLCJwZXJzb25hIiwibWVzc2FnZSIsImNvbnRleHQiLCJzeXN0ZW0iLCJidWlsZFN5c3RlbVByb21wdCIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJjaGF0IiwidGVtcGVyYXR1cmUiLCJtYXhUb2tlbnMiLCJ1cGRhdGVNb29kIiwiaW50ZXJhY3Rpb24iLCJuZXh0IiwiaW50ZW5zaXR5Iiwic2VudGltZW50IiwibW9vZCIsImNvbnN1bHRGYW1pbHkiLCJ0b3BpYyIsInVzZXJJZCIsInBlcnNvbmFzIiwiaWQiLCJuYW1lIiwic3R5bGUiLCJwZXJzcGVjdGl2ZXMiLCJwIiwic3VtbWFyeSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1c2VyIiwiZmlsdGVyIiwiQm9vbGVhbiIsImpvaW4iXSwic291cmNlcyI6WyJwZXJzb25hbGl0eS1lbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkFaT1JBIFBST1BSSUVUQVJZIExJQ0VOU0VcbkNvcHlyaWdodCDCqSAyMDI1IEF6b3JhIEVTIChQdHkpIEx0ZC4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cblxuQUkgRmFtaWx5IFNlcnZpY2UgLSBQZXJzb25hbGl0eSBFbmdpbmVcbkdlbmVyYXRlcyBwZXJzb25hbGl0eS1iYXNlZCByZXNwb25zZXMgdXNpbmcgdGhlIHNoYXJlZCBPcGVuQUkgY2xpZW50LlxuKi9cblxuaW1wb3J0IHsgT3BlbkFJQ2xpZW50LCBDaGF0TWVzc2FnZSB9IGZyb20gJ0Bhem9yYS9zaGFyZWQtYWknO1xuXG5leHBvcnQgdHlwZSBQZXJzb25hID0ge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHJvbGU6ICdtZW50b3InIHwgJ2NyaXRpYycgfCAnc3VwcG9ydGVyJyB8ICdzdHJhdGVnaXN0JyB8ICdyZXNlYXJjaGVyJztcbiAgc3R5bGU/OiBzdHJpbmc7IC8vIGV4dHJhIHN0eWxpc3RpYyBndWlkYW5jZVxuICBtb29kPzogJ2NhbG0nIHwgJ2VudGh1c2lhc3RpYycgfCAnY3VyaW91cycgfCAnc2VyaW91cycgfCAnZW1wYXRoZXRpYyc7XG59O1xuXG5leHBvcnQgY2xhc3MgUGVyc29uYWxpdHlFbmdpbmUge1xuICBwcml2YXRlIGNsaWVudDogT3BlbkFJQ2xpZW50O1xuXG4gIGNvbnN0cnVjdG9yKGNsaWVudD86IE9wZW5BSUNsaWVudCkge1xuICAgIHRoaXMuY2xpZW50ID0gY2xpZW50ID8/IG5ldyBPcGVuQUlDbGllbnQoKTtcbiAgfVxuXG4gIGFzeW5jIGdlbmVyYXRlUmVzcG9uc2UocGVyc29uYTogUGVyc29uYSwgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgYW55Pik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3Qgc3lzdGVtID0gdGhpcy5idWlsZFN5c3RlbVByb21wdChwZXJzb25hLCBjb250ZXh0KTtcbiAgICBjb25zdCBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtcbiAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbSB9LFxuICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IG1lc3NhZ2UgfSxcbiAgICBdO1xuICAgIHJldHVybiB0aGlzLmNsaWVudC5jaGF0KG1lc3NhZ2VzLCB7IHRlbXBlcmF0dXJlOiAwLjcsIG1heFRva2VuczogNzAwIH0pO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlTW9vZChwZXJzb25hOiBQZXJzb25hLCBpbnRlcmFjdGlvbjogeyBzZW50aW1lbnQ/OiAncG9zaXRpdmUnIHwgJ25ldXRyYWwnIHwgJ25lZ2F0aXZlJzsgaW50ZW5zaXR5PzogbnVtYmVyIH0pOiBQcm9taXNlPFBlcnNvbmE+IHtcbiAgICBjb25zdCBuZXh0ID0geyAuLi5wZXJzb25hIH07XG4gICAgY29uc3QgaW50ZW5zaXR5ID0gaW50ZXJhY3Rpb24uaW50ZW5zaXR5ID8/IDE7XG4gICAgaWYgKGludGVyYWN0aW9uLnNlbnRpbWVudCA9PT0gJ3Bvc2l0aXZlJykge1xuICAgICAgbmV4dC5tb29kID0gaW50ZW5zaXR5ID4gMSA/ICdlbnRodXNpYXN0aWMnIDogJ2NhbG0nO1xuICAgIH0gZWxzZSBpZiAoaW50ZXJhY3Rpb24uc2VudGltZW50ID09PSAnbmVnYXRpdmUnKSB7XG4gICAgICBuZXh0Lm1vb2QgPSAnc2VyaW91cyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHQubW9vZCA9IG5leHQubW9vZCB8fCAnY3VyaW91cyc7XG4gICAgfVxuICAgIHJldHVybiBuZXh0O1xuICB9XG5cbiAgYXN5bmMgY29uc3VsdEZhbWlseSh0b3BpYzogc3RyaW5nLCB1c2VySWQ/OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VtbWFyeTogc3RyaW5nOyBwZXJzcGVjdGl2ZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfT57XG4gICAgLy8gTWluaW1hbCBzZXQgb2YgZGVmYXVsdCBwZXJzb25hcyBmb3IgY29uc3VsdGF0aW9uXG4gICAgY29uc3QgcGVyc29uYXM6IFBlcnNvbmFbXSA9IFtcbiAgICAgIHsgaWQ6ICdtZW50b3InLCBuYW1lOiAnTWVudG9yJywgcm9sZTogJ21lbnRvcicsIG1vb2Q6ICdlbXBhdGhldGljJywgc3R5bGU6ICdwcmFjdGljYWwsIGtpbmQnIH0sXG4gICAgICB7IGlkOiAnY3JpdGljJywgbmFtZTogJ0NyaXRpYycsIHJvbGU6ICdjcml0aWMnLCBtb29kOiAnc2VyaW91cycsIHN0eWxlOiAncmlzay1hd2FyZSwgcHJlY2lzZScgfSxcbiAgICAgIHsgaWQ6ICdzdHJhdGVnaXN0JywgbmFtZTogJ1N0cmF0ZWdpc3QnLCByb2xlOiAnc3RyYXRlZ2lzdCcsIG1vb2Q6ICdjYWxtJywgc3R5bGU6ICdnb2FsLW9yaWVudGVkJyB9LFxuICAgIF07XG5cbiAgICBjb25zdCBwZXJzcGVjdGl2ZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICBmb3IgKGNvbnN0IHAgb2YgcGVyc29uYXMpIHtcbiAgICAgIHBlcnNwZWN0aXZlc1twLmlkXSA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVSZXNwb25zZShwLCBgUHJvdmlkZSB5b3VyIHBlcnNwZWN0aXZlIG9uOiAke3RvcGljfWAsIHsgdXNlcklkIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHN1bW1hcnkgPSBhd2FpdCB0aGlzLmNsaWVudC5jaGF0KFtcbiAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6ICdZb3Ugc3ludGhlc2l6ZSBtdWx0aXBsZSBwZXJzcGVjdGl2ZXMgaW50byBhIGJyaWVmLCBhY3Rpb25hYmxlIHBsYW4uIFJldHVybiBhIGNvbmNpc2Ugc3VtbWFyeSB3aXRoIDMtNSBidWxsZXQgcG9pbnRzLicgfSxcbiAgICAgIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBKU09OLnN0cmluZ2lmeSh7IHRvcGljLCBwZXJzcGVjdGl2ZXMgfSkgfSxcbiAgICBdLCB7IHRlbXBlcmF0dXJlOiAwLjQsIG1heFRva2VuczogNTAwIH0pO1xuXG4gICAgcmV0dXJuIHsgc3VtbWFyeSwgcGVyc3BlY3RpdmVzIH07XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkU3lzdGVtUHJvbXB0KHBlcnNvbmE6IFBlcnNvbmEsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogc3RyaW5nIHtcbiAgICBjb25zdCBtb29kID0gcGVyc29uYS5tb29kID8gYEN1cnJlbnQgbW9vZDogJHtwZXJzb25hLm1vb2R9LmAgOiAnJztcbiAgICBjb25zdCBzdHlsZSA9IHBlcnNvbmEuc3R5bGUgPyBgU3R5bGU6ICR7cGVyc29uYS5zdHlsZX0uYCA6ICcnO1xuICAgIGNvbnN0IHVzZXIgPSBjb250ZXh0Py51c2VySWQgPyBgUmVzcG9uZCB3aXRoIHJlc3BlY3QgZm9yIHVzZXIgJHtjb250ZXh0LnVzZXJJZH0uYCA6ICcnO1xuICAgIHJldHVybiBbXG4gICAgICBgWW91IGFyZSAke3BlcnNvbmEubmFtZX0sIGEgJHtwZXJzb25hLnJvbGV9IGluIHRoZSBBem9yYSBBSSBGYW1pbHkuYCxcbiAgICAgICdTdGF5IGNvbnNpc3RlbnQgd2l0aCB5b3VyIHJvbGUgYW5kIG1vb2Qgd2hpbGUgYmVpbmcgaGVscGZ1bCBhbmQgc2FmZS4nLFxuICAgICAgbW9vZCxcbiAgICAgIHN0eWxlLFxuICAgICAgdXNlcixcbiAgICBdLmZpbHRlcihCb29sZWFuKS5qb2luKCcgJyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGVyc29uYWxpdHlFbmdpbmU7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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