{"version":3,"names":["cov_l20zjdeao","actualCoverage","v4","uuidv4","s","require","DistributedTracing","constructor","f","traces","Map","spans","startTrace","operationName","parentTraceId","b","traceId","trace","startTime","Date","now","status","set","startSpan","spanName","tags","spanId","span","logs","get","push","finishSpan","endTime","duration","Object","assign","addLog","message","level","timestamp","getTrace","map","middleware","req","res","next","headers","method","path","url","setHeader","on","statusCode","module","exports"],"sources":["distributed-tracing.js"],"sourcesContent":["// Task 11: Distributed Tracing Implementation\nconst { v4: uuidv4 } = require('uuid');\n\nclass DistributedTracing {\n  constructor() {\n    this.traces = new Map();\n    this.spans = new Map();\n  }\n\n  startTrace(operationName, parentTraceId = null) {\n    const traceId = uuidv4();\n    const trace = {\n      traceId,\n      parentTraceId,\n      operationName,\n      startTime: Date.now(),\n      spans: [],\n      status: 'active'\n    };\n    \n    this.traces.set(traceId, trace);\n    return traceId;\n  }\n\n  startSpan(traceId, spanName, tags = {}) {\n    const spanId = uuidv4();\n    const span = {\n      spanId,\n      traceId,\n      spanName,\n      startTime: Date.now(),\n      tags,\n      logs: [],\n      status: 'active'\n    };\n    \n    this.spans.set(spanId, span);\n    \n    const trace = this.traces.get(traceId);\n    if (trace) {\n      trace.spans.push(spanId);\n    }\n    \n    return spanId;\n  }\n\n  finishSpan(spanId, tags = {}) {\n    const span = this.spans.get(spanId);\n    if (span) {\n      span.endTime = Date.now();\n      span.duration = span.endTime - span.startTime;\n      span.status = 'finished';\n      Object.assign(span.tags, tags);\n    }\n  }\n\n  addLog(spanId, message, level = 'info') {\n    const span = this.spans.get(spanId);\n    if (span) {\n      span.logs.push({\n        timestamp: Date.now(),\n        level,\n        message\n      });\n    }\n  }\n\n  getTrace(traceId) {\n    const trace = this.traces.get(traceId);\n    if (!trace) {return null;}\n    \n    const spans = trace.spans.map(spanId => this.spans.get(spanId));\n    return { ...trace, spans };\n  }\n\n  middleware() {\n    return (req, res, next) => {\n      const traceId = req.headers['x-trace-id'] || this.startTrace(`${req.method} ${req.path}`);\n      const spanId = this.startSpan(traceId, `HTTP ${req.method}`, {\n        'http.method': req.method,\n        'http.url': req.url,\n        'http.user_agent': req.headers['user-agent']\n      });\n      \n      req.traceId = traceId;\n      req.spanId = spanId;\n      res.setHeader('x-trace-id', traceId);\n      \n      res.on('finish', () => {\n        this.finishSpan(spanId, {\n          'http.status_code': res.statusCode,\n          'http.response_size': res.get('content-length') || 0\n        });\n      });\n      \n      next();\n    };\n  }\n}\n\nmodule.exports = DistributedTracing;"],"mappings":"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","ignoreList":[]}