{"version":3,"names":["cov_2gif30vk2e","actualCoverage","prisma","logger","Joi","enrollmentSchema","s","object","studentId","string","required","courseId","tier","valid","EnrollmentService","enrollStudent","data","f","error","value","validate","b","Error","message","existing","enrollment","findFirst","where","course","findUnique","id","tierHierarchy","free","premium","pro","create","status","info","getEnrollment","enrollmentId","getStudentEnrollments","enrollments","findMany","updateProgress","progress","update","completeEnrollment","completionDate","Date","dropEnrollment","enrollmentService"],"sources":["enrollment.service.ts"],"sourcesContent":["import { prisma } from '../index';\nimport { Enrollment } from '../types';\nimport { logger } from '../utils/logger';\nimport Joi from 'joi';\n\nconst enrollmentSchema = Joi.object({\n  studentId: Joi.string().required(),\n  courseId: Joi.string().required(),\n  tier: Joi.string().valid('free', 'premium', 'pro').required(),\n});\n\nexport class EnrollmentService {\n  async enrollStudent(data: any): Promise<Enrollment> {\n    try {\n      const { error, value } = enrollmentSchema.validate(data);\n      if (error) {\n        throw new Error(`Validation error: ${error.message}`);\n      }\n\n      // Check if student already enrolled\n      const existing = await prisma.enrollment.findFirst({\n        where: {\n          studentId: value.studentId,\n          courseId: value.courseId,\n        },\n      });\n\n      if (existing) {\n        throw new Error('Student already enrolled in this course');\n      }\n\n      // Check tier access\n      const course = await prisma.course.findUnique({\n        where: { id: value.courseId },\n      });\n\n      if (!course) {\n        throw new Error('Course not found');\n      }\n\n      // Verify student tier has access to course tier\n      const tierHierarchy = { free: 0, premium: 1, pro: 2 };\n      if (tierHierarchy[value.tier as keyof typeof tierHierarchy] < tierHierarchy[course.tier as keyof typeof tierHierarchy]) {\n        throw new Error('Student tier does not have access to this course');\n      }\n\n      const enrollment = await prisma.enrollment.create({\n        data: {\n          studentId: value.studentId,\n          courseId: value.courseId,\n          tier: value.tier,\n          status: 'active',\n        },\n      });\n\n      logger.info(`Student enrolled: ${value.studentId} in course ${value.courseId}`);\n      return enrollment as Enrollment;\n    } catch (error) {\n      logger.error('Error enrolling student:', error);\n      throw error;\n    }\n  }\n\n  async getEnrollment(enrollmentId: string): Promise<Enrollment | null> {\n    try {\n      const enrollment = await prisma.enrollment.findUnique({\n        where: { id: enrollmentId },\n      });\n\n      return enrollment as Enrollment | null;\n    } catch (error) {\n      logger.error('Error getting enrollment:', error);\n      throw error;\n    }\n  }\n\n  async getStudentEnrollments(studentId: string): Promise<Enrollment[]> {\n    try {\n      const enrollments = await prisma.enrollment.findMany({\n        where: { studentId },\n      });\n\n      return enrollments as Enrollment[];\n    } catch (error) {\n      logger.error('Error getting student enrollments:', error);\n      throw error;\n    }\n  }\n\n  async updateProgress(enrollmentId: string, progress: number): Promise<Enrollment> {\n    try {\n      if (progress < 0 || progress > 100) {\n        throw new Error('Progress must be between 0 and 100');\n      }\n\n      const enrollment = await prisma.enrollment.update({\n        where: { id: enrollmentId },\n        data: { progress },\n      });\n\n      logger.info(`Progress updated for enrollment ${enrollmentId}: ${progress}%`);\n      return enrollment as Enrollment;\n    } catch (error) {\n      logger.error('Error updating progress:', error);\n      throw error;\n    }\n  }\n\n  async completeEnrollment(enrollmentId: string): Promise<Enrollment> {\n    try {\n      const enrollment = await prisma.enrollment.update({\n        where: { id: enrollmentId },\n        data: {\n          status: 'completed',\n          progress: 100,\n          completionDate: new Date(),\n        },\n      });\n\n      logger.info(`Enrollment completed: ${enrollmentId}`);\n      return enrollment as Enrollment;\n    } catch (error) {\n      logger.error('Error completing enrollment:', error);\n      throw error;\n    }\n  }\n\n  async dropEnrollment(enrollmentId: string): Promise<Enrollment> {\n    try {\n      const enrollment = await prisma.enrollment.update({\n        where: { id: enrollmentId },\n        data: { status: 'dropped' },\n      });\n\n      logger.info(`Enrollment dropped: ${enrollmentId}`);\n      return enrollment as Enrollment;\n    } catch (error) {\n      logger.error('Error dropping enrollment:', error);\n      throw error;\n    }\n  }\n}\n\nexport const enrollmentService = new EnrollmentService();\n"],"mappings":"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","ignoreList":[]}