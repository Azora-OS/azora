{"version":3,"names":["cov_175wcwatl7","actualCoverage","axios","s","require","MONITORING_URL","b","process","env","metricsMiddleware","serviceName","f","req","res","next","start","Date","now","on","duration","post","method","route","path","status","statusCode","timeout","error","reportHealth","reportActiveUsers","count","module","exports"],"sources":["metrics-middleware.js"],"sourcesContent":["const axios = require('axios');\n\nconst MONITORING_URL = process.env.MONITORING_URL || 'http://localhost:9090';\n\n// Middleware to track HTTP metrics\nfunction metricsMiddleware(serviceName) {\n  return (req, res, next) => {\n    const start = Date.now();\n    \n    res.on('finish', async () => {\n      const duration = (Date.now() - start) / 1000;\n      \n      try {\n        await axios.post(`${MONITORING_URL}/api/metrics/http`, {\n          method: req.method,\n          route: req.route?.path || req.path,\n          status: res.statusCode,\n          duration\n        }, { timeout: 1000 });\n      } catch (error) {\n        // Silent fail - don't break app if monitoring is down\n      }\n    });\n    \n    next();\n  };\n}\n\n// Report service health\nasync function reportHealth(serviceName, status = 'healthy') {\n  try {\n    await axios.post(`${MONITORING_URL}/api/health/${serviceName}`, \n      { status },\n      { timeout: 1000 }\n    );\n  } catch (error) {\n    // Silent fail\n  }\n}\n\n// Report active users\nasync function reportActiveUsers(count) {\n  try {\n    await axios.post(`${MONITORING_URL}/api/metrics/users`,\n      { count },\n      { timeout: 1000 }\n    );\n  } catch (error) {\n    // Silent fail\n  }\n}\n\nmodule.exports = {\n  metricsMiddleware,\n  reportHealth,\n  reportActiveUsers\n};\n"],"mappings":"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","ignoreList":[]}