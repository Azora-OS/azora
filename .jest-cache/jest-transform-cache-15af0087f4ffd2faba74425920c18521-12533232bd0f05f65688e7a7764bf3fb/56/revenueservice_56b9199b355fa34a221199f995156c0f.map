{"version":3,"names":["cov_79i1wt8v5","actualCoverage","prisma","logger","RevenueService","pricingTiers","s","Map","id","name","monthlyPrice","studentDiscount","features","description","tier","limits","coursesPerMonth","aiQueriesPerMonth","storageGB","supportLevel","getPricingTier","tierName","f","b","get","getAllPricingTiers","Array","from","values","calculatePrice","isStudent","pricingTier","Error","discount","trackConversionEvent","studentId","eventType","triggerValue","event","conversionEvent","create","data","info","shouldTriggerOffer","createConversionOffer","error","triggers","eventId","expiresAt","Date","setDate","getDate","offer","conversionOffer","offerType","acceptConversionOffer","offerId","update","where","accepted","acceptedAt","processPayment","courseId","amount","period","toISOString","slice","payment","status","Number","getRevenueByPeriod","result","aggregate","_sum","getConversionMetrics","freeUsers","user","count","premiumUsers","proUsers","totalUsers","conversionRate","Math","round","revenueService"],"sources":["revenue.service.ts"],"sourcesContent":["import { prisma } from '../index';\nimport { PricingTier, ConversionOffer, Payment } from '../types';\nimport { logger } from '../utils/logger';\n\nexport class RevenueService {\n  private pricingTiers: Map<string, PricingTier> = new Map([\n    ['free', {\n      id: 'tier-free',\n      name: 'free',\n      monthlyPrice: 0,\n      studentDiscount: 0,\n      features: [\n        { id: 'f1', name: 'Courses', description: '3 foundational courses', tier: 'free' },\n        { id: 'f2', name: 'AI Queries', description: '10 per month', tier: 'free' },\n        { id: 'f3', name: 'Storage', description: '1GB', tier: 'free' },\n      ],\n      limits: {\n        coursesPerMonth: 3,\n        aiQueriesPerMonth: 10,\n        storageGB: 1,\n        supportLevel: 'community',\n      },\n    }],\n    ['premium', {\n      id: 'tier-premium',\n      name: 'premium',\n      monthlyPrice: 10,\n      studentDiscount: 50,\n      features: [\n        { id: 'f1', name: 'Courses', description: 'Unlimited', tier: 'premium' },\n        { id: 'f2', name: 'AI Queries', description: 'Unlimited', tier: 'premium' },\n        { id: 'f3', name: 'Storage', description: '10GB', tier: 'premium' },\n        { id: 'f4', name: 'Certificates', description: 'Included', tier: 'premium' },\n      ],\n      limits: {\n        coursesPerMonth: 999,\n        aiQueriesPerMonth: 999,\n        storageGB: 10,\n        supportLevel: 'priority',\n      },\n    }],\n    ['pro', {\n      id: 'tier-pro',\n      name: 'pro',\n      monthlyPrice: 30,\n      studentDiscount: 30,\n      features: [\n        { id: 'f1', name: 'Courses', description: 'Unlimited', tier: 'pro' },\n        { id: 'f2', name: 'AI Queries', description: 'Unlimited', tier: 'pro' },\n        { id: 'f3', name: 'Storage', description: '100GB', tier: 'pro' },\n        { id: 'f4', name: 'Certificates', description: 'Included', tier: 'pro' },\n        { id: 'f5', name: 'API Access', description: 'Included', tier: 'pro' },\n      ],\n      limits: {\n        coursesPerMonth: 999,\n        aiQueriesPerMonth: 999,\n        storageGB: 100,\n        supportLevel: 'dedicated',\n      },\n    }],\n  ]);\n\n  async getPricingTier(tierName: string): Promise<PricingTier | null> {\n    return this.pricingTiers.get(tierName) || null;\n  }\n\n  async getAllPricingTiers(): Promise<PricingTier[]> {\n    return Array.from(this.pricingTiers.values());\n  }\n\n  async calculatePrice(tier: string, isStudent: boolean): Promise<number> {\n    const pricingTier = this.pricingTiers.get(tier);\n    if (!pricingTier) {\n      throw new Error(`Pricing tier not found: ${tier}`);\n    }\n\n    if (isStudent && tier !== 'free') {\n      const discount = pricingTier.studentDiscount;\n      return pricingTier.monthlyPrice * (1 - discount / 100);\n    }\n\n    return pricingTier.monthlyPrice;\n  }\n\n  async trackConversionEvent(\n    studentId: string,\n    eventType: string,\n    triggerValue: number\n  ): Promise<ConversionOffer | null> {\n    try {\n      // Create conversion event\n      const event = await prisma.conversionEvent.create({\n        data: {\n          studentId,\n          eventType,\n          triggerValue,\n        },\n      });\n\n      logger.info(`Conversion event tracked: ${studentId} - ${eventType}`);\n\n      // Check if conversion offer should be triggered\n      if (this.shouldTriggerOffer(eventType, triggerValue)) {\n        return await this.createConversionOffer(studentId, event.id);\n      }\n\n      return null;\n    } catch (error) {\n      logger.error('Error tracking conversion event:', error);\n      throw error;\n    }\n  }\n\n  private shouldTriggerOffer(eventType: string, triggerValue: number): boolean {\n    const triggers: Record<string, number> = {\n      'module_completion': 40,\n      'assessment_pass': 70,\n      'course_completion': 100,\n    };\n\n    return triggerValue >= (triggers[eventType] || 100);\n  }\n\n  private async createConversionOffer(\n    studentId: string,\n    eventId: string\n  ): Promise<ConversionOffer> {\n    const expiresAt = new Date();\n    expiresAt.setDate(expiresAt.getDate() + 7); // 7-day expiry\n\n    const offer = await prisma.conversionOffer.create({\n      data: {\n        eventId,\n        studentId,\n        offerType: 'upgrade_discount',\n        discount: 50,\n        expiresAt,\n      },\n    });\n\n    logger.info(`Conversion offer created: ${studentId}`);\n    return offer as ConversionOffer;\n  }\n\n  async acceptConversionOffer(offerId: string): Promise<ConversionOffer> {\n    try {\n      const offer = await prisma.conversionOffer.update({\n        where: { id: offerId },\n        data: {\n          accepted: true,\n          acceptedAt: new Date(),\n        },\n      });\n\n      logger.info(`Conversion offer accepted: ${offerId}`);\n      return offer as ConversionOffer;\n    } catch (error) {\n      logger.error('Error accepting conversion offer:', error);\n      throw error;\n    }\n  }\n\n  async processPayment(\n    studentId: string,\n    courseId: string,\n    tier: string,\n    amount: number\n  ): Promise<Payment> {\n    try {\n      const period = new Date().toISOString().slice(0, 7); // YYYY-MM\n\n      const payment = await prisma.payment.create({\n        data: {\n          studentId,\n          courseId,\n          amount,\n          tier,\n          period,\n          status: 'completed',\n        },\n      });\n\n      logger.info(`Payment processed: ${studentId} - ${courseId} - $${amount}`);\n      return {\n        ...payment,\n        amount: typeof payment.amount === 'number' ? payment.amount : Number(payment.amount),\n      } as unknown as Payment;\n    } catch (error) {\n      logger.error('Error processing payment:', error);\n      throw error;\n    }\n  }\n\n  async getRevenueByPeriod(period: string): Promise<number> {\n    try {\n      const result = await prisma.payment.aggregate({\n        where: { period, status: 'completed' },\n        _sum: { amount: true },\n      });\n\n      return result._sum.amount ? Number(result._sum.amount) : 0;\n    } catch (error) {\n      logger.error('Error getting revenue by period:', error);\n      throw error;\n    }\n  }\n\n  async getConversionMetrics(period: string): Promise<any> {\n    try {\n      const freeUsers = await prisma.user.count({\n        where: { tier: 'free' },\n      });\n\n      const premiumUsers = await prisma.user.count({\n        where: { tier: 'premium' },\n      });\n\n      const proUsers = await prisma.user.count({\n        where: { tier: 'pro' },\n      });\n\n      const totalUsers = freeUsers + premiumUsers + proUsers;\n      const conversionRate = totalUsers > 0 ? ((premiumUsers + proUsers) / totalUsers) * 100 : 0;\n\n      return {\n        period,\n        freeUsers,\n        premiumUsers,\n        proUsers,\n        totalUsers,\n        conversionRate: Math.round(conversionRate * 100) / 100,\n      };\n    } catch (error) {\n      logger.error('Error getting conversion metrics:', error);\n      throw error;\n    }\n  }\n}\n\nexport const revenueService = new RevenueService();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,aAAA,YAAAA,CAAA;MAAA,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","ignoreList":[]}