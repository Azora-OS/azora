c2e51733806e2a8cadd2447257ed6372
/* istanbul ignore next */
function cov_rqkxgdyju() {
  var path = "/workspaces/azora/services/proof-of-value/src/mining-engine.ts";
  var hash = "5e6d9538e5a146643fbfa213595f1c85153efd71";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/workspaces/azora/services/proof-of-value/src/mining-engine.ts",
    statementMap: {
      "0": {
        start: {
          line: 4,
          column: 41
        },
        end: {
          line: 4,
          column: 54
        }
      },
      "1": {
        start: {
          line: 5,
          column: 62
        },
        end: {
          line: 5,
          column: 71
        }
      },
      "2": {
        start: {
          line: 6,
          column: 40
        },
        end: {
          line: 6,
          column: 44
        }
      },
      "3": {
        start: {
          line: 8,
          column: 36
        },
        end: {
          line: 8,
          column: 37
        }
      },
      "4": {
        start: {
          line: 9,
          column: 56
        },
        end: {
          line: 9,
          column: 65
        }
      },
      "5": {
        start: {
          line: 20,
          column: 25
        },
        end: {
          line: 20,
          column: 26
        }
      },
      "6": {
        start: {
          line: 21,
          column: 8
        },
        end: {
          line: 26,
          column: 9
        }
      },
      "7": {
        start: {
          line: 22,
          column: 34
        },
        end: {
          line: 22,
          column: 50
        }
      },
      "8": {
        start: {
          line: 22,
          column: 51
        },
        end: {
          line: 22,
          column: 57
        }
      },
      "9": {
        start: {
          line: 23,
          column: 32
        },
        end: {
          line: 23,
          column: 48
        }
      },
      "10": {
        start: {
          line: 23,
          column: 49
        },
        end: {
          line: 23,
          column: 55
        }
      },
      "11": {
        start: {
          line: 24,
          column: 31
        },
        end: {
          line: 24,
          column: 46
        }
      },
      "12": {
        start: {
          line: 24,
          column: 47
        },
        end: {
          line: 24,
          column: 53
        }
      },
      "13": {
        start: {
          line: 25,
          column: 21
        },
        end: {
          line: 25,
          column: 36
        }
      },
      "14": {
        start: {
          line: 27,
          column: 8
        },
        end: {
          line: 27,
          column: 47
        }
      },
      "15": {
        start: {
          line: 36,
          column: 8
        },
        end: {
          line: 36,
          column: 47
        }
      },
      "16": {
        start: {
          line: 46,
          column: 34
        },
        end: {
          line: 46,
          column: 81
        }
      },
      "17": {
        start: {
          line: 47,
          column: 8
        },
        end: {
          line: 50,
          column: 9
        }
      },
      "18": {
        start: {
          line: 48,
          column: 12
        },
        end: {
          line: 48,
          column: 98
        }
      },
      "19": {
        start: {
          line: 49,
          column: 12
        },
        end: {
          line: 49,
          column: 25
        }
      },
      "20": {
        start: {
          line: 51,
          column: 8
        },
        end: {
          line: 51,
          column: 79
        }
      },
      "21": {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 52,
          column: 37
        }
      },
      "22": {
        start: {
          line: 53,
          column: 8
        },
        end: {
          line: 53,
          column: 118
        }
      },
      "23": {
        start: {
          line: 54,
          column: 8
        },
        end: {
          line: 54,
          column: 20
        }
      },
      "24": {
        start: {
          line: 63,
          column: 8
        },
        end: {
          line: 65,
          column: 9
        }
      },
      "25": {
        start: {
          line: 64,
          column: 12
        },
        end: {
          line: 64,
          column: 51
        }
      },
      "26": {
        start: {
          line: 69,
          column: 8
        },
        end: {
          line: 69,
          column: 37
        }
      },
      "27": {
        start: {
          line: 70,
          column: 8
        },
        end: {
          line: 70,
          column: 96
        }
      },
      "28": {
        start: {
          line: 71,
          column: 8
        },
        end: {
          line: 71,
          column: 22
        }
      },
      "29": {
        start: {
          line: 75,
          column: 8
        },
        end: {
          line: 75,
          column: 34
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 11,
            column: 4
          },
          end: {
            line: 11,
            column: 5
          }
        },
        loc: {
          start: {
            line: 11,
            column: 18
          },
          end: {
            line: 11,
            column: 21
          }
        },
        line: 11
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        loc: {
          start: {
            line: 19,
            column: 68
          },
          end: {
            line: 28,
            column: 5
          }
        },
        line: 19
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 35,
            column: 5
          }
        },
        loc: {
          start: {
            line: 35,
            column: 48
          },
          end: {
            line: 37,
            column: 5
          }
        },
        line: 35
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 45,
            column: 4
          },
          end: {
            line: 45,
            column: 5
          }
        },
        loc: {
          start: {
            line: 45,
            column: 70
          },
          end: {
            line: 55,
            column: 5
          }
        },
        line: 45
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 62,
            column: 4
          },
          end: {
            line: 62,
            column: 5
          }
        },
        loc: {
          start: {
            line: 62,
            column: 48
          },
          end: {
            line: 72,
            column: 5
          }
        },
        line: 62
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 74,
            column: 4
          },
          end: {
            line: 74,
            column: 5
          }
        },
        loc: {
          start: {
            line: 74,
            column: 31
          },
          end: {
            line: 76,
            column: 5
          }
        },
        line: 74
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 21,
            column: 8
          },
          end: {
            line: 26,
            column: 9
          }
        },
        type: "switch",
        locations: [{
          start: {
            line: 22,
            column: 12
          },
          end: {
            line: 22,
            column: 57
          }
        }, {
          start: {
            line: 23,
            column: 12
          },
          end: {
            line: 23,
            column: 55
          }
        }, {
          start: {
            line: 24,
            column: 12
          },
          end: {
            line: 24,
            column: 53
          }
        }, {
          start: {
            line: 25,
            column: 12
          },
          end: {
            line: 25,
            column: 36
          }
        }],
        line: 21
      },
      "1": {
        loc: {
          start: {
            line: 46,
            column: 34
          },
          end: {
            line: 46,
            column: 81
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 46,
            column: 34
          },
          end: {
            line: 46,
            column: 76
          }
        }, {
          start: {
            line: 46,
            column: 80
          },
          end: {
            line: 46,
            column: 81
          }
        }],
        line: 46
      },
      "2": {
        loc: {
          start: {
            line: 47,
            column: 8
          },
          end: {
            line: 50,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 47,
            column: 8
          },
          end: {
            line: 50,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 47
      },
      "3": {
        loc: {
          start: {
            line: 63,
            column: 8
          },
          end: {
            line: 65,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 63,
            column: 8
          },
          end: {
            line: 65,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 63
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0
    },
    b: {
      "0": [0, 0, 0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "5e6d9538e5a146643fbfa213595f1c85153efd71"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_rqkxgdyju = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_rqkxgdyju();
export class MiningEngine {
  static MAX_SUPPLY =
  /* istanbul ignore next */
  (cov_rqkxgdyju().s[0]++, 1_000_000_000); // 1 Billion AZR
  static SOVEREIGN_ALLOCATION_PER_NATION =
  /* istanbul ignore next */
  (cov_rqkxgdyju().s[1]++, 1_000_000); // 1 Million AZR
  static BURN_RATE =
  /* istanbul ignore next */
  (cov_rqkxgdyju().s[2]++, 0.01); // 1% burn on transactions/minting

  currentSupply =
  /* istanbul ignore next */
  (cov_rqkxgdyju().s[3]++, 0);
  sovereignAllocations =
  /* istanbul ignore next */
  (cov_rqkxgdyju().s[4]++, new Map()); // Country Code -> Amount

  constructor() {
    /* istanbul ignore next */
    cov_rqkxgdyju().f[0]++;
  }

  /**
   * Calculates the reward for a specific action based on value created.
   * @param actionType The type of action (e.g., 'create_course', 'code_commit').
   * @param valueScore A score representing the value of the action (0-100).
   * @returns The calculated AZR reward.
   */
  calculateReward(actionType, valueScore) {
    /* istanbul ignore next */
    cov_rqkxgdyju().f[1]++;
    let baseReward =
    /* istanbul ignore next */
    (cov_rqkxgdyju().s[5]++, 0);
    /* istanbul ignore next */
    cov_rqkxgdyju().s[6]++;
    switch (actionType) {
      case 'create_course':
        /* istanbul ignore next */
        cov_rqkxgdyju().b[0][0]++;
        cov_rqkxgdyju().s[7]++;
        baseReward = 50;
        /* istanbul ignore next */
        cov_rqkxgdyju().s[8]++;
        break;
      case 'code_commit':
        /* istanbul ignore next */
        cov_rqkxgdyju().b[0][1]++;
        cov_rqkxgdyju().s[9]++;
        baseReward = 10;
        /* istanbul ignore next */
        cov_rqkxgdyju().s[10]++;
        break;
      case 'create_nft':
        /* istanbul ignore next */
        cov_rqkxgdyju().b[0][2]++;
        cov_rqkxgdyju().s[11]++;
        baseReward = 5;
        /* istanbul ignore next */
        cov_rqkxgdyju().s[12]++;
        break;
      default:
        /* istanbul ignore next */
        cov_rqkxgdyju().b[0][3]++;
        cov_rqkxgdyju().s[13]++;
        baseReward = 1;
    }
    /* istanbul ignore next */
    cov_rqkxgdyju().s[14]++;
    return baseReward * (valueScore / 100);
  }

  /**
   * Applies deflationary logic by calculating the burn amount.
   * @param amount The transaction or reward amount.
   * @returns The amount to be burned.
   */
  calculateBurnAmount(amount) {
    /* istanbul ignore next */
    cov_rqkxgdyju().f[2]++;
    cov_rqkxgdyju().s[15]++;
    return amount * MiningEngine.BURN_RATE;
  }

  /**
   * Tracks the allocation of AZR to a sovereign nation.
   * @param countryCode ISO country code (e.g., 'ZA', 'US').
   * @param amount Amount to allocate.
   * @returns True if allocation is successful, False if it exceeds the limit.
   */
  allocateToSovereign(countryCode, amount) {
    /* istanbul ignore next */
    cov_rqkxgdyju().f[3]++;
    const currentAllocation =
    /* istanbul ignore next */
    (cov_rqkxgdyju().s[16]++,
    /* istanbul ignore next */
    (cov_rqkxgdyju().b[1][0]++, this.sovereignAllocations.get(countryCode)) ||
    /* istanbul ignore next */
    (cov_rqkxgdyju().b[1][1]++, 0));
    /* istanbul ignore next */
    cov_rqkxgdyju().s[17]++;
    if (currentAllocation + amount > MiningEngine.SOVEREIGN_ALLOCATION_PER_NATION) {
      /* istanbul ignore next */
      cov_rqkxgdyju().b[2][0]++;
      cov_rqkxgdyju().s[18]++;
      console.warn(`[MiningEngine] Allocation failed: Exceeds 1M limit for ${countryCode}`);
      /* istanbul ignore next */
      cov_rqkxgdyju().s[19]++;
      return false;
    } else
    /* istanbul ignore next */
    {
      cov_rqkxgdyju().b[2][1]++;
    }
    cov_rqkxgdyju().s[20]++;
    this.sovereignAllocations.set(countryCode, currentAllocation + amount);
    /* istanbul ignore next */
    cov_rqkxgdyju().s[21]++;
    this.currentSupply += amount;
    /* istanbul ignore next */
    cov_rqkxgdyju().s[22]++;
    console.log(`[MiningEngine] Allocated ${amount} AZR to ${countryCode}. Total: ${currentAllocation + amount}`);
    /* istanbul ignore next */
    cov_rqkxgdyju().s[23]++;
    return true;
  }

  /**
   * Mints new tokens with deflationary check.
   * @param amount Amount to mint.
   * @returns The actual amount minted after burn (if applicable to minting) or just updates supply.
   */
  async mint(amount) {
    /* istanbul ignore next */
    cov_rqkxgdyju().f[4]++;
    cov_rqkxgdyju().s[24]++;
    if (this.currentSupply + amount > MiningEngine.MAX_SUPPLY) {
      /* istanbul ignore next */
      cov_rqkxgdyju().b[3][0]++;
      cov_rqkxgdyju().s[25]++;
      throw new Error('Max supply exceeded');
    } else
    /* istanbul ignore next */
    {
      cov_rqkxgdyju().b[3][1]++;
    }

    // In this model, we might burn on mint or on transfer. 
    // Let's assume minting is pure, but transfer burns.
    cov_rqkxgdyju().s[26]++;
    this.currentSupply += amount;
    /* istanbul ignore next */
    cov_rqkxgdyju().s[27]++;
    console.log(`[MiningEngine] Minted ${amount} AZR. Total Supply: ${this.currentSupply}`);
    /* istanbul ignore next */
    cov_rqkxgdyju().s[28]++;
    return amount;
  }
  getCurrentSupply() {
    /* istanbul ignore next */
    cov_rqkxgdyju().f[5]++;
    cov_rqkxgdyju().s[29]++;
    return this.currentSupply;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfcnFreGdkeWp1IiwiYWN0dWFsQ292ZXJhZ2UiLCJNaW5pbmdFbmdpbmUiLCJNQVhfU1VQUExZIiwicyIsIlNPVkVSRUlHTl9BTExPQ0FUSU9OX1BFUl9OQVRJT04iLCJCVVJOX1JBVEUiLCJjdXJyZW50U3VwcGx5Iiwic292ZXJlaWduQWxsb2NhdGlvbnMiLCJNYXAiLCJjb25zdHJ1Y3RvciIsImYiLCJjYWxjdWxhdGVSZXdhcmQiLCJhY3Rpb25UeXBlIiwidmFsdWVTY29yZSIsImJhc2VSZXdhcmQiLCJiIiwiY2FsY3VsYXRlQnVybkFtb3VudCIsImFtb3VudCIsImFsbG9jYXRlVG9Tb3ZlcmVpZ24iLCJjb3VudHJ5Q29kZSIsImN1cnJlbnRBbGxvY2F0aW9uIiwiZ2V0IiwiY29uc29sZSIsIndhcm4iLCJzZXQiLCJsb2ciLCJtaW50IiwiRXJyb3IiLCJnZXRDdXJyZW50U3VwcGx5Il0sInNvdXJjZXMiOlsibWluaW5nLWVuZ2luZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBldGhlcnMgfSBmcm9tICdldGhlcnMnO1xuXG5leHBvcnQgY2xhc3MgTWluaW5nRW5naW5lIHtcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNQVhfU1VQUExZID0gMV8wMDBfMDAwXzAwMDsgLy8gMSBCaWxsaW9uIEFaUlxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFNPVkVSRUlHTl9BTExPQ0FUSU9OX1BFUl9OQVRJT04gPSAxXzAwMF8wMDA7IC8vIDEgTWlsbGlvbiBBWlJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBCVVJOX1JBVEUgPSAwLjAxOyAvLyAxJSBidXJuIG9uIHRyYW5zYWN0aW9ucy9taW50aW5nXG5cbiAgICBwcml2YXRlIGN1cnJlbnRTdXBwbHk6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBzb3ZlcmVpZ25BbGxvY2F0aW9uczogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTsgLy8gQ291bnRyeSBDb2RlIC0+IEFtb3VudFxuXG4gICAgY29uc3RydWN0b3IoKSB7IH1cblxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZXMgdGhlIHJld2FyZCBmb3IgYSBzcGVjaWZpYyBhY3Rpb24gYmFzZWQgb24gdmFsdWUgY3JlYXRlZC5cbiAgICAgKiBAcGFyYW0gYWN0aW9uVHlwZSBUaGUgdHlwZSBvZiBhY3Rpb24gKGUuZy4sICdjcmVhdGVfY291cnNlJywgJ2NvZGVfY29tbWl0JykuXG4gICAgICogQHBhcmFtIHZhbHVlU2NvcmUgQSBzY29yZSByZXByZXNlbnRpbmcgdGhlIHZhbHVlIG9mIHRoZSBhY3Rpb24gKDAtMTAwKS5cbiAgICAgKiBAcmV0dXJucyBUaGUgY2FsY3VsYXRlZCBBWlIgcmV3YXJkLlxuICAgICAqL1xuICAgIGNhbGN1bGF0ZVJld2FyZChhY3Rpb25UeXBlOiBzdHJpbmcsIHZhbHVlU2NvcmU6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGxldCBiYXNlUmV3YXJkID0gMDtcbiAgICAgICAgc3dpdGNoIChhY3Rpb25UeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdjcmVhdGVfY291cnNlJzogYmFzZVJld2FyZCA9IDUwOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2NvZGVfY29tbWl0JzogYmFzZVJld2FyZCA9IDEwOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZV9uZnQnOiBiYXNlUmV3YXJkID0gNTsgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiBiYXNlUmV3YXJkID0gMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFzZVJld2FyZCAqICh2YWx1ZVNjb3JlIC8gMTAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGRlZmxhdGlvbmFyeSBsb2dpYyBieSBjYWxjdWxhdGluZyB0aGUgYnVybiBhbW91bnQuXG4gICAgICogQHBhcmFtIGFtb3VudCBUaGUgdHJhbnNhY3Rpb24gb3IgcmV3YXJkIGFtb3VudC5cbiAgICAgKiBAcmV0dXJucyBUaGUgYW1vdW50IHRvIGJlIGJ1cm5lZC5cbiAgICAgKi9cbiAgICBjYWxjdWxhdGVCdXJuQW1vdW50KGFtb3VudDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGFtb3VudCAqIE1pbmluZ0VuZ2luZS5CVVJOX1JBVEU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHRoZSBhbGxvY2F0aW9uIG9mIEFaUiB0byBhIHNvdmVyZWlnbiBuYXRpb24uXG4gICAgICogQHBhcmFtIGNvdW50cnlDb2RlIElTTyBjb3VudHJ5IGNvZGUgKGUuZy4sICdaQScsICdVUycpLlxuICAgICAqIEBwYXJhbSBhbW91bnQgQW1vdW50IHRvIGFsbG9jYXRlLlxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgYWxsb2NhdGlvbiBpcyBzdWNjZXNzZnVsLCBGYWxzZSBpZiBpdCBleGNlZWRzIHRoZSBsaW1pdC5cbiAgICAgKi9cbiAgICBhbGxvY2F0ZVRvU292ZXJlaWduKGNvdW50cnlDb2RlOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRBbGxvY2F0aW9uID0gdGhpcy5zb3ZlcmVpZ25BbGxvY2F0aW9ucy5nZXQoY291bnRyeUNvZGUpIHx8IDA7XG4gICAgICAgIGlmIChjdXJyZW50QWxsb2NhdGlvbiArIGFtb3VudCA+IE1pbmluZ0VuZ2luZS5TT1ZFUkVJR05fQUxMT0NBVElPTl9QRVJfTkFUSU9OKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFtNaW5pbmdFbmdpbmVdIEFsbG9jYXRpb24gZmFpbGVkOiBFeGNlZWRzIDFNIGxpbWl0IGZvciAke2NvdW50cnlDb2RlfWApO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc292ZXJlaWduQWxsb2NhdGlvbnMuc2V0KGNvdW50cnlDb2RlLCBjdXJyZW50QWxsb2NhdGlvbiArIGFtb3VudCk7XG4gICAgICAgIHRoaXMuY3VycmVudFN1cHBseSArPSBhbW91bnQ7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbTWluaW5nRW5naW5lXSBBbGxvY2F0ZWQgJHthbW91bnR9IEFaUiB0byAke2NvdW50cnlDb2RlfS4gVG90YWw6ICR7Y3VycmVudEFsbG9jYXRpb24gKyBhbW91bnR9YCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1pbnRzIG5ldyB0b2tlbnMgd2l0aCBkZWZsYXRpb25hcnkgY2hlY2suXG4gICAgICogQHBhcmFtIGFtb3VudCBBbW91bnQgdG8gbWludC5cbiAgICAgKiBAcmV0dXJucyBUaGUgYWN0dWFsIGFtb3VudCBtaW50ZWQgYWZ0ZXIgYnVybiAoaWYgYXBwbGljYWJsZSB0byBtaW50aW5nKSBvciBqdXN0IHVwZGF0ZXMgc3VwcGx5LlxuICAgICAqL1xuICAgIGFzeW5jIG1pbnQoYW1vdW50OiBudW1iZXIpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50U3VwcGx5ICsgYW1vdW50ID4gTWluaW5nRW5naW5lLk1BWF9TVVBQTFkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWF4IHN1cHBseSBleGNlZWRlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSW4gdGhpcyBtb2RlbCwgd2UgbWlnaHQgYnVybiBvbiBtaW50IG9yIG9uIHRyYW5zZmVyLiBcbiAgICAgICAgLy8gTGV0J3MgYXNzdW1lIG1pbnRpbmcgaXMgcHVyZSwgYnV0IHRyYW5zZmVyIGJ1cm5zLlxuICAgICAgICB0aGlzLmN1cnJlbnRTdXBwbHkgKz0gYW1vdW50O1xuICAgICAgICBjb25zb2xlLmxvZyhgW01pbmluZ0VuZ2luZV0gTWludGVkICR7YW1vdW50fSBBWlIuIFRvdGFsIFN1cHBseTogJHt0aGlzLmN1cnJlbnRTdXBwbHl9YCk7XG4gICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudFN1cHBseSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50U3VwcGx5O1xuICAgIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBZVk7SUFBQUEsYUFBQSxZQUFBQSxDQUFBO01BQUEsT0FBQUMsY0FBQTtJQUFBO0VBQUE7RUFBQSxPQUFBQSxjQUFBO0FBQUE7QUFBQUQsYUFBQTtBQWJaLE9BQU8sTUFBTUUsWUFBWSxDQUFDO0VBQ3RCLE9BQXdCQyxVQUFVO0VBQUE7RUFBQSxDQUFBSCxhQUFBLEdBQUFJLENBQUEsT0FBRyxhQUFhLEVBQUMsQ0FBQztF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