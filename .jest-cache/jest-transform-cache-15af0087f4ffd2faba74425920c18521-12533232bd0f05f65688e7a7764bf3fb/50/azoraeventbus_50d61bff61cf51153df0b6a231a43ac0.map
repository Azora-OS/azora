{"version":3,"names":["cov_venx1q8cn","actualCoverage","createClient","EventBus","subscriptions","s","Map","constructor","url","serviceName","f","publisher","subscriber","connect","catch","console","error","then","setupSubscriber","subscribe","message","event","JSON","parse","handlers","get","type","b","forEach","handler","err","publish","data","source","timestamp","Date","stringify","has","set","push","disconnect"],"sources":["azora-event-bus.ts"],"sourcesContent":["import { createClient } from 'redis';\n\nexport class EventBus {\n    private publisher: any;\n    private subscriber: any;\n    private serviceName: string;\n    private subscriptions: Map<string, Function[]> = new Map();\n\n    constructor(url: string, serviceName: string) {\n        this.serviceName = serviceName;\n        this.publisher = createClient({ url });\n        this.subscriber = createClient({ url });\n\n        this.publisher.connect().catch(console.error);\n        this.subscriber.connect().then(() => {\n            this.setupSubscriber();\n        }).catch(console.error);\n    }\n\n    private async setupSubscriber() {\n        await this.subscriber.subscribe('azora-events', (message: string) => {\n            try {\n                const event = JSON.parse(message);\n                const handlers = this.subscriptions.get(event.type);\n                if (handlers) {\n                    handlers.forEach(handler => handler(event));\n                }\n            } catch (err) {\n                console.error('Error processing event:', err);\n            }\n        });\n    }\n\n    async publish(type: string, data: any) {\n        const event = {\n            type,\n            source: this.serviceName,\n            timestamp: new Date(),\n            data\n        };\n        await this.publisher.publish('azora-events', JSON.stringify(event));\n    }\n\n    subscribe(type: string, handler: Function) {\n        if (!this.subscriptions.has(type)) {\n            this.subscriptions.set(type, []);\n        }\n        this.subscriptions.get(type)?.push(handler);\n    }\n\n    async disconnect() {\n        await this.publisher.disconnect();\n        await this.subscriber.disconnect();\n    }\n}\n"],"mappings":"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","ignoreList":[]}