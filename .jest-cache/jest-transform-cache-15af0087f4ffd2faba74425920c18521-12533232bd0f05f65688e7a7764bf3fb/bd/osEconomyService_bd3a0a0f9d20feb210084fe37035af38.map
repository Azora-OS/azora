{"version":3,"names":["cov_2mbblxqaxt","actualCoverage","PrismaClient","prisma","s","consumeGas","userWalletId","microservice","gasAmount","f","$transaction","wallet","update","where","id","data","balance","decrement","transaction","create","type","status","amount","coinType","usdEquivalent","notes","senderId","processTreasuryDistribution","paySaaS","providerWalletId","increment","recipientId","burn","reward","grant","burnLog","process","env","STAKING_POOL_WALLET_ID","DEV_GRANT_POOL_WALLET_ID"],"sources":["osEconomyService.ts"],"sourcesContent":["/*\nAZORA PROPRIETARY LICENSE\n\nCopyright Â© 2025 Azora ES (Pty) Ltd. All Rights Reserved.\n\nSee LICENSE file for details.\n*/\n\nimport { PrismaClient } from '@prisma/client';\nconst prisma = new PrismaClient();\n\nexport async function consumeGas(userWalletId: string, microservice: string, gasAmount: number) {\n  await prisma.$transaction([\n    prisma.wallet.update({ where: { id: userWalletId }, data: { balance: { decrement: gasAmount } } }),\n    prisma.transaction.create({\n      data: {\n        type: 'GAS',\n        status: 'COMPLETED',\n        amount: gasAmount,\n        coinType: 'AZR',\n        usdEquivalent: gasAmount,\n        notes: `Gas for ${microservice}`,\n        senderId: userWalletId,\n        microservice\n      }\n    })\n  ]);\n  await processTreasuryDistribution(gasAmount, userWalletId, microservice);\n}\n\nexport async function paySaaS(userWalletId: string, providerWalletId: string, amount: number, notes: string) {\n  await prisma.$transaction([\n    prisma.wallet.update({ where: { id: userWalletId }, data: { balance: { decrement: amount } } }),\n    prisma.wallet.update({ where: { id: providerWalletId }, data: { balance: { increment: amount } } }),\n    prisma.transaction.create({\n      data: {\n        type: 'SaaS_PAYMENT',\n        status: 'COMPLETED',\n        amount,\n        coinType: 'AZR',\n        usdEquivalent: amount,\n        notes,\n        senderId: userWalletId,\n        recipientId: providerWalletId\n      }\n    })\n  ]);\n}\n\nexport async function processTreasuryDistribution(amount: number, userWalletId: string, microservice: string) {\n  const burn = amount * 0.5;\n  const reward = amount * 0.3;\n  const grant = amount * 0.2;\n  await prisma.burnLog.create({ data: { amount: burn, notes: `Auto-burn from ${microservice}` } });\n  await prisma.transaction.create({\n    data: {\n      type: 'BURN',\n      status: 'COMPLETED',\n      amount: burn,\n      coinType: 'AZR',\n      usdEquivalent: 0,\n      notes: `Burn from OS gas`,\n      senderId: userWalletId\n    }\n  });\n  await prisma.transaction.create({\n    data: {\n      type: 'REWARD',\n      status: 'COMPLETED',\n      amount: reward,\n      coinType: 'AZR',\n      usdEquivalent: reward,\n      notes: `OS gas reward to stakers`,\n      senderId: userWalletId,\n      recipientId: process.env.STAKING_POOL_WALLET_ID\n    }\n  });\n  await prisma.wallet.update({\n    where: { id: process.env.STAKING_POOL_WALLET_ID },\n    data: { balance: { increment: reward } }\n  });\n  await prisma.transaction.create({\n    data: {\n      type: 'GRANT',\n      status: 'COMPLETED',\n      amount: grant,\n      coinType: 'AZR',\n      usdEquivalent: grant,\n      notes: `Dev grant from OS gas`,\n      senderId: userWalletId,\n      recipientId: process.env.DEV_GRANT_POOL_WALLET_ID\n    }\n  });\n  await prisma.wallet.update({\n    where: { id: process.env.DEV_GRANT_POOL_WALLET_ID },\n    data: { balance: { increment: grant } }\n  });\n}"],"mappings":"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","ignoreList":[]}