version: '3.8'

services:
  # ğŸ³ Portainer - Docker UI
  portainer:
    image: portainer/portainer-ce:latest
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer-data:/data
    restart: unless-stopped

  # ğŸ“Š Grafana - Monitoring
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=azora
    volumes:
      - grafana-data:/var/lib/grafana
    restart: unless-stopped

  # ğŸ” SonarQube - Code Quality
  sonarqube:
    image: sonarqube:community
    ports:
      - "9001:9000"
    environment:
      - SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true
    volumes:
      - sonarqube-data:/opt/sonarqube/data
    restart: unless-stopped

  # ğŸ“ Jupyter - Notebooks
  jupyter:
    image: jupyter/datascience-notebook:latest
    ports:
      - "8888:8888"
    environment:
      - JUPYTER_ENABLE_LAB=yes
    volumes:
      - jupyter-data:/home/jovyan/work
    restart: unless-stopped

  # ğŸ—„ï¸ PostgreSQL
  postgres:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=azora
      - POSTGRES_USER=azora
    volumes:
      - postgres-data:/var/lib/postgresql/data
    restart: unless-stopped

  # ğŸ—„ï¸ MySQL
  mysql:
    image: mysql:8
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=azora
      - MYSQL_DATABASE=azora
    volumes:
      - mysql-data:/var/lib/mysql
    restart: unless-stopped

  # ğŸ” Vault - Secrets
  vault:
    image: vault:latest
    ports:
      - "8200:8200"
    environment:
      - VAULT_DEV_ROOT_TOKEN_ID=azora
    cap_add:
      - IPC_LOCK
    restart: unless-stopped

  # ğŸ“¡ MinIO - S3 Storage
  minio:
    image: minio/minio:latest
    ports:
      - "9002:9000"
      - "9003:9001"
    environment:
      - MINIO_ROOT_USER=azora
      - MINIO_ROOT_PASSWORD=azora123
    command: server /data --console-address ":9001"
    volumes:
      - minio-data:/data
    restart: unless-stopped

  # ğŸ“š Gitea - Self-hosted Git
  gitea:
    image: gitea/gitea:latest
    ports:
      - "3000:3000"
      - "2222:22"
    environment:
      - USER_UID=1000
      - USER_GID=1000
    volumes:
      - gitea-data:/data
    restart: unless-stopped

  # ğŸ§ª Selenium Grid
  selenium-hub:
    image: selenium/hub:latest
    ports:
      - "4444:4444"
    restart: unless-stopped

  selenium-chrome:
    image: selenium/node-chrome:latest
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
    depends_on:
      - selenium-hub
    restart: unless-stopped

  # ğŸ“Š Metabase - Analytics
  metabase:
    image: metabase/metabase:latest
    ports:
      - "3002:3000"
    volumes:
      - metabase-data:/metabase-data
    restart: unless-stopped

  # ğŸ”§ n8n - Workflow Automation
  n8n:
    image: n8nio/n8n:latest
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=azora
      - N8N_BASIC_AUTH_PASSWORD=azora
    volumes:
      - n8n-data:/home/node/.n8n
    restart: unless-stopped

  # ğŸ˜ Adminer - Database UI
  adminer:
    image: adminer:latest
    ports:
      - "8081:8080"
    restart: unless-stopped

  # ğŸ” Elasticsearch
  elasticsearch:
    image: elasticsearch:8.11.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - elasticsearch-data:/usr/share/elasticsearch/data
    restart: unless-stopped

  # ğŸ“¨ Mailhog - Email Testing
  mailhog:
    image: mailhog/mailhog:latest
    ports:
      - "1025:1025"
      - "8025:8025"
    restart: unless-stopped

  # ğŸ” Keycloak - SSO
  keycloak:
    image: quay.io/keycloak/keycloak:latest
    ports:
      - "8080:8080"
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=azora
    command: start-dev
    restart: unless-stopped

volumes:
  portainer-data:
  grafana-data:
  sonarqube-data:
  jupyter-data:
  postgres-data:
  mysql-data:
  minio-data:
  gitea-data:
  metabase-data:
  n8n-data:
  elasticsearch-data:

networks:
  default:
    name: azora-network
    external: true
