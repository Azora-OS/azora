// Prisma schema for AI Model Service
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ModelSelection {
  id                   String   @id @default(cuid())
  modelId              String
  task                 String
  priority             String
  userId               String?
  selectedAt           DateTime @default(now())
  constitutionalScore  Float
  pivcScore           Float
  sovereigntyScore    Float
  costPerToken        Float

  @@map("model_selections")
}

model ModelHealth {
  modelId              String   @id
  totalRequests        Int      @default(0)
  successfulRequests   Int      @default(0)
  failedRequests       Int      @default(0)
  averageResponseTime  Float    @default(0)
  lastHealthCheck      DateTime?
  circuitBreakerState  String   @default("CLOSED")
  errorMessage         String?

  @@map("model_health")
}

model ConstitutionalEvaluation {
  id                  String   @id @default(cuid())
  modelId             String
  interaction         String
  overallScore        Float
  truthScore          Float
  ethicsScore         Float
  sovereigntyScore    Float
  pivcScore           Float
  evaluatedAt         DateTime @default(now())

  @@map("constitutional_evaluations")
}

model ModelVersion {
  id                  String   @id @default(cuid())
  modelId             String
  version             String
  provider            String
  capabilities        String[] // JSON array of capabilities
  maxTokens           Int
  costPerToken        Float
  constitutionalScore Float
  pivcScore           Float
  sovereigntyScore    Float
  isActive            Boolean  @default(true)
  deployedAt          DateTime @default(now())
  deprecatedAt        DateTime?

  @@map("model_versions")
}

model ModelFallback {
  id                  String   @id @default(cuid())
  primaryModelId      String
  fallbackModelId     String
  priority            Int      @default(1)
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())

  @@unique([primaryModelId, fallbackModelId])
  @@map("model_fallbacks")
}

model ConstitutionalAlert {
  id                  String   @id @default(cuid())
  modelId             String
  alertType           String   // "constitutional_violation", "pivc_threshold", "sovereignty_breach"
  severity            String   // "low", "medium", "high", "critical"
  message             String
  threshold           Float
  actualValue         Float
  triggeredAt         DateTime @default(now())
  resolvedAt          DateTime?
  resolution          String?

  @@map("constitutional_alerts")
}